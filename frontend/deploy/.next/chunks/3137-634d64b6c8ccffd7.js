"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3137],{5174:(e,t,o)=>{o.d(t,{Jd:()=>i,XI:()=>l,Yq:()=>c,mW:()=>u,nc:()=>n});var s=o(65453),r=o(46786),a=o(25731);let n=(0,s.v)()((0,r.lt)((0,r.Zr)((e,t)=>(console.log("\uD83C\uDFEA Auth Store: Creating store instance"),{user:null,isAuthenticated:!1,isLoading:!1,error:null,login:async t=>{if(e({isLoading:!0,error:null}),!a.u)throw e({isLoading:!1,error:"API client not initialized"}),Error("API client not initialized");try{let o=await a.u.login(t);e({user:o.user,isAuthenticated:!0,isLoading:!1,error:null})}catch(t){throw e({isLoading:!1,error:t.message||"Login failed"}),t}},loginWithHash:async t=>{if(e({isLoading:!0,error:null}),!a.u)throw e({isLoading:!1,error:"API client not initialized"}),Error("API client not initialized");try{console.log("Auth store: Starting hash login with hash:",t.account_hash);let o=await a.u.loginWithHash(t);console.log("Auth store: Hash login successful, user:",o.user),e({user:o.user,isAuthenticated:!0,isLoading:!1,error:null})}catch(t){throw console.error("Auth store: Hash login failed:",t),e({isLoading:!1,error:t.message||"Hash login failed"}),t}},register:async t=>{e({isLoading:!0,error:null});try{await a.u.register(t),e({isLoading:!1,error:null})}catch(t){throw e({isLoading:!1,error:t.message||"Registration failed"}),t}},logout:()=>{a.u&&a.u.logout(),e({user:null,isAuthenticated:!1,error:null})},refreshUser:async()=>{console.log("Auth store: Refreshing user, checking API client auth status...");let t=0;for(;!a.u&&t<5;)console.log("Auth store: Waiting for API client to initialize...",t),await new Promise(e=>setTimeout(e,100)),t++;if(!a.u)return void console.log("❌ Auth store: API client not initialized after retries");if(!a.u.isAuthenticated()){console.log("Auth store: API client not authenticated, clearing state"),e({isAuthenticated:!1,user:null});return}try{console.log("Auth store: API client is authenticated, fetching current user...");let t=await a.u.getCurrentUser();console.log("Auth store: Successfully fetched user:",t.username),e({user:t,isAuthenticated:!0,error:null})}catch(t){console.error("Auth store: Failed to fetch user:",t),401===t.status?(console.log("Auth store: Token expired or invalid, clearing auth state"),a.u.logout(),e({user:null,isAuthenticated:!1,error:null})):e({error:t.message||"Failed to refresh user data"})}},clearError:()=>{e({error:null})},setLoading:t=>{e({isLoading:t})}}),{name:"omnicore_auth",partialize:e=>({user:e.user,isAuthenticated:e.isAuthenticated}),onRehydrateStorage:()=>e=>{var t;console.log("\uD83D\uDCA7 Auth Store: Rehydrated from storage:",{isAuthenticated:null==e?void 0:e.isAuthenticated,user:null==e||null==(t=e.user)?void 0:t.username})}}),{name:"auth-store"})),i=()=>n(e=>e.user),l=()=>n(e=>e.isAuthenticated),c=()=>n(e=>e.isLoading),u=()=>n(e=>e.error)},25731:(e,t,o)=>{o.d(t,{u:()=>i});var s=o(23464);let r="http://localhost:8000/api/v1";console.log("API Client initialized with base URL:",r);class a{handleError(e){if(e.response){let o=e.response.data,s="An error occurred";if(null==o?void 0:o.detail)if("string"==typeof o.detail)s=o.detail;else if(Array.isArray(o.detail)){var t;s=(null==(t=o.detail[0])?void 0:t.msg)||"Invalid input"}else"object"==typeof o.detail&&(s=o.detail.message||JSON.stringify(o.detail));else(null==o?void 0:o.message)&&(s=o.message);return{message:s,status:e.response.status,details:o}}return e.request?{message:"Network error - please check your connection",status:0}:{message:e.message||"An unexpected error occurred",status:0}}loadTokensFromStorage(){try{if(window.localStorage){let t=localStorage.getItem("omnicore_tokens");if(console.log("\uD83D\uDD0D API Client: Loading tokens from storage:",t?"Found tokens":"No tokens found"),t){var e;this.tokens=JSON.parse(t),console.log("✅ API Client: Tokens loaded successfully, expires at:",new Date(Date.now()+1e3*((null==(e=this.tokens)?void 0:e.expires_in)||0)).toLocaleTimeString())}}}catch(e){console.error("❌ API Client: Failed to load tokens from storage:",e)}}saveTokensToStorage(e){try{window.localStorage&&(console.log("\uD83D\uDCBE API Client: Saving tokens to storage, expires in:",e.expires_in,"seconds"),localStorage.setItem("omnicore_tokens",JSON.stringify(e)),console.log("✅ API Client: Tokens saved successfully")),this.tokens=e}catch(e){console.error("❌ API Client: Failed to save tokens to storage:",e)}}clearTokens(){console.log("\uD83D\uDDD1️ API Client: Clearing tokens from storage"),this.tokens=null,localStorage.removeItem("omnicore_tokens"),console.log("✅ API Client: Tokens cleared from localStorage")}async login(e){let t=new URLSearchParams;t.append("username",e.username),t.append("password",e.password);let o=await this.client.post("/auth/login",t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});return this.saveTokensToStorage(o.data),{user:await this.getCurrentUser(),tokens:o.data}}async registerWithHash(){console.log("API Client: Requesting new hash registration from backend");let e=await this.client.post("/hash-auth/register");return console.log("API Client: Hash registration successful:",{hash:e.data.account_hash.substring(0,4)+"...",created_at:e.data.created_at}),e.data}async loginWithHash(e){try{console.log("API Client: Making hash auth request to:","".concat(r,"/hash-auth/authenticate")),console.log("API Client: Hash credentials:",e);let t=await this.client.post("/hash-auth/authenticate",e);console.log("API Client: Hash auth response received:",{status:t.status,hasAccessToken:!!t.data.access_token,tokenType:t.data.token_type,role:t.data.role});let o={access_token:t.data.access_token,refresh_token:t.data.refresh_token,token_type:t.data.token_type,expires_in:t.data.expires_in};return this.saveTokensToStorage(o),{user:{id:1,username:"user_".concat(e.account_hash.substring(0,8)),email:"anonymous@researchtools.dev",full_name:"Research Analyst",role:t.data.role,is_active:!0,is_verified:!0,account_hash:t.data.account_hash,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},tokens:o}}catch(e){var t,o;if((null==(t=e.response)?void 0:t.status)===401)throw{message:"Invalid account hash. Please check your account number.",status:401,details:null==(o=e.response)?void 0:o.data};throw e}}async register(e){return(await this.client.post("/auth/register",e)).data}async refreshToken(){var e;if(!(null==(e=this.tokens)?void 0:e.refresh_token))throw Error("No refresh token available");let t=await this.client.post("/auth/refresh",{refresh_token:this.tokens.refresh_token});return this.saveTokensToStorage(t.data),t.data}async getCurrentUser(){return(await this.client.get("/auth/me")).data}logout(){this.clearTokens()}async get(e,t){return(await this.client.get(e,t)).data}async post(e,t){return(await this.client.post(e,t)).data}async put(e,t){return(await this.client.put(e,t)).data}async patch(e,t){return(await this.client.patch(e,t)).data}async delete(e){await this.client.delete(e)}isAuthenticated(){var e,t;let o=!!(null==(e=this.tokens)?void 0:e.access_token);return console.log("\uD83D\uDD10 API Client: isAuthenticated check:",o,(null==(t=this.tokens)?void 0:t.access_token)?"Token exists":"No token"),o}getTokens(){return this.tokens}async healthCheck(){return(await this.client.get("/health")).data}constructor(){this.tokens=null,console.log("\uD83C\uDFD7️ API Client: Constructor called, initializing..."),this.client=s.A.create({baseURL:r,headers:{"Content-Type":"application/json"}}),console.log("\uD83C\uDFD7️ API Client: Loading tokens on initialization..."),this.loadTokensFromStorage(),this.client.interceptors.request.use(e=>{var t;return(null==(t=this.tokens)?void 0:t.access_token)&&(e.headers.Authorization="Bearer ".concat(this.tokens.access_token)),e},e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,async e=>{var t,o;let s=e.config;if((null==(t=e.response)?void 0:t.status)===401&&s&&!s._retry){s._retry=!0;try{return await this.refreshToken(),(null==(o=this.tokens)?void 0:o.access_token)&&s.headers&&(s.headers.Authorization="Bearer ".concat(this.tokens.access_token)),this.client.request(s)}catch(e){return this.clearTokens(),window.location.href="/login",Promise.reject(e)}}return Promise.reject(this.handleError(e))}),this.loadTokensFromStorage()}}let n=null,i=new Proxy({},{get(e,t){if(n||(console.log("\uD83C\uDFAF API Client: Initializing singleton on first access"),n=new a),!n)return"string"==typeof t&&"then"!==t?()=>Promise.resolve(null):void 0;let o=n[t];return"function"==typeof o?o.bind(n):o}})},59434:(e,t,o)=>{o.d(t,{cn:()=>a,fw:()=>n});var s=o(52596),r=o(39688);function a(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,r.QP)((0,s.$)(t))}function n(e){let t=new Date,o=new Date(e);if(isNaN(o.getTime()))return"Invalid date";let s=Math.floor((t.getTime()-o.getTime())/1e3);if(s<60)return"just now";if(s<3600)return"".concat(Math.floor(s/60),"m ago");if(s<86400)return"".concat(Math.floor(s/3600),"h ago");if(s<604800)return"".concat(Math.floor(s/86400),"d ago");let r=new Date(e);return isNaN(r.getTime())?"Invalid date":new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(r)}}}]);