import{j as e}from"./ui-vendor-DBphXmDA.js";import{f as B,r as l}from"./react-vendor-CfYLSWvh.js";import{C as m,a as p,b as x,d as g,c as f}from"./card-BGAig-Dv.js";import{u as P,B as h,S as G,z as O,C as X,E as K,F as T,e as o}from"./index-QqleixXe.js";import{P as Y}from"./progress-Cg1bbsHw.js";import{R as C,T as L,c as W,aL as q,x as M,E as z,V as J,a5 as Q,w as Z,aj as D,e as ee,Y as se,az as ae}from"./icons-x9tcvtYN.js";import"./state-vendor-BXB5jEEt.js";function de(){const{t:s}=P(),i=B(),[N,c]=l.useState(!0),[a,_]=l.useState(null),[k,u]=l.useState(null),[j,F]=l.useState(null),[R,H]=l.useState([]),[n,A]=l.useState("1"),[I,E]=l.useState(!0),U=async()=>{try{E(!0);const t=localStorage.getItem("omnicore_user_hash"),r=await fetch("/api/workspaces",{headers:{...t&&{Authorization:`Bearer ${t}`,"X-User-Hash":t}}});if(r.ok){const v=await r.json(),w=[...v.owned||[],...v.member||[]];H(w),w.length>0&&!w.find($=>$.id===n)&&A(w[0].id)}}catch(t){console.error("Failed to load workspaces:",t)}finally{E(!1)}},y=async()=>{try{c(!0),u(null);const t=localStorage.getItem("omnicore_user_hash"),r=await fetch(`/api/deception/aggregate?workspace_id=${n}`,{headers:{...t&&{Authorization:`Bearer ${t}`}}});if(!r.ok)throw new Error("Failed to load deception risk data");const v=await r.json();_(v),F(new Date)}catch(t){console.error("Failed to load deception dashboard:",t),u(t instanceof Error?t.message:"Unknown error")}finally{c(!1)}};if(l.useEffect(()=>{U()},[]),l.useEffect(()=>{I||y()},[n,I]),N)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:s("pages.deceptionRisk.loading")})]})});if(k||!a)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs(m,{className:"max-w-md",children:[e.jsx(p,{children:e.jsxs(x,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(L,{className:"h-5 w-5"}),s("pages.deceptionRisk.errorTitle")]})}),e.jsxs(g,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:k||s("pages.deceptionRisk.errorMessage")}),e.jsxs(h,{onClick:y,children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),s("pages.deceptionRisk.retry")]})]})]})});const S=t=>{switch(t){case"CRITICAL":return"text-red-700 bg-red-100 dark:text-red-400 dark:bg-red-900/20 border-red-500";case"HIGH":return"text-orange-700 bg-orange-100 dark:text-orange-400 dark:bg-orange-900/20 border-orange-500";case"MEDIUM":return"text-yellow-700 bg-yellow-100 dark:text-yellow-400 dark:bg-yellow-900/20 border-yellow-500";case"LOW":return"text-green-700 bg-green-100 dark:text-green-400 dark:bg-green-900/20 border-green-500";default:return"text-gray-700 bg-gray-100 dark:text-gray-400 dark:bg-gray-900/20 border-gray-500"}},V=t=>{switch(t){case"CRITICAL":return e.jsx(ae,{className:"h-4 w-4"});case"HIGH":return e.jsx(L,{className:"h-4 w-4"});case"MEDIUM":return e.jsx(se,{className:"h-4 w-4"});case"LOW":return e.jsx(D,{className:"h-4 w-4"});default:return e.jsx(ee,{className:"h-4 w-4"})}},b=R.find(t=>t.id===n);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(W,{className:"h-8 w-8"}),s("pages.deceptionRisk.title")]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("pages.deceptionRisk.subtitle")}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx(q,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs(G,{value:n,onValueChange:A,children:[e.jsx(O,{className:"w-[300px]",children:e.jsx(X,{placeholder:s("pages.deceptionRisk.selectWorkspace")})}),e.jsx(K,{children:R.length===0?e.jsx(T,{value:"1",children:s("pages.deceptionRisk.defaultWorkspace")}):R.map(t=>e.jsx(T,{value:t.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:t.name}),t.type==="TEAM"&&e.jsx(o,{variant:"outline",className:"text-xs",children:s("pages.deceptionRisk.team")}),t.type==="PUBLIC"&&e.jsx(o,{variant:"outline",className:"text-xs",children:s("pages.deceptionRisk.public")})]})},t.id))})]}),b&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[b.entity_count.actors," ",s("pages.deceptionRisk.actors")," · ",b.entity_count.sources," ",s("pages.deceptionRisk.sources")," · ",b.entity_count.evidence," ",s("pages.deceptionRisk.evidence")]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs(h,{onClick:y,variant:"outline",size:"sm",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),s("pages.deceptionRisk.refresh")]}),j&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[s("pages.deceptionRisk.updated")," ",j.toLocaleTimeString()]})]})]}),e.jsxs(m,{className:`border-2 ${S(a.risk_level)}`,children:[e.jsxs(p,{children:[e.jsxs(x,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),s("pages.deceptionRisk.overallRiskScore")]}),e.jsx(o,{variant:"outline",className:`text-lg px-4 py-2 ${S(a.risk_level)}`,children:s(`pages.deceptionRisk.riskLevels.${a.risk_level.toLowerCase()}`)})]}),e.jsx(f,{children:s("pages.deceptionRisk.aggregatedFrom",{actors:a.metadata.data_sources.actors,sources:a.metadata.data_sources.sources,analyses:a.metadata.data_sources.content_analyses})})]}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-6xl font-bold",children:[a.overall_risk_score,e.jsx("span",{className:"text-3xl text-muted-foreground",children:"/100"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Y,{value:a.overall_risk_score,className:"h-4"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:[s("pages.deceptionRisk.riskThreshold"),": ",s(`pages.deceptionRisk.riskLevels.${a.overall_risk_score>=75?"critical":a.overall_risk_score>=60?"high":a.overall_risk_score>=40?"medium":"low"}`)]})]})]})})]}),(a.critical_alerts.length>0||a.high_alerts.length>0)&&e.jsxs(m,{className:"border-2 border-red-500",children:[e.jsxs(p,{children:[e.jsxs(x,{className:"flex items-center gap-2 text-red-700 dark:text-red-400",children:[e.jsx(L,{className:"h-5 w-5"}),s("pages.deceptionRisk.criticalAlerts")," (",a.critical_alerts.length+a.high_alerts.length,")"]}),e.jsx(f,{children:s("pages.deceptionRisk.immediateAttention")})]}),e.jsx(g,{className:"space-y-3",children:[...a.critical_alerts,...a.high_alerts].map((t,r)=>e.jsxs("div",{className:`p-4 rounded-lg border-2 ${S(t.severity)} flex items-start justify-between gap-4`,children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"mt-0.5",children:V(t.severity)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold mb-1",children:t.entity_name}),e.jsx("div",{className:"text-sm opacity-80",children:t.details}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(o,{variant:"outline",className:"text-xs",children:t.type.replace("_"," ")}),e.jsxs(o,{variant:"outline",className:"text-xs",children:[s("pages.deceptionRisk.risk"),": ",t.risk_score.toFixed(1)]})]})]})]}),t.url&&e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>i(t.url),children:e.jsx(z,{className:"h-4 w-4"})})]},r))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(d,{title:s("pages.deceptionRisk.cards.actorsMom.title"),subtitle:s("pages.deceptionRisk.cards.actorsMom.subtitle"),icon:e.jsx(M,{className:"h-5 w-5"}),stats:{high:a.risk_breakdown.actors_mom.high,medium:a.risk_breakdown.actors_mom.medium,low:a.risk_breakdown.actors_mom.low,total:a.risk_breakdown.actors_mom.total,avgScore:a.risk_breakdown.actors_mom.avg_score},labels:{high:s("pages.deceptionRisk.labels.highRisk"),medium:s("pages.deceptionRisk.labels.mediumRisk"),low:s("pages.deceptionRisk.labels.lowRisk")},totalLabel:s("pages.deceptionRisk.totalItems"),avgLabel:s("pages.deceptionRisk.avgScore"),viewAllLabel:s("pages.deceptionRisk.viewAll"),onViewAll:()=>i("/dashboard/entities/actors")}),e.jsx(d,{title:s("pages.deceptionRisk.cards.actorsPop.title"),subtitle:s("pages.deceptionRisk.cards.actorsPop.subtitle"),icon:e.jsx(J,{className:"h-5 w-5"}),stats:{high:a.risk_breakdown.actors_pop.high,medium:a.risk_breakdown.actors_pop.medium,low:a.risk_breakdown.actors_pop.low,total:a.risk_breakdown.actors_pop.total,avgScore:a.risk_breakdown.actors_pop.avg_score},labels:{high:s("pages.deceptionRisk.labels.highRisk"),medium:s("pages.deceptionRisk.labels.mediumRisk"),low:s("pages.deceptionRisk.labels.lowRisk")},totalLabel:s("pages.deceptionRisk.totalItems"),avgLabel:s("pages.deceptionRisk.avgScore"),viewAllLabel:s("pages.deceptionRisk.viewAll"),onViewAll:()=>i("/dashboard/entities/actors")}),e.jsx(d,{title:s("pages.deceptionRisk.cards.sourcesMoses.title"),subtitle:s("pages.deceptionRisk.cards.sourcesMoses.subtitle"),icon:e.jsx(Q,{className:"h-5 w-5"}),stats:{high:a.risk_breakdown.sources_moses.compromised,medium:a.risk_breakdown.sources_moses.unreliable,low:a.risk_breakdown.sources_moses.solid,total:a.risk_breakdown.sources_moses.total,avgScore:a.risk_breakdown.sources_moses.avg_score},labels:{high:s("pages.deceptionRisk.labels.compromised"),medium:s("pages.deceptionRisk.labels.unreliable"),low:s("pages.deceptionRisk.labels.solid")},totalLabel:s("pages.deceptionRisk.totalItems"),avgLabel:s("pages.deceptionRisk.avgScore"),viewAllLabel:s("pages.deceptionRisk.viewAll"),onViewAll:()=>i("/dashboard/entities/sources")}),e.jsx(d,{title:s("pages.deceptionRisk.cards.evidenceEve.title"),subtitle:s("pages.deceptionRisk.cards.evidenceEve.subtitle"),icon:e.jsx(Z,{className:"h-5 w-5"}),stats:{high:a.risk_breakdown.evidence_eve.suspicious,medium:a.risk_breakdown.evidence_eve.needs_review,low:a.risk_breakdown.evidence_eve.verified,total:a.risk_breakdown.evidence_eve.total,avgScore:a.risk_breakdown.evidence_eve.avg_score},labels:{high:s("pages.deceptionRisk.labels.suspicious"),medium:s("pages.deceptionRisk.labels.needsReview"),low:s("pages.deceptionRisk.labels.verified")},totalLabel:s("pages.deceptionRisk.totalItems"),avgLabel:s("pages.deceptionRisk.avgScore"),viewAllLabel:s("pages.deceptionRisk.viewAll"),onViewAll:()=>i("/dashboard/evidence")}),e.jsx(d,{title:s("pages.deceptionRisk.cards.claims.title"),subtitle:s("pages.deceptionRisk.cards.claims.subtitle"),icon:e.jsx(W,{className:"h-5 w-5"}),stats:{high:a.risk_breakdown.claims.high,medium:a.risk_breakdown.claims.medium,low:a.risk_breakdown.claims.low,total:a.risk_breakdown.claims.total,avgScore:a.risk_breakdown.claims.avg_score},labels:{high:s("pages.deceptionRisk.labels.highRisk"),medium:s("pages.deceptionRisk.labels.mediumRisk"),low:s("pages.deceptionRisk.labels.lowRisk")},totalLabel:s("pages.deceptionRisk.totalItems"),avgLabel:s("pages.deceptionRisk.avgScore"),viewAllLabel:s("pages.deceptionRisk.viewAll"),onViewAll:()=>i("/dashboard/tools/content-intelligence")})]}),a.recommended_actions.length>0&&e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),s("pages.deceptionRisk.recommendedActions")]}),e.jsx(f,{children:s("pages.deceptionRisk.priorityTasks")})]}),e.jsx(g,{className:"space-y-3",children:a.recommended_actions.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(o,{variant:"outline",children:["#",t.priority]}),e.jsx("span",{children:t.action})]}),t.url&&e.jsxs(h,{size:"sm",variant:"ghost",onClick:()=>i(t.url),children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),s("pages.deceptionRisk.review")]})]},r))})]})]})}function d({title:s,subtitle:i,icon:N,stats:c,labels:a,totalLabel:_,avgLabel:k,viewAllLabel:u,onViewAll:j}){return e.jsxs(m,{children:[e.jsxs(p,{children:[e.jsxs(x,{className:"flex items-center gap-2 text-base",children:[N,s]}),e.jsx(f,{className:"text-xs",children:i})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"text-3xl font-bold text-center",children:[c.total,e.jsx("div",{className:"text-xs font-normal text-muted-foreground",children:_})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),a.high]}),e.jsx("span",{className:"font-bold",children:c.high})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),a.medium]}),e.jsx("span",{className:"font-bold",children:c.medium})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),a.low]}),e.jsx("span",{className:"font-bold",children:c.low})]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:[k,": ",e.jsx("span",{className:"font-bold",children:c.avgScore.toFixed(1)})]})}),e.jsx(h,{onClick:j,variant:"outline",size:"sm",className:"w-full",children:u})]})]})}export{de as default};
