import{j as e}from"./ui-vendor-DBphXmDA.js";import{r as f}from"./react-vendor-CfYLSWvh.js";import{e as b,B as p,S as C,z as k,C as S,E as M,F as c}from"./index-DGGXJgUa.js";import{C as A,a as O,b as _,d as R}from"./card-BQo7RV_Z.js";import{P as u}from"./progress-D6O6TLpv.js";import{t as D,am as L,ai as $,T as z,$ as E,q as H,bp as U,bq as W,W as T}from"./icons-x9tcvtYN.js";function q({assessment:a,actorName:t,eventName:i,onEdit:m,onDelete:h,compact:o=!1}){const r=(()=>{const l=(a.motive+a.opportunity+a.means)/3,n=l/5*100;return l>=4?{level:"CRITICAL",percentage:n,color:"red",bgColor:"bg-red-100",textColor:"text-red-800"}:l>=3?{level:"HIGH",percentage:n,color:"orange",bgColor:"bg-orange-100",textColor:"text-orange-800"}:l>=1.5?{level:"MEDIUM",percentage:n,color:"yellow",bgColor:"bg-yellow-100",textColor:"text-yellow-800"}:{level:"LOW",percentage:n,color:"green",bgColor:"bg-green-100",textColor:"text-green-800"}})(),x=l=>l>=4?"bg-red-500":l>=3?"bg-orange-500":l>=2?"bg-yellow-500":"bg-green-500";return o?e.jsxs(A,{className:"hover:shadow-md transition-shadow",children:[e.jsx(O,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(_,{className:"text-base",children:a.scenario_description}),(t||i)&&e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500",children:[t&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3"}),t]}),i&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-3 w-3"}),i]})]})]}),e.jsx(b,{className:`${r.bgColor} ${r.textColor} ml-2`,children:r.level})]})}),e.jsxs(R,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Motive"}),e.jsxs("div",{className:"font-semibold",children:[a.motive,"/5"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Opportunity"}),e.jsxs("div",{className:"font-semibold",children:[a.opportunity,"/5"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Means"}),e.jsxs("div",{className:"font-semibold",children:[a.means,"/5"]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx($,{className:"h-3 w-3"}),new Date(a.assessed_at).toLocaleDateString()]})]})]}):e.jsxs(A,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(O,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(_,{className:"text-lg",children:a.scenario_description}),a.event_id&&e.jsx(b,{variant:"outline",className:"text-xs",children:"Event Linked"})]}),(t||i)&&e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600 dark:text-gray-400",children:[t&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"h-4 w-4"}),t]}),i&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"h-4 w-4"}),i]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(b,{className:`${r.bgColor} ${r.textColor}`,children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),r.level," RISK"]}),m&&e.jsx(p,{variant:"ghost",size:"sm",onClick:m,children:e.jsx(E,{className:"h-4 w-4"})}),h&&e.jsx(p,{variant:"ghost",size:"sm",onClick:h,children:e.jsx(H,{className:"h-4 w-4"})})]})]})}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Motive"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[a.motive,"/5"]})]}),e.jsx(u,{value:a.motive/5*100,className:`h-2 ${x(a.motive)}`})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Opportunity"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[a.opportunity,"/5"]})]}),e.jsx(u,{value:a.opportunity/5*100,className:`h-2 ${x(a.opportunity)}`})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Means"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[a.means,"/5"]})]}),e.jsx(u,{value:a.means/5*100,className:`h-2 ${x(a.means)}`})]})]}),e.jsxs("div",{className:"pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Overall Risk"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[r.percentage.toFixed(0),"%"]})]}),e.jsx(u,{value:r.percentage,className:"h-3"})]}),a.notes&&e.jsxs("div",{className:"pt-3 border-t",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Assessment Notes"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 whitespace-pre-wrap",children:a.notes})]}),e.jsxs("div",{className:"pt-3 border-t text-xs text-gray-500 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($,{className:"h-3 w-3"}),"Assessed: ",new Date(a.assessed_at).toLocaleDateString()]}),e.jsxs("span",{children:["Updated: ",new Date(a.updated_at).toLocaleDateString()]})]})]})]})}function Y({assessments:a,actorNames:t={},eventNames:i={},onEdit:m,onDelete:h,onCreateNew:o,compact:N=!1,showFilters:r=!0}){const[x,l]=f.useState("date"),[n,I]=f.useState("desc"),[j,B]=f.useState("all"),F=s=>{const d=(s.motive+s.opportunity+s.means)/3;return d>=4?"critical":d>=3?"high":d>=1.5?"medium":"low"},y=s=>(s.motive+s.opportunity+s.means)/3;let w=a;j!=="all"&&(w=a.filter(s=>F(s)===j));const v=[...w].sort((s,d)=>{let g=0;switch(x){case"date":g=new Date(s.assessed_at).getTime()-new Date(d.assessed_at).getTime();break;case"risk":g=y(s)-y(d);break;case"scenario":g=s.scenario_description.localeCompare(d.scenario_description);break}return n==="asc"?g:-g}),P=()=>{I(s=>s==="asc"?"desc":"asc")};return e.jsxs("div",{className:"space-y-4",children:[r&&e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(C,{value:x,onValueChange:s=>l(s),children:[e.jsx(k,{className:"w-[150px]",children:e.jsx(S,{placeholder:"Sort by"})}),e.jsxs(M,{children:[e.jsx(c,{value:"date",children:"Date"}),e.jsx(c,{value:"risk",children:"Risk Level"}),e.jsx(c,{value:"scenario",children:"Scenario"})]})]}),e.jsx(p,{variant:"outline",size:"sm",onClick:P,children:n==="asc"?e.jsx(U,{className:"h-4 w-4"}):e.jsx(W,{className:"h-4 w-4"})}),e.jsxs(C,{value:j,onValueChange:s=>B(s),children:[e.jsx(k,{className:"w-[150px]",children:e.jsx(S,{placeholder:"Filter by risk"})}),e.jsxs(M,{children:[e.jsx(c,{value:"all",children:"All Risks"}),e.jsx(c,{value:"critical",children:"Critical"}),e.jsx(c,{value:"high",children:"High"}),e.jsx(c,{value:"medium",children:"Medium"}),e.jsx(c,{value:"low",children:"Low"})]})]})]}),o&&e.jsxs(p,{onClick:o,children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"New MOM Assessment"]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[v.length," assessment",v.length!==1?"s":"",j!=="all"&&` (filtered by ${j} risk)`]}),v.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"No MOM assessments found"}),o&&e.jsxs(p,{onClick:o,children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Create First Assessment"]})]}):e.jsx("div",{className:`grid gap-4 ${N?"grid-cols-1 md:grid-cols-2":"grid-cols-1"}`,children:v.map(s=>e.jsx(q,{assessment:s,actorName:t[s.actor_id],eventName:s.event_id?i[s.event_id]:void 0,onEdit:m?()=>m(s):void 0,onDelete:h?()=>h(s):void 0,compact:N},s.id))})]})}export{Y as M};
