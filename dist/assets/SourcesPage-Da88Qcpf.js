import{j as e}from"./ui-vendor-DBphXmDA.js";import{r as x,f as ce,k as be,u as ve}from"./react-vendor-CfYLSWvh.js";import{A as Ne,r as fe,y as M,I as Y,S as Z,z,C as Q,E as X,F as c,q as ee,e as p,B as R,l as oe,m as de,n as xe,o as me,u as Se}from"./index-QqleixXe.js";import{C as o,a as h,b as u,c as B,d}from"./card-BGAig-Dv.js";import{S as se}from"./slider-B52ikc1m.js";import{C as he,c as W,_ as we,N as Ee,$ as te,q as _e,a7 as ke,ad as ae,D as ie,W as le,a as Ce,a5 as Te}from"./icons-x9tcvtYN.js";import{P as $}from"./progress-Cg1bbsHw.js";import{T as Ae,a as Oe,b as V,c as H}from"./tabs-If3dmLWi.js";import{S as re}from"./separator-ozDNNLDu.js";import{R as Re,F as De,a as Ie}from"./FrameworkUsagePanel-BaPMlEIm.js";import"./checkbox-DueJeeKx.js";import"./radio-group-Dj8G6QwH.js";import"./state-vendor-BXB5jEEt.js";function ne({source:s,onSubmit:j,onCancel:P}){const[N,k]=x.useState(!1),[U,f]=x.useState(null),[i,g]=x.useState({name:s?.name||"",type:s?.type||"DOCUMENT",description:s?.description||"",source_type:s?.source_type||"",moses_assessment:s?.moses_assessment||{source_vulnerability:0,manipulation_evidence:0,access_level:"OPEN",reliability:"F",notes:""}}),C=()=>{const n=i.moses_assessment.source_vulnerability,y=i.moses_assessment.manipulation_evidence,b=(n+y)/2;return b<=1?"A":b<=2?"B":b<=3?"C":b<=4?"D":"E"},L=async n=>{n.preventDefault(),k(!0),f(null);try{const y=C();await j({...i,moses_assessment:{...i.moses_assessment,reliability:y}})}catch(y){f(y instanceof Error?y.message:"Failed to save source"),k(!1)}};return e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[U&&e.jsxs(Ne,{variant:"destructive",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(fe,{children:U})]}),e.jsxs(o,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Basic Information"}),e.jsx(B,{children:"Identify and categorize the source"})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"name",children:"Source Name *"}),e.jsx(Y,{id:"name",value:i.name,onChange:n=>g({...i,name:n.target.value}),placeholder:"e.g., Jane Doe, NY Times Article, CIA Report, whistleblower.com",required:!0})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"type",children:"Source Category *"}),e.jsxs(Z,{value:i.type,onValueChange:n=>g({...i,type:n}),children:[e.jsx(z,{id:"type",children:e.jsx(Q,{})}),e.jsxs(X,{children:[e.jsx(c,{value:"PERSON",children:"ðŸ‘¤ Person - Human source, witness, informant"}),e.jsx(c,{value:"DOCUMENT",children:"ðŸ“„ Document - Reports, papers, files, records"}),e.jsx(c,{value:"WEBSITE",children:"ðŸŒ Website - Online sources, social media, blogs"}),e.jsx(c,{value:"DATABASE",children:"ðŸ—„ï¸ Database - Structured data repositories"}),e.jsx(c,{value:"MEDIA",children:"ðŸ“¸ Media - Audio, video, images, recordings"}),e.jsx(c,{value:"SYSTEM",children:"âš™ï¸ System - Technical systems, sensors, equipment"}),e.jsx(c,{value:"ORGANIZATION",children:"ðŸ¢ Organization - Companies, agencies, groups"}),e.jsx(c,{value:"OTHER",children:"â“ Other - Miscellaneous sources"})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"source_type",children:"Specific Type/Role"}),e.jsx(Y,{id:"source_type",value:i.source_type,onChange:n=>g({...i,source_type:n.target.value}),placeholder:"e.g., Journalist, Whistleblower, Government Report, News Article"})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"description",children:"Description"}),e.jsx(ee,{id:"description",value:i.description,onChange:n=>g({...i,description:n.target.value}),placeholder:"Brief description of the source and its capabilities",rows:3})]})]})]}),e.jsxs(o,{className:"border-2",children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-blue-600"}),"MOSES Source Assessment"]}),e.jsx(B,{children:"My Own Sources Evaluation - assess source reliability"})]}),e.jsxs(p,{className:"bg-blue-100 text-blue-800",children:["Reliability: ",C()]})]})}),e.jsx(d,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{children:"Source Vulnerability"}),e.jsxs(p,{variant:"outline",children:[i.moses_assessment.source_vulnerability,"/5"]})]}),e.jsx(se,{value:[i.moses_assessment.source_vulnerability],onValueChange:([n])=>g({...i,moses_assessment:{...i.moses_assessment,source_vulnerability:n}}),min:0,max:5,step:1}),e.jsx("p",{className:"text-xs text-gray-500",children:"How vulnerable is this source to compromise or manipulation? (0=Not vulnerable, 5=Highly vulnerable)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{children:"Manipulation Evidence"}),e.jsxs(p,{variant:"outline",children:[i.moses_assessment.manipulation_evidence,"/5"]})]}),e.jsx(se,{value:[i.moses_assessment.manipulation_evidence],onValueChange:([n])=>g({...i,moses_assessment:{...i.moses_assessment,manipulation_evidence:n}}),min:0,max:5,step:1}),e.jsx("p",{className:"text-xs text-gray-500",children:"Evidence that this source has been manipulated (0=No evidence, 5=Strong evidence)"})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"access_level",children:"Access Level"}),e.jsxs(Z,{value:i.moses_assessment.access_level,onValueChange:n=>g({...i,moses_assessment:{...i.moses_assessment,access_level:n}}),children:[e.jsx(z,{id:"access_level",children:e.jsx(Q,{})}),e.jsxs(X,{children:[e.jsx(c,{value:"EXCLUSIVE",children:"ðŸ”’ Exclusive - Only we have access"}),e.jsx(c,{value:"LIMITED",children:"ðŸ” Limited - Small group access"}),e.jsx(c,{value:"SHARED",children:"ðŸ¤ Shared - Multiple parties access"}),e.jsx(c,{value:"OPEN",children:"ðŸŒ Open - Publicly available"})]})]})]}),e.jsx(ee,{value:i.moses_assessment.notes,onChange:n=>g({...i,moses_assessment:{...i.moses_assessment,notes:n.target.value}}),placeholder:"Assessment notes and justification...",rows:3}),e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"NATO Reliability Scale (Auto-calculated)"}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"A:"})," Completely reliable (Risk score 0-1)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"B:"})," Usually reliable (Risk score 1-2)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"C:"})," Fairly reliable (Risk score 2-3)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"D:"})," Not usually reliable (Risk score 3-4)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"E:"})," Unreliable (Risk score 4-5)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"F:"})," Cannot be judged (Manual override)"]})]})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(R,{type:"button",variant:"outline",onClick:P,disabled:N,children:"Cancel"}),e.jsx(R,{type:"submit",disabled:N,children:N?"Saving...":s?"Update Source":"Create Source"})]})]})}function Fe({source:s,onEdit:j,onDelete:P}){const N=ce(),[k,U]=x.useState("overview"),[f,i]=x.useState([]),[g,C]=x.useState(!1),[L,n]=x.useState({}),[y,b]=x.useState(!1),[w,G]=x.useState(void 0);x.useEffect(()=>{const l=async()=>{C(!0);try{const a=await fetch(`/api/relationships?entity_id=${s.id}&workspace_id=${s.workspace_id}`);if(a.ok){const v=await a.json();i(v.relationships||[]);const _=new Set;v.relationships.forEach(O=>{O.source_entity_id!==s.id&&_.add(O.source_entity_id),O.target_entity_id!==s.id&&_.add(O.target_entity_id)});const F={};for(const O of Array.from(_))F[O]=O.substring(0,8);n(F)}}catch(a){console.error("Failed to load relationships:",a)}finally{C(!1)}};s.id&&l()},[s.id,s.workspace_id]);const q=l=>{const a={PERSON:"ðŸ‘¤",DOCUMENT:"ðŸ“„",WEBSITE:"ðŸŒ",DATABASE:"ðŸ—„ï¸",MEDIA:"ðŸ“º",SYSTEM:"ðŸ’»",ORGANIZATION:"ðŸ¢",OTHER:"â“"};return a[l]||a.OTHER},D=l=>{const a={PERSON:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",DOCUMENT:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",WEBSITE:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",DATABASE:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",MEDIA:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200",SYSTEM:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200",ORGANIZATION:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",OTHER:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"};return a[l]||a.OTHER},T=l=>{const a={A:{label:"Completely Reliable",color:"green",score:100},B:{label:"Usually Reliable",color:"blue",score:83},C:{label:"Fairly Reliable",color:"yellow",score:67},D:{label:"Not Usually Reliable",color:"orange",score:50},E:{label:"Unreliable",color:"red",score:33},F:{label:"Cannot Be Judged",color:"gray",score:0}};return a[l]||a.F},A=l=>{const a={EXCLUSIVE:{label:"Exclusive Access",color:"green",score:100},LIMITED:{label:"Limited Access",color:"blue",score:75},SHARED:{label:"Shared Access",color:"yellow",score:50},OPEN:{label:"Open Access",color:"orange",score:25}};return a[l]||a.OPEN},I=l=>{const a={green:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",blue:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",yellow:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",orange:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",red:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",gray:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"};return a[l]||a.gray},m=s.moses_assessment?T(s.moses_assessment.reliability):null,E=s.moses_assessment?A(s.moses_assessment.access_level):null;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(R,{variant:"outline",onClick:()=>N("/dashboard/entities/sources"),children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Back to Sources"]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-4xl",children:q(s.type)}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(p,{className:D(s.type),children:s.type}),m&&e.jsxs(p,{className:I(m.color),children:["Reliability: ",s.moses_assessment.reliability]})]})]})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(R,{variant:"outline",onClick:()=>N("/dashboard/network-graph",{state:{highlightEntities:[s.id],source:"source",title:s.name}}),children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"View in Network"]}),e.jsxs(R,{variant:"outline",onClick:j,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(R,{variant:"destructive",onClick:P,children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),e.jsxs(Ae,{value:k,onValueChange:U,children:[e.jsxs(Oe,{className:"grid w-full grid-cols-4",children:[e.jsx(V,{value:"overview",children:"Overview"}),e.jsx(V,{value:"moses",children:"MOSES Assessment"}),e.jsx(V,{value:"evidence",children:"Linked Evidence"}),e.jsx(V,{value:"relationships",children:"Relationships"})]}),e.jsx(H,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(o,{className:"md:col-span-2",children:[e.jsx(h,{children:e.jsx(u,{children:"Basic Information"})}),e.jsxs(d,{className:"space-y-4",children:[s.description&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s.description})]}),s.source_type&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Source Type"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s.source_type})]})]})]}),e.jsxs(o,{children:[e.jsx(h,{children:e.jsx(u,{children:"Quick Stats"})}),e.jsxs(d,{className:"space-y-4",children:[m&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Reliability Grade"}),e.jsx("div",{className:"text-2xl font-bold",children:s.moses_assessment.reliability}),e.jsx("div",{className:"text-xs text-gray-600",children:m.label})]}),E&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Access Level"}),e.jsx("div",{className:"text-2xl font-bold",children:s.moses_assessment.access_level}),e.jsx("div",{className:"text-xs text-gray-600",children:E.label})]}),e.jsx(re,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Linked Evidence"}),e.jsx(p,{variant:"secondary",children:s._evidence_count||0})]}),e.jsx(re,{}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{children:["Created: ",new Date(s.created_at).toLocaleDateString()]}),e.jsxs("div",{children:["Updated: ",new Date(s.updated_at).toLocaleDateString()]})]})]})]})]})}),e.jsx(H,{value:"moses",className:"space-y-6",children:s.moses_assessment?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(o,{className:"border-l-4 border-l-blue-600",children:[e.jsxs(h,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"Source Reliability"]}),e.jsx(B,{children:"NATO intelligence standard (A-F scale)"})]}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-4xl font-bold",children:s.moses_assessment.reliability}),m&&e.jsx(p,{className:I(m.color),children:m.label})]}),m&&e.jsx($,{value:m.score,className:"h-3"})]})})]}),e.jsxs(o,{className:"border-l-4 border-l-green-600",children:[e.jsxs(h,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5"}),"Access Level"]}),e.jsx(B,{children:"Exclusive, Limited, Shared, or Open"})]}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-2xl font-bold",children:s.moses_assessment.access_level}),E&&e.jsx(p,{className:I(E.color),children:E.label})]}),E&&e.jsx($,{value:E.score,className:"h-3"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(o,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Source Vulnerability"}),e.jsx(B,{children:"Susceptibility to manipulation (0-5 scale)"})]}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-3xl font-bold",children:s.moses_assessment.source_vulnerability}),e.jsx("span",{className:"text-gray-500",children:"/5"})]}),e.jsx($,{value:s.moses_assessment.source_vulnerability/5*100,className:"h-2"})]})})]}),e.jsxs(o,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Manipulation Evidence"}),e.jsx(B,{children:"Detected manipulation indicators (0-5 scale)"})]}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-3xl font-bold",children:s.moses_assessment.manipulation_evidence}),e.jsx("span",{className:"text-gray-500",children:"/5"})]}),e.jsx($,{value:s.moses_assessment.manipulation_evidence/5*100,className:"h-2 bg-red-200"}),s.moses_assessment.manipulation_evidence>=3&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(he,{className:"h-4 w-4"}),"High manipulation detected"]})]})})]})]}),s.moses_assessment.notes&&e.jsxs(o,{children:[e.jsx(h,{children:e.jsx(u,{children:"Assessment Notes"})}),e.jsx(d,{children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400 whitespace-pre-wrap",children:s.moses_assessment.notes})})]})]}):e.jsx(o,{children:e.jsxs(d,{className:"py-12 text-center",children:[e.jsx(W,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No MOSES assessment available"}),e.jsxs(R,{onClick:j,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Add MOSES Assessment"]})]})})}),e.jsx(H,{value:"evidence",className:"space-y-6",children:e.jsx(o,{children:e.jsxs(d,{className:"py-12 text-center",children:[e.jsx(ae,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Linked evidence display coming soon"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"View all evidence items sourced from this source"})]})})}),e.jsx(H,{value:"relationships",className:"space-y-6",children:e.jsxs(o,{children:[e.jsxs(h,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"Entity Relationships"]}),e.jsx(B,{children:"Connections to other actors, events, sources, places, and evidence"})]}),e.jsx(d,{children:g?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Loading relationships..."}):e.jsx(Re,{relationships:f,entityNames:L,compact:!1,showFilters:f.length>3,onCreateNew:()=>{G(void 0),b(!0)},onEdit:l=>{G(l),b(!0)},onDelete:async l=>{if(confirm("Delete this relationship?"))try{(await fetch(`/api/relationships/${l.id}`,{method:"DELETE"})).ok?i(v=>v.filter(_=>_.id!==l.id)):alert("Failed to delete relationship")}catch(a){console.error("Failed to delete relationship:",a),alert("Failed to delete relationship")}},onNavigateToEntity:(l,a)=>{const v={ACTOR:`/dashboard/entities/actors/${l}`,SOURCE:`/dashboard/entities/sources/${l}`,EVENT:`/dashboard/entities/events/${l}`,PLACE:`/dashboard/entities/places/${l}`,BEHAVIOR:`/dashboard/entities/behaviors/${l}`,EVIDENCE:`/dashboard/entities/evidence/${l}`};N(v[a]||"/dashboard")}})})]})})]}),e.jsx(De,{entityId:s.id,entityType:"SOURCE",entityName:s.name}),e.jsx(oe,{open:y,onOpenChange:b,children:e.jsxs(de,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(xe,{children:e.jsx(me,{children:w?"Edit Relationship":"Create New Relationship"})}),e.jsx(Ie,{relationship:w,sourceEntityId:w?void 0:s.id,sourceEntityType:w?void 0:"SOURCE",workspaceId:s.workspace_id,onSubmit:async l=>{try{if(w){const a=await fetch(`/api/relationships/${w.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(a.ok){const v=await a.json();i(_=>_.map(F=>F.id===w.id?v.relationship:F)),b(!1)}else throw new Error("Failed to update relationship")}else{const a=await fetch("/api/relationships",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(a.ok){const v=await a.json();i(_=>[..._,v.relationship]),b(!1)}else throw new Error("Failed to create relationship")}}catch(a){throw console.error("Failed to save relationship:",a),a}},onCancel:()=>b(!1)})]})})]})}function Ze(){const{t:s}=Se(["entities","common"]),{id:j}=be(),P=ve(),N=ce(),[k,U]=x.useState([]),[f,i]=x.useState(null),[g,C]=x.useState(!0),[L,n]=x.useState(""),[y,b]=x.useState("all"),[w,G]=x.useState(1),[q,D]=x.useState(!1),[T,A]=x.useState(void 0),I=j&&!P.pathname.includes("/edit"),m=j&&P.pathname.includes("/edit");x.useEffect(()=>{!I&&!m&&E()},[w,y,I,m]),x.useEffect(()=>{j&&l(j)},[j]);const E=async()=>{C(!0);try{const t=new URLSearchParams({workspace_id:w.toString(),...y!=="all"&&{source_type:y}}),r=await fetch(`/api/sources?${t}`),S=await r.json();r.ok&&U(S.sources||[])}catch(t){console.error("Failed to load sources:",t)}finally{C(!1)}},l=async t=>{C(!0);try{const r=await fetch(`/api/sources/${t}`),S=await r.json();r.ok&&(i(S.source),m&&A(S.source))}catch(r){console.error("Failed to load source:",r)}finally{C(!1)}},a=async t=>{const r=await fetch("/api/sources",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,workspace_id:w})});if(r.ok)D(!1),A(void 0),E();else{const S=await r.json();throw new Error(S.error||"Failed to create source")}},v=async t=>{if(!T)return;const r=await fetch(`/api/sources/${T.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(r.ok)D(!1),A(void 0),j?(N(`/dashboard/entities/sources/${j}`),l(j)):E();else{const S=await r.json();throw new Error(S.error||"Failed to update source")}},_=async()=>{if(f&&confirm(`Are you sure you want to delete "${f.name}"?`))try{const t=await fetch(`/api/sources/${f.id}`,{method:"DELETE"});if(t.ok)N("/dashboard/entities/sources");else{const r=await t.json();alert(`Failed to delete source: ${r.error}`)}}catch(t){console.error("Failed to delete source:",t),alert("Failed to delete source")}},F=()=>{A(void 0),D(!0)},O=t=>{A(t),D(!0)},K=k.filter(t=>t.name.toLowerCase().includes(L.toLowerCase())||t.description?.toLowerCase().includes(L.toLowerCase())),ue=t=>({PERSON:"ðŸ‘¤",DOCUMENT:"ðŸ“„",WEBSITE:"ðŸŒ",DATABASE:"ðŸ—„ï¸",MEDIA:"ðŸ“¸",SYSTEM:"âš™ï¸",ORGANIZATION:"ðŸ¢",OTHER:"â“"})[t]||"â“",pe=t=>({PERSON:"bg-blue-100 text-blue-800",DOCUMENT:"bg-purple-100 text-purple-800",WEBSITE:"bg-cyan-100 text-cyan-800",DATABASE:"bg-green-100 text-green-800",MEDIA:"bg-orange-100 text-orange-800",SYSTEM:"bg-yellow-100 text-yellow-800",ORGANIZATION:"bg-pink-100 text-pink-800",OTHER:"bg-gray-100 text-gray-800"})[t]||"bg-gray-100 text-gray-800",je=t=>{const r={A:"bg-green-100 text-green-800",B:"bg-blue-100 text-blue-800",C:"bg-yellow-100 text-yellow-800",D:"bg-orange-100 text-orange-800",E:"bg-red-100 text-red-800",F:"bg-gray-100 text-gray-800"};return r[t]||r.F},ge=t=>{if(!t)return null;const r=[t.source_vulnerability,t.manipulation_evidence].filter(J=>J!==void 0);if(r.length===0)return null;const S=r.reduce((J,ye)=>J+ye,0)/r.length;return S<=1?e.jsx(p,{className:"bg-green-100 text-green-800",children:s("entities:sources.reliability.high")}):S<=2?e.jsx(p,{className:"bg-blue-100 text-blue-800",children:s("entities:sources.reliability.medium")}):S<=3.5?e.jsx(p,{className:"bg-yellow-100 text-yellow-800",children:s("entities:sources.reliability.low")}):e.jsx(p,{className:"bg-red-100 text-red-800",children:s("entities:sources.reliability.unreliable")})};return I&&f?e.jsx(Fe,{source:f,onEdit:()=>N(`/dashboard/entities/sources/${f.id}/edit`),onDelete:_}):m&&T?e.jsx("div",{className:"p-6",children:e.jsx(ne,{source:T,onSubmit:v,onCancel:()=>N(`/dashboard/entities/sources/${T.id}`)})}):g&&(I||m)?e.jsx("div",{className:"p-6",children:e.jsx(o,{children:e.jsx(d,{className:"py-12 text-center",children:e.jsx("p",{className:"text-gray-500",children:s("entities:sources.loadingSource")})})})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ie,{className:"h-8 w-8"}),s("entities:sources.title")]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:s("entities:sources.description")})]}),e.jsxs(R,{onClick:F,children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),s("entities:sources.addButton")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(o,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(u,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:s("entities:sources.stats.total")})}),e.jsx(d,{children:e.jsx("p",{className:"text-2xl font-bold",children:k.length})})]}),e.jsxs(o,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(u,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:s("entities:sources.stats.reliable")})}),e.jsx(d,{children:e.jsx("p",{className:"text-2xl font-bold text-green-600",children:k.filter(t=>t.moses_assessment?.reliability==="A"||t.moses_assessment?.reliability==="B").length})})]}),e.jsxs(o,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(u,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:s("entities:sources.stats.questionable")})}),e.jsx(d,{children:e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:k.filter(t=>t.moses_assessment?.reliability==="D"||t.moses_assessment?.reliability==="E").length})})]}),e.jsxs(o,{children:[e.jsx(h,{className:"pb-2",children:e.jsx(u,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:s("entities:sources.stats.active")})}),e.jsx(d,{children:e.jsx("p",{className:"text-2xl font-bold",children:k.filter(t=>t._evidence_count>0).length})})]})]}),e.jsx(o,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Y,{placeholder:s("entities:sources.search"),value:L,onChange:t=>n(t.target.value),className:"pl-10"})]})}),e.jsxs(Z,{value:y,onValueChange:t=>b(t),children:[e.jsx(z,{className:"w-[200px]",children:e.jsx(Q,{placeholder:s("entities:sources.filterType")})}),e.jsxs(X,{children:[e.jsx(c,{value:"all",children:s("entities:sources.types.all")}),e.jsx(c,{value:"PERSON",children:s("entities:sources.types.person")}),e.jsx(c,{value:"DOCUMENT",children:s("entities:sources.types.document")}),e.jsx(c,{value:"WEBSITE",children:s("entities:sources.types.website")}),e.jsx(c,{value:"DATABASE",children:s("entities:sources.types.database")}),e.jsx(c,{value:"MEDIA",children:s("entities:sources.types.media")}),e.jsx(c,{value:"SYSTEM",children:s("entities:sources.types.system")}),e.jsx(c,{value:"ORGANIZATION",children:s("entities:sources.types.organization")}),e.jsx(c,{value:"OTHER",children:s("entities:sources.types.other")})]})]})]})})}),g?e.jsx(o,{children:e.jsx(d,{className:"py-12 text-center",children:e.jsx("p",{className:"text-gray-500",children:s("entities:sources.loading")})})}):K.length===0?e.jsx(o,{children:e.jsxs(d,{className:"py-12 text-center",children:[e.jsx(ie,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:s("entities:sources.empty")}),e.jsxs(R,{className:"mt-4",onClick:F,children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),s("entities:sources.addFirst")]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:K.map(t=>e.jsxs(o,{className:"hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>O(t),children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:ue(t.type)}),e.jsxs("div",{children:[e.jsx(u,{className:"text-lg",children:t.name}),e.jsx(p,{className:`mt-1 ${pe(t.type)}`,children:t.type})]})]}),t.moses_assessment?.reliability&&e.jsx(p,{className:je(t.moses_assessment.reliability),children:t.moses_assessment.reliability})]})}),e.jsxs(d,{className:"space-y-3",children:[t.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2",children:t.description}),t.moses_assessment?.access_level&&e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(Te,{className:"h-3 w-3 text-gray-500"}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[s("entities:sources.access")," ",t.moses_assessment.access_level]})]}),t.moses_assessment&&e.jsx("div",{className:"pt-2 border-t space-y-1",children:e.jsxs("div",{className:"text-xs font-semibold flex items-center gap-1 text-gray-700 dark:text-gray-300 justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"h-3 w-3"}),s("entities:sources.mosesAssessment")]}),ge(t.moses_assessment)]})}),t._evidence_count!==void 0&&e.jsx("div",{className:"pt-2 border-t text-xs text-gray-500",children:e.jsxs("span",{children:[t._evidence_count," ",s("entities:sources.evidenceCount")]})})]})]},t.id))}),e.jsx(oe,{open:q,onOpenChange:t=>{D(t),t||A(void 0)},children:e.jsxs(de,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(xe,{children:e.jsx(me,{children:s(T?"entities:sources.dialog.edit":"entities:sources.dialog.create")})}),e.jsx(ne,{source:T,onSubmit:T?v:a,onCancel:()=>{D(!1),A(void 0)}})]})})]})}export{Ze as SourcesPage};
