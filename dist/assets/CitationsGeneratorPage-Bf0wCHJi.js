import{j as e}from"./ui-vendor-DBphXmDA.js";import{r as a,f as Ye}from"./react-vendor-CfYLSWvh.js";import{y as i,I as o,q as Le,S as T,z as k,C as F,E,F as n,B as m,u as Xe}from"./index-DGGXJgUa.js";import{C as de,d as he,a as Se,b as we,c as Pe}from"./card-BQo7RV_Z.js";import{T as Ke,a as Ze,b as fe}from"./tabs-Dznm0vhG.js";import{a as Ie,f as Qe,s as es,g as ss,d as as,u as ts,c as ls,e as Oe,h as is,i as rs,j as ns,k as cs,l as os,b as ds}from"./citation-library-DsFrzEV3.js";import{a as ae,E as De,C as be,P as Ce}from"./evidence-CClaHnJf.js";import{X as Je,h as xe,q as me,W as Me,d as hs,a as xs,aZ as _e,a_ as Ue,$ as ms,a$ as us,P as Te,a1 as oe,A as js,_ as vs,ay as gs,L as Ve,G as Be,r as ps}from"./icons-x9tcvtYN.js";import"./state-vendor-BXB5jEEt.js";function Ns({citation:d,onClose:l,onSuccess:b}){const[g,f]=a.useState(!1),[t,u]=a.useState({title:d.fields.title||"",what:"",who:d.fields.authors.map(h=>`${h.firstName} ${h.lastName}`).join(", "),when_occurred:d.fields.year||"",where_location:d.fields.url||"",evidence_type:"official_document",evidence_level:"tactical",credibility:"3",reliability:"3",confidence_level:"medium",tags:d.tags||[],priority:"normal",notes:d.notes||""}),j=async h=>{if(h.preventDefault(),!t.what.trim()){alert("Please enter a claim (What field)");return}f(!0);try{const N=await fetch("/api/evidence-items",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t.title,description:`Citation: ${d.citation}`,who:t.who,what:t.what,when_occurred:t.when_occurred,where_location:t.where_location,evidence_type:t.evidence_type,evidence_level:t.evidence_level,credibility:t.credibility,reliability:t.reliability,confidence_level:t.confidence_level,tags:t.tags,priority:t.priority,status:"pending",is_public:!1,created_by:1})});if(N.ok){const A=await N.json();alert(`Evidence created successfully! ID: ${A.id}`),b?.(),l()}else{const A=await N.json();throw new Error(A.error||"Failed to create evidence")}}catch(N){console.error("Failed to create evidence:",N),alert(`Failed to create evidence: ${N.message}`)}finally{f(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Create Evidence from Citation"}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(Je,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(i,{className:"text-xs font-semibold text-gray-600 dark:text-gray-400",children:"Source Citation"}),e.jsx("p",{className:"text-sm mt-1 text-gray-900 dark:text-white",children:d.citation})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"title",children:"Title"}),e.jsx(o,{id:"title",value:t.title,onChange:h=>u({...t,title:h.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"what",className:"flex items-center gap-2",children:["Claim / What ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Le,{id:"what",placeholder:"Enter the claim or assertion this evidence supports...",value:t.what,onChange:h=>u({...t,what:h.target.value}),className:"min-h-24",required:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"What does this source claim or assert?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"who",children:"Who (Author/Entity)"}),e.jsx(o,{id:"who",value:t.who,onChange:h=>u({...t,who:h.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"type",children:"Evidence Type"}),e.jsxs(T,{value:t.evidence_type,onValueChange:h=>u({...t,evidence_type:h}),children:[e.jsx(k,{id:"type",children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(n,{value:ae.OFFICIAL_DOCUMENT,children:"Official Document"}),e.jsx(n,{value:ae.NEWS_ARTICLE,children:"News Article"}),e.jsx(n,{value:ae.REPORT,children:"Report"}),e.jsx(n,{value:ae.BLOG_POST,children:"Blog Post"}),e.jsx(n,{value:ae.EYEWITNESS,children:"Eyewitness"}),e.jsx(n,{value:ae.TESTIMONY,children:"Testimony"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"level",children:"Evidence Level"}),e.jsxs(T,{value:t.evidence_level,onValueChange:h=>u({...t,evidence_level:h}),children:[e.jsx(k,{id:"level",children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(n,{value:De.TACTICAL,children:"Tactical"}),e.jsx(n,{value:De.OPERATIONAL,children:"Operational"}),e.jsx(n,{value:De.STRATEGIC,children:"Strategic"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"confidence",children:"Confidence Level"}),e.jsxs(T,{value:t.confidence_level,onValueChange:h=>u({...t,confidence_level:h}),children:[e.jsx(k,{id:"confidence",children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(n,{value:be.LOW,children:"Low"}),e.jsx(n,{value:be.MEDIUM,children:"Medium"}),e.jsx(n,{value:be.HIGH,children:"High"}),e.jsx(n,{value:be.CONFIRMED,children:"Confirmed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"priority",children:"Priority"}),e.jsxs(T,{value:t.priority,onValueChange:h=>u({...t,priority:h}),children:[e.jsx(k,{id:"priority",children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(n,{value:Ce.LOW,children:"Low"}),e.jsx(n,{value:Ce.NORMAL,children:"Normal"}),e.jsx(n,{value:Ce.HIGH,children:"High"}),e.jsx(n,{value:Ce.CRITICAL,children:"Critical"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"credibility",children:"Credibility (1-6)"}),e.jsxs(T,{value:t.credibility,onValueChange:h=>u({...t,credibility:h}),children:[e.jsx(k,{id:"credibility",children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(n,{value:"1",children:"1 - Confirmed Reliable"}),e.jsx(n,{value:"2",children:"2 - Usually Reliable"}),e.jsx(n,{value:"3",children:"3 - Fairly Reliable"}),e.jsx(n,{value:"4",children:"4 - Not Usually Reliable"}),e.jsx(n,{value:"5",children:"5 - Unreliable"}),e.jsx(n,{value:"6",children:"6 - Cannot be Judged"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"reliability",children:"Reliability (1-6)"}),e.jsxs(T,{value:t.reliability,onValueChange:h=>u({...t,reliability:h}),children:[e.jsx(k,{id:"reliability",children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(n,{value:"1",children:"1 - Confirmed"}),e.jsx(n,{value:"2",children:"2 - Probably True"}),e.jsx(n,{value:"3",children:"3 - Possibly True"}),e.jsx(n,{value:"4",children:"4 - Doubtful"}),e.jsx(n,{value:"5",children:"5 - Improbable"}),e.jsx(n,{value:"6",children:"6 - Cannot be Judged"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"notes",children:"Notes (Optional)"}),e.jsx(Le,{id:"notes",placeholder:"Additional notes about this evidence...",value:t.notes,onChange:h=>u({...t,notes:h.target.value}),className:"min-h-20"})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx(m,{type:"button",variant:"outline",onClick:l,disabled:g,className:"flex-1",children:"Cancel"}),e.jsx(m,{type:"submit",disabled:g||!t.what.trim(),className:"flex-1",children:g?"Creating...":"Create Evidence"})]})]})]})})}function ys({citation:d,onSave:l,onCancel:b}){const[g,f]=a.useState(d.citationStyle),[t,u]=a.useState(d.sourceType),[j,h]=a.useState(d.fields.authors||[{firstName:"",lastName:"",middleName:""}]),[N,A]=a.useState(d.fields.title||""),[O,q]=a.useState(d.fields.year||""),[G,te]=a.useState(d.fields.month||""),[$,_]=a.useState(d.fields.day||""),[D,H]=a.useState(d.fields.url||""),[R,U]=a.useState(d.fields.siteName||""),[C,Q]=a.useState(d.fields.accessDate||""),[V,S]=a.useState(d.fields.publisher||""),[B,le]=a.useState(d.fields.edition||""),[L,ee]=a.useState(d.fields.place||""),[J,ie]=a.useState(d.fields.isbn||""),[M,P]=a.useState(d.fields.journalTitle||""),[r,v]=a.useState(d.fields.volume||""),[y,I]=a.useState(d.fields.issue||""),[Y,X]=a.useState(d.fields.pages||""),[W,ke]=a.useState(d.fields.doi||""),[ue,Fe]=a.useState(d.fields.institution||""),[je,Ee]=a.useState(d.fields.reportNumber||""),[ve,Ae]=a.useState(d.fields.publication||""),ge=()=>{h([...j,{firstName:"",lastName:"",middleName:""}])},pe=c=>{j.length>1&&h(j.filter((z,w)=>w!==c))},re=(c,z,w)=>{const se=[...j];se[c]={...se[c],[z]:w},h(se)},ne=()=>({authors:j,title:N,year:O,month:G,day:$,url:D,siteName:R,accessDate:C,publisher:V,edition:B,place:L,isbn:J,journalTitle:M,volume:r,issue:y,pages:Y,doi:W,institution:ue,reportNumber:je,publication:ve}),{citation:ce,inTextCitation:Ne}=Ie(ne(),t,g),K=()=>{if(!N.trim()){alert("Please enter a title");return}if(j.length===0||!j[0].lastName.trim()){alert("Please enter at least one author");return}const c={...d,citationStyle:g,sourceType:t,fields:ne(),citation:ce,inTextCitation:Ne};l(c)};return e.jsxs("div",{className:"p-4 border-l-4 border-blue-500 bg-blue-50 dark:bg-blue-900/20 rounded-r-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100",children:"Editing Citation"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{size:"sm",variant:"ghost",onClick:b,children:[e.jsx(Je,{className:"h-4 w-4 mr-1"}),"Cancel"]}),e.jsxs(m,{size:"sm",onClick:K,children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"Save"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"edit-style",className:"text-xs",children:"Citation Style"}),e.jsxs(T,{value:g,onValueChange:c=>f(c),children:[e.jsx(k,{id:"edit-style",className:"h-8",children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(n,{value:"apa",children:"APA 7th"}),e.jsx(n,{value:"mla",children:"MLA 9th"}),e.jsx(n,{value:"chicago",children:"Chicago 17th"}),e.jsx(n,{value:"harvard",children:"Harvard"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"edit-type",className:"text-xs",children:"Source Type"}),e.jsxs(T,{value:t,onValueChange:c=>u(c),children:[e.jsx(k,{id:"edit-type",className:"h-8",children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(n,{value:"website",children:"Website"}),e.jsx(n,{value:"book",children:"Book"}),e.jsx(n,{value:"journal",children:"Journal Article"}),e.jsx(n,{value:"report",children:"Report"}),e.jsx(n,{value:"news",children:"News Article"})]})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"edit-title",className:"text-xs",children:"Title *"}),e.jsx(o,{id:"edit-title",value:N,onChange:c=>A(c.target.value),className:"h-8",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-xs",children:"Authors *"}),j.map((c,z)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{placeholder:"First",value:c.firstName,onChange:w=>re(z,"firstName",w.target.value),className:"h-8"}),e.jsx(o,{placeholder:"Last",value:c.lastName,onChange:w=>re(z,"lastName",w.target.value),className:"h-8",required:!0}),e.jsx(m,{type:"button",variant:"ghost",size:"sm",onClick:()=>pe(z),disabled:j.length===1,children:e.jsx(me,{className:"h-4 w-4"})})]},z)),e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:ge,children:[e.jsx(Me,{className:"h-4 w-4 mr-1"}),"Add Author"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"edit-year",className:"text-xs",children:"Year"}),e.jsx(o,{id:"edit-year",placeholder:"2024",value:O,onChange:c=>q(c.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"edit-month",className:"text-xs",children:"Month"}),e.jsx(o,{id:"edit-month",placeholder:"January",value:G,onChange:c=>te(c.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"edit-day",className:"text-xs",children:"Day"}),e.jsx(o,{id:"edit-day",placeholder:"15",value:$,onChange:c=>_(c.target.value),className:"h-8"})]})]}),t==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"edit-url",className:"text-xs",children:"URL"}),e.jsx(o,{id:"edit-url",type:"url",value:D,onChange:c=>H(c.target.value),className:"h-8"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"edit-siteName",className:"text-xs",children:"Website Name"}),e.jsx(o,{id:"edit-siteName",value:R,onChange:c=>U(c.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"edit-accessDate",className:"text-xs",children:"Access Date"}),e.jsx(o,{id:"edit-accessDate",type:"date",value:C,onChange:c=>Q(c.target.value),className:"h-8"})]})]})]}),t==="book"&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"edit-publisher",className:"text-xs",children:"Publisher"}),e.jsx(o,{id:"edit-publisher",value:V,onChange:c=>S(c.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"edit-place",className:"text-xs",children:"Place"}),e.jsx(o,{id:"edit-place",value:L,onChange:c=>ee(c.target.value),className:"h-8"})]})]}),t==="journal"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"edit-journal",className:"text-xs",children:"Journal Title"}),e.jsx(o,{id:"edit-journal",value:M,onChange:c=>P(c.target.value),className:"h-8"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"edit-volume",className:"text-xs",children:"Volume"}),e.jsx(o,{id:"edit-volume",value:r,onChange:c=>v(c.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"edit-issue",className:"text-xs",children:"Issue"}),e.jsx(o,{id:"edit-issue",value:y,onChange:c=>I(c.target.value),className:"h-8"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"edit-pages",className:"text-xs",children:"Pages"}),e.jsx(o,{id:"edit-pages",placeholder:"1-10",value:Y,onChange:c=>X(c.target.value),className:"h-8"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{className:"text-xs font-semibold",children:"Preview"}),e.jsx("div",{className:"p-3 bg-white dark:bg-gray-800 border rounded-md text-sm",children:ce})]})]})}function fs({onRefresh:d}){const[l,b]=a.useState([]),[g,f]=a.useState([]),[t,u]=a.useState(new Set),[j,h]=a.useState(""),[N,A]=a.useState("date"),[O,q]=a.useState("desc"),[G,te]=a.useState("apa"),[$,_]=a.useState(!1),[D,H]=a.useState(null),[R,U]=a.useState(null),C=()=>{const r=ss();b(r.citations)};a.useEffect(()=>{C()},[]),a.useEffect(()=>{let r=Qe(l,j);r=es(r,N,O),r=r.map(v=>{const{citation:y,inTextCitation:I}=Ie(v.fields,v.sourceType,G);return{...v,citation:y,inTextCitation:I,citationStyle:G}}),f(r)},[l,j,N,O,G]);const Q=r=>{confirm("Delete this citation?")&&(ls(r),C(),d?.())},V=()=>{t.size!==0&&confirm(`Delete ${t.size} selected citation(s)?`)&&(as(Array.from(t)),u(new Set),C(),d?.())},S=()=>{confirm("Clear entire library? This cannot be undone.")&&(cs(),C(),d?.())},B=r=>{const v=new Set(t);v.has(r)?v.delete(r):v.add(r),u(v)},le=()=>{t.size===g.length?u(new Set):u(new Set(g.map(r=>r.id)))},L=async r=>{try{await navigator.clipboard.writeText(r),_(!0),setTimeout(()=>_(!1),2e3)}catch(v){console.error("Failed to copy:",v)}},ee=r=>{U(r.id)},J=r=>{ts(r.id,r),U(null),C(),d?.()},ie=()=>{U(null)},M=()=>{const r=Oe(g);L(r)},P=r=>{let v="",y=`bibliography-${Date.now()}`,I="text/plain";switch(r){case"txt":v=Oe(g),y+=".txt";break;case"bibtex":v=ns(g),y+=".bib";break;case"ris":v=rs(g),y+=".ris";break;case"csv":v=is(g),y+=".csv",I="text/csv";break;case"json":v=JSON.stringify(g,null,2),y+=".json",I="application/json";break}const Y=new Blob([v],{type:I}),X=URL.createObjectURL(Y),W=document.createElement("a");W.href=X,W.download=y,W.click(),URL.revokeObjectURL(X)};return l.length===0?e.jsx(de,{children:e.jsxs(he,{className:"py-12 text-center",children:[e.jsx(hs,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No citations yet"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Create citations above and they will be saved to your library automatically"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(de,{children:[e.jsx(Se,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(we,{children:"Citation Library"}),e.jsxs(Pe,{children:[g.length," citation(s) ",j&&`matching "${j}"`]})]})})}),e.jsxs(he,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"search",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(xs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(o,{id:"search",placeholder:"Search citations...",value:j,onChange:r=>h(r.target.value),className:"pl-9"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"sort",children:"Sort By"}),e.jsxs(T,{value:N,onValueChange:r=>A(r),children:[e.jsx(k,{id:"sort",children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(n,{value:"date",children:"Date Added"}),e.jsx(n,{value:"author",children:"Author"}),e.jsx(n,{value:"title",children:"Title"}),e.jsx(n,{value:"type",children:"Source Type"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"style",children:"Citation Style"}),e.jsxs(T,{value:G,onValueChange:r=>te(r),children:[e.jsx(k,{id:"style",children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(n,{value:"apa",children:"APA 7th"}),e.jsx(n,{value:"mla",children:"MLA 9th"}),e.jsx(n,{value:"chicago",children:"Chicago 17th"}),e.jsx(n,{value:"harvard",children:"Harvard"})]})]})]})]}),g.length>0&&e.jsxs("div",{className:"flex items-center justify-between py-2 border-b dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:le,children:[t.size===g.length?e.jsx(_e,{className:"h-4 w-4"}):e.jsx(Ue,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-2",children:t.size===g.length?"Deselect All":"Select All"})]}),t.size>0&&e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t.size," selected"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:t.size>0&&e.jsxs(m,{variant:"outline",size:"sm",onClick:V,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Delete Selected"]})})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:g.map((r,v)=>e.jsx("div",{children:R===r.id?e.jsx(ys,{citation:r,onSave:J,onCancel:ie}):e.jsx("div",{className:"p-4 border rounded-lg dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:()=>B(r.id),className:"mt-1 flex-shrink-0",children:t.has(r.id)?e.jsx(_e,{className:"h-5 w-5 text-blue-600"}):e.jsx(Ue,{className:"h-5 w-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between gap-2 mb-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:[v+1,"."]})}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white whitespace-pre-wrap",children:r.citation}),r.notes&&e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2 italic",children:["Notes: ",r.notes]}),r.tags&&r.tags.length>0&&e.jsx("div",{className:"flex gap-1 mt-2",children:r.tags.map(y=>e.jsx("span",{className:"text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded",children:y},y))})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>ee(r),title:"Edit Citation",children:e.jsx(ms,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>H(r),title:"Add as Evidence",children:e.jsx(us,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>L(r.citation),title:"Copy Citation",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>Q(r.id),title:"Delete Citation",children:e.jsx(me,{className:"h-4 w-4"})})]})]})})},r.id))}),e.jsxs("div",{className:"space-y-3 pt-4 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:M,children:$?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Copy All"]})}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>P("txt"),children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Export TXT"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>P("bibtex"),children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"BibTeX"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>P("ris"),children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"RIS"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>P("csv"),children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>P("json"),children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Export JSON"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>alert("Save as dataset coming soon!"),children:[e.jsx(js,{className:"h-4 w-4 mr-2"}),"Save as Dataset"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:S,disabled:l.length===0,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Clear Library"]})]})]})]})]}),D&&e.jsx(Ns,{citation:D,onClose:()=>H(null),onSuccess:()=>{alert("Evidence created successfully! You can view it in the Evidence Collector.")}})]})}function Gs(){const d=Ye(),{t:l}=Xe(),[b,g]=a.useState("apa"),[f,t]=a.useState("website"),[u,j]=a.useState([{firstName:"",lastName:"",middleName:""}]),[h,N]=a.useState(!1),[A,O]=a.useState(!1),[q,G]=a.useState(!1),[te,$]=a.useState(0),[_,D]=a.useState(""),[H,R]=a.useState(""),[U,C]=a.useState(""),[Q,V]=a.useState(""),[S,B]=a.useState(""),[le,L]=a.useState(""),[ee,J]=a.useState(""),[ie,M]=a.useState(""),[P,r]=a.useState(""),[v,y]=a.useState(""),[I,Y]=a.useState(""),[X,W]=a.useState(""),[ke,ue]=a.useState(""),[Fe,je]=a.useState(""),[Ee,ve]=a.useState(""),[Ae,ge]=a.useState(""),[pe,re]=a.useState(""),[ne,ce]=a.useState(""),[Ne,K]=a.useState("");a.useEffect(()=>{const s=new URLSearchParams(window.location.search);s.has("sourceType")&&t(s.get("sourceType")),s.has("title")&&D(s.get("title")),s.has("url")&&B(s.get("url")),s.has("siteName")&&L(s.get("siteName")),s.has("year")&&R(s.get("year")),s.has("month")&&C(s.get("month")),s.has("day")&&V(s.get("day")),s.has("accessDate")&&J(s.get("accessDate")),s.has("publication")&&K(s.get("publication")),s.has("publisher")&&M(s.get("publisher"));const x=s.get("firstName"),p=s.get("lastName"),Z=s.get("middleName");(x||p)&&j([{firstName:x||"",lastName:p||"",middleName:Z||""}])},[]);const c=()=>{j([...u,{firstName:"",lastName:"",middleName:""}])},z=s=>{u.length>1&&j(u.filter((x,p)=>p!==s))},w=(s,x,p)=>{const Z=[...u];Z[s]={...Z[s],[x]:p},j(Z)},se=()=>({authors:u,title:_,year:H,month:U,day:Q,url:S,siteName:le,accessDate:ee,publisher:ie,edition:P,place:v,isbn:I,journalTitle:X,volume:ke,issue:Fe,pages:Ee,doi:Ae,institution:pe,reportNumber:ne,publication:Ne}),{citation:Ge,inTextCitation:ye}=Ie(se(),f,b),Re=async s=>{try{await navigator.clipboard.writeText(s),N(!0),setTimeout(()=>N(!1),2e3)}catch(x){console.error("Failed to copy:",x)}},We=()=>{if(!_.trim()){alert(l("citationsGeneratorTool.titleRequired"));return}if(u.length===0||!u[0].lastName.trim()){alert(l("citationsGeneratorTool.authorRequired"));return}const s={id:os(),citationStyle:b,sourceType:f,fields:se(),citation:Ge,inTextCitation:ye,addedAt:new Date().toISOString()};ds(s),O(!0),$(x=>x+1),setTimeout(()=>O(!1),2e3)},ze=async()=>{if(!S.trim()){alert(l("citationsGeneratorTool.urlRequired"));return}G(!0);try{const s=await fetch("/api/tools/scrape-metadata",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:S})});if(!s.ok)throw new Error("Failed to scrape URL");const x=await s.json();if(x.title&&D(x.title),x.siteName&&L(x.siteName),x.date&&R(x.date),x.accessDate&&J(x.accessDate),x.author){const p=x.author.trim().split(/\s+/);if(p.length>=2){const Z=p[0],$e=p[p.length-1],He=p.length>2?p.slice(1,-1).join(" "):"";j([{firstName:Z,lastName:$e,middleName:He}])}else j([{firstName:"",lastName:x.author,middleName:""}])}f==="news"&&(x.publication?K(x.publication):x.siteName&&K(x.siteName))}catch(s){console.error("Scraping error:",s),alert("Failed to scrape URL. Please check the URL and try again.")}finally{G(!1)}},qe=()=>{j([{firstName:"",lastName:"",middleName:""}]),D(""),R(""),C(""),V(""),B(""),L(""),J(""),M(""),r(""),y(""),Y(""),W(""),ue(""),je(""),ve(""),ge(""),re(""),ce(""),K("")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(m,{variant:"outline",onClick:()=>d("/dashboard/tools"),children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),l("citationsGeneratorTool.backToTools")]}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(gs,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l("citationsGeneratorTool.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:l("citationsGeneratorTool.subtitle")})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(de,{children:[e.jsxs(Se,{children:[e.jsx(we,{children:l("citationsGeneratorTool.citationStyle")}),e.jsx(Pe,{children:l("citationsGeneratorTool.citationStyleDesc")})]}),e.jsx(he,{children:e.jsx(Ke,{value:b,onValueChange:s=>g(s),children:e.jsxs(Ze,{className:"grid w-full grid-cols-4",children:[e.jsx(fe,{value:"apa",children:l("citationsGeneratorTool.apa")}),e.jsx(fe,{value:"mla",children:l("citationsGeneratorTool.mla")}),e.jsx(fe,{value:"chicago",children:l("citationsGeneratorTool.chicago")}),e.jsx(fe,{value:"harvard",children:l("citationsGeneratorTool.harvard")})]})})})]}),e.jsxs(de,{children:[e.jsx(Se,{children:e.jsx(we,{children:l("citationsGeneratorTool.sourceInformation")})}),e.jsxs(he,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:l("citationsGeneratorTool.sourceType")}),e.jsxs(T,{value:f,onValueChange:s=>t(s),children:[e.jsx(k,{children:e.jsx(F,{})}),e.jsxs(E,{children:[e.jsx(n,{value:"website",children:l("citationsGeneratorTool.website")}),e.jsx(n,{value:"book",children:l("citationsGeneratorTool.book")}),e.jsx(n,{value:"journal",children:l("citationsGeneratorTool.journal")}),e.jsx(n,{value:"report",children:l("citationsGeneratorTool.report")}),e.jsx(n,{value:"news",children:l("citationsGeneratorTool.news")})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:l("citationsGeneratorTool.authors")}),u.map((s,x)=>e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(o,{placeholder:l("citationsGeneratorTool.firstName"),value:s.firstName,onChange:p=>w(x,"firstName",p.target.value),className:"flex-1"}),e.jsx(o,{placeholder:l("citationsGeneratorTool.middleOptional"),value:s.middleName,onChange:p=>w(x,"middleName",p.target.value),className:"flex-1"}),e.jsx(o,{placeholder:l("citationsGeneratorTool.lastName"),value:s.lastName,onChange:p=>w(x,"lastName",p.target.value),className:"flex-1"}),u.length>1&&e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>z(x),children:e.jsx(me,{className:"h-4 w-4"})})]},x)),e.jsxs(m,{variant:"outline",size:"sm",onClick:c,className:"mt-2",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),l("citationsGeneratorTool.addAuthor")]})]}),e.jsxs("div",{children:[e.jsx(i,{children:l("citationsGeneratorTool.title")}),e.jsx(o,{value:_,onChange:s=>D(s.target.value),placeholder:l("citationsGeneratorTool.enterTitle")})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx(i,{children:l("citationsGeneratorTool.year")}),e.jsx(o,{value:H,onChange:s=>R(s.target.value),placeholder:"2025"})]}),e.jsxs("div",{children:[e.jsx(i,{children:l("citationsGeneratorTool.monthOptional")}),e.jsx(o,{value:U,onChange:s=>C(s.target.value),placeholder:"01"})]}),e.jsxs("div",{children:[e.jsx(i,{children:l("citationsGeneratorTool.dayOptional")}),e.jsx(o,{value:Q,onChange:s=>V(s.target.value),placeholder:"15"})]})]}),f==="website"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(i,{children:"Website Name"}),e.jsx(o,{value:le,onChange:s=>L(s.target.value),placeholder:"Example Website"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{value:S,onChange:s=>B(s.target.value),placeholder:"https://example.com",className:"flex-1"}),e.jsx(m,{type:"button",variant:"outline",onClick:ze,disabled:q||!S.trim(),children:q?e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"h-4 w-4 mr-2 animate-spin"}),"Scraping..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Auto-Fill"]})})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Enter a URL and click Auto-Fill to extract metadata"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Access Date (optional)"}),e.jsx(o,{value:ee,onChange:s=>J(s.target.value),placeholder:"October 2, 2025"})]})]}),f==="book"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(i,{children:"Publisher"}),e.jsx(o,{value:ie,onChange:s=>M(s.target.value),placeholder:"Publisher Name"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Place of Publication"}),e.jsx(o,{value:v,onChange:s=>y(s.target.value),placeholder:"New York"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Edition (optional)"}),e.jsx(o,{value:P,onChange:s=>r(s.target.value),placeholder:"2nd ed."})]}),e.jsxs("div",{children:[e.jsx(i,{children:"ISBN (optional)"}),e.jsx(o,{value:I,onChange:s=>Y(s.target.value),placeholder:"978-0-123456-78-9"})]})]}),f==="journal"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(i,{children:"Journal Title"}),e.jsx(o,{value:X,onChange:s=>W(s.target.value),placeholder:"Journal of Example Studies"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Volume"}),e.jsx(o,{value:ke,onChange:s=>ue(s.target.value),placeholder:"12"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Issue (optional)"}),e.jsx(o,{value:Fe,onChange:s=>je(s.target.value),placeholder:"3"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Pages"}),e.jsx(o,{value:Ee,onChange:s=>ve(s.target.value),placeholder:"45-67"})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"DOI (optional)"}),e.jsx(o,{value:Ae,onChange:s=>ge(s.target.value),placeholder:"10.1234/example.2025.001"})]})]}),f==="report"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(i,{children:"Institution"}),e.jsx(o,{value:pe,onChange:s=>re(s.target.value),placeholder:"Research Institute"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Report Number (optional)"}),e.jsx(o,{value:ne,onChange:s=>ce(s.target.value),placeholder:"Report No. 2025-01"})]})]}),f==="news"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(i,{children:"Publication"}),e.jsx(o,{value:Ne,onChange:s=>K(s.target.value),placeholder:"The Example Times"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"URL (optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{value:S,onChange:s=>B(s.target.value),placeholder:"https://example.com/article",className:"flex-1"}),e.jsx(m,{type:"button",variant:"outline",onClick:ze,disabled:q||!S.trim(),children:q?e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"h-4 w-4 mr-2 animate-spin"}),"Scraping..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Auto-Fill"]})})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Click Auto-Fill to extract article metadata"})]})]}),e.jsx("div",{className:"flex gap-2 pt-4",children:e.jsx(m,{variant:"outline",onClick:qe,className:"flex-1",children:l("citationsGeneratorTool.clearForm")})})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(de,{children:[e.jsxs(Se,{children:[e.jsx(we,{children:l("citationsGeneratorTool.citationPreview")}),e.jsx(Pe,{children:l("citationsGeneratorTool.citationPreviewDesc")})]}),e.jsxs(he,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{className:"text-xs text-gray-600 dark:text-gray-400",children:l("citationsGeneratorTool.fullCitation")}),e.jsx(Le,{value:Ge,readOnly:!0,className:"min-h-[120px] font-serif text-sm mt-2"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>Re(Ge),children:[h?e.jsx(xe,{className:"h-4 w-4 mr-2"}):e.jsx(Te,{className:"h-4 w-4 mr-2"}),l(h?"citationsGeneratorTool.copied":"citationsGeneratorTool.copy")]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:We,children:[A?e.jsx(xe,{className:"h-4 w-4 mr-2"}):e.jsx(ps,{className:"h-4 w-4 mr-2"}),l(A?"citationsGeneratorTool.saved":"citationsGeneratorTool.save")]})]})]}),ye&&e.jsxs("div",{children:[e.jsx(i,{className:"text-xs text-gray-600 dark:text-gray-400",children:l("citationsGeneratorTool.inTextCitation")}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 mt-2",children:e.jsx("p",{className:"font-mono text-sm",children:ye})}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>Re(ye),className:"mt-2 w-full",children:[h?e.jsx(xe,{className:"h-4 w-4 mr-2"}):e.jsx(Te,{className:"h-4 w-4 mr-2"}),l("citationsGeneratorTool.copyInText")]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsxs("h4",{className:"text-sm font-semibold text-blue-900 dark:text-blue-300 mb-2",children:[b.toUpperCase()," ",l("citationsGeneratorTool.format")]}),e.jsxs("p",{className:"text-xs text-blue-800 dark:text-blue-400",children:[b==="apa"&&l("citationsGeneratorTool.apaFull"),b==="mla"&&l("citationsGeneratorTool.mlaFull"),b==="chicago"&&l("citationsGeneratorTool.chicagoFull"),b==="harvard"&&l("citationsGeneratorTool.harvardFull")]})]})]})]})})]}),e.jsx(fs,{onRefresh:()=>$(s=>s+1)},te)]})}export{Gs as CitationsGeneratorPage};
