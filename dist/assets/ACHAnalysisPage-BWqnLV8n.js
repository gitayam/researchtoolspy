const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pptxgen.es-BxyxNDcn.js","assets/index-DGGXJgUa.js","assets/ui-vendor-DBphXmDA.js","assets/react-vendor-CfYLSWvh.js","assets/state-vendor-BXB5jEEt.js","assets/icons-x9tcvtYN.js","assets/index-BFp3doI9.css","assets/_commonjs-dynamic-modules-TDtrdbi3.js","assets/exceljs.min-RL4gfToV.js"])))=>i.map(i=>d[i]);
import{j as e}from"./ui-vendor-DBphXmDA.js";import{r as H,k as me,f as fe}from"./react-vendor-CfYLSWvh.js";import{d as ue,D as pe,g as xe,B as V,h as ge,i as Fe,j as le,k as Z,y as ie,S as ve,z as we,C as Se,E as be,F as Ce,I as ce,e as Q,t as X,_ as ye}from"./index-DGGXJgUa.js";import{C as q,d as J,a as oe,b as ne}from"./card-BQo7RV_Z.js";import{A as Te}from"./ACHMatrix-DYpuOWoE.js";import{A as Ee}from"./ACHAnalysisForm-CfoWoIzM.js";import{S as Ne}from"./switch-8HGucaUr.js";import{G as je,n as ke,ad as Ae,h as Ie,P as ze,C as Re,V as Le,x as He,L as re,d as Oe,a3 as _e,a4 as $e,_ as de,N as De,a1 as Pe,$ as Me,t as Ye,br as Ge,ai as Be}from"./icons-x9tcvtYN.js";import{P as he}from"./progress-D6O6TLpv.js";import{E as Ve,a as Ue,F as Ke}from"./FileSaver.min-BmrbPijQ.js";import"./state-vendor-BXB5jEEt.js";import"./EvidenceItemForm-DLuun9hp.js";import"./slider-oUJ8z5Zt.js";import"./evidence-CClaHnJf.js";const We=[{value:"intelligence",label:"Research Analysis"},{value:"security",label:"Security & Law Enforcement"},{value:"business",label:"Business Strategy"},{value:"research",label:"Scientific Research"},{value:"medical",label:"Medical Diagnosis"},{value:"legal",label:"Legal Analysis"},{value:"other",label:"Other"}];function qe({analysisId:n,isPublic:E,shareToken:d,domain:T,tags:N,onUpdate:w}){const{toast:p}=ue(),[g,t]=H.useState(E),[u,h]=H.useState(d),[f,z]=H.useState(T||""),[v,r]=H.useState(N&&Array.isArray(N)?N:[]),[s,i]=H.useState(""),[b,o]=H.useState(!1),[y,R]=H.useState(!1),[S,P]=H.useState(!1),D=u?`${window.location.origin}/public/ach/${u}`:null,G=async m=>{R(!0);try{const k=await fetch(`/api/ach/${n}/share`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_public:m,domain:f,tags:v})});if(!k.ok)throw new Error("Failed to update sharing settings");const I=await k.json();t(I.is_public),h(I.share_token),w&&w({isPublic:I.is_public,shareToken:I.share_token,domain:I.domain,tags:I.tags})}catch(k){console.error("Failed to toggle sharing:",k),alert("Failed to update sharing settings")}finally{R(!1)}},c=async m=>{if(z(m),g)try{await fetch(`/api/ach/${n}/share`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_public:!0,domain:m,tags:v})}),w&&w({isPublic:g,shareToken:u,domain:m,tags:v})}catch(k){console.error("Failed to update domain:",k)}},O=()=>{if(s.trim()&&!v.includes(s.trim())){const m=[...v,s.trim()];r(m),i(""),g&&fetch(`/api/ach/${n}/share`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_public:!0,domain:f,tags:m})}).then(()=>{w&&w({isPublic:g,shareToken:u,domain:f,tags:m})}).catch(console.error)}},B=m=>{const k=v.filter(I=>I!==m);r(k),g&&fetch(`/api/ach/${n}/share`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_public:!0,domain:f,tags:k})}).then(()=>{w&&w({isPublic:g,shareToken:u,domain:f,tags:k})}).catch(console.error)},U=()=>{D&&(navigator.clipboard.writeText(D),o(!0),setTimeout(()=>o(!1),2e3))},_=async()=>{P(!0);try{if(g&&u){const K=`${window.location.origin}/public/ach/${u}`;await navigator.clipboard.writeText(K),p({title:"Link copied!",description:"Share link has been copied to clipboard"}),P(!1);return}const m=await fetch(`/api/ach/${n}/share`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_public:!0,domain:f,tags:v})});if(!m.ok)throw new Error("Failed to create share link");const k=await m.json();t(k.is_public),h(k.share_token);const I=`${window.location.origin}/public/ach/${k.share_token}`;await navigator.clipboard.writeText(I),w&&w({isPublic:k.is_public,shareToken:k.share_token,domain:k.domain,tags:k.tags}),p({title:"Share link created and copied!",description:"Anyone with this link can view and clone your ACH analysis"})}catch(m){console.error("Failed to share:",m),p({title:"Failed to create share link",description:"Please try again",variant:"destructive"})}finally{P(!1)}};return e.jsxs(pe,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(V,{variant:"outline",className:"gap-2",children:[g?e.jsx(je,{className:"h-4 w-4"}):e.jsx(ke,{className:"h-4 w-4"}),"Share"]})}),e.jsxs(ge,{align:"end",className:"w-96",children:[e.jsx(Fe,{children:"Sharing Options"}),e.jsx(le,{}),e.jsxs(Z,{onClick:_,disabled:S,className:"gap-2 cursor-pointer",children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:S?"Creating link...":g&&u?"Copy Share Link":"Share Analysis"}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:g&&u?"Copy link to clipboard":"Create public link and copy"})]})]}),e.jsx(le,{}),e.jsxs("div",{className:"p-3 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Public Access"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Anyone with the link can view and clone"})]}),e.jsx(Ne,{checked:g,onCheckedChange:G,disabled:y})]}),g&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:"Domain"}),e.jsxs(ve,{value:f,onValueChange:m=>c(m),children:[e.jsx(we,{children:e.jsx(Se,{placeholder:"Select domain"})}),e.jsx(be,{children:We.map(m=>e.jsx(Ce,{value:m.value,children:m.label},m.value))})]})]}),g&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:"Tags (Optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ce,{value:s,onChange:m=>i(m.target.value),onKeyPress:m=>{m.key==="Enter"&&(m.preventDefault(),O())},placeholder:"Add tag...",className:"text-sm"}),e.jsx(V,{type:"button",size:"sm",onClick:O,children:"Add"})]}),v&&v.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:v.map(m=>e.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded text-xs",children:[m,e.jsx("button",{onClick:()=>B(m),className:"hover:text-red-600",children:"Ã—"})]},m))})]}),g&&D&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{children:"Share Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ce,{readOnly:!0,value:D,className:"text-xs",onClick:m=>m.currentTarget.select()}),e.jsx(V,{size:"sm",variant:"outline",onClick:U,children:b?e.jsx(Ie,{className:"h-4 w-4"}):e.jsx(ze,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1 pt-2 border-t",children:[e.jsx("p",{children:"âœ“ Anyone can view your analysis"}),e.jsx("p",{children:"âœ“ Logged-in users can clone and score independently"}),e.jsx("p",{children:"âœ“ Original analysis attribution preserved"}),e.jsx("p",{children:"âœ“ Cloned analyses start with blank scores"})]})]}),!g&&e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 pt-2 border-t",children:[e.jsx("p",{children:"ðŸ”’ Only you can access this analysis"}),e.jsx("p",{className:"mt-2",children:"Enable public sharing to allow others to view and clone your intelligence analysis"})]})]})]})]})}function Je(n,E,d,T){const N=d.filter(s=>s.evidence_id===n);if(N.length===0)return{evidenceId:n,evidenceTitle:E,score:0,reasoning:"No scores entered for this evidence",range:0,topHypothesis:{id:"",text:"",score:0},otherHypotheses:[],isDiagnostic:!1};const w=N.map(s=>s.score),p=Math.max(...w),g=Math.min(...w),t=p-g,h=Math.min(100,t/10*100),f=N.find(s=>s.score===p),z=T.find(s=>s.id===f?.hypothesis_id),v=N.filter(s=>s.hypothesis_id!==f?.hypothesis_id).map(s=>{const i=T.find(b=>b.id===s.hypothesis_id);return{id:s.hypothesis_id,text:i?.text||"Unknown",score:s.score}}).sort((s,i)=>i.score-s.score);let r;return h>=80?r=`Highly diagnostic (range: ${t.toFixed(1)}). This evidence strongly differentiates between hypotheses, making it very valuable for analysis.`:h>=50?r=`Moderately diagnostic (range: ${t.toFixed(1)}). This evidence provides some differentiation between hypotheses.`:h>=25?r=`Low diagnosticity (range: ${t.toFixed(1)}). This evidence doesn't strongly favor any particular hypothesis.`:r=`Very low diagnosticity (range: ${t.toFixed(1)}). This evidence is nearly neutral across all hypotheses.`,{evidenceId:n,evidenceTitle:E,score:h,reasoning:r,range:t,topHypothesis:{id:f?.hypothesis_id||"",text:z?.text||"Unknown",score:p},otherHypotheses:v,isDiagnostic:h>50}}function ee(n,E,d){return n.map(T=>Je(T.evidence_id,T.evidence_title,E,d)).sort((T,N)=>N.score-T.score)}function te(n,E,d){const T=n.map(g=>{const t=E.filter(r=>r.hypothesis_id===g.id),u=t.reduce((r,s)=>r+s.score,0),h=u,f=t.filter(r=>r.score>0).length,z=t.filter(r=>r.score<0).length,v=t.filter(r=>r.score===0).length;return{hypothesisId:g.id,hypothesis:g.text,rawScore:u,weightedScore:h,rank:0,isLeastContradicted:!1,supportingEvidence:f,contradictingEvidence:z,neutralEvidence:v,likelihood:0}});T.sort((g,t)=>t.weightedScore-g.weightedScore),T.forEach((g,t)=>{g.rank=t+1,g.isLeastContradicted=t===0});const N=Math.max(...T.map(g=>g.weightedScore)),w=Math.min(...T.map(g=>g.weightedScore)),p=N-w;return T.forEach(g=>{p===0?g.likelihood=50:g.likelihood=(g.weightedScore-w)/p*100}),T}function Qe(n){return n>=3?"bg-green-500 text-white":n>0?"bg-green-200 text-green-900":n===0?"bg-gray-200 text-gray-700":n>-3?"bg-red-200 text-red-900":"bg-red-500 text-white"}function Xe(n){return n>=80?"bg-green-500 text-white":n>=50?"bg-blue-500 text-white":n>=25?"bg-yellow-500 text-white":"bg-gray-500 text-white"}function ae(n){return n>0?`+${n.toFixed(1)}`:n.toFixed(1)}function Ze({analysis:n}){const E=n.hypotheses||[],d=n.evidence||[],T=n.scores||[];if(E.length===0||d.length===0||T.length===0)return e.jsx(q,{children:e.jsxs(J,{className:"p-12 text-center",children:[e.jsx(Re,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Complete the scoring matrix to view visual analytics"})]})});const N=ee(d,T,E),w=te(E,T);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(q,{children:[e.jsxs(oe,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5 text-blue-600"}),e.jsx(ne,{children:"Hypothesis Likelihood Ranking"})]}),e.jsxs(Q,{variant:"outline",children:[E.length," hypotheses"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["In ACH methodology, the hypothesis with the ",e.jsx("strong",{children:"least contradictory evidence"})," (highest score) is typically most likely"]})]}),e.jsxs(J,{className:"space-y-4",children:[w.map((p,g)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs(Q,{variant:p.isLeastContradicted?"default":"outline",className:X("text-sm font-semibold",p.isLeastContradicted&&"bg-green-600"),children:["#",p.rank]}),e.jsx("span",{className:X("font-medium",p.isLeastContradicted&&"text-green-700 dark:text-green-400"),children:p.hypothesis})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Score: ",ae(p.weightedScore)]}),e.jsxs("span",{className:"text-green-600",children:["+",p.supportingEvidence," support"]}),e.jsxs("span",{className:"text-red-600",children:["âˆ’",p.contradictingEvidence," contradict"]}),e.jsxs("span",{className:"text-gray-500",children:[p.neutralEvidence," neutral"]})]})]}),e.jsxs("div",{className:"text-right min-w-[80px]",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[p.likelihood.toFixed(0),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Likelihood"})]})]}),e.jsx(he,{value:p.likelihood,className:X("h-3",p.isLeastContradicted&&"[&>div]:bg-green-600")})]},p.hypothesisId)),w.length>0&&w[0].isLeastContradicted&&e.jsx("div",{className:"mt-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(He,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-semibold text-green-900 dark:text-green-100",children:"Most Likely Hypothesis:"}),e.jsxs("p",{className:"text-green-800 dark:text-green-200 mt-1",children:['"',w[0].hypothesis,'"']}),e.jsxs("p",{className:"text-green-700 dark:text-green-300 text-xs mt-2",children:["This hypothesis has the least contradictory evidence (",w[0].contradictingEvidence," contradictions vs ",w[0].supportingEvidence," supporting pieces)"]})]})]})})]})]}),e.jsxs(q,{children:[e.jsxs(oe,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ne,{children:"Evidence Diagnosticity Analysis"}),e.jsxs(Q,{variant:"outline",children:[d.length," pieces"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Which evidence best differentiates between hypotheses?"})]}),e.jsxs(J,{className:"space-y-3",children:[N.slice(0,10).map(p=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsx("div",{className:"flex items-start justify-between gap-3 mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-sm",children:p.evidenceTitle}),e.jsxs(Q,{className:Xe(p.score),children:[p.score.toFixed(0),"% diagnostic"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p.reasoning})]})}),e.jsx(he,{value:p.score,className:"h-2 mb-2"}),p.isDiagnostic&&p.topHypothesis.id&&e.jsxs("div",{className:"text-xs bg-blue-50 dark:bg-blue-900/20 p-2 rounded",children:[e.jsx("span",{className:"text-muted-foreground",children:"Most supports:"})," ",e.jsxs("span",{className:"font-medium",children:[p.topHypothesis.text," (",ae(p.topHypothesis.score),")"]})]})]},p.evidenceId)),N.length===0&&e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:"No diagnosticity data available. Complete scoring matrix first."})]})]}),e.jsxs(q,{children:[e.jsxs(oe,{children:[e.jsx(ne,{children:"Evidence vs. Hypotheses Heatmap"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Color-coded matrix for quick pattern recognition"})]}),e.jsxs(J,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 dark:border-gray-700 p-2 text-left text-xs font-semibold bg-gray-50 dark:bg-gray-800 min-w-[150px]",children:"Evidence"}),E.map((p,g)=>e.jsxs("th",{className:"border border-gray-300 dark:border-gray-700 p-2 text-center text-xs font-semibold bg-gray-50 dark:bg-gray-800 min-w-[80px]",children:["H",g+1]},p.id))]})}),e.jsx("tbody",{children:d.map(p=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 dark:border-gray-700 p-2 text-xs",children:e.jsx("div",{className:"font-medium",children:p.evidence_title})}),E.map(g=>{const t=T.find(f=>f.hypothesis_id===g.id&&f.evidence_id===p.evidence_id),u=t?.score??0,h=Qe(u);return e.jsx("td",{className:"border border-gray-300 dark:border-gray-700 p-0",children:e.jsx("div",{className:X("w-full h-full flex items-center justify-center py-3 font-bold text-sm",h),title:t?.notes||"",children:ae(u)})},g.id)})]},p.evidence_id))})]})}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-4 text-xs",children:[e.jsx("span",{className:"font-semibold",children:"Legend:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-green-500 rounded"}),e.jsx("span",{children:"Strong Support (+3 to +5)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-green-200 rounded"}),e.jsx("span",{children:"Weak Support (+1 to +2)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 rounded"}),e.jsx("span",{children:"Neutral (0)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-200 rounded"}),e.jsx("span",{children:"Weak Contradiction (âˆ’1 to âˆ’2)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 bg-red-500 rounded"}),e.jsx("span",{children:"Strong Contradiction (âˆ’3 to âˆ’5)"})]})]})]})]})]})}function et({analysis:n,variant:E="outline",size:d="default",className:T}){const[N,w]=H.useState(!1),p=t=>t>0?`+${t}`:t.toString(),g=async()=>{w(!0);try{const t=new Ve({orientation:"portrait",unit:"mm",format:"letter"}),u=n.hypotheses||[],h=n.evidence||[],f=n.scores||[],z=ee(h,f,u),v=te(u,f,h),r={primary:[30,58,138],secondary:[100,116,139],accent:[239,68,68],success:[34,197,94],warning:[245,158,11],text:[31,41,55],light:[249,250,251]};let s=20;const i=t.internal.pageSize.getWidth(),b=t.internal.pageSize.getHeight(),o=20,y=()=>{t.addPage(),s=20,R()},R=()=>{const l=t.internal.pages.length-1;l>1&&(t.setFontSize(9),t.setTextColor(100,116,139),t.text(`Page ${l}`,i-o-10,b-10))},S=l=>s+l>b-30?(y(),!0):!1;t.setFillColor(...r.primary),t.rect(0,0,i,80,"F"),t.setFontSize(24),t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.text("ANALYSIS OF COMPETING",i/2,35,{align:"center"}),t.text("HYPOTHESES (ACH)",i/2,50,{align:"center"}),t.setFontSize(14),t.setFont("helvetica","normal"),t.text(n.title,i/2,65,{align:"center"}),s=100,t.setFontSize(12),t.setTextColor(...r.text),t.setFont("helvetica","bold"),t.text("Classification:",o,s),t.setFont("helvetica","normal"),t.text("UNCLASSIFIED",o+50,s),s+=10,t.setFont("helvetica","bold"),t.text("Date:",o,s),t.setFont("helvetica","normal"),t.text(new Date(n.created_at).toLocaleDateString(),o+50,s),s+=10,t.setFont("helvetica","bold"),t.text("Analyst:",o,s),t.setFont("helvetica","normal"),t.text(n.analyst||"Not specified",o+50,s),s+=10,t.setFont("helvetica","bold"),t.text("Scale Type:",o,s),t.setFont("helvetica","normal"),t.text(n.scale_type.toUpperCase(),o+50,s),s+=10,t.setFont("helvetica","bold"),t.text("Status:",o,s),t.setFont("helvetica","normal"),t.text(n.status.toUpperCase(),o+50,s),s=b-60,t.setFontSize(9),t.setTextColor(100,116,139),t.setFont("helvetica","italic"),t.text("This document is generated for analytical purposes. ACH is designed to mitigate cognitive biases and identify the most likely hypothesis based on evidence.",i/2,s,{align:"center",maxWidth:i-40}),s=b-40,t.setFontSize(8),t.text("Generated by ACH Analysis Tool",i/2,s,{align:"center"}),t.text("https://github.com/gitayam/researchtoolspy",i/2,s+5,{align:"center"}),y(),s=20,t.setFontSize(18),t.setTextColor(...r.primary),t.setFont("helvetica","bold"),t.text("EXECUTIVE SUMMARY",o,s),s+=12,t.setFontSize(11),t.setTextColor(...r.text),t.setFont("helvetica","normal");const D=`This Analysis of Competing Hypotheses (ACH) evaluates ${u.length} competing hypotheses against ${h.length} pieces of evidence to answer the intelligence question. ACH methodology systematically evaluates all hypotheses simultaneously to identify which is least contradicted by the evidence, rather than seeking confirmation of a preferred hypothesis.`,G=t.splitTextToSize(D,i-2*o);t.text(G,o,s),s+=G.length*6+8,t.setFont("helvetica","bold"),t.text("KEY STATISTICS",o,s),s+=8;const c=[["Hypotheses Evaluated:",u.length.toString()],["Evidence Items:",h.length.toString()],["Total Assessments:",f.length.toString()],["Most Likely Hypothesis:",v[0]?.hypothesis.substring(0,40)+"..."||"N/A"]];t.setFont("helvetica","normal"),c.forEach(([l,a])=>{t.text(l,o+5,s),t.setFont("helvetica","bold"),t.text(a,o+70,s),t.setFont("helvetica","normal"),s+=6}),s+=8,t.setFont("helvetica","bold"),t.text("TOP 5 DIAGNOSTIC EVIDENCE (Most Differentiating)",o,s),s+=8;const O=z.slice(0,5);t.setFont("helvetica","normal"),O.forEach((l,a)=>{const F=l.score>=80?r.success:l.score>=50?r.warning:r.secondary;t.setTextColor(...F),t.setFont("helvetica","bold"),t.text(`${a+1}.`,o+5,s),t.setTextColor(...r.text),t.setFont("helvetica","normal");const C=t.splitTextToSize(l.evidenceTitle,i-2*o-30);t.text(C,o+12,s),t.setFont("helvetica","bold"),t.text(`${l.score.toFixed(0)}%`,i-o-30,s),s+=Math.max(C.length*5,5)+3,S(20)&&t.setFont("helvetica","normal")}),S(100)||y(),s=20,t.setFontSize(18),t.setTextColor(...r.primary),t.setFont("helvetica","bold"),t.text("INTELLIGENCE QUESTION",o,s),s+=12,t.setFontSize(12),t.setTextColor(...r.text),t.setFont("helvetica","normal");const B=t.splitTextToSize(n.question,i-2*o);if(t.text(B,o,s),s+=B.length*6+10,n.description){t.setFont("helvetica","bold"),t.text("BACKGROUND:",o,s),s+=7,t.setFont("helvetica","normal");const l=t.splitTextToSize(n.description,i-2*o);t.text(l,o,s),s+=l.length*5+10}S(80)||y(),s=20,t.setFontSize(18),t.setTextColor(...r.primary),t.setFont("helvetica","bold"),t.text("HYPOTHESIS LIKELIHOOD RANKING",o,s),s+=12,t.setFontSize(10),t.setTextColor(...r.text),t.setFont("helvetica","italic"),t.text("Note: The hypothesis with the LEAST contradictory evidence is typically most likely.",o,s),s+=10,v.forEach((l,a)=>{S(35);const F=a===0;F?t.setFillColor(...r.success):t.setFillColor(...r.secondary),t.roundedRect(o,s-4,12,7,1,1,"F"),t.setFontSize(10),t.setTextColor(255,255,255),t.setFont("helvetica","bold"),t.text(`#${l.rank}`,o+6,s,{align:"center"}),t.setFontSize(11),t.setTextColor(...r.text),F?t.setFont("helvetica","bold"):t.setFont("helvetica","normal");const C=t.splitTextToSize(l.hypothesis,i-2*o-20);t.text(C,o+15,s),s+=Math.max(C.length*5,5)+2,t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(...r.secondary),t.text(`Score: ${p(l.weightedScore)} | `,o+15,s),t.setTextColor(...r.success),t.text(`+${l.supportingEvidence} support | `,o+50,s),t.setTextColor(...r.accent),t.text(`âˆ’${l.contradictingEvidence} contradict | `,o+85,s),t.setTextColor(...r.secondary),t.text(`${l.neutralEvidence} neutral`,o+120,s),s+=5;const x=(i-2*o-15)*(l.likelihood/100);t.setFillColor(...F?r.success:r.secondary),t.rect(o+15,s,x,3,"F"),t.setDrawColor(...r.secondary),t.rect(o+15,s,i-2*o-15,3,"S"),t.setFontSize(8),t.setTextColor(...r.secondary),t.text(`${l.likelihood.toFixed(1)}%`,i-o,s+2),s+=10}),S(80)||y(),s=20,t.setFontSize(18),t.setTextColor(...r.primary),t.setFont("helvetica","bold"),t.text("EVIDENCE-HYPOTHESIS MATRIX",o,s),s+=12,t.setFontSize(9),t.setTextColor(...r.text),t.setFont("helvetica","italic"),t.text("This matrix shows how each piece of evidence relates to each hypothesis.",o,s),s+=5,t.text("Green = Supporting | Red = Contradicting | Gray = Neutral/Inconsistent",o,s),s+=10;const U=h.slice(0,15).map(l=>{const a=[l.evidence_title.substring(0,40)+(l.evidence_title.length>40?"...":"")];return u.forEach(F=>{const C=f.find(x=>x.hypothesis_id===F.id&&x.evidence_id===l.evidence_id);a.push(p(C?.score??0))}),a}),_=["Evidence",...u.map((l,a)=>`H${a+1}`)];Ue(t,{startY:s,head:[_],body:U,theme:"grid",headStyles:{fillColor:r.primary,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:7,cellPadding:1.5},columnStyles:{0:{cellWidth:80}},didDrawCell:l=>{if(l.column.index>0&&l.section==="body"){const a=l.cell.text[0],F=parseInt(a.replace("+",""));F>0?(l.cell.styles.textColor=r.success,l.cell.styles.fontStyle="bold"):F<0?(l.cell.styles.textColor=r.accent,l.cell.styles.fontStyle="bold"):l.cell.styles.textColor=r.secondary}}}),s=t.lastAutoTable.finalY+10,S(80)||y(),s=20,t.setFontSize(18),t.setTextColor(...r.primary),t.setFont("helvetica","bold"),t.text("EVIDENCE DIAGNOSTICITY ANALYSIS",o,s),s+=12,t.setFontSize(10),t.setTextColor(...r.text),t.setFont("helvetica","italic"),t.text("Diagnosticity measures how well evidence differentiates between hypotheses.",o,s),s+=5,t.text("Higher diagnosticity = more useful for distinguishing competing explanations.",o,s),s+=12,z.slice(0,10).forEach((l,a)=>{S(25);const F=l.score>=80?r.success:l.score>=50?r.warning:r.secondary;t.setFont("helvetica","bold"),t.setTextColor(...F),t.text(`${l.score.toFixed(0)}%`,o,s),t.setFontSize(10),t.setTextColor(...r.text),t.setFont("helvetica","normal");const C=t.splitTextToSize(`${a+1}. ${l.evidenceTitle}`,i-2*o-25);t.text(C,o+20,s),s+=Math.max(C.length*5,5)+2,t.setFontSize(8),t.setFont("helvetica","italic"),t.setTextColor(...r.secondary);const x=t.splitTextToSize(l.reasoning,i-2*o-25);t.text(x,o+20,s),s+=x.length*4+6}),S(80)||y(),s=20,t.setFontSize(18),t.setTextColor(...r.primary),t.setFont("helvetica","bold"),t.text("KEY FINDINGS & RECOMMENDATIONS",o,s),s+=12,t.setFontSize(11),t.setTextColor(...r.text),t.setFont("helvetica","normal"),["1. MOST LIKELY HYPOTHESIS (Least Contradicted):",`   ${v[0]?.hypothesis||"N/A"}`,`   Likelihood: ${v[0]?.likelihood.toFixed(1)}% | Score: ${p(v[0]?.weightedScore||0)}`,"","2. ALTERNATIVE HYPOTHESES TO MONITOR:",...v.slice(1,3).map((l,a)=>`   ${a+2}. ${l.hypothesis} (${l.likelihood.toFixed(1)}%)`),"","3. CRITICAL EVIDENCE REQUIRING VALIDATION:",...z.slice(0,3).map((l,a)=>`   ${a+1}. ${l.evidenceTitle} (${l.score.toFixed(0)}% diagnostic)`),"","4. COGNITIVE BIAS MITIGATION:","   â€¢ ACH methodology reduces confirmation bias by evaluating all hypotheses equally","   â€¢ Focus on disconfirming evidence rather than confirming evidence","   â€¢ Reassess when new evidence emerges that changes diagnosticity","","5. COLLECTION RECOMMENDATIONS:","   â€¢ Prioritize gathering evidence with high diagnostic potential","   â€¢ Seek evidence that strongly differentiates between top hypotheses","   â€¢ Re-evaluate low-diagnosticity evidence for continued relevance","","6. ANALYTICAL CONFIDENCE:",...(()=>{const l=v[0]?.likelihood||0,a=v[1]?.likelihood||0,F=l-a;return F>20?[`   HIGH - Clear separation between most likely and alternative hypotheses (${F.toFixed(1)}% gap)`]:F>10?[`   MEDIUM - Moderate separation suggests need for more diagnostic evidence (${F.toFixed(1)}% gap)`]:[`   LOW - Competing hypotheses remain close; additional evidence critical (${F.toFixed(1)}% gap)`]})()].forEach(l=>{S(10);const a=t.splitTextToSize(l,i-2*o-5);t.text(a,o,s),s+=a.length*5+2}),S(80)||y(),s=20,t.setFontSize(18),t.setTextColor(...r.primary),t.setFont("helvetica","bold"),t.text("APPENDIX: ACH METHODOLOGY",o,s),s+=12,t.setFontSize(10),t.setTextColor(...r.text),t.setFont("helvetica","normal"),["Analysis of Competing Hypotheses (ACH) is a structured analytical technique developed","by Richards J. Heuer Jr. to overcome cognitive limitations and biases in intelligence analysis.","","KEY PRINCIPLES:","","1. Evaluate ALL hypotheses simultaneously, not sequentially","2. Focus on disconfirming evidence rather than confirming evidence","3. Identify the hypothesis with the LEAST contradictory evidence","4. Use diagnosticity to prioritize evidence collection","5. Make reasoning explicit and transparent for review","","SCORING SYSTEM:","",`This analysis used a ${n.scale_type} scale:`,"  +5: Very Strongly Supports","  +3: Strongly Supports","  +1: Supports","   0: Neutral/Inconsistent","  -1: Contradicts","  -3: Strongly Contradicts","  -5: Very Strongly Contradicts","","DIAGNOSTICITY CALCULATION:","","Diagnosticity = (Score Range / Maximum Possible Range) Ã— 100","","High diagnosticity (>80%): Evidence strongly differentiates hypotheses","Medium diagnosticity (50-80%): Evidence provides some differentiation","Low diagnosticity (<50%): Evidence does not significantly favor any hypothesis","","LIKELIHOOD CALCULATION:","","Hypotheses are ranked by weighted score (sum of all evidence scores).","The hypothesis with the highest score (least negative) is most likely.","Likelihood percentage is normalized for visualization purposes.","","REFERENCES:","","Heuer, R. J. (1999). Psychology of Intelligence Analysis. CIA Center for the Study","   of Intelligence.","Pherson, R. H., & Heuer, R. J. (2020). Structured Analytic Techniques for","   Intelligence Analysis (3rd ed.). CQ Press."].forEach(l=>{S(8),t.text(l,o,s),s+=5});const I=t.internal.pages.length-1;for(let l=2;l<=I;l++)t.setPage(l),R();const K=`${n.title.replace(/[^a-z0-9]/gi,"_")}-ACH-Report.pdf`;t.save(K)}catch(t){console.error("PDF export error:",t),alert("Failed to export PDF. Please try again.")}finally{w(!1)}};return e.jsx(V,{variant:E,size:d,onClick:g,disabled:N,className:T,children:N?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Export PDF"]})})}function tt({analysis:n,variant:E="outline",size:d="default",className:T}){const[N,w]=H.useState(!1),p=t=>t>0?`+${t}`:t.toString(),g=async()=>{w(!0);try{const u=(await ye(()=>import("./pptxgen.es-BxyxNDcn.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))).default,h=new u;h.author="ACH Analysis Tool",h.company="Research Tools",h.title=n.title,h.subject="Analysis of Competing Hypotheses";const f=n.hypotheses||[],z=n.evidence||[],v=n.scores||[],r=ee(z,v,f),s=te(f,v,z),i={primary:"1E3A8A",secondary:"64748B",accent:"EF4444",success:"22C55E",warning:"F59E0B",text:"1F2937",light:"F9FAFB"},b=h.addSlide();b.background={color:i.primary},b.addText("ANALYSIS OF COMPETING",{x:.5,y:1.5,w:9,h:.6,fontSize:44,bold:!0,color:"FFFFFF",align:"center"}),b.addText("HYPOTHESES",{x:.5,y:2.1,w:9,h:.6,fontSize:44,bold:!0,color:"FFFFFF",align:"center"}),b.addText(n.title,{x:.5,y:3.2,w:9,h:.8,fontSize:28,color:"FFFFFF",align:"center"}),b.addText([{text:"Created: ",options:{fontSize:14,color:"CBD5E1"}},{text:new Date(n.created_at).toLocaleDateString(),options:{fontSize:14,color:"FFFFFF"}}],{x:.5,y:5,w:9,h:.4,align:"center"}),b.addText([{text:"Analyst: ",options:{fontSize:14,color:"CBD5E1"}},{text:n.analyst||"Not specified",options:{fontSize:14,color:"FFFFFF"}}],{x:.5,y:5.5,w:9,h:.4,align:"center"}),b.addText([{text:"Scale: ",options:{fontSize:14,color:"CBD5E1"}},{text:n.scale_type.toUpperCase(),options:{fontSize:14,color:"FFFFFF",bold:!0}}],{x:.5,y:6,w:9,h:.4,align:"center"});const o=h.addSlide();o.addText("INTELLIGENCE QUESTION",{x:.5,y:.3,w:9,h:.6,fontSize:32,bold:!0,color:i.primary}),o.addShape(h.ShapeType.rect,{x:.5,y:1.3,w:9,h:1.5,fill:{color:i.light},line:{color:i.primary,width:3}}),o.addText(n.question,{x:.8,y:1.6,w:8.4,h:1,fontSize:18,bold:!0,color:i.text,valign:"middle"}),n.description&&(o.addText("BACKGROUND",{x:.5,y:3.1,w:9,h:.4,fontSize:18,bold:!0,color:i.secondary}),o.addText(n.description.substring(0,300)+(n.description.length>300?"...":""),{x:.5,y:3.7,w:9,h:2.5,fontSize:14,color:i.text}));const y=n.description?6.3:3.3;[{label:"Hypotheses",value:f.length,color:i.primary},{label:"Evidence Items",value:z.length,color:i.success},{label:"Assessments",value:v.length,color:i.warning}].forEach((a,F)=>{const C=1.5+F*2.5;o.addShape(h.ShapeType.rect,{x:C,y,w:2,h:.8,fill:{color:a.color}}),o.addText(a.value.toString(),{x:C,y:y+.1,w:2,h:.4,fontSize:32,bold:!0,color:"FFFFFF",align:"center"}),o.addText(a.label,{x:C,y:y+.5,w:2,h:.3,fontSize:12,color:"FFFFFF",align:"center"})});const S=h.addSlide();S.addText("HYPOTHESIS LIKELIHOOD RANKING",{x:.5,y:.3,w:9,h:.6,fontSize:28,bold:!0,color:i.primary}),S.addText("The hypothesis with the LEAST contradictory evidence is most likely",{x:.5,y:.9,w:9,h:.3,fontSize:12,italic:!0,color:i.secondary,align:"center"}),s.slice(0,5).forEach((a,F)=>{const C=1.5+F*1.1,x=F===0,A=x?i.success:i.secondary;S.addShape(h.ShapeType.rect,{x:.5,y:C,w:.4,h:.4,fill:{color:A}}),S.addText(`#${a.rank}`,{x:.5,y:C+.05,w:.4,h:.3,fontSize:14,bold:!0,color:"FFFFFF",align:"center"}),S.addText(a.hypothesis.substring(0,80)+(a.hypothesis.length>80?"...":""),{x:1,y:C,w:5.5,h:.4,fontSize:x?14:12,bold:x,color:i.text}),S.addText(`Score: ${p(a.weightedScore)}`,{x:6.6,y:C,w:1,h:.4,fontSize:10,color:i.secondary,align:"right"}),S.addText(`+${a.supportingEvidence}`,{x:7.7,y:C,w:.5,h:.4,fontSize:10,color:i.success,align:"right"}),S.addText(`âˆ’${a.contradictingEvidence}`,{x:8.3,y:C,w:.5,h:.4,fontSize:10,color:i.accent,align:"right"});const j=8.3*(a.likelihood/100);S.addShape(h.ShapeType.rect,{x:1,y:C+.5,w:j,h:.25,fill:{color:A}}),S.addShape(h.ShapeType.rect,{x:1,y:C+.5,w:8.3,h:.25,fill:{type:"solid",transparency:80,color:i.secondary}}),S.addText(`${a.likelihood.toFixed(1)}%`,{x:1,y:C+.8,w:1,h:.2,fontSize:9,color:i.secondary})});const P=h.addSlide();P.addText("EVIDENCE-HYPOTHESIS MATRIX",{x:.5,y:.3,w:9,h:.6,fontSize:28,bold:!0,color:i.primary}),P.addText("Green = Supporting | Red = Contradicting | Gray = Neutral",{x:.5,y:.9,w:9,h:.3,fontSize:11,italic:!0,color:i.secondary,align:"center"});const D=[],G=[{text:"Evidence",options:{fontSize:10,color:"FFFFFF",fill:i.primary}}];f.slice(0,8).forEach((a,F)=>{G.push({text:`H${F+1}`,options:{fontSize:10,color:"FFFFFF",fill:i.primary}})}),D.push(G),z.slice(0,12).forEach(a=>{const F=[{text:a.evidence_title.substring(0,35)+(a.evidence_title.length>35?"...":""),options:{fontSize:9}}];f.slice(0,8).forEach(C=>{const A=v.find($=>$.hypothesis_id===C.id&&$.evidence_id===a.evidence_id)?.score??0,j=A>0?i.success:A<0?i.accent:i.secondary,L=p(A);F.push({text:L,options:{fontSize:10,color:j}})}),D.push(F)});const c=[3.5];for(let a=0;a<Math.min(f.length,8);a++)c.push(.7);P.addTable(D,{x:.5,y:1.4,w:9,colW:c,fontSize:9,border:{pt:1,color:"D1D5DB"},fill:{color:"FFFFFF"}});const O=h.addSlide();O.addText("TOP DIAGNOSTIC EVIDENCE",{x:.5,y:.3,w:9,h:.6,fontSize:28,bold:!0,color:i.primary}),O.addText("Most useful for differentiating between competing hypotheses",{x:.5,y:.9,w:9,h:.3,fontSize:12,italic:!0,color:i.secondary,align:"center"}),r.slice(0,8).forEach((a,F)=>{const C=1.5+F*.7,x=a.score>=80?i.success:a.score>=50?i.warning:i.secondary;O.addText(`${F+1}.`,{x:.5,y:C,w:.3,h:.4,fontSize:12,bold:!0,color:i.text}),O.addText(a.evidenceTitle.substring(0,65)+(a.evidenceTitle.length>65?"...":""),{x:.9,y:C,w:7,h:.4,fontSize:11,color:i.text}),O.addShape(h.ShapeType.rect,{x:8,y:C+.05,w:1.4,h:.3,fill:{color:x}}),O.addText(`${a.score.toFixed(0)}% diagnostic`,{x:8,y:C+.05,w:1.4,h:.3,fontSize:9,bold:!0,color:"FFFFFF",align:"center",valign:"middle"})});const B=h.addSlide();B.addText("KEY FINDINGS",{x:.5,y:.3,w:9,h:.6,fontSize:32,bold:!0,color:i.primary});const U=[{title:"1. MOST LIKELY HYPOTHESIS (Least Contradicted)",content:s[0]?.hypothesis||"N/A",meta:`Likelihood: ${s[0]?.likelihood.toFixed(1)}% | Score: ${p(s[0]?.weightedScore||0)}`},{title:"2. KEY ALTERNATIVE HYPOTHESES",content:s.slice(1,3).map((a,F)=>`${F+2}. ${a.hypothesis} (${a.likelihood.toFixed(1)}%)`).join(`
`),meta:"Monitor for new evidence that could shift likelihood"},{title:"3. ANALYTICAL CONFIDENCE",content:(()=>{const a=(s[0]?.likelihood||0)-(s[1]?.likelihood||0);return a>20?`HIGH - Clear separation (${a.toFixed(1)}% gap)`:a>10?`MEDIUM - Moderate separation (${a.toFixed(1)}% gap)`:`LOW - Competing hypotheses remain close (${a.toFixed(1)}% gap)`})(),meta:"Based on likelihood gap between top hypotheses"}];let _=1.3;U.forEach(a=>{B.addText(a.title,{x:.7,y:_,w:8.6,h:.4,fontSize:14,bold:!0,color:i.primary}),B.addText(a.content,{x:1,y:_+.5,w:8.3,h:.8,fontSize:12,color:i.text}),B.addText(a.meta,{x:1,y:_+1.3,w:8.3,h:.3,fontSize:10,italic:!0,color:i.secondary}),_+=2});const m=h.addSlide();m.addText("RECOMMENDATIONS",{x:.5,y:.3,w:9,h:.6,fontSize:32,bold:!0,color:i.primary}),["â€¢ Focus collection on high-diagnostic evidence to differentiate top hypotheses","â€¢ Reassess analysis when new evidence emerges that changes diagnosticity","â€¢ Actively seek disconfirming evidence for the most likely hypothesis","â€¢ Monitor alternative hypotheses - likelihood can shift with new evidence","â€¢ Document reasoning and assumptions for transparency","â€¢ Consider cognitive biases: confirmation bias, anchoring, groupthink","â€¢ Use ACH to challenge conventional thinking and surface blind spots"].forEach((a,F)=>{m.addText(a,{x:.8,y:1.5+F*.6,w:8.4,h:.5,fontSize:14,color:i.text})}),m.addShape(h.ShapeType.rect,{x:.5,y:6,w:9,h:1,fill:{color:i.light},line:{color:i.warning,width:2}}),m.addText("CRITICAL REMINDER: ACH identifies the hypothesis with the LEAST contradictory evidence, NOT the most confirming evidence. This reduces confirmation bias.",{x:.8,y:6.2,w:8.4,h:.6,fontSize:11,italic:!0,color:i.text});const I=h.addSlide();I.background={color:i.primary},I.addText("ANALYSIS COMPLETE",{x:.5,y:2,w:9,h:1,fontSize:40,bold:!0,color:"FFFFFF",align:"center"}),I.addText("Continue analysis in the ACH Analysis Tool for:",{x:1,y:3.3,w:8,h:.4,fontSize:16,color:"CBD5E1",align:"center"}),["â€¢ Interactive evidence-hypothesis matrix","â€¢ Real-time diagnosticity calculations","â€¢ Visual analytics and heatmaps","â€¢ AI-assisted hypothesis generation","â€¢ Collaboration and sharing"].forEach((a,F)=>{I.addText(a,{x:2,y:4+F*.5,w:6,h:.4,fontSize:16,color:"FFFFFF",align:"center"})});const l=`${n.title.replace(/[^a-z0-9]/gi,"_")}-ACH-Briefing.pptx`;await h.writeFile({fileName:l})}catch(t){console.error("PowerPoint export error:",t),alert("Failed to export PowerPoint. Please try again.")}finally{w(!1)}};return e.jsx(V,{variant:E,size:d,onClick:g,disabled:N,className:T,children:N?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating PPTX..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Export PowerPoint"]})})}function st({analysis:n,variant:E="outline",size:d="default",className:T}){const[N,w]=H.useState(!1),p=u=>u>0?`+${u}`:u.toString(),g=u=>u>=3?"Strongly Supports":u>=1?"Supports":u===0?"Neutral":u>=-2?"Contradicts":"Strongly Contradicts",t=async()=>{w(!0);try{const u=await ye(()=>import("./exceljs.min-RL4gfToV.js").then(x=>x.e),__vite__mapDeps([8,3,7])),h=new u.default.Workbook;h.creator="ACH Analysis Tool",h.created=new Date,h.modified=new Date,h.properties.date1904=!1;const f=n.hypotheses||[],z=n.evidence||[],v=n.scores||[],r=ee(z,v,f),s=te(f,v,z),i=h.addWorksheet("Evidence-Hypothesis Matrix",{views:[{state:"frozen",xSplit:1,ySplit:1}]}),b=[{header:"Evidence",key:"evidence",width:45}];f.forEach((x,A)=>{b.push({header:`H${A+1}`,key:`h${A+1}`,width:12})}),i.columns=b;const o=i.getRow(1);o.font={bold:!0,color:{argb:"FFFFFFFF"}},o.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF1E3A8A"}},o.alignment={vertical:"middle",horizontal:"center",wrapText:!0},o.height=30;const y=i.getRow(2);y.getCell(1).value="Hypothesis Details:",y.getCell(1).font={bold:!0,italic:!0},y.getCell(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF9FAFB"}},f.forEach((x,A)=>{const j=y.getCell(A+2);j.value=x.text,j.alignment={wrapText:!0,vertical:"top"},j.font={size:9,italic:!0},j.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF9FAFB"}}}),y.height=60,z.forEach(x=>{const A={evidence:x.evidence_title};f.forEach((L,$)=>{const M=v.find(Y=>Y.hypothesis_id===L.id&&Y.evidence_id===x.evidence_id);A[`h${$+1}`]=M?.score??0});const j=i.addRow(A);j.alignment={vertical:"top",wrapText:!0},j.height=35,f.forEach((L,$)=>{const M=j.getCell($+2),Y=A[`h${$+1}`];if(M.font={bold:Y!==0},Y>0){const se=Math.min(Y/5,1),W=Math.floor(200-se*100);M.fill={type:"pattern",pattern:"solid",fgColor:{argb:`FF${W.toString(16).padStart(2,"0")}F${W.toString(16).padStart(2,"0")}${W.toString(16).padStart(2,"0")}`}},Y>=3&&(M.font={bold:!0,color:{argb:"FFFFFFFF"}})}else if(Y<0){const se=Math.min(Math.abs(Y)/5,1),W=Math.floor(200-se*100);M.fill={type:"pattern",pattern:"solid",fgColor:{argb:`FFF${W.toString(16).padStart(2,"0")}${W.toString(16).padStart(2,"0")}${W.toString(16).padStart(2,"0")}`}},Y<=-3&&(M.font={bold:!0,color:{argb:"FFFFFFFF"}})}else M.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE5E7EB"}};M.note=g(Y)}),j.eachCell({includeEmpty:!0},L=>{L.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})});const R=i.addRow({evidence:"TOTALS (Sum of Scores)"});R.font={bold:!0},R.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFBBF24"}},f.forEach((x,A)=>{const L=v.filter(M=>M.hypothesis_id===x.id).reduce((M,Y)=>M+Y.score,0),$=R.getCell(A+2);$.value=L,$.font={bold:!0,size:12},$.alignment={horizontal:"center"}}),i.autoFilter={from:{row:1,column:1},to:{row:1,column:f.length+1}};const S=h.addWorksheet("Hypothesis Analysis",{views:[{state:"frozen",xSplit:0,ySplit:1}]});S.columns=[{header:"Rank",key:"rank",width:8},{header:"Hypothesis",key:"hypothesis",width:50},{header:"Weighted Score",key:"score",width:15},{header:"Likelihood %",key:"likelihood",width:13},{header:"Supporting",key:"supporting",width:12},{header:"Contradicting",key:"contradicting",width:14},{header:"Neutral",key:"neutral",width:10},{header:"Total Evidence",key:"total",width:14},{header:"Assessment",key:"assessment",width:20}];const P=S.getRow(1);P.font={bold:!0,color:{argb:"FFFFFFFF"}},P.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF1E3A8A"}},P.alignment={vertical:"middle",horizontal:"center",wrapText:!0},P.height=25,s.forEach(x=>{const A=x.isLeastContradicted?"MOST LIKELY":x.rank<=3?"ALTERNATIVE":"UNLIKELY",j=S.addRow({rank:x.rank,hypothesis:x.hypothesis,score:p(x.weightedScore),likelihood:`${x.likelihood.toFixed(1)}%`,supporting:x.supportingEvidence,contradicting:x.contradictingEvidence,neutral:x.neutralEvidence,total:x.supportingEvidence+x.contradictingEvidence+x.neutralEvidence,assessment:A});j.alignment={vertical:"top",wrapText:!0},j.height=40,x.isLeastContradicted&&(j.font={bold:!0},j.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFD1FAE5"}});const L=j.getCell("rank");L.font={bold:!0,size:14},L.alignment={horizontal:"center"},x.rank===1&&(L.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF10B981"}},L.font={bold:!0,color:{argb:"FFFFFFFF"},size:14}),j.eachCell({includeEmpty:!0},$=>{$.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})});const D=h.addWorksheet("Evidence Diagnosticity",{views:[{state:"frozen",xSplit:0,ySplit:1}]});D.columns=[{header:"Rank",key:"rank",width:8},{header:"Evidence",key:"evidence",width:50},{header:"Diagnosticity %",key:"diagnosticity",width:16},{header:"Score Range",key:"range",width:13},{header:"Top Hypothesis",key:"top_hyp",width:40},{header:"Reasoning",key:"reasoning",width:60}];const G=D.getRow(1);G.font={bold:!0,color:{argb:"FFFFFFFF"}},G.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF1E3A8A"}},G.alignment={vertical:"middle",horizontal:"center",wrapText:!0},G.height=25,r.forEach((x,A)=>{const j=D.addRow({rank:A+1,evidence:x.evidenceTitle,diagnosticity:`${x.score.toFixed(1)}%`,range:x.range.toFixed(1),top_hyp:x.topHypothesis.text,reasoning:x.reasoning});j.alignment={vertical:"top",wrapText:!0},j.height=35;const L=j.getCell("diagnosticity");L.font={bold:!0},x.score>=80?(L.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF10B981"}},L.font={bold:!0,color:{argb:"FFFFFFFF"}}):x.score>=50?(L.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF59E0B"}},L.font={bold:!0,color:{argb:"FF000000"}}):L.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE5E7EB"}},j.eachCell({includeEmpty:!0},$=>{$.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})});const c=h.addWorksheet("Analysis Summary");c.mergeCells("A1:D1");const O=c.getCell("A1");O.value="ANALYSIS OF COMPETING HYPOTHESES",O.font={size:18,bold:!0,color:{argb:"FF1E3A8A"}},O.alignment={horizontal:"center",vertical:"middle"},c.getRow(1).height=30,c.addRow([]),c.addRow(["Analysis Title:",n.title]),c.addRow(["Created:",new Date(n.created_at).toLocaleDateString()]),c.addRow(["Analyst:",n.analyst||"Not specified"]),c.addRow(["Scale Type:",n.scale_type.toUpperCase()]),c.addRow(["Status:",n.status.toUpperCase()]),c.addRow([]),c.addRow(["INTELLIGENCE QUESTION"]),c.getRow(9).font={bold:!0,color:{argb:"FF1E3A8A"},size:14},c.addRow([n.question]);const B=c.getRow(10).getCell(1);if(B.alignment={wrapText:!0},c.getRow(10).height=40,c.addRow([]),n.description){c.addRow(["BACKGROUND"]),c.getRow(12).font={bold:!0,color:{argb:"FF1E3A8A"}},c.addRow([n.description]);const x=c.getRow(13).getCell(1);x.alignment={wrapText:!0},c.getRow(13).height=50,c.addRow([])}const U=n.description?15:12;c.addRow(["STATISTICS"]),c.getRow(U).font={bold:!0,color:{argb:"FF1E3A8A"},size:12},c.addRow(["Hypotheses:",f.length]),c.addRow(["Evidence Items:",z.length]),c.addRow(["Total Assessments:",v.length]),c.addRow(["Avg Evidence per Hypothesis:",(v.length/f.length).toFixed(1)]),c.addRow([]);const _=U+6;c.addRow(["KEY FINDINGS"]),c.getRow(_).font={bold:!0,color:{argb:"FF1E3A8A"},size:12},c.addRow([]),c.addRow(["Most Likely Hypothesis (Least Contradicted):"]),c.getRow(_+2).font={bold:!0},c.addRow([s[0]?.hypothesis||"N/A"]),c.getRow(_+3).getCell(1).alignment={wrapText:!0},c.getRow(_+3).height=40,c.addRow([`Likelihood: ${s[0]?.likelihood.toFixed(1)}%`,`Score: ${p(s[0]?.weightedScore||0)}`,`Supporting: ${s[0]?.supportingEvidence}`,`Contradicting: ${s[0]?.contradictingEvidence}`]),c.addRow([]),c.addRow(["Top 3 Diagnostic Evidence:"]),c.getRow(_+6).font={bold:!0},r.slice(0,3).forEach((x,A)=>{c.addRow([`${A+1}.`,x.evidenceTitle,`${x.score.toFixed(0)}% diagnostic`])}),c.addRow([]);const m=_+11;c.addRow(["ANALYTICAL CONFIDENCE"]),c.getRow(m).font={bold:!0,color:{argb:"FF1E3A8A"},size:12};const k=(s[0]?.likelihood||0)-(s[1]?.likelihood||0);let I="LOW",K="FFEF4444";k>20?(I="HIGH",K="FF10B981"):k>10&&(I="MEDIUM",K="FFF59E0B"),c.addRow([`${I} (${k.toFixed(1)}% gap between top hypotheses)`]);const l=c.getRow(m+1).getCell(1);l.font={bold:!0,size:12},l.fill={type:"pattern",pattern:"solid",fgColor:{argb:K}},I!=="MEDIUM"&&(l.font={bold:!0,size:12,color:{argb:"FFFFFFFF"}}),c.getColumn(1).width=35,c.getColumn(2).width=60,c.getColumn(3).width=20,c.getColumn(4).width=20,c.eachRow({includeEmpty:!1},x=>{x.alignment={vertical:"top",wrapText:!0}});const a=await h.xlsx.writeBuffer(),F=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),C=`${n.title.replace(/[^a-z0-9]/gi,"_")}-ACH-Analysis.xlsx`;Ke.saveAs(F,C)}catch(u){console.error("Excel export error:",u),alert("Failed to export Excel file. Please try again.")}finally{w(!1)}};return e.jsx(V,{variant:E,size:d,onClick:t,disabled:N,className:T,children:N?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating Excel..."]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"Export Excel"]})})}function ft(){const{id:n}=me(),E=fe(),[d,T]=H.useState(null),[N,w]=H.useState(!0),[p,g]=H.useState(!1),[t,u]=H.useState(!1),h=async()=>{if(n)try{w(!0);const i=await fetch(`/api/ach?id=${n}`);if(i.ok){const b=await i.json();T(b)}else throw new Error("Analysis not found")}catch(i){console.error("Failed to load analysis:",i),alert("Failed to load analysis"),E("/dashboard/analysis-frameworks/ach-dashboard")}finally{w(!1)}};H.useEffect(()=>{h()},[n]);const f=async(i,b,o,y)=>{if(d)try{await fetch("/api/ach/scores",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ach_analysis_id:d.id,hypothesis_id:i,evidence_id:b,score:o,notes:y})}),await h()}catch(R){console.error("Failed to update score:",R),alert("Failed to update score")}},z=()=>{alert("Navigate to Evidence Library to add evidence items, then link them to this analysis."),E("/dashboard/evidence")},v=async i=>{if(confirm("Remove this evidence from the analysis?"))try{await fetch(`/api/ach/evidence?id=${i}`,{method:"DELETE"}),await h()}catch(b){console.error("Failed to remove evidence:",b),alert("Failed to remove evidence")}},r=()=>{g(!0)},s=async i=>{if(d)try{if(await fetch(`/api/ach?id=${d.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:i.title,description:i.description,question:i.question,analyst:i.analyst,organization:i.organization,scale_type:i.scale_type,status:i.status})}),d.hypotheses)for(const y of d.hypotheses)i.hypotheses.find(S=>S.id===y.id)||await fetch(`/api/ach/hypotheses?id=${y.id}`,{method:"DELETE"});for(const y of i.hypotheses)y.id?await fetch(`/api/ach/hypotheses?id=${y.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}):await fetch("/api/ach/hypotheses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...y,ach_analysis_id:d.id})});const b=d.evidence?.map(y=>y.evidence_id)||[],o=i.evidence_ids||[];for(const y of b)if(!o.includes(y)){const R=d.evidence?.find(S=>S.evidence_id===y);R?.link_id&&await fetch(`/api/ach/evidence?id=${R.link_id}`,{method:"DELETE"})}for(const y of o)b.includes(y)||await fetch("/api/ach/evidence",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ach_analysis_id:d.id,evidence_id:y})});await h(),g(!1)}catch(b){throw console.error("Error saving analysis:",b),b}};return N?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading analysis..."})}):d?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsxs(V,{variant:"outline",onClick:()=>E("/dashboard/analysis-frameworks/ach-dashboard"),children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:d.title}),e.jsx(Q,{variant:"outline",children:d.status.replace("_"," ")}),e.jsx(Q,{variant:"secondary",children:d.scale_type})]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-3",children:[e.jsx("strong",{children:"Key Question:"})," ",d.question]}),d.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:d.description})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(V,{variant:"outline",onClick:async()=>{const i=[];if(d.evidence&&d.evidence.length>0)for(const o of d.evidence)try{const y=await fetch(`/api/evidence-items?id=${o.evidence_id}`);if(y.ok){const R=await y.json();R.linked_actors&&Array.isArray(R.linked_actors)&&i.push(...R.linked_actors)}}catch(y){console.log("Error fetching evidence actors:",y)}const b=[...new Set(i)];E("/dashboard/network-graph",{state:{highlightEntities:b,source:"ach",title:d.title}})},children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"View in Network"]}),e.jsxs(pe,{children:[e.jsx(xe,{asChild:!0,children:e.jsxs(V,{variant:"outline",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Export"]})}),e.jsxs(ge,{align:"end",children:[e.jsx(Z,{asChild:!0,children:e.jsx("div",{className:"w-full",children:e.jsx(et,{analysis:d,size:"sm",className:"w-full justify-start"})})}),e.jsx(Z,{asChild:!0,children:e.jsx("div",{className:"w-full",children:e.jsx(tt,{analysis:d,size:"sm",className:"w-full justify-start"})})}),e.jsx(Z,{asChild:!0,children:e.jsx("div",{className:"w-full",children:e.jsx(st,{analysis:d,size:"sm",className:"w-full justify-start"})})})]})]}),e.jsx(qe,{analysisId:d.id,isPublic:d.is_public||!1,shareToken:d.share_token,domain:d.domain,tags:d.tags,onUpdate:()=>h()}),e.jsxs(V,{onClick:r,children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Edit Analysis"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[d.analyst&&e.jsx(q,{children:e.jsxs(J,{className:"p-4 flex items-center gap-3",children:[e.jsx(Ye,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Analyst"}),e.jsx("p",{className:"font-medium",children:d.analyst})]})]})}),d.organization&&e.jsx(q,{children:e.jsxs(J,{className:"p-4 flex items-center gap-3",children:[e.jsx(Ge,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Organization"}),e.jsx("p",{className:"font-medium",children:d.organization})]})]})}),e.jsx(q,{children:e.jsxs(J,{className:"p-4 flex items-center gap-3",children:[e.jsx(Be,{className:"h-5 w-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Created"}),e.jsx("p",{className:"font-medium",children:new Date(d.created_at).toLocaleDateString()})]})]})})]}),e.jsx(Te,{analysis:d,onUpdateScore:f,onAddEvidence:z,onRemoveEvidence:v}),e.jsx(Ze,{analysis:d}),e.jsx(Ee,{open:p,onClose:()=>g(!1),onSave:s,initialData:d,mode:"edit"})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Analysis not found"}),e.jsxs(V,{onClick:()=>E("/dashboard/analysis-frameworks/ach-dashboard"),children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Back to ACH Analyses"]})]})}export{ft as ACHAnalysisPage};
