import{j as e}from"./ui-vendor-DBphXmDA.js";import{f as J,r as l}from"./react-vendor-CfYLSWvh.js";import{u as E,d as K,l as W,m as Q,n as Y,o as Z,p as ee,s as se,B as x,y as z,q as ie,I as le,S as H,z as L,C as O,E as I,F as i,e as A}from"./index-QqleixXe.js";import{ao as F,b4 as P,a as ne,aK as oe,bs as ce,bj as B,a5 as de}from"./icons-x9tcvtYN.js";import{C as q,d as X,a as me,b as xe,c as he}from"./card-BGAig-Dv.js";import{T as ye,a as pe,b as G}from"./tabs-If3dmLWi.js";import"./state-vendor-BXB5jEEt.js";function ge({open:r,onOpenChange:h,libraryFrameworkId:b,frameworkTitle:v,frameworkType:p}){const{t}=E(["library","common"]),{toast:a}=K(),y=J(),[o,j]=l.useState(!1),n=async()=>{const f=localStorage.getItem("omnicore_user_hash");if(!f){a({title:t("common:errors.error"),description:t("common:errors.loginRequired"),variant:"destructive"});return}j(!0);try{const m=await fetch("/api/library/fork",{method:"POST",headers:{"Content-Type":"application/json","X-User-Hash":f},body:JSON.stringify({library_framework_id:b})}),g=await m.json();m.ok?(a({title:t("common:success"),description:t("library:fork.success")}),h(!1),g.forked_framework_id&&y(`/dashboard/frameworks/${p}/${g.forked_framework_id}`)):a({title:t("common:errors.error"),description:g.error||t("library:fork.error"),variant:"destructive"})}catch(m){console.error("[ForkDialog] Error:",m),a({title:t("common:errors.error"),description:t("library:fork.error"),variant:"destructive"})}finally{j(!1)}};return e.jsx(W,{open:r,onOpenChange:h,children:e.jsxs(Q,{className:"sm:max-w-[500px]",children:[e.jsxs(Y,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),t("library:fork.title")]}),e.jsx(ee,{children:t("library:fork.description")})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 space-y-2",children:[e.jsx("div",{className:"font-semibold text-lg",children:v}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t("library:filters.type"),": ",e.jsx("span",{className:"font-medium",children:p.toUpperCase()})]})]}),e.jsx("div",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:t("library:fork.confirm")})]}),e.jsxs(se,{children:[e.jsx(x,{variant:"outline",onClick:()=>h(!1),disabled:o,children:t("common:cancel")}),e.jsxs(x,{onClick:n,disabled:o,children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),t(o?"library:fork.forking":"library:fork.workspaceSelect")]})]})]})})}function ue({open:r,onOpenChange:h,libraryFrameworkId:b,frameworkTitle:v,currentRating:p=0,onRatingSubmitted:t}){const{t:a}=E(["library","common"]),{toast:y}=K(),[o,j]=l.useState(!1),[n,f]=l.useState(p),[m,g]=l.useState(0),[N,C]=l.useState(""),w=async()=>{const c=localStorage.getItem("omnicore_user_hash");if(!c){y({title:a("common:errors.error"),description:a("common:errors.loginRequired"),variant:"destructive"});return}if(n===0){y({title:a("common:errors.error"),description:a("library:rate.yourRating"),variant:"destructive"});return}j(!0);try{const d=await fetch("/api/library/rate",{method:"POST",headers:{"Content-Type":"application/json","X-User-Hash":c},body:JSON.stringify({library_framework_id:b,rating:n,review_text:N})}),T=await d.json();d.ok?(y({title:a("common:success"),description:a("library:rate.success")}),h(!1),t?.(),f(0),C("")):y({title:a("common:errors.error"),description:T.error||a("library:rate.error"),variant:"destructive"})}catch(d){console.error("[RatingDialog] Error:",d),y({title:a("common:errors.error"),description:a("library:rate.error"),variant:"destructive"})}finally{j(!1)}};return e.jsx(W,{open:r,onOpenChange:h,children:e.jsxs(Q,{className:"sm:max-w-[500px]",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:a("library:rate.title")}),e.jsx(ee,{children:v})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:a("library:rate.yourRating")}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(c=>e.jsx("button",{type:"button",onClick:()=>f(c),onMouseEnter:()=>g(c),onMouseLeave:()=>g(0),className:"transition-transform hover:scale-110",children:e.jsx(P,{className:`h-8 w-8 ${c<=(m||n)?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},c))}),n>0&&e.jsxs("p",{className:"text-sm text-gray-600",children:[n," / 5 ",a("library:card.rating",{avg:n,count:1})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{htmlFor:"review",children:a("library:rate.writeReview")}),e.jsx(ie,{id:"review",value:N,onChange:c=>C(c.target.value),placeholder:a("library:rate.reviewPlaceholder"),rows:4})]})]}),e.jsxs(se,{children:[e.jsx(x,{variant:"outline",onClick:()=>h(!1),disabled:o,children:a("common:cancel")}),e.jsx(x,{onClick:w,disabled:o||n===0,children:o?a("library:rate.submitting"):p>0?a("library:rate.update"):a("library:rate.submit")})]})]})})}function Se(){const{t:r}=E(["library","common"]),h=J(),[b,v]=l.useState([]),[p,t]=l.useState(!0),[a,y]=l.useState(""),[o,j]=l.useState(""),[n,f]=l.useState(""),[m,g]=l.useState("popular"),[N,C]=l.useState("grid"),[w,c]=l.useState(0),[d,T]=l.useState(0),k=20,[re,$]=l.useState(!1),[ae,U]=l.useState(!1),[u,V]=l.useState(null);l.useEffect(()=>{R()},[a,o,n,m,d]);const R=async()=>{t(!0);try{const s=new URLSearchParams({limit:k.toString(),offset:d.toString(),sort:m});a&&s.append("search",a),o&&s.append("type",o),n&&s.append("category",n);const D=localStorage.getItem("omnicore_user_hash"),S={"Content-Type":"application/json"};D&&(S["X-User-Hash"]=D);const _=await fetch(`/api/library?${s}`,{headers:S});if(_.ok){const M=await _.json();v(M.frameworks||[]),c(M.total||0)}}catch(s){console.error("[Library] Fetch error:",s)}finally{t(!1)}},te=async(s,D)=>{const S=localStorage.getItem("omnicore_user_hash");if(!S){alert(r("common:errors.loginRequired"));return}try{(await fetch("/api/library/vote",{method:"POST",headers:{"Content-Type":"application/json","X-User-Hash":S},body:JSON.stringify({library_framework_id:s,vote_type:D})})).ok&&await R()}catch(_){console.error("[Library] Vote error:",_)}};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:r("library:title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:r("library:subtitle")})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(le,{placeholder:r("library:search.placeholder"),value:a,onChange:s=>y(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs(H,{value:o||"all",onValueChange:s=>j(s==="all"?"":s),children:[e.jsx(L,{className:"w-[200px]",children:e.jsx(O,{placeholder:r("library:filters.allTypes")})}),e.jsxs(I,{children:[e.jsx(i,{value:"all",children:r("library:filters.allTypes")}),e.jsx(i,{value:"cog",children:"COG Analysis"}),e.jsx(i,{value:"ach",children:"ACH Analysis"}),e.jsx(i,{value:"swot",children:"SWOT Analysis"}),e.jsx(i,{value:"pest",children:"PEST Analysis"}),e.jsx(i,{value:"pmesii-pt",children:"PMESII-PT"}),e.jsx(i,{value:"dotmlpf",children:"DOTMLPF"})]})]}),e.jsxs(H,{value:n||"all",onValueChange:s=>f(s==="all"?"":s),children:[e.jsx(L,{className:"w-[200px]",children:e.jsx(O,{placeholder:r("library:filters.allCategories")})}),e.jsxs(I,{children:[e.jsx(i,{value:"all",children:r("library:filters.allCategories")}),e.jsx(i,{value:"adversary_analysis",children:r("library:categories.adversary_analysis")}),e.jsx(i,{value:"friendly_analysis",children:r("library:categories.friendly_analysis")}),e.jsx(i,{value:"host_nation",children:r("library:categories.host_nation")}),e.jsx(i,{value:"strategic_planning",children:r("library:categories.strategic_planning")}),e.jsx(i,{value:"intelligence",children:r("library:categories.intelligence")})]})]}),e.jsxs(H,{value:m,onValueChange:g,children:[e.jsx(L,{className:"w-[180px]",children:e.jsx(O,{})}),e.jsxs(I,{children:[e.jsx(i,{value:"popular",children:r("library:filters.sort.popular")}),e.jsx(i,{value:"recent",children:r("library:filters.sort.recent")}),e.jsx(i,{value:"trending",children:r("library:filters.sort.trending")}),e.jsx(i,{value:"top_rated",children:r("library:filters.sort.top_rated")}),e.jsx(i,{value:"most_forked",children:r("library:filters.sort.most_forked")})]})]}),e.jsx("div",{className:"ml-auto",children:e.jsx(ye,{value:N,onValueChange:s=>C(s),children:e.jsxs(pe,{children:[e.jsx(G,{value:"grid",children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(G,{value:"list",children:e.jsx(ce,{className:"h-4 w-4"})})]})})})]})]}),!p&&e.jsx("div",{className:"mb-4 text-sm text-gray-600 dark:text-gray-400",children:r("library:search.results",{count:w})}),p?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-gray-100"})}):b.length===0?e.jsx(q,{children:e.jsxs(X,{className:"py-12 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:r("library:empty.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:r("library:empty.description")})]})}):e.jsx("div",{className:N==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6":"space-y-4",children:b.map(s=>e.jsxs(q,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(me,{children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx(xe,{className:"text-lg mb-2",children:s.title}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(A,{variant:"outline",children:s.framework_type.toUpperCase()}),s.category&&e.jsx(A,{variant:"secondary",children:r(`library:categories.${s.category}`)})]})]})}),e.jsx(he,{className:"line-clamp-3",children:s.description})]}),e.jsxs(X,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:s.vote_score})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{children:s.rating_count>0?`${s.rating_avg.toFixed(1)} (${s.rating_count})`:r("library:card.noRating")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:s.fork_count})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:s.view_count})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{size:"sm",variant:s.user_vote==="up"?"default":"outline",onClick:()=>te(s.id,"up"),className:"flex-1",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),r("library:card.upvote")]}),e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>{V(s),U(!0)},className:"flex-1",children:[e.jsx(P,{className:"h-4 w-4 mr-1"}),r("library:card.rate")]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>{V(s),$(!0)},className:"flex-1",children:[e.jsx(F,{className:"h-4 w-4 mr-1"}),r("library:card.fork")]}),e.jsx(x,{size:"sm",variant:"outline",onClick:()=>h(`/dashboard/frameworks/${s.framework_type}/${s.framework_id}`),className:"flex-1",children:r("library:card.viewDetails")})]})]})]})]},s.id))}),w>k&&e.jsxs("div",{className:"mt-6 flex justify-center gap-2",children:[e.jsx(x,{variant:"outline",disabled:d===0,onClick:()=>T(Math.max(0,d-k)),children:r("common:pagination.previous")}),e.jsx(x,{variant:"outline",disabled:d+k>=w,onClick:()=>T(d+k),children:r("common:pagination.next")})]}),u&&e.jsx(ge,{open:re,onOpenChange:$,libraryFrameworkId:u.id,frameworkTitle:u.title,frameworkType:u.framework_type}),u&&e.jsx(ue,{open:ae,onOpenChange:U,libraryFrameworkId:u.id,frameworkTitle:u.title,currentRating:u.user_rating||0,onRatingSubmitted:R})]})}export{Se as PublicLibraryPage};
