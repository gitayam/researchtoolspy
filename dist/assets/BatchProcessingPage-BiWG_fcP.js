import{j as e}from"./ui-vendor-DBphXmDA.js";import{f as pe,r as h}from"./react-vendor-CfYLSWvh.js";import{u as ge,B as d,y as x,S as M,z as V,C as W,E as _,F as m,q as je,I as be}from"./index-QqleixXe.js";import{C as j,a as b,b as f,c as S,d as y}from"./card-BGAig-Dv.js";import{C as q}from"./checkbox-DueJeeKx.js";import{P as fe}from"./progress-Cg1bbsHw.js";import{T as ye,a as ve,b as H,c as K}from"./tabs-If3dmLWi.js";import{a as Ne,l as Te,b as Pe}from"./citation-library-DsFrzEV3.js";import{_ as we,L as X,b0 as Ce,q as ke,C as Se,d as v,a1 as Y,A as $e,h as Q,P as Z,Y as De,az as Fe,a7 as Ee}from"./icons-x9tcvtYN.js";import"./state-vendor-BXB5jEEt.js";function Me(){const N=pe(),{t}=ge(),[$,ee]=h.useState("analyze-url"),[se,D]=h.useState("paste"),[p,T]=h.useState(""),[F,E]=h.useState(!1),[i,P]=h.useState(null),[L,u]=h.useState(null),[O,te]=h.useState(3),[I,ae]=h.useState(!1),[R,re]=h.useState(!1),[g,ie]=h.useState([]),[w,U]=h.useState(!1),[z,A]=h.useState(!1),C=a=>a.split(`
`).map(s=>s.trim()).filter(s=>s&&s.startsWith("http")),B=async a=>{try{await navigator.clipboard.writeText(a),A(!0),setTimeout(()=>A(!1),2e3)}catch(s){console.error("Failed to copy:",s),alert("Failed to copy to clipboard")}},oe=async a=>{const s=a.target.files?.[0];if(!s)return;const r=(await s.text()).split(`
`).slice(1).map(n=>n.split(",")[0].trim()).filter(n=>n&&n.startsWith("http"));T(r.join(`
`)),D("paste")},ce=async()=>{const a=C(p);if(a.length===0){u(t("batchProcessingTool.pleaseEnterUrl"));return}if(a.length>20){u(t("batchProcessingTool.maxUrlsExceeded"));return}E(!0),u(null),P(null);try{const o=await(await fetch("/api/tools/batch-process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({operation:$,items:a.map((c,r)=>({id:`url-${r+1}`,type:"url",source:c})),options:{maxWorkers:O,stopOnError:I,retryFailed:R,createDatasets:!1}})})).json();o.error?u(o.error):P(o)}catch(s){u(s.message||"Failed to process batch")}finally{E(!1)}},ne=()=>{if(!i)return;const a=JSON.stringify(i,null,2),s=new Blob([a],{type:"application/json"}),o=URL.createObjectURL(s),c=document.createElement("a");c.href=o,c.download=`batch-results-${i.jobId}.json`,c.click(),URL.revokeObjectURL(o)},le=()=>{if(!i)return;const a=["ID","URL","Status","Duration (ms)","Error"],s=i.items.map(l=>[l.id,l.source,l.status,l.duration||"",l.error||""]),o=[a,...s].map(l=>l.map(k=>`"${k}"`).join(",")).join(`
`),c=new Blob([o],{type:"text/csv"}),r=URL.createObjectURL(c),n=document.createElement("a");n.href=r,n.download=`batch-results-${i.jobId}.csv`,n.click(),URL.revokeObjectURL(r)},de=()=>{if(!i)return;const a=i.items.filter(o=>o.status==="success"&&o.result);if(a.length===0){alert("No successful results to create citations from");return}const s=[];a.forEach(o=>{const c=o.result;if(c.metadata&&c.metadata.title)try{const n={authors:c.metadata.author?[{firstName:c.metadata.author.split(" ")[0]||"",lastName:c.metadata.author.split(" ").slice(-1)[0]||"",middleName:""}]:[{firstName:"",lastName:"Unknown",middleName:""}],title:c.metadata.title||o.source,year:c.metadata.publishDate||c.domain?.registrationDate||"",url:o.source,siteName:c.metadata.siteName||c.domain?.name||"",accessDate:new Date().toISOString().split("T")[0]},{citation:l,inTextCitation:k}=Ne(n,"website","apa"),J={id:Te(),citationStyle:"apa",sourceType:"website",fields:n,citation:l,inTextCitation:k,addedAt:new Date().toISOString()};Pe(J),s.push(J)}catch(r){console.error("Failed to create citation:",r)}}),s.length>0?(ie(s),U(!0),alert(`${s.length} citation(s) created and displayed below!`)):alert("Could not create citations from these results. Try using URLs with better metadata.")},he=async()=>{if(!i)return;const a=i.items.filter(s=>s.status==="success");if(a.length===0){alert("No successful results to save");return}try{const s={title:`Batch Analysis - ${new Date().toLocaleDateString()}`,description:`Batch ${i.operation} of ${i.total} URLs`,source:"batch-processing",type:"batch_analysis",source_name:"Batch Processing Tool",tags:["batch",i.operation],metadata:JSON.stringify({jobId:i.jobId,operation:i.operation,total:i.total,succeeded:i.succeeded,failed:i.failed,items:a.map(c=>({source:c.source,result:c.result}))}),access_date:new Date().toISOString().split("T")[0],public:!1},o=await fetch("/api/datasets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(o.ok){const{dataset:c}=await o.json();confirm(`Dataset created successfully! ID: ${c.id}

Go to Dataset Library?`)&&N("/dashboard/datasets")}else throw new Error("Failed to create dataset")}catch(s){console.error("Dataset creation error:",s),alert("Failed to save as dataset. Please try again.")}},xe=()=>{alert(`Add to Evidence feature coming in Phase 3!

This will allow you to convert batch results into evidence items with claims.`)},me=()=>{if(!i)return;const a=i.items.filter(o=>o.status==="success"&&o.result);if(a.length===0){alert("No successful results to summarize");return}let s=`Content Summary
${"=".repeat(50)}

`;s+=`Operation: ${G(i.operation)}
`,s+=`Sources Analyzed: ${a.length}
`,s+=`Date: ${new Date().toLocaleDateString()}

`,s+=`${"=".repeat(50)}

`,a.forEach((o,c)=>{const r=o.result;if(s+=`${c+1}. ${o.source}
`,s+=`${"-".repeat(50)}
`,i.operation==="analyze-url")r.metadata&&(r.metadata.title&&(s+=`Title: ${r.metadata.title}
`),r.metadata.author&&(s+=`Author: ${r.metadata.author}
`),r.metadata.publishDate&&(s+=`Published: ${r.metadata.publishDate}
`),r.metadata.description&&(s+=`
Description:
${r.metadata.description}
`)),r.domain?.name&&(s+=`Source: ${r.domain.name}
`),r.reliability&&(s+=`
Reliability: ${r.reliability.score}/100 (${r.reliability.category})
`,r.reliability.notes&&r.reliability.notes.length>0&&(s+=`Notes:
${r.reliability.notes.map(n=>`  • ${n}`).join(`
`)}
`));else if(i.operation==="extract-content"){if(r.metadata?.title&&(s+=`Title: ${r.metadata.title}
`),r.content?.text){const n=r.content.text.trim(),l=n.length>500?n.substring(0,500)+"...":n;s+=`
Content Preview:
${l}
`,s+=`
Total Characters: ${n.length}
`}r.analysis&&(s+=`
Analysis:
`,r.analysis.summary&&(s+=`Summary: ${r.analysis.summary}
`),r.analysis.keyPoints&&r.analysis.keyPoints.length>0&&(s+=`Key Points:
${r.analysis.keyPoints.map(n=>`  • ${n}`).join(`
`)}
`))}else i.operation==="scrape-metadata"&&(r.title&&(s+=`Title: ${r.title}
`),r.author&&(s+=`Author: ${r.author}
`),r.description&&(s+=`Description: ${r.description}
`),r.siteName&&(s+=`Site: ${r.siteName}
`),r.publishDate&&(s+=`Published: ${r.publishDate}
`),r.openGraph&&(s+=`
Open Graph Data:
`,Object.entries(r.openGraph).forEach(([n,l])=>{typeof l=="string"&&(s+=`  ${n}: ${l}
`)})));s+=`
`}),s+=`${"=".repeat(50)}
`,s+=`Processing Stats:
`,s+=`  Total Processed: ${i.total}
`,s+=`  Successful: ${i.succeeded}
`,s+=`  Failed: ${i.failed}
`,s+=`  Duration: ${((i.duration||0)/1e3).toFixed(1)}s
`,navigator.clipboard.writeText(s).then(()=>{alert("Content summary copied to clipboard!")}).catch(()=>{alert(s)})},ue=a=>{switch(a){case"success":return e.jsx(Ee,{className:"h-4 w-4 text-green-600 dark:text-green-400"});case"error":return e.jsx(Fe,{className:"h-4 w-4 text-red-600 dark:text-red-400"});case"processing":return e.jsx(X,{className:"h-4 w-4 text-blue-600 dark:text-blue-400 animate-spin"});default:return e.jsx(De,{className:"h-4 w-4 text-gray-400"})}},G=a=>{switch(a){case"analyze-url":return"URL Analysis";case"scrape-metadata":return"Metadata Extraction";case"extract-content":return"Content Extraction";case"generate-citation":return"Citation Generation";default:return a}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(d,{variant:"outline",onClick:()=>N("/dashboard/tools"),children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),t("batchProcessingTool.backToTools")]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t("batchProcessingTool.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t("batchProcessingTool.subtitle")})]})]}),e.jsxs(j,{children:[e.jsxs(b,{children:[e.jsx(f,{children:t("batchProcessingTool.configTitle")}),e.jsx(S,{children:t("batchProcessingTool.configDesc")})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:t("batchProcessingTool.operationType")}),e.jsxs(M,{value:$,onValueChange:a=>ee(a),children:[e.jsx(V,{children:e.jsx(W,{})}),e.jsxs(_,{children:[e.jsx(m,{value:"analyze-url",children:t("batchProcessingTool.urlAnalysis")}),e.jsx(m,{value:"scrape-metadata",children:t("batchProcessingTool.metadataExtraction")}),e.jsx(m,{value:"extract-content",children:t("batchProcessingTool.contentExtraction")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:t("batchProcessingTool.inputMethod")}),e.jsxs(ye,{value:se,onValueChange:a=>D(a),children:[e.jsxs(ve,{children:[e.jsx(H,{value:"paste",children:t("batchProcessingTool.pasteUrls")}),e.jsx(H,{value:"csv",children:t("batchProcessingTool.uploadCsv")})]}),e.jsxs(K,{value:"paste",className:"space-y-2 mt-4",children:[e.jsx(x,{htmlFor:"urls",children:t("batchProcessingTool.urlsLabel")}),e.jsx(je,{id:"urls",placeholder:t("batchProcessingTool.urlsPlaceholder"),value:p,onChange:a=>T(a.target.value),className:"min-h-32 font-mono text-sm"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[C(p).length," ",t("batchProcessingTool.validUrlsFound")]})]}),e.jsxs(K,{value:"csv",className:"space-y-2 mt-4",children:[e.jsx(x,{htmlFor:"csv-upload",children:t("batchProcessingTool.uploadCsvFile")}),e.jsx(be,{id:"csv-upload",type:"file",accept:".csv",onChange:oe}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("batchProcessingTool.csvHelperText")})]})]})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsx(x,{children:t("batchProcessingTool.processingOptions")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"workers",children:t("batchProcessingTool.concurrentWorkers")}),e.jsxs(M,{value:String(O),onValueChange:a=>te(Number(a)),children:[e.jsx(V,{id:"workers",children:e.jsx(W,{})}),e.jsxs(_,{children:[e.jsx(m,{value:"1",children:t("batchProcessingTool.sequential")}),e.jsx(m,{value:"2",children:t("batchProcessingTool.slow")}),e.jsx(m,{value:"3",children:t("batchProcessingTool.balanced")}),e.jsx(m,{value:"4",children:t("batchProcessingTool.fast")}),e.jsx(m,{value:"5",children:t("batchProcessingTool.veryFast")})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{id:"stop-on-error",checked:I,onCheckedChange:a=>ae(a)}),e.jsx("label",{htmlFor:"stop-on-error",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:t("batchProcessingTool.stopOnError")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{id:"retry-failed",checked:R,onCheckedChange:a=>re(a)}),e.jsx("label",{htmlFor:"retry-failed",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:t("batchProcessingTool.retryFailed")})]})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(d,{onClick:ce,disabled:F||C(p).length===0,children:F?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4 mr-2 animate-spin"}),t("batchProcessingTool.processing")]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),t("batchProcessingTool.startProcessing")]})}),e.jsxs(d,{variant:"outline",onClick:()=>{T(""),P(null),u(null)},children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),t("batchProcessingTool.clear")]})]}),L&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 rounded-md",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:L})]})]})]}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(j,{children:[e.jsxs(b,{children:[e.jsxs(f,{className:"flex items-center justify-between",children:[e.jsx("span",{children:t("batchProcessingTool.batchResults")}),e.jsxs("span",{className:"text-sm font-normal text-gray-600 dark:text-gray-400",children:[t("batchProcessingTool.jobId"),": ",i.jobId]})]}),e.jsxs(S,{children:[G(i.operation)," • ",t("batchProcessingTool.completedIn")," ",((i.duration||0)/1e3).toFixed(1),"s"]})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[t("batchProcessingTool.progress"),": ",i.processed,"/",i.total," ",t("batchProcessingTool.items")]}),e.jsxs("span",{className:"font-medium",children:[Math.round(i.processed/i.total*100),"%"]})]}),e.jsx(fe,{value:i.processed/i.total*100,className:"h-2"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 dark:bg-green-900/20 rounded",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:i.succeeded}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("batchProcessingTool.succeeded")})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 dark:bg-red-900/20 rounded",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:i.failed}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("batchProcessingTool.failed")})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:i.total-i.processed}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("batchProcessingTool.pending")})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(x,{children:t("batchProcessingTool.processResults")}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:de,disabled:i.succeeded===0,children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),t("batchProcessingTool.createCitations")]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:he,disabled:i.succeeded===0,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),t("batchProcessingTool.saveAsDataset")]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:xe,disabled:i.succeeded===0,children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),t("batchProcessingTool.addToEvidence")]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:me,disabled:i.succeeded===0,children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),t("batchProcessingTool.generateSummary")]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:t("batchProcessingTool.exportResults")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:ne,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),t("batchProcessingTool.exportJson")]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:le,children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),t("batchProcessingTool.exportCsv")]})]})]})]})]}),e.jsxs(j,{children:[e.jsx(b,{children:e.jsx(f,{children:t("batchProcessingTool.processingResults")})}),e.jsx(y,{children:e.jsx("div",{className:"space-y-2",children:i.items.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[ue(a.status),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:a.source}),a.error&&e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 truncate",children:a.error})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400",children:[a.duration&&e.jsxs("span",{children:[(a.duration/1e3).toFixed(2),"s"]}),e.jsx("span",{className:"capitalize",children:a.status})]})]},a.id))})})]}),g.length>0&&e.jsxs(j,{children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(f,{children:t("batchProcessingTool.generatedCitations")}),e.jsxs(S,{children:[g.length," ",t("batchProcessingTool.citationsCreated")]})]}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>U(!w),children:t(w?"batchProcessingTool.hideCitations":"batchProcessingTool.showCitations")})]})}),w&&e.jsxs(y,{className:"space-y-3",children:[e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:g.map((a,s)=>e.jsx("div",{className:"p-3 border rounded-lg dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mt-1",children:[s+1,"."]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-sm text-gray-900 dark:text-white whitespace-pre-wrap",children:a.citation})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>B(a.citation),children:z?e.jsx(Q,{className:"h-4 w-4"}):e.jsx(Z,{className:"h-4 w-4"})})]})},a.id))}),e.jsxs("div",{className:"flex gap-2 pt-3 border-t dark:border-gray-700",children:[e.jsx(d,{variant:"outline",onClick:()=>{const a=g.map((s,o)=>`${o+1}. ${s.citation}`).join(`

`);B(a)},children:z?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),t("contentExtractionTool.copied")]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),t("batchProcessingTool.copyAll")]})}),e.jsxs(d,{variant:"outline",onClick:()=>N("/dashboard/tools/citations-generator"),children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),t("batchProcessingTool.viewInLibrary")]})]})]})]})]})]})}export{Me as BatchProcessingPage};
