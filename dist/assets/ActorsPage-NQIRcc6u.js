import{j as e}from"./ui-vendor-DBphXmDA.js";import{r as l,f as fe,k as Oe,u as Ee}from"./react-vendor-CfYLSWvh.js";import{A as Te,r as Re,y as u,I as w,S as ve,z as Ne,C as _e,E as be,F as E,B as k,e as c,q as ne,l as we,m as ke,n as Ce,o as Se,u as Ie}from"./index-QqleixXe.js";import{C as x,a as j,b as g,c as M,d as h}from"./card-BGAig-Dv.js";import{S as se}from"./slider-B52ikc1m.js";import{C as Me,X as te,G as de,am as xe,U as oe,c as Ae,_ as Pe,N as De,$ as he,q as Fe,V as me,x as pe,W as ce,T as je,ad as Le,l as ge,d as ze,ai as $e,a as He}from"./icons-x9tcvtYN.js";import{P as le}from"./progress-Cg1bbsHw.js";import{T as Ge,a as Ue,b as ie,c as re}from"./tabs-If3dmLWi.js";import{S as ue}from"./separator-ozDNNLDu.js";import{M as Ve}from"./MOMAssessmentList-CQifLAG2.js";import"./checkbox-DueJeeKx.js";import{R as Be,a as qe,F as Ke}from"./FrameworkUsagePanel-BaPMlEIm.js";import"./radio-group-Dj8G6QwH.js";import"./state-vendor-BXB5jEEt.js";function ye({actor:t,onSubmit:S,onCancel:Z}){const[N,P]=l.useState(!1),[J,T]=l.useState(null),[a,m]=l.useState({name:t?.name||"",type:t?.type||"PERSON",aliases:t?.aliases||[],description:t?.description||"",category:t?.category||"",role:t?.role||"",affiliation:t?.affiliation||"",online_presence:{websites:[],social_media:[],emails:[]},physical_details:{nationality:"",location:"",headquarters:"",areas_of_operation:[]},organizational_details:{size:"",structure:"",founded:"",leadership:[]},capabilities:{known_capabilities:[],resources:"",expertise_areas:[]},deception_profile:t?.deception_profile||{mom:{motive:0,opportunity:0,means:0,notes:""},pop:{historical_pattern:0,sophistication_level:0,success_rate:0,notes:""},overall_assessment:{scores:{motive:0,opportunity:0,means:0,historicalPattern:0,sophisticationLevel:0,successRate:0,sourceVulnerability:0,manipulationEvidence:0,internalConsistency:5,externalCorroboration:5,anomalyDetection:0},overallLikelihood:0,confidenceLevel:"LOW",riskLevel:"MINIMAL",categoryScores:{mom:0,pop:0,moses:0,eve:0},breakdown:[]},last_updated:new Date().toISOString()}}),[R,z]=l.useState(""),[D,F]=l.useState(""),[V,L]=l.useState(""),[Q,B]=l.useState(""),[_,v]=l.useState(""),[O,$]=l.useState(""),H=()=>{R.trim()&&!a.aliases.includes(R.trim())&&(m({...a,aliases:[...a.aliases,R.trim()]}),z(""))},X=s=>{m({...a,aliases:a.aliases.filter(i=>i!==s)})},A=(s,i,o,d)=>{o.trim()&&(m(p=>({...p,[s]:{...p[s],[i]:[...p[s][i],o.trim()]}})),d(""))},G=(s,i,o)=>{m(d=>({...d,[s]:{...d[s],[i]:d[s][i].filter(p=>p!==o)}}))},Y=()=>{const s=(a.deception_profile.mom.motive+a.deception_profile.mom.opportunity+a.deception_profile.mom.means)/3,i=(a.deception_profile.pop.historical_pattern+a.deception_profile.pop.sophistication_level+a.deception_profile.pop.success_rate)/3,d=(s+i)/2/5*100;let p;return d>=75?p="CRITICAL":d>=50?p="HIGH":d>=25?p="MEDIUM":p="LOW",{percentage:Math.round(d),risk:p}},C=s=>{switch(s){case"CRITICAL":return"bg-red-100 text-red-800";case"HIGH":return"bg-orange-100 text-orange-800";case"MEDIUM":return"bg-yellow-100 text-yellow-800";default:return"bg-green-100 text-green-800"}},ee=async s=>{s.preventDefault(),P(!0),T(null);try{const i={online_presence:a.online_presence,physical_details:a.physical_details,organizational_details:a.organizational_details,capabilities:a.capabilities},o={name:a.name,type:a.type,aliases:a.aliases,description:JSON.stringify(i),category:a.category,role:a.role,affiliation:a.affiliation,deception_profile:a.deception_profile};await S(o)}catch(i){T(i instanceof Error?i.message:"Failed to save actor"),P(!1)}},{percentage:b,risk:q}=Y(),K=a.type==="PERSON",U=["ORGANIZATION","UNIT","GOVERNMENT","GROUP"].includes(a.type);return e.jsxs("form",{onSubmit:ee,className:"space-y-6",children:[J&&e.jsxs(Te,{variant:"destructive",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx(Re,{children:J})]}),e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Basic Information"}),e.jsx(M,{children:"Identify the actor"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"name",children:"Name *"}),e.jsx(w,{id:"name",value:a.name,onChange:s=>m({...a,name:s.target.value}),placeholder:"e.g., John Doe, Acme Corp, Wagner Group",required:!0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"type",children:"Actor Type *"}),e.jsxs(ve,{value:a.type,onValueChange:s=>m({...a,type:s}),children:[e.jsx(Ne,{id:"type",children:e.jsx(_e,{})}),e.jsxs(be,{children:[e.jsx(E,{value:"PERSON",children:"ðŸ‘¤ Person / Individual"}),e.jsx(E,{value:"ORGANIZATION",children:"ðŸ¢ Organization / Company"}),e.jsx(E,{value:"UNIT",children:"âš”ï¸ Military / Intelligence Unit"}),e.jsx(E,{value:"GOVERNMENT",children:"ðŸ›ï¸ Government / State Actor"}),e.jsx(E,{value:"GROUP",children:"ðŸ‘¥ Group / Collective"}),e.jsx(E,{value:"OTHER",children:"â“ Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"aliases",children:"Aliases / Also Known As"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{id:"aliases",value:R,onChange:s=>z(s.target.value),onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),H()),placeholder:"Add alias and press Enter"}),e.jsx(k,{type:"button",onClick:H,variant:"outline",children:"Add"})]}),a.aliases.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:a.aliases.map(s=>e.jsxs(c,{variant:"secondary",className:"flex items-center gap-1",children:[s,e.jsx(te,{className:"h-3 w-3 cursor-pointer",onClick:()=>X(s)})]},s))})]})]})]}),e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Classification & Role"}),e.jsx(M,{children:"Categorize and describe the actor's position"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"category",children:"Category"}),e.jsx(w,{id:"category",value:a.category,onChange:s=>m({...a,category:s.target.value}),placeholder:K?"e.g., Military, Political, Intelligence, Criminal":"e.g., Defense, Technology, Finance, Media"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"role",children:"Role / Position"}),e.jsx(w,{id:"role",value:a.role,onChange:s=>m({...a,role:s.target.value}),placeholder:K?"e.g., Commander, Minister, Operative, CEO":"e.g., Defense Contractor, Think Tank, PMC"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"affiliation",children:"Affiliation / Parent Organization"}),e.jsx(w,{id:"affiliation",value:a.affiliation,onChange:s=>m({...a,affiliation:s.target.value}),placeholder:"e.g., Russian Federation, Wagner Group, NATO"})]})]})]}),e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5"}),"Online Presence & Contact"]}),e.jsx(M,{children:"Digital footprint and contact methods"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Websites"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{value:D,onChange:s=>F(s.target.value),placeholder:"https://...",onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),A("online_presence","websites",D,F))}),e.jsx(k,{type:"button",onClick:()=>A("online_presence","websites",D,F),variant:"outline",children:"Add"})]}),a.online_presence.websites.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:a.online_presence.websites.map(s=>e.jsxs(c,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),s,e.jsx(te,{className:"h-3 w-3 cursor-pointer",onClick:()=>G("online_presence","websites",s)})]},s))})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Social Media Profiles"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{value:V,onChange:s=>L(s.target.value),placeholder:"@username or full URL",onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),A("online_presence","social_media",V,L))}),e.jsx(k,{type:"button",onClick:()=>A("online_presence","social_media",V,L),variant:"outline",children:"Add"})]}),a.online_presence.social_media.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:a.online_presence.social_media.map(s=>e.jsxs(c,{variant:"secondary",className:"flex items-center gap-1",children:[s,e.jsx(te,{className:"h-3 w-3 cursor-pointer",onClick:()=>G("online_presence","social_media",s)})]},s))})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Email Addresses"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{value:Q,onChange:s=>B(s.target.value),placeholder:"email@example.com",type:"email",onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),A("online_presence","emails",Q,B))}),e.jsx(k,{type:"button",onClick:()=>A("online_presence","emails",Q,B),variant:"outline",children:"Add"})]}),a.online_presence.emails.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:a.online_presence.emails.map(s=>e.jsxs(c,{variant:"secondary",className:"flex items-center gap-1",children:[s,e.jsx(te,{className:"h-3 w-3 cursor-pointer",onClick:()=>G("online_presence","emails",s)})]},s))})]})]})]}),e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"Location & Areas of Operation"]})}),e.jsxs(h,{className:"space-y-4",children:[K&&e.jsxs("div",{children:[e.jsx(u,{htmlFor:"nationality",children:"Nationality"}),e.jsx(w,{id:"nationality",value:a.physical_details.nationality,onChange:s=>m({...a,physical_details:{...a.physical_details,nationality:s.target.value}}),placeholder:"e.g., Russian, American, British"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"location",children:U?"Headquarters / Main Location":"Known Location"}),e.jsx(w,{id:"location",value:U?a.physical_details.headquarters:a.physical_details.location,onChange:s=>m({...a,physical_details:{...a.physical_details,[U?"headquarters":"location"]:s.target.value}}),placeholder:"e.g., Moscow, Washington DC, London"})]}),e.jsxs("div",{children:[e.jsx(u,{children:"Areas of Operation"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{value:_,onChange:s=>v(s.target.value),placeholder:"Geographic area or region",onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),A("physical_details","areas_of_operation",_,v))}),e.jsx(k,{type:"button",onClick:()=>A("physical_details","areas_of_operation",_,v),variant:"outline",children:"Add"})]}),a.physical_details.areas_of_operation.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:a.physical_details.areas_of_operation.map(s=>e.jsxs(c,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(xe,{className:"h-3 w-3"}),s,e.jsx(te,{className:"h-3 w-3 cursor-pointer",onClick:()=>G("physical_details","areas_of_operation",s)})]},s))})]})]})]}),U&&e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5"}),"Organizational Details"]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"size",children:"Size / Personnel"}),e.jsx(w,{id:"size",value:a.organizational_details.size,onChange:s=>m({...a,organizational_details:{...a.organizational_details,size:s.target.value}}),placeholder:"e.g., 10,000+ employees, 50-100 operatives"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"founded",children:"Founded / Established"}),e.jsx(w,{id:"founded",value:a.organizational_details.founded,onChange:s=>m({...a,organizational_details:{...a.organizational_details,founded:s.target.value}}),placeholder:"e.g., 2014, 1990s, Post-Soviet era"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"structure",children:"Structure / Organization Type"}),e.jsx(w,{id:"structure",value:a.organizational_details.structure,onChange:s=>m({...a,organizational_details:{...a.organizational_details,structure:s.target.value}}),placeholder:"e.g., Hierarchical, Cellular, Network, State-owned"})]})]})]}),e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Capabilities & Expertise"}),e.jsx(M,{children:"Known capabilities, resources, and areas of expertise"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Known Capabilities"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{value:O,onChange:s=>$(s.target.value),placeholder:"e.g., Cyber operations, Disinformation, Military training",onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),A("capabilities","known_capabilities",O,$))}),e.jsx(k,{type:"button",onClick:()=>A("capabilities","known_capabilities",O,$),variant:"outline",children:"Add"})]}),a.capabilities.known_capabilities.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:a.capabilities.known_capabilities.map(s=>e.jsxs(c,{variant:"secondary",className:"flex items-center gap-1",children:[s,e.jsx(te,{className:"h-3 w-3 cursor-pointer",onClick:()=>G("capabilities","known_capabilities",s)})]},s))})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"resources",children:"Resources & Funding"}),e.jsx(ne,{id:"resources",value:a.capabilities.resources,onChange:s=>m({...a,capabilities:{...a.capabilities,resources:s.target.value}}),placeholder:"Describe funding sources, equipment, infrastructure...",rows:2})]})]})]}),e.jsxs(x,{className:"border-2",children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-5 w-5 text-blue-600"}),"MOM-POP Deception Profile"]}),e.jsx(M,{children:"Assess deception capability and patterns"})]}),e.jsxs(c,{className:C(q),children:[q," RISK (",b,"%)"]})]})}),e.jsxs(h,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"MOM - Current Capability"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Motive"}),e.jsxs(c,{variant:"outline",children:[a.deception_profile.mom.motive,"/5"]})]}),e.jsx(se,{value:[a.deception_profile.mom.motive],onValueChange:([s])=>m({...a,deception_profile:{...a.deception_profile,mom:{...a.deception_profile.mom,motive:s}}}),min:0,max:5,step:1}),e.jsx("p",{className:"text-xs text-gray-500",children:"Why would they deceive? Goals, incentives, pressures"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Opportunity"}),e.jsxs(c,{variant:"outline",children:[a.deception_profile.mom.opportunity,"/5"]})]}),e.jsx(se,{value:[a.deception_profile.mom.opportunity],onValueChange:([s])=>m({...a,deception_profile:{...a.deception_profile,mom:{...a.deception_profile.mom,opportunity:s}}}),min:0,max:5,step:1}),e.jsx("p",{className:"text-xs text-gray-500",children:"Do they have access to execute deception?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Means"}),e.jsxs(c,{variant:"outline",children:[a.deception_profile.mom.means,"/5"]})]}),e.jsx(se,{value:[a.deception_profile.mom.means],onValueChange:([s])=>m({...a,deception_profile:{...a.deception_profile,mom:{...a.deception_profile.mom,means:s}}}),min:0,max:5,step:1}),e.jsx("p",{className:"text-xs text-gray-500",children:"Resources, capabilities, technical ability"})]}),e.jsx(ne,{value:a.deception_profile.mom.notes,onChange:s=>m({...a,deception_profile:{...a.deception_profile,mom:{...a.deception_profile.mom,notes:s.target.value}}}),placeholder:"Notes on MOM assessment...",rows:2})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h3",{className:"text-sm font-semibold",children:"POP - Historical Patterns"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Historical Pattern"}),e.jsxs(c,{variant:"outline",children:[a.deception_profile.pop.historical_pattern,"/5"]})]}),e.jsx(se,{value:[a.deception_profile.pop.historical_pattern],onValueChange:([s])=>m({...a,deception_profile:{...a.deception_profile,pop:{...a.deception_profile.pop,historical_pattern:s}}}),min:0,max:5,step:1}),e.jsx("p",{className:"text-xs text-gray-500",children:"Track record of past deception"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Sophistication Level"}),e.jsxs(c,{variant:"outline",children:[a.deception_profile.pop.sophistication_level,"/5"]})]}),e.jsx(se,{value:[a.deception_profile.pop.sophistication_level],onValueChange:([s])=>m({...a,deception_profile:{...a.deception_profile,pop:{...a.deception_profile.pop,sophistication_level:s}}}),min:0,max:5,step:1}),e.jsx("p",{className:"text-xs text-gray-500",children:"Complexity of past deceptions"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Success Rate"}),e.jsxs(c,{variant:"outline",children:[a.deception_profile.pop.success_rate,"/5"]})]}),e.jsx(se,{value:[a.deception_profile.pop.success_rate],onValueChange:([s])=>m({...a,deception_profile:{...a.deception_profile,pop:{...a.deception_profile.pop,success_rate:s}}}),min:0,max:5,step:1}),e.jsx("p",{className:"text-xs text-gray-500",children:"How often have they succeeded?"})]}),e.jsx(ne,{value:a.deception_profile.pop.notes,onChange:s=>m({...a,deception_profile:{...a.deception_profile,pop:{...a.deception_profile.pop,notes:s.target.value}}}),placeholder:"Notes on POP assessment...",rows:2})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(k,{type:"button",variant:"outline",onClick:Z,disabled:N,children:"Cancel"}),e.jsx(k,{type:"submit",disabled:N,children:N?"Saving...":t?"Update Actor":"Create Actor"})]})]})}function We({actor:t,onEdit:S,onDelete:Z}){const N=fe(),[P,J]=l.useState("overview"),[T,a]=l.useState([]),[m,R]=l.useState(!1),[z,D]=l.useState([]),[F,V]=l.useState(!1),[L,Q]=l.useState({}),[B,_]=l.useState(!1),[v,O]=l.useState(void 0),[$,H]=l.useState(!1),[X,A]=l.useState(void 0),[G,Y]=l.useState([]),[C,ee]=l.useState(null),[b,q]=l.useState({}),[K,U]=l.useState(!1);l.useEffect(()=>{const r=async()=>{R(!0);try{const n=localStorage.getItem("omnicore_user_hash"),y=await fetch(`/api/mom-assessments?actor_id=${t.id}`,{headers:{...n&&{Authorization:`Bearer ${n}`}}});if(y.ok){const f=await y.json();a(f.assessments||[])}}catch(n){console.error("Failed to load MOM assessments:",n)}finally{R(!1)}};t.id&&r()},[t.id]),l.useEffect(()=>{const r=async()=>{V(!0);try{const n=localStorage.getItem("omnicore_user_hash"),y=await fetch(`/api/relationships?entity_id=${t.id}&workspace_id=${t.workspace_id}`,{headers:{...n&&{Authorization:`Bearer ${n}`}}});if(y.ok){const f=await y.json();D(f.relationships||[]);const I=new Set;(f.relationships||[]).forEach(W=>{W.source_entity_id!==t.id&&I.add(W.source_entity_id),W.target_entity_id!==t.id&&I.add(W.target_entity_id)});const ae={};for(const W of I)ae[W]=W.substring(0,8);Q(ae)}}catch(n){console.error("Failed to load relationships:",n)}finally{V(!1)}};t.id&&r()},[t.id]),l.useEffect(()=>{const r=async()=>{U(!0);try{const n=localStorage.getItem("omnicore_user_hash"),y=await fetch(`/api/actors/${t.id}/claims`,{headers:{...n&&{Authorization:`Bearer ${n}`}}});if(y.ok){const f=await y.json();Y(f.claims||[]),ee(f.statistics||{}),q(f.grouped_by_role||{})}}catch(n){console.error("Failed to load claims:",n)}finally{U(!1)}};t.id&&r()},[t.id]);const s=r=>{const n={PERSON:"ðŸ‘¤",ORGANIZATION:"ðŸ¢",UNIT:"âš”ï¸",GOVERNMENT:"ðŸ›ï¸",GROUP:"ðŸ‘¥",OTHER:"â“"};return n[r]||n.OTHER},i=r=>{const n={PERSON:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",ORGANIZATION:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",UNIT:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",GOVERNMENT:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",GROUP:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",OTHER:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"};return n[r]||n.OTHER},d=(()=>{if(!t.deception_profile||!t.deception_profile.mom)return{level:"unknown",score:0,color:"gray"};const{motive:r,opportunity:n,means:y}=t.deception_profile.mom,f=((r||0)+(n||0)+(y||0))/3,I=f/5*100;return f>=4?{level:"Critical",score:I,color:"red"}:f>=3?{level:"High",score:I,color:"orange"}:f>=1.5?{level:"Medium",score:I,color:"yellow"}:{level:"Low",score:I,color:"green"}})(),p=r=>{const n={red:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",orange:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",yellow:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",green:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",gray:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"};return n[r]||n.gray};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(k,{variant:"outline",onClick:()=>N("/dashboard/entities/actors"),children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Back to Actors"]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-4xl",children:s(t.type)}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(c,{className:i(t.type),children:t.type}),d.level!=="unknown"&&e.jsxs(c,{className:p(d.color),children:[d.level," Deception Risk"]})]})]})]}),t.aliases&&t.aliases.length>0&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Also known as:"})," ",t.aliases.join(", ")]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",onClick:()=>N("/dashboard/network-graph",{state:{highlightEntities:[t.id],source:"actor",title:t.name}}),children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"View in Network"]}),e.jsxs(k,{variant:"outline",onClick:S,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(k,{variant:"destructive",onClick:Z,children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),e.jsxs(Ge,{value:P,onValueChange:J,children:[e.jsxs(Ue,{className:"grid w-full grid-cols-5",children:[e.jsx(ie,{value:"overview",children:"Overview"}),e.jsx(ie,{value:"deception",children:"Deception Profile"}),e.jsx(ie,{value:"relationships",children:"Relationships"}),e.jsxs(ie,{value:"claims",children:["Claims ",C&&C.total_claims>0&&e.jsx(c,{variant:"secondary",className:"ml-2",children:C.total_claims})]}),e.jsx(ie,{value:"activity",children:"Activity"})]}),e.jsx(re,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(x,{className:"md:col-span-2",children:[e.jsx(j,{children:e.jsx(g,{children:"Basic Information"})}),e.jsxs(h,{className:"space-y-4",children:[t.description&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t.description})]}),t.affiliation&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Affiliation"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t.affiliation})]}),t.role&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Role"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t.role})]}),t.category&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Category"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t.category})]})]})]}),e.jsxs(x,{children:[e.jsx(j,{children:e.jsx(g,{children:"Quick Stats"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Linked Events"}),e.jsx(c,{variant:"secondary",children:t._event_count||0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Evidence Items"}),e.jsx(c,{variant:"secondary",children:t._evidence_count||0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Relationships"}),e.jsx(c,{variant:"secondary",children:t._relationship_count||0})]}),e.jsx(ue,{}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{children:["Created: ",new Date(t.created_at).toLocaleDateString()]}),e.jsxs("div",{children:["Updated: ",new Date(t.updated_at).toLocaleDateString()]})]})]})]})]})}),e.jsxs(re,{value:"deception",className:"space-y-6",children:[e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),"Primary POP Assessment"]}),e.jsx(M,{children:"General behavioral deception patterns"})]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:S,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Edit"]})]})}),e.jsx(h,{children:t.primary_pop?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Historical Pattern"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-bold",children:t.primary_pop.historical_pattern}),e.jsx("span",{className:"text-gray-500",children:"/5"})]}),e.jsx(le,{value:t.primary_pop.historical_pattern/5*100,className:"h-2 mt-2"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Sophistication"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-bold",children:t.primary_pop.sophistication_level}),e.jsx("span",{className:"text-gray-500",children:"/5"})]}),e.jsx(le,{value:t.primary_pop.sophistication_level/5*100,className:"h-2 mt-2"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Success Rate"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-bold",children:t.primary_pop.success_rate}),e.jsx("span",{className:"text-gray-500",children:"/5"})]}),e.jsx(le,{value:t.primary_pop.success_rate/5*100,className:"h-2 mt-2"})]})]}),t.primary_pop.notes&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Notes"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 whitespace-pre-wrap",children:t.primary_pop.notes})]})]}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No primary POP assessment available. Click edit to add one."})})]}),e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5"}),"Topic-Based POP Variations"]}),e.jsx(M,{children:"Domain-specific behavioral patterns"})]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:S,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Add Variation"]})]})}),e.jsx(h,{children:t.pop_variations&&t.pop_variations.length>0?e.jsx("div",{className:"space-y-4",children:t.pop_variations.map((r,n)=>e.jsxs(x,{className:"border-l-4 border-l-blue-600",children:[e.jsx(j,{children:e.jsx(g,{className:"text-base",children:r.topic})}),e.jsxs(h,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 mb-1",children:"Historical Pattern"}),e.jsxs("div",{className:"font-semibold",children:[r.assessment.historical_pattern,"/5"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 mb-1",children:"Sophistication"}),e.jsxs("div",{className:"font-semibold",children:[r.assessment.sophistication_level,"/5"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500 mb-1",children:"Success Rate"}),e.jsxs("div",{className:"font-semibold",children:[r.assessment.success_rate,"/5"]})]})]}),r.assessment.notes&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-3 pt-3 border-t",children:r.assessment.notes})]})]},n))}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No topic-based variations. Add variations to track patterns across different domains."})})]}),e.jsxs(x,{children:[e.jsx(j,{children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),"MOM Assessments"]}),e.jsx(M,{children:"Scenario-specific motive, opportunity, and means assessments"})]})})}),e.jsx(h,{children:m?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading MOM assessments..."}):e.jsx(Ve,{assessments:T,compact:!0,showFilters:T.length>3,onCreateNew:()=>{console.log("Create new MOM assessment")},onEdit:r=>{console.log("Edit MOM assessment:",r.id)},onDelete:async r=>{if(confirm(`Delete MOM assessment "${r.scenario_description}"?`))try{const n=localStorage.getItem("omnicore_user_hash");await fetch(`/api/mom-assessments/${r.id}`,{method:"DELETE",headers:{...n&&{Authorization:`Bearer ${n}`}}}),a(y=>y.filter(f=>f.id!==r.id))}catch(n){console.error("Failed to delete MOM assessment:",n),alert("Failed to delete MOM assessment")}}})})]}),t.deception_profile&&e.jsxs(x,{className:"border-yellow-300 dark:border-yellow-700 border-2",children:[e.jsxs(j,{children:[e.jsxs(g,{className:"text-sm flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4 text-yellow-600"}),"Legacy Deception Profile (Deprecated)"]}),e.jsx(M,{className:"text-xs",children:"This data is from the old structure. Please migrate to the new MOM/POP system."})]}),e.jsx(h,{className:"text-sm",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:["MOM: Motive ",t.deception_profile.mom?.motive,"/5, Opportunity ",t.deception_profile.mom?.opportunity,"/5, Means ",t.deception_profile.mom?.means,"/5"]}),e.jsxs("div",{children:["POP: Pattern ",t.deception_profile.pop?.historical_pattern,"/5, Sophistication ",t.deception_profile.pop?.sophistication_level,"/5, Success ",t.deception_profile.pop?.success_rate,"/5"]})]})})]})]}),e.jsx(re,{value:"relationships",className:"space-y-6",children:e.jsxs(x,{children:[e.jsx(j,{children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5"}),"Entity Relationships"]}),e.jsx(M,{children:"Connections to other actors, events, sources, places, and evidence"})]})})}),e.jsx(h,{children:F?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Loading relationships..."}):e.jsx(Be,{relationships:z,entityNames:L,compact:!1,showFilters:z.length>3,onCreateNew:()=>{O(void 0),_(!0)},onEdit:r=>{O(r),_(!0)},onDelete:async r=>{if(confirm(`Delete relationship to ${L[r.target_entity_id]||r.target_entity_id}?`))try{const n=localStorage.getItem("omnicore_user_hash");await fetch(`/api/relationships/${r.id}`,{method:"DELETE",headers:{...n&&{Authorization:`Bearer ${n}`}}}),D(y=>y.filter(f=>f.id!==r.id))}catch(n){console.error("Failed to delete relationship:",n),alert("Failed to delete relationship")}},onNavigateToEntity:(r,n)=>{const y={ACTOR:`/dashboard/entities/actors/${r}`,SOURCE:`/dashboard/entities/sources/${r}`,EVENT:`/dashboard/entities/events/${r}`,PLACE:`/dashboard/entities/places/${r}`,BEHAVIOR:`/dashboard/entities/behaviors/${r}`,EVIDENCE:`/dashboard/evidence/${r}`};N(y[n]||"/dashboard")}})})]})}),e.jsx(we,{open:B,onOpenChange:_,children:e.jsxs(ke,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ce,{children:e.jsx(Se,{children:v?"Edit Relationship":"Create New Relationship"})}),e.jsx(qe,{relationship:v,sourceEntityId:v?void 0:t.id,sourceEntityType:v?void 0:"ACTOR",workspaceId:t.workspace_id,onSubmit:async r=>{try{const n=localStorage.getItem("omnicore_user_hash");if(v){const y=await fetch(`/api/relationships/${v.id}`,{method:"PUT",headers:{"Content-Type":"application/json",...n&&{Authorization:`Bearer ${n}`}},body:JSON.stringify(r)});if(y.ok){const f=await y.json();D(I=>I.map(ae=>ae.id===v.id?f.relationship:ae)),_(!1)}}else{const y=await fetch("/api/relationships",{method:"POST",headers:{"Content-Type":"application/json",...n&&{Authorization:`Bearer ${n}`}},body:JSON.stringify(r)});if(y.ok){const f=await y.json();D(I=>[...I,f.relationship]),_(!1)}}}catch{throw new Error("Failed to save relationship")}},onCancel:()=>_(!1)})]})}),e.jsx(re,{value:"claims",className:"space-y-6",children:K?e.jsx(x,{children:e.jsx(h,{className:"py-12 text-center text-gray-500",children:"Loading claims..."})}):G.length===0?e.jsx(x,{children:e.jsxs(h,{className:"py-12 text-center",children:[e.jsx(ge,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No claims found"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"This actor hasn't been mentioned in any analyzed content yet"})]})}):e.jsxs(e.Fragment,{children:[C&&e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),"Claims Statistics"]})}),e.jsxs(h,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:C.total_claims}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Claims"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 dark:bg-blue-900 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-900 dark:text-blue-200",children:C.as_claim_maker}),e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"As Claim Maker"})]}),e.jsxs("div",{className:"text-center p-3 bg-purple-50 dark:bg-purple-900 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-900 dark:text-purple-200",children:C.as_subject}),e.jsx("div",{className:"text-sm text-purple-700 dark:text-purple-300",children:"As Subject"})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-50 dark:bg-orange-900 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-900 dark:text-orange-200",children:C.as_mentioned}),e.jsx("div",{className:"text-sm text-orange-700 dark:text-orange-300",children:"Mentioned"})]})]}),e.jsx(ue,{className:"my-4"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"High Risk:"}),e.jsx(c,{className:"bg-red-100 text-red-800",children:C.high_risk_claims})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Verified:"}),e.jsx(c,{className:"bg-green-100 text-green-800",children:C.verified_claims})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Debunked:"}),e.jsx(c,{className:"bg-yellow-100 text-yellow-800",children:C.debunked_claims})]})]})]})]}),b.claim_maker&&b.claim_maker.length>0&&e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5 text-blue-600"}),"Claims Made by ",t.name]}),e.jsxs(M,{children:["Claims where ",t.name," is identified as the claim maker"]})]}),e.jsx(h,{className:"space-y-4",children:b.claim_maker.map(r=>e.jsxs("div",{className:"p-4 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer",onClick:()=>N(`/dashboard/content-intelligence/${r.content_analysis_id}`),children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-900 dark:text-white font-medium mb-1",children:r.claim_text}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(c,{variant:"outline",children:r.claim_category}),e.jsxs(c,{className:r.overall_risk==="high"?"bg-red-100 text-red-800":r.overall_risk==="medium"?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800",children:[r.overall_risk," risk"]}),r.verification_status&&e.jsx(c,{variant:"secondary",children:r.verification_status}),r.credibility_impact&&e.jsxs(c,{variant:"outline",children:["Impact: ",r.credibility_impact>0?"+":"",r.credibility_impact]})]})]})}),r.context&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:r.context}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2 flex items-center gap-4",children:[e.jsxs("span",{children:["From: ",r.content_title||r.content_url]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(r.analyzed_at).toLocaleDateString()})]})]},r.mention_id))})]}),b.subject&&b.subject.length>0&&e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5 text-purple-600"}),"Claims About ",t.name]}),e.jsxs(M,{children:["Claims where ",t.name," is the primary subject"]})]}),e.jsx(h,{className:"space-y-4",children:b.subject.map(r=>e.jsxs("div",{className:"p-4 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer",onClick:()=>N(`/dashboard/content-intelligence/${r.content_analysis_id}`),children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-900 dark:text-white font-medium mb-1",children:r.claim_text}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(c,{variant:"outline",children:r.claim_category}),e.jsxs(c,{className:r.overall_risk==="high"?"bg-red-100 text-red-800":r.overall_risk==="medium"?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800",children:[r.overall_risk," risk"]}),r.verification_status&&e.jsx(c,{variant:"secondary",children:r.verification_status})]})]})}),r.context&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:r.context}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2 flex items-center gap-4",children:[e.jsxs("span",{children:["From: ",r.content_title||r.content_url]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(r.analyzed_at).toLocaleDateString()})]})]},r.mention_id))})]}),(b.mentioned&&b.mentioned.length>0||b.affected&&b.affected.length>0)&&e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-5 w-5 text-gray-600"}),"Other Mentions of ",t.name]})}),e.jsx(h,{className:"space-y-4",children:[...b.mentioned||[],...b.affected||[]].map(r=>e.jsxs("div",{className:"p-3 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer text-sm",onClick:()=>N(`/dashboard/content-intelligence/${r.content_analysis_id}`),children:[e.jsx("p",{className:"text-gray-900 dark:text-white mb-1",children:r.claim_text}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(c,{variant:"outline",className:"text-xs",children:r.role}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(r.analyzed_at).toLocaleDateString()})]})]},r.mention_id))})]})]})}),e.jsx(re,{value:"activity",className:"space-y-6",children:e.jsx(x,{children:e.jsxs(h,{className:"py-12 text-center",children:[e.jsx($e,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Activity timeline coming soon"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Chronological view of events, evidence updates, and relationship changes"})]})})})]}),e.jsx(Ke,{entityId:t.id,entityType:"ACTOR",entityName:t.name})]})}function cs(){const{t}=Ie(["entities","common"]),{id:S}=Oe(),Z=Ee(),N=fe(),[P,J]=l.useState([]),[T,a]=l.useState(null),[m,R]=l.useState(!0),[z,D]=l.useState(""),[F,V]=l.useState("all"),[L,Q]=l.useState(1),[B,_]=l.useState(!1),[v,O]=l.useState(void 0),$=S&&!Z.pathname.includes("/edit"),H=S&&Z.pathname.includes("/edit");l.useEffect(()=>{!$&&!H&&X()},[L,F,$,H]),l.useEffect(()=>{S&&A(S)},[S]);const X=async()=>{R(!0);try{const i=localStorage.getItem("omnicore_user_hash"),o=new URLSearchParams({workspace_id:L.toString(),...F!=="all"&&{actor_type:F}}),d=await fetch(`/api/actors?${o}`,{headers:{...i&&{Authorization:`Bearer ${i}`}}}),p=await d.json();d.ok&&J(p.actors||[])}catch(i){console.error("Failed to load actors:",i)}finally{R(!1)}},A=async i=>{R(!0);try{const o=localStorage.getItem("omnicore_user_hash"),d=await fetch(`/api/actors/${i}`,{headers:{...o&&{Authorization:`Bearer ${o}`}}}),p=await d.json();d.ok&&(a(p),H&&O(p))}catch(o){console.error("Failed to load actor:",o)}finally{R(!1)}},G=async i=>{const o=localStorage.getItem("omnicore_user_hash"),d=await fetch("/api/actors",{method:"POST",headers:{"Content-Type":"application/json",...o&&{Authorization:`Bearer ${o}`}},body:JSON.stringify({...i,workspace_id:L})});if(d.ok)_(!1),O(void 0),X();else{const p=await d.json();throw new Error(p.error||"Failed to create actor")}},Y=async i=>{if(!v)return;const o=localStorage.getItem("omnicore_user_hash"),d=await fetch(`/api/actors/${v.id}`,{method:"PUT",headers:{"Content-Type":"application/json",...o&&{Authorization:`Bearer ${o}`}},body:JSON.stringify(i)});if(d.ok)_(!1),O(void 0),S?(N(`/dashboard/entities/actors/${S}`),A(S)):X();else{const p=await d.json();throw new Error(p.error||"Failed to update actor")}},C=async()=>{if(T&&confirm(`Are you sure you want to delete "${T.name}"?`))try{const i=localStorage.getItem("omnicore_user_hash"),o=await fetch(`/api/actors/${T.id}`,{method:"DELETE",headers:{...i&&{Authorization:`Bearer ${i}`}}});if(o.ok)N("/dashboard/entities/actors");else{const d=await o.json();alert(`Failed to delete actor: ${d.error}`)}}catch(i){console.error("Failed to delete actor:",i),alert("Failed to delete actor")}},ee=()=>{O(void 0),_(!0)},b=i=>{N(`/dashboard/entities/actors/${i.id}`)},q=P.filter(i=>i.name.toLowerCase().includes(z.toLowerCase())||i.description?.toLowerCase().includes(z.toLowerCase())),K=i=>{switch(i){case"PERSON":return"ðŸ‘¤";case"ORGANIZATION":return"ðŸ¢";case"UNIT":return"âš”ï¸";case"GOVERNMENT":return"ðŸ›ï¸";case"GROUP":return"ðŸ‘¥";default:return"â“"}},U=i=>{const o={PERSON:"bg-blue-100 text-blue-800",ORGANIZATION:"bg-purple-100 text-purple-800",UNIT:"bg-green-100 text-green-800",GOVERNMENT:"bg-red-100 text-red-800",GROUP:"bg-orange-100 text-orange-800",OTHER:"bg-gray-100 text-gray-800"};return o[i]||o.OTHER},s=i=>{if(!i||!i.mom)return null;const o=i.mom.motive||0,d=i.mom.opportunity||0,p=i.mom.means||0,r=(o+d+p)/3;return r>=4?e.jsx(c,{className:"bg-red-100 text-red-800",children:t("entities:actors.risk.high")}):r>=3?e.jsx(c,{className:"bg-orange-100 text-orange-800",children:t("entities:actors.risk.medium")}):r>=1.5?e.jsx(c,{className:"bg-yellow-100 text-yellow-800",children:t("entities:actors.risk.low")}):e.jsx(c,{className:"bg-green-100 text-green-800",children:t("entities:actors.risk.minimal")})};return $&&T?e.jsx(We,{actor:T,onEdit:()=>N(`/dashboard/entities/actors/${T.id}/edit`),onDelete:C}):H&&v?e.jsx("div",{className:"p-6",children:e.jsx(ye,{actor:v,onSubmit:Y,onCancel:()=>N(`/dashboard/entities/actors/${v.id}`)})}):m&&($||H)?e.jsx("div",{className:"p-6",children:e.jsx(x,{children:e.jsx(h,{className:"py-12 text-center",children:e.jsx("p",{className:"text-gray-500",children:t("entities:actors.loadingActor")})})})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(oe,{className:"h-8 w-8"}),t("entities:actors.title")]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:t("entities:actors.description")})]}),e.jsxs(k,{onClick:ee,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),t("entities:actors.addButton")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(x,{children:[e.jsx(j,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:t("entities:actors.stats.total")})}),e.jsx(h,{children:e.jsx("p",{className:"text-2xl font-bold",children:P.length})})]}),e.jsxs(x,{children:[e.jsx(j,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:t("entities:actors.stats.highRisk")})}),e.jsx(h,{children:e.jsx("p",{className:"text-2xl font-bold text-red-600",children:P.filter(i=>{const o=i.deception_profile;return!o||!o.mom?!1:((o.mom.motive||0)+(o.mom.opportunity||0)+(o.mom.means||0))/3>=4}).length})})]}),e.jsxs(x,{children:[e.jsx(j,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:t("entities:actors.stats.organizations")})}),e.jsx(h,{children:e.jsx("p",{className:"text-2xl font-bold",children:P.filter(i=>i.type==="ORGANIZATION").length})})]}),e.jsxs(x,{children:[e.jsx(j,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:t("entities:actors.stats.individuals")})}),e.jsx(h,{children:e.jsx("p",{className:"text-2xl font-bold",children:P.filter(i=>i.type==="PERSON").length})})]})]}),e.jsx(x,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(He,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(w,{placeholder:t("entities:actors.search"),value:z,onChange:i=>D(i.target.value),className:"pl-10"})]})}),e.jsxs(ve,{value:F,onValueChange:i=>V(i),children:[e.jsx(Ne,{className:"w-[200px]",children:e.jsx(_e,{placeholder:t("entities:actors.filterType")})}),e.jsxs(be,{children:[e.jsx(E,{value:"all",children:t("entities:actors.types.all")}),e.jsx(E,{value:"PERSON",children:t("entities:actors.types.person")}),e.jsx(E,{value:"ORGANIZATION",children:t("entities:actors.types.organization")}),e.jsx(E,{value:"UNIT",children:t("entities:actors.types.unit")}),e.jsx(E,{value:"GOVERNMENT",children:t("entities:actors.types.government")}),e.jsx(E,{value:"GROUP",children:t("entities:actors.types.group")}),e.jsx(E,{value:"OTHER",children:t("entities:actors.types.other")})]})]})]})})}),m?e.jsx(x,{children:e.jsx(h,{className:"py-12 text-center",children:e.jsx("p",{className:"text-gray-500",children:t("entities:actors.loading")})})}):q.length===0?e.jsx(x,{children:e.jsxs(h,{className:"py-12 text-center",children:[e.jsx(oe,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:t("entities:actors.empty")}),e.jsxs(k,{className:"mt-4",onClick:ee,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),t("entities:actors.addFirst")]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:q.map(i=>e.jsxs(x,{className:"hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>b(i),children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:K(i.type)}),e.jsxs("div",{children:[e.jsx(g,{className:"text-lg",children:i.name}),e.jsx(c,{className:`mt-1 ${U(i.type)}`,children:i.type})]})]}),s(i.deception_profile)]})}),e.jsxs(h,{className:"space-y-3",children:[i.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2",children:i.description}),i.aliases&&i.aliases.length>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("strong",{children:t("entities:actors.aliases")})," ",i.aliases.join(", ")]}),i.deception_profile&&i.deception_profile.mom&&e.jsxs("div",{className:"pt-2 border-t space-y-1",children:[e.jsxs("div",{className:"text-xs font-semibold flex items-center gap-1 text-gray-700 dark:text-gray-300",children:[e.jsx(Ae,{className:"h-3 w-3"}),t("entities:actors.momProfile")]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:t("entities:actors.mom.motive")}),e.jsxs("div",{className:"font-semibold",children:[i.deception_profile.mom.motive||0,"/5"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:t("entities:actors.mom.opportunity")}),e.jsxs("div",{className:"font-semibold",children:[i.deception_profile.mom.opportunity||0,"/5"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:t("entities:actors.mom.means")}),e.jsxs("div",{className:"font-semibold",children:[i.deception_profile.mom.means||0,"/5"]})]})]})]}),(i._event_count||i._evidence_count||i._relationship_count)&&e.jsxs("div",{className:"pt-2 border-t flex justify-between text-xs text-gray-500",children:[i._event_count!==void 0&&e.jsxs("span",{children:[i._event_count," ",t("entities:actors.counts.events")]}),i._evidence_count!==void 0&&e.jsxs("span",{children:[i._evidence_count," ",t("entities:actors.counts.evidence")]}),i._relationship_count!==void 0&&e.jsxs("span",{children:[i._relationship_count," ",t("entities:actors.counts.links")]})]})]})]},i.id))}),e.jsx(we,{open:B,onOpenChange:i=>{_(i),i||O(void 0)},children:e.jsxs(ke,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ce,{children:e.jsx(Se,{children:t(v?"entities:actors.dialog.edit":"entities:actors.dialog.create")})}),e.jsx(ye,{actor:v,onSubmit:v?Y:G,onCancel:()=>{_(!1),O(void 0)}})]})})]})}export{cs as ActorsPage};
