import{j as e}from"./ui-vendor-DBphXmDA.js";import{k as R,f as L,r as i}from"./react-vendor-CfYLSWvh.js";import{a as J,B as u,e as I,y as Y,I as H}from"./index-QqleixXe.js";import{C as p,a as j,b as f,c as v,d as y}from"./card-BGAig-Dv.js";import{L as E,az as _,U as M,Y as P,a7 as q,c as O}from"./icons-x9tcvtYN.js";import"./state-vendor-BXB5jEEt.js";function Q(){const{inviteToken:d}=R(),n=L(),{isAuthenticated:b,user:z}=J(),[o,S]=i.useState(null),[x,T]=i.useState(""),[D,N]=i.useState(!0),[g,k]=i.useState(!1),[m,h]=i.useState(null);i.useEffect(()=>{if(!b){n(`/login?redirect=/invite/${d}`);return}$()},[d,b]);const $=async()=>{try{N(!0);const s=await fetch(`/api/invites/${d}`);if(!s.ok){const r=await s.json();throw new Error(r.error||"Failed to fetch invite")}const t=await s.json();S(t)}catch(s){h(s instanceof Error?s.message:"Failed to load invite")}finally{N(!1)}},B=async s=>{if(s.preventDefault(),!x.trim()){h("Nickname is required");return}try{k(!0),h(null);const t={nickname:x.trim()},r=await fetch(`/api/invites/${d}/accept`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")||""}`},body:JSON.stringify(t)});if(!r.ok){const c=await r.json();throw new Error(c.error||"Failed to accept invite")}const l=await r.json();n(`/workspaces/${l.workspace_id}`,{state:{message:`Successfully joined ${o?.workspace.name} as ${l.nickname}`}})}catch(t){h(t instanceof Error?t.message:"Failed to accept invite")}finally{k(!1)}},A=s=>{switch(s){case"ADMIN":return"bg-purple-100 text-purple-800";case"EDITOR":return"bg-blue-100 text-blue-800";case"VIEWER":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},F=s=>{if(!s)return"Never expires";const t=new Date(s),r=new Date,l=t.getTime()-r.getTime(),c=Math.floor(l/(1e3*60*60)),C=Math.floor(c/24);return C>1?`Expires in ${C} days`:c>1?`Expires in ${c} hours`:l>0?"Expires soon":"Expired"};if(D)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx(E,{className:"h-12 w-12 animate-spin text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading invite..."})]})});if(m&&!o)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:e.jsxs(p,{className:"max-w-md w-full",children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{children:[e.jsx(f,{children:"Invalid Invite"}),e.jsx(v,{children:"This invite link is not valid"})]})]})}),e.jsxs(y,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:m}),e.jsx(u,{onClick:()=>n("/"),className:"w-full",children:"Return to Home"})]})]})});if(!o)return null;const{workspace:w,invite:a}=o;if(!a.is_valid){let s="This invite is no longer valid";return a.is_expired?s="This invite has expired":a.is_max_uses_reached&&(s="This invite has reached maximum uses"),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:e.jsxs(p,{className:"max-w-md w-full",children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{children:[e.jsx(f,{children:"Invite Expired"}),e.jsx(v,{children:s})]})]})}),e.jsxs(y,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Please contact the workspace owner for a new invite link."}),e.jsx(u,{onClick:()=>n("/"),className:"w-full",children:"Return to Home"})]})]})})}return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:e.jsxs(p,{className:"max-w-lg w-full",children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"bg-blue-100 dark:bg-blue-900 p-3 rounded-lg",children:e.jsx(M,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx(f,{children:"You've Been Invited!"}),e.jsx(v,{children:"Join an investigation team"})]})]})}),e.jsxs(y,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Workspace"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:w.name})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Invited by"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:w.owner_nickname})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Your role"}),e.jsx(I,{className:A(a.default_role),children:a.default_role})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{children:F(a.expires_at)})]}),a.label&&e.jsx("div",{className:"flex items-center gap-2 text-sm",children:e.jsx(I,{variant:"outline",children:a.label})}),a.uses_remaining!==null&&e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[a.uses_remaining," ",a.uses_remaining===1?"use":"uses"," remaining"]})]}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"nickname",children:"Choose Your Display Name"}),e.jsx(H,{id:"nickname",type:"text",placeholder:"e.g., Jane Doe, Analyst_47, Dr. Smith",value:x,onChange:s=>T(s.target.value),maxLength:50,required:!0,className:"text-base"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"This is how team members will see you in this workspace"})]}),m&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-400 px-4 py-3 rounded",children:m}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>n("/"),className:"flex-1",disabled:g,children:"Cancel"}),e.jsx(u,{type:"submit",className:"flex-1",disabled:g||!x.trim(),children:g?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2 animate-spin"}),"Joining..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Join Investigation Team"]})})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 p-3 rounded-lg",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-400",children:[e.jsx("p",{className:"font-medium mb-1",children:"Secure Collaboration"}),e.jsx("p",{className:"text-xs",children:"Your account credentials remain private. This workspace-specific nickname is only visible to team members in this investigation."})]})]})})]})]})})}export{Q as InviteAcceptPage};
