import{j as e}from"./ui-vendor-DBphXmDA.js";import{r as l,f as ce,k as ge,u as pe}from"./react-vendor-CfYLSWvh.js";import{A as ue,r as fe,y as O,I as W,S as J,z as Q,C as z,E as K,F as o,q as ve,B as T,e as M,l as de,m as oe,n as xe,o as he,u as ye}from"./index-DGGXJgUa.js";import{C as x,a as j,b as g,c as F,d as h}from"./card-BQo7RV_Z.js";import{C as Ne,_ as we,N as be,$ as Ee,q as Ce,ai as $,Y as te,am as me,U as re,W as ie,d as ke,ad as Te,a7 as _e,a as Se}from"./icons-x9tcvtYN.js";import{T as Ie,a as De,b as U,c as H}from"./tabs-Dznm0vhG.js";import{S as ae}from"./separator-C04pRlKv.js";import{M as Oe}from"./MOMAssessmentList-Ce39DDTy.js";import{R as Me,F as Fe,a as Le}from"./FrameworkUsagePanel-BG9s4RYa.js";import"./progress-D6O6TLpv.js";import"./checkbox-CF04fJe8.js";import"./slider-oUJ8z5Zt.js";import"./radio-group-DpNxXkbo.js";import"./state-vendor-BXB5jEEt.js";function le({event:s,onSubmit:v,onCancel:L}){const[y,w]=l.useState(!1),[A,p]=l.useState(null),[r,u]=l.useState({name:s?.name||"",event_type:s?.event_type||"ACTIVITY",description:s?.description||"",date_start:s?.date_start?s.date_start.split("T")[0]:"",date_end:s?.date_end?s.date_end.split("T")[0]:"",duration:s?.duration||void 0,location_id:s?.location_id||"",significance:s?.significance||"MEDIUM",confidence:s?.confidence||"POSSIBLE"}),E=async c=>{c.preventDefault(),w(!0),p(null);try{const C={...r};if(r.date_start&&r.date_end){const k=new Date(r.date_start),_=new Date(r.date_end);C.duration=Math.floor((_.getTime()-k.getTime())/(1e3*60))}await v(C)}catch(C){p(C instanceof Error?C.message:"Failed to save event"),w(!1)}};return e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[A&&e.jsxs(ue,{variant:"destructive",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx(fe,{children:A})]}),e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Event Information"}),e.jsx(F,{children:"Define the event details"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"name",children:"Event Name *"}),e.jsx(W,{id:"name",value:r.name,onChange:c=>u({...r,name:c.target.value}),placeholder:"e.g., Operation Desert Storm, Summit Meeting, Cyber Attack",required:!0})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"event_type",children:"Event Type *"}),e.jsxs(J,{value:r.event_type,onValueChange:c=>u({...r,event_type:c}),children:[e.jsx(Q,{id:"event_type",children:e.jsx(z,{})}),e.jsxs(K,{children:[e.jsx(o,{value:"OPERATION",children:"âš”ï¸ Operation"}),e.jsx(o,{value:"INCIDENT",children:"âš ï¸ Incident"}),e.jsx(o,{value:"MEETING",children:"ðŸ¤ Meeting"}),e.jsx(o,{value:"ACTIVITY",children:"ðŸ“‹ Activity"}),e.jsx(o,{value:"OTHER",children:"ðŸ“… Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"description",children:"Description"}),e.jsx(ve,{id:"description",value:r.description,onChange:c=>u({...r,description:c.target.value}),placeholder:"Brief description of the event",rows:3})]})]})]}),e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"When"}),e.jsx(F,{children:"Event timing and duration"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"date_start",children:"Start Date *"}),e.jsx(W,{id:"date_start",type:"date",value:r.date_start,onChange:c=>u({...r,date_start:c.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"date_end",children:"End Date"}),e.jsx(W,{id:"date_end",type:"date",value:r.date_end,onChange:c=>u({...r,date_end:c.target.value})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Optional - leave blank for single-day events"})]})]})]}),e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Where"}),e.jsx(F,{children:"Event location"})]}),e.jsx(h,{children:e.jsxs("div",{children:[e.jsx(O,{htmlFor:"location_id",children:"Location"}),e.jsx(W,{id:"location_id",value:r.location_id,onChange:c=>u({...r,location_id:c.target.value}),placeholder:"e.g., Baghdad, Pentagon, Moscow"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Future: Link to Places entity"})]})})]}),e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Analysis"}),e.jsx(F,{children:"Assessment and confidence"})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"significance",children:"Significance"}),e.jsxs(J,{value:r.significance,onValueChange:c=>u({...r,significance:c}),children:[e.jsx(Q,{id:"significance",children:e.jsx(z,{})}),e.jsxs(K,{children:[e.jsx(o,{value:"CRITICAL",children:"ðŸ”´ Critical - Major strategic impact"}),e.jsx(o,{value:"HIGH",children:"ðŸŸ  High - Significant impact"}),e.jsx(o,{value:"MEDIUM",children:"ðŸŸ¡ Medium - Moderate impact"}),e.jsx(o,{value:"LOW",children:"ðŸŸ¢ Low - Minor impact"})]})]})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"confidence",children:"Confidence Level"}),e.jsxs(J,{value:r.confidence,onValueChange:c=>u({...r,confidence:c}),children:[e.jsx(Q,{id:"confidence",children:e.jsx(z,{})}),e.jsxs(K,{children:[e.jsx(o,{value:"CONFIRMED",children:"âœ… Confirmed - Verified by multiple sources"}),e.jsx(o,{value:"PROBABLE",children:"ðŸŸ¢ Probable - Likely accurate"}),e.jsx(o,{value:"POSSIBLE",children:"ðŸŸ¡ Possible - May be accurate"}),e.jsx(o,{value:"DOUBTFUL",children:"ðŸŸ  Doubtful - Questionable accuracy"})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(T,{type:"button",variant:"outline",onClick:L,disabled:y,children:"Cancel"}),e.jsx(T,{type:"submit",disabled:y,children:y?"Saving...":s?"Update Event":"Create Event"})]})]})}function Ae({event:s,onEdit:v,onDelete:L}){const y=ce(),[w,A]=l.useState("overview"),[p,r]=l.useState([]),[u,E]=l.useState(!1),[c,C]=l.useState({}),[k,_]=l.useState([]),[P,X]=l.useState(!1),[Z,S]=l.useState({}),[b,m]=l.useState(!1),[N,I]=l.useState(void 0);l.useEffect(()=>{const i=async()=>{E(!0);try{const a=await fetch(`/api/mom-assessments?event_id=${s.id}`);if(a.ok){const t=await a.json();r(t.assessments||[]);const n=[...new Set((t.assessments||[]).map(f=>f.actor_id))],d={};for(const f of n)try{const q=await fetch(`/api/actors/${f}`);if(q.ok){const je=await q.json();d[f]=je.actor.name}}catch(q){console.error(`Failed to load actor ${f}:`,q)}C(d)}}catch(a){console.error("Failed to load MOM assessments:",a)}finally{E(!1)}};s.id&&i()},[s.id]),l.useEffect(()=>{const i=async()=>{X(!0);try{const a=await fetch(`/api/relationships?entity_id=${s.id}&workspace_id=${s.workspace_id}`);if(a.ok){const t=await a.json();_(t.relationships||[]);const n=new Set;t.relationships.forEach(f=>{f.source_entity_id!==s.id&&n.add(f.source_entity_id),f.target_entity_id!==s.id&&n.add(f.target_entity_id)});const d={};for(const f of Array.from(n))d[f]=f.substring(0,8);S(d)}}catch(a){console.error("Failed to load relationships:",a)}finally{X(!1)}};s.id&&i()},[s.id,s.workspace_id]);const B=i=>{const a={OPERATION:"ðŸŽ¯",INCIDENT:"âš ï¸",MEETING:"ðŸ¤",ACTIVITY:"ðŸ“‹",OTHER:"â“"};return a[i]||a.OTHER},Y=i=>{const a={OPERATION:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",INCIDENT:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",MEETING:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",ACTIVITY:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",OTHER:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"};return a[i]||a.OTHER},ee=i=>{const a={CRITICAL:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",HIGH:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",MEDIUM:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",LOW:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"};return a[i]||a.LOW},G=i=>{const a={CONFIRMED:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",PROBABLE:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",POSSIBLE:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",DOUBTFUL:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"};return a[i]||a.POSSIBLE},R=i=>new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),V=i=>{if(!i)return"N/A";const a=Math.floor(i/60),t=i%60;if(a>24){const n=Math.floor(a/24),d=a%24;return`${n}d ${d}h ${t}m`}else return a>0?`${a}h ${t}m`:`${t}m`},D=(()=>{const i=new Date(s.date_start),a=s.date_end?new Date(s.date_end):null,t=new Date;return a&&t>a?{status:"Completed",color:"gray",icon:_e}:t<i?{status:"Scheduled",color:"blue",icon:$}:{status:"In Progress",color:"green",icon:te}})(),se=D.icon;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(T,{variant:"outline",onClick:()=>y("/dashboard/entities/events"),children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Back to Events"]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-4xl",children:B(s.event_type)}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(M,{className:Y(s.event_type),children:s.event_type}),s.significance&&e.jsx(M,{className:ee(s.significance),children:s.significance}),s.confidence&&e.jsx(M,{className:G(s.confidence),children:s.confidence}),e.jsxs(M,{className:`bg-${D.color}-100 text-${D.color}-800`,children:[e.jsx(se,{className:"h-3 w-3 mr-1"}),D.status]})]})]})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{variant:"outline",onClick:()=>y("/dashboard/network-graph",{state:{highlightEntities:[s.id],source:"event",title:s.name}}),children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"View in Network"]}),e.jsxs(T,{variant:"outline",onClick:v,children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(T,{variant:"destructive",onClick:L,children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),e.jsxs(Ie,{value:w,onValueChange:A,children:[e.jsxs(De,{className:"grid w-full grid-cols-5",children:[e.jsx(U,{value:"overview",children:"Overview"}),e.jsx(U,{value:"timeline",children:"Timeline"}),e.jsx(U,{value:"actors",children:"Linked Actors"}),e.jsx(U,{value:"evidence",children:"Linked Evidence"}),e.jsx(U,{value:"relationships",children:"Relationships"})]}),e.jsx(H,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(x,{className:"md:col-span-2",children:[e.jsx(j,{children:e.jsx(g,{children:"Event Details"})}),e.jsxs(h,{className:"space-y-4",children:[s.description&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:"Description"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s.description})]}),e.jsx(ae,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Start Date"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:R(s.date_start)})]}),s.date_end&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"End Date"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:R(s.date_end)})]})]}),s.duration!==void 0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Duration"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:V(s.duration)})]}),s.coordinates&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1 flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Coordinates"]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[s.coordinates.lat.toFixed(6),", ",s.coordinates.lng.toFixed(6)]})]})]})]}),e.jsxs(x,{children:[e.jsx(j,{children:e.jsx(g,{children:"Quick Stats"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Event Type"}),e.jsx("div",{className:"text-2xl font-bold",children:s.event_type})]}),s.significance&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Significance"}),e.jsx("div",{className:"text-2xl font-bold",children:s.significance})]}),s.confidence&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Confidence"}),e.jsx("div",{className:"text-2xl font-bold",children:s.confidence})]}),e.jsx(ae,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Status"}),e.jsx(M,{variant:"secondary",children:D.status})]}),e.jsx(ae,{}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{children:["Created: ",new Date(s.created_at).toLocaleDateString()]}),e.jsxs("div",{children:["Updated: ",new Date(s.updated_at).toLocaleDateString()]})]})]})]})]})}),e.jsx(H,{value:"timeline",className:"space-y-6",children:e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Event Timeline"]}),e.jsx(F,{children:"Temporal analysis and duration breakdown"})]}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full"}),e.jsx("div",{className:"w-0.5 h-16 bg-blue-600"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:"Event Start"}),e.jsx("div",{className:"text-sm text-gray-600",children:R(s.date_start)})]})]}),s.date_end&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full"}),e.jsx("div",{className:"w-0.5 h-16 bg-gray-400"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:"Duration"}),e.jsx("div",{className:"text-sm text-gray-600",children:V(s.duration)})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:"Event End"}),e.jsx("div",{className:"text-sm text-gray-600",children:R(s.date_end)})]})]})]}),!s.date_end&&e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"w-3 h-3 bg-yellow-600 rounded-full animate-pulse"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:"Ongoing"}),e.jsx("div",{className:"text-sm text-gray-600",children:"End date not specified"})]})]})]})})]})}),e.jsx(H,{value:"actors",className:"space-y-6",children:e.jsxs(x,{children:[e.jsx(j,{children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Actor MOM Assessments for This Event"]}),e.jsx(F,{children:"Motive, Opportunity, and Means assessments for actors involved in this event"})]})})}),e.jsx(h,{children:u?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Loading MOM assessments..."}):p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(re,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No actor assessments for this event yet"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Create MOM assessments to track which actors had motive, opportunity, and means"}),e.jsxs(T,{onClick:()=>{console.log("Create MOM assessment for event:",s.id)},children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Add Actor Assessment"]})]}):e.jsx(Oe,{assessments:p,actorNames:c,compact:!0,showFilters:p.length>3,onCreateNew:()=>{console.log("Create MOM assessment for event:",s.id)},onEdit:i=>{console.log("Edit MOM assessment:",i.id)},onDelete:async i=>{if(confirm(`Delete MOM assessment "${i.scenario_description}"?`))try{await fetch(`/api/mom-assessments/${i.id}`,{method:"DELETE"}),r(a=>a.filter(t=>t.id!==i.id))}catch(a){console.error("Failed to delete MOM assessment:",a),alert("Failed to delete MOM assessment")}}})})]})}),e.jsx(H,{value:"evidence",className:"space-y-6",children:e.jsx(x,{children:e.jsxs(h,{className:"py-12 text-center",children:[e.jsx(ke,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"Linked evidence display coming soon"}),e.jsx("p",{className:"text-sm text-gray-400",children:"View all evidence items related to this event"})]})})}),e.jsx(H,{value:"relationships",className:"space-y-6",children:e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5"}),"Entity Relationships"]}),e.jsx(F,{children:"Connections to other actors, events, sources, places, and evidence"})]}),e.jsx(h,{children:P?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Loading relationships..."}):e.jsx(Me,{relationships:k,entityNames:Z,compact:!1,showFilters:k.length>3,onCreateNew:()=>{I(void 0),m(!0)},onEdit:i=>{I(i),m(!0)},onDelete:async i=>{if(confirm("Delete this relationship?"))try{(await fetch(`/api/relationships/${i.id}`,{method:"DELETE"})).ok?_(t=>t.filter(n=>n.id!==i.id)):alert("Failed to delete relationship")}catch(a){console.error("Failed to delete relationship:",a),alert("Failed to delete relationship")}},onNavigateToEntity:(i,a)=>{const t={ACTOR:`/dashboard/entities/actors/${i}`,SOURCE:`/dashboard/entities/sources/${i}`,EVENT:`/dashboard/entities/events/${i}`,PLACE:`/dashboard/entities/places/${i}`,BEHAVIOR:`/dashboard/entities/behaviors/${i}`,EVIDENCE:`/dashboard/entities/evidence/${i}`};y(t[a]||"/dashboard")}})})]})})]}),e.jsx(Fe,{entityId:s.id,entityType:"EVENT",entityName:s.name}),e.jsx(de,{open:b,onOpenChange:m,children:e.jsxs(oe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(xe,{children:e.jsx(he,{children:N?"Edit Relationship":"Create New Relationship"})}),e.jsx(Le,{relationship:N,sourceEntityId:N?void 0:s.id,sourceEntityType:N?void 0:"EVENT",workspaceId:s.workspace_id,onSubmit:async i=>{try{if(N){const a=await fetch(`/api/relationships/${N.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(a.ok){const t=await a.json();_(n=>n.map(d=>d.id===N.id?t.relationship:d)),m(!1)}else throw new Error("Failed to update relationship")}else{const a=await fetch("/api/relationships",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(a.ok){const t=await a.json();_(n=>[...n,t.relationship]),m(!1)}else throw new Error("Failed to create relationship")}}catch(a){throw console.error("Failed to save relationship:",a),a}},onCancel:()=>m(!1)})]})})]})}function Ke(){const{t:s}=ye(["entities","common"]),{id:v}=ge(),L=pe(),y=ce(),[w,A]=l.useState([]),[p,r]=l.useState(null),[u,E]=l.useState(!0),[c,C]=l.useState(""),[k,_]=l.useState("all"),[P,X]=l.useState(1),[Z,S]=l.useState(!1),[b,m]=l.useState(void 0),N=v&&!L.pathname.includes("/edit"),I=v&&L.pathname.includes("/edit");l.useEffect(()=>{!N&&!I&&B()},[P,k,N,I]),l.useEffect(()=>{v&&Y(v)},[v]);const B=async()=>{E(!0);try{const t=new URLSearchParams({workspace_id:P.toString(),...k!=="all"&&{event_type:k}}),n=await fetch(`/api/events?${t}`),d=await n.json();n.ok&&A(d.events||[])}catch(t){console.error("Failed to load events:",t)}finally{E(!1)}},Y=async t=>{E(!0);try{const n=await fetch(`/api/events/${t}`),d=await n.json();n.ok&&(r(d.event),I&&m(d.event))}catch(n){console.error("Failed to load event:",n)}finally{E(!1)}},ee=async t=>{const n=await fetch("/api/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,workspace_id:P})});if(n.ok)S(!1),m(void 0),B();else{const d=await n.json();throw new Error(d.error||"Failed to create event")}},G=async t=>{if(!b)return;const n=await fetch(`/api/events/${b.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(n.ok)S(!1),m(void 0),v?(y(`/dashboard/entities/events/${v}`),Y(v)):B();else{const d=await n.json();throw new Error(d.error||"Failed to update event")}},R=async()=>{if(p&&confirm(`Are you sure you want to delete "${p.name}"?`))try{const t=await fetch(`/api/events/${p.id}`,{method:"DELETE"});if(t.ok)y("/dashboard/entities/events");else{const n=await t.json();alert(`Failed to delete event: ${n.error}`)}}catch(t){console.error("Failed to delete event:",t),alert("Failed to delete event")}},V=()=>{m(void 0),S(!0)},ne=t=>{m(t),S(!0)},D=w.filter(t=>t.name.toLowerCase().includes(c.toLowerCase())||t.description?.toLowerCase().includes(c.toLowerCase())),se=t=>{const n={OPERATION:"âš”ï¸",INCIDENT:"âš ï¸",MEETING:"ðŸ¤",ACTIVITY:"ðŸ“‹",OTHER:"ðŸ“…"};return n[t]||n.OTHER},i=t=>{const n={CRITICAL:"bg-red-100 text-red-800",HIGH:"bg-orange-100 text-orange-800",MEDIUM:"bg-yellow-100 text-yellow-800",LOW:"bg-green-100 text-green-800"};return n[t]||n.LOW},a=t=>t?new Date(t).toLocaleDateString():"Unknown";return N&&p?e.jsx(Ae,{event:p,onEdit:()=>y(`/dashboard/entities/events/${p.id}/edit`),onDelete:R}):I&&b?e.jsx("div",{className:"p-6",children:e.jsx(le,{event:b,onSubmit:G,onCancel:()=>y(`/dashboard/entities/events/${b.id}`)})}):u&&(N||I)?e.jsx("div",{className:"p-6",children:e.jsx(x,{children:e.jsx(h,{className:"py-12 text-center",children:e.jsx("p",{className:"text-gray-500",children:s("entities:events.loadingEvent")})})})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx($,{className:"h-8 w-8"}),s("entities:events.title")]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:s("entities:events.description")})]}),e.jsxs(T,{onClick:V,children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),s("entities:events.addButton")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(x,{children:[e.jsx(j,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:s("entities:events.stats.total")})}),e.jsx(h,{children:e.jsx("p",{className:"text-2xl font-bold",children:w.length})})]}),e.jsxs(x,{children:[e.jsx(j,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:s("entities:events.stats.critical")})}),e.jsx(h,{children:e.jsx("p",{className:"text-2xl font-bold text-red-600",children:w.filter(t=>t.significance==="CRITICAL").length})})]}),e.jsxs(x,{children:[e.jsx(j,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:s("entities:events.stats.operations")})}),e.jsx(h,{children:e.jsx("p",{className:"text-2xl font-bold",children:w.filter(t=>t.event_type==="OPERATION").length})})]}),e.jsxs(x,{children:[e.jsx(j,{className:"pb-2",children:e.jsx(g,{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:s("entities:events.stats.thisMonth")})}),e.jsx(h,{children:e.jsx("p",{className:"text-2xl font-bold",children:w.filter(t=>{if(!t.date_start)return!1;const n=new Date(t.date_start),d=new Date;return n.getMonth()===d.getMonth()&&n.getFullYear()===d.getFullYear()}).length})})]})]}),e.jsx(x,{children:e.jsx(h,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(W,{placeholder:s("entities:events.search"),value:c,onChange:t=>C(t.target.value),className:"pl-10"})]})}),e.jsxs(J,{value:k,onValueChange:t=>_(t),children:[e.jsx(Q,{className:"w-[200px]",children:e.jsx(z,{placeholder:s("entities:events.filterType")})}),e.jsxs(K,{children:[e.jsx(o,{value:"all",children:s("entities:events.types.all")}),e.jsx(o,{value:"OPERATION",children:s("entities:events.types.operation")}),e.jsx(o,{value:"INCIDENT",children:s("entities:events.types.incident")}),e.jsx(o,{value:"MEETING",children:s("entities:events.types.meeting")}),e.jsx(o,{value:"ACTIVITY",children:s("entities:events.types.activity")}),e.jsx(o,{value:"OTHER",children:s("entities:events.types.other")})]})]})]})})}),u?e.jsx(x,{children:e.jsx(h,{className:"py-12 text-center",children:e.jsx("p",{className:"text-gray-500",children:s("entities:events.loading")})})}):D.length===0?e.jsx(x,{children:e.jsxs(h,{className:"py-12 text-center",children:[e.jsx($,{className:"h-12 w-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:s("entities:events.empty")}),e.jsxs(T,{className:"mt-4",onClick:V,children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),s("entities:events.addFirst")]})]})}):e.jsx("div",{className:"space-y-4",children:D.map(t=>e.jsxs(x,{className:"hover:shadow-lg transition-shadow cursor-pointer",onClick:()=>ne(t),children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-3xl",children:se(t.event_type)}),e.jsxs("div",{children:[e.jsx(g,{className:"text-lg",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(M,{variant:"outline",children:s(`entities:events.types.${t.event_type.toLowerCase()}`)}),e.jsx(M,{className:i(t.significance),children:s(`entities:events.significance.${t.significance.toLowerCase()}`)}),t.confidence&&e.jsx(M,{variant:"secondary",children:t.confidence})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 text-right",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{className:"h-3 w-3"}),a(t.date_start)]}),t.location_id&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(me,{className:"h-3 w-3"}),t.location_id]})]})]})}),e.jsxs(h,{className:"space-y-3",children:[t.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs text-gray-500",children:[t._actor_count!==void 0&&e.jsxs("span",{children:[t._actor_count," ",s("entities:events.counts.actors")]}),t._evidence_count!==void 0&&e.jsxs("span",{children:[t._evidence_count," ",s("entities:events.counts.evidence")]}),t.duration&&e.jsxs("span",{children:[s("entities:events.counts.duration")," ",Math.round(t.duration/60/24)," ",s("entities:events.days")]})]})]})]},t.id))}),e.jsx(de,{open:Z,onOpenChange:t=>{S(t),t||m(void 0)},children:e.jsxs(oe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(xe,{children:e.jsx(he,{children:s(b?"entities:events.dialog.edit":"entities:events.dialog.create")})}),e.jsx(le,{event:b,onSubmit:b?G:ee,onCancel:()=>{S(!1),m(void 0)}})]})})]})}export{Ke as EventsPage};
