import{g as Ee,I as Se,a as Te,P as Ae,f as ne,i as V,b as d,A as Ce,H,F as Ie,c as Re,T as G,d as Oe}from"./index-mX7ZjAZN.js";import{E as De}from"./FileSaver.min-Dgi0c_i4.js";import Fe from"./pptxgen.es-CeCpILHn.js";import{w as Pe}from"./index-QqleixXe.js";import{g as Le}from"./react-vendor-CfYLSWvh.js";import"./ui-vendor-DBphXmDA.js";import"./card-BGAig-Dv.js";import"./tabs-If3dmLWi.js";import"./icons-x9tcvtYN.js";import"./checkbox-DueJeeKx.js";import"./purify.es-aGzT-_H7.js";import"./switch-BxNvahPI.js";import"./separator-ozDNNLDu.js";import"./slider-B52ikc1m.js";import"./tooltip-_NEsV_z7.js";import"./progress-Cg1bbsHw.js";import"./citation-library-DsFrzEV3.js";import"./radio-group-Dj8G6QwH.js";import"./viz-libs-B9RIjOsc.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./state-vendor-BXB5jEEt.js";var we={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var ze=we.exports,$e;function je(){return $e||($e=1,(function(xe,S){((T,i)=>{xe.exports=i()})(ze,function T(){var i=typeof self<"u"?self:typeof window<"u"?window:i!==void 0?i:{},r,a=!i.document&&!!i.postMessage,n=i.IS_PAPA_WORKER||!1,l={},p=0,o={};function f(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(t){var s=ue(t);s.chunkSize=parseInt(s.chunkSize),t.step||t.chunk||(s.chunkSize=null),this._handle=new m(s),(this._handle.streamer=this)._config=s}.call(this,e),this.parseChunk=function(t,s){var y=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<y){let $=this._config.newline;$||(g=this._config.quoteChar||'"',$=this._handle.guessLineEndings(t,g)),t=[...t.split($).slice(y)].join($)}this.isFirstChunk&&F(this._config.beforeFirstChunk)&&(g=this._config.beforeFirstChunk(t))!==void 0&&(t=g),this.isFirstChunk=!1,this._halted=!1;var y=this._partialLine+t,g=(this._partialLine="",this._handle.parse(y,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(t=g.meta.cursor,y=(this._finished||(this._partialLine=y.substring(t-this._baseIndex),this._baseIndex=t),g&&g.data&&(this._rowCount+=g.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),n)i.postMessage({results:g,workerId:o.WORKER_ID,finished:y});else if(F(this._config.chunk)&&!s){if(this._config.chunk(g,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=g=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(g.data),this._completeResults.errors=this._completeResults.errors.concat(g.errors),this._completeResults.meta=g.meta),this._completed||!y||!F(this._config.complete)||g&&g.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),y||g&&g.meta.paused||this._nextChunk(),g}this._halted=!0},this._sendError=function(t){F(this._config.error)?this._config.error(t):n&&this._config.error&&i.postMessage({workerId:o.WORKER_ID,error:t,finished:!1})}}function u(e){var t;(e=e||{}).chunkSize||(e.chunkSize=o.RemoteChunkSize),f.call(this,e),this._nextChunk=a?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(s){this._input=s,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),a||(t.onload=te(this._chunkLoaded,this),t.onerror=te(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!a),this._config.downloadRequestHeaders){var s,y=this._config.downloadRequestHeaders;for(s in y)t.setRequestHeader(s,y[s])}var g;this._config.chunkSize&&(g=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+g));try{t.send(this._config.downloadRequestBody)}catch($){this._chunkError($.message)}a&&t.status===0&&this._chunkError()}},this._chunkLoaded=function(){t.readyState===4&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(s=>(s=s.getResponseHeader("Content-Range"))!==null?parseInt(s.substring(s.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(s){s=t.statusText||s,this._sendError(new Error(s))}}function c(e){(e=e||{}).chunkSize||(e.chunkSize=o.LocalChunkSize),f.call(this,e);var t,s,y=typeof FileReader<"u";this.stream=function(g){this._input=g,s=g.slice||g.webkitSlice||g.mozSlice,y?((t=new FileReader).onload=te(this._chunkLoaded,this),t.onerror=te(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var g=this._input,$=(this._config.chunkSize&&($=Math.min(this._start+this._config.chunkSize,this._input.size),g=s.call(g,this._start,$)),t.readAsText(g,this._config.encoding));y||this._chunkLoaded({target:{result:$}})},this._chunkLoaded=function(g){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(g.target.result)},this._chunkError=function(){this._sendError(t.error)}}function b(e){var t;f.call(this,e=e||{}),this.stream=function(s){return t=s,this._nextChunk()},this._nextChunk=function(){var s,y;if(!this._finished)return s=this._config.chunkSize,t=s?(y=t.substring(0,s),t.substring(s)):(y=t,""),this._finished=!t,this.parseChunk(y)}}function h(e){f.call(this,e=e||{});var t=[],s=!0,y=!1;this.pause=function(){f.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){f.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(g){this._input=g,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){y&&t.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):s=!0},this._streamData=te(function(g){try{t.push(typeof g=="string"?g:g.toString(this._config.encoding)),s&&(s=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch($){this._streamError($)}},this),this._streamError=te(function(g){this._streamCleanUp(),this._sendError(g)},this),this._streamEnd=te(function(){this._streamCleanUp(),y=!0,this._streamData("")},this),this._streamCleanUp=te(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function m(e){var t,s,y,g,$=Math.pow(2,53),K=-$,re=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,se=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,A=this,q=0,x=0,X=!1,v=!1,C=[],_={data:[],errors:[],meta:{}};function Q(I){return e.skipEmptyLines==="greedy"?I.join("").trim()==="":I.length===1&&I[0].length===0}function B(){if(_&&y&&(ae("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+o.DefaultDelimiter+"'"),y=!1),e.skipEmptyLines&&(_.data=_.data.filter(function(k){return!Q(k)})),Y()){let k=function(M,W){F(e.transformHeader)&&(M=e.transformHeader(M,W)),C.push(M)};if(_)if(Array.isArray(_.data[0])){for(var I=0;Y()&&I<_.data.length;I++)_.data[I].forEach(k);_.data.splice(0,1)}else _.data.forEach(k)}function D(k,M){for(var W=e.header?{}:[],P=0;P<k.length;P++){var L=P,R=k[P],R=((oe,E)=>(j=>(e.dynamicTypingFunction&&e.dynamicTyping[j]===void 0&&(e.dynamicTyping[j]=e.dynamicTypingFunction(j)),(e.dynamicTyping[j]||e.dynamicTyping)===!0))(oe)?E==="true"||E==="TRUE"||E!=="false"&&E!=="FALSE"&&((j=>{if(re.test(j)&&(j=parseFloat(j),K<j&&j<$))return 1})(E)?parseFloat(E):se.test(E)?new Date(E):E===""?null:E):E)(L=e.header?P>=C.length?"__parsed_extra":C[P]:L,R=e.transform?e.transform(R,L):R);L==="__parsed_extra"?(W[L]=W[L]||[],W[L].push(R)):W[L]=R}return e.header&&(P>C.length?ae("FieldMismatch","TooManyFields","Too many fields: expected "+C.length+" fields but parsed "+P,x+M):P<C.length&&ae("FieldMismatch","TooFewFields","Too few fields: expected "+C.length+" fields but parsed "+P,x+M)),W}var N;_&&(e.header||e.dynamicTyping||e.transform)&&(N=1,!_.data.length||Array.isArray(_.data[0])?(_.data=_.data.map(D),N=_.data.length):_.data=D(_.data,0),e.header&&_.meta&&(_.meta.fields=C),x+=N)}function Y(){return e.header&&C.length===0}function ae(I,D,N,k){I={type:I,code:D,message:N},k!==void 0&&(I.row=k),_.errors.push(I)}F(e.step)&&(g=e.step,e.step=function(I){_=I,Y()?B():(B(),_.data.length!==0&&(q+=I.data.length,e.preview&&q>e.preview?s.abort():(_.data=_.data[0],g(_,A))))}),this.parse=function(I,D,N){var k=e.quoteChar||'"',k=(e.newline||(e.newline=this.guessLineEndings(I,k)),y=!1,e.delimiter?F(e.delimiter)&&(e.delimiter=e.delimiter(I),_.meta.delimiter=e.delimiter):((k=((M,W,P,L,R)=>{var oe,E,j,de;R=R||[",","	","|",";",o.RECORD_SEP,o.UNIT_SEP];for(var pe=0;pe<R.length;pe++){for(var le,me=R[pe],ee=0,ce=0,J=0,ie=(j=void 0,new O({comments:L,delimiter:me,newline:W,preview:10}).parse(M)),fe=0;fe<ie.data.length;fe++)P&&Q(ie.data[fe])?J++:(le=ie.data[fe].length,ce+=le,j===void 0?j=le:0<le&&(ee+=Math.abs(le-j),j=le));0<ie.data.length&&(ce/=ie.data.length-J),(E===void 0||ee<=E)&&(de===void 0||de<ce)&&1.99<ce&&(E=ee,oe=me,de=ce)}return{successful:!!(e.delimiter=oe),bestDelimiter:oe}})(I,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=k.bestDelimiter:(y=!0,e.delimiter=o.DefaultDelimiter),_.meta.delimiter=e.delimiter),ue(e));return e.preview&&e.header&&k.preview++,t=I,s=new O(k),_=s.parse(t,D,N),B(),X?{meta:{paused:!0}}:_||{meta:{paused:!1}}},this.paused=function(){return X},this.pause=function(){X=!0,s.abort(),t=F(e.chunk)?"":t.substring(s.getCharIndex())},this.resume=function(){A.streamer._halted?(X=!1,A.streamer.parseChunk(t,!0)):setTimeout(A.resume,3)},this.aborted=function(){return v},this.abort=function(){v=!0,s.abort(),_.meta.aborted=!0,F(e.complete)&&e.complete(_),t=""},this.guessLineEndings=function(M,k){M=M.substring(0,1048576);var k=new RegExp(w(k)+"([^]*?)"+w(k),"gm"),N=(M=M.replace(k,"")).split("\r"),k=M.split(`
`),M=1<k.length&&k[0].length<N[0].length;if(N.length===1||M)return`
`;for(var W=0,P=0;P<N.length;P++)N[P][0]===`
`&&W++;return W>=N.length/2?`\r
`:"\r"}}function w(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function O(e){var t=(e=e||{}).delimiter,s=e.newline,y=e.comments,g=e.step,$=e.preview,K=e.fastMode,re=null,se=!1,A=e.quoteChar==null?'"':e.quoteChar,q=A;if(e.escapeChar!==void 0&&(q=e.escapeChar),(typeof t!="string"||-1<o.BAD_DELIMITERS.indexOf(t))&&(t=","),y===t)throw new Error("Comment character same as delimiter");y===!0?y="#":(typeof y!="string"||-1<o.BAD_DELIMITERS.indexOf(y))&&(y=!1),s!==`
`&&s!=="\r"&&s!==`\r
`&&(s=`
`);var x=0,X=!1;this.parse=function(v,C,_){if(typeof v!="string")throw new Error("Input must be a string");var Q=v.length,B=t.length,Y=s.length,ae=y.length,I=F(g),D=[],N=[],k=[],M=x=0;if(!v)return ee();if(K||K!==!1&&v.indexOf(A)===-1){for(var W=v.split(s),P=0;P<W.length;P++){if(k=W[P],x+=k.length,P!==W.length-1)x+=s.length;else if(_)return ee();if(!y||k.substring(0,ae)!==y){if(I){if(D=[],de(k.split(t)),ce(),X)return ee()}else de(k.split(t));if($&&$<=P)return D=D.slice(0,$),ee(!0)}}return ee()}for(var L=v.indexOf(t,x),R=v.indexOf(s,x),oe=new RegExp(w(q)+w(A),"g"),E=v.indexOf(A,x);;)if(v[x]===A)for(E=x,x++;;){if((E=v.indexOf(A,E+1))===-1)return _||N.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:D.length,index:x}),le();if(E===Q-1)return le(v.substring(x,E).replace(oe,A));if(A===q&&v[E+1]===q)E++;else if(A===q||E===0||v[E-1]!==q){L!==-1&&L<E+1&&(L=v.indexOf(t,E+1));var j=pe((R=R!==-1&&R<E+1?v.indexOf(s,E+1):R)===-1?L:Math.min(L,R));if(v.substr(E+1+j,B)===t){k.push(v.substring(x,E).replace(oe,A)),v[x=E+1+j+B]!==A&&(E=v.indexOf(A,x)),L=v.indexOf(t,x),R=v.indexOf(s,x);break}if(j=pe(R),v.substring(E+1+j,E+1+j+Y)===s){if(k.push(v.substring(x,E).replace(oe,A)),me(E+1+j+Y),L=v.indexOf(t,x),E=v.indexOf(A,x),I&&(ce(),X))return ee();if($&&D.length>=$)return ee(!0);break}N.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:D.length,index:x}),E++}}else if(y&&k.length===0&&v.substring(x,x+ae)===y){if(R===-1)return ee();x=R+Y,R=v.indexOf(s,x),L=v.indexOf(t,x)}else if(L!==-1&&(L<R||R===-1))k.push(v.substring(x,L)),x=L+B,L=v.indexOf(t,x);else{if(R===-1)break;if(k.push(v.substring(x,R)),me(R+Y),I&&(ce(),X))return ee();if($&&D.length>=$)return ee(!0)}return le();function de(J){D.push(J),M=x}function pe(J){var ie=0;return ie=J!==-1&&(J=v.substring(E+1,J))&&J.trim()===""?J.length:ie}function le(J){return _||(J===void 0&&(J=v.substring(x)),k.push(J),x=Q,de(k),I&&ce()),ee()}function me(J){x=J,de(k),k=[],R=v.indexOf(s,x)}function ee(J){if(e.header&&!C&&D.length&&!se){var ie=D[0],fe=Object.create(null),_e=new Set(ie);let ke=!1;for(let ge=0;ge<ie.length;ge++){let he=ie[ge];if(fe[he=F(e.transformHeader)?e.transformHeader(he,ge):he]){let ye,ve=fe[he];for(;ye=he+"_"+ve,ve++,_e.has(ye););_e.add(ye),ie[ge]=ye,fe[he]++,ke=!0,(re=re===null?{}:re)[ye]=he}else fe[he]=1,ie[ge]=he;_e.add(he)}ke&&console.warn("Duplicate headers found and renamed."),se=!0}return{data:D,errors:N,meta:{delimiter:t,linebreak:s,aborted:X,truncated:!!J,cursor:M+(C||0),renamedHeaders:re}}}function ce(){g(ee()),D=[],N=[]}},this.abort=function(){X=!0},this.getCharIndex=function(){return x}}function z(e){var t=e.data,s=l[t.workerId],y=!1;if(t.error)s.userError(t.error,t.file);else if(t.results&&t.results.data){var g={abort:function(){y=!0,U(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:Z,resume:Z};if(F(s.userStep)){for(var $=0;$<t.results.data.length&&(s.userStep({data:t.results.data[$],errors:t.results.errors,meta:t.results.meta},g),!y);$++);delete t.results}else F(s.userChunk)&&(s.userChunk(t.results,g,t.file),delete t.results)}t.finished&&!y&&U(t.workerId,t.results)}function U(e,t){var s=l[e];F(s.userComplete)&&s.userComplete(t),s.terminate(),delete l[e]}function Z(){throw new Error("Not implemented.")}function ue(e){if(typeof e!="object"||e===null)return e;var t,s=Array.isArray(e)?[]:{};for(t in e)s[t]=ue(e[t]);return s}function te(e,t){return function(){e.apply(t,arguments)}}function F(e){return typeof e=="function"}return o.parse=function(e,t){var s=(t=t||{}).dynamicTyping||!1;if(F(s)&&(t.dynamicTypingFunction=s,s={}),t.dynamicTyping=s,t.transform=!!F(t.transform)&&t.transform,!t.worker||!o.WORKERS_SUPPORTED)return s=null,o.NODE_STREAM_INPUT,typeof e=="string"?(e=(y=>y.charCodeAt(0)!==65279?y:y.slice(1))(e),s=new(t.download?u:b)(t)):e.readable===!0&&F(e.read)&&F(e.on)?s=new h(t):(i.File&&e instanceof File||e instanceof Object)&&(s=new c(t)),s.stream(e);(s=(()=>{var y;return!!o.WORKERS_SUPPORTED&&(y=(()=>{var g=i.URL||i.webkitURL||null,$=T.toString();return o.BLOB_URL||(o.BLOB_URL=g.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",$,")();"],{type:"text/javascript"})))})(),(y=new i.Worker(y)).onmessage=z,y.id=p++,l[y.id]=y)})()).userStep=t.step,s.userChunk=t.chunk,s.userComplete=t.complete,s.userError=t.error,t.step=F(t.step),t.chunk=F(t.chunk),t.complete=F(t.complete),t.error=F(t.error),delete t.worker,s.postMessage({input:e,config:t,workerId:s.id})},o.unparse=function(e,t){var s=!1,y=!0,g=",",$=`\r
`,K='"',re=K+K,se=!1,A=null,q=!1,x=((()=>{if(typeof t=="object"){if(typeof t.delimiter!="string"||o.BAD_DELIMITERS.filter(function(C){return t.delimiter.indexOf(C)!==-1}).length||(g=t.delimiter),typeof t.quotes!="boolean"&&typeof t.quotes!="function"&&!Array.isArray(t.quotes)||(s=t.quotes),typeof t.skipEmptyLines!="boolean"&&typeof t.skipEmptyLines!="string"||(se=t.skipEmptyLines),typeof t.newline=="string"&&($=t.newline),typeof t.quoteChar=="string"&&(K=t.quoteChar),typeof t.header=="boolean"&&(y=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");A=t.columns}t.escapeChar!==void 0&&(re=t.escapeChar+K),t.escapeFormulae instanceof RegExp?q=t.escapeFormulae:typeof t.escapeFormulae=="boolean"&&t.escapeFormulae&&(q=/^[=+\-@\t\r].*$/)}})(),new RegExp(w(K),"g"));if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return X(null,e,se);if(typeof e[0]=="object")return X(A||Object.keys(e[0]),e,se)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||A),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:typeof e.data[0]=="object"?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||typeof e.data[0]=="object"||(e.data=[e.data])),X(e.fields||[],e.data||[],se);throw new Error("Unable to serialize unrecognized input");function X(C,_,Q){var B="",Y=(typeof C=="string"&&(C=JSON.parse(C)),typeof _=="string"&&(_=JSON.parse(_)),Array.isArray(C)&&0<C.length),ae=!Array.isArray(_[0]);if(Y&&y){for(var I=0;I<C.length;I++)0<I&&(B+=g),B+=v(C[I],I);0<_.length&&(B+=$)}for(var D=0;D<_.length;D++){var N=(Y?C:_[D]).length,k=!1,M=Y?Object.keys(_[D]).length===0:_[D].length===0;if(Q&&!Y&&(k=Q==="greedy"?_[D].join("").trim()==="":_[D].length===1&&_[D][0].length===0),Q==="greedy"&&Y){for(var W=[],P=0;P<N;P++){var L=ae?C[P]:P;W.push(_[D][L])}k=W.join("").trim()===""}if(!k){for(var R=0;R<N;R++){0<R&&!M&&(B+=g);var oe=Y&&ae?C[R]:R;B+=v(_[D][oe],R)}D<_.length-1&&(!Q||0<N&&!M)&&(B+=$)}}return B}function v(C,_){var Q,B;return C==null?"":C.constructor===Date?JSON.stringify(C).slice(1,25):(B=!1,q&&typeof C=="string"&&q.test(C)&&(C="'"+C,B=!0),Q=C.toString().replace(x,re),(B=B||s===!0||typeof s=="function"&&s(C,_)||Array.isArray(s)&&s[_]||((Y,ae)=>{for(var I=0;I<ae.length;I++)if(-1<Y.indexOf(ae[I]))return!0;return!1})(Q,o.BAD_DELIMITERS)||-1<Q.indexOf(g)||Q.charAt(0)===" "||Q.charAt(Q.length-1)===" ")?K+Q+K:Q)}},o.RECORD_SEP="",o.UNIT_SEP="",o.BYTE_ORDER_MARK="\uFEFF",o.BAD_DELIMITERS=["\r",`
`,'"',o.BYTE_ORDER_MARK],o.WORKERS_SUPPORTED=!a&&!!i.Worker,o.NODE_STREAM_INPUT=1,o.LocalChunkSize=10485760,o.RemoteChunkSize=5242880,o.DefaultDelimiter=",",o.Parser=O,o.ParserHandle=m,o.NetworkStreamer=u,o.FileStreamer=c,o.StringStreamer=b,o.ReadableStreamStreamer=h,i.jQuery&&((r=i.jQuery).fn.parse=function(e){var t=e.config||{},s=[];return this.each(function($){if(!(r(this).prop("tagName").toUpperCase()==="INPUT"&&r(this).attr("type").toLowerCase()==="file"&&i.FileReader)||!this.files||this.files.length===0)return!0;for(var K=0;K<this.files.length;K++)s.push({file:this.files[K],inputElem:this,instanceConfig:r.extend({},t)})}),y(),this;function y(){if(s.length===0)F(e.complete)&&e.complete();else{var $,K,re,se,A=s[0];if(F(e.before)){var q=e.before(A.file,A.inputElem);if(typeof q=="object"){if(q.action==="abort")return $="AbortError",K=A.file,re=A.inputElem,se=q.reason,void(F(e.error)&&e.error({name:$},K,re,se));if(q.action==="skip")return void g();typeof q.config=="object"&&(A.instanceConfig=r.extend(A.instanceConfig,q.config))}else if(q==="skip")return void g()}var x=A.instanceConfig.complete;A.instanceConfig.complete=function(X){F(x)&&x(X,A.file,A.inputElem),g()},o.parse(A.file,A.instanceConfig)}}function g(){s.splice(0,1),y()}}),n&&(i.onmessage=function(e){e=e.data,o.WORKER_ID===void 0&&e&&(o.WORKER_ID=e.workerId),typeof e.input=="string"?i.postMessage({workerId:o.WORKER_ID,results:o.parse(e.input,e.config),finished:!0}):(i.File&&e.input instanceof File||e.input instanceof Object)&&(e=o.parse(e.input,e.config))&&i.postMessage({workerId:o.WORKER_ID,results:e,finished:!0})}),(u.prototype=Object.create(f.prototype)).constructor=u,(c.prototype=Object.create(f.prototype)).constructor=c,(b.prototype=Object.create(b.prototype)).constructor=b,(h.prototype=Object.create(f.prototype)).constructor=h,o})})(we)),we.exports}var qe=je();const Ne=Le(qe),be=Pe("ReportGenerator");class lt{static async generate(S){const{frameworkType:T,frameworkTitle:i,data:r,format:a,template:n="standard",includeAI:l=!1,aiEnhancements:p}=S;switch(be.info(`Generating ${a.toUpperCase()} report for ${T}...`),a){case"word":return this.generateWord(S);case"pdf":return this.generatePDF(S);case"pptx":return this.generatePowerPoint(S);case"csv":return this.generateCSV(S);default:throw new Error(`Unsupported format: ${a}`)}}static async enhanceReport(S,T,i="standard"){try{const r=await fetch("/api/ai/report-enhance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({frameworkType:S,data:T,enhancementType:"full",verbosity:i})});if(!r.ok)throw new Error("Failed to enhance report");return await r.json()}catch(r){return be.error("Failed to enhance report:",r),{}}}static generateMarkdown(S){const{frameworkType:T,frameworkTitle:i,data:r,aiEnhancements:a}=S;let n="";return n+=`# ${i} Analysis Report

`,n+=`**Title:** ${r.title||"Untitled Analysis"}  
`,n+=`**Date:** ${new Date().toLocaleDateString()}  
`,n+=`**Framework:** ${i}  
`,r.source_url&&(n+=`**Source:** ${r.source_url}  
`),n+=`
---

`,a?.executiveSummary&&(n+=`## ðŸ“ Executive Summary

`,n+=`${a.executiveSummary}

`),a?.keyInsights&&a.keyInsights.length>0&&(n+=`## ðŸ’¡ Key Insights

`,a.keyInsights.forEach((l,p)=>{n+=`${p+1}. ${l}
`}),n+=`
`),T==="behavior"?n+=this.generateBehaviorMarkdown(r,a):n+=this.generateGenericMarkdown(T,i,r),a?.recommendations&&a.recommendations.length>0&&(n+=`## ðŸŽ¯ Recommendations

`,a.recommendations.forEach((l,p)=>{n+=`${p+1}. ${l}
`}),n+=`
`),a?.comprehensiveAnalysis&&(n+=`## ðŸ“Š Comprehensive Analysis

`,n+=`${a.comprehensiveAnalysis}

`),n}static generateBehaviorMarkdown(S,T){let i="";if(i+=`## ðŸ“‹ Behavior Process Overview

`,S.description&&(i+=`${S.description}

`),i+=`## âœ… Requirements for Behavior Completion

`,i+=`This section outlines the capabilities and opportunities necessary to perform the analyzed behavior.

`,S.com_b_deficits){const a=S.com_b_deficits,n={physical_capability:{label:"Physical Capability",icon:"ðŸ’ª",desc:"Physical skills, strength, stamina required"},psychological_capability:{label:"Psychological Capability",icon:"ðŸ§ ",desc:"Knowledge, cognitive skills, comprehension needed"},physical_opportunity:{label:"Physical Opportunity",icon:"ðŸŒ",desc:"Environmental factors, time, resources, infrastructure"},social_opportunity:{label:"Social Opportunity",icon:"ðŸ‘¥",desc:"Cultural norms, social cues, peer influence"},reflective_motivation:{label:"Reflective Motivation",icon:"ðŸŽ¯",desc:"Beliefs, intentions, goals, identity alignment"},automatic_motivation:{label:"Automatic Motivation",icon:"âš¡",desc:"Emotions, impulses, habits, desires"}};i+=`### Capability Requirements

`,Object.entries(a).forEach(([f,u])=>{if(f.includes("capability")){const c=n[f];i+=`**${c.icon} ${c.label}**

`,i+=`*${c.desc}*

`,i+=`Status: ${u==="adequate"?"âœ“ Generally Adequate":u==="deficit"?"âš  Some Limitations":"âœ– Significant Barriers"}

`}}),i+=`### Opportunity Requirements

`,Object.entries(a).forEach(([f,u])=>{if(f.includes("opportunity")){const c=n[f];i+=`**${c.icon} ${c.label}**

`,i+=`*${c.desc}*

`,i+=`Status: ${u==="adequate"?"âœ“ Generally Available":u==="deficit"?"âš  Limited Availability":"âœ– Significant Constraints"}

`}}),i+=`### Motivation Factors

`,Object.entries(a).forEach(([f,u])=>{if(f.includes("motivation")){const c=n[f];i+=`**${c.icon} ${c.label}**

`,i+=`*${c.desc}*

`,i+=`Status: ${u==="adequate"?"âœ“ Generally Present":u==="deficit"?"âš  Variable":"âœ– Often Absent"}

`}}),i+=`## ðŸ‘¥ Potential Target Audiences

`,i+=`*Based on capability, opportunity, and motivation analysis*

`,Object.values(a).some(f=>f!=="adequate")&&(i+=`### To Increase Behavior

`,i+=`Target audiences that currently have barriers but could perform the behavior with appropriate support:

`,Object.entries(a).forEach(([f,u])=>{if(u!=="adequate"){const c=n[f];i+=`- Individuals lacking ${c.label.toLowerCase()} (${c.desc.toLowerCase()})
`}}),i+=`
`),i+=`### To Decrease Behavior

`,i+=`Target audiences currently performing the behavior:

`;const p=Object.entries(a).filter(([,f])=>f==="adequate").map(([f])=>n[f]);if(p.length>0?i+=`- Individuals with adequate ${p.map(f=>f.label.toLowerCase()).join(", ")}
`:i+=`- General population (no significant enabling factors identified)
`,i+=`
`,Object.values(a).some(f=>f==="deficit"||f==="major_barrier")){const f=Ee(a);if(f.length>0&&(i+=`## ðŸ”§ Behaviour Change Wheel - Intervention Recommendations

`,i+=`*Note: These recommendations are generated because COM-B deficits were identified.*

`,i+=`*Based on Behaviour Change Wheel (Michie et al., 2011)*

`,f.forEach(u=>{i+=`### ${u.component} (${u.severity.replace("_"," ").toUpperCase()})

`,u.interventions.forEach(c=>{const b=Se[c.name],h=c.priority.toUpperCase(),m=c.name.split("_").map(w=>w.charAt(0).toUpperCase()+w.slice(1)).join(" ");i+=`#### ${m} [${h} PRIORITY]

`,i+=`**Definition:** ${b.definition}

`,i+=`**Evidence Base:** *${c.evidence_base}*

`})})),S.selected_interventions&&S.selected_interventions.length>0){const u=Te(S.selected_interventions);u.length>0&&(i+=`## ðŸ“œ Policy Category Recommendations

`,u.forEach(c=>{const b=c.name.split("_").map(h=>h.charAt(0).toUpperCase()+h.slice(1)).join(" ");i+=`### ${b}

`,i+=`${Ae[c.policy]}

`,i+=`**Suitable For Interventions:** ${c.suitable_for_interventions.map(h=>h.split("_").map(m=>m.charAt(0).toUpperCase()+m.slice(1)).join(" ")).join(", ")}

`}))}}}S.timeline&&S.timeline.length>0&&(i+=`## ðŸ“… Behavior Process Flow & Timeline

`,i+=`This section documents the step-by-step process to complete the behavior, including decision points, sub-steps, and requirements.

`,S.timeline.forEach((a,n)=>{i+=`### Step ${n+1}: ${a.label}

`,a.description&&(i+=`**Description:** ${a.description}

`);const l=[];a.time&&l.push(`â° Time: ${a.time}`),a.location&&l.push(`ðŸ“ Location: ${a.location}`),a.duration&&l.push(`â±ï¸ Duration: ${a.duration}`),a.resources&&l.push(`ðŸ”§ Resources: ${a.resources}`),l.length>0&&(i+=l.map(p=>`- ${p}`).join(`
`)+`

`),a.sub_steps&&a.sub_steps.length>0&&(i+=`**Sub-steps:**

`,a.sub_steps.forEach((p,o)=>{i+=`  ${o+1}. ${p.label}`,p.duration&&(i+=` (Duration: ${p.duration})`),p.description&&(i+=`
     *${p.description}*`),i+=`
`}),i+=`
`),a.decision_point&&(i+=`**Decision Point:** ${a.decision_point}

`),a.alternatives&&a.alternatives.length>0&&(i+=`**Alternative Paths:**

`,a.alternatives.forEach(p=>{i+=`- ${p}
`}),i+=`
`),i+=`---

`}));const r=ne.behavior;return r?.sections&&r.sections.forEach(a=>{a.key.includes("capability")||a.key.includes("opportunity")||a.key.includes("motivation")||a.key==="timeline"||S[a.key]&&S[a.key].length>0&&(i+=`## ${a.label}

`,S[a.key].forEach((n,l)=>{V(n)?(i+=`**Q:** ${n.question}  
`,i+=`**A:** ${n.answer||"No answer provided"}

`):typeof n=="string"&&(i+=`- ${n}
`)}),i+=`
`)}),i}static generateGenericMarkdown(S,T,i){let r="";const a=ne[S];return a?.sections&&a.sections.forEach(n=>{i[n.key]&&i[n.key].length>0&&(r+=`## ${n.label}

`,i[n.key].forEach((l,p)=>{V(l)?(r+=`**Q${p+1}:** ${l.question}  
`,r+=`**A:** ${l.answer||"No answer provided"}

`):typeof l=="string"?r+=`${p+1}. ${l}
`:typeof l=="object"&&(r+=`${p+1}. ${JSON.stringify(l)}
`)}),r+=`
`)}),r}static async generateWord(S){const{frameworkType:T,frameworkTitle:i,data:r,aiEnhancements:a}=S,n=[];if(n.push(new d({text:`${i} Analysis Report`,heading:H.HEADING_1,alignment:Ce.CENTER,spacing:{after:400}})),n.push(new d({text:`Title: ${r.title||"Untitled Analysis"}`,spacing:{after:200}}),new d({text:`Date: ${new Date().toLocaleDateString()}`,spacing:{after:200}}),new d({text:`Framework: ${i}`,spacing:{after:r.source_url?200:400}})),r.source_url&&n.push(new d({text:`Source: ${r.source_url}`,spacing:{after:400}})),a?.executiveSummary&&n.push(new d({text:"Executive Summary",heading:H.HEADING_2,spacing:{before:400,after:200}}),new d({text:a.executiveSummary,spacing:{after:400}})),r.description&&n.push(new d({text:"Analysis Overview",heading:H.HEADING_2,spacing:{before:400,after:200}}),new d({text:r.description,spacing:{after:400}})),(ne[T]?.itemType||"text")==="qa"){const u=ne[T],c={};let b=0;u?.sections&&u.sections.forEach(h=>{if(r[h.key]&&r[h.key].length>0){const m=r[h.key].filter(w=>V(w)&&(!w.answer||w.answer.trim()==="")).length;m>0&&(c[h.label]=m,b+=m)}}),b>0&&(n.push(new d({text:"âš ï¸ Unanswered Questions Summary",heading:H.HEADING_2,spacing:{before:400,after:200}}),new d({text:`Total unanswered questions: ${b}`,spacing:{after:200}})),Object.entries(c).forEach(([h,m])=>{n.push(new d({text:`â€¢ ${h}: ${m} unanswered`,spacing:{after:100},indent:{left:360}}))}),n.push(new d({text:"",spacing:{after:400}})))}n.push(...this.getFrameworkContent(S)),a?.keyInsights&&a.keyInsights.length>0&&(n.push(new d({text:"Key Insights",heading:H.HEADING_2,spacing:{before:400,after:200}})),a.keyInsights.forEach((u,c)=>{n.push(new d({text:`${c+1}. ${u}`,spacing:{after:100}}))}),n.push(new d({text:"",spacing:{after:400}}))),a?.recommendations&&a.recommendations.length>0&&(n.push(new d({text:"Recommendations",heading:H.HEADING_2,spacing:{before:400,after:200}})),a.recommendations.forEach((u,c)=>{n.push(new d({text:`${c+1}. ${u}`,spacing:{after:100}}))}));const o=new Ie({sections:[{properties:{},children:n}]}),f=await Re.toBlob(o);this.downloadFile(f,`${r.title||"report"}.docx`)}static async generatePDF(S){const{frameworkType:T,frameworkTitle:i,data:r,aiEnhancements:a}=S,n=new De;let l=20;const o=(ne[T]?.itemType||"text")==="qa",f=T==="dime",u={Diplomatic:[41,98,255],Information:[16,185,129],Military:[239,68,68],Economic:[245,158,11]},c=(h=20)=>{l>280-h&&(n.addPage(),l=20)};if(n.setFontSize(20),n.text(`${i} Analysis Report`,105,l,{align:"center"}),l+=15,n.setFontSize(11),n.text(`Title: ${r.title||"Untitled Analysis"}`,20,l),l+=7,n.text(`Date: ${new Date().toLocaleDateString()}`,20,l),l+=7,n.text(`Framework: ${i}`,20,l),l+=7,r.source_url){const h=`Source: ${r.source_url}`,m=n.splitTextToSize(h,170);n.text(m,20,l),l+=m.length*7}if(l+=8,o){const h=ne[T],m={};let w=0;h?.sections&&h.sections.forEach(O=>{if(r[O.key]&&r[O.key].length>0){const z=r[O.key].filter(U=>V(U)&&(!U.answer||U.answer.trim()==="")).length;z>0&&(m[O.label]=z,w+=z)}}),w>0&&(c(25),n.setDrawColor(255,193,7),n.setFillColor(255,248,225),n.rect(15,l-5,180,20+Object.keys(m).length*5,"FD"),n.setFontSize(12),n.setFont("helvetica","bold"),n.setTextColor(120,53,15),n.text("Unanswered Questions",20,l),l+=7,n.setFontSize(10),n.setFont("helvetica","normal"),n.text(`${w} total`,20,l),l+=5,Object.entries(m).forEach(([O,z])=>{n.setFontSize(9),n.text(`${O}: ${z}`,25,l),l+=5}),l+=5,n.setTextColor(0,0,0))}if(a?.executiveSummary){c(30),n.setFontSize(14),n.setFont("helvetica","bold"),n.text("Executive Summary",20,l),l+=10,n.setFontSize(11),n.setFont("helvetica","normal");const h=n.splitTextToSize(a.executiveSummary,170);n.text(h,20,l),l+=h.length*7+10}const b=ne[T];b?.sections&&b.sections.forEach(h=>{if(r[h.key]&&r[h.key].length>0){if(c(25),f){const w=u[h.label]||[30,30,30];n.setFillColor(...w),n.rect(15,l-6,180,12,"F"),n.setFontSize(14),n.setFont("helvetica","bold"),n.setTextColor(255,255,255),n.text(`${h.label}`,20,l),l+=12,n.setTextColor(0,0,0)}else n.setFontSize(14),n.setFont("helvetica","bold"),n.text(`${h.label}`,20,l),l+=10;n.setFontSize(11),n.setFont("helvetica","normal");let m=[...r[h.key]];o&&m.sort((w,O)=>{if(!V(w)||!V(O))return 0;const z=w.answer&&w.answer.trim()!=="",U=O.answer&&O.answer.trim()!=="";return z&&!U?-1:!z&&U?1:0}),m.forEach((w,O)=>{if(o&&V(w)){const z=w.answer&&w.answer.trim()!=="",U=n.splitTextToSize(`Q: ${w.question}`,165),Z=n.splitTextToSize(`A: ${w.answer||"No answer provided"}`,160),ue=U.length*6+Z.length*6+8;if(c(ue),f){const s=ue-2;n.setDrawColor(220,220,220),n.setFillColor(250,250,250),n.rect(22,l-3,168,s,"FD")}n.setFont("helvetica","bold"),n.setTextColor(0,0,0);const te=`Q: ${w.question}`,F=n.splitTextToSize(te,160);n.text(F,25,l),l+=F.length*6+2,n.setFont("helvetica",z?"normal":"italic"),z?n.setTextColor(60,60,60):n.setTextColor(150,150,150);const e=`A: ${w.answer||"No answer provided"}`,t=n.splitTextToSize(e,155);n.text(t,30,l),l+=t.length*6+6,n.setTextColor(0,0,0)}else{c(10);const z="text"in w?w.text:w.question||"",U=`${O+1}. ${z}`,Z=n.splitTextToSize(U,165);n.text(Z,25,l),l+=Z.length*6+2}}),l+=10}}),a?.keyInsights&&a.keyInsights.length>0&&(c(30),n.setFontSize(14),n.setFont("helvetica","bold"),n.text("Key Insights",20,l),l+=10,n.setFontSize(11),n.setFont("helvetica","normal"),a.keyInsights.forEach((h,m)=>{c(10);const w=`${m+1}. ${h}`,O=n.splitTextToSize(w,165);n.text(O,25,l),l+=O.length*6+2}),l+=8),a?.recommendations&&a.recommendations.length>0&&(c(30),n.setFontSize(14),n.setFont("helvetica","bold"),n.text("Recommendations",20,l),l+=10,n.setFontSize(11),n.setFont("helvetica","normal"),a.recommendations.forEach((h,m)=>{c(10);const w=`${m+1}. ${h}`,O=n.splitTextToSize(w,165);n.text(O,25,l),l+=O.length*6+2})),n.save(`${r.title||"report"}.pdf`)}static async generatePowerPoint(S){const{frameworkType:T,frameworkTitle:i,data:r,aiEnhancements:a}=S,n=new Fe,p=(ne[T]?.itemType||"text")==="qa",o=n.addSlide();if(o.addText(`${i} Analysis`,{x:.5,y:1.5,w:9,h:1,fontSize:40,bold:!0,align:"center"}),o.addText(r.title||"Analysis Report",{x:.5,y:2.8,w:9,h:.5,fontSize:24,align:"center"}),o.addText(new Date().toLocaleDateString(),{x:.5,y:4.5,w:9,h:.3,fontSize:14,align:"center",color:"666666"}),r.source_url&&o.addText(`Source: ${r.source_url}`,{x:.5,y:5,w:9,h:.3,fontSize:12,align:"center",color:"0066CC"}),a?.executiveSummary){const u=n.addSlide();u.addText("Executive Summary",{x:.5,y:.5,w:9,h:.75,fontSize:32,bold:!0}),u.addText(a.executiveSummary,{x:.5,y:1.5,w:9,h:4,fontSize:18})}if(p){const u=ne[T],c={};let b=0;if(u?.sections&&u.sections.forEach(h=>{if(r[h.key]&&r[h.key].length>0){const m=r[h.key].filter(w=>V(w)&&(!w.answer||w.answer.trim()==="")).length;m>0&&(c[h.label]=m,b+=m)}}),b>0){const h=n.addSlide();h.addText("âš ï¸ Unanswered Questions Summary",{x:.5,y:.5,w:9,h:.75,fontSize:32,bold:!0,color:"C83232"}),h.addText(`Total unanswered questions: ${b}`,{x:.5,y:1.5,w:9,h:.4,fontSize:18,bold:!0});let m=2.1;Object.entries(c).forEach(([w,O])=>{h.addText(`â€¢ ${w}: ${O} unanswered`,{x:.5,y:m,w:9,h:.35,fontSize:16}),m+=.4})}}const f=ne[T];if(f?.sections&&f.sections.forEach(u=>{if(r[u.key]&&r[u.key].length>0){let c=[...r[u.key]];p&&c.sort((m,w)=>{if(!V(m)||!V(w))return 0;const O=m.answer&&m.answer.trim()!=="",z=w.answer&&w.answer.trim()!=="";return O&&!z?-1:!O&&z?1:0});const b=p?3:6,h=Math.ceil(c.length/b);for(let m=0;m<h;m++){const w=n.addSlide(),O=c.slice(m*b,(m+1)*b),z=h>1?`${u.label} (${m+1}/${h})`:u.label;w.addText(z,{x:.5,y:.5,w:9,h:.6,fontSize:32,bold:!0,color:"1F4788"});let U=1.3;O.forEach((Z,ue)=>{if(p&&V(Z)){const te=Z.answer&&Z.answer.trim()!=="";w.addText(`Q: ${Z.question}`,{x:.5,y:U,w:9,h:.4,fontSize:16,bold:!0,color:"333333"}),U+=.4,w.addText(`A: ${Z.answer||"No answer provided"}`,{x:.8,y:U,w:8.7,h:.5,fontSize:14,color:te?"666666":"999999",italic:!te}),U+=.7}else{const te="text"in Z?Z.text:Z.question||"";w.addText(`${m*b+ue+1}. ${te}`,{x:.5,y:U,w:9,h:.5,fontSize:16,color:"333333",bullet:!1}),U+=.6}})}}}),a?.keyInsights&&a.keyInsights.length>0){const u=n.addSlide();u.addText("Key Insights",{x:.5,y:.5,w:9,h:.6,fontSize:32,bold:!0,color:"1F4788"});let c=1.3;a.keyInsights.forEach((b,h)=>{u.addText(`${h+1}. ${b}`,{x:.5,y:c,w:9,h:.5,fontSize:16,color:"333333"}),c+=.6})}if(a?.recommendations&&a.recommendations.length>0){const u=n.addSlide();u.addText("Recommendations",{x:.5,y:.5,w:9,h:.6,fontSize:32,bold:!0,color:"1F4788"});let c=1.3;a.recommendations.forEach((b,h)=>{u.addText(`${h+1}. ${b}`,{x:.5,y:c,w:9,h:.5,fontSize:16,color:"333333"}),c+=.6})}n.writeFile({fileName:`${r.title||"report"}.pptx`})}static generateCSV(S){const{frameworkType:T,data:i}=S,r=[];r.push(["Framework Type",T]),r.push(["Title",i.title||"Untitled"]),r.push(["Description",i.description||""]),r.push(["Date",new Date().toLocaleDateString()]),i.source_url&&r.push(["Source URL",i.source_url]),r.push([]);const n=(ne[T]?.itemType||"text")==="qa";if(T==="swot")r.push(["Category","Item"]),i.strengths?.forEach(o=>r.push(["Strength",o.text])),i.weaknesses?.forEach(o=>r.push(["Weakness",o.text])),i.opportunities?.forEach(o=>r.push(["Opportunity",o.text])),i.threats?.forEach(o=>r.push(["Threat",o.text]));else if(n){r.push(["Section","Question","Answer","Status"]);const o=ne[T];o?.sections&&o.sections.forEach(f=>{if(i[f.key]&&i[f.key].length>0){let u=[...i[f.key]];u.sort((c,b)=>{if(!V(c)||!V(b))return 0;const h=c.answer&&c.answer.trim()!=="",m=b.answer&&b.answer.trim()!=="";return h&&!m?-1:!h&&m?1:0}),u.forEach(c=>{if(V(c)){const b=c.answer&&c.answer.trim()!=="";r.push([f.label,c.question,c.answer||"No answer provided",b?"Answered":"Unanswered"])}else{const b="text"in c?c.text:c.question||"";r.push([f.label,b,"","N/A"])}})}})}else r.push(["Section","Item"]),Object.keys(i).forEach(o=>{Array.isArray(i[o])&&i[o].forEach(f=>{r.push([o.toUpperCase(),f.text||f])})});const l=Ne.unparse(r),p=new Blob([l],{type:"text/csv;charset=utf-8;"});this.downloadFile(p,`${i.title||"report"}.csv`)}static getFrameworkContent(S){const{frameworkType:T,data:i}=S,r=[],n=(ne[T]?.itemType||"text")==="qa";if(T==="swot")[{key:"strengths",label:"Strengths",icon:"ðŸ’ª"},{key:"weaknesses",label:"Weaknesses",icon:"âš ï¸"},{key:"opportunities",label:"Opportunities",icon:"ðŸŽ¯"},{key:"threats",label:"Threats",icon:"âš¡"}].forEach(p=>{i[p.key]&&i[p.key].length>0&&(r.push(new d({text:`${p.icon} ${p.label}`,heading:H.HEADING_3,spacing:{before:300,after:150}})),i[p.key].forEach(o=>{r.push(new d({text:`â€¢ ${o.text}`,spacing:{after:100},indent:{left:360}}))}))});else if(T==="stakeholder"){r.push(new d({text:"Stakeholder Power/Interest Matrix",heading:H.HEADING_2,spacing:{before:400,after:200}})),[{key:"high_power_high_interest",label:"ðŸ‘‘ Key Players (High Power, High Interest)",strategy:"MANAGE CLOSELY",tactics:["Schedule regular 1-on-1 meetings and personal engagement","Involve directly in major decision-making processes","Build strong, trust-based relationships","Seek input on strategy and provide early visibility","Respond immediately to concerns or requests"]},{key:"high_power_low_interest",label:"ðŸ¤ Keep Satisfied (High Power, Low Interest)",strategy:"KEEP SATISFIED",tactics:["Provide monthly progress updates and status reports","Address concerns proactively before they escalate","Keep informed but avoid over-engagement","Monitor for changes in interest level or position","Ensure their needs are met without excessive demands"]},{key:"low_power_high_interest",label:"ðŸ“¢ Keep Informed (Low Power, High Interest)",strategy:"KEEP INFORMED",tactics:["Send regular newsletters and project updates","Leverage as advocates and champions for the initiative","Consult on relevant issues where their expertise helps","Build grassroots support and coalition","Provide opportunities for meaningful participation"]},{key:"low_power_low_interest",label:"ðŸ‘¥ Monitor (Low Power, Low Interest)",strategy:"MONITOR",tactics:["Include in periodic broad communications only","Apply minimal engagement effort","Watch for changes in power or interest status","Keep on distribution lists for awareness","Respond to inquiries but don't proactively engage"]}].forEach(f=>{const u=i[f.key]||[];u.length>0&&(r.push(new d({text:f.label,heading:H.HEADING_3,spacing:{before:300,after:150}})),r.push(new d({children:[new G({text:`Strategy: ${f.strategy}`,bold:!0})],spacing:{after:100},indent:{left:360}})),r.push(new d({children:[new G({text:`Stakeholder Count: ${u.length}`,italics:!0})],spacing:{after:150},indent:{left:360}})),r.push(new d({children:[new G({text:"Engagement Tactics:",bold:!0})],spacing:{after:100},indent:{left:360}})),f.tactics.forEach(c=>{r.push(new d({text:`â€¢ ${c}`,spacing:{after:80},indent:{left:720}}))}),r.push(new d({children:[new G({text:"Stakeholders:",bold:!0})],spacing:{before:150,after:100},indent:{left:360}})),u.forEach(c=>{const b=c.text||c.name||"Unnamed stakeholder";r.push(new d({text:`â€¢ ${b}`,spacing:{after:80},indent:{left:720}}))}),r.push(new d({text:"",spacing:{after:200}})))});const p=(i.high_power_high_interest?.length||0)+(i.high_power_low_interest?.length||0)+(i.low_power_high_interest?.length||0)+(i.low_power_low_interest?.length||0),o=(i.high_power_high_interest?.length||0)+(i.high_power_low_interest?.length||0);r.push(new d({text:"Stakeholder Engagement Summary",heading:H.HEADING_3,spacing:{before:400,after:200}})),r.push(new d({text:`â€¢ Total Stakeholders Identified: ${p}`,spacing:{after:100},indent:{left:360}})),r.push(new d({text:`â€¢ High Priority (Requiring Active Management): ${o} stakeholders`,spacing:{after:100},indent:{left:360}})),r.push(new d({text:`â€¢ Key Players (Top Priority): ${i.high_power_high_interest?.length||0} stakeholders`,spacing:{after:100},indent:{left:360}})),r.push(new d({text:`â€¢ Potential Advocates: ${i.low_power_high_interest?.length||0} stakeholders`,spacing:{after:100},indent:{left:360}}))}else if(T==="behavior"){if(i.com_b_deficits){const p=i.com_b_deficits;r.push(new d({text:"ðŸŽ¯ COM-B Assessment Summary",heading:H.HEADING_2,spacing:{before:400,after:200}})),r.push(new d({children:[new G({text:"Capability, Opportunity, Motivation â†’ Behavior (Michie et al., 2011)",italics:!0})],spacing:{after:300}}));const o={major_barrier:Object.values(p).filter(h=>h==="major_barrier").length,deficit:Object.values(p).filter(h=>h==="deficit").length,adequate:Object.values(p).filter(h=>h==="adequate").length};r.push(new d({text:`âœ“ Adequate: ${o.adequate} components`,spacing:{after:100},indent:{left:360}})),r.push(new d({text:`âš  Deficit: ${o.deficit} components`,spacing:{after:100},indent:{left:360}})),r.push(new d({text:`âœ– Major Barrier: ${o.major_barrier} components`,spacing:{after:300},indent:{left:360}})),r.push(new d({text:"Component Status Breakdown",heading:H.HEADING_3,spacing:{before:300,after:150}}));const f={physical_capability:{label:"Physical Capability",icon:"ðŸ’ª"},psychological_capability:{label:"Psychological Capability",icon:"ðŸ§ "},physical_opportunity:{label:"Physical Opportunity",icon:"ðŸŒ"},social_opportunity:{label:"Social Opportunity",icon:"ðŸ‘¥"},reflective_motivation:{label:"Reflective Motivation",icon:"ðŸŽ¯"},automatic_motivation:{label:"Automatic Motivation",icon:"âš¡"}};Object.entries(p).forEach(([h,m])=>{const w=f[h],O=m==="major_barrier"?"âœ– Major Barrier":m==="deficit"?"âš  Deficit":"âœ“ Adequate";r.push(new d({children:[new G({text:`${w.icon} ${w.label}: `,bold:!0}),new G({text:O})],spacing:{after:100},indent:{left:360}}))});const u=Oe(p);r.push(new d({text:"Behavior Change Feasibility",heading:H.HEADING_3,spacing:{before:400,after:150}}));const c=u.feasibility.charAt(0).toUpperCase()+u.feasibility.slice(1);r.push(new d({children:[new G({text:"Overall Feasibility: ",bold:!0}),new G({text:c})],spacing:{after:200},indent:{left:360}})),u.barriers.length>0&&(r.push(new d({children:[new G({text:"Barriers Identified:",bold:!0})],spacing:{after:100},indent:{left:360}})),u.barriers.forEach(h=>{r.push(new d({text:`â€¢ ${h}`,spacing:{after:80},indent:{left:720}}))})),u.strengths.length>0&&(r.push(new d({children:[new G({text:"Strengths:",bold:!0})],spacing:{before:150,after:100},indent:{left:360}})),u.strengths.forEach(h=>{r.push(new d({text:`â€¢ ${h}`,spacing:{after:80},indent:{left:720}}))}));const b=Ee(p);if(b.length>0&&(r.push(new d({text:"Recommended Intervention Functions",heading:H.HEADING_2,spacing:{before:400,after:200}})),r.push(new d({children:[new G({text:"Based on the Behaviour Change Wheel (Michie et al., 2011)",italics:!0})],spacing:{after:300}})),b.forEach(h=>{r.push(new d({text:`${h.component} (${h.severity.replace("_"," ").toUpperCase()})`,heading:H.HEADING_3,spacing:{before:300,after:150}})),h.interventions.forEach(m=>{const w=Se[m.name],O=m.priority.toUpperCase();r.push(new d({children:[new G({text:`${m.name.split("_").map(z=>z.charAt(0).toUpperCase()+z.slice(1)).join(" ")} [${O} PRIORITY]`,bold:!0})],spacing:{before:150,after:100},indent:{left:360}})),r.push(new d({children:[new G({text:"Definition: ",bold:!0}),new G({text:w.definition})],spacing:{after:100},indent:{left:720}})),r.push(new d({children:[new G({text:"Evidence Base:",bold:!0})],spacing:{after:80},indent:{left:720}})),r.push(new d({children:[new G({text:m.evidence_base,italics:!0})],spacing:{after:150},indent:{left:720}}))})})),i.selected_interventions&&i.selected_interventions.length>0){const h=Te(i.selected_interventions);h.length>0&&(r.push(new d({text:"Policy Category Recommendations",heading:H.HEADING_2,spacing:{before:400,after:200}})),r.push(new d({children:[new G({text:`${h.length} policy categories support the selected intervention functions`,italics:!0})],spacing:{after:300}})),h.forEach(m=>{r.push(new d({text:m.name,heading:H.HEADING_3,spacing:{before:300,after:150}})),r.push(new d({text:m.description,spacing:{after:150},indent:{left:360}})),r.push(new d({children:[new G({text:"Examples:",bold:!0})],spacing:{after:100},indent:{left:360}})),m.examples.forEach(w=>{r.push(new d({text:`â€¢ ${w}`,spacing:{after:80},indent:{left:720}}))})}))}}const l=ne[T];l?.sections&&(r.push(new d({text:"Detailed Analysis",heading:H.HEADING_2,spacing:{before:400,after:200}})),l.sections.forEach(p=>{p.key.includes("capability")||p.key.includes("opportunity")||p.key.includes("motivation")||i[p.key]&&i[p.key].length>0&&(r.push(new d({text:`${p.icon||""} ${p.label}`,heading:H.HEADING_3,spacing:{before:300,after:150}})),i[p.key].forEach(o=>{const f=o.text||o.title||JSON.stringify(o);r.push(new d({text:`â€¢ ${f}`,spacing:{after:100},indent:{left:360}}))}))}))}else{const l=ne[T];l?.sections&&l.sections.forEach(p=>{if(i[p.key]&&i[p.key].length>0){r.push(new d({text:`${p.icon||""} ${p.label}`,heading:H.HEADING_3,spacing:{before:300,after:150}}));let o=[...i[p.key]];n&&o.sort((f,u)=>{if(!V(f)||!V(u))return 0;const c=f.answer&&f.answer.trim()!=="",b=u.answer&&u.answer.trim()!=="";return c&&!b?-1:!c&&b?1:0}),o.forEach(f=>{if(n&&V(f)){const u=f.answer&&f.answer.trim()!=="";r.push(new d({text:`Q: ${f.question}`,spacing:{after:50},indent:{left:360},bullet:{level:0}})),r.push(new d({children:[new G({text:`A: ${f.answer||"No answer provided"}`,italics:!u,color:u?"000000":"999999"})],spacing:{after:100},indent:{left:720}}))}else{const u="text"in f?f.text:f.question||"";r.push(new d({text:`â€¢ ${u}`,spacing:{after:100},indent:{left:360}}))}})}})}return r}static downloadFile(S,T){const i=URL.createObjectURL(S),r=document.createElement("a");r.href=i,r.download=T,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),be.info(`âœ“ Downloaded: ${T}`)}}export{lt as ReportGenerator};
