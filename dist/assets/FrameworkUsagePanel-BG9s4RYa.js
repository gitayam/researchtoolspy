import{j as e}from"./ui-vendor-DBphXmDA.js";import{r as d,f as de}from"./react-vendor-CfYLSWvh.js";import{y as w,S as T,z as A,C as D,E as I,F as x,I as B,e as p,B as b,q as oe}from"./index-DGGXJgUa.js";import{C as M,a as Y,b as J,c as ae,d as U}from"./card-BQo7RV_Z.js";import{S as xe}from"./slider-oUJ8z5Zt.js";import{z as $,S as he,a7 as re,X as me,r as ue,$ as ee,q as se,C as X,ai as pe,Y as ge,a as ye,bp as je,bq as _e,W as te,B as V,w as fe,V as ve,x as be,d as Ne,E as Ee}from"./icons-x9tcvtYN.js";import{P as Ce}from"./progress-D6O6TLpv.js";function Fe({relationship:t,sourceEntityId:g,sourceEntityType:N,workspaceId:y,onSubmit:o,onCancel:_}){const u=!!t,[s,h]=d.useState({source_entity_id:t?.source_entity_id||g||"",source_entity_type:t?.source_entity_type||N||"ACTOR",target_entity_id:t?.target_entity_id||"",target_entity_type:t?.target_entity_type||"ACTOR",relationship_type:t?.relationship_type||"CUSTOM",description:t?.description||"",weight:t?.weight||.5,confidence:t?.confidence||"POSSIBLE",start_date:t?.start_date||"",end_date:t?.end_date||""}),[i,f]=d.useState(!1),[v,j]=d.useState(null),[m,P]=d.useState({source:"",target:""}),[l,C]=d.useState([]),[F,H]=d.useState(!1),[R,z]=d.useState(!1),[c,O]=d.useState(null),W=["ACTOR","SOURCE","EVIDENCE","EVENT","PLACE","BEHAVIOR"],G=[{value:"CONTROLS",label:"Controls",description:"Has authority or control over"},{value:"REPORTS_TO",label:"Reports To",description:"Reports to or is subordinate to"},{value:"ALLIED_WITH",label:"Allied With",description:"Cooperative or allied relationship"},{value:"ADVERSARY_OF",label:"Adversary Of",description:"Opposing or hostile relationship"},{value:"MEMBER_OF",label:"Member Of",description:"Member or part of"},{value:"LOCATED_AT",label:"Located At",description:"Physically located at"},{value:"PARTICIPATED_IN",label:"Participated In",description:"Took part in or attended"},{value:"PROVIDED_BY",label:"Provided By",description:"Information or resource provided by"},{value:"EXHIBITS",label:"Exhibits",description:"Demonstrates or shows behavior"},{value:"CORROBORATES",label:"Corroborates",description:"Supports or confirms"},{value:"CONTRADICTS",label:"Contradicts",description:"Conflicts with or refutes"},{value:"DEPENDS_ON",label:"Depends On",description:"Requires or relies on"},{value:"ASSESSED_FOR",label:"Assessed For",description:"MOM assessment relationship"},{value:"PERFORMED",label:"Performed",description:"Executed or carried out action"},{value:"TARGETED",label:"Targeted",description:"Directed action toward"},{value:"USED",label:"Used",description:"Utilized or employed"},{value:"CUSTOM",label:"Custom",description:"Custom relationship (describe below)"}],r=[{value:"CONFIRMED",label:"Confirmed",color:"bg-green-100 text-green-800"},{value:"PROBABLE",label:"Probable",color:"bg-blue-100 text-blue-800"},{value:"POSSIBLE",label:"Possible",color:"bg-yellow-100 text-yellow-800"},{value:"SUSPECTED",label:"Suspected",color:"bg-orange-100 text-orange-800"}],S=async(a,n)=>{if(!a||a.length<2)return[];H(!0);try{const L=E(n),Z=await fetch(`${L}?search=${encodeURIComponent(a)}&workspace_id=${y}&limit=10`);if(Z.ok){const le=await Z.json(),ce=q(n);return(le[ce]||[]).map(K=>({id:K.id,type:n,name:K.name||K.title}))}}catch(L){console.error("Entity search failed:",L)}finally{H(!1)}return[]},E=a=>({ACTOR:"/api/actors",SOURCE:"/api/sources",EVENT:"/api/events",PLACE:"/api/places",BEHAVIOR:"/api/behaviors",EVIDENCE:"/api/evidence-items"})[a],q=a=>({ACTOR:"actors",SOURCE:"sources",EVENT:"events",PLACE:"places",BEHAVIOR:"behaviors",EVIDENCE:"evidence"})[a],k=async()=>{if(!s.source_entity_id||!s.target_entity_id){j("Please select both source and target entities first");return}z(!0),j(null);try{const a=await fetch("/api/relationships/infer-type",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_entity_id:s.source_entity_id,source_entity_type:s.source_entity_type,target_entity_id:s.target_entity_id,target_entity_type:s.target_entity_type,context:s.description||void 0,evidence_text:void 0})});if(a.ok){const n=await a.json();O({inferred_type:n.inferred_type,confidence:n.confidence,explanation:n.explanation})}else{const n=await a.json();j(n.error||"Failed to infer relationship type")}}catch(a){console.error("Inference error:",a),j("Failed to infer relationship type. Please try again.")}finally{z(!1)}},ie=()=>{c&&(h({...s,relationship_type:c.inferred_type}),O(null))};d.useEffect(()=>{const a=async()=>{const n=await S(m.source,s.source_entity_type),L=await S(m.target,s.target_entity_type);C([...n,...L])};(m.source||m.target)&&a()},[m]);const ne=async a=>{a.preventDefault(),j(null),f(!0);try{if(u){const n={relationship_type:s.relationship_type,description:s.description,weight:s.weight,confidence:s.confidence,start_date:s.start_date||void 0,end_date:s.end_date||void 0};await o(n)}else{const n={source_entity_id:s.source_entity_id,source_entity_type:s.source_entity_type,target_entity_id:s.target_entity_id,target_entity_type:s.target_entity_type,relationship_type:s.relationship_type,description:s.description,weight:s.weight,confidence:s.confidence,start_date:s.start_date||void 0,end_date:s.end_date||void 0,workspace_id:y};await o(n)}}catch(n){j(n instanceof Error?n.message:"Failed to save relationship")}finally{f(!1)}},Q=G.find(a=>a.value===s.relationship_type);return e.jsx("form",{onSubmit:ne,children:e.jsxs(M,{children:[e.jsxs(Y,{children:[e.jsx(J,{children:u?"Edit Relationship":"Create Relationship"}),e.jsx(ae,{children:"Define a relationship between two entities"})]}),e.jsxs(U,{className:"space-y-6",children:[v&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded",children:v}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Source Entity *"}),e.jsxs(T,{value:s.source_entity_type,onValueChange:a=>h({...s,source_entity_type:a}),disabled:u||!!N,children:[e.jsx(A,{children:e.jsx(D,{})}),e.jsx(I,{children:W.map(a=>e.jsx(x,{value:a,children:a},a))})]}),e.jsx(B,{placeholder:"Search source entity...",value:m.source,onChange:a=>P({...m,source:a.target.value}),disabled:u||!!g}),s.source_entity_id&&e.jsxs(p,{variant:"secondary",children:["ID: ",s.source_entity_id.substring(0,8),"..."]})]}),e.jsx("div",{className:"text-center",children:e.jsx($,{className:"h-6 w-6 mx-auto text-gray-400"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Target Entity *"}),e.jsxs(T,{value:s.target_entity_type,onValueChange:a=>h({...s,target_entity_type:a}),disabled:u,children:[e.jsx(A,{children:e.jsx(D,{})}),e.jsx(I,{children:W.map(a=>e.jsx(x,{value:a,children:a},a))})]}),e.jsx(B,{placeholder:"Search target entity...",value:m.target,onChange:a=>P({...m,target:a.target.value}),disabled:u}),s.target_entity_id&&e.jsxs(p,{variant:"secondary",children:["ID: ",s.target_entity_id.substring(0,8),"..."]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"relationship_type",children:"Relationship Type *"}),e.jsxs(T,{value:s.relationship_type,onValueChange:a=>h({...s,relationship_type:a}),children:[e.jsx(A,{children:e.jsx(D,{})}),e.jsx(I,{children:G.map(a=>e.jsx(x,{value:a.value,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:a.label}),e.jsx("div",{className:"text-xs text-gray-500",children:a.description})]})},a.value))})]}),Q&&e.jsx("p",{className:"text-xs text-gray-500",children:Q.description})]}),!u&&e.jsxs("div",{className:"space-y-3 p-4 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg border border-purple-200 dark:border-purple-800",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"}),e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:"AI-Powered Type Suggestion"})]}),e.jsx(b,{type:"button",variant:"outline",size:"sm",onClick:k,disabled:R||!s.source_entity_id||!s.target_entity_id,children:R?"Analyzing...":"Suggest Type"})]}),c&&e.jsx("div",{className:"mt-3 p-3 bg-white dark:bg-gray-800 rounded border border-purple-300 dark:border-purple-700 space-y-2",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(p,{variant:"default",className:"bg-purple-600",children:c.inferred_type.replace(/_/g," ")}),e.jsxs(p,{variant:"outline",className:c.confidence==="HIGH"?"border-green-500 text-green-700":c.confidence==="MEDIUM"?"border-yellow-500 text-yellow-700":"border-gray-500 text-gray-700",children:[c.confidence," Confidence"]})]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mt-2",children:c.explanation})]}),e.jsxs(b,{type:"button",size:"sm",variant:"default",onClick:ie,className:"ml-3 bg-purple-600 hover:bg-purple-700",children:[e.jsx(re,{className:"h-4 w-4 mr-1"}),"Use This"]})]})}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"GPT will analyze the selected entities and suggest the most appropriate relationship type based on their context."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"description",children:"Description"}),e.jsx(oe,{id:"description",value:s.description,onChange:a=>h({...s,description:a.target.value}),placeholder:"Describe this relationship in detail...",rows:3})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(w,{children:"Relationship Strength"}),e.jsxs("span",{className:"text-sm font-semibold",children:[(s.weight*100).toFixed(0),"%"]})]}),e.jsx(xe,{value:[s.weight*100],onValueChange:([a])=>h({...s,weight:a/100}),min:0,max:100,step:5,className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500",children:"How strong or significant is this relationship? (0% = weak, 100% = very strong)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{children:"Confidence Level"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:r.map(a=>e.jsx("button",{type:"button",onClick:()=>h({...s,confidence:a.value}),className:`p-2 rounded text-sm font-medium transition-all ${s.confidence===a.value?a.color+" border-2 border-gray-900":"bg-gray-100 text-gray-700 border-2 border-transparent"}`,children:a.label},a.value))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"start_date",children:"Start Date (Optional)"}),e.jsx(B,{type:"date",id:"start_date",value:s.start_date,onChange:a=>h({...s,start_date:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"end_date",children:"End Date (Optional)"}),e.jsx(B,{type:"date",id:"end_date",value:s.end_date,onChange:a=>h({...s,end_date:a.target.value})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsxs(b,{type:"button",variant:"outline",onClick:_,disabled:i,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs(b,{type:"submit",disabled:i||!s.source_entity_id||!s.target_entity_id,children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),i?"Saving...":u?"Update Relationship":"Create Relationship"]})]})]})]})})}function Se({relationship:t,sourceEntityName:g,targetEntityName:N,onEdit:y,onDelete:o,onNavigateToSource:_,onNavigateToTarget:u,compact:s=!1,showValidation:h=!0}){const i=l=>({ACTOR:"ðŸ‘¤",SOURCE:"ðŸ“š",EVIDENCE:"ðŸ“„",EVENT:"ðŸ“…",PLACE:"ðŸ“",BEHAVIOR:"ðŸŽ¯"})[l]||"â“",f=l=>({ACTOR:"bg-blue-100 text-blue-800",SOURCE:"bg-purple-100 text-purple-800",EVIDENCE:"bg-green-100 text-green-800",EVENT:"bg-orange-100 text-orange-800",PLACE:"bg-pink-100 text-pink-800",BEHAVIOR:"bg-yellow-100 text-yellow-800"})[l]||"bg-gray-100 text-gray-800",v=l=>({CONTROLS:"Controls",REPORTS_TO:"Reports To",ALLIED_WITH:"Allied With",ADVERSARY_OF:"Adversary Of",MEMBER_OF:"Member Of",LOCATED_AT:"Located At",PARTICIPATED_IN:"Participated In",PROVIDED_BY:"Provided By",EXHIBITS:"Exhibits",CORROBORATES:"Corroborates",CONTRADICTS:"Contradicts",DEPENDS_ON:"Depends On",ASSESSED_FOR:"Assessed For",PERFORMED:"Performed",TARGETED:"Targeted",USED:"Used",CUSTOM:"Custom"})[l]||l,j=l=>{if(!l)return null;const C={CONFIRMED:"bg-green-100 text-green-800",PROBABLE:"bg-blue-100 text-blue-800",POSSIBLE:"bg-yellow-100 text-yellow-800",SUSPECTED:"bg-orange-100 text-orange-800"};return e.jsx(p,{className:C[l]||"bg-gray-100 text-gray-800",children:l})},m=()=>h?{VALIDATED:e.jsxs(p,{className:"bg-green-100 text-green-800",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"Validated"]}),PENDING:e.jsxs(p,{className:"bg-yellow-100 text-yellow-800",children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),"Pending"]}),REJECTED:e.jsxs(p,{className:"bg-red-100 text-red-800",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Rejected"]})}[t.validation_status]:null,P=()=>{if(!t.auto_generated)return null;const l={MANUAL:"Manual",MOM_ASSESSMENT:"MOM",COG_ANALYSIS:"COG",CAUSEWAY_ANALYSIS:"Causeway",FRAMEWORK_INFERENCE:"Inferred"};return e.jsxs(p,{variant:"outline",className:"text-xs",children:["Auto: ",l[t.generation_source]]})};return s?e.jsx(M,{className:"hover:shadow-md transition-shadow",children:e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:i(t.source_entity_type)}),e.jsx("button",{onClick:_,className:"text-sm font-medium hover:underline",children:g||t.source_entity_id.substring(0,8)})]}),e.jsx($,{className:"h-4 w-4 text-gray-400"}),e.jsx(p,{variant:"secondary",className:"text-xs",children:v(t.relationship_type)}),e.jsx($,{className:"h-4 w-4 text-gray-400"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:i(t.target_entity_type)}),e.jsx("button",{onClick:u,className:"text-sm font-medium hover:underline",children:N||t.target_entity_id.substring(0,8)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j(t.confidence),y&&e.jsx(b,{variant:"ghost",size:"sm",onClick:y,children:e.jsx(ee,{className:"h-4 w-4"})}),o&&e.jsx(b,{variant:"ghost",size:"sm",onClick:o,children:e.jsx(se,{className:"h-4 w-4"})})]})]})})}):e.jsxs(M,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(Y,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-3 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-3xl",children:i(t.source_entity_type)}),e.jsxs("div",{children:[e.jsx(p,{className:f(t.source_entity_type),children:t.source_entity_type}),e.jsx("button",{onClick:_,className:"block text-lg font-semibold hover:underline mt-1",children:g||t.source_entity_id.substring(0,8)})]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx($,{className:"h-6 w-6 text-gray-400"}),e.jsx(p,{variant:"secondary",className:"mt-1",children:v(t.relationship_type)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-3xl",children:i(t.target_entity_type)}),e.jsxs("div",{children:[e.jsx(p,{className:f(t.target_entity_type),children:t.target_entity_type}),e.jsx("button",{onClick:u,className:"block text-lg font-semibold hover:underline mt-1",children:N||t.target_entity_id.substring(0,8)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[j(t.confidence),m(),P(),t.conflicts_with&&t.conflicts_with.length>0&&e.jsxs(p,{className:"bg-red-100 text-red-800",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Conflicts (",t.conflicts_with.length,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[y&&e.jsxs(b,{variant:"outline",size:"sm",onClick:y,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Edit"]}),o&&e.jsxs(b,{variant:"destructive",size:"sm",onClick:o,children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Relationship Strength"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[(t.weight*100).toFixed(0),"%"]})]}),e.jsx(Ce,{value:t.weight*100,className:"h-2"})]}),t.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-1",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.description})]}),(t.start_date||t.end_date)&&e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsx(pe,{className:"h-4 w-4"}),t.start_date&&e.jsxs("span",{children:["From: ",new Date(t.start_date).toLocaleDateString()]}),t.end_date&&e.jsxs("span",{children:["To: ",new Date(t.end_date).toLocaleDateString()]})]}),t.conflicts_with&&t.conflicts_with.length>0&&e.jsx("div",{className:"bg-red-50 border border-red-200 p-3 rounded",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(X,{className:"h-4 w-4 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-red-900",children:"Conflicts Detected"}),t.conflict_reason&&e.jsx("p",{className:"text-sm text-red-800 mt-1",children:t.conflict_reason}),e.jsxs("p",{className:"text-xs text-red-700 mt-1",children:[t.conflicts_with.length," conflicting relationship(s)"]})]})]})}),e.jsxs("div",{className:"pt-3 border-t text-xs text-gray-500 flex items-center justify-between",children:[e.jsxs("span",{children:["Created: ",new Date(t.created_at).toLocaleDateString()]}),t.validated_at&&e.jsxs("span",{children:["Validated: ",new Date(t.validated_at).toLocaleDateString()]})]})]})]})}function Le({relationships:t,entityNames:g={},onEdit:N,onDelete:y,onNavigateToEntity:o,onCreateNew:_,compact:u=!1,showFilters:s=!0,showValidation:h=!0}){const[i,f]=d.useState("date"),[v,j]=d.useState("desc"),[m,P]=d.useState("all"),[l,C]=d.useState("all"),[F,H]=d.useState("all"),[R,z]=d.useState("");let c=t;m!=="all"&&(c=c.filter(r=>r.relationship_type===m)),l!=="all"&&(c=c.filter(r=>r.confidence===l)),F!=="all"&&(c=c.filter(r=>r.validation_status===F)),R&&(c=c.filter(r=>{const S=g[r.source_entity_id]?.toLowerCase()||"",E=g[r.target_entity_id]?.toLowerCase()||"",q=r.description?.toLowerCase()||"",k=R.toLowerCase();return S.includes(k)||E.includes(k)||q.includes(k)||r.relationship_type.toLowerCase().includes(k)}));const O=[...c].sort((r,S)=>{let E=0;switch(i){case"date":E=new Date(r.created_at).getTime()-new Date(S.created_at).getTime();break;case"weight":E=r.weight-S.weight;break;case"type":E=r.relationship_type.localeCompare(S.relationship_type);break}return v==="asc"?E:-E}),W=()=>{j(r=>r==="asc"?"desc":"asc")},G=["CONTROLS","REPORTS_TO","ALLIED_WITH","ADVERSARY_OF","MEMBER_OF","LOCATED_AT","PARTICIPATED_IN","PROVIDED_BY","EXHIBITS","CORROBORATES","CONTRADICTS","DEPENDS_ON","ASSESSED_FOR","PERFORMED","TARGETED","USED","CUSTOM"];return e.jsxs("div",{className:"space-y-4",children:[s&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(B,{placeholder:"Search relationships...",value:R,onChange:r=>z(r.target.value),className:"pl-10"})]})}),e.jsxs(T,{value:i,onValueChange:r=>f(r),children:[e.jsx(A,{className:"w-[150px]",children:e.jsx(D,{placeholder:"Sort by"})}),e.jsxs(I,{children:[e.jsx(x,{value:"date",children:"Date"}),e.jsx(x,{value:"weight",children:"Strength"}),e.jsx(x,{value:"type",children:"Type"})]})]}),e.jsx(b,{variant:"outline",size:"sm",onClick:W,children:v==="asc"?e.jsx(je,{className:"h-4 w-4"}):e.jsx(_e,{className:"h-4 w-4"})}),_&&e.jsxs(b,{onClick:_,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Add Relationship"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(T,{value:m,onValueChange:r=>P(r),children:[e.jsx(A,{className:"w-[180px]",children:e.jsx(D,{placeholder:"Filter by type"})}),e.jsxs(I,{children:[e.jsx(x,{value:"all",children:"All Types"}),G.map(r=>e.jsx(x,{value:r,children:r},r))]})]}),e.jsxs(T,{value:l,onValueChange:r=>C(r),children:[e.jsx(A,{className:"w-[150px]",children:e.jsx(D,{placeholder:"Confidence"})}),e.jsxs(I,{children:[e.jsx(x,{value:"all",children:"All Confidence"}),e.jsx(x,{value:"CONFIRMED",children:"Confirmed"}),e.jsx(x,{value:"PROBABLE",children:"Probable"}),e.jsx(x,{value:"POSSIBLE",children:"Possible"}),e.jsx(x,{value:"SUSPECTED",children:"Suspected"})]})]}),h&&e.jsxs(T,{value:F,onValueChange:r=>H(r),children:[e.jsx(A,{className:"w-[150px]",children:e.jsx(D,{placeholder:"Validation"})}),e.jsxs(I,{children:[e.jsx(x,{value:"all",children:"All Status"}),e.jsx(x,{value:"VALIDATED",children:"Validated"}),e.jsx(x,{value:"PENDING",children:"Pending"}),e.jsx(x,{value:"REJECTED",children:"Rejected"})]})]})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[O.length," relationship",O.length!==1?"s":"",(m!=="all"||l!=="all"||F!=="all"||R)&&" (filtered)"]}),O.length===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"No relationships found"}),_&&e.jsxs(b,{onClick:_,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Create First Relationship"]})]}):e.jsx("div",{className:"space-y-3",children:O.map(r=>e.jsx(Se,{relationship:r,sourceEntityName:g[r.source_entity_id],targetEntityName:g[r.target_entity_id],onEdit:N?()=>N(r):void 0,onDelete:y?()=>y(r):void 0,onNavigateToSource:o?()=>o(r.source_entity_id,r.source_entity_type):void 0,onNavigateToTarget:o?()=>o(r.target_entity_id,r.target_entity_type):void 0,compact:u,showValidation:h},r.id))})]})}const we={ach:Ne,cog:be,swot:ve,pest:fe,dime:V,comb:V,other:V},Re={ach:"Analysis of Competing Hypotheses",cog:"Center of Gravity",swot:"SWOT Analysis",pest:"PEST Analysis",dime:"DIME Framework",comb:"COM-B Analysis",other:"Framework"};function Be({entityId:t,entityType:g,entityName:N}){const y=de(),[o,_]=d.useState([]),[u,s]=d.useState(!0);d.useEffect(()=>{h()},[t,g]);const h=async()=>{s(!0);try{const i=localStorage.getItem("omnicore_user_hash"),f=await fetch(`/api/frameworks/entity-usage?entity_id=${t}&entity_type=${g}`,{headers:{...i&&{Authorization:`Bearer ${i}`}}});if(!f.ok)throw new Error("Failed to load framework usage");const v=await f.json();_(v.frameworks||[])}catch(i){console.error("Error loading framework usage:",i),_([])}finally{s(!1)}};return u?e.jsxs(M,{children:[e.jsx(Y,{children:e.jsx(J,{children:"Framework Usage"})}),e.jsx(U,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading..."})})]}):o.length===0?null:e.jsxs(M,{children:[e.jsxs(Y,{children:[e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Used in ",o.length," Framework",o.length!==1?"s":""]}),e.jsxs(ae,{children:[N," is referenced in the following analyses"]})]}),e.jsx(U,{className:"space-y-3",children:o.map(i=>{const f=we[i.type]||V,v=Re[i.type]||"Framework";return e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"p-2 rounded-md bg-primary/10",children:e.jsx(f,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:i.title}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:v}),i.role&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx(p,{variant:"outline",className:"text-xs",children:i.role})]})]})]})]}),e.jsx(b,{size:"sm",variant:"ghost",onClick:()=>{if(i.url)y(i.url);else{const j={ach:`/dashboard/analysis-frameworks/ach-dashboard/${i.id}`,cog:`/dashboard/analysis-frameworks/cog/${i.id}`,swot:`/dashboard/analysis-frameworks/swot-dashboard/${i.id}`};y(j[i.type]||"/dashboard")}},children:e.jsx(Ee,{className:"h-4 w-4"})})]},i.id)})})]})}export{Be as F,Le as R,Fe as a};
