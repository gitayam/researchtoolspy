import{j as e}from"./ui-vendor-DBphXmDA.js";import{f as le,r as c}from"./react-vendor-CfYLSWvh.js";import{d as M,l as H,H as V,B as h,m as z,n as B,o as q,p as J,y as u,I as X,S as w,z as N,C,E as _,F as o,u as oe,e as T}from"./index-QqleixXe.js";import{C as f,d as k,a as L,b as R,c as O}from"./card-BGAig-Dv.js";import{A as ne,a as ie}from"./avatar-Cr9hJqyk.js";import{g as Y}from"./hash-auth-C-5ASbCe.js";import{W as G,U as $,Q as ce,Y as de,P as he,E as xe,q as pe,c as ue}from"./icons-x9tcvtYN.js";import"./state-vendor-BXB5jEEt.js";function me({onWorkspaceCreated:s}){le();const{toast:n}=M(),[m,g]=c.useState(!1),[r,x]=c.useState(!1),[l,j]=c.useState({name:"",type:"TEAM"}),I=()=>{let i=localStorage.getItem("omnicore_user_hash");return(!i||i==="guest")&&(i=Y(),localStorage.setItem("omnicore_user_hash",i),localStorage.setItem("omnicore_authenticated","true"),n({title:"Account Created",description:"Your bookmark account has been created. Save this URL to access your work!"})),i},W=async i=>{if(i.preventDefault(),!l.name.trim()){n({title:"Validation Error",description:"Workspace name is required",variant:"destructive"});return}x(!0);try{const p=I(),b=await fetch("/api/workspaces",{method:"POST",headers:{"Content-Type":"application/json","X-User-Hash":p},body:JSON.stringify({name:l.name,type:l.type})});if(!b.ok){const d=await b.json();throw new Error(d.error||"Failed to create workspace")}const S=await b.json();n({title:"Workspace Created",description:`${l.name} has been created successfully`}),g(!1),j({name:"",type:"TEAM"}),localStorage.setItem("omnicore_workspace_id",S.id),s?s():window.location.reload()}catch(p){n({title:"Error",description:p instanceof Error?p.message:"Failed to create workspace",variant:"destructive"})}finally{x(!1)}};return e.jsxs(H,{open:m,onOpenChange:g,children:[e.jsx(V,{asChild:!0,children:e.jsxs(h,{size:"lg",children:[e.jsx(G,{className:"h-5 w-5 mr-2"}),"Create Workspace"]})}),e.jsxs(z,{children:[e.jsxs(B,{children:[e.jsx(q,{children:"Create New Workspace"}),e.jsx(J,{children:"Set up a workspace to collaborate with your investigation team"})]}),e.jsxs("form",{onSubmit:W,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"workspace-name",children:"Workspace Name *"}),e.jsx(X,{id:"workspace-name",placeholder:"e.g., Enemy COG Investigation, Threat Analysis Team",value:l.name,onChange:i=>j({...l,name:i.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"workspace-type",children:"Workspace Type"}),e.jsxs(w,{value:l.type,onValueChange:i=>j({...l,type:i}),children:[e.jsx(N,{id:"workspace-type",children:e.jsx(C,{})}),e.jsxs(_,{children:[e.jsx(o,{value:"PERSONAL",children:"Personal (Private)"}),e.jsx(o,{value:"TEAM",children:"Team (Invite-only)"}),e.jsx(o,{value:"PUBLIC",children:"Public (Anyone can view)"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[l.type==="PERSONAL"&&"Only you can access this workspace",l.type==="TEAM"&&"Invite team members to collaborate",l.type==="PUBLIC"&&"Anyone with the link can view (read-only)"]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:[e.jsx("strong",{children:"Note:"})," If you're using guest mode, creating a workspace will generate a bookmark account hash for you. Make sure to save your browser URL to access your workspace again!"]})}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>g(!1),className:"flex-1",children:"Cancel"}),e.jsx(h,{type:"submit",disabled:r,className:"flex-1",children:r?"Creating...":"Create Workspace"})]})]})]})]})}function Ne(){const{t:s}=oe(),{toast:n}=M(),[m,g]=c.useState([]),[r,x]=c.useState(null),[l,j]=c.useState([]),[I,W]=c.useState([]),[i,p]=c.useState(!0),[b,S]=c.useState(!1),[d,v]=c.useState({default_role:"VIEWER",max_uses:null,expires_in_hours:null,label:null});c.useEffect(()=>{Q(),F()},[]);const Q=()=>{let a=localStorage.getItem("omnicore_user_hash");return(!a||a==="guest")&&(a=Y(),localStorage.setItem("omnicore_user_hash",a),localStorage.setItem("omnicore_authenticated","true"),n({title:s("pages.collaboration.accountCreated"),description:s("pages.collaboration.accountCreatedDesc")})),a};c.useEffect(()=>{r&&(K(),A())},[r]);const F=async()=>{try{const a=localStorage.getItem("omnicore_user_hash"),t={};if(a&&a!=="guest")t["X-User-Hash"]=a;else{const y=localStorage.getItem("auth_token");y&&(t.Authorization=`Bearer ${y}`)}const E=await fetch("/api/workspaces",{headers:t});if(E.ok){const y=await E.json(),D=[...y.owned||[],...y.member||[]];g(D);const P=D.find(re=>re.type==="TEAM");P?x(P):D.length>0&&x(D[0])}}catch(a){console.error("Failed to fetch workspaces:",a)}finally{p(!1)}},K=async()=>{if(r)try{const a=await fetch(`/api/workspaces/${r.id}/members`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")||""}`}});if(a.ok){const t=await a.json();j(t)}}catch(a){console.error("Failed to fetch members:",a)}},A=async()=>{if(r)try{const a=await fetch(`/api/workspaces/${r.id}/invites`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")||""}`}});if(a.ok){const t=await a.json();W(t.invites||[])}}catch(a){console.error("Failed to fetch invites:",a)}},Z=async a=>{if(a.preventDefault(),!!r)try{const t=await fetch(`/api/workspaces/${r.id}/invites`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")||""}`},body:JSON.stringify(d)});if(!t.ok)throw new Error("Failed to create invite");const E=await t.json();n({title:s("pages.collaboration.inviteCreated"),description:s("pages.collaboration.inviteCreatedDesc")}),await navigator.clipboard.writeText(E.invite_url),n({title:s("pages.collaboration.linkCopied"),description:s("pages.collaboration.linkCopiedDesc")}),S(!1),v({default_role:"VIEWER",max_uses:null,expires_in_hours:null,label:null}),A()}catch(t){n({title:s("pages.collaboration.error"),description:t instanceof Error?t.message:s("pages.collaboration.failedToCreateInvite"),variant:"destructive"})}},ee=async a=>{try{await navigator.clipboard.writeText(a),n({title:s("pages.collaboration.linkCopied"),description:s("pages.collaboration.linkCopiedDesc")})}catch{n({title:s("pages.collaboration.error"),description:s("pages.collaboration.failedToCopyLink"),variant:"destructive"})}},ae=async a=>{if(r)try{if(!(await fetch(`/api/workspaces/${r.id}/invites/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")||""}`}})).ok)throw new Error("Failed to revoke invite");n({title:s("pages.collaboration.inviteRevoked"),description:s("pages.collaboration.inviteRevokedDesc")}),A()}catch(t){n({title:s("pages.collaboration.error"),description:t instanceof Error?t.message:s("pages.collaboration.failedToRevokeInvite"),variant:"destructive"})}},U=a=>{switch(a){case"ADMIN":return"bg-purple-100 text-purple-800";case"EDITOR":return"bg-blue-100 text-blue-800";case"VIEWER":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},se=a=>{const t=a.split(" ");return t.length>=2?`${t[0][0]}${t[1][0]}`.toUpperCase():a.substring(0,2).toUpperCase()},te=a=>a?`Expires ${new Date(a).toLocaleDateString()}`:"Never expires";return i?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s("pages.collaboration.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s("pages.collaboration.loading")})]})})}):m.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s("pages.collaboration.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s("pages.collaboration.createWorkspace")})]})}),e.jsx(f,{children:e.jsxs(k,{className:"text-center py-12",children:[e.jsx($,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:s("pages.collaboration.noWorkspaces")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:s("pages.collaboration.noWorkspacesDesc")}),e.jsx(me,{onWorkspaceCreated:F})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s("pages.collaboration.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s("pages.collaboration.subtitle")})]})}),e.jsxs(f,{children:[e.jsxs(L,{children:[e.jsx(R,{children:s("pages.collaboration.selectWorkspace")}),e.jsx(O,{children:s("pages.collaboration.selectWorkspaceDesc")})]}),e.jsx(k,{children:e.jsxs(w,{value:r?.id||"",onValueChange:a=>x(m.find(t=>t.id===a)||null),children:[e.jsx(N,{className:"w-full",children:e.jsx(C,{placeholder:s("pages.collaboration.selectPlaceholder")})}),e.jsx(_,{children:m.map(a=>e.jsx(o,{value:a.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:a.name}),e.jsx(T,{variant:"outline",className:"text-xs",children:a.type})]})},a.id))})]})})]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(R,{children:s("pages.collaboration.inviteLinks")}),e.jsx(O,{children:s("pages.collaboration.inviteLinksDesc")})]}),e.jsxs(H,{open:b,onOpenChange:S,children:[e.jsx(V,{asChild:!0,children:e.jsxs(h,{children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),s("pages.collaboration.newInvite")]})}),e.jsxs(z,{children:[e.jsxs(B,{children:[e.jsx(q,{children:s("pages.collaboration.createInviteLink")}),e.jsx(J,{children:s("pages.collaboration.createInviteLinkDesc")})]}),e.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:s("pages.collaboration.role")}),e.jsxs(w,{value:d.default_role,onValueChange:a=>v({...d,default_role:a}),children:[e.jsx(N,{children:e.jsx(C,{})}),e.jsxs(_,{children:[e.jsx(o,{value:"VIEWER",children:s("pages.collaboration.viewer")}),e.jsx(o,{value:"EDITOR",children:s("pages.collaboration.editor")}),e.jsx(o,{value:"ADMIN",children:s("pages.collaboration.admin")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:s("pages.collaboration.labelOptional")}),e.jsx(X,{placeholder:s("pages.collaboration.labelPlaceholder"),value:d.label||"",onChange:a=>v({...d,label:a.target.value||null})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:s("pages.collaboration.expiresIn")}),e.jsxs(w,{value:d.expires_in_hours?.toString()||"never",onValueChange:a=>v({...d,expires_in_hours:a==="never"?null:parseInt(a)}),children:[e.jsx(N,{children:e.jsx(C,{})}),e.jsxs(_,{children:[e.jsx(o,{value:"never",children:s("pages.collaboration.neverExpires")}),e.jsx(o,{value:"24",children:s("pages.collaboration.hours24")}),e.jsx(o,{value:"168",children:s("pages.collaboration.days7")}),e.jsx(o,{value:"720",children:s("pages.collaboration.days30")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:s("pages.collaboration.maxUses")}),e.jsxs(w,{value:d.max_uses?.toString()||"unlimited",onValueChange:a=>v({...d,max_uses:a==="unlimited"?null:parseInt(a)}),children:[e.jsx(N,{children:e.jsx(C,{})}),e.jsxs(_,{children:[e.jsx(o,{value:"unlimited",children:s("pages.collaboration.unlimited")}),e.jsx(o,{value:"1",children:s("pages.collaboration.use1")}),e.jsx(o,{value:"5",children:s("pages.collaboration.uses5")}),e.jsx(o,{value:"10",children:s("pages.collaboration.uses10")})]})]})]}),e.jsx(h,{type:"submit",className:"w-full",children:s("pages.collaboration.createCopyLink")})]})]})]})]})}),e.jsx(k,{children:I.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ce,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s("pages.collaboration.noInvites")})]}):e.jsx("div",{className:"space-y-3",children:I.map(a=>e.jsx("div",{className:"p-4 rounded-lg border bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-750",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.label&&e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:a.label}),e.jsx(T,{className:U(a.default_role),children:a.default_role}),!a.is_active&&e.jsx(T,{variant:"destructive",children:"Revoked"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 font-mono truncate",children:a.invite_token}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),te(a.expires_at)]}),e.jsxs("span",{children:[a.current_uses,"/",a.max_uses||"âˆž"," uses"]}),a.created_by&&e.jsxs("span",{children:["Created by ",a.created_by.nickname]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>ee(a.invite_url),disabled:!a.is_active,children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>window.open(a.invite_url,"_blank"),disabled:!a.is_active,children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>ae(a.id),disabled:!a.is_active,children:e.jsx(pe,{className:"h-4 w-4 text-red-600"})})]})]})},a.id))})})]}),e.jsxs(f,{children:[e.jsxs(L,{children:[e.jsxs(R,{children:[s("pages.collaboration.teamMembers")," (",l.length,")"]}),e.jsx(O,{children:s("pages.collaboration.teamMembersDesc")})]}),e.jsx(k,{children:l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx($,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s("pages.collaboration.noMembers")})]}):e.jsx("div",{className:"space-y-3",children:l.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{children:e.jsx(ie,{children:se(a.nickname||a.username||"U")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a.nickname||a.username||"Unknown"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Joined ",new Date(a.joined_at).toLocaleDateString(),a.joined_via_invite_id&&" via invite"]})]})]}),e.jsx(T,{className:U(a.role),children:a.role})]},a.id))})})]}),e.jsx(f,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ue,{className:"h-6 w-6 text-blue-600 dark:text-blue-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-1",children:s("pages.collaboration.secureCollaboration")}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:s("pages.collaboration.securityInfo")})]})]})})})]})]})}export{Ne as CollaborationPage};
