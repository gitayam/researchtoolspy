import{j as e}from"./ui-vendor-DBphXmDA.js";import{k as I,r as o}from"./react-vendor-CfYLSWvh.js";import{C as p,a as g,b as f,c as w,d as N}from"./card-BQo7RV_Z.js";import{B as C,e as S,y as l,I as c,S as P,z as L,C as _,E as A,F as O,q as k}from"./index-DGGXJgUa.js";import{C as U,aj as B,d as V,n as Y}from"./icons-x9tcvtYN.js";import"./state-vendor-BXB5jEEt.js";const H=[{value:"article",label:"Article / Blog Post"},{value:"video",label:"Video"},{value:"social_post",label:"Social Media Post"},{value:"document",label:"Document / PDF"},{value:"image",label:"Image / Screenshot"},{value:"podcast",label:"Podcast / Audio"},{value:"dataset",label:"Dataset / Spreadsheet"},{value:"other",label:"Other"}];function G(){const{hashId:d}=I(),[t,q]=o.useState(null),[F,b]=o.useState(!0),[u,h]=o.useState(null),[j,v]=o.useState(!1),[T,y]=o.useState(!1),[r,i]=o.useState({sourceUrl:"",archivedUrl:"",contentType:"",contentDescription:"",loginRequired:!1,keywords:"",submitterComments:"",submitterContact:"",submitterName:"",password:""});o.useEffect(()=>{d&&D(d)},[d]);const D=async s=>{b(!0),h(null);try{const a=await fetch(`/api/research/submit/${s}`),m=await a.json();if(!a.ok)throw new Error(m.error||"Failed to load form");q(m.form)}catch(a){console.error("Failed to load form:",a),h(a instanceof Error?a.message:"Failed to load form")}finally{b(!1)}},E=async s=>{s.preventDefault(),v(!0),h(null);try{if(!d)throw new Error("Invalid form ID");if(t?.requireUrl&&!r.sourceUrl)throw new Error("Source URL is required");if(t?.requireContentType&&!r.contentType)throw new Error("Content type is required");const a=r.keywords.split(",").map(x=>x.trim()).filter(x=>x.length>0),m=await fetch(`/api/research/submit/${d}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sourceUrl:r.sourceUrl||void 0,archivedUrl:r.archivedUrl||void 0,contentType:r.contentType||void 0,contentDescription:r.contentDescription||void 0,loginRequired:r.loginRequired,keywords:a.length>0?a:void 0,submitterComments:r.submitterComments||void 0,submitterContact:r.submitterContact||void 0,submitterName:r.submitterName||void 0,password:r.password||void 0})}),R=await m.json();if(!m.ok)throw new Error(R.error||"Failed to submit");y(!0),i({sourceUrl:"",archivedUrl:"",contentType:"",contentDescription:"",loginRequired:!1,keywords:"",submitterComments:"",submitterContact:"",submitterName:"",password:""})}catch(a){console.error("Failed to submit:",a),h(a instanceof Error?a.message:"Failed to submit")}finally{v(!1)}},n=s=>t?.enabledFields.includes(s);return F?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading form..."})]})}):u&&!t?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:e.jsx(p,{className:"w-full max-w-md",children:e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center text-red-500",children:[e.jsx(U,{className:"h-5 w-5 mr-2"}),"Error"]}),e.jsx(w,{children:u})]})})}):T?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:e.jsxs(p,{className:"w-full max-w-md",children:[e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center text-green-500",children:[e.jsx(B,{className:"h-5 w-5 mr-2"}),"Submission Received"]}),e.jsx(w,{children:"Thank you for your submission. It will be reviewed shortly."})]}),e.jsx(N,{children:e.jsx(C,{onClick:()=>y(!1),className:"w-full",children:"Submit Another"})})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-12 px-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx(V,{className:"h-12 w-12 text-purple-500"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:t?.formName}),t?.formDescription&&e.jsx("p",{className:"text-gray-600 dark:text-gray-400 max-w-xl mx-auto",children:t.formDescription}),e.jsxs("div",{className:"flex items-center justify-center mt-4 space-x-2",children:[e.jsx(S,{variant:"outline",children:"Secure Submission"}),t?.requirePassword&&e.jsxs(S,{variant:"outline",className:"flex items-center",children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),"Password Protected"]})]})]}),e.jsx(p,{children:e.jsx(N,{className:"pt-6",children:e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[n("source_url")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"sourceUrl",children:["Source URL ",t?.requireUrl&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{id:"sourceUrl",type:"url",placeholder:"https://example.com/article",value:r.sourceUrl,onChange:s=>i({...r,sourceUrl:s.target.value}),required:t?.requireUrl}),e.jsx("p",{className:"text-sm text-gray-500",children:"URL of the content you're submitting"})]}),n("archived_url")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"archivedUrl",children:"Archived URL (Optional)"}),e.jsx(c,{id:"archivedUrl",type:"url",placeholder:"https://web.archive.org/...",value:r.archivedUrl,onChange:s=>i({...r,archivedUrl:s.target.value})}),e.jsx("p",{className:"text-sm text-gray-500",children:"If you've already archived this content, provide the archive URL"})]}),n("content_type")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"contentType",children:["Content Type ",t?.requireContentType&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(P,{value:r.contentType,onValueChange:s=>i({...r,contentType:s}),required:t?.requireContentType,children:[e.jsx(L,{children:e.jsx(_,{placeholder:"Select content type"})}),e.jsx(A,{children:H.map(s=>e.jsx(O,{value:s.value,children:s.label},s.value))})]})]}),n("content_description")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"contentDescription",children:"Content Description"}),e.jsx(k,{id:"contentDescription",placeholder:"How does this content relate to the research? What makes it relevant?",value:r.contentDescription,onChange:s=>i({...r,contentDescription:s.target.value}),rows:4})]}),n("login_required")&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"loginRequired",checked:r.loginRequired,onChange:s=>i({...r,loginRequired:s.target.checked}),className:"rounded border-gray-300"}),e.jsx(l,{htmlFor:"loginRequired",className:"cursor-pointer",children:"Login required to view this content"})]}),n("keywords")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"keywords",children:"Keywords"}),e.jsx(c,{id:"keywords",placeholder:"keyword1, keyword2, keyword3",value:r.keywords,onChange:s=>i({...r,keywords:s.target.value})}),e.jsx("p",{className:"text-sm text-gray-500",children:"Separate keywords with commas"})]}),n("submitter_comments")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"submitterComments",children:"Additional Comments"}),e.jsx(k,{id:"submitterComments",placeholder:"Any additional context or notes...",value:r.submitterComments,onChange:s=>i({...r,submitterComments:s.target.value}),rows:3})]}),n("submitter_name")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"submitterName",children:"Your Name (Optional)"}),e.jsx(c,{id:"submitterName",placeholder:"Anonymous",value:r.submitterName,onChange:s=>i({...r,submitterName:s.target.value})})]}),n("submitter_contact")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"submitterContact",children:"Contact Info (Optional)"}),e.jsx(c,{id:"submitterContact",type:"email",placeholder:"email@example.com",value:r.submitterContact,onChange:s=>i({...r,submitterContact:s.target.value})})]}),t?.requirePassword&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"password",children:["Submission Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{id:"password",type:"password",placeholder:"Enter form password",value:r.password,onChange:s=>i({...r,password:s.target.value}),required:!0})]}),u&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"h-5 w-5 text-red-500 mr-2"}),e.jsx("span",{className:"text-red-700 dark:text-red-400",children:u})]})}),e.jsx(C,{type:"submit",className:"w-full",disabled:j,children:j?"Submitting...":"Submit Evidence"}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Your submission will be reviewed before being added to the research collection"})]})})})]})})}export{G as default};
