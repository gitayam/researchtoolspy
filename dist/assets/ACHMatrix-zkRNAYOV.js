import{j as e}from"./ui-vendor-DBphXmDA.js";import{r as u}from"./react-vendor-CfYLSWvh.js";import{B as v,t as k,e as H,l as I,m as R,n as $,o as O,S as V,z as q,C as Q,E as B,F as D,q as L}from"./index-QqleixXe.js";import{C as N,d as T,a as U,b as P}from"./card-BGAig-Dv.js";import{v as S,W as z,X as G}from"./icons-x9tcvtYN.js";const K=[{label:"Strongly Supports",value:13,color:"text-green-800 bg-green-100 dark:text-green-100 dark:bg-green-800",description:"Evidence strongly confirms hypothesis"},{label:"Moderately Supports",value:8,color:"text-green-700 bg-green-50 dark:text-green-200 dark:bg-green-700",description:"Evidence moderately confirms hypothesis"},{label:"Slightly Supports",value:5,color:"text-green-600 bg-green-50 dark:text-green-200 dark:bg-green-600",description:"Evidence slightly confirms hypothesis"},{label:"Weakly Supports",value:3,color:"text-green-500 bg-green-50 dark:text-green-200 dark:bg-green-500",description:"Evidence weakly confirms hypothesis"},{label:"Very Weakly Supports",value:1,color:"text-green-400 bg-green-50 dark:text-green-200 dark:bg-green-400",description:"Evidence very weakly confirms hypothesis"},{label:"Neutral",value:0,color:"text-gray-600 bg-gray-100 dark:text-gray-200 dark:bg-gray-600",description:"Evidence neither supports nor contradicts"},{label:"Very Weakly Contradicts",value:-1,color:"text-red-400 bg-red-50 dark:text-red-200 dark:bg-red-400",description:"Evidence very weakly contradicts hypothesis"},{label:"Weakly Contradicts",value:-3,color:"text-red-500 bg-red-50 dark:text-red-200 dark:bg-red-500",description:"Evidence weakly contradicts hypothesis"},{label:"Slightly Contradicts",value:-5,color:"text-red-600 bg-red-50 dark:text-red-200 dark:bg-red-600",description:"Evidence slightly contradicts hypothesis"},{label:"Moderately Contradicts",value:-8,color:"text-red-700 bg-red-50 dark:text-red-200 dark:bg-red-700",description:"Evidence moderately contradicts hypothesis"},{label:"Strongly Contradicts",value:-13,color:"text-red-800 bg-red-100 dark:text-red-100 dark:bg-red-800",description:"Evidence strongly contradicts hypothesis"}],X=[{label:"Strongly Supports",value:5,color:"text-green-800 bg-green-100 dark:text-green-100 dark:bg-green-800",description:"Evidence strongly confirms hypothesis"},{label:"Moderately Supports",value:4,color:"text-green-700 bg-green-50 dark:text-green-200 dark:bg-green-700",description:"Evidence moderately confirms hypothesis"},{label:"Slightly Supports",value:3,color:"text-green-600 bg-green-50 dark:text-green-200 dark:bg-green-600",description:"Evidence slightly confirms hypothesis"},{label:"Weakly Supports",value:2,color:"text-green-500 bg-green-50 dark:text-green-200 dark:bg-green-500",description:"Evidence weakly confirms hypothesis"},{label:"Very Weakly Supports",value:1,color:"text-green-400 bg-green-50 dark:text-green-200 dark:bg-green-400",description:"Evidence very weakly confirms hypothesis"},{label:"Neutral",value:0,color:"text-gray-600 bg-gray-100 dark:text-gray-200 dark:bg-gray-600",description:"Evidence neither supports nor contradicts"},{label:"Very Weakly Contradicts",value:-1,color:"text-red-400 bg-red-50 dark:text-red-200 dark:bg-red-400",description:"Evidence very weakly contradicts hypothesis"},{label:"Weakly Contradicts",value:-2,color:"text-red-500 bg-red-50 dark:text-red-200 dark:bg-red-500",description:"Evidence weakly contradicts hypothesis"},{label:"Slightly Contradicts",value:-3,color:"text-red-600 bg-red-50 dark:text-red-200 dark:bg-red-600",description:"Evidence slightly contradicts hypothesis"},{label:"Moderately Contradicts",value:-4,color:"text-red-700 bg-red-50 dark:text-red-200 dark:bg-red-700",description:"Evidence moderately contradicts hypothesis"},{label:"Strongly Contradicts",value:-5,color:"text-red-800 bg-red-100 dark:text-red-100 dark:bg-red-800",description:"Evidence strongly contradicts hypothesis"}];function Y(a){if(!a)return .5;if(/^\d+$/.test(a)){const o=parseInt(a);if(o>=1&&o<=6)return o/6}const g={A:1,B:.83,C:.67,D:.5,E:.33,F:.17},l=a.toUpperCase().trim();return g[l]??.5}function J(a){const g=typeof a.credibility_score=="number"?a.credibility_score:void 0,l=g?g/5:Y(a.source),o=.75,d=1,h=.75,n=l,y=l*.3+o*.25+d*.2+h*.15+n*.1,b=.5+y*1.5;let c;y>=.85?c="excellent":y>=.6?c="good":y>=.3?c="average":c="poor";const i=[`Credibility: ${(l*100).toFixed(0)}%`,`Reliability: ${(o*100).toFixed(0)}%`,`Source: ${(d*100).toFixed(0)}%`,`Confidence: ${(h*100).toFixed(0)}%`,n!==l?`EVE: ${(n*100).toFixed(0)}%`:null].filter(Boolean).join(", ");return{weight:b,credibilityScore:l,reliabilityScore:o,sourceScore:d,confidenceScore:h,eveScore:n,breakdown:i,tier:c}}function Z(a){return{excellent:"text-green-700 dark:text-green-400 bg-green-50 dark:bg-green-900/20",good:"text-blue-700 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20",average:"text-yellow-700 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20",poor:"text-red-700 dark:text-red-400 bg-red-50 dark:bg-red-900/20"}[a]}function ee(a){return{excellent:"⭐",good:"✓",average:"○",poor:"⚠"}[a]}function ie({analysis:a,onUpdateScore:g,onAddEvidence:l,onRemoveEvidence:o}){const[d,h]=u.useState(null),[n,y]=u.useState(0),[b,c]=u.useState(""),i=a.hypotheses||[],m=a.evidence||[],j=a.scores||[],w=a.scale_type==="logarithmic"?K:X,C=u.useMemo(()=>{const r=new Map;return m.forEach(t=>{r.set(t.evidence_id,J(t))}),r},[m]),E=(r,t)=>j.find(s=>s.hypothesis_id===r&&s.evidence_id===t),_=r=>w.find(t=>t.value===r),M=(r,t)=>{const s=E(r,t);h({hypothesisId:r,evidenceId:t}),y(s?.score??0),c(s?.notes??"")},F=async()=>{d&&(await g(d.hypothesisId,d.evidenceId,n,b),h(null),y(0),c(""))},W=r=>j.filter(t=>t.hypothesis_id===r).reduce((t,s)=>t+s.score,0),A=r=>j.filter(t=>t.hypothesis_id===r).reduce((t,s)=>{const p=C.get(s.evidence_id)?.weight??1;return t+s.score*p},0);return i.length===0?e.jsxs(N,{className:"p-12 text-center",children:[e.jsx(S,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"No Hypotheses Yet"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500",children:"Add hypotheses to your analysis to begin scoring."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(N,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(S,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-900 dark:text-blue-100",children:[e.jsx("p",{className:"font-medium mb-1",children:"How to use the ACH Matrix:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Click any cell to score how evidence supports or contradicts a hypothesis"}),e.jsx("li",{children:"Positive scores = evidence supports hypothesis"}),e.jsx("li",{children:"Negative scores = evidence contradicts hypothesis"}),e.jsx("li",{children:"The hypothesis with the LEAST contradictory evidence is most likely correct"})]})]})]})})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Evidence vs. Hypotheses Matrix"}),e.jsxs(v,{onClick:l,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Add Evidence"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-300 dark:border-gray-700",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 dark:bg-gray-800",children:[e.jsx("th",{className:"border border-gray-300 dark:border-gray-700 p-3 min-w-[200px] text-left",children:"Evidence"}),i.map((r,t)=>e.jsxs("th",{className:"border border-gray-300 dark:border-gray-700 p-3 min-w-[150px] text-center",children:[e.jsxs("div",{className:"font-semibold mb-1",children:["H",t+1]}),e.jsx("div",{className:"text-xs font-normal text-gray-600 dark:text-gray-400",children:r.text})]},r.id))]})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:i.length+1,className:"border border-gray-300 dark:border-gray-700 p-8 text-center text-gray-500 dark:text-gray-400",children:'No evidence linked yet. Click "Add Evidence" to start scoring.'})}):m.map(r=>{const t=C.get(r.evidence_id);return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"border border-gray-300 dark:border-gray-700 p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-medium text-sm",children:r.evidence_title}),t&&e.jsxs("span",{className:k("inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",Z(t.tier)),title:`Quality: ${t.tier.toUpperCase()}
Weight: ${t.weight.toFixed(2)}x
${t.breakdown}`,children:[ee(t.tier),e.jsxs("span",{children:[t.weight.toFixed(2),"x"]})]})]}),r.source&&e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:r.source}),t&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:t.breakdown})]}),e.jsx(v,{variant:"ghost",size:"icon",className:"h-6 w-6 text-red-600 hover:text-red-700",onClick:()=>o(r.link_id),children:e.jsx(G,{className:"h-4 w-4"})})]})}),i.map(s=>{const x=E(s.id,r.evidence_id),p=x?_(x.score):null,f=t&&x?x.score*t.weight:x?.score;return e.jsx("td",{className:"border border-gray-300 dark:border-gray-700 p-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>M(s.id,r.evidence_id),children:p?e.jsxs("div",{className:k("p-2 rounded text-center",p.color),children:[e.jsx("div",{className:"font-bold",children:p.value}),e.jsx("div",{className:"text-xs",children:p.label}),t&&t.weight!==1&&f!==void 0&&f!==null&&e.jsxs("div",{className:"text-xs mt-1 font-semibold",children:["Weighted: ",f.toFixed(1)]})]}):e.jsx("div",{className:"text-center text-gray-400 p-2",children:"Click to score"})},s.id)})]},r.link_id)})}),m.length>0&&e.jsxs("tfoot",{children:[e.jsxs("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("td",{className:"border border-gray-300 dark:border-gray-700 p-3 font-medium",children:"Raw Total"}),i.map(r=>{const t=W(r.id);return e.jsx("td",{className:k("border border-gray-300 dark:border-gray-700 p-3 text-center",t>0&&"text-green-600 dark:text-green-400",t<0&&"text-red-600 dark:text-red-400"),children:t},r.id)})]}),e.jsxs("tr",{className:"bg-gray-100 dark:bg-gray-800 font-bold",children:[e.jsx("td",{className:"border border-gray-300 dark:border-gray-700 p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Weighted Total"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-normal",title:"Weighted by evidence quality (credibility, source classification, confidence)",children:e.jsx(S,{className:"h-4 w-4"})})]})}),i.map(r=>{const t=A(r.id);return e.jsx("td",{className:k("border border-gray-300 dark:border-gray-700 p-3 text-center",t>0&&"text-green-600 dark:text-green-400",t<0&&"text-red-600 dark:text-red-400"),children:t.toFixed(1)},r.id)})]})]})]})}),m.length>0&&e.jsxs(N,{children:[e.jsx(U,{children:e.jsx(P,{children:"Analysis Summary"})}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Key Principle:"})," The hypothesis with the LEAST contradictory evidence (highest score) is most likely correct."]}),e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"Quality-Weighted Ranking:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map((r,t)=>({hypothesis:r,index:t,total:A(r.id)})).sort((r,t)=>t.total-r.total).map(({hypothesis:r,index:t,total:s},x)=>e.jsxs(H,{variant:x===0?"default":"secondary",className:"text-sm",children:["H",t+1,": ",s.toFixed(1)," ",x===0&&"⭐ Most Likely"]},r.id))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"Raw Scores (unweighted):"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map((r,t)=>({hypothesis:r,index:t,total:W(r.id)})).sort((r,t)=>t.total-r.total).map(({hypothesis:r,index:t,total:s})=>e.jsxs(H,{variant:"outline",className:"text-sm",children:["H",t+1,": ",s]},r.id))})]})]})]})})]}),e.jsx(I,{open:!!d,onOpenChange:()=>h(null),children:e.jsxs(R,{children:[e.jsx($,{children:e.jsx(O,{children:"Score Evidence Against Hypothesis"})}),e.jsxs("div",{className:"space-y-4",children:[d&&e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-600 dark:text-gray-400",children:"Hypothesis:"}),e.jsx("div",{className:"mt-1 font-medium",children:i.find(r=>r.id===d.hypothesisId)?.text||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-600 dark:text-gray-400",children:"Evidence:"}),e.jsx("div",{className:"mt-1",children:m.find(r=>r.evidence_id===d.evidenceId)?.evidence_title||"Unknown"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"How does this evidence relate to the hypothesis?"}),e.jsxs(V,{value:n.toString(),onValueChange:r=>y(parseInt(r)),children:[e.jsx(q,{children:e.jsx(Q,{placeholder:"Select a score"})}),e.jsx(B,{children:w.map(r=>e.jsx(D,{value:r.value.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold",children:r.value}),e.jsx("span",{children:"-"}),e.jsx("span",{children:r.label})]})},r.value))})]}),n!==0&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:_(n)?.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Notes (optional)"}),e.jsx(L,{value:b,onChange:r=>c(r.target.value),placeholder:"Add reasoning for this score...",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{variant:"outline",onClick:()=>h(null),children:"Cancel"}),e.jsx(v,{onClick:F,children:"Save Score"})]})]})]})})]})}export{ie as A};
