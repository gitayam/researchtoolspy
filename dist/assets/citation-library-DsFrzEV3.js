function u(t,e,n=!1){if(!t||t.length===0)return"Anonymous";switch(e){case"apa":return j(t,n);case"mla":return D(t,n);case"chicago":return L(t,n);case"harvard":return I(t,n);default:return j(t,n)}}function j(t,e=!1){if(e)return t.length===1?t[0].lastName:t.length===2?`${t[0].lastName} & ${t[1].lastName}`:`${t[0].lastName} et al.`;const n=t.map((a,i)=>{const s=a.firstName.charAt(0).toUpperCase(),c=a.middleName?` ${a.middleName.charAt(0).toUpperCase()}.`:"";return`${a.lastName}, ${s}.${c}`});if(n.length===1)return n[0];if(n.length===2)return`${n[0]}, & ${n[1]}`;const o=n[n.length-1];return`${n.slice(0,-1).join(", ")}, & ${o}`}function D(t,e=!1){if(e)return t.length===1?t[0].lastName:t.length===2?`${t[0].lastName} and ${t[1].lastName}`:`${t[0].lastName} et al.`;const n=t.map((a,i)=>{if(i===0){const s=a.middleName?` ${a.middleName}`:"";return`${a.lastName}, ${a.firstName}${s}`}else{const s=a.middleName?` ${a.middleName}`:"";return`${a.firstName}${s} ${a.lastName}`}});if(n.length===1)return n[0];if(n.length===2)return`${n[0]}, and ${n[1]}`;const o=n[n.length-1];return`${n.slice(0,-1).join(", ")}, and ${o}`}function L(t,e=!1){if(e)return t.length===1?t[0].lastName:t.length===2?`${t[0].lastName} and ${t[1].lastName}`:t.length===3?`${t[0].lastName}, ${t[1].lastName}, and ${t[2].lastName}`:`${t[0].lastName} et al.`;const n=t.map((a,i)=>{if(i===0){const s=a.middleName?` ${a.middleName}`:"";return`${a.lastName}, ${a.firstName}${s}`}else{const s=a.middleName?` ${a.middleName}`:"";return`${a.firstName}${s} ${a.lastName}`}});if(n.length===1)return n[0];if(n.length===2)return`${n[0]}, and ${n[1]}`;const o=n[n.length-1];return`${n.slice(0,-1).join(", ")}, and ${o}`}function I(t,e=!1){if(e)return t.length===1?t[0].lastName:t.length===2?`${t[0].lastName} and ${t[1].lastName}`:`${t[0].lastName} et al.`;const n=t.map(a=>{const i=a.firstName.charAt(0).toUpperCase(),s=a.middleName?a.middleName.charAt(0).toUpperCase()+".":"";return`${a.lastName}, ${i}.${s}`});if(n.length===1)return n[0];if(n.length===2)return`${n[0]} and ${n[1]}`;const o=n[n.length-1];return`${n.slice(0,-1).join(", ")} and ${o}`}function A(t,e,n,o){return t?o==="mla"&&e&&n?`${n} ${["Jan.","Feb.","Mar.","Apr.","May","June","July","Aug.","Sept.","Oct.","Nov.","Dec."][parseInt(e)-1]} ${t}`:e&&n?`${t}, ${e} ${n}`:t:""}function O(t,e,n){switch(n){case"apa":return v(t,e);case"mla":return U(t,e);case"chicago":return J(t,e);case"harvard":return M(t,e);default:return v(t,e)}}function v(t,e){const n=u(t.authors,"apa"),o=u(t.authors,"apa",!0),r=t.year||"n.d.",a=t.title;let i="";switch(e){case"website":const c=t.siteName||"",$=t.url||"",l=A(t.year,t.month,t.day);i=`${n} (${l||r}). ${a}. ${c}. ${$}`;break;case"book":const m=t.edition?` (${t.edition})`:"",p=t.publisher||"";i=`${n} (${r}). ${a}${m}. ${p}.`;break;case"journal":const d=t.journalTitle||"",b=t.volume||"",N=t.issue?`(${t.issue})`:"",f=t.pages||"",g=t.doi?` https://doi.org/${t.doi}`:"";i=`${n} (${r}). ${a}. ${d}, ${b}${N}, ${f}.${g}`;break;case"report":const h=t.institution||"",y=t.reportNumber?` (Report No. ${t.reportNumber})`:"";i=`${n} (${r}). ${a}${y}. ${h}.`;break;case"news":const w=t.publication||"",T=A(t.year,t.month,t.day),x=t.url||"";i=`${n} (${T||r}). ${a}. ${w}. ${x}`;break}const s=`(${o}, ${r})`;return{citation:i,inTextCitation:s}}function U(t,e){const n=u(t.authors,"mla"),o=u(t.authors,"mla",!0),r=`"${t.title}"`;let a="";switch(e){case"website":const s=t.siteName||"",c=A(t.year,t.month,t.day,"mla"),$=t.url||"";a=`${n}. ${r} ${s}, ${c}, ${$}.`;break;case"book":const l=t.publisher||"",m=t.year||"";a=`${n}. ${t.title}. ${l}, ${m}.`;break;case"journal":const p=t.journalTitle||"",d=t.volume?`, vol. ${t.volume}`:"",b=t.issue?`, no. ${t.issue}`:"",N=t.year||"",f=t.pages?`, pp. ${t.pages}`:"";a=`${n}. ${r} ${p}${d}${b}, ${N}${f}.`;break;case"report":const g=t.institution||"",h=t.year||"";a=`${n}. ${t.title}. ${g}, ${h}.`;break;case"news":const y=t.publication||"",w=A(t.year,t.month,t.day,"mla"),T=t.url||"";a=`${n}. ${r} ${y}, ${w}, ${T}.`;break}const i=`(${o})`;return{citation:a,inTextCitation:i}}function J(t,e){const n=u(t.authors,"chicago"),o=u(t.authors,"chicago",!0),r=t.year||"n.d.",a=t.title;let i="";switch(e){case"website":const c=t.siteName||"",$=t.url||"",l=t.accessDate?` Accessed ${t.accessDate}.`:"";i=`${n}. ${r}. "${a}" ${c}.${l} ${$}.`;break;case"book":const m=t.place||"",p=t.publisher||"";i=`${n}. ${r}. ${a}. ${m}: ${p}.`;break;case"journal":const d=t.journalTitle||"",b=t.volume||"",N=t.issue?` (${t.issue})`:"",f=t.pages||"";i=`${n}. ${r}. "${a}" ${d} ${b}${N}: ${f}.`;break;case"report":const g=t.institution||"";i=`${n}. ${r}. ${a}. ${g}.`;break;case"news":const h=t.publication||"",y=A(t.year,t.month,t.day);i=`${n}. ${y||r}. "${a}" ${h}.`;break}const s=`(${o} ${r})`;return{citation:i,inTextCitation:s}}function M(t,e){const n=u(t.authors,"harvard"),o=u(t.authors,"harvard",!0),r=t.year||"n.d.",a=`'${t.title}'`;let i="";switch(e){case"website":const c=t.siteName||"",$=t.url||"",l=t.accessDate?` (Accessed: ${t.accessDate})`:"";i=`${n} (${r}) ${a}, ${c}. Available at: ${$}${l}.`;break;case"book":const m=t.edition?` ${t.edition}.`:"",p=t.place||"",d=t.publisher||"";i=`${n} (${r}) ${t.title}.${m} ${p}: ${d}.`;break;case"journal":const b=t.journalTitle||"",N=t.volume||"",f=t.issue?`(${t.issue})`:"",g=t.pages?`, pp. ${t.pages}`:"";i=`${n} (${r}) ${a}, ${b}, ${N}${f}${g}.`;break;case"report":const h=t.institution||"";i=`${n} (${r}) ${t.title}. ${h}.`;break;case"news":const y=t.publication||"",w=A(t.year,t.month,t.day);i=`${n} (${w||r}) ${a}, ${y}.`;break}const s=`(${o}, ${r})`;return{citation:i,inTextCitation:s}}const S="citations-library";function C(){try{const t=localStorage.getItem(S);if(t)return JSON.parse(t)}catch(t){console.error("Failed to load citation library:",t)}return{id:"default",name:"My Citations",citations:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}function k(t){try{t.updatedAt=new Date().toISOString(),localStorage.setItem(S,JSON.stringify(t))}catch(e){console.error("Failed to save citation library:",e)}}function R(t){const e=C();e.citations.push(t),k(e)}function E(t,e){const n=C(),o=n.citations.findIndex(r=>r.id===t);if(o!==-1){const a={...n.citations[o],...e};if(e.fields||e.citationStyle||e.sourceType){const{citation:i,inTextCitation:s}=O(a.fields,a.sourceType,a.citationStyle);a.citation=i,a.inTextCitation=s}n.citations[o]=a,k(n)}}function P(t){const e=C();e.citations=e.citations.filter(n=>n.id!==t),k(e)}function Y(t){const e=C();e.citations=e.citations.filter(n=>!t.includes(n.id)),k(e)}function B(){const t=C();t.citations=[],k(t)}function V(t,e,n="asc"){return[...t].sort((r,a)=>{let i,s;switch(e){case"date":i=new Date(r.addedAt).getTime(),s=new Date(a.addedAt).getTime();break;case"author":i=r.fields.authors[0]?.lastName.toLowerCase()||"",s=a.fields.authors[0]?.lastName.toLowerCase()||"";break;case"title":i=r.fields.title?.toLowerCase()||"",s=a.fields.title?.toLowerCase()||"";break;case"type":i=r.sourceType,s=a.sourceType;break;default:return 0}return i<s?n==="asc"?-1:1:i>s?n==="asc"?1:-1:0})}function F(t,e){if(!e.trim())return t;const n=e.toLowerCase();return t.filter(o=>!!(o.citation.toLowerCase().includes(n)||o.fields.title?.toLowerCase().includes(n)||o.fields.authors.some(a=>`${a.firstName} ${a.lastName}`.toLowerCase().includes(n))||o.notes?.toLowerCase().includes(n)||o.tags?.some(a=>a.toLowerCase().includes(n))))}function H(t,e){return t.map((n,o)=>`${o+1}. ${n.citation}`).join(`

`)}function K(t){return t.map(e=>{const n=e.sourceType==="journal"?"article":e.sourceType==="book"?"book":"misc",o=`${e.fields.authors[0]?.lastName||"unknown"}${e.fields.year||""}`;let r=`@${n}{${o},
`;return r+=`  author = {${e.fields.authors.map(a=>`${a.firstName} ${a.lastName}`).join(" and ")}},
`,r+=`  title = {${e.fields.title}},
`,e.fields.year&&(r+=`  year = {${e.fields.year}},
`),e.sourceType==="journal"&&e.fields.journalTitle&&(r+=`  journal = {${e.fields.journalTitle}},
`,e.fields.volume&&(r+=`  volume = {${e.fields.volume}},
`),e.fields.issue&&(r+=`  number = {${e.fields.issue}},
`),e.fields.pages&&(r+=`  pages = {${e.fields.pages}},
`)),e.sourceType==="book"&&e.fields.publisher&&(r+=`  publisher = {${e.fields.publisher}},
`),e.fields.url&&(r+=`  url = {${e.fields.url}},
`),e.fields.doi&&(r+=`  doi = {${e.fields.doi}},
`),r+=`}
`,r}).join(`
`)}function G(t){return t.map(e=>{let o=`TY  - ${e.sourceType==="journal"?"JOUR":e.sourceType==="book"?"BOOK":e.sourceType==="news"?"NEWS":"GEN"}
`;return e.fields.authors.forEach(r=>{o+=`AU  - ${r.lastName}, ${r.firstName}
`}),o+=`TI  - ${e.fields.title}
`,e.fields.year&&(o+=`PY  - ${e.fields.year}
`),e.sourceType==="journal"&&e.fields.journalTitle&&(o+=`JO  - ${e.fields.journalTitle}
`,e.fields.volume&&(o+=`VL  - ${e.fields.volume}
`),e.fields.issue&&(o+=`IS  - ${e.fields.issue}
`),e.fields.pages&&(o+=`SP  - ${e.fields.pages.split("-")[0]}
`)),e.sourceType==="book"&&e.fields.publisher&&(o+=`PB  - ${e.fields.publisher}
`),e.fields.url&&(o+=`UR  - ${e.fields.url}
`),e.fields.doi&&(o+=`DO  - ${e.fields.doi}
`),o+=`ER  - 

`,o}).join("")}function W(t){const e=["ID","Type","Style","Authors","Title","Year","Citation","Added"],n=t.map(o=>[o.id,o.sourceType,o.citationStyle,o.fields.authors.map(r=>`${r.firstName} ${r.lastName}`).join("; "),o.fields.title||"",o.fields.year||"",o.citation,o.addedAt]);return[e.join(","),...n.map(o=>o.map(r=>`"${r}"`).join(","))].join(`
`)}function X(){return`cit-${Date.now()}-${Math.random().toString(36).substring(7)}`}export{O as a,R as b,P as c,Y as d,H as e,F as f,C as g,W as h,G as i,K as j,B as k,X as l,V as s,E as u};
