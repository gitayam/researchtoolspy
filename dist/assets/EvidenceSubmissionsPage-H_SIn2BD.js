import{j as e}from"./ui-vendor-DBphXmDA.js";import{f as me,j as xe,r}from"./react-vendor-CfYLSWvh.js";import{C as m,d as x,a as b,b as p,c as g}from"./card-BQo7RV_Z.js";import{u as ue,e as u,I as k,B as n,y as o,S as J,z as K,C as M,E as W,F as h,q as he}from"./index-DGGXJgUa.js";import{T as ve,a as je,b as X,c as Y}from"./tabs-Dznm0vhG.js";import{bd as be,b as pe,W as G,C as Q,d as C,be as ge,aj as _,P as Z,ai as ee,E as F,bf as fe,q as Ne,ad as Se,t as ye,A as we,a0 as ke,az as Ce}from"./icons-x9tcvtYN.js";import"./state-vendor-BXB5jEEt.js";function Ie(){const E=me(),{t:i}=ue(),[se,T]=xe(),j=se.get("tab")||"forms",[P,ie]=r.useState([]),[ae,L]=r.useState(!0),[D,I]=r.useState(null),[f,te]=r.useState(""),[U,z]=r.useState(null),[N,re]=r.useState([]),[ne,$]=r.useState(!1),[A,R]=r.useState(null),[d,V]=r.useState("pending"),[a,O]=r.useState(null),[c,v]=r.useState(null),[S,H]=r.useState(!1);r.useEffect(()=>{y(),j==="review"&&w()},[j]),r.useEffect(()=>{j==="review"&&w()},[d]);const y=async()=>{L(!0),I(null);try{const s=await fetch("/api/research/forms/list?workspaceId=1"),t=await s.json();if(!s.ok)throw new Error(t.error||"Failed to load forms");ie(t.forms||[])}catch(s){console.error("Failed to load forms:",s),I(s instanceof Error?s.message:"Failed to load forms")}finally{L(!1)}},w=async()=>{$(!0),R(null);try{const s=new URLSearchParams;d&&s.append("status",d);const t=await fetch(`/api/research/submissions/list?${s}`),l=await t.json();if(!t.ok)throw new Error(l.error||"Failed to load submissions");re(l.submissions||[])}catch(s){console.error("Failed to load submissions:",s),R(s instanceof Error?s.message:"Failed to load submissions")}finally{$(!1)}},ce=async(s,t)=>{try{if(!(await fetch(`/api/research/forms/${s}/toggle`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_active:t===1?0:1})})).ok)throw new Error("Failed to toggle form status");await y()}catch(l){console.error("Failed to toggle form:",l),alert(l instanceof Error?l.message:"Failed to toggle form")}},le=async(s,t)=>{if(confirm(`Are you sure you want to delete "${t}"? This action cannot be undone.`))try{if(!(await fetch(`/api/research/forms/${s}`,{method:"DELETE"})).ok)throw new Error("Failed to delete form");await y()}catch(l){console.error("Failed to delete form:",l),alert(l instanceof Error?l.message:"Failed to delete form")}},B=(s,t)=>{navigator.clipboard.writeText(s),z(t),setTimeout(()=>z(null),2e3)},oe=s=>{v({submissionId:s.id,verificationStatus:"unverified",credibilityScore:.5,notes:""})},de=async()=>{if(c){H(!0);try{const s=await fetch("/api/research/submissions/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({submissionId:c.submissionId,verificationStatus:c.verificationStatus,credibilityScore:c.credibilityScore,notes:c.notes||void 0})}),t=await s.json();if(!s.ok)throw new Error(t.error||"Failed to process submission");await w(),v(null),O(null)}catch(s){console.error("Failed to process:",s),alert(s instanceof Error?s.message:"Failed to process submission")}finally{H(!1)}}},q=P.filter(s=>s.form_name.toLowerCase().includes(f.toLowerCase())||s.hash_id.toLowerCase().includes(f.toLowerCase()));return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:i("evidenceSubmissions.title","Evidence Submissions")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:i("evidenceSubmissions.description","Manage forms and review submitted evidence")})]}),e.jsxs(ve,{value:j,onValueChange:s=>T({tab:s}),children:[e.jsxs(je,{className:"grid w-full max-w-md grid-cols-2",children:[e.jsxs(X,{value:"forms",className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),i("evidenceSubmissions.formsTab","Forms"),e.jsx(u,{variant:"secondary",children:P.length})]}),e.jsxs(X,{value:"review",className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),i("evidenceSubmissions.reviewTab","Review"),e.jsx(u,{variant:"secondary",children:N.length})]})]}),e.jsxs(Y,{value:"forms",className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(k,{placeholder:i("evidenceSubmissions.searchForms","Search forms..."),value:f,onChange:s=>te(s.target.value),className:"max-w-md"}),e.jsxs(n,{onClick:()=>E("/dashboard/research/forms/new"),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),i("evidenceSubmissions.createForm","Create Form")]})]}),D&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Q,{className:"h-5 w-5 text-red-500 mr-2"}),e.jsx("span",{className:"text-red-700 dark:text-red-400",children:D})]})}),ae?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"})}):q.length===0?e.jsx(m,{children:e.jsxs(x,{className:"p-12 text-center",children:[e.jsx(C,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:i("evidenceSubmissions.noForms","No submission forms yet")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:i("evidenceSubmissions.noFormsDescription","Create your first form to start collecting evidence")}),e.jsxs(n,{onClick:()=>E("/dashboard/research/forms/new"),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),i("evidenceSubmissions.createFirstForm","Create First Form")]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:q.map(s=>e.jsxs(m,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx(p,{className:"text-lg",children:s.form_name}),e.jsx(u,{variant:s.is_active?"default":"secondary",children:s.is_active?i("evidenceSubmissions.active","Active"):i("evidenceSubmissions.inactive","Inactive")})]}),s.form_description&&e.jsx(g,{className:"line-clamp-2",children:s.form_description})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:i("evidenceSubmissions.submissions","Submissions")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.submission_count})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:i("evidenceSubmissions.fields","Fields")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.enabledFields.length})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),i("evidenceSubmissions.hashId","Hash ID")]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("code",{className:"flex-1 px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded text-sm font-mono",children:s.hash_id}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>B(s.hash_id,s.id),children:U===s.id?e.jsx(_,{className:"h-4 w-4 text-green-500"}):e.jsx(Z,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),i("evidenceSubmissions.created","Created")," ",new Date(s.created_at).toLocaleDateString()]}),e.jsxs("div",{className:"flex flex-col space-y-2 pt-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>B(`${window.location.origin}${s.submissionUrl}`,`url-${s.id}`),children:U===`url-${s.id}`?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),i("evidenceSubmissions.copied","Copied")]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),i("evidenceSubmissions.copyUrl","Copy URL")]})}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>window.open(`${window.location.origin}${s.submissionUrl}`,"_blank"),children:e.jsx(F,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(n,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>ce(s.id,s.is_active),children:[e.jsx(fe,{className:"h-3 w-3 mr-1"}),s.is_active?i("evidenceSubmissions.disable","Disable"):i("evidenceSubmissions.enable","Enable")]}),e.jsx(n,{variant:"destructive",size:"sm",onClick:()=>le(s.id,s.form_name),children:e.jsx(Ne,{className:"h-3 w-3"})})]}),s.submission_count>0&&e.jsxs(n,{variant:"ghost",size:"sm",className:"w-full",onClick:()=>{T({tab:"review"}),V("pending")},children:[i("evidenceSubmissions.viewSubmissions","View {{count}} Submission",{count:s.submission_count}),s.submission_count!==1?"s":""]})]})]})]},s.id))})]}),e.jsxs(Y,{value:"review",className:"mt-6",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-6",children:e.jsxs("div",{className:"flex-1 max-w-xs",children:[e.jsx(o,{htmlFor:"statusFilter",children:i("evidenceSubmissions.status","Status")}),e.jsxs(J,{value:d,onValueChange:V,children:[e.jsx(K,{id:"statusFilter",children:e.jsx(M,{})}),e.jsxs(W,{children:[e.jsx(h,{value:"pending",children:i("evidenceSubmissions.pending","Pending")}),e.jsx(h,{value:"completed",children:i("evidenceSubmissions.completed","Completed")}),e.jsx(h,{value:"rejected",children:i("evidenceSubmissions.rejected","Rejected")})]})]})]})}),A&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Q,{className:"h-5 w-5 text-red-500 mr-2"}),e.jsx("span",{className:"text-red-700 dark:text-red-400",children:A})]})}),ne?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"})}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:N.length===0?e.jsx(m,{children:e.jsxs(x,{className:"p-8 text-center",children:[e.jsx(C,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:i("evidenceSubmissions.noSubmissions","No {{status}} submissions",{status:d})}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:d==="pending"?i("evidenceSubmissions.noSubmissionsDescription","New submissions will appear here"):i("evidenceSubmissions.noSubmissionsYet","No {{status}} submissions yet",{status:d})})]})}):N.map(s=>e.jsxs(m,{className:`cursor-pointer hover:shadow-lg transition-shadow ${a?.id===s.id?"ring-2 ring-purple-500":""}`,onClick:()=>O(s),children:[e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(p,{className:"text-base",children:s.metadata?.title||s.content_description?.substring(0,60)||i("evidenceSubmissions.untitled","Untitled Submission")}),e.jsx(u,{variant:"outline",children:s.form_name})]}),s.content_type&&e.jsxs(g,{className:"flex items-center space-x-2",children:[e.jsx(u,{variant:"secondary",className:"text-xs",children:s.content_type}),s.keywords.length>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:[s.keywords.length," ",i("evidenceSubmissions.keywords","keywords")]})]})]}),e.jsxs(x,{className:"space-y-2",children:[s.source_url&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400 truncate",children:[e.jsx(Se,{className:"h-3 w-3 mr-1 flex-shrink-0"}),e.jsx("a",{href:s.source_url,target:"_blank",rel:"noopener noreferrer",className:"hover:underline truncate",onClick:t=>t.stopPropagation(),children:s.source_url})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),new Date(s.submitted_at).toLocaleString()]}),s.submitter_name&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(ye,{className:"h-3 w-3 mr-1"}),s.submitter_name]})]})]})]},s.id))}),e.jsx("div",{className:"lg:sticky lg:top-8 lg:h-fit",children:a?e.jsxs(m,{children:[e.jsxs(b,{children:[e.jsx(p,{children:i("evidenceSubmissions.submissionDetails","Submission Details")}),e.jsxs(g,{children:[i("evidenceSubmissions.submitted","Submitted")," ",new Date(a.submitted_at).toLocaleString()]})]}),e.jsxs(x,{className:"space-y-6",children:[a.source_url&&e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium",children:i("evidenceSubmissions.sourceUrl","Source URL")}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(k,{value:a.source_url,readOnly:!0,className:"text-sm"}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>window.open(a.source_url,"_blank"),children:e.jsx(F,{className:"h-4 w-4"})})]})]}),a.archived_url&&e.jsxs("div",{children:[e.jsxs(o,{className:"text-sm font-medium flex items-center",children:[e.jsx(we,{className:"h-3 w-3 mr-1"}),i("evidenceSubmissions.archivedUrl","Archived URL")]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(k,{value:a.archived_url,readOnly:!0,className:"text-sm"}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>window.open(a.archived_url,"_blank"),children:e.jsx(F,{className:"h-4 w-4"})})]})]}),a.content_type&&e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium",children:i("evidenceSubmissions.contentType","Content Type")}),e.jsx(u,{variant:"outline",className:"mt-1",children:a.content_type})]}),a.content_description&&e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium",children:i("evidenceSubmissions.description","Description")}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mt-1",children:a.content_description})]}),a.keywords.length>0&&e.jsxs("div",{children:[e.jsxs(o,{className:"text-sm font-medium flex items-center",children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),i("evidenceSubmissions.keywords","Keywords")]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:a.keywords.map((s,t)=>e.jsx(u,{variant:"secondary",className:"text-xs",children:s},t))})]}),a.submitter_comments&&e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium",children:i("evidenceSubmissions.submitterComments","Submitter Comments")}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mt-1",children:a.submitter_comments})]}),(a.submitter_name||a.submitter_contact)&&e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium",children:i("evidenceSubmissions.submitter","Submitter")}),e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300 mt-1",children:[a.submitter_name&&e.jsxs("div",{children:[i("evidenceSubmissions.name","Name"),": ",a.submitter_name]}),a.submitter_contact&&e.jsxs("div",{children:[i("evidenceSubmissions.contact","Contact"),": ",a.submitter_contact]})]})]}),a.status==="pending"&&e.jsxs("div",{className:"flex space-x-2 pt-4",children:[e.jsxs(n,{onClick:()=>oe(a),className:"flex-1",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),i("evidenceSubmissions.processToEvidence","Process to Evidence")]}),e.jsxs(n,{variant:"destructive",className:"flex-1",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),i("evidenceSubmissions.reject","Reject")]})]})]})]}):e.jsx(m,{children:e.jsxs(x,{className:"p-12 text-center",children:[e.jsx(C,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:i("evidenceSubmissions.selectSubmission","Select a submission to view details")})]})})})]})]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs(m,{className:"w-full max-w-lg",children:[e.jsxs(b,{children:[e.jsx(p,{children:i("evidenceSubmissions.processToEvidence","Process to Evidence")}),e.jsx(g,{children:i("evidenceSubmissions.processDescription","Convert this submission into a research evidence entry")})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"verificationStatus",children:i("evidenceSubmissions.verificationStatus","Verification Status")}),e.jsxs(J,{value:c.verificationStatus,onValueChange:s=>v({...c,verificationStatus:s}),children:[e.jsx(K,{id:"verificationStatus",children:e.jsx(M,{})}),e.jsxs(W,{children:[e.jsx(h,{value:"verified",children:i("evidenceSubmissions.verified","Verified")}),e.jsx(h,{value:"probable",children:i("evidenceSubmissions.probable","Probable")}),e.jsx(h,{value:"unverified",children:i("evidenceSubmissions.unverified","Unverified")}),e.jsx(h,{value:"disproven",children:i("evidenceSubmissions.disproven","Disproven")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{htmlFor:"credibilityScore",children:[i("evidenceSubmissions.credibilityScore","Credibility Score"),":"," ",(c.credibilityScore*100).toFixed(0),"%"]}),e.jsx("input",{id:"credibilityScore",type:"range",min:"0",max:"1",step:"0.1",value:c.credibilityScore,onChange:s=>v({...c,credibilityScore:parseFloat(s.target.value)}),className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{htmlFor:"notes",children:[i("evidenceSubmissions.reviewerNotes","Reviewer Notes")," (",i("evidenceSubmissions.optional","Optional"),")"]}),e.jsx(he,{id:"notes",placeholder:i("evidenceSubmissions.notesPlaceholder","Add any notes about this evidence..."),value:c.notes,onChange:s=>v({...c,notes:s.target.value}),rows:3})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(n,{variant:"outline",onClick:()=>v(null),className:"flex-1",disabled:S,children:i("evidenceSubmissions.cancel","Cancel")}),e.jsx(n,{onClick:de,className:"flex-1",disabled:S,children:S?i("evidenceSubmissions.processing","Processing..."):i("evidenceSubmissions.processToEvidence","Process to Evidence")})]})]})]})})]})})}export{Ie as default};
