import{j as e}from"./ui-vendor-DBphXmDA.js";import{r as C,f as be,u as we,j as Ee}from"./react-vendor-CfYLSWvh.js";import{F as Ce}from"./viz-libs-B9RIjOsc.js";import{C as ne,a as ae,b as ie,d as re,c as Te}from"./card-BGAig-Dv.js";import{B,y as G,I as ee,l as he,m as me,n as xe,o as pe,p as ge,e as $,A as Se,r as Ie}from"./index-QqleixXe.js";import{C as te}from"./checkbox-DueJeeKx.js";import{S as Re}from"./slider-B52ikc1m.js";import{bg as ke,a as se,aD as Oe,aE as Ae,aF as De,ax as _e,d as Le,Q as W,a1 as ue,e as $e,V as Me,N as Be,x as Pe,C as q,bh as Z,T as Fe,bi as fe,z as oe,R as Ue,_ as Ve,w as He,v as ze}from"./icons-x9tcvtYN.js";import{R as Ge,a as Q}from"./radio-group-Dj8G6QwH.js";import{P as ce}from"./progress-Cg1bbsHw.js";import{T as Ye,a as Qe,b as K,c as J}from"./tabs-If3dmLWi.js";import"./state-vendor-BXB5jEEt.js";const le={ACTOR:"#3b82f6",SOURCE:"#8b5cf6",EVENT:"#ef4444",PLACE:"#10b981",BEHAVIOR:"#f59e0b",EVIDENCE:"#6366f1"},We={ACTOR:"ðŸ‘¤",SOURCE:"ðŸ“„",EVENT:"ðŸŽ¯",PLACE:"ðŸ“",BEHAVIOR:"ðŸ”„",EVIDENCE:"ðŸ”"};function qe({nodes:o,links:h,onNodeClick:n,onBackgroundClick:s,width:l=800,height:c=600,highlightedPath:i=[],highlightedNodes:f=new Set}){const j=C.useRef(null),p=C.useMemo(()=>({nodes:o.map(a=>({...a,id:a.id,name:a.name,entityType:a.entityType,color:le[a.entityType],val:a.val||1})),links:h.map(a=>({...a,source:a.source,target:a.target,color:a.confidence==="CONFIRMED"?"#000000":a.confidence==="PROBABLE"?"#666666":a.confidence==="POSSIBLE"?"#999999":"#cccccc",width:a.weight*3,type:a.relationshipType}))}),[o,h]),E=C.useCallback(a=>{n&&n(a)},[n]),t=C.useCallback(()=>{s&&s()},[s]),m=C.useCallback((a,r,w)=>{const g=a.name,b=12/w,v=Math.sqrt(a.val||1)*4,I=i.includes(a.id),O=f.has(a.id),x=I||O;r.beginPath(),r.arc(a.x,a.y,v,0,2*Math.PI),r.fillStyle=a.color||"#999999",r.fill(),r.strokeStyle=x?"#fbbf24":"#ffffff",r.lineWidth=x?3/w:1.5/w,r.stroke(),x&&(r.beginPath(),r.arc(a.x,a.y,v+2/w,0,2*Math.PI),r.strokeStyle="rgba(251, 191, 36, 0.3)",r.lineWidth=4/w,r.stroke()),(x||w>1.5)&&(r.font=`${b}px Sans-Serif`,r.textAlign="center",r.textBaseline="middle",r.fillStyle=x?"#92400e":"#333333",r.fillText(g,a.x,a.y+v+b))},[i,f]),d=C.useCallback((a,r,w)=>{const g=a.source,b=a.target;if(typeof g!="object"||typeof b!="object")return;const v=i.length>1&&(i.indexOf(g.id)!==-1&&i.indexOf(b.id)===i.indexOf(g.id)+1||i.indexOf(b.id)!==-1&&i.indexOf(g.id)===i.indexOf(b.id)+1),I=v?4/w:(a.width||1)/w;r.strokeStyle=v?"#fbbf24":a.color||"#cccccc",r.lineWidth=I,!v&&(a.confidence==="POSSIBLE"||a.confidence==="SUSPECTED")?r.setLineDash([5/w,5/w]):r.setLineDash([]),r.beginPath(),r.moveTo(g.x,g.y),r.lineTo(b.x,b.y),r.stroke();const O=10/w,x=6/w,N=Math.atan2(b.y-g.y,b.x-g.x),R=Math.sqrt(b.val||1)*4,y=b.x-Math.cos(N)*R,k=b.y-Math.sin(N)*R;r.save(),r.translate(y,k),r.rotate(N),r.beginPath(),r.moveTo(0,0),r.lineTo(-O,-x/2),r.lineTo(-O,x/2),r.closePath(),r.fillStyle=v?"#fbbf24":a.color||"#cccccc",r.fill(),r.restore(),r.setLineDash([])},[i]);return e.jsxs("div",{className:"relative",style:{width:l,height:c},children:[e.jsx(Ce,{ref:j,graphData:p,width:l,height:c,backgroundColor:"#f9fafb",nodeCanvasObject:m,linkCanvasObject:d,nodeCanvasObjectMode:()=>"replace",linkCanvasObjectMode:()=>"replace",onNodeClick:E,onBackgroundClick:t,enableNodeDrag:!0,enableZoomInteraction:!0,enablePanInteraction:!0,cooldownTicks:100,d3AlphaDecay:.02,d3VelocityDecay:.3}),e.jsxs("div",{className:"absolute top-4 right-4 bg-white p-4 rounded-lg shadow-lg border border-gray-200",children:[e.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Entity Types"}),e.jsx("div",{className:"space-y-1",children:Object.entries(le).map(([a,r])=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:r}}),e.jsxs("span",{children:[We[a]," ",a]})]},a))}),e.jsx("h3",{className:"text-sm font-semibold mt-3 mb-2",children:"Confidence"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:"w-6 h-0.5 bg-black"}),e.jsx("span",{children:"Confirmed"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:"w-6 h-0.5 bg-gray-600"}),e.jsx("span",{children:"Probable"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:"w-6 h-0.5 bg-gray-400",style:{borderBottom:"2px dashed #9ca3af"}}),e.jsx("span",{children:"Possible"})]})]})]})]})}const de=["ACTOR","SOURCE","EVENT","PLACE","BEHAVIOR","EVIDENCE"],Xe={0:"SUSPECTED",1:"POSSIBLE",2:"PROBABLE",3:"CONFIRMED"};function Ke({filters:o,onFiltersChange:h,onZoomIn:n,onZoomOut:s,onFitView:l,totalNodes:c,totalEdges:i}){const[f,j]=C.useState(!0),p=a=>{const r=new Set(o.entityTypes);r.has(a)?r.delete(a):r.add(a),h({...o,entityTypes:r})},E=()=>{h({...o,entityTypes:new Set(de)})},t=()=>{h({...o,entityTypes:new Set})},m=a=>{h({...o,minConfidence:a[0]})},d=a=>{h({...o,searchQuery:a})};return e.jsxs(ne,{className:"w-80 h-full overflow-y-auto",children:[e.jsxs(ae,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ie,{className:"flex items-center gap-2 text-lg",children:[e.jsx(ke,{className:"h-4 w-4"}),"Network Controls"]}),e.jsx(B,{variant:"ghost",size:"sm",onClick:()=>j(!f),children:f?"âˆ’":"+"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[c," nodes, ",i," edges"]})]}),f&&e.jsxs(re,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(G,{className:"text-sm font-semibold mb-2",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-2 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(ee,{placeholder:"Search entities...",value:o.searchQuery,onChange:a=>d(a.target.value),className:"pl-8"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(G,{className:"text-sm font-semibold",children:"Entity Types"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(B,{variant:"ghost",size:"sm",onClick:E,className:"h-6 px-2 text-xs",children:"All"}),e.jsx(B,{variant:"ghost",size:"sm",onClick:t,className:"h-6 px-2 text-xs",children:"None"})]})]}),e.jsx("div",{className:"space-y-2",children:de.map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{id:`entity-${a}`,checked:o.entityTypes.has(a),onCheckedChange:()=>p(a)}),e.jsx("label",{htmlFor:`entity-${a}`,className:"text-sm cursor-pointer",children:a})]},a))})]}),e.jsxs("div",{children:[e.jsxs(G,{className:"text-sm font-semibold mb-2",children:["Minimum Confidence: ",Xe[o.minConfidence]]}),e.jsx(Re,{value:[o.minConfidence],onValueChange:m,min:0,max:3,step:1,className:"mt-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"Suspected"}),e.jsx("span",{children:"Confirmed"})]})]}),e.jsxs("div",{children:[e.jsx(G,{className:"text-sm font-semibold mb-2",children:"View Controls"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(B,{variant:"outline",size:"sm",onClick:n,disabled:!n,children:e.jsx(Oe,{className:"h-4 w-4"})}),e.jsx(B,{variant:"outline",size:"sm",onClick:s,disabled:!s,children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(B,{variant:"outline",size:"sm",onClick:l,disabled:!l,children:e.jsx(De,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx(G,{className:"text-sm font-semibold mb-2",children:"Display"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{id:"show-labels",checked:o.showLabels,onCheckedChange:a=>h({...o,showLabels:!!a})}),e.jsx("label",{htmlFor:"show-labels",className:"text-sm cursor-pointer",children:"Show all labels"})]})]})]})]})}function Je({open:o,onOpenChange:h,nodes:n,links:s,filters:l}){const[c,i]=C.useState("json"),[f,j]=C.useState(!0),p=()=>{const g={nodes:n,edges:s,metadata:f?{exported_at:new Date().toISOString(),total_nodes:n.length,total_edges:s.length,filters:l}:void 0},b=new Blob([JSON.stringify(g,null,2)],{type:"application/json"});H(b,`network-graph-${V()}.json`)},E=()=>{const g=["id","name","entity_type","connections"],b=n.map(y=>[y.id,y.name,y.entityType,y.val||0]),v=[g,...b].map(y=>y.map(k=>`"${k}"`).join(",")).join(`
`),I=["source","target","relationship_type","weight","confidence"],O=s.map(y=>[y.source,y.target,y.relationshipType,y.weight,y.confidence||"UNKNOWN"]),x=[I,...O].map(y=>y.map(k=>`"${k}"`).join(",")).join(`
`),N=new Blob([v],{type:"text/csv"}),R=new Blob([x],{type:"text/csv"});H(N,`network-nodes-${V()}.csv`),H(R,`network-edges-${V()}.csv`)},t=()=>{const g=`<?xml version="1.0" encoding="UTF-8"?>
<graphml xmlns="http://graphml.graphdrawing.org/xmlns"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://graphml.graphdrawing.org/xmlns
         http://graphml.graphdrawing.org/xmlns/1.0/graphml.xsd">

  <!-- Node attributes -->
  <key id="name" for="node" attr.name="name" attr.type="string"/>
  <key id="entity_type" for="node" attr.name="entity_type" attr.type="string"/>
  <key id="connections" for="node" attr.name="connections" attr.type="int"/>

  <!-- Edge attributes -->
  <key id="relationship_type" for="edge" attr.name="relationship_type" attr.type="string"/>
  <key id="weight" for="edge" attr.name="weight" attr.type="double"/>
  <key id="confidence" for="edge" attr.name="confidence" attr.type="string"/>

  <graph id="G" edgedefault="directed">
${n.map(v=>`    <node id="${P(v.id)}">
      <data key="name">${P(v.name)}</data>
      <data key="entity_type">${P(v.entityType)}</data>
      <data key="connections">${v.val||0}</data>
    </node>`).join(`
`)}

${s.map((v,I)=>`    <edge id="e${I}" source="${P(v.source)}" target="${P(v.target)}">
      <data key="relationship_type">${P(v.relationshipType)}</data>
      <data key="weight">${v.weight}</data>
      <data key="confidence">${P(v.confidence||"UNKNOWN")}</data>
    </edge>`).join(`
`)}
  </graph>
</graphml>`,b=new Blob([g],{type:"application/xml"});H(b,`network-graph-${V()}.graphml`)},m=()=>{const g={ACTOR:{r:59,g:130,b:246},SOURCE:{r:139,g:92,b:246},EVENT:{r:239,g:68,b:68},PLACE:{r:16,g:185,b:129},BEHAVIOR:{r:245,g:158,b:11},EVIDENCE:{r:99,g:102,b:241}},b=`<?xml version="1.0" encoding="UTF-8"?>
<gexf xmlns="http://www.gexf.net/1.3" xmlns:viz="http://www.gexf.net/1.3/viz" version="1.3">
  <meta lastmodifieddate="${new Date().toISOString()}">
    <creator>Research Tools - Network Analysis</creator>
    <description>Entity Network Graph Export</description>
  </meta>
  <graph mode="static" defaultedgetype="directed">
    <attributes class="node">
      <attribute id="0" title="entity_type" type="string"/>
      <attribute id="1" title="connections" type="integer"/>
      <attribute id="2" title="export_date" type="string"/>
    </attributes>
    <attributes class="edge">
      <attribute id="0" title="relationship_type" type="string"/>
      <attribute id="1" title="weight" type="float"/>
      <attribute id="2" title="confidence" type="string"/>
    </attributes>

    <nodes>
${n.map(I=>{const O=g[I.entityType]||{r:128,g:128,b:128},x=Math.max(5,Math.min(50,(I.val||1)*3));return`      <node id="${P(I.id)}" label="${P(I.name)}">
        <attvalues>
          <attvalue for="0" value="${P(I.entityType)}"/>
          <attvalue for="1" value="${I.val||0}"/>
          <attvalue for="2" value="${new Date().toISOString()}"/>
        </attvalues>
        <viz:color r="${O.r}" g="${O.g}" b="${O.b}"/>
        <viz:size value="${x}"/>
      </node>`}).join(`
`)}
    </nodes>

    <edges>
${s.map((I,O)=>{const x=I.confidence||"UNKNOWN",N=I.weight||1,R=x==="CONFIRMED"?3:x==="PROBABLE"?2:1;return`      <edge id="${O}" source="${P(I.source)}" target="${P(I.target)}" weight="${N}">
        <attvalues>
          <attvalue for="0" value="${P(I.relationshipType)}"/>
          <attvalue for="1" value="${N}"/>
          <attvalue for="2" value="${P(x)}"/>
        </attvalues>
        <viz:thickness value="${R}"/>
      </edge>`}).join(`
`)}
    </edges>
  </graph>
</gexf>`,v=new Blob([b],{type:"application/xml"});H(v,`network-graph-${V()}.gexf`)},d=()=>{const g=N=>N.replace(/\\/g,"\\\\").replace(/'/g,"\\'"),b=N=>N.replace(/\s+/g,"_").toLowerCase();let v=`// Neo4j Cypher Script - Network Graph Export
// Generated: ${new Date().toISOString()}
// Total Nodes: ${n.length} | Total Relationships: ${s.length}
//
// USAGE:
// 1. Open Neo4j Browser (http://localhost:7474) or Neo4j Desktop
// 2. Copy and paste this entire script
// 3. Execute to create the graph
// 4. Run queries to analyze (see bottom of file for examples)

// ============================================================================
// STEP 1: Create Constraints and Indexes (for performance and data integrity)
// ============================================================================

// Unique constraint on entity ID (ensures no duplicates)
CREATE CONSTRAINT entity_id_unique IF NOT EXISTS
FOR (e:Entity) REQUIRE e.id IS UNIQUE;

// Indexes for fast lookups
CREATE INDEX entity_name_index IF NOT EXISTS
FOR (e:Entity) ON (e.name);

CREATE INDEX entity_type_index IF NOT EXISTS
FOR (e:Entity) ON (e.type);

// ============================================================================
// STEP 2: Create Nodes
// ============================================================================

`;const I=n.reduce((N,R)=>(N[R.entityType]||(N[R.entityType]=[]),N[R.entityType].push(R),N),{});Object.entries(I).forEach(([N,R])=>{v+=`// ${N} entities (${R.length} total)
`,R.forEach(y=>{v+=`CREATE (:Entity:${N} {
  id: '${g(y.id)}',
  name: '${g(y.name)}',
  type: '${N}',
  connections: ${y.val||0}
});
`}),v+=`
`}),v+=`// ============================================================================
// STEP 3: Create Relationships
// ============================================================================

`;const O=s.reduce((N,R)=>{const y=b(R.relationshipType);return N[y]||(N[y]=[]),N[y].push(R),N},{});Object.entries(O).forEach(([N,R])=>{v+=`// ${N.toUpperCase()} relationships (${R.length} total)
`,R.forEach(y=>{const k=b(y.relationshipType).toUpperCase();v+=`MATCH (source:Entity {id: '${g(y.source)}'})
MATCH (target:Entity {id: '${g(y.target)}'})
CREATE (source)-[:${k} {
  type: '${g(y.relationshipType)}',
  weight: ${y.weight},
  confidence: '${g(y.confidence||"UNKNOWN")}'
}]->(target);
`}),v+=`
`}),v+=`// ============================================================================
// DONE! Your graph has been created in Neo4j.
// ============================================================================

// ============================================================================
// EXAMPLE QUERIES (uncomment and run to analyze your network)
// ============================================================================

// --- Query 1: View all nodes ---
// MATCH (e:Entity)
// RETURN e.name, e.type, e.connections
// ORDER BY e.connections DESC
// LIMIT 25;

// --- Query 2: Find most connected entities (top hubs) ---
// MATCH (e:Entity)
// RETURN e.name, e.type, e.connections
// ORDER BY e.connections DESC
// LIMIT 10;

// --- Query 3: Find all relationships for a specific entity ---
// MATCH (e:Entity {name: 'ENTITY_NAME_HERE'})-[r]-(connected)
// RETURN e.name as entity, type(r) as relationship, connected.name as connected_entity, r.confidence
// LIMIT 50;

// --- Query 4: Find shortest path between two entities ---
// MATCH path = shortestPath(
//   (start:Entity {name: 'START_ENTITY'})-[*]-(end:Entity {name: 'END_ENTITY'})
// )
// RETURN path;

// --- Query 5: Find communities (densely connected subgraphs) ---
// CALL gds.louvain.stream('myGraph')
// YIELD nodeId, communityId
// RETURN gds.util.asNode(nodeId).name AS name, communityId
// ORDER BY communityId;

// --- Query 6: PageRank (find most influential entities) ---
// CALL gds.pageRank.stream('myGraph')
// YIELD nodeId, score
// RETURN gds.util.asNode(nodeId).name AS name, score
// ORDER BY score DESC
// LIMIT 10;

// --- Query 7: Betweenness Centrality (find information brokers) ---
// CALL gds.betweenness.stream('myGraph')
// YIELD nodeId, score
// RETURN gds.util.asNode(nodeId).name AS name, score
// ORDER BY score DESC
// LIMIT 10;

// --- Query 8: Find entities by type ---
// MATCH (e:ACTOR)  // Change to: SOURCE, EVENT, PLACE, BEHAVIOR, EVIDENCE
// RETURN e.name, e.connections
// ORDER BY e.connections DESC;

// --- Query 9: Find confirmed relationships only ---
// MATCH (source)-[r {confidence: 'CONFIRMED'}]->(target)
// RETURN source.name, type(r), target.name, r.weight
// ORDER BY r.weight DESC;

// --- Query 10: Export to CSV (for further analysis in R/Python) ---
// MATCH (e:Entity)
// RETURN e.id, e.name, e.type, e.connections
// INTO OUTFILE 'neo4j_nodes_export.csv'
// FIELDS TERMINATED BY ','
// ENCLOSED BY '"'
// LINES TERMINATED BY '\\n';

// ============================================================================
// VISUALIZATION TIP: Run "MATCH (n)-[r]->(m) RETURN n,r,m LIMIT 100" to see graph
// ============================================================================
`;const x=new Blob([v],{type:"text/plain"});H(x,`network-graph-${V()}.cypher`)},a=()=>{const g={ACTOR:"maltego.Person",SOURCE:"maltego.Document",EVENT:"maltego.Phrase",PLACE:"maltego.Location",BEHAVIOR:"maltego.Phrase",EVIDENCE:"maltego.Document"},b=["Entity Type","Entity Value","Weight","Connections","Notes"],v=n.map(k=>[g[k.entityType]||"maltego.Phrase",k.name,k.val||0,k.val||0,`Original Type: ${k.entityType}`]),I=[b,...v].map(k=>k.map(T=>`"${T}"`).join(",")).join(`
`),O=new Blob([I],{type:"text/csv"});H(O,`maltego-entities-${V()}.csv`);const x=["Source","Target","Relationship","Weight","Confidence"],N=s.map(k=>[k.source,k.target,k.relationshipType,k.weight,k.confidence||"UNKNOWN"]),R=[x,...N].map(k=>k.map(T=>`"${T}"`).join(",")).join(`
`),y=new Blob([R],{type:"text/csv"});H(y,`maltego-links-${V()}.csv`)},r=()=>{const g={ACTOR:"Person",SOURCE:"Document",EVENT:"Event",PLACE:"Location",BEHAVIOR:"Activity",EVIDENCE:"Evidence Item"},b={ACTOR:"Person",SOURCE:"Document",EVENT:"Calendar",PLACE:"Location",BEHAVIOR:"Activity",EVIDENCE:"Evidence"},v=["EntityID","Label","EntityType","Icon","Connections","OriginalType"],I=n.map(T=>[T.id,T.name,g[T.entityType]||"Entity",b[T.entityType]||"Circle",T.val||0,T.entityType]),O=[v,...I].map(T=>T.map(Y=>`"${Y}"`).join(",")).join(`
`),x=["LinkID","SourceID","TargetID","LinkType","LinkStrength","Confidence","Weight"],N=s.map((T,Y)=>[`link-${Y+1}`,T.source,T.target,T.relationshipType,T.weight,T.confidence||"UNKNOWN",T.weight]),R=[x,...N].map(T=>T.map(Y=>`"${Y}"`).join(",")).join(`
`),y=new Blob([O],{type:"text/csv; charset=utf-8"}),k=new Blob([R],{type:"text/csv; charset=utf-8"});H(y,`i2anb-entities-${V()}.csv`),H(k,`i2anb-links-${V()}.csv`)},w=()=>{switch(c){case"json":p();break;case"csv":E();break;case"graphml":t();break;case"gexf":m();break;case"cypher":d();break;case"maltego":a();break;case"i2anb":r();break}h(!1)};return e.jsx(he,{open:o,onOpenChange:h,children:e.jsxs(me,{className:"sm:max-w-md",children:[e.jsxs(xe,{children:[e.jsx(pe,{children:"Export Network Graph"}),e.jsx(ge,{children:"Choose a format to export your network data for external analysis"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(G,{className:"text-sm font-semibold",children:"Export Format"}),e.jsxs(Ge,{value:c,onValueChange:g=>i(g),children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Q,{value:"json",id:"json"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{htmlFor:"json",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer flex items-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),"JSON"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Standard format with full metadata support"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Q,{value:"csv",id:"csv"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{htmlFor:"csv",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"CSV Edge List"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Two files: nodes.csv and edges.csv (Excel-compatible)"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Q,{value:"graphml",id:"graphml"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{htmlFor:"graphml",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"GraphML"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"For Gephi, Cytoscape, yEd (XML-based)"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Q,{value:"gexf",id:"gexf"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{htmlFor:"gexf",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"GEXF"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Gephi native format with rich metadata"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Q,{value:"cypher",id:"cypher"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{htmlFor:"cypher",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Neo4j Cypher"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ready-to-run Cypher script for Neo4j graph database"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Q,{value:"maltego",id:"maltego"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{htmlFor:"maltego",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Maltego CSV"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"OSINT tool CSV format (entities + links) for Maltego transforms"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Q,{value:"i2anb",id:"i2anb"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{htmlFor:"i2anb",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"i2 Analyst's Notebook"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"IBM i2 ANB CSV format (entities.csv + links.csv) for law enforcement analysis"})]})]})]})]}),c==="json"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{id:"metadata",checked:f,onCheckedChange:g=>j(!!g)}),e.jsx("label",{htmlFor:"metadata",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:"Include metadata (timestamps, filters, stats)"})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 text-sm",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Nodes:"}),e.jsx("span",{className:"font-semibold ml-2",children:n.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Edges:"}),e.jsx("span",{className:"font-semibold ml-2",children:s.length})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(B,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsxs(B,{onClick:w,children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Export"]})]})]})})}function V(){return new Date().toISOString().split("T")[0]}function H(o,h){const n=URL.createObjectURL(o),s=document.createElement("a");s.href=n,s.download=h,s.click(),URL.revokeObjectURL(n)}function P(o){return o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function Ze(o,h){const n=X(o,h),s=o.map(r=>r.id),l=s.map(r=>({id:r,value:(n.get(r)?.out.length||0)+(n.get(r)?.in.length||0)})),c=l.reduce((r,w)=>r+w.value,0)/s.length,i=s.length*(s.length-1),f=i>0?h.length/i:0,j=ye(s,n),p=Object.entries(j).map(([r,w])=>({id:r,value:w})).sort((r,w)=>w.value-r.value).slice(0,10),E=et(s,n),t=Object.entries(E).map(([r,w])=>({id:r,value:w})).sort((r,w)=>w.value-r.value).slice(0,10),d=s.map(r=>st(r,n)).reduce((r,w)=>r+w,0)/s.length,a=nt(s,n);return{nodeCount:s.length,edgeCount:h.length,density:f,avgDegree:c,topByDegree:l.sort((r,w)=>w.value-r.value).slice(0,10),topByBetweenness:p,topByCloseness:t,avgClusteringCoefficient:d,componentCount:a.length,largestComponentSize:Math.max(...a.map(r=>r.length),0)}}function X(o,h){const n=new Map;return o.forEach(s=>{n.set(s.id,{in:[],out:[]})}),h.forEach(s=>{const l=s.source,c=s.target;n.has(l)&&n.get(l).out.push(c),n.has(c)&&n.get(c).in.push(l)}),n}function ye(o,h){const n={};o.forEach(l=>{n[l]=0}),o.forEach(l=>{const c=[],i={},f={},j={},p={};o.forEach(t=>{i[t]=[],f[t]=0,j[t]=-1,p[t]=0}),f[l]=1,j[l]=0;const E=[l];for(;E.length>0;){const t=E.shift();c.push(t),[...h.get(t)?.out||[],...h.get(t)?.in||[]].forEach(d=>{j[d]<0&&(E.push(d),j[d]=j[t]+1),j[d]===j[t]+1&&(f[d]+=f[t],i[d].push(t))})}for(;c.length>0;){const t=c.pop();i[t].forEach(m=>{p[m]+=f[m]/f[t]*(1+p[t])}),t!==l&&(n[t]+=p[t])}});const s=o.length;if(s>2){const l=2/((s-1)*(s-2));Object.keys(n).forEach(c=>{n[c]*=l})}return n}function et(o,h){const n={};return o.forEach(s=>{const l=tt(s,h),c=Object.values(l).filter(i=>i>0&&i<1/0);if(c.length>0){const i=c.reduce((f,j)=>f+j,0);n[s]=c.length/i}else n[s]=0}),n}function tt(o,h){const n={},s=new Set,l=[{node:o,distance:0}];for(s.add(o),n[o]=0;l.length>0;){const{node:c,distance:i}=l.shift();[...h.get(c)?.out||[],...h.get(c)?.in||[]].forEach(j=>{s.has(j)||(s.add(j),n[j]=i+1,l.push({node:j,distance:i+1}))})}return n}function st(o,h){const n=h.get(o);if(!n)return 0;const s=[...new Set([...n.in,...n.out])],l=s.length;if(l<2)return 0;let c=0;for(let f=0;f<s.length;f++)for(let j=f+1;j<s.length;j++){const p=s[f],E=s[j],t=h.get(p);t&&(t.out.includes(E)||t.in.includes(E))&&c++}const i=l*(l-1)/2;return i>0?c/i:0}function nt(o,h){const n=new Set,s=[];return o.forEach(l=>{if(!n.has(l)){const c=at(l,h,n);s.push(c)}}),s}function at(o,h,n){const s=[],l=[o];for(;l.length>0;){const c=l.pop();if(!n.has(c)){n.add(c),s.push(c);const i=h.get(c);i&&l.push(...i.out,...i.in)}}return s}function it(o,h){const n=[],s=X(o,h);return rt(o.map(i=>i.id),s).forEach(i=>{n.push({type:"TRIANGLE",nodes:i,significance:.7,description:`Triangle: ${i.join(" â†’ ")}`})}),ot(o.map(i=>i.id),s,3).forEach(i=>{n.push({type:"STAR",nodes:i.nodes,significance:i.connections/o.length,description:`Star hub: ${i.center} with ${i.connections} connections`})}),n}function rt(o,h){const n=[],s=new Set;for(let l=0;l<o.length;l++){const c=o[l],i=h.get(c);if(!i)continue;const f=[...new Set([...i.in,...i.out])];for(let j=0;j<f.length;j++){const p=f[j],E=h.get(p);if(!E)continue;const t=[...new Set([...E.in,...E.out])];for(let m=0;m<t.length;m++){const d=t[m];if(d===c)continue;const a=h.get(d);if(a&&(a.in.includes(c)||a.out.includes(c))){const r=[c,p,d].sort().join("-");s.has(r)||(n.push([c,p,d]),s.add(r))}}}}return n}function ot(o,h,n){const s=[];return o.forEach(l=>{const c=h.get(l);if(!c)return;const i=[...new Set([...c.in,...c.out])];i.length>=n&&s.push({center:l,nodes:[l,...i],connections:i.length})}),s.sort((l,c)=>c.connections-l.connections)}function ct(o,h){const n=[],s=X(o,h),l=o.map(t=>t.id),c=l.map(t=>{const m=s.get(t);return(m?.in.length||0)+(m?.out.length||0)}),i=c.reduce((t,m)=>t+m,0)/l.length,f=Math.sqrt(c.reduce((t,m)=>t+Math.pow(m-i,2),0)/l.length);l.forEach(t=>{const m=s.get(t),d=(m?.in.length||0)+(m?.out.length||0);d===0?n.push({type:"ISOLATED",nodeIds:[t],severity:"MEDIUM",score:.6,description:"Isolated node with no connections",recommendation:"Verify if this entity should be connected or removed from the network"}):d===1&&l.length>10&&n.push({type:"ISOLATED",nodeIds:[t],severity:"LOW",score:.3,description:`Node with only 1 connection in network of ${l.length} nodes`,recommendation:"May indicate peripheral or newly added entity"})});const j=i+2*f;l.forEach(t=>{const m=s.get(t),d=(m?.in.length||0)+(m?.out.length||0);if(d>j&&d>5){const a=d>i+3*f?"CRITICAL":d>i+2.5*f?"HIGH":"MEDIUM";n.push({type:"SUPER_CONNECTED",nodeIds:[t],severity:a,score:Math.min((d-i)/(3*f),1),description:`Hub node with ${d} connections (avg: ${i.toFixed(1)})`,recommendation:"Central hub - may be critical for network connectivity or a data collection point"})}});const p=ye(l,s);l.forEach(t=>{const m=s.get(t),d=(m?.in.length||0)+(m?.out.length||0),a=p[t]||0;a>.1&&d<i&&d>2&&n.push({type:"BRIDGE",nodeIds:[t],severity:"HIGH",score:a,description:`Bridge node connecting separate network regions (betweenness: ${a.toFixed(3)})`,recommendation:"Critical connector - removal may fragment the network"})}),l.forEach(t=>{const m=s.get(t);if(!m)return;const d=[...new Set([...m.in,...m.out])];if(d.length<3)return;let a=0;for(let g=0;g<d.length;g++)for(let b=g+1;b<d.length;b++){const v=s.get(d[g]);v&&(v.out.includes(d[b])||v.in.includes(d[b]))||a++}const r=d.length*(d.length-1)/2,w=a/r;w>.7&&d.length>=3&&n.push({type:"STRUCTURAL_HOLE",nodeIds:[t],severity:"MEDIUM",score:w,description:`Structural hole - connects ${d.length} otherwise unconnected entities`,recommendation:"Broker position - controls information flow between groups"})}),h.forEach(t=>{const m=t.weight||.5,d=t.confidence;d==="SUSPECTED"&&m>.8&&n.push({type:"SUSPICIOUS_LINK",nodeIds:[t.source,t.target],severity:"MEDIUM",score:m-.5,description:`High-weight relationship (${m.toFixed(2)}) with low confidence (SUSPECTED)`,recommendation:"Verify this relationship - high importance but unconfirmed"}),d==="CONFIRMED"&&m<.2&&n.push({type:"SUSPICIOUS_LINK",nodeIds:[t.source,t.target],severity:"LOW",score:.2-m,description:`Confirmed relationship but very low weight (${m.toFixed(2)})`,recommendation:"May indicate a weak or historical connection"})});const E={CRITICAL:4,HIGH:3,MEDIUM:2,LOW:1};return n.sort((t,m)=>{const d=E[m.severity]-E[t.severity];return d!==0?d:m.score-t.score})}function lt(o,h,n,s){const l=X(n,s),c=[{node:o,path:[o]}],i=new Set([o]);for(;c.length>0;){const{node:f,path:j}=c.shift();if(f===h)return{path:j,distance:j.length-1};const p=l.get(f);if(!p)continue;const E=[...new Set([...p.out,...p.in])];for(const t of E)i.has(t)||(i.add(t),c.push({node:t,path:[...j,t]}))}return null}function dt(o,h,n,s,l=5){const c=X(n,s),i=[];function f(j,p,E){if(E>l)return;if(j===h){i.push([...p]);return}const t=c.get(j);if(!t)return;const m=[...new Set([...t.out,...t.in])];for(const d of m)p.includes(d)||f(d,[...p,d],E+1)}return f(o,[o],0),i}function ht({nodes:o,links:h,onNodeClick:n}){const s=C.useMemo(()=>o.length===0?{nodeCount:0,edgeCount:0,density:0,avgDegree:0,topByDegree:[],topByBetweenness:[],topByCloseness:[],avgClusteringCoefficient:0,componentCount:0,largestComponentSize:0}:Ze(o,h),[o,h]),l=C.useMemo(()=>o.length===0?[]:it(o,h),[o,h]),c=C.useMemo(()=>o.length===0?[]:ct(o,h),[o,h]),i=t=>o.find(d=>d.id===t)?.name||t.substring(0,8),f=t=>t>.5?"text-red-600":t>.2?"text-yellow-600":"text-green-600",j=t=>t>.6?"text-green-600":t>.3?"text-yellow-600":"text-red-600",p=t=>({CRITICAL:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 border-red-300",HIGH:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200 border-orange-300",MEDIUM:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 border-yellow-300",LOW:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 border-blue-300"})[t],E=t=>{switch(t){case"CRITICAL":return e.jsx(Z,{className:"h-4 w-4"});case"HIGH":return e.jsx(Fe,{className:"h-4 w-4"});case"MEDIUM":return e.jsx(q,{className:"h-4 w-4"});case"LOW":return e.jsx(q,{className:"h-4 w-4"})}};return e.jsxs(ne,{className:"h-full overflow-y-auto",children:[e.jsxs(ae,{className:"pb-3",children:[e.jsxs(ie,{className:"flex items-center gap-2 text-lg",children:[e.jsx($e,{className:"h-5 w-5"}),"Network Metrics"]}),e.jsx(Te,{children:"Analysis and patterns"})]}),e.jsx(re,{children:e.jsxs(Ye,{defaultValue:"overview",className:"w-full",children:[e.jsxs(Qe,{className:"grid w-full grid-cols-4",children:[e.jsx(K,{value:"overview",children:"Overview"}),e.jsx(K,{value:"centrality",children:"Centrality"}),e.jsx(K,{value:"patterns",children:"Patterns"}),e.jsx(K,{value:"anomalies",children:"Anomalies"})]}),e.jsxs(J,{value:"overview",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 font-semibold",children:"Nodes"}),e.jsx("div",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:s.nodeCount})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-400 font-semibold",children:"Edges"}),e.jsx("div",{className:"text-2xl font-bold text-purple-900 dark:text-purple-100",children:s.edgeCount})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-green-600 dark:text-green-400 font-semibold",children:"Components"}),e.jsx("div",{className:"text-2xl font-bold text-green-900 dark:text-green-100",children:s.componentCount})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-orange-600 dark:text-orange-400 font-semibold",children:"Avg Degree"}),e.jsx("div",{className:"text-2xl font-bold text-orange-900 dark:text-orange-100",children:s.avgDegree.toFixed(1)})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Network Density"}),e.jsxs("span",{className:`font-semibold ${f(s.density)}`,children:[(s.density*100).toFixed(1),"%"]})]}),e.jsx(ce,{value:s.density*100,className:"h-2"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.density<.2?"Sparse network":s.density<.5?"Moderate connectivity":"Dense network"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Clustering Coefficient"}),e.jsx("span",{className:`font-semibold ${j(s.avgClusteringCoefficient)}`,children:s.avgClusteringCoefficient.toFixed(2)})]}),e.jsx(ce,{value:s.avgClusteringCoefficient*100,className:"h-2"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.avgClusteringCoefficient>.6?"High clustering":s.avgClusteringCoefficient>.3?"Moderate clustering":"Low clustering"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Largest Component"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-lg font-bold",children:s.largestComponentSize}),e.jsxs($,{variant:"secondary",children:[s.nodeCount>0?(s.largestComponentSize/s.nodeCount*100).toFixed(0):0,"% of network"]})]})]})]})]}),e.jsxs(J,{value:"centrality",className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2 mb-2",children:[e.jsx(Me,{className:"h-4 w-4"}),"Top Nodes by Degree"]}),e.jsx("div",{className:"space-y-2",children:s.topByDegree.slice(0,5).map((t,m)=>e.jsxs("div",{className:"flex items-center justify-between text-sm hover:bg-gray-50 dark:hover:bg-gray-800 p-2 rounded cursor-pointer",onClick:()=>n?.(t.id),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{variant:"outline",className:"w-6 h-6 flex items-center justify-center p-0",children:m+1}),e.jsx("span",{className:"font-medium",children:i(t.id)})]}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[t.value," connections"]})]},t.id))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2 mb-2",children:[e.jsx(Be,{className:"h-4 w-4"}),"Top Nodes by Betweenness"]}),e.jsx("div",{className:"space-y-2",children:s.topByBetweenness.slice(0,5).map((t,m)=>e.jsxs("div",{className:"flex items-center justify-between text-sm hover:bg-gray-50 dark:hover:bg-gray-800 p-2 rounded cursor-pointer",onClick:()=>n?.(t.id),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{variant:"outline",className:"w-6 h-6 flex items-center justify-center p-0",children:m+1}),e.jsx("span",{className:"font-medium",children:i(t.id)})]}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.value.toFixed(3)})]},t.id))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-2 mb-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"Top Nodes by Closeness"]}),e.jsx("div",{className:"space-y-2",children:s.topByCloseness.slice(0,5).map((t,m)=>e.jsxs("div",{className:"flex items-center justify-between text-sm hover:bg-gray-50 dark:hover:bg-gray-800 p-2 rounded cursor-pointer",onClick:()=>n?.(t.id),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{variant:"outline",className:"w-6 h-6 flex items-center justify-center p-0",children:m+1}),e.jsx("span",{className:"font-medium",children:i(t.id)})]}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.value.toFixed(3)})]},t.id))})]})]}),e.jsxs(J,{value:"patterns",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400 mb-3",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsxs("span",{children:["Detected ",l.length," patterns"]})]}),l.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(q,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No significant patterns detected"}),e.jsx("p",{className:"text-xs mt-1",children:"Try adjusting filters or add more entities"})]}):e.jsx("div",{className:"space-y-3",children:l.slice(0,10).map((t,m)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx($,{variant:t.type==="TRIANGLE"?"default":"secondary",className:"text-xs",children:t.type}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Sig: ",(t.significance*100).toFixed(0),"%"]})]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.nodes.slice(0,5).map(d=>e.jsx($,{variant:"outline",className:"text-xs cursor-pointer",onClick:()=>n?.(d),children:i(d)},d)),t.nodes.length>5&&e.jsxs($,{variant:"outline",className:"text-xs",children:["+",t.nodes.length-5," more"]})]})]},m))})]}),e.jsxs(J,{value:"anomalies",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-400",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsxs("span",{children:["Detected ",c.length," anomalies"]})]}),c.some(t=>t.severity==="CRITICAL"||t.severity==="HIGH")&&e.jsx($,{variant:"destructive",className:"text-xs",children:"Action Required"})]}),c.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Z,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No anomalies detected"}),e.jsx("p",{className:"text-xs mt-1",children:"Network structure appears normal"})]}):e.jsxs("div",{className:"space-y-3",children:[c.slice(0,15).map((t,m)=>e.jsxs("div",{className:`border rounded-lg p-3 ${p(t.severity)}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[E(t.severity),e.jsx($,{variant:"outline",className:"text-xs",children:t.type.replace(/_/g," ")})]}),e.jsx($,{className:"text-xs",children:t.severity})]}),e.jsx("p",{className:"text-sm font-medium mb-1",children:t.description}),e.jsxs("p",{className:"text-xs opacity-90 mb-2",children:["ðŸ’¡ ",t.recommendation]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[t.nodeIds.slice(0,3).map(d=>e.jsx($,{variant:"secondary",className:"text-xs cursor-pointer",onClick:()=>n?.(d),children:i(d)},d)),t.nodeIds.length>3&&e.jsxs($,{variant:"secondary",className:"text-xs",children:["+",t.nodeIds.length-3," more"]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"text-xs opacity-75",children:["Score: ",(t.score*100).toFixed(0),"%"]})})]},m)),c.length>15&&e.jsxs("div",{className:"text-center text-xs text-gray-500 pt-2",children:["+",c.length-15," more anomalies"]})]})]})]})})]})}function mt({open:o,onOpenChange:h,nodes:n,links:s,onPathSelect:l}){const[c,i]=C.useState(""),[f,j]=C.useState(""),[p,E]=C.useState(null),[t,m]=C.useState(null),[d,a]=C.useState(!1),r=C.useMemo(()=>c?n.filter(x=>x.name.toLowerCase().includes(c.toLowerCase())).slice(0,10):[],[n,c]),w=C.useMemo(()=>f?n.filter(x=>x.name.toLowerCase().includes(f.toLowerCase())).slice(0,10):[],[n,f]),g=C.useMemo(()=>{if(!p||!t)return null;if(d)return{type:"multiple",paths:dt(p,t,n,s,5).slice(0,10)};{const x=lt(p,t,n,s);return x?{type:"single",path:x.path,distance:x.distance}:null}},[p,t,n,s,d]),b=x=>n.find(R=>R.id===x)?.name||x.substring(0,8),v=x=>{E(x),i(b(x))},I=x=>{m(x),j(b(x))},O=()=>{i(""),j(""),E(null),m(null),a(!1)};return e.jsx(he,{open:o,onOpenChange:h,children:e.jsxs(me,{className:"sm:max-w-2xl",children:[e.jsxs(xe,{children:[e.jsxs(pe,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5"}),"Path Finder"]}),e.jsx(ge,{children:"Find connection paths between two entities"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"Source Entity"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-2 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(ee,{placeholder:"Search source entity...",value:c,onChange:x=>i(x.target.value),className:"pl-8"})]}),r.length>0&&!p&&e.jsx("div",{className:"border rounded-md max-h-40 overflow-y-auto",children:r.map(x=>e.jsx("div",{className:"px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer text-sm",onClick:()=>v(x.id),children:x.name},x.id))}),p&&e.jsxs($,{variant:"secondary",className:"mt-2",children:["Selected: ",b(p)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{children:"Target Entity"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-2 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(ee,{placeholder:"Search target entity...",value:f,onChange:x=>j(x.target.value),className:"pl-8"})]}),w.length>0&&!t&&e.jsx("div",{className:"border rounded-md max-h-40 overflow-y-auto",children:w.map(x=>e.jsx("div",{className:"px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer text-sm",onClick:()=>I(x.id),children:x.name},x.id))}),t&&e.jsxs($,{variant:"secondary",className:"mt-2",children:["Selected: ",b(t)]})]}),p&&t&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(B,{variant:d?"default":"outline",size:"sm",onClick:()=>a(!d),children:d?"Show Shortest Only":"Show All Paths"}),e.jsx(B,{variant:"outline",size:"sm",onClick:O,children:"Reset"})]}),g&&e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 dark:bg-gray-800",children:[g.type==="single"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:"Shortest Path"}),e.jsxs($,{children:["Distance: ",g.distance," hops"]})]}),e.jsx("div",{className:"flex items-center flex-wrap gap-2",children:g.path.map((x,N)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{variant:"outline",className:"cursor-pointer",onClick:()=>l?.([x]),children:b(x)}),N<g.path.length-1&&e.jsx(oe,{className:"h-4 w-4 text-gray-400"})]},N))}),e.jsx(B,{className:"w-full mt-3",onClick:()=>l?.(g.path),children:"Highlight Path in Graph"})]}),g.type==="multiple"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:"Found Paths"}),e.jsxs($,{children:[g.paths.length," paths"]})]}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:g.paths.map((x,N)=>e.jsxs("div",{className:"border rounded p-2 hover:bg-white dark:hover:bg-gray-700 cursor-pointer",onClick:()=>l?.(x),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-xs font-semibold",children:["Path ",N+1]}),e.jsxs($,{variant:"secondary",className:"text-xs",children:[x.length-1," hops"]})]}),e.jsx("div",{className:"flex items-center flex-wrap gap-1 text-xs",children:x.map((R,y)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:b(R)}),y<x.length-1&&e.jsx(oe,{className:"h-3 w-3 text-gray-400"})]},y))})]},N))})]})]}),p&&t&&!g&&e.jsxs("div",{className:"border rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900/20 text-center",children:[e.jsx(q,{className:"h-8 w-8 text-yellow-600 dark:text-yellow-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"No path found between these entities"}),e.jsx("p",{className:"text-xs text-yellow-600 dark:text-yellow-400 mt-1",children:"They may be in different network components"})]})]}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(B,{variant:"outline",onClick:()=>h(!1),children:"Close"})})]})})}const xt={CONFIRMED:3,PROBABLE:2,POSSIBLE:1,SUSPECTED:0};function Tt(){const o=be(),h=we(),[n]=Ee(),[s,l]=C.useState([]),[c,i]=C.useState({}),[f,j]=C.useState(!0),[p,E]=C.useState(null),[t,m]=C.useState({width:800,height:600}),[d,a]=C.useState(!1),[r,w]=C.useState(!1),[g,b]=C.useState(!0),[v,I]=C.useState([]),[O,x]=C.useState(new Set),[N,R]=C.useState(null),[y,k]=C.useState({entityTypes:new Set(["ACTOR","SOURCE","EVENT","PLACE","BEHAVIOR","EVIDENCE"]),minConfidence:0,searchQuery:"",showLabels:!0});C.useEffect(()=>{const M=h.state?.highlightEntities,A=h.state?.source,z=n.get("highlight"),S=n.get("source"),D=n.get("title"),L=M||(z?z.split(","):[]),u=A||S;L.length>0&&x(new Set(L)),u&&R({type:u,title:D||void 0})},[h.state,n]),C.useEffect(()=>{(async()=>{j(!0);try{const A=localStorage.getItem("currentWorkspaceId")||"default",z=await fetch(`/api/relationships?workspace_id=${A}`);if(z.ok){const S=await z.json();l(S.relationships||[]);const D={ACTOR:new Set,SOURCE:new Set,EVENT:new Set,PLACE:new Set,BEHAVIOR:new Set,EVIDENCE:new Set};S.relationships.forEach(u=>{D[u.source_entity_type].add(u.source_entity_id),D[u.target_entity_type].add(u.target_entity_id)});const L={};if(D.ACTOR.size>0)try{const u=await fetch(`/api/actors?workspace_id=${A}`);if(u.ok){const F=await u.json(),U=D.ACTOR;F.actors?.forEach(_=>{U.has(_.id)&&(L[_.id]={name:_.name,type:"ACTOR"})})}}catch(u){console.error("Failed to load actor names:",u)}if(D.EVENT.size>0)try{const u=await fetch(`/api/events?workspace_id=${A}`);if(u.ok){const F=await u.json(),U=D.EVENT;F.events?.forEach(_=>{U.has(_.id)&&(L[_.id]={name:_.title,type:"EVENT"})})}}catch(u){console.error("Failed to load event names:",u)}if(D.SOURCE.size>0)try{const u=await fetch(`/api/sources?workspace_id=${A}`);if(u.ok){const F=await u.json(),U=D.SOURCE;F.sources?.forEach(_=>{U.has(_.id)&&(L[_.id]={name:_.name,type:"SOURCE"})})}}catch(u){console.error("Failed to load source names:",u)}if(D.PLACE.size>0)try{const u=await fetch(`/api/places?workspace_id=${A}`);if(u.ok){const F=await u.json(),U=D.PLACE;F.places?.forEach(_=>{U.has(_.id)&&(L[_.id]={name:_.name,type:"PLACE"})})}}catch(u){console.error("Failed to load place names:",u)}if(D.BEHAVIOR.size>0)try{const u=await fetch(`/api/behaviors?workspace_id=${A}`);if(u.ok){const F=await u.json(),U=D.BEHAVIOR;F.behaviors?.forEach(_=>{U.has(_.id)&&(L[_.id]={name:_.title,type:"BEHAVIOR"})})}}catch(u){console.error("Failed to load behavior names:",u)}if(D.EVIDENCE.size>0)try{const u=await fetch(`/api/evidence-items?workspace_id=${A}`);if(u.ok){const F=await u.json(),U=D.EVIDENCE;F.evidence?.forEach(_=>{U.has(_.id)&&(L[_.id]={name:_.title,type:"EVIDENCE"})})}}catch(u){console.error("Failed to load evidence names:",u)}S.relationships.forEach(u=>{L[u.source_entity_id]||(L[u.source_entity_id]={name:`${u.source_entity_type.substring(0,1)}${u.source_entity_id.substring(0,6)}`,type:u.source_entity_type}),L[u.target_entity_id]||(L[u.target_entity_id]={name:`${u.target_entity_type.substring(0,1)}${u.target_entity_id.substring(0,6)}`,type:u.target_entity_type})}),i(L)}}catch(A){console.error("Failed to load relationships:",A)}finally{j(!1)}})()},[]),C.useEffect(()=>{const M=()=>{const A=document.getElementById("graph-container");A&&m({width:A.clientWidth,height:A.clientHeight})};return M(),window.addEventListener("resize",M),()=>window.removeEventListener("resize",M)},[]);const T=C.useMemo(()=>{const M=s.filter(S=>{if(!y.entityTypes.has(S.source_entity_type)||!y.entityTypes.has(S.target_entity_type)||xt[S.confidence||"SUSPECTED"]<y.minConfidence)return!1;if(y.searchQuery){const L=y.searchQuery.toLowerCase(),u=c[S.source_entity_id]?.name.toLowerCase()||"",F=c[S.target_entity_id]?.name.toLowerCase()||"";if(!u.includes(L)&&!F.includes(L))return!1}return!0}),A=new Map;M.forEach(S=>{if(!A.has(S.source_entity_id)){const D=c[S.source_entity_id];A.set(S.source_entity_id,{id:S.source_entity_id,name:D?.name||S.source_entity_id.substring(0,8),entityType:S.source_entity_type,val:1})}if(!A.has(S.target_entity_id)){const D=c[S.target_entity_id];A.set(S.target_entity_id,{id:S.target_entity_id,name:D?.name||S.target_entity_id.substring(0,8),entityType:S.target_entity_type,val:1})}}),M.forEach(S=>{const D=A.get(S.source_entity_id),L=A.get(S.target_entity_id);D&&(D.val=(D.val||0)+1),L&&(L.val=(L.val||0)+1)});const z=M.map(S=>({source:S.source_entity_id,target:S.target_entity_id,relationshipType:S.relationship_type,weight:S.weight,confidence:S.confidence}));return{nodes:Array.from(A.values()),links:z}},[s,c,y]),Y=M=>{E(M)},je=()=>{E(null)},Ne=()=>{if(!p)return;const M={ACTOR:`/dashboard/entities/actors/${p.id}`,SOURCE:`/dashboard/entities/sources/${p.id}`,EVENT:`/dashboard/entities/events/${p.id}`,PLACE:`/dashboard/entities/places/${p.id}`,BEHAVIOR:`/dashboard/entities/behaviors/${p.id}`,EVIDENCE:`/dashboard/entities/evidence/${p.id}`};o(M[p.entityType]||"/dashboard")},ve=M=>{const A=T.nodes.find(z=>z.id===M);A&&E(A)};return f?e.jsx("div",{className:"h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ue,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"Loading network graph..."})]})}):e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(B,{variant:"outline",onClick:()=>o("/dashboard"),children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Network Graph"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Interactive entity relationship visualization",O.size>0&&` â€¢ ${O.size} entities highlighted`]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(B,{variant:g?"default":"outline",onClick:()=>b(!g),children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),g?"Hide":"Show"," Metrics"]}),e.jsxs(B,{variant:"outline",onClick:()=>w(!0),children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Find Path"]}),e.jsxs(B,{variant:"outline",onClick:()=>a(!0),children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Export"]})]})]})}),N&&e.jsx("div",{className:"px-6 pt-4",children:e.jsxs(Se,{children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsxs(Ie,{children:["Viewing entities from"," ",e.jsxs("strong",{children:[N.type==="cog"&&"COG Analysis",N.type==="causeway"&&"Causeway Analysis",N.type==="framework"&&"Framework"]}),N.title&&`: ${N.title}`," â€¢ ",O.size," ",O.size===1?"entity":"entities"," highlighted"]})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"w-80 bg-white border-r overflow-y-auto",children:e.jsx(Ke,{filters:y,onFiltersChange:k,totalNodes:T.nodes.length,totalEdges:T.links.length})}),e.jsx("div",{className:"flex-1 relative",id:"graph-container",children:e.jsx(qe,{nodes:T.nodes,links:T.links,onNodeClick:Y,onBackgroundClick:je,width:t.width,height:t.height,highlightedPath:v,highlightedNodes:O})}),g&&!p&&e.jsx("div",{className:"w-80 bg-white border-l overflow-y-auto",children:e.jsx(ht,{nodes:T.nodes,links:T.links,onNodeClick:ve})}),p&&e.jsx("div",{className:"w-80 bg-white border-l overflow-y-auto",children:e.jsxs(ne,{className:"h-full rounded-none border-0",children:[e.jsx(ae,{children:e.jsx(ie,{children:"Selected Node"})}),e.jsxs(re,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Name"}),e.jsx("div",{className:"font-semibold",children:p.name})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Type"}),e.jsx($,{children:p.entityType})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"ID"}),e.jsx("div",{className:"text-xs font-mono text-gray-600",children:p.id})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"Connections"}),e.jsx("div",{className:"font-semibold",children:p.val||0})]}),e.jsx(B,{onClick:Ne,className:"w-full",children:"View Details"}),e.jsx(B,{variant:"outline",onClick:()=>E(null),className:"w-full",children:"Close"})]})]})})]}),e.jsx(Je,{open:d,onOpenChange:a,nodes:T.nodes,links:T.links,filters:{entity_types:Array.from(y.entityTypes),min_confidence:y.minConfidence,search_query:y.searchQuery}}),e.jsx(mt,{open:r,onOpenChange:w,nodes:T.nodes,links:T.links,onPathSelect:M=>{I(M),w(!1)}})]})}export{Tt as NetworkGraphPage};
