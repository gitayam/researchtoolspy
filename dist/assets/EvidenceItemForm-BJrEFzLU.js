import{j as e}from"./ui-vendor-DBphXmDA.js";import{r as d}from"./react-vendor-CfYLSWvh.js";import{l as Y,m as Z,n as ee,o as se,y as n,I as o,q as M,S as x,z as m,C as j,E as u,N as re,O as ae,F as l,B as k,e as p}from"./index-QqleixXe.js";import{C as g,a as y,b as _,c as f,d as b}from"./card-BGAig-Dv.js";import{S as O}from"./slider-B52ikc1m.js";import{c as ne,d as te,S as ie,e as ce,P as le}from"./evidence-CClaHnJf.js";import{c as G,aj as oe,T as de,W as he,X as B,U as xe}from"./icons-x9tcvtYN.js";function fe({open:z,onClose:I,onSave:K,initialData:a,mode:W}){const[H,R]=d.useState(!1),[me,D]=d.useState([]),[w,L]=d.useState(""),[N,P]=d.useState(!1),[C,q]=d.useState([]),[V,U]=d.useState(!1),[r,A]=d.useState({title:"",description:"",who:"",what:"",when_occurred:"",where_location:"",why_purpose:"",how_method:"",source_classification:"primary",source_name:"",source_url:"",source_id:"",evidence_type:"news_article",evidence_level:"tactical",category:"",credibility:"3",reliability:"C",confidence_level:"medium",eve_assessment:{internal_consistency:3,external_corroboration:3,anomaly_detection:0,notes:""},tags:[],priority:"normal",citations:[],linked_actors:[]});d.useEffect(()=>{(async()=>{U(!0);try{const i=localStorage.getItem("omnicore_user_hash"),c=await fetch("/api/actors",{headers:{...i&&{Authorization:`Bearer ${i}`}}});if(c.ok){const v=await c.json();q(v.actors.map(E=>({id:E.id,name:E.name})))}}catch(i){console.error("Failed to load actors:",i)}finally{U(!1)}})()},[]),d.useEffect(()=>{a&&(A({title:a.title,description:a.description||"",who:a.who||"",what:a.what||"",when_occurred:a.when_occurred||"",where_location:a.where_location||"",why_purpose:a.why_purpose||"",how_method:a.how_method||"",source_classification:a.source_classification||"primary",source_name:a.source_name||"",source_url:a.source_url||"",source_id:a.source_id||"",evidence_type:a.evidence_type,evidence_level:a.evidence_level,category:a.category||"",credibility:a.credibility,reliability:a.reliability,confidence_level:a.confidence_level,eve_assessment:a.eve_assessment?{internal_consistency:a.eve_assessment.internal_consistency,external_corroboration:a.eve_assessment.external_corroboration,anomaly_detection:a.eve_assessment.anomaly_detection,notes:a.eve_assessment.notes}:{internal_consistency:3,external_corroboration:3,anomaly_detection:0,notes:""},tags:a.tags||[],priority:a.priority,linked_actors:a.linked_actors||[]}),a.citations&&D(a.citations.map(s=>s.dataset_id)),a.eve_assessment&&P(!0))},[a]);const t=(s,i)=>{A(c=>({...c,[s]:i}))},S=(s,i)=>{A(c=>({...c,eve_assessment:{...c.eve_assessment,[s]:i}}))},F=()=>{w.trim()&&!r.tags.includes(w.trim())&&(t("tags",[...r.tags,w.trim()]),L(""))},$=s=>{t("tags",r.tags.filter(i=>i!==s))},h=()=>{if(!r.eve_assessment)return"UNKNOWN";const{internal_consistency:s,external_corroboration:i,anomaly_detection:c}=r.eve_assessment,v=(5-s)/5*100,E=(5-i)/5*100,Q=c/5*100,T=(v+E+Q)/3;return T<25?"LOW":T<50?"MEDIUM":T<75?"HIGH":"CRITICAL"},X=s=>{switch(s){case"LOW":return"text-green-600 bg-green-50 border-green-200";case"MEDIUM":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"HIGH":return"text-orange-600 bg-orange-50 border-orange-200";case"CRITICAL":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},J=async()=>{if(!r.title.trim()||!r.evidence_type){alert("Please provide a title and evidence type");return}R(!0);try{const s={...r,eve_assessment:N&&r.eve_assessment?{...r.eve_assessment,assessed_at:new Date().toISOString(),overall_risk:h()}:void 0};await K(s),I()}catch(s){console.error("Failed to save evidence:",s),alert("Failed to save evidence. Please try again.")}finally{R(!1)}};return e.jsx(Y,{open:z,onOpenChange:I,children:e.jsxs(Z,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ee,{children:[e.jsx(se,{children:W==="create"?"Add New Evidence":"Edit Evidence"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Document and evaluate evidence using investigative journalism standards"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(g,{children:[e.jsxs(y,{children:[e.jsx(_,{children:"What is this evidence?"}),e.jsx(f,{children:"Identify the type and credibility of this specific piece of evidence"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Title *"}),e.jsx(o,{value:r.title,onChange:s=>t("title",s.target.value),placeholder:"Brief title for this evidence..."})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Description"}),e.jsx(M,{value:r.description,onChange:s=>t("description",s.target.value),placeholder:"Detailed description...",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Evidence Type *"}),e.jsxs(x,{value:r.evidence_type,onValueChange:s=>t("evidence_type",s),children:[e.jsx(m,{children:e.jsx(j,{placeholder:"Select type"})}),e.jsx(u,{children:Object.entries(ne).map(([s,i])=>e.jsxs(re,{children:[e.jsx(ae,{children:s}),i.map(c=>e.jsx(l,{value:c,children:c.replace(/_/g," ").replace(/\b\w/g,v=>v.toUpperCase())},c))]},s))})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:te[r.evidence_type]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Information Credibility *"}),e.jsxs(x,{value:r.credibility,onValueChange:s=>t("credibility",s),children:[e.jsx(m,{children:e.jsx(j,{placeholder:"How credible is this information?"})}),e.jsxs(u,{children:[e.jsx(l,{value:"1",children:"1 - Confirmed by other sources"}),e.jsx(l,{value:"2",children:"2 - Probably true"}),e.jsx(l,{value:"3",children:"3 - Possibly true"}),e.jsx(l,{value:"4",children:"4 - Doubtful"}),e.jsx(l,{value:"5",children:"5 - Improbable"}),e.jsx(l,{value:"6",children:"6 - Cannot be judged"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How credible is THIS specific piece of information? (1=Confirmed → 6=Cannot judge)"})]})]})]})]}),e.jsxs(g,{children:[e.jsxs(y,{children:[e.jsx(_,{children:"Where did it come from?"}),e.jsx(f,{children:"Document the source and assess its general reliability"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Source Classification *"}),e.jsxs(x,{value:r.source_classification,onValueChange:s=>t("source_classification",s),children:[e.jsx(m,{children:e.jsx(j,{})}),e.jsx(u,{children:Object.entries(ie).map(([s,i])=>e.jsx(l,{value:i,children:s},i))})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:ce[r.source_classification]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Source Reliability *"}),e.jsxs(x,{value:r.reliability,onValueChange:s=>t("reliability",s),children:[e.jsx(m,{children:e.jsx(j,{placeholder:"How reliable is the source?"})}),e.jsxs(u,{children:[e.jsx(l,{value:"A",children:"A - Completely reliable"}),e.jsx(l,{value:"B",children:"B - Usually reliable"}),e.jsx(l,{value:"C",children:"C - Fairly reliable"}),e.jsx(l,{value:"D",children:"D - Not usually reliable"}),e.jsx(l,{value:"E",children:"E - Unreliable"}),e.jsx(l,{value:"F",children:"F - Cannot be judged"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How reliable is this SOURCE in general? (A=Completely reliable → F=Cannot judge)"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Source Name *"}),e.jsx(o,{value:r.source_name,onChange:s=>t("source_name",s.target.value),placeholder:"Name of source, publication, or person..."})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Source URL"}),e.jsx(o,{value:r.source_url,onChange:s=>t("source_url",s.target.value),placeholder:"https://..."})]})]})]})]}),e.jsxs(g,{children:[e.jsxs(y,{children:[e.jsx(_,{children:"The Details"}),e.jsx(f,{children:"Answer the fundamental questions: Who, What, When, Where, Why, and How"})]}),e.jsx(b,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Who"}),e.jsx(o,{value:r.who,onChange:s=>t("who",s.target.value),placeholder:"Person, entity, or actor involved..."})]}),e.jsxs("div",{children:[e.jsx(n,{children:"What"}),e.jsx(o,{value:r.what,onChange:s=>t("what",s.target.value),placeholder:"What happened or what is it..."})]}),e.jsxs("div",{children:[e.jsx(n,{children:"When"}),e.jsx(o,{value:r.when_occurred,onChange:s=>t("when_occurred",s.target.value),placeholder:"When it occurred (date/time)..."})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Where"}),e.jsx(o,{value:r.where_location,onChange:s=>t("where_location",s.target.value),placeholder:"Location, coordinates, place..."})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Why"}),e.jsx(o,{value:r.why_purpose,onChange:s=>t("why_purpose",s.target.value),placeholder:"Purpose or reason..."})]}),e.jsxs("div",{children:[e.jsx(n,{children:"How"}),e.jsx(o,{value:r.how_method,onChange:s=>t("how_method",s.target.value),placeholder:"Method or process..."})]})]})})]}),e.jsxs(g,{className:"border-2",children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(_,{className:"text-base flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-blue-600"}),"Is it authentic?"]}),e.jsx(f,{children:"EVE Deception Assessment - Evaluate if this evidence might be fake, manipulated, or misleading"})]}),e.jsx(k,{type:"button",variant:"outline",size:"sm",onClick:()=>P(!N),children:N?"Hide Assessment":"Show Assessment"})]})}),N&&r.eve_assessment&&e.jsxs(b,{className:"space-y-6",children:[e.jsx("div",{className:`p-4 rounded-lg border-2 ${X(h())}`,children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[h()==="LOW"&&e.jsx(oe,{className:"h-5 w-5"}),h()==="MEDIUM"&&e.jsx(G,{className:"h-5 w-5"}),(h()==="HIGH"||h()==="CRITICAL")&&e.jsx(de,{className:"h-5 w-5"}),e.jsxs("span",{className:"font-semibold",children:["Overall Deception Risk: ",h()]})]})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-base font-semibold",children:"Internal Consistency"}),e.jsxs(p,{variant:"outline",className:"text-base",children:[r.eve_assessment.internal_consistency,"/5"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Does the evidence contradict itself? Does the story hold together internally? Higher scores = more consistent.",e.jsx("strong",{className:"text-orange-600",children:" LOW SCORE = HIGH DECEPTION RISK"})]}),e.jsx(O,{value:[r.eve_assessment.internal_consistency],onValueChange:([s])=>S("internal_consistency",s),min:0,max:5,step:1,className:"py-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"0 - Contradictory"}),e.jsx("span",{children:"3 - Somewhat consistent"}),e.jsx("span",{children:"5 - Perfectly consistent"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-base font-semibold",children:"External Corroboration"}),e.jsxs(p,{variant:"outline",className:"text-base",children:[r.eve_assessment.external_corroboration,"/5"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Is this evidence supported by other independent sources? Can you verify it elsewhere? Higher scores = more corroboration.",e.jsx("strong",{className:"text-orange-600",children:" LOW SCORE = HIGH DECEPTION RISK"})]}),e.jsx(O,{value:[r.eve_assessment.external_corroboration],onValueChange:([s])=>S("external_corroboration",s),min:0,max:5,step:1,className:"py-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"0 - No corroboration"}),e.jsx("span",{children:"3 - Some support"}),e.jsx("span",{children:"5 - Multiple independent sources"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-base font-semibold",children:"Anomaly Detection"}),e.jsxs(p,{variant:"outline",className:"text-base",children:[r.eve_assessment.anomaly_detection,"/5"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Does this evidence contain unusual patterns, red flags, or inconsistencies? Signs of manipulation, deepfakes, doctored images, or suspicious metadata?",e.jsx("strong",{className:"text-red-600",children:" HIGH SCORE = HIGH DECEPTION RISK"})]}),e.jsx(O,{value:[r.eve_assessment.anomaly_detection],onValueChange:([s])=>S("anomaly_detection",s),min:0,max:5,step:1,className:"py-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:"0 - No anomalies"}),e.jsx("span",{children:"3 - Some red flags"}),e.jsx("span",{children:"5 - Major anomalies detected"})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Assessment Notes"}),e.jsx(M,{value:r.eve_assessment.notes,onChange:s=>S("notes",s.target.value),placeholder:"Document specific red flags, concerns, verification attempts, or supporting evidence you've found...",rows:4})]})]})]}),e.jsxs(g,{children:[e.jsxs(y,{children:[e.jsx(_,{children:"Organize"}),e.jsx(f,{children:"Add tags and set priority for this evidence"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Tags"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(o,{value:w,onChange:s=>L(s.target.value),onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),F()),placeholder:"Add a tag..."}),e.jsxs(k,{onClick:F,size:"sm",type:"button",children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"Add"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:r.tags.map(s=>e.jsxs(p,{variant:"secondary",className:"cursor-pointer",onClick:()=>$(s),children:[s,e.jsx(B,{className:"h-3 w-3 ml-1"})]},s))})]}),e.jsxs("div",{children:[e.jsx(n,{children:"Priority"}),e.jsxs(x,{value:r.priority,onValueChange:s=>t("priority",s),children:[e.jsx(m,{children:e.jsx(j,{})}),e.jsx(u,{children:Object.values(le).map(s=>e.jsx(l,{value:s,children:s.toUpperCase()},s))})]})]}),e.jsxs("div",{children:[e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"Linked Actors"]}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Link this evidence to specific actors (people, organizations, units)"}),e.jsxs(x,{value:"",onValueChange:s=>{s&&!r.linked_actors?.includes(s)&&t("linked_actors",[...r.linked_actors||[],s])},disabled:V||C.length===0,children:[e.jsx(m,{children:e.jsx(j,{placeholder:V?"Loading actors...":C.length===0?"No actors available":"Select actor..."})}),e.jsx(u,{children:C.filter(s=>!r.linked_actors?.includes(s.id)).map(s=>e.jsx(l,{value:s.id,children:s.name},s.id))})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:r.linked_actors?.map(s=>{const i=C.find(c=>c.id===s);return e.jsxs(p,{variant:"secondary",className:"cursor-pointer",onClick:()=>{t("linked_actors",r.linked_actors?.filter(c=>c!==s)||[])},children:[i?.name||s,e.jsx(B,{className:"h-3 w-3 ml-1"})]},s)})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(k,{variant:"outline",onClick:I,disabled:H,children:"Cancel"}),e.jsx(k,{onClick:J,disabled:H,children:H?"Saving...":W==="create"?"Add Evidence":"Update Evidence"})]})]})]})})}export{fe as E};
