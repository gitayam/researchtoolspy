import{j as e}from"./ui-vendor-DBphXmDA.js";import{f as re,r as l}from"./react-vendor-CfYLSWvh.js";import{d as M,l as P,H,B as h,m as V,n as z,o as B,p as Y,y as v,I as q,S as b,z as w,C as N,E as C,F as r,e as S}from"./index-DGGXJgUa.js";import{C as k,d as f,a as L,b as W,c as F}from"./card-BQo7RV_Z.js";import{A as ne,a as ie}from"./avatar-C4QoRcp0.js";import{g as J}from"./hash-auth-C-5ASbCe.js";import{W as G,U as $,Q as le,Y as ce,P as oe,E as de,q as he,c as xe}from"./icons-x9tcvtYN.js";import"./state-vendor-BXB5jEEt.js";function ue({onWorkspaceCreated:c}){re();const{toast:d}=M(),[E,t]=l.useState(!1),[u,m]=l.useState(!1),[n,p]=l.useState({name:"",type:"TEAM"}),T=()=>{let i=localStorage.getItem("omnicore_user_hash");return(!i||i==="guest")&&(i=J(),localStorage.setItem("omnicore_user_hash",i),localStorage.setItem("omnicore_authenticated","true"),d({title:"Account Created",description:"Your bookmark account has been created. Save this URL to access your work!"})),i},D=async i=>{if(i.preventDefault(),!n.name.trim()){d({title:"Validation Error",description:"Workspace name is required",variant:"destructive"});return}m(!0);try{const j=T(),g=await fetch("/api/workspaces",{method:"POST",headers:{"Content-Type":"application/json","X-User-Hash":j},body:JSON.stringify({name:n.name,type:n.type})});if(!g.ok){const x=await g.json();throw new Error(x.error||"Failed to create workspace")}const o=await g.json();d({title:"Workspace Created",description:`${n.name} has been created successfully`}),t(!1),p({name:"",type:"TEAM"}),localStorage.setItem("omnicore_workspace_id",o.id),c?c():window.location.reload()}catch(j){d({title:"Error",description:j instanceof Error?j.message:"Failed to create workspace",variant:"destructive"})}finally{m(!1)}};return e.jsxs(P,{open:E,onOpenChange:t,children:[e.jsx(H,{asChild:!0,children:e.jsxs(h,{size:"lg",children:[e.jsx(G,{className:"h-5 w-5 mr-2"}),"Create Workspace"]})}),e.jsxs(V,{children:[e.jsxs(z,{children:[e.jsx(B,{children:"Create New Workspace"}),e.jsx(Y,{children:"Set up a workspace to collaborate with your investigation team"})]}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"workspace-name",children:"Workspace Name *"}),e.jsx(q,{id:"workspace-name",placeholder:"e.g., Enemy COG Investigation, Threat Analysis Team",value:n.name,onChange:i=>p({...n,name:i.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"workspace-type",children:"Workspace Type"}),e.jsxs(b,{value:n.type,onValueChange:i=>p({...n,type:i}),children:[e.jsx(w,{id:"workspace-type",children:e.jsx(N,{})}),e.jsxs(C,{children:[e.jsx(r,{value:"PERSONAL",children:"Personal (Private)"}),e.jsx(r,{value:"TEAM",children:"Team (Invite-only)"}),e.jsx(r,{value:"PUBLIC",children:"Public (Anyone can view)"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.type==="PERSONAL"&&"Only you can access this workspace",n.type==="TEAM"&&"Invite team members to collaborate",n.type==="PUBLIC"&&"Anyone with the link can view (read-only)"]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:[e.jsx("strong",{children:"Note:"})," If you're using guest mode, creating a workspace will generate a bookmark account hash for you. Make sure to save your browser URL to access your workspace again!"]})}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>t(!1),className:"flex-1",children:"Cancel"}),e.jsx(h,{type:"submit",disabled:u,className:"flex-1",children:u?"Creating...":"Create Workspace"})]})]})]})]})}function be(){const{toast:c}=M(),[d,E]=l.useState([]),[t,u]=l.useState(null),[m,n]=l.useState([]),[p,T]=l.useState([]),[D,i]=l.useState(!0),[j,g]=l.useState(!1),[o,x]=l.useState({default_role:"VIEWER",max_uses:null,expires_in_hours:null,label:null});l.useEffect(()=>{X(),O()},[]);const X=()=>{let s=localStorage.getItem("omnicore_user_hash");return(!s||s==="guest")&&(s=J(),localStorage.setItem("omnicore_user_hash",s),localStorage.setItem("omnicore_authenticated","true"),c({title:"Account Created",description:"Your bookmark account has been created. Save this URL to access your workspace!"})),s};l.useEffect(()=>{t&&(Q(),A())},[t]);const O=async()=>{try{const s=localStorage.getItem("omnicore_user_hash"),a={};if(s&&s!=="guest")a["X-User-Hash"]=s;else{const y=localStorage.getItem("auth_token");y&&(a.Authorization=`Bearer ${y}`)}const _=await fetch("/api/workspaces",{headers:a});if(_.ok){const y=await _.json(),I=[...y.owned||[],...y.member||[]];E(I);const U=I.find(te=>te.type==="TEAM");U?u(U):I.length>0&&u(I[0])}}catch(s){console.error("Failed to fetch workspaces:",s)}finally{i(!1)}},Q=async()=>{if(t)try{const s=await fetch(`/api/workspaces/${t.id}/members`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")||""}`}});if(s.ok){const a=await s.json();n(a)}}catch(s){console.error("Failed to fetch members:",s)}},A=async()=>{if(t)try{const s=await fetch(`/api/workspaces/${t.id}/invites`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")||""}`}});if(s.ok){const a=await s.json();T(a.invites||[])}}catch(s){console.error("Failed to fetch invites:",s)}},K=async s=>{if(s.preventDefault(),!!t)try{const a=await fetch(`/api/workspaces/${t.id}/invites`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")||""}`},body:JSON.stringify(o)});if(!a.ok)throw new Error("Failed to create invite");const _=await a.json();c({title:"Invite created",description:"Invite link has been created successfully"}),await navigator.clipboard.writeText(_.invite_url),c({title:"Link copied",description:"Invite link has been copied to clipboard"}),g(!1),x({default_role:"VIEWER",max_uses:null,expires_in_hours:null,label:null}),A()}catch(a){c({title:"Error",description:a instanceof Error?a.message:"Failed to create invite",variant:"destructive"})}},Z=async s=>{try{await navigator.clipboard.writeText(s),c({title:"Link copied",description:"Invite link has been copied to clipboard"})}catch{c({title:"Error",description:"Failed to copy link",variant:"destructive"})}},ee=async s=>{if(t)try{if(!(await fetch(`/api/workspaces/${t.id}/invites/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")||""}`}})).ok)throw new Error("Failed to revoke invite");c({title:"Invite revoked",description:"The invite link has been revoked"}),A()}catch(a){c({title:"Error",description:a instanceof Error?a.message:"Failed to revoke invite",variant:"destructive"})}},R=s=>{switch(s){case"ADMIN":return"bg-purple-100 text-purple-800";case"EDITOR":return"bg-blue-100 text-blue-800";case"VIEWER":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},se=s=>{const a=s.split(" ");return a.length>=2?`${a[0][0]}${a[1][0]}`.toUpperCase():s.substring(0,2).toUpperCase()},ae=s=>s?`Expires ${new Date(s).toLocaleDateString()}`:"Never expires";return D?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investigation Teams"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading..."})]})})}):d.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investigation Teams"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Create a workspace to collaborate"})]})}),e.jsx(k,{children:e.jsxs(f,{className:"text-center py-12",children:[e.jsx($,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No Workspaces Yet"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Create a workspace to start collaborating with your team"}),e.jsx(ue,{onWorkspaceCreated:O})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Investigation Teams"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage team members and secure invite links"})]})}),e.jsxs(k,{children:[e.jsxs(L,{children:[e.jsx(W,{children:"Select Workspace"}),e.jsx(F,{children:"Choose a workspace to manage team collaboration"})]}),e.jsx(f,{children:e.jsxs(b,{value:t?.id||"",onValueChange:s=>u(d.find(a=>a.id===s)||null),children:[e.jsx(w,{className:"w-full",children:e.jsx(N,{placeholder:"Select a workspace"})}),e.jsx(C,{children:d.map(s=>e.jsx(r,{value:s.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.name}),e.jsx(S,{variant:"outline",className:"text-xs",children:s.type})]})},s.id))})]})})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs(k,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(W,{children:"Invite Links"}),e.jsx(F,{children:"Secure links to invite team members"})]}),e.jsxs(P,{open:j,onOpenChange:g,children:[e.jsx(H,{asChild:!0,children:e.jsxs(h,{children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"New Invite"]})}),e.jsxs(V,{children:[e.jsxs(z,{children:[e.jsx(B,{children:"Create Invite Link"}),e.jsx(Y,{children:"Generate a secure invite link for team members to join this workspace"})]}),e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Role"}),e.jsxs(b,{value:o.default_role,onValueChange:s=>x({...o,default_role:s}),children:[e.jsx(w,{children:e.jsx(N,{})}),e.jsxs(C,{children:[e.jsx(r,{value:"VIEWER",children:"Viewer (Read-only)"}),e.jsx(r,{value:"EDITOR",children:"Editor (Can edit)"}),e.jsx(r,{value:"ADMIN",children:"Admin (Full access)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Label (Optional)"}),e.jsx(q,{placeholder:"e.g., External analysts, Review team",value:o.label||"",onChange:s=>x({...o,label:s.target.value||null})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Expires In (Optional)"}),e.jsxs(b,{value:o.expires_in_hours?.toString()||"never",onValueChange:s=>x({...o,expires_in_hours:s==="never"?null:parseInt(s)}),children:[e.jsx(w,{children:e.jsx(N,{})}),e.jsxs(C,{children:[e.jsx(r,{value:"never",children:"Never expires"}),e.jsx(r,{value:"24",children:"24 hours"}),e.jsx(r,{value:"168",children:"7 days"}),e.jsx(r,{value:"720",children:"30 days"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Max Uses (Optional)"}),e.jsxs(b,{value:o.max_uses?.toString()||"unlimited",onValueChange:s=>x({...o,max_uses:s==="unlimited"?null:parseInt(s)}),children:[e.jsx(w,{children:e.jsx(N,{})}),e.jsxs(C,{children:[e.jsx(r,{value:"unlimited",children:"Unlimited"}),e.jsx(r,{value:"1",children:"1 use"}),e.jsx(r,{value:"5",children:"5 uses"}),e.jsx(r,{value:"10",children:"10 uses"})]})]})]}),e.jsx(h,{type:"submit",className:"w-full",children:"Create & Copy Link"})]})]})]})]})}),e.jsx(f,{children:p.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(le,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No invite links created yet"})]}):e.jsx("div",{className:"space-y-3",children:p.map(s=>e.jsx("div",{className:"p-4 rounded-lg border bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-750",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.label&&e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:s.label}),e.jsx(S,{className:R(s.default_role),children:s.default_role}),!s.is_active&&e.jsx(S,{variant:"destructive",children:"Revoked"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 font-mono truncate",children:s.invite_token}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"h-3 w-3"}),ae(s.expires_at)]}),e.jsxs("span",{children:[s.current_uses,"/",s.max_uses||"âˆž"," uses"]}),s.created_by&&e.jsxs("span",{children:["Created by ",s.created_by.nickname]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>Z(s.invite_url),disabled:!s.is_active,children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>window.open(s.invite_url,"_blank"),disabled:!s.is_active,children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>ee(s.id),disabled:!s.is_active,children:e.jsx(he,{className:"h-4 w-4 text-red-600"})})]})]})},s.id))})})]}),e.jsxs(k,{children:[e.jsxs(L,{children:[e.jsxs(W,{children:["Team Members (",m.length,")"]}),e.jsx(F,{children:"People collaborating in this workspace"})]}),e.jsx(f,{children:m.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx($,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No team members yet"})]}):e.jsx("div",{className:"space-y-3",children:m.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{children:e.jsx(ie,{children:se(s.nickname||s.username||"U")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:s.nickname||s.username||"Unknown"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Joined ",new Date(s.joined_at).toLocaleDateString(),s.joined_via_invite_id&&" via invite"]})]})]}),e.jsx(S,{className:R(s.role),children:s.role})]},s.id))})})]}),e.jsx(k,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:e.jsx(f,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(xe,{className:"h-6 w-6 text-blue-600 dark:text-blue-400 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-1",children:"Secure Collaboration"}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:"Invite links are independent from account credentials. Team members use their own account hash to login and choose workspace-specific nicknames. You can revoke invite links at any time without affecting existing members."})]})]})})})]})]})}export{be as CollaborationPage};
