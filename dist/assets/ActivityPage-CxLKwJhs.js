import{j as e}from"./ui-vendor-DBphXmDA.js";import{r as c}from"./react-vendor-CfYLSWvh.js";import{C as n,a as d,c as o,b as x,d as F}from"./card-BGAig-Dv.js";import{u as S,S as N,z as g,C as D,E as T,F as r,G as V,t as H,e as B}from"./index-QqleixXe.js";import{A as K,a as q}from"./avatar-Cr9hJqyk.js";import{U as G,W as w,l as b,e as Q,ao as A,Q as C,V as W,bj as z,q as X,$ as Y,d as J}from"./icons-x9tcvtYN.js";import"./state-vendor-BXB5jEEt.js";const Z={CREATED:w,UPDATED:Y,DELETED:X,COMMENTED:b,VOTED:z,RATED:W,FORKED:A,PUBLISHED:C,SHARED:C,CLONED:A},ee={CREATED:"text-green-500",UPDATED:"text-blue-500",DELETED:"text-red-500",COMMENTED:"text-purple-500",VOTED:"text-orange-500",RATED:"text-yellow-500",FORKED:"text-cyan-500",PUBLISHED:"text-indigo-500",SHARED:"text-pink-500",CLONED:"text-teal-500"};function te(){const{t:a}=S(["activity","common"]),[j,_]=c.useState([]),[m,R]=c.useState({total_activities:0,active_users:0,creates:0,updates:0,comments:0}),[U,y]=c.useState(!0),[u,O]=c.useState(""),[h,k]=c.useState(""),[I]=c.useState(50),[E,se]=c.useState(0);c.useEffect(()=>{L()},[u,h,E]);const L=async()=>{const t=localStorage.getItem("omnicore_workspace_id");if(t){y(!0);try{const s=new URLSearchParams({limit:I.toString(),offset:E.toString()});u&&s.append("type",u),h&&s.append("entity_type",h);const i=await fetch(`/api/activity?${s}`,{headers:{"X-Workspace-ID":t}});if(i.ok){const l=await i.json();_(l.activities||[]),R(l.summary||{total_activities:0,active_users:0,creates:0,updates:0,comments:0})}}catch(s){console.error("[ActivityFeed] Fetch error:",s)}finally{y(!1)}}},M=t=>{const s=new Date(t),l=new Date().getTime()-s.getTime(),p=Math.floor(l/6e4),f=Math.floor(l/36e5),v=Math.floor(l/864e5);return p<1?a("activity:time.justNow"):p<60?a("activity:time.minutesAgo",{count:p}):f<24?a("activity:time.hoursAgo",{count:f}):v<7?a("activity:time.daysAgo",{count:v}):s.toLocaleDateString()},$=(t,s)=>{if(t){const i=t.split(" ");return i.length>=2?`${i[0][0]}${i[1][0]}`.toUpperCase():t.substring(0,2).toUpperCase()}return s?s.substring(0,2).toUpperCase():"??"},P=t=>{const s=t.entity_type.toLowerCase().replace("_"," ");switch(t.action_type){case"CREATED":return`created a ${s}`;case"UPDATED":return`updated a ${s}`;case"DELETED":return`deleted a ${s}`;case"COMMENTED":return`commented on a ${s}`;case"VOTED":return`voted on a ${s}`;case"RATED":return`rated a ${s}`;case"FORKED":return`forked a ${s}`;case"PUBLISHED":return`published a ${s}`;case"SHARED":return`shared a ${s}`;case"CLONED":return`cloned a ${s}`;default:return`interacted with a ${s}`}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(n,{children:e.jsxs(d,{className:"pb-3",children:[e.jsx(o,{children:a("activity:summary.totalActivities")}),e.jsx(x,{className:"text-3xl",children:m.total_activities})]})}),e.jsx(n,{children:e.jsxs(d,{className:"pb-3",children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),a("activity:summary.activeUsers")]}),e.jsx(x,{className:"text-3xl",children:m.active_users})]})}),e.jsx(n,{children:e.jsxs(d,{className:"pb-3",children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),a("activity:summary.created")]}),e.jsx(x,{className:"text-3xl",children:m.creates})]})}),e.jsx(n,{children:e.jsxs(d,{className:"pb-3",children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),a("activity:summary.comments")]}),e.jsx(x,{className:"text-3xl",children:m.comments})]})})]}),e.jsxs(n,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),a("activity:feed.title")]}),e.jsx(o,{children:a("activity:feed.description")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(N,{value:u||"all",onValueChange:t=>O(t==="all"?"":t),children:[e.jsx(g,{className:"w-[160px]",children:e.jsx(D,{placeholder:a("activity:filters.allTypes")})}),e.jsxs(T,{children:[e.jsx(r,{value:"all",children:a("activity:filters.allTypes")}),e.jsx(r,{value:"CREATED",children:"Created"}),e.jsx(r,{value:"UPDATED",children:"Updated"}),e.jsx(r,{value:"DELETED",children:"Deleted"}),e.jsx(r,{value:"COMMENTED",children:"Commented"}),e.jsx(r,{value:"VOTED",children:"Voted"}),e.jsx(r,{value:"RATED",children:"Rated"}),e.jsx(r,{value:"PUBLISHED",children:"Published"})]})]}),e.jsxs(N,{value:h||"all",onValueChange:t=>k(t==="all"?"":t),children:[e.jsx(g,{className:"w-[160px]",children:e.jsx(D,{placeholder:a("activity:filters.allEntities")})}),e.jsxs(T,{children:[e.jsx(r,{value:"all",children:a("activity:filters.allEntities")}),e.jsx(r,{value:"FRAMEWORK",children:"Framework"}),e.jsx(r,{value:"INVESTIGATION",children:"Investigation"}),e.jsx(r,{value:"RESEARCH_QUESTION",children:"Research Question"}),e.jsx(r,{value:"ENTITY",children:"Entity"}),e.jsx(r,{value:"COMMENT",children:"Comment"})]})]})]})]})}),e.jsx(F,{children:U?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-gray-100"})}):j.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:a("activity:feed.empty")}):e.jsx(V,{className:"h-[500px]",children:e.jsx("div",{className:"space-y-4",children:j.map(t=>{const s=Z[t.action_type]||J,i=ee[t.action_type]||"text-gray-500";return e.jsxs("div",{className:"flex gap-4 pb-4 border-b last:border-0",children:[e.jsx(K,{className:"h-10 w-10",children:e.jsx(q,{className:"text-xs",children:$(t.actor_nickname,t.actor_user_hash)})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:t.actor_nickname||"Anonymous"})," ",e.jsx("span",{className:"text-muted-foreground",children:P(t)})]}),t.entity_title&&e.jsx("p",{className:"text-sm font-medium mt-1 text-gray-900 dark:text-white",children:t.entity_title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:M(t.created_at)})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(s,{className:H("h-4 w-4",i)}),e.jsx(B,{variant:"outline",className:"text-xs",children:t.entity_type.replace("_"," ")})]})]})})]},t.id)})})})})]})]})}function oe(){const{t:a}=S();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a("pages.activity.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a("pages.activity.subtitle")})]}),e.jsx(te,{})]})}export{oe as ActivityPage};
