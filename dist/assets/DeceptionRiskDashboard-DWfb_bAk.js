import{j as e}from"./ui-vendor-DBphXmDA.js";import{f as z,r as i}from"./react-vendor-CfYLSWvh.js";import{C as d,a as m,b as x,d as h,c as w}from"./card-BQo7RV_Z.js";import{B as u,S as F,z as B,C as $,E as G,F as L,e as c}from"./index-DGGXJgUa.js";import{P as X}from"./progress-D6O6TLpv.js";import{R as S,T as E,c as M,aL as q,x as D,E as V,V as K,a5 as Y,w as J,aj as T,e as Q,Y as Z,az as ee}from"./icons-x9tcvtYN.js";import"./state-vendor-BXB5jEEt.js";function ne(){const r=z(),[v,g]=i.useState(!0),[s,b]=i.useState(null),[j,N]=i.useState(null),[l,U]=i.useState(null),[_,W]=i.useState([]),[n,A]=i.useState("1"),[I,R]=i.useState(!0),H=async()=>{try{R(!0);const a=localStorage.getItem("omnicore_user_hash"),t=await fetch("/api/workspaces",{headers:{...a&&{Authorization:`Bearer ${a}`,"X-User-Hash":a}}});if(t.ok){const k=await t.json(),f=[...k.owned||[],...k.member||[]];W(f),f.length>0&&!f.find(P=>P.id===n)&&A(f[0].id)}}catch(a){console.error("Failed to load workspaces:",a)}finally{R(!1)}},y=async()=>{try{g(!0),N(null);const a=localStorage.getItem("omnicore_user_hash"),t=await fetch(`/api/deception/aggregate?workspace_id=${n}`,{headers:{...a&&{Authorization:`Bearer ${a}`}}});if(!t.ok)throw new Error("Failed to load deception risk data");const k=await t.json();b(k),U(new Date)}catch(a){console.error("Failed to load deception dashboard:",a),N(a instanceof Error?a.message:"Unknown error")}finally{g(!1)}};if(i.useEffect(()=>{H()},[]),i.useEffect(()=>{I||y()},[n,I]),v)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(S,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading deception risk data..."})]})});if(j||!s)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs(d,{className:"max-w-md",children:[e.jsx(m,{children:e.jsxs(x,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(E,{className:"h-5 w-5"}),"Error Loading Dashboard"]})}),e.jsxs(h,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:j||"Failed to load deception risk data"}),e.jsxs(u,{onClick:y,children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Retry"]})]})]})});const C=a=>{switch(a){case"CRITICAL":return"text-red-700 bg-red-100 dark:text-red-400 dark:bg-red-900/20 border-red-500";case"HIGH":return"text-orange-700 bg-orange-100 dark:text-orange-400 dark:bg-orange-900/20 border-orange-500";case"MEDIUM":return"text-yellow-700 bg-yellow-100 dark:text-yellow-400 dark:bg-yellow-900/20 border-yellow-500";case"LOW":return"text-green-700 bg-green-100 dark:text-green-400 dark:bg-green-900/20 border-green-500";default:return"text-gray-700 bg-gray-100 dark:text-gray-400 dark:bg-gray-900/20 border-gray-500"}},O=a=>{switch(a){case"CRITICAL":return e.jsx(ee,{className:"h-4 w-4"});case"HIGH":return e.jsx(E,{className:"h-4 w-4"});case"MEDIUM":return e.jsx(Z,{className:"h-4 w-4"});case"LOW":return e.jsx(T,{className:"h-4 w-4"});default:return e.jsx(Q,{className:"h-4 w-4"})}},p=_.find(a=>a.id===n);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(M,{className:"h-8 w-8"}),"Deception Risk Dashboard"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Unified view of all deception detection systems: MOM, POP, EVE, MOSES, Claims"}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsx(q,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs(F,{value:n,onValueChange:A,children:[e.jsx(B,{className:"w-[300px]",children:e.jsx($,{placeholder:"Select workspace..."})}),e.jsx(G,{children:_.length===0?e.jsx(L,{value:"1",children:"Default Workspace"}):_.map(a=>e.jsx(L,{value:a.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:a.name}),a.type==="TEAM"&&e.jsx(c,{variant:"outline",className:"text-xs",children:"Team"}),a.type==="PUBLIC"&&e.jsx(c,{variant:"outline",className:"text-xs",children:"Public"})]})},a.id))})]}),p&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[p.entity_count.actors," actors · ",p.entity_count.sources," sources · ",p.entity_count.evidence," evidence"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs(u,{onClick:y,variant:"outline",size:"sm",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Refresh"]}),l&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Updated ",l.toLocaleTimeString()]})]})]}),e.jsxs(d,{className:`border-2 ${C(s.risk_level)}`,children:[e.jsxs(m,{children:[e.jsxs(x,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Overall Risk Score"]}),e.jsx(c,{variant:"outline",className:`text-lg px-4 py-2 ${C(s.risk_level)}`,children:s.risk_level})]}),e.jsxs(w,{children:["Aggregated from ",s.metadata.data_sources.actors," actors, ",s.metadata.data_sources.sources," sources, ",s.metadata.data_sources.content_analyses," analyses"]})]}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-6xl font-bold",children:[s.overall_risk_score,e.jsx("span",{className:"text-3xl text-muted-foreground",children:"/100"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(X,{value:s.overall_risk_score,className:"h-4"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Risk threshold: ",s.overall_risk_score>=75?"CRITICAL":s.overall_risk_score>=60?"HIGH":s.overall_risk_score>=40?"MEDIUM":"LOW"]})]})]})})]}),(s.critical_alerts.length>0||s.high_alerts.length>0)&&e.jsxs(d,{className:"border-2 border-red-500",children:[e.jsxs(m,{children:[e.jsxs(x,{className:"flex items-center gap-2 text-red-700 dark:text-red-400",children:[e.jsx(E,{className:"h-5 w-5"}),"Critical Alerts (",s.critical_alerts.length+s.high_alerts.length,")"]}),e.jsx(w,{children:"Immediate attention required"})]}),e.jsx(h,{className:"space-y-3",children:[...s.critical_alerts,...s.high_alerts].map((a,t)=>e.jsxs("div",{className:`p-4 rounded-lg border-2 ${C(a.severity)} flex items-start justify-between gap-4`,children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"mt-0.5",children:O(a.severity)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold mb-1",children:a.entity_name}),e.jsx("div",{className:"text-sm opacity-80",children:a.details}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(c,{variant:"outline",className:"text-xs",children:a.type.replace("_"," ")}),e.jsxs(c,{variant:"outline",className:"text-xs",children:["Risk: ",a.risk_score.toFixed(1)]})]})]})]}),a.url&&e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>r(a.url),children:e.jsx(V,{className:"h-4 w-4"})})]},t))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(o,{title:"Actors (MOM)",subtitle:"Motive-Opportunity-Means",icon:e.jsx(D,{className:"h-5 w-5"}),stats:{high:s.risk_breakdown.actors_mom.high,medium:s.risk_breakdown.actors_mom.medium,low:s.risk_breakdown.actors_mom.low,total:s.risk_breakdown.actors_mom.total,avgScore:s.risk_breakdown.actors_mom.avg_score},onViewAll:()=>r("/dashboard/entities/actors")}),e.jsx(o,{title:"Actors (POP)",subtitle:"Patterns of Performance",icon:e.jsx(K,{className:"h-5 w-5"}),stats:{high:s.risk_breakdown.actors_pop.high,medium:s.risk_breakdown.actors_pop.medium,low:s.risk_breakdown.actors_pop.low,total:s.risk_breakdown.actors_pop.total,avgScore:s.risk_breakdown.actors_pop.avg_score},onViewAll:()=>r("/dashboard/entities/actors")}),e.jsx(o,{title:"Sources (MOSES)",subtitle:"Source Vulnerability",icon:e.jsx(Y,{className:"h-5 w-5"}),stats:{high:s.risk_breakdown.sources_moses.compromised,medium:s.risk_breakdown.sources_moses.unreliable,low:s.risk_breakdown.sources_moses.solid,total:s.risk_breakdown.sources_moses.total,avgScore:s.risk_breakdown.sources_moses.avg_score},labels:{high:"Compromised",medium:"Unreliable",low:"Solid"},onViewAll:()=>r("/dashboard/entities/sources")}),e.jsx(o,{title:"Evidence (EVE)",subtitle:"Evidence Validation",icon:e.jsx(J,{className:"h-5 w-5"}),stats:{high:s.risk_breakdown.evidence_eve.suspicious,medium:s.risk_breakdown.evidence_eve.needs_review,low:s.risk_breakdown.evidence_eve.verified,total:s.risk_breakdown.evidence_eve.total,avgScore:s.risk_breakdown.evidence_eve.avg_score},labels:{high:"Suspicious",medium:"Needs Review",low:"Verified"},onViewAll:()=>r("/dashboard/evidence")}),e.jsx(o,{title:"Claims Analysis",subtitle:"Content Deception Detection",icon:e.jsx(M,{className:"h-5 w-5"}),stats:{high:s.risk_breakdown.claims.high,medium:s.risk_breakdown.claims.medium,low:s.risk_breakdown.claims.low,total:s.risk_breakdown.claims.total,avgScore:s.risk_breakdown.claims.avg_score},onViewAll:()=>r("/dashboard/tools/content-intelligence")})]}),s.recommended_actions.length>0&&e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Recommended Actions"]}),e.jsx(w,{children:"Priority tasks based on current risk profile"})]}),e.jsx(h,{className:"space-y-3",children:s.recommended_actions.map((a,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(c,{variant:"outline",children:["#",a.priority]}),e.jsx("span",{children:a.action})]}),a.url&&e.jsxs(u,{size:"sm",variant:"ghost",onClick:()=>r(a.url),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Review"]})]},t))})]})]})}function o({title:r,subtitle:v,icon:g,stats:s,labels:b,onViewAll:j}){const l={...{high:"High Risk",medium:"Medium Risk",low:"Low Risk"},...b};return e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsxs(x,{className:"flex items-center gap-2 text-base",children:[g,r]}),e.jsx(w,{className:"text-xs",children:v})]}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"text-3xl font-bold text-center",children:[s.total,e.jsx("div",{className:"text-xs font-normal text-muted-foreground",children:"Total Items"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),l.high]}),e.jsx("span",{className:"font-bold",children:s.high})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),l.medium]}),e.jsx("span",{className:"font-bold",children:s.medium})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),l.low]}),e.jsx("span",{className:"font-bold",children:s.low})]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Avg Score: ",e.jsx("span",{className:"font-bold",children:s.avgScore.toFixed(1)})]})}),e.jsx(u,{onClick:j,variant:"outline",size:"sm",className:"w-full",children:"View All"})]})]})}export{ne as default};
