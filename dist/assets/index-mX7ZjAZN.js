const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/report-generator-D-MbsYuE.js","assets/FileSaver.min-Dgi0c_i4.js","assets/index-QqleixXe.js","assets/ui-vendor-DBphXmDA.js","assets/react-vendor-CfYLSWvh.js","assets/state-vendor-BXB5jEEt.js","assets/icons-x9tcvtYN.js","assets/index-BhwflcNA.css","assets/pptxgen.es-CeCpILHn.js","assets/_commonjs-dynamic-modules-TDtrdbi3.js","assets/card-BGAig-Dv.js","assets/tabs-If3dmLWi.js","assets/checkbox-DueJeeKx.js","assets/purify.es-aGzT-_H7.js","assets/switch-BxNvahPI.js","assets/separator-ozDNNLDu.js","assets/slider-B52ikc1m.js","assets/tooltip-_NEsV_z7.js","assets/progress-Cg1bbsHw.js","assets/citation-library-DsFrzEV3.js","assets/radio-group-Dj8G6QwH.js","assets/viz-libs-B9RIjOsc.js","assets/index-6Lr_p1cT.js","assets/exceljs.min-RL4gfToV.js"])))=>i.map(i=>d[i]);
var Wg=Object.defineProperty;var Hg=(r,t,s)=>t in r?Wg(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s;var at=(r,t,s)=>Hg(r,typeof t!="symbol"?t+"":t,s);import{j as e}from"./ui-vendor-DBphXmDA.js";import{C as ge,d as xe,a as Ce,b as Ae,c as Le}from"./card-BGAig-Dv.js";import{l as wt,m as jt,n as _t,o as kt,p as It,e as he,q as $e,B as te,I as Ee,A as Dt,r as Mt,s as Wn,t as cr,v as Kr,w as Kn,D as Ur,g as qr,h as Wr,k as rt,j as en,i as Nm,x as Gg,_ as sn,u as Bt,d as jc,y as fe,S as ct,z as dt,C as ut,E as ht,F as Te,G as ca,H as Sm,J as Wt}from"./index-QqleixXe.js";import{r as B,f as xr,j as Vg,k as da,u as ua}from"./react-vendor-CfYLSWvh.js";import{T as Ar,a as Tr,b as Ye,c as pt}from"./tabs-If3dmLWi.js";import{S as ft,L as xt,$ as Ls,R as Cm,h as $t,G as Mn,C as wr,E as ar,a as ir,a0 as Hi,X as Ze,W as st,_ as Ir,r as on,v as ha,P as _c,a1 as ln,a2 as Wl,d as nr,a3 as Em,a4 as Am,a5 as Xn,a6 as kd,a7 as jr,a8 as Kg,i as Xg,a9 as gn,q as vs,w as Nd,V as Hr,aa as Yn,ab as xs,x as Gi,ac as Yg,c as Hl,T as Rr,n as Jg,ad as Hn,N as ma,D as os,ae as Qg,Z as Vi,af as Gl,ag as Sd,ah as rr,ai as dr,U as ur,aj as gr,m as es,g as Xs,ak as Zg,al as Tm,am as bs,an as ex,ao as Cd,ap as Vl,Y as Im,aq as tx,ar as kc,as as rx,at as Pt,au as sx,av as nx,aw as Ed,I as za,ax as ix,ay as Ki,t as Fi,z as Kl,az as pa,aA as ax,aB as fa,aC as ox,aD as lx,aE as cx,aF as dx,aG as ux,Q as hx,aH as mx,aI as px,aJ as fx,aK as ga}from"./icons-x9tcvtYN.js";import{C as ts}from"./checkbox-DueJeeKx.js";import gx from"./purify.es-aGzT-_H7.js";import{S as Xl}from"./switch-BxNvahPI.js";import{S as Cr}from"./separator-ozDNNLDu.js";import{S as ys}from"./slider-B52ikc1m.js";import{T as qt,a as Ct,b as Et,c as At}from"./tooltip-_NEsV_z7.js";import{P as Fs}from"./progress-Cg1bbsHw.js";import{g as xx,f as yx,a as bx}from"./citation-library-DsFrzEV3.js";import"./radio-group-Dj8G6QwH.js";import{E as xa,a as Nc,F as Rm}from"./FileSaver.min-Dgi0c_i4.js";import{F as vx}from"./viz-libs-B9RIjOsc.js";function Sc(){const[r,t]=B.useState(null),[s,n]=B.useState(!1),[i,o]=B.useState(!0),[l,a]=B.useState(!1),[c,p]=B.useState(null);B.useEffect(()=>{d()},[]);const d=async()=>{try{o(!0);const b=await fetch("/api/ai/config");if(!b.ok)throw new Error("Failed to load AI configuration");const N=await b.json();n(N.enabled||!1),t(N)}catch(b){console.error("Failed to load AI config:",b),p(b instanceof Error?b.message:"Configuration load failed"),n(!1)}finally{o(!1)}},m=B.useCallback(async b=>{if(!s)return p("AI features are not enabled"),null;a(!0),p(null);try{const N=await fetch("/api/ai/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!N.ok){const v=await N.json().catch(()=>({message:"Generation failed"}));throw new Error(v.message||"AI generation failed")}return(await N.json()).content}catch(N){const u=N instanceof Error?N.message:"Generation failed";return p(u),console.error("AI generation error:",N),null}finally{a(!1)}},[s]),y=B.useCallback(async(b,N="standard")=>{if(!s)return p("AI features are not enabled"),null;a(!0),p(null);try{const u=await fetch("/api/ai/summarize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:b,mode:N})});if(!u.ok){const g=await u.json().catch(()=>({message:"Summarization failed"}));throw new Error(g.message||"Summarization failed")}return(await u.json()).summary}catch(u){const v=u instanceof Error?u.message:"Summarization failed";return p(v),console.error("Summarization error:",u),null}finally{a(!1)}},[s]),h=B.useCallback(async b=>{if(!s)return p("AI features are not enabled"),null;a(!0),p(null);try{const N=await fetch("/api/ai/questions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!N.ok){const v=await N.json().catch(()=>({message:"Question generation failed"}));throw new Error(v.message||"Question generation failed")}return(await N.json()).questions}catch(N){const u=N instanceof Error?N.message:"Question generation failed";return p(u),console.error("Question generation error:",N),null}finally{a(!1)}},[s]),_=B.useCallback(()=>{d()},[]);return{config:r,enabled:s,loading:i,generating:l,error:c,generate:m,summarize:y,generateQuestions:h,refreshConfig:_}}function wx(r,t,s){const{enabled:n,generating:i,generate:o,error:l}=Sc(),[a,c]=B.useState(null),p=B.useCallback(async(m="suggest")=>{const y={suggest:`Generate content for the "${r}" field in this ${s.framework||"analysis"}.

${s.relatedFields?`Related Context:
${JSON.stringify(s.relatedFields,null,2)}
`:""}

${s.linkedEvidence?`Linked Evidence: ${s.linkedEvidence.length} items
`:""}

Generate clear, concise content appropriate for this field.`,expand:`Expand and elaborate on the following content for the "${r}" field:

${t}

${s.relatedFields?`
Related Context:
${JSON.stringify(s.relatedFields,null,2)}`:""}

Provide more detail and depth while maintaining the original intent.`,rephrase:`Rephrase the following content for better clarity and impact:

${t}

Improve clarity, conciseness, and professional tone.`,summarize:`Summarize the following content more concisely:

${t}

Preserve key points while reducing length.`},h=await o({prompt:y[m],useCase:"fieldSuggestions"});return h&&c(h),h},[r,t,s,o]),d=B.useCallback(()=>{c(null)},[]);return{enabled:n,generating:i,error:l,preview:a,generateField:p,clearPreview:d}}function jx({open:r,onOpenChange:t,fieldName:s,currentValue:n,context:i,placeholder:o,onAccept:l}){const{enabled:a,generating:c,error:p,preview:d,generateField:m,clearPreview:y}=wx(s,n,i||{}),[h,_]=B.useState(""),[b,N]=B.useState("suggest");B.useEffect(()=>{r&&(y(),_(""),N(n?"expand":"suggest"))},[r,n,y]),B.useEffect(()=>{d&&_(d)},[d]);const u=async()=>{await m(b)},v=()=>{l(h||d||"")},g=A=>({suggest:n?"Expand on existing content":"Generate new content based on context",expand:"Add more detail and depth to existing content",rephrase:"Rephrase for better clarity and impact",summarize:"Create a more concise version"})[A];if(!a)return null;const w=!!(d||h),k=!!n;return e.jsx(wt,{open:r,onOpenChange:t,children:e.jsxs(jt,{className:"sm:max-w-3xl max-h-[90vh] flex flex-col",children:[e.jsxs(_t,{children:[e.jsxs(kt,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-5 w-5 text-purple-600"}),"AI Assistant - ",s]}),e.jsx(It,{children:g(b)})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4",children:[k?e.jsx(Ar,{value:b,onValueChange:A=>N(A),children:e.jsxs(Tr,{className:"grid w-full grid-cols-4",children:[e.jsx(Ye,{value:"expand",children:"Expand"}),e.jsx(Ye,{value:"rephrase",children:"Rephrase"}),e.jsx(Ye,{value:"summarize",children:"Summarize"}),e.jsx(Ye,{value:"suggest",children:"Suggest"})]})}):e.jsx("div",{children:e.jsxs(he,{variant:"secondary",className:"mb-2",children:[e.jsx(ft,{className:"h-3 w-3 mr-1"}),"Generate New Content"]})}),n&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Current Content:"}),e.jsx("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border text-sm",children:n})]}),p&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:p})}),!c&&!w&&e.jsx("div",{className:"flex items-center justify-center h-32 border-2 border-dashed rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ft,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:'Click "Generate" to create AI-powered content'})]})}),c&&e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"text-center",children:[e.jsx(xt,{className:"h-8 w-8 mx-auto mb-2 text-purple-600 animate-spin"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Generating content..."})]})}),w&&!c&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ls,{className:"h-4 w-4"}),"AI Generated Content (Editable):"]}),d&&!h&&e.jsx(he,{variant:"secondary",children:"Preview"}),h&&h!==d&&e.jsx(he,{variant:"default",children:"Edited"})]}),e.jsx($e,{value:h||d||"",onChange:A=>_(A.target.value),placeholder:o||`Enter ${s}...`,rows:12,className:"font-mono text-sm"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"You can edit the AI-generated content above before accepting"})]}),i&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 space-y-1",children:[i.framework&&e.jsxs("div",{children:["Framework: ",i.framework]}),i.linkedEvidence&&i.linkedEvidence.length>0&&e.jsxs("div",{children:["Linked Evidence: ",i.linkedEvidence.length," items"]}),i.relatedFields&&Object.keys(i.relatedFields).length>0&&e.jsxs("div",{children:["Related Fields: ",Object.keys(i.relatedFields).length]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx(te,{variant:"outline",onClick:()=>t(!1),disabled:c,children:"Cancel"}),e.jsxs("div",{className:"flex gap-2",children:[w&&e.jsxs(te,{variant:"outline",onClick:u,disabled:c,children:[e.jsx(Cm,{className:"h-4 w-4 mr-2"}),"Regenerate"]}),e.jsx(te,{onClick:w?v:u,disabled:c||w&&!h&&!d,children:c?e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):w?e.jsxs(e.Fragment,{children:[e.jsx($t,{className:"h-4 w-4 mr-2"}),"Accept"]}):e.jsxs(e.Fragment,{children:[e.jsx(ft,{className:"h-4 w-4 mr-2"}),"Generate"]})})]})]})]})})}function gs({fieldName:r,currentValue:t,onAccept:s,context:n,placeholder:i,disabled:o=!1}){const[l,a]=B.useState(!1),{enabled:c,loading:p}=Sc();return!c||p?null:e.jsxs(e.Fragment,{children:[e.jsx(te,{type:"button",variant:"ghost",size:"sm",onClick:()=>a(!0),disabled:o,className:"h-8 w-8 p-0 text-purple-600 hover:text-purple-700 hover:bg-purple-50",title:"AI Assistant",children:e.jsx(ft,{className:"h-4 w-4"})}),e.jsx(jx,{open:l,onOpenChange:a,fieldName:r,currentValue:t,context:n,placeholder:i,onAccept:d=>{s(d),a(!1)}})]})}function Om({framework:r,onExtract:t,disabled:s=!1,buttonVariant:n="outline"}){const[i,o]=B.useState(!1),[l,a]=B.useState(""),[c,p]=B.useState(!1),[d,m]=B.useState(null),[y,h]=B.useState(null),_=async()=>{if(!l.trim()){h("Please enter a URL");return}p(!0),h(null);try{const u=await fetch("/api/ai/scrape-url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:l.trim(),framework:r})});if(!u.ok){const g=await u.json().catch(()=>({error:"Unknown error"}));throw new Error(g.error||`Server error: ${u.status}`)}const v=await u.json();m(v)}catch(u){console.error("Scraping error:",u);let v="Failed to scrape URL";u instanceof TypeError&&u.message==="Load failed"?v="Network error: The request timed out or connection was lost. The page may be too slow to load or blocking requests. Try a different URL.":u instanceof TypeError&&u.message.includes("Failed to fetch")?v="Network error: Unable to connect to the server. Please check your internet connection and try again.":u instanceof Error&&(v=u.message),h(v)}finally{p(!1)}},b=()=>{if(d&&d.extractedData){const u={...d.extractedData};if(d.extractedData._unansweredQuestions){const v=d.extractedData._unansweredQuestions;Object.keys(v).forEach(g=>{const w=v[g];if(Array.isArray(w)&&w.length>0){const k=w.map(T=>({id:crypto.randomUUID(),question:T,answer:"",needsAnswer:!0})),A=u[g]||[];u[g]=[...k,...A]}})}t(u,{url:d.url,title:d.title,summary:d.summary}),o(!1),a(""),m(null),h(null)}},N=u=>{o(u),u||(a(""),m(null),h(null))};return e.jsxs(e.Fragment,{children:[e.jsxs(te,{variant:n,onClick:()=>o(!0),disabled:s,children:[e.jsx(Mn,{className:"h-4 w-4 mr-2"}),"Import from URL"]}),e.jsx(wt,{open:i,onOpenChange:N,children:e.jsxs(jt,{className:"sm:max-w-3xl max-h-[90vh] flex flex-col",children:[e.jsxs(_t,{children:[e.jsxs(kt,{className:"flex items-center gap-2",children:[e.jsx(Mn,{className:"h-5 w-5 text-blue-600"}),"Import from URL"]}),e.jsxs(It,{children:["Enter a URL to scrape and extract information for your ",r," analysis"]})]}),e.jsxs("div",{className:"space-y-4 flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ee,{type:"url",placeholder:"https://example.com/article",value:l,onChange:u=>a(u.target.value),onKeyPress:u=>u.key==="Enter"&&!c&&_(),disabled:c}),e.jsx(te,{onClick:_,disabled:c||!l.trim(),children:c?e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"h-4 w-4 mr-2 animate-spin"}),"Scraping..."]}):"Analyze"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Paste a URL to a news article, report, or web page"})]}),y&&e.jsxs(Dt,{variant:"destructive",children:[e.jsx(wr,{className:"h-4 w-4"}),e.jsx(Mt,{children:y})]}),d&&e.jsxs("div",{className:"space-y-4 border rounded-lg p-4 bg-blue-50 dark:bg-blue-900/20",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-lg line-clamp-2",children:d.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(he,{variant:"secondary",children:d.metadata.source}),e.jsxs("a",{href:d.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline flex items-center gap-1",children:[e.jsx(ar,{className:"h-3 w-3"}),"View source"]})]})]}),e.jsx($t,{className:"h-5 w-5 text-green-600 flex-shrink-0"})]})}),e.jsxs(Ar,{defaultValue:"extracted",className:"w-full",children:[e.jsxs(Tr,{className:"grid w-full grid-cols-2",children:[e.jsx(Ye,{value:"extracted",children:"Extracted Data"}),e.jsx(Ye,{value:"summary",children:"Summary"})]}),e.jsx(pt,{value:"extracted",className:"space-y-3 mt-4 max-h-96 overflow-y-auto",children:Object.keys(d.extractedData).length===0?e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 italic",children:"No structured data extracted for this framework"}):e.jsxs(e.Fragment,{children:[d.extractedData._error&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-red-800 dark:text-red-400 mb-2",children:"âš ï¸ Extraction Error"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mb-2",children:d.extractedData._error}),e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400",children:["Model: ",d.extractedData._model||"unknown"," â€¢ Framework: ",d.extractedData._framework||"unknown"]})]}),d.extractedData._parseError&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-yellow-800 dark:text-yellow-400 mb-2",children:"âš ï¸ JSON Parsing Error"}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mb-2",children:"The AI response couldn't be parsed as JSON:"}),e.jsx("p",{className:"text-xs font-mono text-yellow-600 dark:text-yellow-400 mb-2",children:d.extractedData._parseError}),d.extractedData._raw&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-xs font-semibold text-yellow-700 dark:text-yellow-300 cursor-pointer",children:"Show raw response"}),e.jsx("pre",{className:"mt-2 text-xs bg-yellow-100 dark:bg-yellow-900/40 p-2 rounded overflow-x-auto whitespace-pre-wrap",children:d.extractedData._raw})]})]}),Object.entries(d.extractedData).filter(([u])=>!u.startsWith("_")).map(([u,v])=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"font-medium text-sm capitalize",children:[u.replace(/_/g," "),":"]}),Array.isArray(v)?e.jsx("ul",{className:"space-y-2",children:v.map((g,w)=>e.jsx("li",{className:"text-sm ml-4",children:typeof g=="object"&&g!==null&&"question"in g?e.jsxs("div",{className:"space-y-1 bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:["Q: ",g.question]}),e.jsxs("div",{className:"text-gray-700 dark:text-gray-300 ml-4",children:["A: ",g.answer||e.jsx("span",{className:"italic text-gray-500",children:"No answer extracted"})]})]}):e.jsx("span",{className:"text-gray-700 dark:text-gray-300 list-disc",children:typeof g=="string"?g:JSON.stringify(g)})},w))}):e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:typeof v=="string"?v:JSON.stringify(v)})]},u)),d.extractedData._unansweredQuestions&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-300 dark:border-gray-600",children:[e.jsx("h4",{className:"font-semibold text-base mb-3 text-orange-700 dark:text-orange-400",children:"ðŸ” Questions to Investigate Further"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-3 italic",children:"These questions could not be answered from the article and represent information gaps"}),e.jsx("div",{className:"space-y-3",children:Object.entries(d.extractedData._unansweredQuestions).map(([u,v])=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h5",{className:"font-medium text-sm capitalize text-gray-700 dark:text-gray-300",children:[u.replace(/_/g," "),":"]}),e.jsx("ul",{className:"space-y-1.5",children:Array.isArray(v)&&v.map((g,w)=>e.jsx("li",{className:"text-sm ml-4",children:e.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 p-2 rounded border border-orange-200 dark:border-orange-800",children:e.jsxs("div",{className:"text-gray-900 dark:text-gray-100",children:["â“ ",g]})})},w))})]},u))})]})]})}),e.jsx(pt,{value:"summary",className:"mt-4",children:e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:d.summary})})]})]}),!c&&!d&&!y&&e.jsx("div",{className:"flex items-center justify-center py-12 border-2 border-dashed rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Mn,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Enter a URL above to start extracting information"})]})})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:d&&d.extractedData&&Object.keys(d.extractedData).length>0?(()=>{const u=Object.keys(d.extractedData).filter(g=>!g.startsWith("_")).length;return(d.extractedData._error||d.extractedData._parseError)&&u===0?"âš ï¸ Extraction failed - see error details above":u>0?`Ready to populate ${u} ${u===1?"field":"fields"}`:"No data extracted"})():"AI will extract relevant information for your framework"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{variant:"outline",onClick:()=>N(!1),disabled:c,children:"Cancel"}),d&&e.jsxs(te,{onClick:b,disabled:!d.extractedData||Object.keys(d.extractedData).length===0,children:[e.jsx($t,{className:"h-4 w-4 mr-2"}),"Accept & Populate"]})]})]})]})})]})}function _x({open:r,onOpenChange:t,onConfirm:s,maxSelection:n=5}){const[i,o]=B.useState(!1),[l,a]=B.useState([]),[c,p]=B.useState(new Set),[d,m]=B.useState(""),[y,h]=B.useState(null);B.useEffect(()=>{if(!r)return;(async()=>{o(!0),h(null);try{const v=await fetch("/api/content-library",{method:"GET",headers:{"Content-Type":"application/json"}});if(!v.ok)throw new Error(`Failed to fetch content: ${v.status}`);const g=await v.json();a(g.content||[])}catch(v){console.error("[ContentPicker] Fetch error:",v),h(v instanceof Error?v.message:"Failed to load content")}finally{o(!1)}})()},[r]);const _=u=>{p(v=>{const g=new Set(v);if(g.has(u))g.delete(u);else{if(g.size>=n)return alert(`Maximum ${n} content sources allowed`),v;g.add(u)}return g})},b=()=>{if(c.size===0){alert("Please select at least one content source");return}s(Array.from(c)),t(!1),p(new Set)},N=l.filter(u=>{if(!d)return!0;const v=d.toLowerCase();return u.title?.toLowerCase().includes(v)||u.url.toLowerCase().includes(v)||u.description?.toLowerCase().includes(v)});return e.jsx(wt,{open:r,onOpenChange:t,children:e.jsxs(jt,{className:"max-w-3xl max-h-[80vh] flex flex-col",children:[e.jsxs(_t,{children:[e.jsx(kt,{children:"Select Content for Auto-Population"}),e.jsxs(It,{children:["Choose up to ",n," analyzed content sources to auto-generate SWOT items. The AI will extract insights from your selected content."]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ir,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Ee,{placeholder:"Search by title, URL, or description...",value:d,onChange:u=>m(u.target.value),className:"pl-10"})]}),c.size>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(he,{variant:"secondary",children:[c.size," / ",n," selected"]}),e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>p(new Set),children:"Clear selection"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-2 pr-2",children:[i&&e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(xt,{className:"h-6 w-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading your content..."})]}),y&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:y})}),!i&&!y&&N.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:d?"No content matches your search":"No analyzed content found"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-500 mt-2",children:"Visit Content Research to analyze URLs first"})]}),!i&&!y&&N.map(u=>e.jsx(ge,{className:`cursor-pointer transition-colors ${c.has(u.id)?"border-blue-500 bg-blue-50 dark:bg-blue-950/20":"hover:border-gray-400"}`,onClick:()=>_(u.id),children:e.jsx(xe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ts,{checked:c.has(u.id),onCheckedChange:()=>_(u.id),onClick:v=>v.stopPropagation()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium text-sm truncate",children:u.title||"Untitled"}),e.jsx("a",{href:u.url,target:"_blank",rel:"noopener noreferrer",onClick:v=>v.stopPropagation(),className:"text-gray-400 hover:text-blue-600 flex-shrink-0",children:e.jsx(ar,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 truncate mt-1",children:u.url}),u.description&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1 line-clamp-2",children:u.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs(he,{variant:"outline",className:"text-xs",children:[u.word_count?.toLocaleString()||0," words"]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(u.created_at).toLocaleDateString()})]})]})]})})},u.id))]}),e.jsxs(Wn,{children:[e.jsx(te,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsxs(te,{onClick:b,disabled:c.size===0,children:["Auto-Populate from ",c.size," ",c.size===1?"Source":"Sources"]})]})]})})}const Ad=["bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-700","bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-300 dark:border-green-700","bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-300 dark:border-purple-700","bg-orange-100 text-orange-800 border-orange-200 dark:bg-orange-900/30 dark:text-orange-300 dark:border-orange-700","bg-pink-100 text-pink-800 border-pink-200 dark:bg-pink-900/30 dark:text-pink-300 dark:border-pink-700","bg-cyan-100 text-cyan-800 border-cyan-200 dark:bg-cyan-900/30 dark:text-cyan-300 dark:border-cyan-700","bg-amber-100 text-amber-800 border-amber-200 dark:bg-amber-900/30 dark:text-amber-300 dark:border-amber-700","bg-teal-100 text-teal-800 border-teal-200 dark:bg-teal-900/30 dark:text-teal-300 dark:border-teal-700"];function Xi({tags:r,onChange:t,suggestions:s=[],placeholder:n="Add tags...",maxTags:i=20,allowCustom:o=!0,className:l,colorMap:a={}}){const[c,p]=B.useState(""),[d,m]=B.useState(!1),[y,h]=B.useState(-1),_=B.useRef(null),b=B.useRef(null),N=s.filter(k=>k.toLowerCase().includes(c.toLowerCase())&&!r.includes(k)).slice(0,10);B.useEffect(()=>{const k=A=>{b.current&&!b.current.contains(A.target)&&m(!1)};return document.addEventListener("mousedown",k),()=>document.removeEventListener("mousedown",k)},[]);const u=k=>{const A=k.trim();A&&(r.includes(A)||r.length>=i||!o&&!s.includes(A)||(t([...r,A]),p(""),m(!1),h(-1),_.current?.focus()))},v=k=>{t(r.filter((A,T)=>T!==k))},g=k=>{k.key==="Enter"?(k.preventDefault(),y>=0&&N[y]?u(N[y]):c.trim()&&u(c)):k.key==="Backspace"&&!c&&r.length>0?v(r.length-1):k.key==="ArrowDown"?(k.preventDefault(),h(A=>A<N.length-1?A+1:A)):k.key==="ArrowUp"?(k.preventDefault(),h(A=>A>0?A-1:-1)):k.key==="Escape"&&(m(!1),h(-1))},w=(k,A)=>a[k]?a[k]:Ad[A%Ad.length];return e.jsxs("div",{ref:b,className:cr("relative",l),children:[e.jsxs("div",{className:"flex flex-wrap gap-2 p-3 border rounded-lg bg-white dark:bg-gray-950 min-h-[48px]",children:[r.map((k,A)=>e.jsxs(he,{variant:"outline",className:cr("flex items-center gap-1 px-2 py-1 text-xs font-medium border",w(k,A)),children:[e.jsx(Hi,{className:"h-3 w-3"}),k,e.jsx("button",{type:"button",onClick:()=>v(A),className:"ml-1 hover:bg-black/10 dark:hover:bg-white/10 rounded-full p-0.5",children:e.jsx(Ze,{className:"h-3 w-3"})})]},A)),r.length<i&&e.jsx("div",{className:"flex-1 min-w-[120px]",children:e.jsx(Ee,{ref:_,type:"text",value:c,onChange:k=>{p(k.target.value),m(!0),h(-1)},onFocus:()=>m(!0),onKeyDown:g,placeholder:r.length===0?n:"",className:"border-0 shadow-none focus-visible:ring-0 h-auto p-0 text-sm"})})]}),d&&N.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg max-h-48 overflow-y-auto",children:N.map((k,A)=>e.jsxs("button",{type:"button",onClick:()=>u(k),className:cr("w-full text-left px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center gap-2",y===A&&"bg-gray-100 dark:bg-gray-800"),children:[e.jsx(st,{className:"h-3 w-3 text-gray-500"}),k]},k))}),r.length>=i&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Maximum ",i," tags reached"]})]})}const qs=Kn("SwotForm");function kx(){const r={"Content-Type":"application/json"},t=localStorage.getItem("omnicore_token");t&&(r.Authorization=`Bearer ${t}`);const s=localStorage.getItem("user_hash");return s&&(r["X-User-Hash"]=s),r}const Nx=["Location Decision","Vendor Selection","Product Choice","Contract Evaluation","Manufacturer Comparison","Investment Decision","Technology Stack","Office Location","Warehouse Site","Store Location","Data Center","Vehicle Fleet","Equipment Purchase","Software Platform","Service Provider","Option A","Option B","Option C","Option D","Option E","Candidate 1","Candidate 2","Candidate 3","Final Decision","Preliminary Analysis","Due Diligence","Cost Analysis","Risk Assessment","Competitive Analysis","Q1 2025","Q2 2025","Q3 2025","Q4 2025","Short-term","Long-term","Urgent Decision","North America","Europe","Asia-Pacific","Latin America","Middle East","NYC","London","Singapore","Tokyo","Dubai","Berlin","Strategic","Operational","Tactical","Emergency Response"],Td=["Finance","HR","IT","Operations","Marketing","Sales","R&D","Legal","Compliance","Customer Support","Technology","Process","People","Strategy","Innovation","Culture","Infrastructure","Data","Security","Quality","Critical","High Priority","Medium Priority","Low Priority","Quick Win","Long-term Investment","Active","Planned","In Progress","Completed","On Hold"];function li({title:r,description:t,items:s,newItem:n,setNewItem:i,newItemAppliesTo:o,setNewItemAppliesTo:l,newItemTags:a,setNewItemTags:c,newItemConfidence:p,setNewItemConfidence:d,onAdd:m,onRemove:y,onEditItem:h,onMoveItem:_,color:b,icon:N,allData:u,options:v}){const[g,w]=B.useState(null),[k,A]=B.useState(""),[T,z]=B.useState(""),[S,U]=B.useState(""),[G,F]=B.useState([]),[C,j]=B.useState([]),D=W=>{w(W.id),A(W.text),z(W.details||""),U(W.confidence||""),F(W.tags||[]),j(W.appliesTo||[])},J=()=>{g&&k.trim()&&(h(g,{text:k.trim(),details:T.trim()||void 0,confidence:S||void 0,tags:G,appliesTo:C.length>0?C:void 0}),w(null),A(""),z(""),U(""),F([]),j([]))},q=()=>{w(null),A(""),z(""),U(""),F([]),j([])};return e.jsxs(ge,{className:`border-l-4 ${b}`,children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:N}),r]}),e.jsx(Le,{children:t})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 dark:bg-gray-900 border-2 border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ee,{placeholder:`Add a ${r.toLowerCase()}...`,value:n,onChange:W=>i(W.target.value),onKeyPress:W=>{W.key==="Enter"&&!W.shiftKey&&a.length===0&&!p&&(W.preventDefault(),m())},className:"flex-1"}),e.jsx(gs,{fieldName:r,currentValue:n,onAccept:W=>i(W),context:{framework:"SWOT Analysis",relatedFields:u?{title:u.title,description:u.description,strengths:u.strengths,weaknesses:u.weaknesses,opportunities:u.opportunities,threats:u.threats}:void 0},placeholder:`Add a ${r.toLowerCase()}...`})]}),(n.trim()||v&&v.length>0)&&e.jsxs("div",{className:"space-y-3 pt-2 border-t border-gray-200 dark:border-gray-700",children:[v&&v.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"ðŸ“‹ Applies To (Options)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.map((W,$)=>e.jsxs("label",{className:`inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-md cursor-pointer transition-all ${o.includes(W)?"bg-purple-600 text-white border-2 border-purple-700 shadow-sm":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-2 border-gray-300 dark:border-gray-600 hover:border-purple-400 dark:hover:border-purple-500"}`,children:[e.jsx("input",{type:"checkbox",checked:o.includes(W),onChange:ne=>{ne.target.checked?l([...o,W]):l(o.filter(K=>K!==W))},className:"sr-only"}),o.includes(W)&&e.jsx("span",{children:"âœ“"}),W]},$))}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1.5",children:o.length===0?"ðŸ’¡ None selected = applies to all options":`Selected: ${o.join(", ")}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"ðŸ·ï¸ Tags (Optional)"}),e.jsx(Xi,{tags:a,onChange:c,suggestions:Td,placeholder:"Add tags (e.g., Finance, High Priority)...",maxTags:5,className:"text-xs"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"ðŸŽ¯ Confidence Level (Optional)"}),e.jsx("div",{className:"flex gap-2",children:[{value:"",label:"Not Set",emoji:"âšª"},{value:"low",label:"Low",emoji:"ðŸ”´"},{value:"medium",label:"Medium",emoji:"ðŸŸ¡"},{value:"high",label:"High",emoji:"ðŸŸ¢"}].map(W=>e.jsx("button",{type:"button",onClick:()=>d(W.value),className:`flex-1 px-3 py-2 text-xs font-medium rounded-md border-2 transition-all ${p===W.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:border-blue-400 dark:hover:border-blue-500"}`,children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("span",{className:"text-base",children:W.emoji}),e.jsx("span",{children:W.label})]})},W.value))})]}),e.jsx("div",{className:"pt-2 border-t border-gray-300 dark:border-gray-600",children:e.jsxs(te,{onClick:m,disabled:!n.trim(),className:"w-full",size:"lg",children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),"Add ",r.slice(0,-1),(o.length>0||a.length>0||p)&&e.jsxs("span",{className:"ml-2 text-xs opacity-80",children:["(",[o.length>0&&`${o.length} option${o.length>1?"s":""}`,a.length>0&&`${a.length} tag${a.length>1?"s":""}`,p&&p].filter(Boolean).join(", "),")"]})]})})]}),!n.trim()&&!(v&&v.length>0)&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(te,{onClick:m,disabled:!n.trim(),size:"sm",variant:"outline",children:[e.jsx(st,{className:"h-4 w-4 mr-1"}),"Quick Add"]})})]}),e.jsx("div",{className:"space-y-2",children:s.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"No items added yet"}):s.map(W=>e.jsx("div",{className:"p-3 rounded-lg bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 space-y-2",children:g===W.id?e.jsxs("div",{className:"space-y-3 bg-white dark:bg-gray-900 p-3 rounded border-2 border-blue-300 dark:border-blue-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Item Text *"}),e.jsx(Ee,{value:k,onChange:$=>A($.target.value),onKeyPress:$=>{$.key==="Enter"&&!$.shiftKey&&J(),$.key==="Escape"&&q()},className:"text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Additional Details"}),e.jsx($e,{value:T,onChange:$=>z($.target.value),placeholder:"Add notes, context, or supporting information...",className:"text-sm",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Confidence / Certainty Level"}),e.jsxs("select",{value:S,onChange:$=>U($.target.value),className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:"",children:"No confidence level set"}),e.jsx("option",{value:"low",children:"ðŸ”´ Low - Uncertain or speculative"}),e.jsx("option",{value:"medium",children:"ðŸŸ¡ Medium - Reasonably confident"}),e.jsx("option",{value:"high",children:"ðŸŸ¢ High - Very confident / proven"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Tags"}),e.jsx(Xi,{tags:G,onChange:F,suggestions:Td,placeholder:"Add tags (e.g., Finance, High Priority, In Progress)...",maxTags:5,className:"text-xs"})]}),v&&v.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Applies To (Options)"}),e.jsxs("div",{className:"space-y-1.5",children:[v.map(($,ne)=>e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:C.includes($),onChange:K=>{K.target.checked?j([...C,$]):j(C.filter(P=>P!==$))},className:"rounded border-gray-300 dark:border-gray-600"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:$})]},ne)),C.length===0&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:"Not selected = applies to all options"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Move to Section"}),e.jsxs("select",{onChange:$=>{const ne=$.target.value;ne&&g&&(_(g,ne),q())},className:"w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",defaultValue:"",children:[e.jsxs("option",{value:"",children:["Keep in ",r]}),e.jsx("option",{value:"strengths",children:"ðŸ’ª Move to Strengths"}),e.jsx("option",{value:"weaknesses",children:"âš ï¸ Move to Weaknesses"}),e.jsx("option",{value:"opportunities",children:"ðŸŽ¯ Move to Opportunities"}),e.jsx("option",{value:"threats",children:"âš¡ Move to Threats"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs(te,{variant:"default",size:"sm",onClick:J,className:"flex-1",children:[e.jsx(on,{className:"h-3 w-3 mr-1"}),"Save Changes"]}),e.jsxs(te,{variant:"outline",size:"sm",onClick:q,children:[e.jsx(Ze,{className:"h-3 w-3 mr-1"}),"Cancel"]})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[W.confidence&&e.jsxs("span",{className:"text-lg",title:`Confidence: ${W.confidence}`,children:[W.confidence==="high"&&"ðŸŸ¢",W.confidence==="medium"&&"ðŸŸ¡",W.confidence==="low"&&"ðŸ”´"]}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-gray-100 flex-1",children:W.text})]}),W.details&&e.jsx("div",{className:"pl-6 text-xs text-gray-600 dark:text-gray-400 border-l-2 border-gray-300 dark:border-gray-600",children:W.details}),W.tags&&W.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 pl-6",children:W.tags.map(($,ne)=>e.jsxs(he,{className:"text-xs px-2.5 py-0.5 font-medium bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-200 border border-blue-300 dark:border-blue-700",children:["ðŸ·ï¸ ",$]},ne))}),W.appliesTo&&W.appliesTo.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1.5 pl-6",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mr-1",children:"Applies to:"}),W.appliesTo.map(($,ne)=>e.jsxs(he,{className:"text-xs px-2.5 py-0.5 font-medium bg-purple-100 dark:bg-purple-900/40 text-purple-800 dark:text-purple-200 border border-purple-300 dark:border-purple-700",children:["âœ“ ",$]},ne))]})]}),e.jsxs("div",{className:"flex flex-col gap-1",style:{flexShrink:0},children:[e.jsx("button",{onClick:()=>D(W),className:"px-3 py-1 text-xs font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded border border-blue-300",children:"Edit"}),e.jsx("button",{onClick:()=>y(W.id),className:"px-3 py-1 text-xs font-medium text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 rounded border border-red-300",children:"Delete"})]})]})})},W.id))}),e.jsxs(he,{variant:"secondary",children:[s.length," items"]})]})]})}function Id({initialData:r,mode:t,onSave:s}){const n=xr(),{currentWorkspaceId:i}=Kr(),[o,l]=B.useState(!1),[a,c]=B.useState(null),[p,d]=B.useState(null),[m,y]=B.useState(r?.title||""),[h,_]=B.useState(r?.description||""),[b,N]=B.useState(r?.goal||""),[u,v]=B.useState(r?.options||[]),[g,w]=B.useState(r?.tags||[]),[k,A]=B.useState(r?.strengths||[]),[T,z]=B.useState(r?.weaknesses||[]),[S,U]=B.useState(r?.opportunities||[]),[G,F]=B.useState(r?.threats||[]),[C,j]=B.useState(""),[D,J]=B.useState(""),[q,W]=B.useState(""),[$,ne]=B.useState(""),[K,P]=B.useState([]),[Y,re]=B.useState([]),[le,se]=B.useState([]),[R,I]=B.useState([]),[Q,X]=B.useState([]),[V,M]=B.useState([]),[oe,O]=B.useState([]),[ce,L]=B.useState([]),[f,x]=B.useState(""),[E,H]=B.useState(""),[ee,Z]=B.useState(""),[ue,pe]=B.useState(""),[ie,ke]=B.useState(!1),[Oe,De]=B.useState(!1),[gt,be]=B.useState(!1);B.useEffect(()=>{const Pe=`draft_swot_${t==="create"?"new":r?.title||"edit"}`,Be=setInterval(()=>{const Ve={title:m,description:h,goal:b,options:u,tags:g,strengths:k,weaknesses:T,opportunities:S,threats:G,timestamp:new Date().toISOString()};try{localStorage.setItem(Pe,JSON.stringify(Ve)),qs.debug("Auto-saved SWOT draft")}catch(zt){console.error("Failed to auto-save SWOT draft:",zt)}},3e4);return()=>clearInterval(Be)},[m,h,b,u,g,k,T,S,G,t,r]),B.useEffect(()=>{if(t==="create"&&!r){const Pe="draft_swot_new",Be=localStorage.getItem(Pe);if(Be)try{const Ve=JSON.parse(Be);if(Date.now()-new Date(Ve.timestamp).getTime()<1440*60*1e3){const St=`You have an unsaved SWOT draft from ${new Date(Ve.timestamp).toLocaleString()}.

Would you like to restore it and continue where you left off?

Click OK to restore, or Cancel to start fresh.`;confirm(St)?(y(Ve.title||""),_(Ve.description||""),N(Ve.goal||""),v(Ve.options||[]),w(Ve.tags||[]),A(Ve.strengths||[]),z(Ve.weaknesses||[]),U(Ve.opportunities||[]),F(Ve.threats||[])):localStorage.removeItem(Pe)}else localStorage.removeItem(Pe)}catch(Ve){console.error("Failed to restore SWOT draft:",Ve)}}},[t,r]);const we=(Pe,Be,Ve,zt,Gt,St,hr,Ke,Us,oi)=>{if(!Be.trim())return;const Da={id:crypto.randomUUID(),text:Be.trim(),appliesTo:Ve.length>0?Ve:void 0,tags:zt.length>0?zt:void 0,confidence:Gt||void 0};St(Ma=>[...Ma,Da]),hr(),Ke(),Us(),oi()},Se=(Pe,Be,Ve)=>{Ve(zt=>zt.filter(Gt=>Gt.id!==Be))},ye=(Pe,Be,Ve,zt)=>{zt(Gt=>Gt.map(St=>St.id===Be?{...St,...Ve}:St))},We=(Pe,Be,Ve)=>{if(Pe===Ve)return;const Gt={strengths:k,weaknesses:T,opportunities:S,threats:G}[Pe].find(Ke=>Ke.id===Be);if(!Gt)return;const St={strengths:A,weaknesses:z,opportunities:U,threats:F}[Pe];St(Ke=>Ke.filter(Us=>Us.id!==Be));const hr={strengths:A,weaknesses:z,opportunities:U,threats:F}[Ve];hr(Ke=>[...Ke,Gt])},Ot=async Pe=>{De(!0),be(!1),ke(!1);try{qs.info("Requesting auto-population for",Pe.length,"content sources");const Be=await fetch(`/api/frameworks/swot-auto-populate?workspace_id=${i}`,{method:"POST",headers:kx(),body:JSON.stringify({contentIds:Pe,title:m||void 0,workspace_id:i})});if(!Be.ok){const Ke=await Be.json();throw new Error(Ke.error||`Failed to auto-populate: ${Be.status}`)}const Ve=await Be.json();if(!Ve.success)throw new Error(Ve.error||"Auto-population failed");qs.info("Received",Ve.metadata.totalItems,"items for auto-population");const zt=Ve.strengths.map(Ke=>({id:crypto.randomUUID(),text:`${Ke.text}${Ke.source?` (Source: ${new URL(Ke.source).hostname})`:""}`})),Gt=Ve.weaknesses.map(Ke=>({id:crypto.randomUUID(),text:`${Ke.text}${Ke.source?` (Source: ${new URL(Ke.source).hostname})`:""}`})),St=Ve.opportunities.map(Ke=>({id:crypto.randomUUID(),text:`${Ke.text}${Ke.source?` (Source: ${new URL(Ke.source).hostname})`:""}`})),hr=Ve.threats.map(Ke=>({id:crypto.randomUUID(),text:`${Ke.text}${Ke.source?` (Source: ${new URL(Ke.source).hostname})`:""}`}));A(Ke=>[...Ke,...zt]),z(Ke=>[...Ke,...Gt]),U(Ke=>[...Ke,...St]),F(Ke=>[...Ke,...hr]),be(!0),qs.info("Successfully populated form with auto-generated items"),setTimeout(()=>be(!1),5e3)}catch(Be){console.error("[SWOT Auto-Populate] Error:",Be);const Ve=Be instanceof Error?Be.message:"Unknown error";alert(`Auto-population failed: ${Ve}

Please try again or add items manually.`)}finally{De(!1)}},Qt=async()=>{if(!m.trim()){c("Please enter a title for your analysis"),alert("Please enter a title for your SWOT analysis");return}l(!0),c(null);try{const Pe={title:m.trim(),description:h.trim(),goal:b.trim()||void 0,options:u.length>0?u:void 0,tags:g,strengths:k,weaknesses:T,opportunities:S,threats:G};qs.info("Saving SWOT analysis:",Pe),await s(Pe);const Be=`draft_swot_${t==="create"?"new":r?.title||"edit"}`;localStorage.removeItem(Be),d(new Date),qs.info("Successfully saved SWOT analysis"),setTimeout(()=>{n("/dashboard/analysis-frameworks/swot-dashboard")},500)}catch(Pe){console.error("Failed to save SWOT analysis:",Pe);const Be=Pe instanceof Error?Pe.message:"Unknown error";c(`Failed to save: ${Be}`),alert(`Failed to save SWOT analysis. ${Be}

Your data has been auto-saved locally. Please try again or contact support if the issue persists.`)}finally{l(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(te,{variant:"outline",onClick:()=>n("/dashboard/analysis-frameworks/swot-dashboard"),children:[e.jsx(Ir,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[t==="create"?"Create":"Edit"," SWOT Analysis"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Analyze Strengths, Weaknesses, Opportunities, and Threats"}),p&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:["âœ“ Saved at ",p.toLocaleTimeString()]})]})]}),e.jsxs(te,{onClick:Qt,disabled:o,children:[e.jsx(on,{className:"h-4 w-4 mr-2"}),o?"Saving...":"Save Analysis"]})]}),gt&&e.jsxs(Dt,{className:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:[e.jsx(ha,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),e.jsx(Mt,{className:"text-green-800 dark:text-green-200",children:"âœ“ Auto-population successful! AI-generated items have been added to your SWOT analysis. Review and edit them as needed before saving."})]}),a&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-red-600 dark:text-red-400 mt-0.5",children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-800 dark:text-red-200",children:"Save Failed"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:a}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-2",children:"Your data has been auto-saved locally and will be restored if you refresh the page."})]})]})}),e.jsxs(ge,{className:"border-purple-200 dark:border-purple-800 bg-gradient-to-r from-purple-50 via-blue-50 to-indigo-50 dark:from-purple-950/20 dark:via-blue-950/20 dark:to-indigo-950/20",children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"}),"AI-Powered Auto-Population"]}),e.jsx(Le,{children:"Let AI analyze your content and automatically generate SWOT items with source citations"})]}),e.jsx(xe,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(te,{variant:"outline",onClick:()=>ke(!0),disabled:Oe,className:"border-purple-300 hover:bg-purple-100 dark:border-purple-700 dark:hover:bg-purple-900/30",children:Oe?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:"â³"}),"Analyzing Content..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ft,{className:"h-4 w-4 mr-2"}),"Auto-Populate from Content"]})}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Select analyzed content from your library to auto-generate SWOT items"})]})})]}),e.jsx(_x,{open:ie,onOpenChange:ke,onConfirm:Ot,maxSelection:5}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:"Basic Information"}),e.jsx(Le,{children:"Provide a title, description, and tags for your analysis"})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Title *"}),e.jsx(Ee,{placeholder:"e.g., Q4 2025 Market Analysis",value:m,onChange:Pe=>y(Pe.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Description"}),e.jsx($e,{placeholder:"Provide context for this SWOT analysis...",value:h,onChange:Pe=>_(Pe.target.value),rows:3})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Goal / Decision",e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 font-normal ml-2",children:"(What are you trying to decide or accomplish?)"})]}),e.jsx(Ee,{placeholder:"e.g., Select office location, Choose vendor, Pick technology stack...",value:b,onChange:Pe=>N(Pe.target.value)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"ðŸ’¡ Tip: A clear goal helps focus your analysis and makes comparisons more meaningful"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Options Being Considered",e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 font-normal ml-2",children:"(List the choices you're evaluating)"})]}),e.jsx(Xi,{tags:u,onChange:v,suggestions:["Option A","Option B","Option C","NYC Office","London Office","Remote Only","Vendor 1","Vendor 2","In-House","Product A","Product B","Build Custom"],placeholder:"Add options (e.g., NYC Office, London Office, Remote Only)...",maxTags:10}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:[e.jsx("p",{className:"font-medium",children:"ðŸ’¡ Decision-Making Workflow:"}),e.jsxs("ul",{className:"list-disc list-inside pl-2 space-y-0.5 mt-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Single SWOT:"})," List all options here, then tag each item with which option(s) it applies to"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Multiple SWOTs:"})," Create separate SWOT for each option, add shared tags for comparison"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Example:"}),' Goal: "Choose office location" | Options: "NYC", "London", "Singapore"']})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Tags",e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 font-normal ml-2",children:"(Organize for comparison & decision-making)"})]}),e.jsx(Xi,{tags:g,onChange:w,suggestions:Nx,placeholder:"Add tags (e.g., Location Decision, NYC, Office Location)...",maxTags:10}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 space-y-1",children:[e.jsx("p",{className:"font-medium",children:"ðŸ’¡ Decision-Making Tips:"}),e.jsxs("ul",{className:"list-disc list-inside pl-2 space-y-0.5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Comparison sets:"}),' Tag with decision type (e.g., "Office Location") + specific option (e.g., "NYC")']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Multiple options:"})," Create separate SWOT for each (NYC, London, Singapore) with shared tag"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Merge later:"})," Use dashboard filter to compare all analyses with same tag"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Examples:"}),' "Vehicle Fleet" + "Tesla Model 3" | "Vendor Selection" + "Acme Corp" | "Contract Evaluation" + "Option A"']})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(li,{title:"Strengths",description:"Internal positive attributes and resources",items:k,newItem:C,setNewItem:j,newItemAppliesTo:K,setNewItemAppliesTo:P,newItemTags:Q,setNewItemTags:X,newItemConfidence:f,setNewItemConfidence:x,onAdd:()=>we("strengths",C,K,Q,f,A,()=>j(""),()=>P([]),()=>X([]),()=>x("")),onRemove:Pe=>Se("strengths",Pe,A),onEditItem:(Pe,Be)=>ye("strengths",Pe,Be,A),onMoveItem:(Pe,Be)=>We("strengths",Pe,Be),color:"border-green-500",icon:"ðŸ’ª",allData:{title:m,description:h,strengths:k,weaknesses:T,opportunities:S,threats:G},options:u}),e.jsx(li,{title:"Weaknesses",description:"Internal negative attributes and limitations",items:T,newItem:D,setNewItem:J,newItemAppliesTo:Y,setNewItemAppliesTo:re,newItemTags:V,setNewItemTags:M,newItemConfidence:E,setNewItemConfidence:H,onAdd:()=>we("weaknesses",D,Y,V,E,z,()=>J(""),()=>re([]),()=>M([]),()=>H("")),onRemove:Pe=>Se("weaknesses",Pe,z),onEditItem:(Pe,Be)=>ye("weaknesses",Pe,Be,z),onMoveItem:(Pe,Be)=>We("weaknesses",Pe,Be),color:"border-red-500",icon:"âš ï¸",allData:{title:m,description:h,strengths:k,weaknesses:T,opportunities:S,threats:G},options:u}),e.jsx(li,{title:"Opportunities",description:"External positive factors to leverage",items:S,newItem:q,setNewItem:W,newItemAppliesTo:le,setNewItemAppliesTo:se,newItemTags:oe,setNewItemTags:O,newItemConfidence:ee,setNewItemConfidence:Z,onAdd:()=>we("opportunities",q,le,oe,ee,U,()=>W(""),()=>se([]),()=>O([]),()=>Z("")),onRemove:Pe=>Se("opportunities",Pe,U),onEditItem:(Pe,Be)=>ye("opportunities",Pe,Be,U),onMoveItem:(Pe,Be)=>We("opportunities",Pe,Be),color:"border-blue-500",icon:"ðŸŽ¯",allData:{title:m,description:h,strengths:k,weaknesses:T,opportunities:S,threats:G},options:u}),e.jsx(li,{title:"Threats",description:"External negative factors to mitigate",items:G,newItem:$,setNewItem:ne,newItemAppliesTo:R,setNewItemAppliesTo:I,newItemTags:ce,setNewItemTags:L,newItemConfidence:ue,setNewItemConfidence:pe,onAdd:()=>we("threats",$,R,ce,ue,F,()=>ne(""),()=>I([]),()=>L([]),()=>pe("")),onRemove:Pe=>Se("threats",Pe,F),onEditItem:(Pe,Be)=>ye("threats",Pe,Be,F),onMoveItem:(Pe,Be)=>We("threats",Pe,Be),color:"border-orange-500",icon:"âš¡",allData:{title:m,description:h,strengths:k,weaknesses:T,opportunities:S,threats:G},options:u})]}),e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsx(Ae,{children:"Summary"})}),e.jsx(xe,{children:e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:k.length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Strengths"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:T.length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Weaknesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:S.length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Opportunities"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600 dark:text-orange-400",children:G.length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Threats"})]})]})})]})]})}function Cc(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var $s=Cc();function Fm(r){$s=r}var $n={exec:()=>null};function nt(r,t=""){let s=typeof r=="string"?r:r.source,n={replace:(i,o)=>{let l=typeof o=="string"?o:o.source;return l=l.replace(sr.caret,"$1"),s=s.replace(i,l),n},getRegex:()=>new RegExp(s,t)};return n}var sr={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:r=>new RegExp(`^( {0,3}${r})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}#`),htmlBeginRegex:r=>new RegExp(`^ {0,${Math.min(3,r-1)}}<(?:[a-z].*>|!--)`,"i")},Sx=/^(?:[ \t]*(?:\n|$))+/,Cx=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,Ex=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Jn=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Ax=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Ec=/(?:[*+-]|\d{1,9}[.)])/,Pm=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Lm=nt(Pm).replace(/bull/g,Ec).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Tx=nt(Pm).replace(/bull/g,Ec).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Ac=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Ix=/^[^\n]+/,Tc=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,Rx=nt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Tc).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Ox=nt(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Ec).getRegex(),ya="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Ic=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Fx=nt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Ic).replace("tag",ya).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Dm=nt(Ac).replace("hr",Jn).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ya).getRegex(),Px=nt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Dm).getRegex(),Rc={blockquote:Px,code:Cx,def:Rx,fences:Ex,heading:Ax,hr:Jn,html:Fx,lheading:Lm,list:Ox,newline:Sx,paragraph:Dm,table:$n,text:Ix},Rd=nt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Jn).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ya).getRegex(),Lx={...Rc,lheading:Tx,table:Rd,paragraph:nt(Ac).replace("hr",Jn).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Rd).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",ya).getRegex()},Dx={...Rc,html:nt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Ic).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:$n,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:nt(Ac).replace("hr",Jn).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Lm).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Mx=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,$x=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Mm=/^( {2,}|\\)\n(?!\s*$)/,Bx=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,ba=/[\p{P}\p{S}]/u,Oc=/[\s\p{P}\p{S}]/u,$m=/[^\s\p{P}\p{S}]/u,zx=nt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Oc).getRegex(),Bm=/(?!~)[\p{P}\p{S}]/u,Ux=/(?!~)[\s\p{P}\p{S}]/u,qx=/(?:[^\s\p{P}\p{S}]|~)/u,Wx=/\[[^\[\]]*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)|`[^`]*?`|<(?! )[^<>]*?>/g,zm=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Hx=nt(zm,"u").replace(/punct/g,ba).getRegex(),Gx=nt(zm,"u").replace(/punct/g,Bm).getRegex(),Um="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Vx=nt(Um,"gu").replace(/notPunctSpace/g,$m).replace(/punctSpace/g,Oc).replace(/punct/g,ba).getRegex(),Kx=nt(Um,"gu").replace(/notPunctSpace/g,qx).replace(/punctSpace/g,Ux).replace(/punct/g,Bm).getRegex(),Xx=nt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,$m).replace(/punctSpace/g,Oc).replace(/punct/g,ba).getRegex(),Yx=nt(/\\(punct)/,"gu").replace(/punct/g,ba).getRegex(),Jx=nt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Qx=nt(Ic).replace("(?:-->|$)","-->").getRegex(),Zx=nt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Qx).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Yi=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`[^`]*`|[^\[\]\\`])*?/,e0=nt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Yi).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),qm=nt(/^!?\[(label)\]\[(ref)\]/).replace("label",Yi).replace("ref",Tc).getRegex(),Wm=nt(/^!?\[(ref)\](?:\[\])?/).replace("ref",Tc).getRegex(),t0=nt("reflink|nolink(?!\\()","g").replace("reflink",qm).replace("nolink",Wm).getRegex(),Fc={_backpedal:$n,anyPunctuation:Yx,autolink:Jx,blockSkip:Wx,br:Mm,code:$x,del:$n,emStrongLDelim:Hx,emStrongRDelimAst:Vx,emStrongRDelimUnd:Xx,escape:Mx,link:e0,nolink:Wm,punctuation:zx,reflink:qm,reflinkSearch:t0,tag:Zx,text:Bx,url:$n},r0={...Fc,link:nt(/^!?\[(label)\]\((.*?)\)/).replace("label",Yi).getRegex(),reflink:nt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Yi).getRegex()},Yl={...Fc,emStrongRDelimAst:Kx,emStrongLDelim:Gx,url:nt(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},s0={...Yl,br:nt(Mm).replace("{2,}","*").getRegex(),text:nt(Yl.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},ci={normal:Rc,gfm:Lx,pedantic:Dx},bn={normal:Fc,gfm:Yl,breaks:s0,pedantic:r0},n0={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Od=r=>n0[r];function Lr(r,t){if(t){if(sr.escapeTest.test(r))return r.replace(sr.escapeReplace,Od)}else if(sr.escapeTestNoEncode.test(r))return r.replace(sr.escapeReplaceNoEncode,Od);return r}function Fd(r){try{r=encodeURI(r).replace(sr.percentDecode,"%")}catch{return null}return r}function Pd(r,t){let s=r.replace(sr.findPipe,(o,l,a)=>{let c=!1,p=l;for(;--p>=0&&a[p]==="\\";)c=!c;return c?"|":" |"}),n=s.split(sr.splitPipe),i=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;i<n.length;i++)n[i]=n[i].trim().replace(sr.slashPipe,"|");return n}function vn(r,t,s){let n=r.length;if(n===0)return"";let i=0;for(;i<n&&r.charAt(n-i-1)===t;)i++;return r.slice(0,n-i)}function i0(r,t){if(r.indexOf(t[1])===-1)return-1;let s=0;for(let n=0;n<r.length;n++)if(r[n]==="\\")n++;else if(r[n]===t[0])s++;else if(r[n]===t[1]&&(s--,s<0))return n;return s>0?-2:-1}function Ld(r,t,s,n,i){let o=t.href,l=t.title||null,a=r[1].replace(i.other.outputLinkReplace,"$1");n.state.inLink=!0;let c={type:r[0].charAt(0)==="!"?"image":"link",raw:s,href:o,title:l,text:a,tokens:n.inlineTokens(a)};return n.state.inLink=!1,c}function a0(r,t,s){let n=r.match(s.other.indentCodeCompensation);if(n===null)return t;let i=n[1];return t.split(`
`).map(o=>{let l=o.match(s.other.beginningSpace);if(l===null)return o;let[a]=l;return a.length>=i.length?o.slice(i.length):o}).join(`
`)}var Ji=class{constructor(r){at(this,"options");at(this,"rules");at(this,"lexer");this.options=r||$s}space(r){let t=this.rules.block.newline.exec(r);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(r){let t=this.rules.block.code.exec(r);if(t){let s=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?s:vn(s,`
`)}}}fences(r){let t=this.rules.block.fences.exec(r);if(t){let s=t[0],n=a0(s,t[3]||"",this.rules);return{type:"code",raw:s,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(r){let t=this.rules.block.heading.exec(r);if(t){let s=t[2].trim();if(this.rules.other.endingHash.test(s)){let n=vn(s,"#");(this.options.pedantic||!n||this.rules.other.endingSpaceChar.test(n))&&(s=n.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:s,tokens:this.lexer.inline(s)}}}hr(r){let t=this.rules.block.hr.exec(r);if(t)return{type:"hr",raw:vn(t[0],`
`)}}blockquote(r){let t=this.rules.block.blockquote.exec(r);if(t){let s=vn(t[0],`
`).split(`
`),n="",i="",o=[];for(;s.length>0;){let l=!1,a=[],c;for(c=0;c<s.length;c++)if(this.rules.other.blockquoteStart.test(s[c]))a.push(s[c]),l=!0;else if(!l)a.push(s[c]);else break;s=s.slice(c);let p=a.join(`
`),d=p.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}
${p}`:p,i=i?`${i}
${d}`:d;let m=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(d,o,!0),this.lexer.state.top=m,s.length===0)break;let y=o.at(-1);if(y?.type==="code")break;if(y?.type==="blockquote"){let h=y,_=h.raw+`
`+s.join(`
`),b=this.blockquote(_);o[o.length-1]=b,n=n.substring(0,n.length-h.raw.length)+b.raw,i=i.substring(0,i.length-h.text.length)+b.text;break}else if(y?.type==="list"){let h=y,_=h.raw+`
`+s.join(`
`),b=this.list(_);o[o.length-1]=b,n=n.substring(0,n.length-y.raw.length)+b.raw,i=i.substring(0,i.length-h.raw.length)+b.raw,s=_.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:n,tokens:o,text:i}}}list(r){let t=this.rules.block.list.exec(r);if(t){let s=t[1].trim(),n=s.length>1,i={type:"list",raw:"",ordered:n,start:n?+s.slice(0,-1):"",loose:!1,items:[]};s=n?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=n?s:"[*+-]");let o=this.rules.other.listItemRegex(s),l=!1;for(;r;){let c=!1,p="",d="";if(!(t=o.exec(r))||this.rules.block.hr.test(r))break;p=t[0],r=r.substring(p.length);let m=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,u=>" ".repeat(3*u.length)),y=r.split(`
`,1)[0],h=!m.trim(),_=0;if(this.options.pedantic?(_=2,d=m.trimStart()):h?_=t[1].length+1:(_=t[2].search(this.rules.other.nonSpaceChar),_=_>4?1:_,d=m.slice(_),_+=t[1].length),h&&this.rules.other.blankLine.test(y)&&(p+=y+`
`,r=r.substring(y.length+1),c=!0),!c){let u=this.rules.other.nextBulletRegex(_),v=this.rules.other.hrRegex(_),g=this.rules.other.fencesBeginRegex(_),w=this.rules.other.headingBeginRegex(_),k=this.rules.other.htmlBeginRegex(_);for(;r;){let A=r.split(`
`,1)[0],T;if(y=A,this.options.pedantic?(y=y.replace(this.rules.other.listReplaceNesting,"  "),T=y):T=y.replace(this.rules.other.tabCharGlobal,"    "),g.test(y)||w.test(y)||k.test(y)||u.test(y)||v.test(y))break;if(T.search(this.rules.other.nonSpaceChar)>=_||!y.trim())d+=`
`+T.slice(_);else{if(h||m.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||g.test(m)||w.test(m)||v.test(m))break;d+=`
`+y}!h&&!y.trim()&&(h=!0),p+=A+`
`,r=r.substring(A.length+1),m=T.slice(_)}}i.loose||(l?i.loose=!0:this.rules.other.doubleBlankLine.test(p)&&(l=!0));let b=null,N;this.options.gfm&&(b=this.rules.other.listIsTask.exec(d),b&&(N=b[0]!=="[ ] ",d=d.replace(this.rules.other.listReplaceTask,""))),i.items.push({type:"list_item",raw:p,task:!!b,checked:N,loose:!1,text:d,tokens:[]}),i.raw+=p}let a=i.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;i.raw=i.raw.trimEnd();for(let c=0;c<i.items.length;c++)if(this.lexer.state.top=!1,i.items[c].tokens=this.lexer.blockTokens(i.items[c].text,[]),!i.loose){let p=i.items[c].tokens.filter(m=>m.type==="space"),d=p.length>0&&p.some(m=>this.rules.other.anyLine.test(m.raw));i.loose=d}if(i.loose)for(let c=0;c<i.items.length;c++)i.items[c].loose=!0;return i}}html(r){let t=this.rules.block.html.exec(r);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(r){let t=this.rules.block.def.exec(r);if(t){let s=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",i=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:s,raw:t[0],href:n,title:i}}}table(r){let t=this.rules.block.table.exec(r);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let s=Pd(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),i=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:t[0],header:[],align:[],rows:[]};if(s.length===n.length){for(let l of n)this.rules.other.tableAlignRight.test(l)?o.align.push("right"):this.rules.other.tableAlignCenter.test(l)?o.align.push("center"):this.rules.other.tableAlignLeft.test(l)?o.align.push("left"):o.align.push(null);for(let l=0;l<s.length;l++)o.header.push({text:s[l],tokens:this.lexer.inline(s[l]),header:!0,align:o.align[l]});for(let l of i)o.rows.push(Pd(l,o.header.length).map((a,c)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:o.align[c]})));return o}}lheading(r){let t=this.rules.block.lheading.exec(r);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(r){let t=this.rules.block.paragraph.exec(r);if(t){let s=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:s,tokens:this.lexer.inline(s)}}}text(r){let t=this.rules.block.text.exec(r);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(r){let t=this.rules.inline.escape.exec(r);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(r){let t=this.rules.inline.tag.exec(r);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(r){let t=this.rules.inline.link.exec(r);if(t){let s=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(s)){if(!this.rules.other.endAngleBracket.test(s))return;let o=vn(s.slice(0,-1),"\\");if((s.length-o.length)%2===0)return}else{let o=i0(t[2],"()");if(o===-2)return;if(o>-1){let l=(t[0].indexOf("!")===0?5:4)+t[1].length+o;t[2]=t[2].substring(0,o),t[0]=t[0].substring(0,l).trim(),t[3]=""}}let n=t[2],i="";if(this.options.pedantic){let o=this.rules.other.pedanticHrefTitle.exec(n);o&&(n=o[1],i=o[3])}else i=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(s)?n=n.slice(1):n=n.slice(1,-1)),Ld(t,{href:n&&n.replace(this.rules.inline.anyPunctuation,"$1"),title:i&&i.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(r,t){let s;if((s=this.rules.inline.reflink.exec(r))||(s=this.rules.inline.nolink.exec(r))){let n=(s[2]||s[1]).replace(this.rules.other.multipleSpaceGlobal," "),i=t[n.toLowerCase()];if(!i){let o=s[0].charAt(0);return{type:"text",raw:o,text:o}}return Ld(s,i,s[0],this.lexer,this.rules)}}emStrong(r,t,s=""){let n=this.rules.inline.emStrongLDelim.exec(r);if(!(!n||n[3]&&s.match(this.rules.other.unicodeAlphaNumeric))&&(!(n[1]||n[2])||!s||this.rules.inline.punctuation.exec(s))){let i=[...n[0]].length-1,o,l,a=i,c=0,p=n[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(p.lastIndex=0,t=t.slice(-1*r.length+i);(n=p.exec(t))!=null;){if(o=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!o)continue;if(l=[...o].length,n[3]||n[4]){a+=l;continue}else if((n[5]||n[6])&&i%3&&!((i+l)%3)){c+=l;continue}if(a-=l,a>0)continue;l=Math.min(l,l+a+c);let d=[...n[0]][0].length,m=r.slice(0,i+n.index+d+l);if(Math.min(i,l)%2){let h=m.slice(1,-1);return{type:"em",raw:m,text:h,tokens:this.lexer.inlineTokens(h)}}let y=m.slice(2,-2);return{type:"strong",raw:m,text:y,tokens:this.lexer.inlineTokens(y)}}}}codespan(r){let t=this.rules.inline.code.exec(r);if(t){let s=t[2].replace(this.rules.other.newLineCharGlobal," "),n=this.rules.other.nonSpaceChar.test(s),i=this.rules.other.startingSpaceChar.test(s)&&this.rules.other.endingSpaceChar.test(s);return n&&i&&(s=s.substring(1,s.length-1)),{type:"codespan",raw:t[0],text:s}}}br(r){let t=this.rules.inline.br.exec(r);if(t)return{type:"br",raw:t[0]}}del(r){let t=this.rules.inline.del.exec(r);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(r){let t=this.rules.inline.autolink.exec(r);if(t){let s,n;return t[2]==="@"?(s=t[1],n="mailto:"+s):(s=t[1],n=s),{type:"link",raw:t[0],text:s,href:n,tokens:[{type:"text",raw:s,text:s}]}}}url(r){let t;if(t=this.rules.inline.url.exec(r)){let s,n;if(t[2]==="@")s=t[0],n="mailto:"+s;else{let i;do i=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(i!==t[0]);s=t[0],t[1]==="www."?n="http://"+t[0]:n=t[0]}return{type:"link",raw:t[0],text:s,href:n,tokens:[{type:"text",raw:s,text:s}]}}}inlineText(r){let t=this.rules.inline.text.exec(r);if(t){let s=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:s}}}},ss=class Jl{constructor(t){at(this,"tokens");at(this,"options");at(this,"state");at(this,"tokenizer");at(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=t||$s,this.options.tokenizer=this.options.tokenizer||new Ji,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let s={other:sr,block:ci.normal,inline:bn.normal};this.options.pedantic?(s.block=ci.pedantic,s.inline=bn.pedantic):this.options.gfm&&(s.block=ci.gfm,this.options.breaks?s.inline=bn.breaks:s.inline=bn.gfm),this.tokenizer.rules=s}static get rules(){return{block:ci,inline:bn}}static lex(t,s){return new Jl(s).lex(t)}static lexInline(t,s){return new Jl(s).inlineTokens(t)}lex(t){t=t.replace(sr.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let s=0;s<this.inlineQueue.length;s++){let n=this.inlineQueue[s];this.inlineTokens(n.src,n.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,s=[],n=!1){for(this.options.pedantic&&(t=t.replace(sr.tabCharGlobal,"    ").replace(sr.spaceLine,""));t;){let i;if(this.options.extensions?.block?.some(l=>(i=l.call({lexer:this},t,s))?(t=t.substring(i.raw.length),s.push(i),!0):!1))continue;if(i=this.tokenizer.space(t)){t=t.substring(i.raw.length);let l=s.at(-1);i.raw.length===1&&l!==void 0?l.raw+=`
`:s.push(i);continue}if(i=this.tokenizer.code(t)){t=t.substring(i.raw.length);let l=s.at(-1);l?.type==="paragraph"||l?.type==="text"?(l.raw+=(l.raw.endsWith(`
`)?"":`
`)+i.raw,l.text+=`
`+i.text,this.inlineQueue.at(-1).src=l.text):s.push(i);continue}if(i=this.tokenizer.fences(t)){t=t.substring(i.raw.length),s.push(i);continue}if(i=this.tokenizer.heading(t)){t=t.substring(i.raw.length),s.push(i);continue}if(i=this.tokenizer.hr(t)){t=t.substring(i.raw.length),s.push(i);continue}if(i=this.tokenizer.blockquote(t)){t=t.substring(i.raw.length),s.push(i);continue}if(i=this.tokenizer.list(t)){t=t.substring(i.raw.length),s.push(i);continue}if(i=this.tokenizer.html(t)){t=t.substring(i.raw.length),s.push(i);continue}if(i=this.tokenizer.def(t)){t=t.substring(i.raw.length);let l=s.at(-1);l?.type==="paragraph"||l?.type==="text"?(l.raw+=(l.raw.endsWith(`
`)?"":`
`)+i.raw,l.text+=`
`+i.raw,this.inlineQueue.at(-1).src=l.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title},s.push(i));continue}if(i=this.tokenizer.table(t)){t=t.substring(i.raw.length),s.push(i);continue}if(i=this.tokenizer.lheading(t)){t=t.substring(i.raw.length),s.push(i);continue}let o=t;if(this.options.extensions?.startBlock){let l=1/0,a=t.slice(1),c;this.options.extensions.startBlock.forEach(p=>{c=p.call({lexer:this},a),typeof c=="number"&&c>=0&&(l=Math.min(l,c))}),l<1/0&&l>=0&&(o=t.substring(0,l+1))}if(this.state.top&&(i=this.tokenizer.paragraph(o))){let l=s.at(-1);n&&l?.type==="paragraph"?(l.raw+=(l.raw.endsWith(`
`)?"":`
`)+i.raw,l.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=l.text):s.push(i),n=o.length!==t.length,t=t.substring(i.raw.length);continue}if(i=this.tokenizer.text(t)){t=t.substring(i.raw.length);let l=s.at(-1);l?.type==="text"?(l.raw+=(l.raw.endsWith(`
`)?"":`
`)+i.raw,l.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=l.text):s.push(i);continue}if(t){let l="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(l);break}else throw new Error(l)}}return this.state.top=!0,s}inline(t,s=[]){return this.inlineQueue.push({src:t,tokens:s}),s}inlineTokens(t,s=[]){let n=t,i=null;if(this.tokens.links){let a=Object.keys(this.tokens.links);if(a.length>0)for(;(i=this.tokenizer.rules.inline.reflinkSearch.exec(n))!=null;)a.includes(i[0].slice(i[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(i=this.tokenizer.rules.inline.anyPunctuation.exec(n))!=null;)n=n.slice(0,i.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(i=this.tokenizer.rules.inline.blockSkip.exec(n))!=null;)n=n.slice(0,i.index)+"["+"a".repeat(i[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);n=this.options.hooks?.emStrongMask?.call({lexer:this},n)??n;let o=!1,l="";for(;t;){o||(l=""),o=!1;let a;if(this.options.extensions?.inline?.some(p=>(a=p.call({lexer:this},t,s))?(t=t.substring(a.raw.length),s.push(a),!0):!1))continue;if(a=this.tokenizer.escape(t)){t=t.substring(a.raw.length),s.push(a);continue}if(a=this.tokenizer.tag(t)){t=t.substring(a.raw.length),s.push(a);continue}if(a=this.tokenizer.link(t)){t=t.substring(a.raw.length),s.push(a);continue}if(a=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(a.raw.length);let p=s.at(-1);a.type==="text"&&p?.type==="text"?(p.raw+=a.raw,p.text+=a.text):s.push(a);continue}if(a=this.tokenizer.emStrong(t,n,l)){t=t.substring(a.raw.length),s.push(a);continue}if(a=this.tokenizer.codespan(t)){t=t.substring(a.raw.length),s.push(a);continue}if(a=this.tokenizer.br(t)){t=t.substring(a.raw.length),s.push(a);continue}if(a=this.tokenizer.del(t)){t=t.substring(a.raw.length),s.push(a);continue}if(a=this.tokenizer.autolink(t)){t=t.substring(a.raw.length),s.push(a);continue}if(!this.state.inLink&&(a=this.tokenizer.url(t))){t=t.substring(a.raw.length),s.push(a);continue}let c=t;if(this.options.extensions?.startInline){let p=1/0,d=t.slice(1),m;this.options.extensions.startInline.forEach(y=>{m=y.call({lexer:this},d),typeof m=="number"&&m>=0&&(p=Math.min(p,m))}),p<1/0&&p>=0&&(c=t.substring(0,p+1))}if(a=this.tokenizer.inlineText(c)){t=t.substring(a.raw.length),a.raw.slice(-1)!=="_"&&(l=a.raw.slice(-1)),o=!0;let p=s.at(-1);p?.type==="text"?(p.raw+=a.raw,p.text+=a.text):s.push(a);continue}if(t){let p="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(p);break}else throw new Error(p)}}return s}},Qi=class{constructor(r){at(this,"options");at(this,"parser");this.options=r||$s}space(r){return""}code({text:r,lang:t,escaped:s}){let n=(t||"").match(sr.notSpaceStart)?.[0],i=r.replace(sr.endingNewline,"")+`
`;return n?'<pre><code class="language-'+Lr(n)+'">'+(s?i:Lr(i,!0))+`</code></pre>
`:"<pre><code>"+(s?i:Lr(i,!0))+`</code></pre>
`}blockquote({tokens:r}){return`<blockquote>
${this.parser.parse(r)}</blockquote>
`}html({text:r}){return r}def(r){return""}heading({tokens:r,depth:t}){return`<h${t}>${this.parser.parseInline(r)}</h${t}>
`}hr(r){return`<hr>
`}list(r){let t=r.ordered,s=r.start,n="";for(let l=0;l<r.items.length;l++){let a=r.items[l];n+=this.listitem(a)}let i=t?"ol":"ul",o=t&&s!==1?' start="'+s+'"':"";return"<"+i+o+`>
`+n+"</"+i+`>
`}listitem(r){let t="";if(r.task){let s=this.checkbox({checked:!!r.checked});r.loose?r.tokens[0]?.type==="paragraph"?(r.tokens[0].text=s+" "+r.tokens[0].text,r.tokens[0].tokens&&r.tokens[0].tokens.length>0&&r.tokens[0].tokens[0].type==="text"&&(r.tokens[0].tokens[0].text=s+" "+Lr(r.tokens[0].tokens[0].text),r.tokens[0].tokens[0].escaped=!0)):r.tokens.unshift({type:"text",raw:s+" ",text:s+" ",escaped:!0}):t+=s+" "}return t+=this.parser.parse(r.tokens,!!r.loose),`<li>${t}</li>
`}checkbox({checked:r}){return"<input "+(r?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:r}){return`<p>${this.parser.parseInline(r)}</p>
`}table(r){let t="",s="";for(let i=0;i<r.header.length;i++)s+=this.tablecell(r.header[i]);t+=this.tablerow({text:s});let n="";for(let i=0;i<r.rows.length;i++){let o=r.rows[i];s="";for(let l=0;l<o.length;l++)s+=this.tablecell(o[l]);n+=this.tablerow({text:s})}return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow({text:r}){return`<tr>
${r}</tr>
`}tablecell(r){let t=this.parser.parseInline(r.tokens),s=r.header?"th":"td";return(r.align?`<${s} align="${r.align}">`:`<${s}>`)+t+`</${s}>
`}strong({tokens:r}){return`<strong>${this.parser.parseInline(r)}</strong>`}em({tokens:r}){return`<em>${this.parser.parseInline(r)}</em>`}codespan({text:r}){return`<code>${Lr(r,!0)}</code>`}br(r){return"<br>"}del({tokens:r}){return`<del>${this.parser.parseInline(r)}</del>`}link({href:r,title:t,tokens:s}){let n=this.parser.parseInline(s),i=Fd(r);if(i===null)return n;r=i;let o='<a href="'+r+'"';return t&&(o+=' title="'+Lr(t)+'"'),o+=">"+n+"</a>",o}image({href:r,title:t,text:s,tokens:n}){n&&(s=this.parser.parseInline(n,this.parser.textRenderer));let i=Fd(r);if(i===null)return Lr(s);r=i;let o=`<img src="${r}" alt="${s}"`;return t&&(o+=` title="${Lr(t)}"`),o+=">",o}text(r){return"tokens"in r&&r.tokens?this.parser.parseInline(r.tokens):"escaped"in r&&r.escaped?r.text:Lr(r.text)}},Pc=class{strong({text:r}){return r}em({text:r}){return r}codespan({text:r}){return r}del({text:r}){return r}html({text:r}){return r}text({text:r}){return r}link({text:r}){return""+r}image({text:r}){return""+r}br(){return""}},ns=class Ql{constructor(t){at(this,"options");at(this,"renderer");at(this,"textRenderer");this.options=t||$s,this.options.renderer=this.options.renderer||new Qi,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Pc}static parse(t,s){return new Ql(s).parse(t)}static parseInline(t,s){return new Ql(s).parseInline(t)}parse(t,s=!0){let n="";for(let i=0;i<t.length;i++){let o=t[i];if(this.options.extensions?.renderers?.[o.type]){let a=o,c=this.options.extensions.renderers[a.type].call({parser:this},a);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(a.type)){n+=c||"";continue}}let l=o;switch(l.type){case"space":{n+=this.renderer.space(l);continue}case"hr":{n+=this.renderer.hr(l);continue}case"heading":{n+=this.renderer.heading(l);continue}case"code":{n+=this.renderer.code(l);continue}case"table":{n+=this.renderer.table(l);continue}case"blockquote":{n+=this.renderer.blockquote(l);continue}case"list":{n+=this.renderer.list(l);continue}case"html":{n+=this.renderer.html(l);continue}case"def":{n+=this.renderer.def(l);continue}case"paragraph":{n+=this.renderer.paragraph(l);continue}case"text":{let a=l,c=this.renderer.text(a);for(;i+1<t.length&&t[i+1].type==="text";)a=t[++i],c+=`
`+this.renderer.text(a);s?n+=this.renderer.paragraph({type:"paragraph",raw:c,text:c,tokens:[{type:"text",raw:c,text:c,escaped:!0}]}):n+=c;continue}default:{let a='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}parseInline(t,s=this.renderer){let n="";for(let i=0;i<t.length;i++){let o=t[i];if(this.options.extensions?.renderers?.[o.type]){let a=this.options.extensions.renderers[o.type].call({parser:this},o);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=a||"";continue}}let l=o;switch(l.type){case"escape":{n+=s.text(l);break}case"html":{n+=s.html(l);break}case"link":{n+=s.link(l);break}case"image":{n+=s.image(l);break}case"strong":{n+=s.strong(l);break}case"em":{n+=s.em(l);break}case"codespan":{n+=s.codespan(l);break}case"br":{n+=s.br(l);break}case"del":{n+=s.del(l);break}case"text":{n+=s.text(l);break}default:{let a='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return n}},Oi,En=(Oi=class{constructor(r){at(this,"options");at(this,"block");this.options=r||$s}preprocess(r){return r}postprocess(r){return r}processAllTokens(r){return r}emStrongMask(r){return r}provideLexer(){return this.block?ss.lex:ss.lexInline}provideParser(){return this.block?ns.parse:ns.parseInline}},at(Oi,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),at(Oi,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),Oi),o0=class{constructor(...r){at(this,"defaults",Cc());at(this,"options",this.setOptions);at(this,"parse",this.parseMarkdown(!0));at(this,"parseInline",this.parseMarkdown(!1));at(this,"Parser",ns);at(this,"Renderer",Qi);at(this,"TextRenderer",Pc);at(this,"Lexer",ss);at(this,"Tokenizer",Ji);at(this,"Hooks",En);this.use(...r)}walkTokens(r,t){let s=[];for(let n of r)switch(s=s.concat(t.call(this,n)),n.type){case"table":{let i=n;for(let o of i.header)s=s.concat(this.walkTokens(o.tokens,t));for(let o of i.rows)for(let l of o)s=s.concat(this.walkTokens(l.tokens,t));break}case"list":{let i=n;s=s.concat(this.walkTokens(i.items,t));break}default:{let i=n;this.defaults.extensions?.childTokens?.[i.type]?this.defaults.extensions.childTokens[i.type].forEach(o=>{let l=i[o].flat(1/0);s=s.concat(this.walkTokens(l,t))}):i.tokens&&(s=s.concat(this.walkTokens(i.tokens,t)))}}return s}use(...r){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return r.forEach(s=>{let n={...s};if(n.async=this.defaults.async||n.async||!1,s.extensions&&(s.extensions.forEach(i=>{if(!i.name)throw new Error("extension name required");if("renderer"in i){let o=t.renderers[i.name];o?t.renderers[i.name]=function(...l){let a=i.renderer.apply(this,l);return a===!1&&(a=o.apply(this,l)),a}:t.renderers[i.name]=i.renderer}if("tokenizer"in i){if(!i.level||i.level!=="block"&&i.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let o=t[i.level];o?o.unshift(i.tokenizer):t[i.level]=[i.tokenizer],i.start&&(i.level==="block"?t.startBlock?t.startBlock.push(i.start):t.startBlock=[i.start]:i.level==="inline"&&(t.startInline?t.startInline.push(i.start):t.startInline=[i.start]))}"childTokens"in i&&i.childTokens&&(t.childTokens[i.name]=i.childTokens)}),n.extensions=t),s.renderer){let i=this.defaults.renderer||new Qi(this.defaults);for(let o in s.renderer){if(!(o in i))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;let l=o,a=s.renderer[l],c=i[l];i[l]=(...p)=>{let d=a.apply(i,p);return d===!1&&(d=c.apply(i,p)),d||""}}n.renderer=i}if(s.tokenizer){let i=this.defaults.tokenizer||new Ji(this.defaults);for(let o in s.tokenizer){if(!(o in i))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;let l=o,a=s.tokenizer[l],c=i[l];i[l]=(...p)=>{let d=a.apply(i,p);return d===!1&&(d=c.apply(i,p)),d}}n.tokenizer=i}if(s.hooks){let i=this.defaults.hooks||new En;for(let o in s.hooks){if(!(o in i))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;let l=o,a=s.hooks[l],c=i[l];En.passThroughHooks.has(o)?i[l]=p=>{if(this.defaults.async&&En.passThroughHooksRespectAsync.has(o))return Promise.resolve(a.call(i,p)).then(m=>c.call(i,m));let d=a.call(i,p);return c.call(i,d)}:i[l]=(...p)=>{let d=a.apply(i,p);return d===!1&&(d=c.apply(i,p)),d}}n.hooks=i}if(s.walkTokens){let i=this.defaults.walkTokens,o=s.walkTokens;n.walkTokens=function(l){let a=[];return a.push(o.call(this,l)),i&&(a=a.concat(i.call(this,l))),a}}this.defaults={...this.defaults,...n}}),this}setOptions(r){return this.defaults={...this.defaults,...r},this}lexer(r,t){return ss.lex(r,t??this.defaults)}parser(r,t){return ns.parse(r,t??this.defaults)}parseMarkdown(r){return(t,s)=>{let n={...s},i={...this.defaults,...n},o=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&n.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));i.hooks&&(i.hooks.options=i,i.hooks.block=r);let l=i.hooks?i.hooks.provideLexer():r?ss.lex:ss.lexInline,a=i.hooks?i.hooks.provideParser():r?ns.parse:ns.parseInline;if(i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(t):t).then(c=>l(c,i)).then(c=>i.hooks?i.hooks.processAllTokens(c):c).then(c=>i.walkTokens?Promise.all(this.walkTokens(c,i.walkTokens)).then(()=>c):c).then(c=>a(c,i)).then(c=>i.hooks?i.hooks.postprocess(c):c).catch(o);try{i.hooks&&(t=i.hooks.preprocess(t));let c=l(t,i);i.hooks&&(c=i.hooks.processAllTokens(c)),i.walkTokens&&this.walkTokens(c,i.walkTokens);let p=a(c,i);return i.hooks&&(p=i.hooks.postprocess(p)),p}catch(c){return o(c)}}}onError(r,t){return s=>{if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,r){let n="<p>An error occurred:</p><pre>"+Lr(s.message+"",!0)+"</pre>";return t?Promise.resolve(n):n}if(t)return Promise.reject(s);throw s}}},Ds=new o0;function it(r,t){return Ds.parse(r,t)}it.options=it.setOptions=function(r){return Ds.setOptions(r),it.defaults=Ds.defaults,Fm(it.defaults),it};it.getDefaults=Cc;it.defaults=$s;it.use=function(...r){return Ds.use(...r),it.defaults=Ds.defaults,Fm(it.defaults),it};it.walkTokens=function(r,t){return Ds.walkTokens(r,t)};it.parseInline=Ds.parseInline;it.Parser=ns;it.parser=ns.parse;it.Renderer=Qi;it.TextRenderer=Pc;it.Lexer=ss;it.lexer=ss.lex;it.Tokenizer=Ji;it.Hooks=En;it.parse=it;it.options;it.setOptions;it.use;it.walkTokens;it.parseInline;ns.parse;ss.lex;function l0({open:r,onOpenChange:t,title:s,content:n,onDownload:i}){const[o,l]=B.useState(!1),a=async()=>{try{await navigator.clipboard.writeText(n),l(!0),setTimeout(()=>l(!1),2e3)}catch(p){console.error("Failed to copy:",p),alert("Failed to copy to clipboard")}},c=gx.sanitize(it.parse(n));return e.jsx(wt,{open:r,onOpenChange:t,children:e.jsxs(jt,{className:"max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs(_t,{children:[e.jsxs(kt,{className:"flex items-center justify-between",children:[e.jsx("span",{children:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{variant:"outline",size:"sm",onClick:a,className:"gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx($t,{className:"h-4 w-4"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(_c,{className:"h-4 w-4"}),"Copy"]})}),i&&e.jsxs(te,{variant:"outline",size:"sm",onClick:i,className:"gap-2",children:[e.jsx(ln,{className:"h-4 w-4"}),"Download"]})]})]}),e.jsx(It,{children:"Preview your generated report. Copy to share with others or download in your preferred format."})]}),e.jsx("div",{className:"flex-1 overflow-y-auto border rounded-lg p-6 bg-white dark:bg-gray-900",children:e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:c}})})]})})}const _r=Kn("ExportButton");function Lc({frameworkType:r,frameworkTitle:t,data:s,analysisId:n,variant:i="outline",size:o="default"}){const[l,a]=B.useState(!1),[c,p]=B.useState(!0),[d,m]=B.useState(null),[y,h]=B.useState(!1),[_,b]=B.useState(""),[N,u]=B.useState(!1),v=async()=>{u(!0);try{_r.debug("Loading report generator...");const{ReportGenerator:A}=await sn(async()=>{const{ReportGenerator:S}=await import("./report-generator-D-MbsYuE.js");return{ReportGenerator:S}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]));let T;c&&(_r.info("Generating AI enhancements..."),T=await A.enhanceReport(r,s,"standard"));const z=A.generateMarkdown({frameworkType:r,frameworkTitle:t,data:s,format:"word",template:"standard",includeAI:c,aiEnhancements:T});b(z),h(!0),_r.info("âœ“ Report preview generated")}catch(A){_r.error("Failed to generate preview:",A),alert(`Failed to generate report preview: ${A instanceof Error?A.message:"Unknown error"}`)}finally{u(!1)}},g=async()=>{a(!0),m("pdf");try{_r.debug("Loading enhanced SWOT export...");const{generateEnhancedSWOTPDF:A}=await sn(async()=>{const{generateEnhancedSWOTPDF:z}=await import("./index-6Lr_p1cT.js");return{generateEnhancedSWOTPDF:z}},__vite__mapDeps([22,1,2,3,4,5,6,7,10,11,12,13,14,15,16,17,18,19,20,21])),T={strengths:s.strengths||[],weaknesses:s.weaknesses||[],opportunities:s.opportunities||[],threats:s.threats||[],goal:s.goal,options:s.options};await A({title:s.title,description:s.description,swotData:T,includeVisualizations:!0,includeTOWS:!0,includeExecutiveSummary:!0}),_r.info("âœ“ Enhanced SWOT report exported successfully")}catch(A){_r.error("Enhanced export failed:",A),alert(`Failed to export enhanced report: ${A instanceof Error?A.message:"Unknown error"}`)}finally{a(!1),m(null)}},w=async A=>{a(!0),m(A);try{_r.debug(`Loading export libraries for ${A}...`);const{ReportGenerator:T}=await sn(async()=>{const{ReportGenerator:S}=await import("./report-generator-D-MbsYuE.js");return{ReportGenerator:S}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]));let z;c&&(_r.info("Generating AI enhancements..."),z=await T.enhanceReport(r,s,"standard")),await T.generate({frameworkType:r,frameworkTitle:t,data:s,format:A,template:"standard",includeAI:c,aiEnhancements:z}),_r.info(`âœ“ Successfully exported to ${A.toUpperCase()}`)}catch(T){_r.error("Export failed:",T),alert(`Failed to export report: ${T instanceof Error?T.message:"Unknown error"}`)}finally{a(!1),m(null)}},k=[{format:"word",label:"Word Document",icon:nr,ext:".docx"},{format:"pdf",label:"PDF Document",icon:nr,ext:".pdf"},{format:"pptx",label:"PowerPoint",icon:Em,ext:".pptx"},{format:"csv",label:"CSV Spreadsheet",icon:Am,ext:".csv"}];return e.jsxs(e.Fragment,{children:[e.jsxs(Ur,{children:[e.jsx(qr,{asChild:!0,children:e.jsx(te,{variant:i,size:o,disabled:l||N,children:l?e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"h-4 w-4 mr-2 animate-spin"}),"Exporting..."]}):N?e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Wl,{className:"h-4 w-4 mr-2"}),"Export"]})})}),e.jsxs(Wr,{align:"end",className:"w-56",children:[e.jsxs(rt,{onClick:v,disabled:l||N,className:"font-medium",children:[e.jsx(Xn,{className:"h-4 w-4 mr-2"}),"View Report"]}),r==="swot"&&e.jsxs(e.Fragment,{children:[e.jsx(en,{}),e.jsxs(rt,{onClick:g,disabled:l||N,className:"font-medium text-blue-600 dark:text-blue-400",children:[e.jsx(ft,{className:"h-4 w-4 mr-2"}),"Enhanced SWOT Report",e.jsx("span",{className:"ml-auto text-xs bg-blue-100 dark:bg-blue-900 px-1.5 py-0.5 rounded",children:"NEW"})]}),e.jsx("div",{className:"px-2 py-1 text-xs text-gray-500 dark:text-gray-400",children:"Includes visualizations, TOWS strategies & executive summary"})]}),e.jsx(en,{}),e.jsx(Nm,{children:"Download As"}),e.jsx(en,{}),k.map(({format:A,label:T,icon:z,ext:S})=>e.jsxs(rt,{onClick:()=>w(A),disabled:l,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"flex-1",children:T}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:S}),l&&d===A&&e.jsx(xt,{className:"h-3 w-3 ml-2 animate-spin"})]},A)),e.jsx(en,{}),e.jsx(Gg,{checked:c,onCheckedChange:p,disabled:l,children:e.jsx("span",{className:"ml-6",children:"Include AI Insights"})}),e.jsx("div",{className:"px-2 py-1.5 text-xs text-gray-500 dark:text-gray-400",children:c?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"inline-block w-1.5 h-1.5 bg-blue-500 rounded-full"}),"AI enhancements enabled"]}):"Enable AI for summaries & insights"})]})]}),e.jsx(l0,{open:y,onOpenChange:h,title:`${t} Analysis Report`,content:_})]})}function va({entityType:r,entityId:t,className:s}){const{t:n}=Bt("comments"),[i,o]=B.useState([]),[l,a]=B.useState(""),[c,p]=B.useState(null),[d,m]=B.useState(null),[y,h]=B.useState(""),[_,b]=B.useState(!1),[N,u]=B.useState(!1),[v,g]=B.useState(!1);B.useEffect(()=>{const C=localStorage.getItem("omnicore_user_hash");g(!!C)},[]),B.useEffect(()=>{w()},[r,t,N]);const w=async()=>{try{const C=new URLSearchParams({entity_type:r,entity_id:t,include_resolved:N.toString()}),j=await fetch(`/api/comments?${C}`);if(j.ok){const D=await j.json();o(D)}}catch(C){console.error("[Comments] Fetch failed:",C)}},k=async C=>{const j=C?document.getElementById(`reply-${C}`)?.value:l;if(j.trim()){b(!0);try{const D=localStorage.getItem("omnicore_user_hash");(await fetch("/api/comments",{method:"POST",headers:{"Content-Type":"application/json",...D&&{Authorization:`Bearer ${D}`}},body:JSON.stringify({entity_type:r,entity_id:t,parent_comment_id:C,content:j})})).ok&&(C?p(null):a(""),await w())}catch(D){console.error("[Comments] Add failed:",D)}finally{b(!1)}}},A=async C=>{b(!0);try{const j=localStorage.getItem("omnicore_user_hash");(await fetch(`/api/comments/${C}`,{method:"PATCH",headers:{"Content-Type":"application/json",...j&&{Authorization:`Bearer ${j}`}},body:JSON.stringify({content:y})})).ok&&(m(null),h(""),await w())}catch(j){console.error("[Comments] Edit failed:",j)}finally{b(!1)}},T=async C=>{if(confirm(n("confirmDelete"))){b(!0);try{const j=localStorage.getItem("omnicore_user_hash");(await fetch(`/api/comments/${C}`,{method:"DELETE",headers:{...j&&{Authorization:`Bearer ${j}`}}})).ok&&await w()}catch(j){console.error("[Comments] Delete failed:",j)}finally{b(!1)}}},z=async(C,j)=>{b(!0);try{const D=localStorage.getItem("omnicore_user_hash");(await fetch(`/api/comments/${C}`,{method:"PATCH",headers:{"Content-Type":"application/json",...D&&{Authorization:`Bearer ${D}`}},body:JSON.stringify({action:j?"unresolve":"resolve"})})).ok&&await w()}catch(D){console.error("[Comments] Resolve failed:",D)}finally{b(!1)}},S=C=>C.filter(D=>!D.parent_comment_id),U=C=>i.filter(j=>j.parent_comment_id===C),G=C=>{const j=d===C.id,D=U(C.id),J=C.status==="resolved";return e.jsxs("div",{className:cr("border-l-2 pl-4 py-2",J?"border-green-200 dark:border-green-800":"border-gray-200 dark:border-gray-700",C.depth>0&&"ml-4 mt-2"),children:[e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{className:"font-medium",children:C.user_id==="guest"?n("guest"):`User ${C.user_id.slice(0,8)}`}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(C.created_at).toLocaleString()}),C.edited&&e.jsx("span",{className:"text-xs italic",children:"(edited)"}),J&&e.jsxs("span",{className:"flex items-center gap-1 text-green-600 dark:text-green-400 text-xs",children:[e.jsx(jr,{className:"h-3 w-3"}),n("resolved")]})]}),j?e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx($e,{value:y,onChange:q=>h(q.target.value),className:"min-h-[80px]",placeholder:n("editPlaceholder")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{size:"sm",onClick:()=>A(C.id),disabled:_,children:[e.jsx($t,{className:"h-4 w-4 mr-1"}),n("save")]}),e.jsxs(te,{size:"sm",variant:"outline",onClick:()=>{m(null),h("")},children:[e.jsx(Ze,{className:"h-4 w-4 mr-1"}),n("cancel")]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mt-1 text-sm whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:C.content_html||C.content}}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(te,{size:"sm",variant:"ghost",onClick:()=>p(c===C.id?null:C.id),children:[e.jsx(Kg,{className:"h-3 w-3 mr-1"}),n("reply")]}),e.jsx(te,{size:"sm",variant:"ghost",onClick:()=>z(C.id,J),children:J?e.jsxs(e.Fragment,{children:[e.jsx(Xg,{className:"h-3 w-3 mr-1"}),n("unresolve")]}):e.jsxs(e.Fragment,{children:[e.jsx(jr,{className:"h-3 w-3 mr-1"}),n("resolve")]})}),e.jsxs(Ur,{children:[e.jsx(qr,{asChild:!0,children:e.jsx(te,{size:"sm",variant:"ghost",children:e.jsx(gn,{className:"h-3 w-3"})})}),e.jsxs(Wr,{align:"end",children:[e.jsxs(rt,{onClick:()=>{m(C.id),h(C.content)},children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"}),n("edit")]}),e.jsxs(rt,{onClick:()=>T(C.id),className:"text-red-600",children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),n("delete")]})]})]})]})]})]})}),c===C.id&&e.jsxs("div",{className:"mt-3 ml-4 space-y-2",children:[e.jsx($e,{id:`reply-${C.id}`,placeholder:n("replyPlaceholder"),className:"min-h-[80px]"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{size:"sm",onClick:()=>k(C.id),disabled:_,children:n("addReply")}),e.jsx(te,{size:"sm",variant:"outline",onClick:()=>p(null),children:n("cancel")})]})]}),D.length>0&&e.jsx("div",{className:"mt-2",children:D.map(q=>G(q))})]},C.id)},F=S(i);return e.jsxs("div",{className:cr("space-y-4",s),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(kd,{className:"h-5 w-5"}),n("title")," (",i.length,")"]}),e.jsx(te,{size:"sm",variant:"outline",onClick:()=>u(!N),children:n(N?"hideResolved":"showResolved")})]}),v?e.jsxs("div",{className:"space-y-2",children:[e.jsx($e,{value:l,onChange:C=>a(C.target.value),placeholder:n("placeholder"),className:"min-h-[100px]"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-gray-500",children:n("markdownSupport")}),e.jsx(te,{onClick:()=>k(),disabled:_||!l.trim(),children:n("add")})]})]}):e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6 text-center",children:[e.jsx(kd,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),e.jsx("h4",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-white",children:n("loginRequired","Sign in to comment")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:n("loginMessage","Create a bookmark or sign in to join the discussion")}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(te,{onClick:()=>window.location.href="/login",variant:"default",children:n("signIn","Sign In")}),e.jsx(te,{onClick:()=>window.location.href="/dashboard/settings",variant:"outline",children:n("createBookmark","Create Bookmark")})]})]}),F.length>0?e.jsx("div",{className:"space-y-2",children:F.map(C=>G(C))}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:n("noComments")})]})}function c0({strengths:r,weaknesses:t,opportunities:s,threats:n,goal:i,options:o}){const[l,a]=B.useState([]),[c,p]=B.useState(null),[d,m]=B.useState(null),[y,h]=B.useState("balanced"),[_,b]=B.useState("neutral");if(B.useEffect(()=>{const k=async()=>{try{const A={strengths:r,weaknesses:t,opportunities:s,threats:n,goal:i,options:o},{analyzeSWOTData:T,generateTOWSStrategies:z,generateSWOTInsightsSummary:S,generateDecisionRecommendation:U}=await sn(async()=>{const{analyzeSWOTData:j,generateTOWSStrategies:D,generateSWOTInsightsSummary:J,generateDecisionRecommendation:q}=await import("./index-6Lr_p1cT.js");return{analyzeSWOTData:j,generateTOWSStrategies:D,generateSWOTInsightsSummary:J,generateDecisionRecommendation:q}},__vite__mapDeps([22,1,2,3,4,5,6,7,10,11,12,13,14,15,16,17,18,19,20,21])),G=T(A);h(G.balance),b(G.sentiment);const F=S(A);a(F);const C=z(A);if(p(C),o&&o.length>0){const j=U(A);m(j)}}catch(A){console.error("Failed to load insights:",A)}};(r.length>0||t.length>0||s.length>0||n.length>0)&&k()},[r,t,s,n,i,o]),r.length+t.length+s.length+n.length===0)return null;const u=r.length+t.length,v=s.length+n.length,g=r.length+s.length,w=t.length+n.length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(Nd,{className:"h-5 w-5"}),"Strategic Position Analysis"]})}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Analysis Focus"}),e.jsxs("p",{className:"text-lg font-semibold",children:[y==="internal-focused"&&"ðŸ¢ Internal-Focused",y==="external-focused"&&"ðŸŒ External-Focused",y==="balanced"&&"âš–ï¸ Balanced"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Internal vs External"}),e.jsxs("p",{className:"text-lg font-semibold",children:[u," vs ",v]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Overall Outlook"}),e.jsxs("p",{className:"text-lg font-semibold flex items-center gap-2",children:[_==="positive"&&e.jsxs(e.Fragment,{children:[e.jsx(Hr,{className:"h-5 w-5 text-green-600"}),"Positive"]}),_==="negative"&&e.jsxs(e.Fragment,{children:[e.jsx(Yn,{className:"h-5 w-5 text-red-600"}),"Challenging"]}),_==="neutral"&&e.jsxs(e.Fragment,{children:[e.jsx(Nd,{className:"h-5 w-5 text-blue-600"}),"Neutral"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Positive vs Negative"}),e.jsxs("p",{className:"text-lg font-semibold",children:[g," vs ",w]})]})]}),l.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-2",children:[e.jsx(xs,{className:"h-4 w-4"}),"Key Insights"]}),l.map((k,A)=>e.jsx(Dt,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:e.jsx(Mt,{className:"text-sm",children:k})},A))]})]})]}),d&&e.jsxs(ge,{className:"border-2 border-purple-200 dark:border-purple-800",children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(Gi,{className:"h-5 w-5 text-purple-600"}),"Decision Recommendation"]})}),e.jsxs(xe,{className:"space-y-4",children:[d.goal&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-900 dark:text-blue-200",children:"ðŸŽ¯ Goal: "}),e.jsx("span",{className:"text-sm text-blue-800 dark:text-blue-300",children:d.goal})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-r from-green-500 to-green-600 rounded-lg shadow-lg",children:[e.jsx("p",{className:"text-sm font-medium text-white/90 mb-1",children:"Recommended Choice"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:d.topChoice}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsxs(he,{className:"bg-white/20 text-white border-white/30",children:["Score: ",d.scores[0].netScore.toFixed(1)]}),e.jsx(he,{className:"bg-white/20 text-white border-white/30",children:d.scores[0].recommendation.replace("_"," ").toUpperCase()})]})]}),d.reasoning&&d.reasoning.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 flex items-center gap-2",children:[e.jsx(xs,{className:"h-4 w-4"}),"Key Reasoning"]}),e.jsx("ul",{className:"space-y-1.5 ml-4",children:d.reasoning.map((k,A)=>e.jsxs("li",{className:"text-sm text-gray-700 dark:text-gray-300",children:["â€¢ ",k]},A))})]}),d.comparisonMatrix&&d.comparisonMatrix.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Options Comparison Matrix"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 dark:bg-gray-800",children:[e.jsx("th",{className:"text-left p-2 border border-gray-300 dark:border-gray-600",children:"Option"}),e.jsx("th",{className:"text-center p-2 border border-gray-300 dark:border-gray-600",children:"Str"}),e.jsx("th",{className:"text-center p-2 border border-gray-300 dark:border-gray-600",children:"Weak"}),e.jsx("th",{className:"text-center p-2 border border-gray-300 dark:border-gray-600",children:"Opp"}),e.jsx("th",{className:"text-center p-2 border border-gray-300 dark:border-gray-600",children:"Threat"}),e.jsx("th",{className:"text-center p-2 border border-gray-300 dark:border-gray-600 font-bold",children:"Score"})]})}),e.jsx("tbody",{children:d.comparisonMatrix.map((k,A)=>e.jsxs("tr",{className:A===0?"bg-green-50 dark:bg-green-900/20 font-semibold":A%2===0?"bg-gray-50 dark:bg-gray-800/50":"",children:[e.jsxs("td",{className:"p-2 border border-gray-300 dark:border-gray-600",children:[A===0&&"ðŸ¥‡ ",A===1&&"ðŸ¥ˆ ",A===2&&"ðŸ¥‰ ",k.option]}),e.jsx("td",{className:"text-center p-2 border border-gray-300 dark:border-gray-600",children:k.strengths}),e.jsx("td",{className:"text-center p-2 border border-gray-300 dark:border-gray-600",children:k.weaknesses}),e.jsx("td",{className:"text-center p-2 border border-gray-300 dark:border-gray-600",children:k.opportunities}),e.jsx("td",{className:"text-center p-2 border border-gray-300 dark:border-gray-600",children:k.threats}),e.jsx("td",{className:`text-center p-2 border border-gray-300 dark:border-gray-600 font-bold ${k.score>5?"text-green-600 dark:text-green-400":k.score>2?"text-blue-600 dark:text-blue-400":k.score>0?"text-orange-600 dark:text-orange-400":"text-red-600 dark:text-red-400"}`,children:k.score.toFixed(1)})]},A))})]})})]}),d.scores&&d.scores.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"Detailed Option Analysis"}),d.scores.map((k,A)=>e.jsxs("div",{className:`p-3 rounded-lg border-l-4 ${A===0?"bg-green-50 dark:bg-green-900/20 border-green-500":A===1?"bg-blue-50 dark:bg-blue-900/20 border-blue-500":A===2?"bg-orange-50 dark:bg-orange-900/20 border-orange-500":"bg-gray-50 dark:bg-gray-800/50 border-gray-400"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[A===0&&"ðŸ¥‡ ",A===1&&"ðŸ¥ˆ ",A===2&&"ðŸ¥‰ ",A>2&&`${A+1}. `,k.option]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(he,{variant:k.recommendation==="highly_recommended"?"default":"secondary",children:k.recommendation.replace("_"," ")}),e.jsxs(he,{variant:"outline",className:k.netScore>5?"border-green-500 text-green-700 dark:text-green-400":k.netScore>2?"border-blue-500 text-blue-700 dark:text-blue-400":k.netScore>0?"border-orange-500 text-orange-700 dark:text-orange-400":"border-red-500 text-red-700 dark:text-red-400",children:["Score: ",k.netScore.toFixed(1)]})]})]}),k.reasoning&&k.reasoning.length>0&&e.jsx("ul",{className:"space-y-1 text-sm text-gray-700 dark:text-gray-300",children:k.reasoning.map((T,z)=>e.jsxs("li",{children:["â€¢ ",T]},z))})]},A))]})]})]}),c&&e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(Gi,{className:"h-5 w-5"}),"TOWS Strategic Recommendations"]})}),e.jsxs(xe,{className:"space-y-4",children:[c.SO.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(he,{className:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",children:[e.jsx(Yg,{className:"h-3 w-3 mr-1"}),"SO Growth Strategies"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Use Strengths to exploit Opportunities"})]}),e.jsx("ul",{className:"space-y-1 ml-4",children:c.SO.map((k,A)=>e.jsxs("li",{className:"text-sm text-gray-700 dark:text-gray-300",children:["â€¢ ",k]},A))})]}),c.WO.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(he,{className:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",children:[e.jsx(Hr,{className:"h-3 w-3 mr-1"}),"WO Development Strategies"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Address Weaknesses to exploit Opportunities"})]}),e.jsx("ul",{className:"space-y-1 ml-4",children:c.WO.map((k,A)=>e.jsxs("li",{className:"text-sm text-gray-700 dark:text-gray-300",children:["â€¢ ",k]},A))})]}),c.ST.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(he,{className:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400",children:[e.jsx(Hl,{className:"h-3 w-3 mr-1"}),"ST Diversification Strategies"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Use Strengths to mitigate Threats"})]}),e.jsx("ul",{className:"space-y-1 ml-4",children:c.ST.map((k,A)=>e.jsxs("li",{className:"text-sm text-gray-700 dark:text-gray-300",children:["â€¢ ",k]},A))})]}),c.WT.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(he,{className:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",children:[e.jsx(Rr,{className:"h-3 w-3 mr-1"}),"WT Defensive Strategies"]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Minimize Weaknesses and avoid Threats"})]}),e.jsx("ul",{className:"space-y-1 ml-4",children:c.WT.map((k,A)=>e.jsxs("li",{className:"text-sm text-gray-700 dark:text-gray-300",children:["â€¢ ",k]},A))})]})]})]}),e.jsxs(Dt,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:[e.jsx(xs,{className:"h-4 w-4 text-blue-600"}),e.jsxs(Mt,{className:"text-sm text-blue-900 dark:text-blue-100",children:[e.jsx("strong",{children:"Tip:"}),' Click "Enhanced SWOT Report" in the Export menu to generate a professional PDF including these insights, visualizations, and methodology.']})]})]})}function Ua(){const r={"Content-Type":"application/json"},t=localStorage.getItem("omnicore_token");t&&(r.Authorization=`Bearer ${t}`);const s=localStorage.getItem("user_hash");return s&&(r["X-User-Hash"]=s),r}const d0=[{value:"health",label:"Health"},{value:"civic",label:"Civic Engagement"},{value:"economic",label:"Economic"},{value:"social",label:"Social"},{value:"environmental",label:"Environmental"},{value:"education",label:"Education"}];function wa({frameworkId:r,frameworkType:t,isPublic:s,shareToken:n,category:i,onUpdate:o}){const{currentWorkspaceId:l}=Kr(),{toast:a}=jc(),[c,p]=B.useState(s),[d,m]=B.useState(n),[y,h]=B.useState(i||""),[_,b]=B.useState(!1),[N,u]=B.useState(!1),[v,g]=B.useState(!1),w=d?`${window.location.origin}/public/framework/${d}`:null,k=async S=>{u(!0);try{const U=await fetch(`/api/frameworks/${r}/share?workspace_id=${l}`,{method:"POST",headers:Ua(),body:JSON.stringify({is_public:S,category:y,workspace_id:l})});if(!U.ok)throw new Error("Failed to update sharing settings");const G=await U.json();p(G.is_public),m(G.share_token),o&&o({isPublic:G.is_public,shareToken:G.share_token,category:G.category})}catch(U){console.error("Failed to toggle sharing:",U),alert("Failed to update sharing settings")}finally{u(!1)}},A=async S=>{if(h(S),c)try{await fetch(`/api/frameworks/${r}/share?workspace_id=${l}`,{method:"POST",headers:Ua(),body:JSON.stringify({is_public:!0,category:S,workspace_id:l})}),o&&o({isPublic:c,shareToken:d,category:S})}catch(U){console.error("Failed to update category:",U)}},T=()=>{w&&(navigator.clipboard.writeText(w),b(!0),setTimeout(()=>b(!1),2e3))},z=async()=>{g(!0);try{if(c&&d){const F=`${window.location.origin}/public/framework/${d}`;await navigator.clipboard.writeText(F),a({title:"Link copied!",description:"Share link has been copied to clipboard"}),g(!1);return}const S=await fetch(`/api/frameworks/${r}/share?workspace_id=${l}`,{method:"POST",headers:Ua(),body:JSON.stringify({is_public:!0,category:y,workspace_id:l})});if(!S.ok)throw new Error("Failed to create share link");const U=await S.json();p(U.is_public),m(U.share_token);const G=`${window.location.origin}/public/framework/${U.share_token}`;await navigator.clipboard.writeText(G),o&&o({isPublic:U.is_public,shareToken:U.share_token,category:U.category}),a({title:"Share link created and copied!",description:"Anyone with this link can view and clone your analysis"})}catch(S){console.error("Failed to share:",S),a({title:"Failed to create share link",description:"Please try again",variant:"destructive"})}finally{g(!1)}};return e.jsxs(Ur,{children:[e.jsx(qr,{asChild:!0,children:e.jsxs(te,{variant:"outline",className:"gap-2",children:[c?e.jsx(Mn,{className:"h-4 w-4"}):e.jsx(Jg,{className:"h-4 w-4"}),"Share"]})}),e.jsxs(Wr,{align:"end",className:"w-80",children:[e.jsx(Nm,{children:"Sharing Options"}),e.jsx(en,{}),e.jsxs(rt,{onClick:z,disabled:v,className:"gap-2 cursor-pointer",children:[e.jsx(Hn,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:v?"Creating link...":c&&d?"Copy Share Link":"Share Analysis"}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:c&&d?"Copy link to clipboard":"Create public link and copy"})]})]}),e.jsx(en,{}),e.jsxs("div",{className:"p-3 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:"Public Access"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Anyone with the link can view and clone"})]}),e.jsx(Xl,{checked:c,onCheckedChange:k,disabled:N})]}),t==="behavior"&&c&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{children:"Category (Optional)"}),e.jsxs(ct,{value:y,onValueChange:A,children:[e.jsx(dt,{children:e.jsx(ut,{placeholder:"Select category"})}),e.jsx(ht,{children:d0.map(S=>e.jsx(Te,{value:S.value,children:S.label},S.value))})]})]}),c&&w&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{children:"Share Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ee,{readOnly:!0,value:w,className:"text-xs",onClick:S=>S.currentTarget.select()}),e.jsx(te,{size:"sm",variant:"outline",onClick:T,children:_?e.jsx($t,{className:"h-4 w-4"}):e.jsx(_c,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1 pt-2 border-t",children:[e.jsx("p",{children:"âœ“ Anyone can view your analysis (no login)"}),e.jsx("p",{children:"âœ“ Anyone can clone to work with it"}),e.jsx("p",{children:"âœ“ Logged-in users save to workspace"}),e.jsx("p",{children:"âœ“ Guests save to local storage (7 days)"})]})]}),!c&&e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 pt-2 border-t",children:[e.jsx("p",{children:"ðŸ”’ Only you can access this analysis"}),e.jsx("p",{className:"mt-2",children:"Enable public sharing to allow others to view and clone your work"})]})]})]})]})}function u0({data:r,onEdit:t,onDelete:s}){const n=xr(),i=({title:o,items:l,color:a,bgColor:c,icon:p})=>e.jsxs(ge,{className:`border-l-4 ${a}`,children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:p}),o,e.jsx(he,{variant:"secondary",className:"ml-auto",children:l.length})]})}),e.jsx(xe,{children:l.length===0?e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-8",children:["No ",o.toLowerCase()," identified"]}):e.jsx("ul",{className:"space-y-2",children:l.map((d,m)=>{const y=d.evidence_ids?.length||0,h=y>0;return e.jsxs("li",{className:`p-3 rounded-lg ${c} text-sm space-y-2`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:[m+1,"."]})," ",d.text]}),e.jsxs("div",{className:"flex items-center gap-1",children:[h&&e.jsxs(he,{variant:"outline",className:"text-xs flex items-center gap-1",children:[e.jsx(os,{className:"h-3 w-3"}),y]}),d.confidence==="high"&&e.jsxs(he,{className:"text-xs bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400",children:[e.jsx(jr,{className:"h-3 w-3 mr-1"}),"High"]}),d.confidence==="medium"&&e.jsx(he,{className:"text-xs bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400",children:"Medium"}),d.confidence==="low"&&e.jsx(he,{className:"text-xs bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400",children:"Low"}),!h&&!d.confidence&&e.jsx(he,{variant:"outline",className:"text-xs text-gray-500",children:"No evidence"})]})]}),d.tags&&d.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 pl-5",children:d.tags.map((_,b)=>e.jsxs(he,{className:"text-xs px-2.5 py-0.5 font-medium bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-200 border border-blue-300 dark:border-blue-700",children:["ðŸ·ï¸ ",_]},b))}),d.appliesTo&&d.appliesTo.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1.5 pl-5",children:[e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mr-1",children:"Applies to:"}),d.appliesTo.map((_,b)=>e.jsxs(he,{className:"text-xs px-2.5 py-0.5 font-medium bg-purple-100 dark:bg-purple-900/40 text-purple-800 dark:text-purple-200 border border-purple-300 dark:border-purple-700",children:["âœ“ ",_]},b))]})]},d.id)})})})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(te,{variant:"outline",onClick:()=>n("/dashboard/analysis-frameworks/swot-dashboard"),children:[e.jsx(Ir,{className:"h-4 w-4 mr-2"}),"Back to List"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.title}),r.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:r.description}),r.goal&&e.jsxs("div",{className:"mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-900 dark:text-blue-200",children:"ðŸŽ¯ Goal: "}),e.jsx("span",{className:"text-sm text-blue-800 dark:text-blue-300",children:r.goal})]}),r.options&&r.options.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400 mr-1",children:"Options Considered:"}),r.options.map((o,l)=>e.jsxs(he,{className:"text-sm px-3 py-1 font-medium bg-gradient-to-r from-purple-100 to-purple-50 dark:from-purple-900/40 dark:to-purple-900/20 border border-purple-300 dark:border-purple-700 text-purple-800 dark:text-purple-200 shadow-sm",children:["âœ“ ",o]},l))]}),r.tags&&r.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400 mr-1",children:"Tags:"}),r.tags.map((o,l)=>e.jsxs(he,{className:"text-sm px-3 py-1 font-medium bg-gradient-to-r from-blue-100 to-blue-50 dark:from-blue-900/40 dark:to-blue-900/20 border border-blue-300 dark:border-blue-700 text-blue-800 dark:text-blue-200 shadow-sm",children:[e.jsx(Hi,{className:"h-3.5 w-3.5 mr-1.5"}),o]},l))]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{variant:"outline",onClick:()=>{const o=[],l=c=>{const p=c.match(/(actor|source|event|place)_[a-zA-Z0-9]+/g);p&&o.push(...p)};[...r.strengths,...r.weaknesses,...r.opportunities,...r.threats].forEach(c=>{l(c.text)});const a=[...new Set(o)];n("/dashboard/network-graph",{state:{highlightEntities:a,source:"swot",title:r.title}})},children:[e.jsx(ma,{className:"h-4 w-4 mr-2"}),"View in Network"]}),e.jsx(wa,{frameworkId:r.id,frameworkType:"swot",isPublic:r.is_public||!1,shareToken:r.share_token}),e.jsx(Lc,{frameworkType:"swot",frameworkTitle:"SWOT Analysis",data:r,analysisId:r.id}),e.jsxs(te,{variant:"outline",onClick:t,children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(te,{variant:"destructive",onClick:s,children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),(r.created_at||r.updated_at)&&e.jsx(ge,{children:e.jsx(xe,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-6 text-sm text-gray-600 dark:text-gray-400",children:[r.created_at&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Created:"})," ",new Date(r.created_at).toLocaleDateString()]}),r.updated_at&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Last Updated:"})," ",new Date(r.updated_at).toLocaleDateString()]})]})})}),e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsx(Ae,{children:"Analysis Summary"})}),e.jsx(xe,{children:e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-green-50 dark:bg-green-900/20",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:r.strengths.length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Strengths"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-red-50 dark:bg-red-900/20",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:r.weaknesses.length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Weaknesses"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-blue-50 dark:bg-blue-900/20",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:r.opportunities.length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Opportunities"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-orange-50 dark:bg-orange-900/20",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600 dark:text-orange-400",children:r.threats.length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Threats"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(i,{title:"Strengths",items:r.strengths,color:"border-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",icon:"ðŸ’ª"}),e.jsx(i,{title:"Weaknesses",items:r.weaknesses,color:"border-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",icon:"âš ï¸"}),e.jsx(i,{title:"Opportunities",items:r.opportunities,color:"border-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",icon:"ðŸŽ¯"}),e.jsx(i,{title:"Threats",items:r.threats,color:"border-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",icon:"âš¡"})]}),e.jsx(c0,{strengths:r.strengths,weaknesses:r.weaknesses,opportunities:r.opportunities,threats:r.threats,goal:r.goal,options:r.options}),e.jsx(va,{entityType:"framework",entityId:r.id})]})}function h0({analyses:r,comparisonTag:t,onClose:s}){const n=xr(),i=d=>{switch(d){case"high":return 1;case"medium":return .7;case"low":return .4;default:return .5}},o=d=>d.reduce((m,y)=>{const h=i(y.confidence),_=(y.evidence_ids?.length||0)*.15;return m+h+_},0),a=[...r.map(d=>{const m=o(d.strengths),y=o(d.weaknesses),h=o(d.opportunities),_=o(d.threats),b=[...d.strengths,...d.weaknesses,...d.opportunities,...d.threats].filter(g=>g.confidence==="high").length,N=m+h,u=y+_,v=N*2-u*1.5+b*.3;return{id:d.id,title:d.title,strengthCount:d.strengths.length,weaknessCount:d.weaknesses.length,opportunityCount:d.opportunities.length,threatCount:d.threats.length,strengthScore:m,weaknessScore:y,opportunityScore:h,threatScore:_,totalPositive:N,totalNegative:u,highConfidenceCount:b,score:v,evidenceCount:[...d.strengths,...d.weaknesses,...d.opportunities,...d.threats].reduce((g,w)=>g+(w.evidence_ids?.length||0),0)}})].sort((d,m)=>m.score-d.score),c=d=>r.map(y=>({title:y.title,count:y[d].length})).sort((y,h)=>h.count-y.count)[0],p=({title:d,items:m,color:y,bgColor:h,icon:_})=>e.jsxs(ge,{className:`border-l-4 ${y}`,children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),d]})}),e.jsx(xe,{children:e.jsx("div",{className:"space-y-4",children:m.map(({analysis:b,items:N},u)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 dark:text-gray-300",children:b}),e.jsx(he,{variant:"secondary",children:N.length})]}),N.length===0?e.jsx("p",{className:"text-xs text-gray-500 italic pl-2",children:"None identified"}):e.jsxs("ul",{className:"space-y-1.5",children:[N.slice(0,3).map((v,g)=>e.jsxs("li",{className:`text-sm p-2 rounded ${h} flex items-start gap-2`,children:[v.confidence&&e.jsxs("span",{className:"flex-shrink-0 text-base",title:`Confidence: ${v.confidence}`,children:[v.confidence==="high"&&"ðŸŸ¢",v.confidence==="medium"&&"ðŸŸ¡",v.confidence==="low"&&"ðŸ”´"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{children:v.text}),v.details&&e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1 border-l-2 border-gray-300 pl-2",children:[v.details.slice(0,100),v.details.length>100?"...":""]})]}),v.evidence_ids&&v.evidence_ids.length>0&&e.jsxs(he,{variant:"outline",className:"text-xs flex-shrink-0",children:["ðŸ“Ž ",v.evidence_ids.length]})]},g)),N.length>3&&e.jsxs("p",{className:"text-xs text-gray-500 italic pl-2",children:["+",N.length-3," more..."]})]}),u<m.length-1&&e.jsx(Cr,{className:"my-2"})]},u))})})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(te,{variant:"outline",onClick:s,children:[e.jsx(Ir,{className:"h-4 w-4 mr-2"}),"Back to List"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["Comparison: ",t]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:["Comparing ",r.length," options for decision-making"]})]})]}),e.jsxs(te,{variant:"outline",onClick:s,children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Close Comparison"]})]}),e.jsxs(ge,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200",children:[e.jsx(Ce,{children:e.jsx(Ae,{className:"text-base",children:"ðŸ“Š Scoring Methodology"})}),e.jsxs(xe,{className:"text-sm space-y-2",children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"Options are ranked using a weighted scoring system that considers both quantity and quality:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"font-semibold text-gray-800 dark:text-gray-200",children:"Confidence Weights:"}),e.jsxs("ul",{className:"text-xs space-y-1 text-gray-600 dark:text-gray-400",children:[e.jsx("li",{children:"ðŸŸ¢ High confidence: 1.0 point"}),e.jsx("li",{children:"ðŸŸ¡ Medium confidence: 0.7 points"}),e.jsx("li",{children:"ðŸ”´ Low confidence: 0.4 points"}),e.jsx("li",{children:"âšª No confidence: 0.5 points"}),e.jsx("li",{children:"ðŸ“Ž Evidence bonus: +0.15 per evidence item"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("p",{className:"font-semibold text-gray-800 dark:text-gray-200",children:"Final Score Calculation:"}),e.jsxs("ul",{className:"text-xs space-y-1 text-gray-600 dark:text-gray-400",children:[e.jsx("li",{children:"Positive factors (S + O) Ã— 2.0"}),e.jsx("li",{children:"Negative factors (W + T) Ã— 1.5"}),e.jsx("li",{children:"High confidence items Ã— 0.3 bonus"}),e.jsx("li",{children:e.jsx("span",{className:"font-semibold",children:"Score = Positive - Negative + Bonus"})})]})]})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 italic mt-2",children:"Higher scores indicate stronger overall positions. Options with more high-confidence strengths and opportunities will rank higher."})]})]}),e.jsxs(ge,{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20",children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(Qg,{className:"h-5 w-5 text-blue-600"}),"Decision Ranking"]})}),e.jsx(xe,{children:e.jsx("div",{className:"space-y-3",children:a.map((d,m)=>{const y=r.find(h=>h.id===d.id);return e.jsxs("div",{className:`flex items-center gap-4 p-4 rounded-lg transition-all cursor-pointer hover:shadow-md ${m===0?"bg-yellow-100 dark:bg-yellow-900/30 border-2 border-yellow-400":"bg-white dark:bg-gray-800 border"}`,onClick:()=>n(`/dashboard/analysis-frameworks/swot-dashboard/${d.id}`),children:[e.jsxs("div",{className:"flex-shrink-0",children:[m===0&&e.jsx("span",{className:"text-3xl",children:"ðŸ†"}),m===1&&e.jsx("span",{className:"text-3xl",children:"ðŸ¥ˆ"}),m===2&&e.jsx("span",{className:"text-3xl",children:"ðŸ¥‰"}),m>2&&e.jsxs("span",{className:"text-xl font-bold text-gray-400",children:["#",m+1]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:d.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:y?.description}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[e.jsxs(he,{variant:"outline",className:"bg-green-50 text-green-700",children:["ðŸ’ª ",d.strengthCount," (",d.strengthScore.toFixed(1)," pts)"]}),e.jsxs(he,{variant:"outline",className:"bg-red-50 text-red-700",children:["âš ï¸ ",d.weaknessCount," (",d.weaknessScore.toFixed(1)," pts)"]}),e.jsxs(he,{variant:"outline",className:"bg-blue-50 text-blue-700",children:["ðŸŽ¯ ",d.opportunityCount," (",d.opportunityScore.toFixed(1)," pts)"]}),e.jsxs(he,{variant:"outline",className:"bg-orange-50 text-orange-700",children:["âš¡ ",d.threatCount," (",d.threatScore.toFixed(1)," pts)"]}),d.highConfidenceCount>0&&e.jsxs(he,{variant:"outline",className:"bg-purple-50 text-purple-700",children:["ðŸŸ¢ ",d.highConfidenceCount," high confidence"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:d.score.toFixed(1)}),e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"total score"}),e.jsxs("div",{className:"text-xs space-y-0.5",children:[e.jsxs("div",{className:"text-green-600 dark:text-green-400",children:["+",d.totalPositive.toFixed(1)," pos"]}),e.jsxs("div",{className:"text-red-600 dark:text-red-400",children:["-",d.totalNegative.toFixed(1)," neg"]}),d.evidenceCount>0&&e.jsxs("div",{className:"text-purple-600 dark:text-purple-400",children:["ðŸ“Ž ",d.evidenceCount," evidence"]})]})]})]},d.id)})})})]}),e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsx(Ae,{children:"Decision Matrix"})}),e.jsx(xe,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2 px-4 font-semibold",children:"Option"}),e.jsx("th",{className:"text-center py-2 px-4 font-semibold text-green-600",children:"Strengths"}),e.jsx("th",{className:"text-center py-2 px-4 font-semibold text-red-600",children:"Weaknesses"}),e.jsx("th",{className:"text-center py-2 px-4 font-semibold text-blue-600",children:"Opportunities"}),e.jsx("th",{className:"text-center py-2 px-4 font-semibold text-orange-600",children:"Threats"}),e.jsx("th",{className:"text-center py-2 px-4 font-semibold text-purple-600",children:"High Confidence"}),e.jsx("th",{className:"text-center py-2 px-4 font-semibold text-blue-600",children:"Score"})]})}),e.jsx("tbody",{children:a.map((d,m)=>e.jsxs("tr",{className:`border-b hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer ${m===0?"bg-yellow-50 dark:bg-yellow-900/20":""}`,onClick:()=>n(`/dashboard/analysis-frameworks/swot-dashboard/${d.id}`),children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[m===0&&e.jsx("span",{className:"text-lg",children:"ðŸ†"}),m===1&&e.jsx("span",{className:"text-lg",children:"ðŸ¥ˆ"}),m===2&&e.jsx("span",{className:"text-lg",children:"ðŸ¥‰"}),e.jsx("span",{className:"font-medium",children:d.title})]})}),e.jsxs("td",{className:"text-center py-3 px-4",children:[e.jsx("div",{className:"font-bold text-green-600",children:d.strengthCount}),e.jsxs("div",{className:"text-xs text-gray-500",children:[d.strengthScore.toFixed(1)," pts"]})]}),e.jsxs("td",{className:"text-center py-3 px-4",children:[e.jsx("div",{className:"font-bold text-red-600",children:d.weaknessCount}),e.jsxs("div",{className:"text-xs text-gray-500",children:[d.weaknessScore.toFixed(1)," pts"]})]}),e.jsxs("td",{className:"text-center py-3 px-4",children:[e.jsx("div",{className:"font-bold text-blue-600",children:d.opportunityCount}),e.jsxs("div",{className:"text-xs text-gray-500",children:[d.opportunityScore.toFixed(1)," pts"]})]}),e.jsxs("td",{className:"text-center py-3 px-4",children:[e.jsx("div",{className:"font-bold text-orange-600",children:d.threatCount}),e.jsxs("div",{className:"text-xs text-gray-500",children:[d.threatScore.toFixed(1)," pts"]})]}),e.jsxs("td",{className:"text-center py-3 px-4",children:[e.jsx("div",{className:"font-bold text-purple-600",children:d.highConfidenceCount}),e.jsx("div",{className:"text-xs text-gray-500",children:"items"})]}),e.jsx("td",{className:"text-center py-3 px-4",children:e.jsx("div",{className:"text-xl font-bold text-blue-600",children:d.score.toFixed(1)})})]},d.id))})]})})})]}),e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsx(Ae,{children:"Comparison Overview"})}),e.jsx(xe,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Most Strengths"}),e.jsx("div",{className:"font-bold text-green-600 dark:text-green-400 text-lg",children:c("strengths").title}),e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:c("strengths").count})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 dark:bg-red-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Most Weaknesses"}),e.jsx("div",{className:"font-bold text-red-600 dark:text-red-400 text-lg",children:c("weaknesses").title}),e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:c("weaknesses").count})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Most Opportunities"}),e.jsx("div",{className:"font-bold text-blue-600 dark:text-blue-400 text-lg",children:c("opportunities").title}),e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:c("opportunities").count})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Most Threats"}),e.jsx("div",{className:"font-bold text-orange-600 dark:text-orange-400 text-lg",children:c("threats").title}),e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:c("threats").count})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(p,{title:"Strengths",items:r.map(d=>({analysis:d.title,items:d.strengths})),color:"border-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",icon:Hr}),e.jsx(p,{title:"Weaknesses",items:r.map(d=>({analysis:d.title,items:d.weaknesses})),color:"border-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",icon:Rr}),e.jsx(p,{title:"Opportunities",items:r.map(d=>({analysis:d.title,items:d.opportunities})),color:"border-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",icon:Gi}),e.jsx(p,{title:"Threats",items:r.map(d=>({analysis:d.title,items:d.threats})),color:"border-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",icon:Vi})]}),e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsx(Ae,{children:"View Individual Analyses"})}),e.jsx(xe,{children:e.jsx("div",{className:"grid gap-2",children:r.map(d=>e.jsx(te,{variant:"outline",className:"justify-start",onClick:()=>n(`/dashboard/analysis-frameworks/swot-dashboard/${d.id}`),children:d.title},d.id))})})]})]})}function m0({open:r,onClose:t,analyses:s,onMerge:n,onExtract:i}){const[o,l]=B.useState("merge"),[a,c]=B.useState(""),[p,d]=B.useState(""),[m,y]=B.useState(new Set),[h,_]=B.useState(new Set),b=Array.from(new Set(s.flatMap(S=>[...S.tags||[],...S.strengths.flatMap(U=>U.tags||[]),...S.weaknesses.flatMap(U=>U.tags||[]),...S.opportunities.flatMap(U=>U.tags||[]),...S.threats.flatMap(U=>U.tags||[])]))).sort(),N=()=>{const S=s.filter(G=>m.has(G.id)),U={title:a||`Merged Analysis: ${S.map(G=>G.title).join(" + ")}`,description:p||`Merged from: ${S.map(G=>G.title).join(", ")}`,strengths:S.flatMap(G=>G.strengths),weaknesses:S.flatMap(G=>G.weaknesses),opportunities:S.flatMap(G=>G.opportunities),threats:S.flatMap(G=>G.threats),tags:Array.from(new Set(S.flatMap(G=>G.tags||[])))};n(U),v()},u=()=>{const S=Array.from(h),U=F=>F.filter(C=>C.tags&&C.tags.some(j=>S.includes(j))),G={title:a||`Extracted: ${S.join(", ")}`,description:p||`Extracted items with tags: ${S.join(", ")}`,strengths:s.flatMap(F=>U(F.strengths)),weaknesses:s.flatMap(F=>U(F.weaknesses)),opportunities:s.flatMap(F=>U(F.opportunities)),threats:s.flatMap(F=>U(F.threats)),tags:S};i(G,S),v()},v=()=>{c(""),d(""),y(new Set),_(new Set),l("merge"),t()},g=S=>{const U=new Set(m);U.has(S)?U.delete(S):U.add(S),y(U)},w=S=>{const U=new Set(h);U.has(S)?U.delete(S):U.add(S),_(U)},k=o==="merge"?m.size:h.size,A=k>0&&(o==="merge"?k>=2:!0),z=(()=>{if(o==="merge"){const S=s.filter(U=>m.has(U.id));return{strengths:S.reduce((U,G)=>U+G.strengths.length,0),weaknesses:S.reduce((U,G)=>U+G.weaknesses.length,0),opportunities:S.reduce((U,G)=>U+G.opportunities.length,0),threats:S.reduce((U,G)=>U+G.threats.length,0)}}else{const S=Array.from(h),U=G=>G.filter(F=>F.tags&&F.tags.some(C=>S.includes(C)));return{strengths:s.reduce((G,F)=>G+U(F.strengths).length,0),weaknesses:s.reduce((G,F)=>G+U(F.weaknesses).length,0),opportunities:s.reduce((G,F)=>G+U(F.opportunities).length,0),threats:s.reduce((G,F)=>G+U(F.threats).length,0)}}})();return e.jsx(wt,{open:r,onOpenChange:v,children:e.jsxs(jt,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsxs(kt,{className:"flex items-center gap-2",children:[o==="merge"?e.jsx(Gl,{className:"h-5 w-5"}):e.jsx(Sd,{className:"h-5 w-5"}),o==="merge"?"Merge SWOT Analyses":"Extract SWOT Items by Tags"]}),e.jsx(It,{children:o==="merge"?"Combine multiple SWOT analyses into a single comprehensive analysis":"Create a new SWOT analysis from items with specific tags"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{variant:o==="merge"?"default":"outline",onClick:()=>l("merge"),className:"flex-1",children:[e.jsx(Gl,{className:"h-4 w-4 mr-2"}),"Merge"]}),e.jsxs(te,{variant:o==="extract"?"default":"outline",onClick:()=>l("extract"),className:"flex-1",children:[e.jsx(Sd,{className:"h-4 w-4 mr-2"}),"Extract"]})]}),e.jsx(Cr,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"merge-title",children:"Title (optional)"}),e.jsx(Ee,{id:"merge-title",value:a,onChange:S=>c(S.target.value),placeholder:o==="merge"?"e.g., Merged Office Location Analysis":"e.g., High Priority Items"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"merge-description",children:"Description (optional)"}),e.jsx(Ee,{id:"merge-description",value:p,onChange:S=>d(S.target.value),placeholder:"Describe the purpose of this analysis..."})]}),e.jsx(Cr,{}),o==="merge"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{children:"Select Analyses to Merge (minimum 2)"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto border rounded-lg p-3",children:s.map(S=>e.jsxs("div",{className:"flex items-start gap-3 p-2 hover:bg-gray-50 dark:hover:bg-gray-800 rounded",children:[e.jsx(ts,{checked:m.has(S.id),onCheckedChange:()=>g(S.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:S.title}),e.jsxs("div",{className:"text-xs text-gray-500",children:[S.strengths.length,"S / ",S.weaknesses.length,"W / ",S.opportunities.length,"O / ",S.threats.length,"T"]}),S.tags&&S.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:S.tags.map((U,G)=>e.jsx(he,{variant:"outline",className:"text-xs",children:U},G))})]})]},S.id))})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{children:"Select Tags to Extract"}),e.jsx("div",{className:"flex flex-wrap gap-2 p-3 border rounded-lg",children:b.map(S=>{const U=h.has(S);return e.jsxs(he,{variant:U?"default":"outline",className:"cursor-pointer transition-all",onClick:()=>w(S),children:[S,U&&e.jsx(_c,{className:"h-3 w-3 ml-1"})]},S)})})]}),A&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Preview:"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-center text-xs",children:[e.jsxs("div",{className:"p-2 bg-green-100 dark:bg-green-900/30 rounded",children:[e.jsx("div",{className:"font-bold text-green-600 dark:text-green-400",children:z.strengths}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Strengths"})]}),e.jsxs("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 rounded",children:[e.jsx("div",{className:"font-bold text-red-600 dark:text-red-400",children:z.weaknesses}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Weaknesses"})]}),e.jsxs("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded",children:[e.jsx("div",{className:"font-bold text-blue-600 dark:text-blue-400",children:z.opportunities}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Opportunities"})]}),e.jsxs("div",{className:"p-2 bg-orange-100 dark:bg-orange-900/30 rounded",children:[e.jsx("div",{className:"font-bold text-orange-600 dark:text-orange-400",children:z.threats}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Threats"})]})]})]})]}),e.jsxs(Wn,{children:[e.jsx(te,{variant:"outline",onClick:v,children:"Cancel"}),e.jsx(te,{onClick:o==="merge"?N:u,disabled:!A,children:o==="merge"?"Merge Selected":"Extract Items"})]})]})})}function Gn({open:r,onClose:t,onLink:s,alreadyLinked:n=[],title:i="Link Evidence",description:o="Search and select evidence to link to this analysis"}){const[l,a]=B.useState(""),[c,p]=B.useState("data"),[d,m]=B.useState(new Map),[y,h]=B.useState(!1),[_,b]=B.useState([]),[N,u]=B.useState([]),[v,g]=B.useState([]),[w,k]=B.useState([]);B.useEffect(()=>{r&&A()},[r,c]);const A=async()=>{h(!0);try{switch(c){case"data":const q=await fetch("/api/evidence-items");if(q.ok){const K=await q.json();b(K.evidence||[])}break;case"actor":const W=await fetch("/api/actors?workspace_id=1");if(W.ok){const K=await W.json();u(K.actors||[])}break;case"source":const $=await fetch("/api/sources?workspace_id=1");if($.ok){const K=await $.json();g(K.sources||[])}break;case"event":const ne=await fetch("/api/events?workspace_id=1");if(ne.ok){const K=await ne.json();k(K.events||[])}break}}catch(q){console.error("Failed to load evidence:",q)}finally{h(!1)}},T=(q,W)=>`${q}-${W}`,z=(q,W)=>d.has(T(q,W)),S=(q,W)=>n.some($=>$.entity_type===q&&String($.entity_id)===String(W)),U=(q,W,$)=>{const ne=T(q,W),K=new Map(d);K.has(ne)?K.delete(ne):K.set(ne,{entity_type:q,entity_id:W,entity_data:$}),m(K)},G=()=>{s(Array.from(d.values())),m(new Map),t()},F=(q,W)=>{if(!W)return q;const $=W.toLowerCase();return q.filter(ne=>{const K=ne.title||ne.name||"",P=ne.description||"";return K.toLowerCase().includes($)||P.toLowerCase().includes($)})},C=q=>{if(q.eve_assessment?.overall_risk){const W=q.eve_assessment.overall_risk,$={LOW:"bg-green-100 text-green-800",MEDIUM:"bg-yellow-100 text-yellow-800",HIGH:"bg-orange-100 text-orange-800",CRITICAL:"bg-red-100 text-red-800"};return e.jsx(he,{className:$[W],children:W})}if(q.deception_profile?.mom){const{motive:W,opportunity:$,means:ne}=q.deception_profile.mom,K=((W||0)+($||0)+(ne||0))/3;return K>=4?e.jsx(he,{className:"bg-red-100 text-red-800",children:"High Risk"}):K>=3?e.jsx(he,{className:"bg-orange-100 text-orange-800",children:"Medium Risk"}):K>=1.5?e.jsx(he,{className:"bg-yellow-100 text-yellow-800",children:"Low Risk"}):e.jsx(he,{className:"bg-green-100 text-green-800",children:"Minimal Risk"})}if(q.moses_assessment?.reliability){const W=q.moses_assessment.reliability,$={A:"bg-green-100 text-green-800",B:"bg-blue-100 text-blue-800",C:"bg-yellow-100 text-yellow-800",D:"bg-orange-100 text-orange-800",E:"bg-red-100 text-red-800",F:"bg-gray-100 text-gray-800"};return e.jsxs(he,{className:$[W]||$.F,children:["Reliability: ",W]})}return null},j=(q,W)=>{const $=q.id,ne=z(W,$),K=S(W,$);return e.jsx(ge,{className:`cursor-pointer transition-all ${ne?"ring-2 ring-blue-500":""} ${K?"opacity-50":"hover:shadow-md"}`,onClick:()=>!K&&U(W,$,q),children:e.jsx(xe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ts,{checked:ne,disabled:K,className:"mt-1"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h4",{className:"font-semibold text-sm truncate",children:q.title||q.name}),K&&e.jsxs(he,{variant:"outline",className:"shrink-0",children:[e.jsx(gr,{className:"h-3 w-3 mr-1"}),"Linked"]})]}),q.description&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1 line-clamp-2",children:q.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 flex-wrap",children:[e.jsxs(he,{variant:"outline",className:"text-xs",children:[W==="data"&&q.evidence_type,W==="actor"&&q.type,W==="source"&&q.type,W==="event"&&q.event_type]}),C(q),q.created_at&&e.jsx("span",{className:"text-xs text-gray-500",children:new Date(q.created_at).toLocaleDateString()})]})]})]})})},$)},D=q=>{const $={data:nr,actor:ur,source:os,event:dr}[q];return e.jsx($,{className:"h-4 w-4"})},J=()=>{switch(c){case"data":return F(_,l);case"actor":return F(N,l);case"source":return F(v,l);case"event":return F(w,l);default:return[]}};return e.jsx(wt,{open:r,onOpenChange:t,children:e.jsxs(jt,{className:"max-w-4xl max-h-[90vh]",children:[e.jsxs(_t,{children:[e.jsxs(kt,{className:"flex items-center gap-2",children:[e.jsx(rr,{className:"h-5 w-5"}),i]}),e.jsx(It,{children:o})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ir,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Ee,{placeholder:"Search evidence...",value:l,onChange:q=>a(q.target.value),className:"pl-10"})]}),e.jsxs(Ar,{value:c,onValueChange:q=>p(q),children:[e.jsxs(Tr,{className:"grid w-full grid-cols-4",children:[e.jsxs(Ye,{value:"data",className:"flex items-center gap-2",children:[D("data"),"Data"]}),e.jsxs(Ye,{value:"actor",className:"flex items-center gap-2",children:[D("actor"),"Actors"]}),e.jsxs(Ye,{value:"source",className:"flex items-center gap-2",children:[D("source"),"Sources"]}),e.jsxs(Ye,{value:"event",className:"flex items-center gap-2",children:[D("event"),"Events"]})]}),e.jsx("div",{className:"mt-4 max-h-[400px] overflow-y-auto space-y-2",children:y?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading..."}):J().length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["No ",c," items found"]}):J().map(q=>j(q,c))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[d.size," item",d.size!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{variant:"outline",onClick:t,children:"Cancel"}),e.jsxs(te,{onClick:G,disabled:d.size===0,children:[e.jsx(rr,{className:"h-4 w-4 mr-2"}),"Link Selected (",d.size,")"]})]})]})]})]})})}function Hm({linkedEvidence:r,onClick:t,showBreakdown:s=!1,size:n="md"}){const i=r.length;if(i===0)return null;const o=()=>{let h=0,_=0;if(r.forEach(N=>{const u=N.entity_data;if(u.eve_assessment?.overall_risk&&(h+={LOW:1,MEDIUM:2,HIGH:3,CRITICAL:4}[u.eve_assessment.overall_risk]||0,_++),u.deception_profile?.mom){const{motive:v,opportunity:g,means:w}=u.deception_profile.mom,k=((v||0)+(g||0)+(w||0))/3;h+=k>=4?4:k>=3?3:k>=1.5?2:1,_++}u.moses_assessment?.reliability&&(h+={A:1,B:1,C:2,D:3,E:4,F:2}[u.moses_assessment.reliability]||2,_++)}),_===0)return"low";const b=h/_;return b>=3.5?"critical":b>=2.5?"high":b>=1.5?"medium":"low"},l={data:r.filter(h=>h.entity_type==="data").length,actor:r.filter(h=>h.entity_type==="actor").length,source:r.filter(h=>h.entity_type==="source").length,event:r.filter(h=>h.entity_type==="event").length},a=o(),c=()=>{switch(a){case"critical":return"bg-red-100 text-red-800 border-red-300 hover:bg-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-300 hover:bg-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-300 hover:bg-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-300 hover:bg-green-200"}},p=()=>a==="critical"||a==="high"?e.jsx(Rr,{className:"h-3 w-3"}):e.jsx(jr,{className:"h-3 w-3"}),d={sm:"text-xs px-2 py-0.5",md:"text-sm px-2.5 py-1",lg:"text-base px-3 py-1.5"},m=()=>e.jsxs("div",{className:"space-y-2 min-w-[200px]",children:[e.jsxs("div",{className:"font-semibold border-b pb-1",children:["Linked Evidence (",i,")"]}),l.data>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(nr,{className:"h-4 w-4"}),e.jsxs("span",{children:[l.data," Data item",l.data!==1?"s":""]})]}),l.actor>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ur,{className:"h-4 w-4"}),e.jsxs("span",{children:[l.actor," Actor",l.actor!==1?"s":""]})]}),l.source>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(os,{className:"h-4 w-4"}),e.jsxs("span",{children:[l.source," Source",l.source!==1?"s":""]})]}),l.event>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(dr,{className:"h-4 w-4"}),e.jsxs("span",{children:[l.event," Event",l.event!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm pt-2 border-t",children:[p(),e.jsxs("span",{children:["Risk Level: ",e.jsx("strong",{className:"capitalize",children:a})]})]}),t&&e.jsx("div",{className:"text-xs text-gray-500 pt-1",children:"Click to manage evidence"})]}),y=e.jsxs(he,{className:`${c()} ${d[n]} flex items-center gap-1.5 border ${t?"cursor-pointer":""}`,onClick:t,children:[e.jsx(rr,{className:n==="sm"?"h-3 w-3":"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:i}),s&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs opacity-75",children:"|"}),l.data>0&&e.jsx(nr,{className:"h-3 w-3 opacity-75"}),l.actor>0&&e.jsx(ur,{className:"h-3 w-3 opacity-75"}),l.source>0&&e.jsx(os,{className:"h-3 w-3 opacity-75"}),l.event>0&&e.jsx(dr,{className:"h-3 w-3 opacity-75"})]})]});return e.jsx(qt,{children:e.jsxs(Ct,{delayDuration:300,children:[e.jsx(Et,{asChild:!0,children:y}),e.jsx(At,{side:"top",className:"max-w-xs",children:m()})]})})}function Dd({evidence:r,onRemove:t,showDetails:s=!0}){const n=()=>{switch(r.entity_type){case"data":return e.jsx(nr,{className:"h-3 w-3"});case"actor":return e.jsx(ur,{className:"h-3 w-3"});case"source":return e.jsx(os,{className:"h-3 w-3"});case"event":return e.jsx(dr,{className:"h-3 w-3"})}},i=()=>({data:"Data",actor:"Actor",source:"Source",event:"Event"})[r.entity_type],o=()=>{const a=r.entity_data;return a.title?a.title:a.name?a.name:a.text&&a.text.length>0?a.text.substring(0,50)+(a.text.length>50?"...":""):`${i()} #${r.entity_id}`},l=()=>{switch(r.entity_type){case"data":return"border-blue-300 bg-blue-50 text-blue-700 hover:bg-blue-100";case"actor":return"border-purple-300 bg-purple-50 text-purple-700 hover:bg-purple-100";case"source":return"border-green-300 bg-green-50 text-green-700 hover:bg-green-100";case"event":return"border-orange-300 bg-orange-50 text-orange-700 hover:bg-orange-100"}};return e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-md border ${l()}`,children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[n(),e.jsx("span",{className:"text-xs font-medium",children:i()})]}),s&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs opacity-50",children:"â€¢"}),e.jsx("span",{className:"text-xs max-w-[150px] truncate",title:o(),children:o()})]}),r.relation&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs opacity-50",children:"â€¢"}),e.jsx(he,{variant:"outline",className:"text-[10px] px-1 py-0 h-4",children:r.relation})]}),t&&e.jsx(te,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),t()},className:"h-4 w-4 p-0 ml-1 hover:bg-transparent",children:e.jsx(Ze,{className:"h-3 w-3"})})]})}function Gm({linkedEvidence:r,onUnlink:t,onUpdateNotes:s,onClose:n,title:i="Linked Evidence"}){const[o,l]=B.useState("all"),[a,c]=B.useState(new Set),[p,d]=B.useState(null),m=g=>{const w=new Set(a);w.has(g)?w.delete(g):w.add(g),c(w)},y=g=>o==="all"?g:g.filter(w=>w.entity_type===o),h=g=>{if(!g)return null;const w={supports:"bg-green-100 text-green-800",contradicts:"bg-red-100 text-red-800",neutral:"bg-gray-100 text-gray-800",contextual:"bg-blue-100 text-blue-800",referenced:"bg-purple-100 text-purple-800"};return e.jsx(he,{className:w[g]||"",variant:"outline",children:g})},_=g=>{if(g.eve_assessment?.overall_risk){const w=g.eve_assessment.overall_risk,k={LOW:"bg-green-100 text-green-800",MEDIUM:"bg-yellow-100 text-yellow-800",HIGH:"bg-orange-100 text-orange-800",CRITICAL:"bg-red-100 text-red-800"};return e.jsx(he,{className:k[w],children:w})}if(g.deception_profile?.mom){const{motive:w,opportunity:k,means:A}=g.deception_profile.mom,T=((w||0)+(k||0)+(A||0))/3;if(T>=4)return e.jsx(he,{className:"bg-red-100 text-red-800",children:"High Risk"});if(T>=3)return e.jsx(he,{className:"bg-orange-100 text-orange-800",children:"Med Risk"});if(T>=1.5)return e.jsx(he,{className:"bg-yellow-100 text-yellow-800",children:"Low Risk"})}if(g.moses_assessment?.reliability){const w=g.moses_assessment.reliability;return e.jsxs(he,{variant:"outline",children:["Rel: ",w]})}return null},b=g=>`${g.entity_type}-${g.entity_id}`,N=g=>{const w=g.entity_data,k=b(g),A=a.has(k),T=()=>{const G={data:nr,actor:ur,source:os,event:dr}[g.entity_type];return e.jsx(G,{className:"h-4 w-4"})},z=()=>"title"in w?w.title:"name"in w?w.name:"Untitled",S=()=>g.entity_type==="data"?w.evidence_type:g.entity_type==="actor"||g.entity_type==="source"?w.type:g.entity_type==="event"?w.event_type:g.entity_type;return e.jsxs(ge,{className:"mb-3",children:[e.jsx(Ce,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("button",{onClick:()=>m(k),className:"flex-1 flex items-start gap-2 text-left hover:opacity-70",children:[A?e.jsx(es,{className:"h-4 w-4 mt-0.5 shrink-0"}):e.jsx(Xs,{className:"h-4 w-4 mt-0.5 shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[T(),e.jsx("span",{className:"font-semibold text-sm truncate",children:z()})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(he,{variant:"outline",className:"text-xs",children:S()}),h(g.relation),_(w)]})]})]}),e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>t(g.entity_type,g.entity_id),className:"shrink-0",children:e.jsx(vs,{className:"h-4 w-4"})})]})}),A&&e.jsxs(xe,{className:"p-4 pt-0 space-y-3 border-t",children:[w.description&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:w.description})]}),g.entity_type==="data"&&w.what&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:"What"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:w.what})]}),g.entity_type==="actor"&&w.affiliation&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Affiliation"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:w.affiliation})]}),g.entity_type==="event"&&w.date_start&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Date"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:new Date(w.date_start).toLocaleDateString()})]}),g.relevance_score&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Relevance"}),e.jsxs("div",{className:"flex items-center gap-1",children:[Array.from({length:10}).map((U,G)=>e.jsx("div",{className:`h-2 w-2 rounded-full ${G<g.relevance_score?"bg-blue-500":"bg-gray-200"}`},G)),e.jsxs("span",{className:"text-xs text-gray-600 ml-1",children:[g.relevance_score,"/10"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-600",children:"Notes"}),g.link_id&&s&&p!==g.link_id&&e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>d(g.link_id),children:e.jsx(Zg,{className:"h-3 w-3"})})]}),p===g.link_id?e.jsx("div",{className:"space-y-2",children:e.jsx($e,{defaultValue:g.notes||"",placeholder:"Add notes about this evidence...",rows:3,onBlur:U=>{g.link_id&&s&&s(g.link_id,U.target.value),d(null)},autoFocus:!0})}):e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 italic",children:g.notes||"No notes added"})]})]})]},k)},u=y(r),v={data:r.filter(g=>g.entity_type==="data").length,actor:r.filter(g=>g.entity_type==="actor").length,source:r.filter(g=>g.entity_type==="source").length,event:r.filter(g=>g.entity_type==="event").length};return e.jsxs("div",{className:"h-full flex flex-col bg-white dark:bg-gray-900 border-l",children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:i}),e.jsxs("p",{className:"text-xs text-gray-500",children:[r.length," item",r.length!==1?"s":""," linked"]})]}),n&&e.jsx(te,{variant:"ghost",size:"sm",onClick:n,children:e.jsx(Ze,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"p-4 border-b",children:e.jsx(Ar,{value:o,onValueChange:g=>l(g),children:e.jsxs(Tr,{className:"grid w-full grid-cols-5",children:[e.jsxs(Ye,{value:"all",className:"text-xs",children:["All (",r.length,")"]}),e.jsxs(Ye,{value:"data",className:"text-xs",children:[e.jsx(nr,{className:"h-3 w-3 mr-1"}),v.data]}),e.jsxs(Ye,{value:"actor",className:"text-xs",children:[e.jsx(ur,{className:"h-3 w-3 mr-1"}),v.actor]}),e.jsxs(Ye,{value:"source",className:"text-xs",children:[e.jsx(os,{className:"h-3 w-3 mr-1"}),v.source]}),e.jsxs(Ye,{value:"event",className:"text-xs",children:[e.jsx(dr,{className:"h-3 w-3 mr-1"}),v.event]})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:u.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(nr,{className:"h-12 w-12 mx-auto mb-2 opacity-30"}),e.jsxs("p",{className:"text-sm",children:["No ",o!=="all"?o:""," evidence linked"]})]}):u.map(N)})]})}function Vm({open:r,onClose:t,onEntityCreated:s,defaultTab:n="data",frameworkContext:i}){const[o,l]=B.useState(n),[a,c]=B.useState(!1),[p,d]=B.useState({title:"",what:"",when:"",where:"",who:"",evidence_type:"official_document"}),[m,y]=B.useState({name:"",type:"PERSON",affiliation:"",description:""}),[h,_]=B.useState({name:"",type:"WEBSITE",description:"",url:""}),[b,N]=B.useState({name:"",event_type:"incident",date_start:"",location:"",description:""}),u=()=>{d({title:"",what:"",when:"",where:"",who:"",evidence_type:"official_document"}),y({name:"",type:"PERSON",affiliation:"",description:""}),_({name:"",type:"WEBSITE",description:"",url:""}),N({name:"",event_type:"incident",date_start:"",location:"",description:""})},v=()=>{u(),t()},g=async()=>{if(!p.title||!p.what){alert("Please fill in required fields (Title and What)");return}c(!0);try{const T=await fetch("/api/evidence-items",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("omnicore_user_hash")||""}`},body:JSON.stringify({title:p.title,description:p.what,evidence_type:p.evidence_type,when_occurred:p.when,where_occurred:p.where,who_involved:p.who,credibility:"3",reliability:"C",confidence_level:"medium",tags:[],status:"active"})});if(T.ok){const z=await T.json();s("data",z.evidence),v()}else{const z=await T.json();alert(`Failed to create data: ${z.error}`)}}catch(T){console.error("Failed to create data:",T),alert("Failed to create data")}finally{c(!1)}},w=async()=>{if(!m.name){alert("Please enter actor name");return}c(!0);try{const T=await fetch("/api/actors",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("omnicore_user_hash")||""}`},body:JSON.stringify({...m,workspace_id:1})});if(T.ok){const z=await T.json();s("actor",z.actor),v()}else{const z=await T.json();alert(`Failed to create actor: ${z.error}`)}}catch(T){console.error("Failed to create actor:",T),alert("Failed to create actor")}finally{c(!1)}},k=async()=>{if(!h.name){alert("Please enter source name");return}c(!0);try{const T=await fetch("/api/sources",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("omnicore_user_hash")||""}`},body:JSON.stringify({...h,workspace_id:1})});if(T.ok){const z=await T.json();s("source",z.source),v()}else{const z=await T.json();alert(`Failed to create source: ${z.error}`)}}catch(T){console.error("Failed to create source:",T),alert("Failed to create source")}finally{c(!1)}},A=async()=>{if(!b.name||!b.date_start){alert("Please fill in required fields (Name and Date)");return}c(!0);try{const T=await fetch("/api/events",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("omnicore_user_hash")||""}`},body:JSON.stringify({...b,workspace_id:1})});if(T.ok){const z=await T.json();s("event",z.event),v()}else{const z=await T.json();alert(`Failed to create event: ${z.error}`)}}catch(T){console.error("Failed to create event:",T),alert("Failed to create event")}finally{c(!1)}};return e.jsx(wt,{open:r,onOpenChange:v,children:e.jsxs(jt,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(_t,{children:e.jsx(kt,{children:"Create & Link Entity"})}),e.jsxs(Ar,{value:o,onValueChange:T=>l(T),children:[e.jsxs(Tr,{className:"grid w-full grid-cols-4",children:[e.jsxs(Ye,{value:"data",children:[e.jsx(nr,{className:"h-4 w-4 mr-2"}),"Data"]}),e.jsxs(Ye,{value:"actor",children:[e.jsx(ur,{className:"h-4 w-4 mr-2"}),"Actor"]}),e.jsxs(Ye,{value:"source",children:[e.jsx(os,{className:"h-4 w-4 mr-2"}),"Source"]}),e.jsxs(Ye,{value:"event",children:[e.jsx(dr,{className:"h-4 w-4 mr-2"}),"Event"]})]}),e.jsxs(pt,{value:"data",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"data-title",children:"Title *"}),e.jsx(Ee,{id:"data-title",value:p.title,onChange:T=>d({...p,title:T.target.value}),placeholder:"Brief title for this data"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"data-type",children:"Evidence Type"}),e.jsxs(ct,{value:p.evidence_type,onValueChange:T=>d({...p,evidence_type:T}),children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsxs(ht,{children:[e.jsx(Te,{value:"official_document",children:"Official Document"}),e.jsx(Te,{value:"report",children:"Report"}),e.jsx(Te,{value:"testimony",children:"Testimony"}),e.jsx(Te,{value:"interview",children:"Interview"}),e.jsx(Te,{value:"audio",children:"Audio"}),e.jsx(Te,{value:"video",children:"Video"}),e.jsx(Te,{value:"photo",children:"Photo"}),e.jsx(Te,{value:"email",children:"Email"}),e.jsx(Te,{value:"social_media",children:"Social Media"}),e.jsx(Te,{value:"news_article",children:"News Article"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"data-what",children:"What (Description) *"}),e.jsx($e,{id:"data-what",value:p.what,onChange:T=>d({...p,what:T.target.value}),placeholder:"What is this evidence about?",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"data-when",children:"When"}),e.jsx(Ee,{id:"data-when",value:p.when,onChange:T=>d({...p,when:T.target.value}),placeholder:"Time/date information"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"data-where",children:"Where"}),e.jsx(Ee,{id:"data-where",value:p.where,onChange:T=>d({...p,where:T.target.value}),placeholder:"Location information"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"data-who",children:"Who"}),e.jsx(Ee,{id:"data-who",value:p.who,onChange:T=>d({...p,who:T.target.value}),placeholder:"People or organizations involved"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(te,{variant:"outline",onClick:v,disabled:a,children:"Cancel"}),e.jsx(te,{onClick:g,disabled:a,children:a?"Creating...":"Create & Link Data"})]})]}),e.jsxs(pt,{value:"actor",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"actor-name",children:"Name *"}),e.jsx(Ee,{id:"actor-name",value:m.name,onChange:T=>y({...m,name:T.target.value}),placeholder:"Actor name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"actor-type",children:"Type"}),e.jsxs(ct,{value:m.type,onValueChange:T=>y({...m,type:T}),children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsxs(ht,{children:[e.jsx(Te,{value:"PERSON",children:"Person"}),e.jsx(Te,{value:"ORGANIZATION",children:"Organization"}),e.jsx(Te,{value:"GROUP",children:"Group"}),e.jsx(Te,{value:"GOVERNMENT",children:"Government"}),e.jsx(Te,{value:"UNIT",children:"Unit"}),e.jsx(Te,{value:"OTHER",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"actor-affiliation",children:"Affiliation"}),e.jsx(Ee,{id:"actor-affiliation",value:m.affiliation,onChange:T=>y({...m,affiliation:T.target.value}),placeholder:"Organization or group affiliation"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"actor-description",children:"Description"}),e.jsx($e,{id:"actor-description",value:m.description,onChange:T=>y({...m,description:T.target.value}),placeholder:"Additional details about this actor",rows:4})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(te,{variant:"outline",onClick:v,disabled:a,children:"Cancel"}),e.jsx(te,{onClick:w,disabled:a,children:a?"Creating...":"Create & Link Actor"})]})]}),e.jsxs(pt,{value:"source",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"source-name",children:"Name *"}),e.jsx(Ee,{id:"source-name",value:h.name,onChange:T=>_({...h,name:T.target.value}),placeholder:"Source name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"source-type",children:"Type"}),e.jsxs(ct,{value:h.type,onValueChange:T=>_({...h,type:T}),children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsxs(ht,{children:[e.jsx(Te,{value:"PERSON",children:"Person"}),e.jsx(Te,{value:"DOCUMENT",children:"Document"}),e.jsx(Te,{value:"WEBSITE",children:"Website"}),e.jsx(Te,{value:"DATABASE",children:"Database"}),e.jsx(Te,{value:"MEDIA",children:"Media"}),e.jsx(Te,{value:"SYSTEM",children:"System"}),e.jsx(Te,{value:"ORGANIZATION",children:"Organization"}),e.jsx(Te,{value:"OTHER",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"source-url",children:"URL"}),e.jsx(Ee,{id:"source-url",type:"url",value:h.url,onChange:T=>_({...h,url:T.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"source-description",children:"Description"}),e.jsx($e,{id:"source-description",value:h.description,onChange:T=>_({...h,description:T.target.value}),placeholder:"Additional details about this source",rows:4})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(te,{variant:"outline",onClick:v,disabled:a,children:"Cancel"}),e.jsx(te,{onClick:k,disabled:a,children:a?"Creating...":"Create & Link Source"})]})]}),e.jsxs(pt,{value:"event",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"event-name",children:"Name *"}),e.jsx(Ee,{id:"event-name",value:b.name,onChange:T=>N({...b,name:T.target.value}),placeholder:"Event name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"event-type",children:"Event Type"}),e.jsxs(ct,{value:b.event_type,onValueChange:T=>N({...b,event_type:T}),children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsxs(ht,{children:[e.jsx(Te,{value:"incident",children:"Incident"}),e.jsx(Te,{value:"meeting",children:"Meeting"}),e.jsx(Te,{value:"activity",children:"Activity"}),e.jsx(Te,{value:"operation",children:"Operation"}),e.jsx(Te,{value:"milestone",children:"Milestone"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"event-date",children:"Date *"}),e.jsx(Ee,{id:"event-date",type:"date",value:b.date_start,onChange:T=>N({...b,date_start:T.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"event-location",children:"Location"}),e.jsx(Ee,{id:"event-location",value:b.location,onChange:T=>N({...b,location:T.target.value}),placeholder:"Event location"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"event-description",children:"Description"}),e.jsx($e,{id:"event-description",value:b.description,onChange:T=>N({...b,description:T.target.value}),placeholder:"Additional details about this event",rows:4})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(te,{variant:"outline",onClick:v,disabled:a,children:"Cancel"}),e.jsx(te,{onClick:A,disabled:a,children:a?"Creating...":"Create & Link Event"})]})]})]})]})})}function p0(){const r={"Content-Type":"application/json"},t=localStorage.getItem("omnicore_token");t&&(r.Authorization=`Bearer ${t}`);const s=localStorage.getItem("user_hash");return s&&(r["X-User-Hash"]=s),r}const qa={single_action:{label:"Single Action",color:"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300"},simple_sequence:{label:"Simple Sequence",color:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300"},complex_process:{label:"Complex Process",color:"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300"},ongoing_practice:{label:"Ongoing Practice",color:"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300"}};function f0({open:r,onOpenChange:t,onSelect:s}){const{currentWorkspaceId:n}=Kr(),[i,o]=B.useState(""),[l,a]=B.useState([]),[c,p]=B.useState(!1);B.useEffect(()=>{if(!r)return;(async()=>{p(!0);try{const h=await fetch(`/api/frameworks?type=behavior&limit=50&workspace_id=${n}`,{headers:p0()});if(h.ok){const _=await h.json();a(_.sessions||[])}}catch(h){console.error("Failed to load behaviors:",h)}finally{p(!1)}})()},[r]);const d=l.filter(y=>{const h=i.toLowerCase();return y.title?.toLowerCase().includes(h)||y.description?.toLowerCase().includes(h)}),m=y=>{let h={},_=[];try{h=y.data?JSON.parse(y.data):{}}catch(b){console.error("Failed to parse behavior data:",b,y.data),h={}}try{_=y.tags?JSON.parse(y.tags):[]}catch(b){console.error("Failed to parse behavior tags:",b,y.tags),_=[]}s({id:y.id,title:y.title,description:y.description,location_context:h.location_context,settings:h.behavior_settings?.settings||[],complexity:h.complexity,category:h.category,tags:_,created_at:y.created_at,upvotes:0,usage_count:0}),t(!1)};return e.jsx(wt,{open:r,onOpenChange:t,children:e.jsxs(jt,{className:"max-w-3xl max-h-[80vh] flex flex-col",children:[e.jsxs(_t,{children:[e.jsxs(kt,{className:"flex items-center gap-2",children:[e.jsx(Hn,{className:"h-5 w-5"}),"Link Existing Behavior"]}),e.jsx(It,{children:"Search and link an existing behavior analysis to this timeline event"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ir,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Ee,{placeholder:"Search behaviors by title or description...",value:i,onChange:y=>o(y.target.value),className:"pl-10"})]}),e.jsx(ca,{className:"flex-1 -mx-6 px-6",children:c?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Loading behaviors..."}):d.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:i?"No behaviors found matching your search":"No behaviors available"}):e.jsx("div",{className:"space-y-3 py-2",children:d.map(y=>{let h={};try{h=y.data?JSON.parse(y.data):{}}catch(u){console.error("Failed to parse behavior data:",u,y.data),h={}}const _=h.complexity,b=h.location_context?.specific_locations||[],N=h.behavior_settings?.settings||[];return e.jsx("div",{className:"border rounded-lg p-4 hover:border-blue-500 cursor-pointer transition-colors",onClick:()=>m(y),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-lg mb-1 truncate",children:y.title}),y.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2 mb-2",children:y.description}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[_&&qa[_]&&e.jsxs(he,{variant:"outline",className:qa[_].color,children:[e.jsx(Tm,{className:"h-3 w-3 mr-1"}),qa[_].label]}),b.length>0&&e.jsxs(he,{variant:"outline",children:[e.jsx(bs,{className:"h-3 w-3 mr-1"}),b[0],b.length>1&&` +${b.length-1}`]}),N.length>0&&e.jsxs(he,{variant:"outline",children:[N[0],N.length>1&&` +${N.length-1}`]}),h.temporal_context?.frequency_pattern&&e.jsxs(he,{variant:"outline",children:[e.jsx(dr,{className:"h-3 w-3 mr-1"}),h.temporal_context.frequency_pattern.replace("_"," ")]})]})]}),e.jsx(te,{size:"sm",variant:"outline",children:"Link"})]})},y.id)})})})]})})}function Km({events:r,onChange:t,readOnly:s=!1}){const[n,i]=B.useState(new Set),[o,l]=B.useState(null),[a,c]=B.useState(null),[p,d]=B.useState(!1),[m,y]=B.useState(null),h=r.map((G,F)=>({...G,order:F})),_=G=>G.map(({order:F,...C})=>C),b=()=>{const G={id:`event-${Date.now()}-${Math.random()}`,label:"",order:h.length};t(_([...h,G])),l(G.id)},N=G=>{const F=h.map(C=>C.id===G?{...C,sub_steps:[...C.sub_steps||[],{label:"",description:"",duration:""}]}:C);t(_(F)),i(new Set([...n,G]))},u=G=>{const F=h.map(C=>C.id===G?{...C,forks:[...C.forks||[],{condition:"",label:"",path:[]}]}:C);t(_(F)),i(new Set([...n,G]))},v=(G,F)=>{const C=h.map(j=>j.id===G?{...j,...F}:j);t(_(C))},g=G=>{const F=h.filter(C=>C.id!==G);t(_(F))},w=(G,F)=>{const C=h.findIndex(W=>W.id===G);if(C===-1)return;const j=F==="left"?C-1:C+1;if(j<0||j>=h.length)return;const D=[...h],J=D[C];D[C]=D[j],D[j]=J;const q=D.map((W,$)=>({...W,order:$}));t(_(q))},k=G=>{c(G)},A=G=>{G.preventDefault()},T=G=>{if(!a||a===G){c(null);return}const F=(D,J)=>D.findIndex(q=>q.id===J),C=F(h,a),j=F(h,G);if(C!==-1&&j!==-1){const D=[...h],J=D[C];D.splice(C,1),D.splice(j,0,J),t(_(D.map((q,W)=>({...q,order:W}))))}c(null)},z=G=>{m&&(v(m,{linked_behavior_id:G.id,linked_behavior_title:G.title,linked_behavior_type:G.complexity}),d(!1),y(null))},S=G=>{v(G,{linked_behavior_id:void 0,linked_behavior_title:void 0,linked_behavior_type:void 0})},U=G=>{const F=o===G.id;return e.jsx("div",{className:"relative",children:e.jsx("div",{className:"relative mb-3",draggable:!s&&!F,onDragStart:()=>k(G.id),onDragOver:A,onDrop:()=>T(G.id),children:e.jsx(ge,{className:cr("transition-all",a===G.id&&"opacity-50"),children:e.jsxs(xe,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[!s&&e.jsx("div",{className:"cursor-move text-gray-400 mt-1",children:e.jsx(ex,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-1 min-w-0",children:F?e.jsxs("div",{className:"space-y-3",children:[e.jsx(Ee,{value:G.label,onChange:C=>v(G.id,{label:C.target.value}),placeholder:"Event label (e.g., 'Individual decides to participate')",autoFocus:!0}),e.jsx($e,{value:G.description||"",onChange:C=>v(G.id,{description:C.target.value}),placeholder:"Description (optional)",rows:2}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(Ee,{value:G.time||"",onChange:C=>v(G.id,{time:C.target.value}),placeholder:"Time (e.g., 'Day 1', '9:00 AM')"}),e.jsx(Ee,{value:G.location||"",onChange:C=>v(G.id,{location:C.target.value}),placeholder:"Location"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{size:"sm",onClick:()=>l(null),disabled:!G.label.trim(),children:"Done"}),e.jsx(te,{size:"sm",variant:"outline",onClick:()=>l(null),children:"Cancel"})]})]}):e.jsx("div",{onClick:()=>!s&&l(G.id),className:s?"":"cursor-pointer",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm",children:G.label||e.jsx("span",{className:"text-gray-400 italic",children:"Untitled event"})}),G.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:G.description}),e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-gray-500",children:[G.time&&e.jsxs("span",{children:["ðŸ• ",G.time]}),G.location&&e.jsxs("span",{children:["ðŸ“ ",G.location]})]}),G.sub_steps&&G.sub_steps.length>0&&e.jsx("div",{className:"mt-2 pl-4 border-l-2 border-gray-300 space-y-1",children:G.sub_steps.map((C,j)=>e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"font-medium",children:[j+1,"."]})," ",C.label||"Untitled step",C.duration&&e.jsxs("span",{className:"ml-2 text-gray-500",children:["(",C.duration,")"]})]},j))}),G.forks&&G.forks.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:G.forks.map((C,j)=>e.jsxs("div",{className:"text-xs text-purple-600 dark:text-purple-400 flex items-start gap-1",children:[e.jsx(Cd,{className:"h-3 w-3 mt-0.5"}),e.jsx("span",{children:C.condition||C.label||"Alternative path"})]},j))}),G.linked_behavior_id&&e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsxs(he,{variant:"outline",className:"bg-blue-50 dark:bg-blue-900/30 border-blue-300 dark:border-blue-700 flex items-center gap-1",children:[e.jsx(Tm,{className:"h-3 w-3"}),e.jsx(Hn,{className:"h-3 w-3"}),"Linked: ",G.linked_behavior_title,G.linked_behavior_type&&e.jsxs("span",{className:"text-xs opacity-70",children:["(",G.linked_behavior_type.replace("_"," "),")"]})]}),!s&&e.jsx(te,{size:"sm",variant:"ghost",onClick:C=>{C.stopPropagation(),S(G.id)},className:"h-6 px-2 text-xs text-red-600 hover:text-red-700",children:"Unlink"})]})]}),!s&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(te,{size:"sm",variant:"ghost",onClick:C=>{C.stopPropagation(),w(G.id,"left")},title:"Move earlier in timeline",className:"h-7 w-7 p-0",children:"â†"}),e.jsx(te,{size:"sm",variant:"ghost",onClick:C=>{C.stopPropagation(),w(G.id,"right")},title:"Move later in timeline",className:"h-7 w-7 p-0",children:"â†’"}),e.jsx(te,{size:"sm",variant:"ghost",onClick:C=>{C.stopPropagation(),g(G.id)},className:"h-7 w-7 p-0 text-red-600 hover:text-red-700",children:e.jsx(vs,{className:"h-4 w-4"})})]})]})})})]}),!s&&!F&&e.jsxs("div",{className:"flex gap-2 mt-3 ml-8 flex-wrap",children:[e.jsxs(te,{size:"sm",variant:"outline",onClick:C=>{C.stopPropagation(),N(G.id)},className:"text-xs",children:[e.jsx(st,{className:"h-3 w-3 mr-1"}),"Add Sub-step"]}),e.jsxs(te,{size:"sm",variant:"outline",onClick:C=>{C.stopPropagation(),y(G.id),d(!0)},className:"text-xs text-blue-600 border-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900/20",children:[e.jsx(Hn,{className:"h-3 w-3 mr-1"}),"Link Behavior"]}),e.jsxs(te,{size:"sm",variant:"outline",onClick:C=>{C.stopPropagation(),u(G.id)},className:"text-xs text-purple-600 border-purple-300 hover:bg-purple-50 dark:hover:bg-purple-900/20",children:[e.jsx(Cd,{className:"h-3 w-3 mr-1"}),"Add Fork (Alternative)"]})]})]})})})},G.id)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Behavior Timeline"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Document when, where, and how long the behavior occurs. Add sub-steps and alternative paths (forks)."})]}),!s&&e.jsxs(te,{onClick:()=>b(),children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),"Add Event"]})]}),h.length===0?e.jsxs(ge,{className:"p-12 text-center bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:"ðŸ“…"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:'No timeline events yet. Click "Add Event" to begin mapping the behavior sequence.'})]}):e.jsx("div",{className:"space-y-2",children:h.sort((G,F)=>G.order-F.order).map(G=>U(G))}),!s&&e.jsxs("div",{className:"text-xs text-gray-500 space-y-1 mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Timeline Tips:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-800 dark:text-blue-200",children:[e.jsx("li",{children:"Drag events to reorder or use â† â†’ buttons to move chronologically"}),e.jsxs("li",{children:[e.jsx("strong",{children:"Sub-steps"}),": Break down complex events into detailed steps"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Link Behavior"}),": Connect timeline events to existing behavior analyses for composable workflows"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Forks"}),": Show alternative paths or parallel possibilities (marked with purple border)"]}),e.jsx("li",{children:"Click any event to edit time, location, and duration details"})]})]}),e.jsx(f0,{open:p,onOpenChange:d,onSelect:z})]})}const g0={physical_capability:["training","enablement","environmental_restructuring"],psychological_capability:["education","training","enablement"],physical_opportunity:["restriction","environmental_restructuring","enablement"],social_opportunity:["restriction","environmental_restructuring","modelling","enablement"],reflective_motivation:["education","persuasion","incentivisation","coercion","modelling","enablement"],automatic_motivation:["persuasion","incentivisation","coercion","training","restriction","environmental_restructuring","modelling","enablement"]},x0={education:{name:"Education",definition:"Increasing knowledge or understanding",examples:["Providing information to promote healthy eating","Teaching literacy skills","Public health awareness campaigns","Safety training workshops"],evidenceBase:"Most effective when combined with other interventions. Works best for reflective motivation and psychological capability deficits."},persuasion:{name:"Persuasion",definition:"Using communication to induce positive or negative feelings or stimulate action",examples:["Using imagery to motivate increases in physical activity","Promoting healthy behaviors through testimonials","Fear appeals for smoking cessation","Social marketing campaigns"],evidenceBase:"Effective for both reflective and automatic motivation. Often combined with education and modeling."},incentivisation:{name:"Incentivisation",definition:"Creating expectation of reward",examples:["Using prize draws to induce attempts to quit smoking","Financial incentives for health behaviors","Loyalty programs for desired behaviors","Recognition and awards systems"],evidenceBase:"Strong short-term effects on motivation. May require continued reinforcement for sustained behavior change."},coercion:{name:"Coercion",definition:"Creating expectation of punishment or cost",examples:["Raising the financial cost to reduce excessive alcohol consumption","Fines for undesired behaviors","Legal penalties for non-compliance","Social sanctions"],evidenceBase:"Can be effective but may have negative side effects. Consider ethical implications and acceptability."},training:{name:"Training",definition:"Imparting skills through repeated practice and feedback",examples:["Training healthcare professionals in behavior change methods","Skills workshops for smoking cessation","Physical rehabilitation programs","Communication skills training"],evidenceBase:"Highly effective for capability deficits. Requires active practice and feedback mechanisms."},restriction:{name:"Restriction",definition:"Using rules to reduce the opportunity to engage in the target behavior",examples:["Prohibiting smoking in public places","Age restrictions on alcohol purchase","Limiting access to unhealthy foods","Regulatory controls on advertising"],evidenceBase:"Effective for reducing opportunity for undesired behaviors. May face acceptability and equity challenges."},environmental_restructuring:{name:"Environmental Restructuring",definition:"Changing the physical or social context",examples:["Providing free fruit in schools","Designing buildings to promote stair use","Urban planning for walkability","Reorganizing workplace layouts"],evidenceBase:"Addresses both physical and social opportunity. Often sustainable and equitable but may require significant resources."},modelling:{name:"Modelling",definition:"Providing an example for people to aspire to or imitate",examples:["Using social norm feedback to reduce alcohol consumption","Celebrity endorsements of healthy behaviors","Peer support and mentoring programs","Demonstrating desired techniques"],evidenceBase:"Leverages social learning theory. Effective for social opportunity and motivation when models are credible and relatable."},enablement:{name:"Enablement",definition:"Increasing means/reducing barriers to increase capability or opportunity",examples:["Behavioral support for smoking cessation","Providing free or subsidized resources","Medication to reduce withdrawal symptoms","Assistive technologies and tools"],evidenceBase:"Broadly applicable across COM-B components. Often used in combination with other interventions for maximum effectiveness."}},Xm={education:["communication_marketing","guidelines","service_provision"],persuasion:["communication_marketing","guidelines","service_provision"],incentivisation:["communication_marketing","fiscal_measures","regulation","legislation","service_provision"],coercion:["fiscal_measures","regulation","legislation","service_provision"],training:["guidelines","service_provision"],restriction:["regulation","legislation","environmental_social_planning"],environmental_restructuring:["fiscal_measures","regulation","legislation","environmental_social_planning","service_provision"],modelling:["communication_marketing","guidelines","environmental_social_planning"],enablement:["communication_marketing","guidelines","fiscal_measures","regulation","legislation","environmental_social_planning","service_provision"]},y0={communication_marketing:{name:"Communication/Marketing",description:"Using print, electronic, telephonic or broadcast media",examples:["Mass media campaigns","Social media initiatives","Public service announcements","Health promotion materials"]},guidelines:{name:"Guidelines",description:"Creating documents that recommend or mandate practice",examples:["Clinical practice guidelines","Best practice recommendations","Professional standards","Organizational policies"]},fiscal_measures:{name:"Fiscal Measures",description:"Using the tax system to reduce or increase financial cost",examples:["Taxation on tobacco and alcohol","Subsidies for healthy foods","Tax incentives for desired behaviors","Financial penalties for violations"]},regulation:{name:"Regulation",description:"Establishing rules or principles of behavior or practice",examples:["Setting industry standards","Licensing requirements","Safety regulations","Advertising restrictions"]},legislation:{name:"Legislation",description:"Making or changing laws",examples:["Smoking bans in public places","Seatbelt laws","Age restrictions on purchases","Environmental protection laws"]},environmental_social_planning:{name:"Environmental/Social Planning",description:"Designing and controlling the physical or social environment",examples:["Urban planning for walkability","Workplace layout design","Community development programs","Infrastructure improvements"]},service_provision:{name:"Service Provision",description:"Delivering a service",examples:["Smoking cessation clinics","Health screening services","Counseling and support programs","Educational workshops"]}};function b0(r,t){return r==="major_barrier"?"high":r==="deficit"?["education","training","environmental_restructuring","enablement"].includes(t)?"high":"medium":"low"}function v0(r,t){const s={education:["Ensure information is accessible and culturally appropriate","Use multiple channels for delivery","Combine with skill-building components","Assess baseline knowledge before designing content"],persuasion:["Use credible and relatable messengers","Frame messages positively when possible","Consider emotional and rational appeals","Test messages with target audience"],incentivisation:["Design sustainable incentive structures","Consider intrinsic vs. extrinsic motivation","Monitor for unintended consequences","Plan for incentive withdrawal or reduction"],coercion:["Assess ethical implications carefully","Ensure fairness and equity in application","Provide support for compliance","Monitor for displacement or avoidance behaviors"],training:["Include repeated practice opportunities","Provide constructive feedback","Ensure trainers are qualified","Assess skill acquisition and retention"],restriction:["Consider acceptability and equity impacts","Ensure enforcement mechanisms are in place","Provide alternatives or support","Monitor for workarounds or black markets"],environmental_restructuring:["Conduct environmental assessment before changes","Engage stakeholders in design","Consider maintenance and sustainability","Evaluate impact on different population groups"],modelling:["Select credible and relatable models","Demonstrate complete behavior sequences","Make behavior observable and concrete","Reinforce positive role models"],enablement:["Identify specific barriers to address","Provide ongoing support and resources","Ensure accessibility and availability","Monitor utilization and outcomes"]},n={physical_capability:["Assess current physical abilities","Provide adaptive equipment if needed","Monitor for health and safety issues"],psychological_capability:["Address literacy and comprehension levels","Consider cognitive load and complexity","Provide decision aids if needed"],physical_opportunity:["Audit environmental barriers","Ensure equitable access to resources","Consider geographical and temporal factors"],social_opportunity:["Understand cultural context and norms","Engage community leaders and influencers","Address stigma and social barriers"],reflective_motivation:["Align with personal values and goals","Address competing priorities","Support goal-setting and planning"],automatic_motivation:["Address emotional barriers and triggers","Build positive associations and habits","Manage stress and negative emotions"]};return[...s[r],...n[t]]}function w0(r){const t=[],s={physical_capability:"Physical Capability",psychological_capability:"Psychological Capability",physical_opportunity:"Physical Opportunity",social_opportunity:"Social Opportunity",reflective_motivation:"Reflective Motivation",automatic_motivation:"Automatic Motivation"};for(const[n,i]of Object.entries(r)){if(i==="adequate")continue;const l=g0[n].map(a=>{const c=x0[a],p=b0(i,a),d=Xm[a],m=v0(a,n);return{name:a,priority:p,description:c.definition,evidence_base:c.evidenceBase,implementation_considerations:m,applicable_policies:d}});l.sort((a,c)=>{const p={high:0,medium:1,low:2};return p[a.priority]-p[c.priority]}),t.push({component:s[n],component_code:n,severity:i,interventions:l})}return t.sort((n,i)=>{const o={major_barrier:0,deficit:1,adequate:2};return o[n.severity]-o[i.severity]}),t}function j0(r){const t=new Set,s={communication_marketing:[],guidelines:[],fiscal_measures:[],regulation:[],legislation:[],environmental_social_planning:[],service_provision:[]};for(const i of r){const o=Xm[i];for(const l of o)t.add(l),s[l].push(i)}return Array.from(t).map(i=>{const o=y0[i];return{policy:i,name:o.name,description:o.description,suitable_for_interventions:s[i],examples:o.examples}})}function _0(r){let t=0,s=0,n=0;const i=[],o=[],l={physical_capability:"Physical Capability",psychological_capability:"Psychological Capability",physical_opportunity:"Physical Opportunity",social_opportunity:"Social Opportunity",reflective_motivation:"Reflective Motivation",automatic_motivation:"Automatic Motivation"};for(const[p,d]of Object.entries(r))d==="major_barrier"?(t++,i.push(`${l[p]} is a major barrier`)):d==="deficit"?(s++,i.push(`${l[p]} shows deficits`)):(n++,o.push(`${l[p]} is adequate`));let a;t>=3?a="low":t>=1||s>=4?a="medium":a="high";const c=[];return t>0&&(c.push("Address major barriers first before implementing other interventions"),c.push("Consider multi-component interventions targeting multiple COM-B domains")),s>2&&c.push("Prioritize interventions based on resource availability and evidence base"),n>=4&&c.push("Leverage existing strengths in capability, opportunity, or motivation"),c.push("Use the Behaviour Change Wheel to select appropriate intervention functions"),c.push("Consider policy categories to support and scale selected interventions"),{feasibility:a,barriers:i,strengths:o,recommendations:c}}function Ym({deficits:r,selectedInterventions:t=[],onInterventionSelect:s,readOnly:n=!1}){const[i,o]=B.useState(new Set),[l,a]=B.useState(new Set),c=w0(r),p=t.length>0?j0(t):[],d=_0(r),m=g=>{const w=new Set(i);w.has(g)?w.delete(g):w.add(g),o(w)},y=g=>{const w=new Set(l);w.has(g)?w.delete(g):w.add(g),a(w)},h=g=>{if(n||!s)return;const w=t.includes(g)?t.filter(k=>k!==g):[...t,g];s(w)},_=g=>{switch(g){case"high":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";case"medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"low":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"}},b=g=>{switch(g){case"major_barrier":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";case"deficit":return"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300";case"adequate":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"}},N=g=>{switch(g){case"high":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300";case"low":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"}},u={Physical_Capability:"ðŸ’ª",Psychological_Capability:"ðŸ§ ",Physical_Opportunity:"ðŸŒ",Social_Opportunity:"ðŸ‘¥",Reflective_Motivation:"ðŸŽ¯",Automatic_Motivation:"âš¡"},v={major_barrier:Object.values(r).filter(g=>g==="major_barrier").length,deficit:Object.values(r).filter(g=>g==="deficit").length,adequate:Object.values(r).filter(g=>g==="adequate").length};return c.length===0?e.jsx(ge,{className:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(jr,{className:"h-5 w-5 text-green-600"}),"All COM-B Components Adequate"]}),e.jsx(Le,{children:"No deficits identified. All capability, opportunity, and motivation components are adequate for behavior performance."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ge,{className:"bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-950/30 dark:to-indigo-950/30 border-blue-200 dark:border-blue-800",children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŽ¯"}),"COM-B Assessment Summary"]}),e.jsx(Le,{className:"text-gray-700 dark:text-gray-300",children:"Capability, Opportunity, Motivation â†’ Behavior Model (Michie et al., 2011)"})]}),e.jsxs(xe,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Adequate"}),e.jsx(jr,{className:"h-4 w-4 text-green-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-600",children:v.adequate}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"components"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Deficit"}),e.jsx(wr,{className:"h-4 w-4 text-orange-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:v.deficit}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"components"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Major Barrier"}),e.jsx(wr,{className:"h-4 w-4 text-red-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-red-600",children:v.major_barrier}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"components"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold mb-3",children:"Component Status"}),Object.entries(r).map(([g,w])=>{const k=g.split("_").map(T=>T.charAt(0).toUpperCase()+T.slice(1)).join(" "),A=u[k.replace(/ /g,"_")];return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-white/50 dark:bg-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:A}),e.jsx("span",{className:"text-sm font-medium",children:k})]}),e.jsx(he,{className:b(w),children:w==="major_barrier"?"âœ– Major Barrier":w==="deficit"?"âš  Deficit":"âœ“ Adequate"})]},g)})]})]})]}),e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(ha,{className:"h-5 w-5"}),"Behavior Change Feasibility Assessment"]})}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Overall Feasibility:"}),e.jsx(he,{className:N(d.feasibility),children:d.feasibility.toUpperCase()})]}),d.barriers.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2 flex items-center gap-2",children:[e.jsx(wr,{className:"h-4 w-4 text-red-600"}),"Barriers Identified"]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground",children:d.barriers.map((g,w)=>e.jsx("li",{children:g},w))})]}),d.strengths.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold mb-2 flex items-center gap-2",children:[e.jsx(jr,{className:"h-4 w-4 text-green-600"}),"Strengths"]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground",children:d.strengths.map((g,w)=>e.jsx("li",{children:g},w))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Recommendations"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground",children:d.recommendations.map((g,w)=>e.jsx("li",{children:g},w))})]})]})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Recommended Intervention Functions"}),e.jsxs(he,{variant:"outline",className:"text-sm",children:[c.reduce((g,w)=>g+w.interventions.length,0)," interventions"]})]}),e.jsxs(Le,{children:["Based on Michie et al. (2011) Behaviour Change Wheel methodology. Click on interventions to view details and ",!n&&"select for implementation planning.",!n&&t.length>0&&e.jsxs("span",{className:"block mt-2 text-blue-600 dark:text-blue-400 font-medium",children:["âœ“ ",t.length," intervention",t.length!==1?"s":""," selected"]})]})]}),e.jsx(xe,{className:"space-y-6",children:c.map(g=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h3",{className:"font-semibold text-base",children:g.component}),e.jsx(he,{className:b(g.severity),children:g.severity.replace("_"," ").toUpperCase()})]}),e.jsx("div",{className:"space-y-2",children:g.interventions.map(w=>{const k=`${g.component_code}-${w.name}`,A=i.has(k),T=t.includes(w.name);return e.jsxs("div",{className:`border rounded-lg p-3 ${T?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-border"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>m(k),className:"font-medium text-sm hover:underline text-left",children:w.name.split("_").map(z=>z.charAt(0).toUpperCase()+z.slice(1)).join(" ")}),e.jsxs(he,{className:_(w.priority),children:[w.priority.toUpperCase()," PRIORITY"]}),!n&&e.jsx(te,{variant:T?"default":"outline",size:"sm",onClick:()=>h(w.name),children:T?"Selected":"Select"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:w.description})]}),e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>m(k),children:A?e.jsx(Vl,{className:"h-4 w-4"}):e.jsx(es,{className:"h-4 w-4"})})]}),A&&e.jsxs("div",{className:"mt-3 space-y-3 text-sm border-t pt-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Evidence Base"}),e.jsx("p",{className:"text-muted-foreground",children:w.evidence_base})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Implementation Considerations"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-muted-foreground",children:w.implementation_considerations.map((z,S)=>e.jsx("li",{children:z},S))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Applicable Policy Categories"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:w.applicable_policies.map(z=>e.jsx(he,{variant:"outline",className:"text-xs",children:z.replace(/_/g," ")},z))})]})]})]},k)})})]},g.component_code))})]}),p.length>0&&e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:"Recommended Policy Categories"}),e.jsx(Le,{children:"Policy categories that can support the selected intervention functions"})]}),e.jsx(xe,{className:"space-y-3",children:p.map(g=>{const w=g.policy,k=l.has(w);return e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("button",{onClick:()=>y(w),className:"font-medium text-sm hover:underline text-left",children:g.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:g.description}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:g.suitable_for_interventions.map(A=>e.jsx(he,{variant:"secondary",className:"text-xs",children:A.replace(/_/g," ")},A))})]}),e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>y(w),children:k?e.jsx(Vl,{className:"h-4 w-4"}):e.jsx(es,{className:"h-4 w-4"})})]}),k&&e.jsx("div",{className:"mt-3 space-y-2 text-sm border-t pt-3",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Examples"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-muted-foreground",children:g.examples.map((A,T)=>e.jsx("li",{children:A},T))})]})})]},w)})})]})]})}function k0({selectedBehaviorId:r,selectedBehaviorTitle:t,onSelect:s,onClear:n}){const[i]=Vg(),[o,l]=B.useState([]),[a,c]=B.useState(!1),[p,d]=B.useState(""),[m,y]=B.useState(!r);B.useEffect(()=>{const _=i.get("behavior_id"),b=i.get("behavior_title");_&&b&&!r&&(s(_,decodeURIComponent(b)),y(!1))},[i,r,s]),B.useEffect(()=>{(async()=>{c(!0);try{const b=localStorage.getItem("currentWorkspace");if(!b){console.warn("No workspace selected"),l([]);return}const N=localStorage.getItem("token"),u=await fetch(`/api/frameworks?type=behavior&workspace_id=${b}`,{headers:{Authorization:`Bearer ${N}`}});if(u.ok){const v=await u.json();l(v.map(g=>({id:g.id,title:g.title,description:g.description,created_at:g.created_at})))}}catch(b){console.error("Error loading behaviors:",b)}finally{c(!1)}})()},[]);const h=o.filter(_=>_.title.toLowerCase().includes(p.toLowerCase())||_.description&&_.description.toLowerCase().includes(p.toLowerCase()));return r&&!m?e.jsxs(ge,{className:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"flex items-center gap-2 text-green-900 dark:text-green-100",children:[e.jsx(rr,{className:"h-5 w-5"}),"Linked Behavior Analysis"]})}),e.jsx(xe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-green-900 dark:text-green-100",children:t}),e.jsxs("p",{className:"text-sm text-green-700 dark:text-green-300 mt-1",children:["ID: ",r]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{variant:"outline",size:"sm",onClick:()=>window.open(`/dashboard/analysis-frameworks/behavior/${r}`,"_blank"),children:[e.jsx(ar,{className:"h-4 w-4 mr-1"}),"View"]}),e.jsx(te,{variant:"outline",size:"sm",onClick:()=>{y(!0)},children:"Change"}),e.jsx(te,{variant:"destructive",size:"sm",onClick:()=>{n(),y(!0)},children:"Unlink"})]})]})})]}):e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(rr,{className:"h-5 w-5"}),"Link to Behavior Analysis"]}),e.jsx(Le,{children:"Select which Behavior Analysis this COM-B assessment is analyzing"})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ir,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Ee,{placeholder:"Search behaviors...",value:p,onChange:_=>d(_.target.value),className:"pl-10"})]}),a?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading behaviors..."}):h.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:p?"No behaviors found matching your search":"No Behavior Analyses found"}),e.jsx(te,{variant:"outline",onClick:()=>window.open("/dashboard/analysis-frameworks/behavior","_blank"),children:"Create Behavior Analysis"})]}):e.jsx(ca,{className:"h-64 border rounded-lg",children:e.jsx("div",{className:"p-2 space-y-2",children:h.map(_=>e.jsxs("button",{onClick:()=>{s(_.id,_.title),y(!1)},className:"w-full text-left p-3 rounded-lg border hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"font-medium",children:_.title}),_.description&&e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1 line-clamp-2",children:_.description}),_.created_at&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Created ",new Date(_.created_at).toLocaleDateString()]})]},_.id))})})]})]})}function N0({title:r,description:t,locationContext:s,behaviorSettings:n,temporalContext:i,eligibility:o,complexity:l,onTitleChange:a,onDescriptionChange:c,onLocationContextChange:p,onBehaviorSettingsChange:d,onTemporalContextChange:m,onEligibilityChange:y,onComplexityChange:h}){const[_,b]=B.useState(""),[N,u]=B.useState(""),[v,g]=B.useState(""),[w,k]=B.useState(""),[A,T]=B.useState(""),[z,S]=B.useState(""),U=[{value:"local",label:"Local",example:"City or neighborhood level"},{value:"regional",label:"Regional",example:"State or province level"},{value:"national",label:"National",example:"Country-wide"},{value:"international",label:"International",example:"Multiple countries"},{value:"global",label:"Global",example:"Worldwide (rare)"}],G=[{value:"in_person",label:"In Person",icon:"ðŸ¢"},{value:"online",label:"Online",icon:"ðŸ’»"},{value:"hybrid",label:"Hybrid",icon:"ðŸ”„"},{value:"phone",label:"Phone",icon:"ðŸ“ž"},{value:"mail",label:"Mail",icon:"ðŸ“¬"},{value:"app",label:"Mobile App",icon:"ðŸ“±"}],F=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"quarterly",label:"Quarterly (Every 3 Months)"},{value:"semi_annual",label:"Semi-Annual (Twice a Year)"},{value:"annual",label:"Annual (Yearly)"},{value:"biennial",label:"Biennial (Every 2 Years)"},{value:"seasonal",label:"Seasonal"},{value:"one_time",label:"One-Time"},{value:"irregular",label:"Irregular"},{value:"as_needed",label:"As Needed"},{value:"custom",label:"Custom..."}],C=[{value:"minutes",label:"Minutes"},{value:"hours",label:"Hours"},{value:"days",label:"Days"},{value:"weeks",label:"Weeks"},{value:"months",label:"Months"},{value:"years",label:"Years"}],j=[{value:"morning",label:"Morning",icon:"ðŸŒ…"},{value:"afternoon",label:"Afternoon",icon:"â˜€ï¸"},{value:"evening",label:"Evening",icon:"ðŸŒ†"},{value:"night",label:"Night",icon:"ðŸŒ™"},{value:"any_time",label:"Any Time",icon:"ðŸ•"}],D=[{value:"single_action",label:"Single Action",description:"One simple step (e.g., press button, make call)"},{value:"simple_sequence",label:"Simple Sequence",description:"2-5 straightforward steps in order"},{value:"complex_process",label:"Complex Process",description:"Multiple steps with decisions and alternatives"},{value:"ongoing_practice",label:"Ongoing Practice",description:"Continuous or repeated behavior over time"}],J=()=>{_.trim()&&(p({...s,specific_locations:[...s.specific_locations||[],_.trim()]}),b(""))},q=M=>{p({...s,specific_locations:s.specific_locations?.filter((oe,O)=>O!==M)||[]})},W=()=>{N.trim()&&(y({...o,age_requirements:[...o.age_requirements||[],N.trim()]}),u(""))},$=M=>{y({...o,age_requirements:o.age_requirements?.filter((oe,O)=>O!==M)||[]})},ne=()=>{v.trim()&&(y({...o,legal_requirements:[...o.legal_requirements||[],v.trim()]}),g(""))},K=M=>{y({...o,legal_requirements:o.legal_requirements?.filter((oe,O)=>O!==M)||[]})},P=()=>{w.trim()&&(y({...o,skill_requirements:[...o.skill_requirements||[],w.trim()]}),k(""))},Y=M=>{y({...o,skill_requirements:o.skill_requirements?.filter((oe,O)=>O!==M)||[]})},re=()=>{A.trim()&&(y({...o,resource_requirements:[...o.resource_requirements||[],A.trim()]}),T(""))},le=M=>{y({...o,resource_requirements:o.resource_requirements?.filter((oe,O)=>O!==M)||[]})},se=()=>{z.trim()&&(y({...o,other_requirements:[...o.other_requirements||[],z.trim()]}),S(""))},R=M=>{y({...o,other_requirements:o.other_requirements?.filter((oe,O)=>O!==M)||[]})},I=M=>{const oe=n.settings||[],O=oe.includes(M)?oe.filter(ce=>ce!==M):[...oe,M];d({...n,settings:O})},Q=M=>{const oe=i.time_of_day||[],O=oe.includes(M)?oe.filter(ce=>ce!==M):[...oe,M];m({...i,time_of_day:O})},X=!s.specific_locations||s.specific_locations.length===0,V=!n.settings||n.settings.length===0;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border-2 border-blue-300 dark:border-blue-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-3xl",children:"ðŸ“"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-blue-900 dark:text-blue-100 mb-1",children:"Behavior Analysis = BEHAVIOR + LOCATION"}),e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200 mb-2",children:["You're documenting a ",e.jsx("strong",{children:"specific behavior in a specific place/context"}),", not behavior in the abstract."]}),e.jsxs("ul",{className:"text-xs text-blue-700 dark:text-blue-300 space-y-1 ml-4 list-disc",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Example:"}),' "Voting" varies by country, state, and local regulations']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Example:"}),' "Solar panel adoption" differs by region (incentives, climate, regulations)']}),e.jsx("li",{children:"Even online behaviors vary by platform, language, and culture"})]}),e.jsx("div",{className:"mt-2 text-xs font-semibold text-purple-800 dark:text-purple-200",children:"âš ï¸ Location context is REQUIRED - be as specific as possible!"})]})]})}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:"Behavior Identification"}),e.jsx(Le,{children:"What behavior are you analyzing? Be specific and clear."})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(fe,{htmlFor:"title",children:"Behavior Title *"}),e.jsx(Ee,{id:"title",value:r,onChange:M=>a(M.target.value),placeholder:"e.g., Voting in Presidential Elections, Installing Residential Solar Panels",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(fe,{htmlFor:"description",children:"Behavior Description *"}),e.jsx($e,{id:"description",value:t,onChange:M=>c(M.target.value),placeholder:"Provide a clear, concise description of the behavior you're analyzing...",rows:3,className:"mt-1"})]})]})]}),e.jsxs(ge,{className:X?"border-orange-400 bg-orange-50 dark:bg-orange-900/10":"",children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"h-5 w-5"}),"Location & Geographic Context *"]}),e.jsxs(Le,{children:[e.jsx("strong",{children:"Critical:"})," Behaviors vary by location. Specify WHERE this behavior occurs for accurate analysis."]})]}),e.jsxs(xe,{className:"space-y-4",children:[X&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-orange-100 dark:bg-orange-900/30 border border-orange-300 rounded-md",children:[e.jsx(wr,{className:"h-5 w-5 text-orange-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-orange-800 dark:text-orange-200",children:[e.jsx("strong",{children:"Location required:"}),' Add specific locations to make this analysis useful for others. Examples: "California, USA", "Lagos, Nigeria", "European Union"']})]}),e.jsxs("div",{children:[e.jsx(fe,{children:"Geographic Scope *"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-2 mt-2",children:U.map(M=>e.jsxs("button",{type:"button",onClick:()=>p({...s,geographic_scope:M.value}),className:`p-3 rounded-lg border-2 text-left transition-colors ${s.geographic_scope===M.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx("div",{className:"font-medium text-sm",children:M.label}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:M.example})]},M.value))})]}),e.jsxs("div",{children:[e.jsx(fe,{children:"Specific Locations * (City, State, Country, Region)"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(Ee,{value:_,onChange:M=>b(M.target.value),onKeyPress:M=>M.key==="Enter"&&(M.preventDefault(),J()),placeholder:"e.g., California, USA"}),e.jsx(te,{type:"button",onClick:J,children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:s.specific_locations?.map((M,oe)=>e.jsxs(he,{variant:"secondary",className:"gap-1",children:[e.jsx(Mn,{className:"h-3 w-3"}),M,e.jsx("button",{type:"button",onClick:()=>q(oe),className:"ml-1 hover:text-red-600",children:e.jsx(Ze,{className:"h-3 w-3"})})]},oe))})]}),e.jsxs("div",{children:[e.jsx(fe,{htmlFor:"location_notes",children:"Location-Specific Notes (Optional)"}),e.jsx($e,{id:"location_notes",value:s.location_notes||"",onChange:M=>p({...s,location_notes:M.target.value}),placeholder:"Any important location-specific context? (regulations, cultural factors, infrastructure)",rows:2,className:"mt-1"})]})]})]}),e.jsxs(ge,{className:V?"border-orange-400 bg-orange-50 dark:bg-orange-900/10":"",children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:"Behavior Settings *"}),e.jsx(Le,{children:"Where/how does this behavior take place? Select all that apply."})]}),e.jsxs(xe,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:G.map(M=>e.jsx("button",{type:"button",onClick:()=>I(M.value),className:`p-4 rounded-lg border-2 text-left transition-colors ${n.settings?.includes(M.value)?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:M.icon}),e.jsx("span",{className:"font-medium",children:M.label})]})},M.value))}),e.jsxs("div",{className:"mt-4",children:[e.jsx(fe,{htmlFor:"setting_details",children:"Setting Details (Optional)"}),e.jsx($e,{id:"setting_details",value:n.setting_details||"",onChange:M=>d({...n,setting_details:M.target.value}),placeholder:"Additional details about where/how this behavior occurs...",rows:2,className:"mt-1"})]})]})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(Im,{className:"h-5 w-5"}),"When Does This Behavior Occur?"]}),e.jsx(Le,{children:"Understanding timing helps identify patterns and opportunities."})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(fe,{children:"Frequency Pattern"}),e.jsxs("select",{value:i.frequency_pattern||"",onChange:M=>m({...i,frequency_pattern:M.target.value}),className:"w-full mt-1 p-2 border rounded-md dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("option",{value:"",children:"Select frequency..."}),F.map(M=>e.jsx("option",{value:M.value,children:M.label},M.value))]})]}),i.frequency_pattern==="custom"&&e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(fe,{htmlFor:"custom_number",children:"Every"}),e.jsx(Ee,{id:"custom_number",type:"number",min:"1",value:i.custom_frequency_number||"",onChange:M=>m({...i,custom_frequency_number:parseInt(M.target.value)||void 0}),placeholder:"1",className:"mt-1"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(fe,{htmlFor:"custom_unit",children:"Time Unit"}),e.jsxs("select",{id:"custom_unit",value:i.custom_frequency_unit||"",onChange:M=>m({...i,custom_frequency_unit:M.target.value}),className:"w-full mt-1 p-2 border rounded-md dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("option",{value:"",children:"Select unit..."}),C.map(M=>e.jsx("option",{value:M.value,children:M.label},M.value))]})]})]}),e.jsxs("div",{children:[e.jsx(fe,{children:"Time of Day (Select all that apply)"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-5 gap-2 mt-2",children:j.map(M=>e.jsxs("button",{type:"button",onClick:()=>Q(M.value),className:`p-3 rounded-lg border-2 text-center transition-colors ${i.time_of_day?.includes(M.value)?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx("div",{className:"text-2xl",children:M.icon}),e.jsx("div",{className:"text-xs mt-1",children:M.label})]},M.value))})]}),e.jsxs("div",{children:[e.jsx(fe,{htmlFor:"duration",children:"Typical Duration"}),e.jsx(Ee,{id:"duration",value:i.duration_typical||"",onChange:M=>m({...i,duration_typical:M.target.value}),placeholder:"e.g., 5 minutes, 1 hour, ongoing",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(fe,{htmlFor:"timing_notes",children:"Timing Notes (Optional)"}),e.jsx($e,{id:"timing_notes",value:i.timing_notes||"",onChange:M=>m({...i,timing_notes:M.target.value}),placeholder:"Any seasonal variations, peak times, or scheduling constraints?",rows:2,className:"mt-1"})]})]})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(ur,{className:"h-5 w-5"}),"Who Can Perform This Behavior?"]}),e.jsx(Le,{children:"Document any requirements or prerequisites to perform this behavior."})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"has_requirements",checked:o.has_requirements,onChange:M=>y({...o,has_requirements:M.target.checked}),className:"h-4 w-4"}),e.jsx(fe,{htmlFor:"has_requirements",className:"cursor-pointer",children:"This behavior has eligibility requirements or prerequisites"})]}),o.has_requirements&&e.jsxs("div",{className:"space-y-4 ml-6 mt-3",children:[e.jsxs("div",{children:[e.jsx(fe,{children:"Age Requirements"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(Ee,{value:N,onChange:M=>u(M.target.value),onKeyPress:M=>M.key==="Enter"&&(M.preventDefault(),W()),placeholder:"e.g., Must be 18"}),e.jsx(te,{type:"button",onClick:W,size:"icon",children:e.jsx(st,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:o.age_requirements?.map((M,oe)=>e.jsxs(he,{variant:"secondary",className:"gap-1",children:[M,e.jsx("button",{type:"button",onClick:()=>$(oe),className:"ml-1 hover:text-red-600",children:e.jsx(Ze,{className:"h-3 w-3"})})]},oe))})]}),e.jsxs("div",{children:[e.jsx(fe,{children:"Legal Requirements"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(Ee,{value:v,onChange:M=>g(M.target.value),onKeyPress:M=>M.key==="Enter"&&(M.preventDefault(),ne()),placeholder:"e.g., US Citizen"}),e.jsx(te,{type:"button",onClick:ne,size:"icon",children:e.jsx(st,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:o.legal_requirements?.map((M,oe)=>e.jsxs(he,{variant:"secondary",className:"gap-1",children:[M,e.jsx("button",{type:"button",onClick:()=>K(oe),className:"ml-1 hover:text-red-600",children:e.jsx(Ze,{className:"h-3 w-3"})})]},oe))})]}),e.jsxs("div",{children:[e.jsx(fe,{children:"Skill Requirements"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(Ee,{value:w,onChange:M=>k(M.target.value),onKeyPress:M=>M.key==="Enter"&&(M.preventDefault(),P()),placeholder:"e.g., Computer literacy"}),e.jsx(te,{type:"button",onClick:P,size:"icon",children:e.jsx(st,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:o.skill_requirements?.map((M,oe)=>e.jsxs(he,{variant:"secondary",className:"gap-1",children:[M,e.jsx("button",{type:"button",onClick:()=>Y(oe),className:"ml-1 hover:text-red-600",children:e.jsx(Ze,{className:"h-3 w-3"})})]},oe))})]}),e.jsxs("div",{children:[e.jsx(fe,{children:"Resource Requirements"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(Ee,{value:A,onChange:M=>T(M.target.value),onKeyPress:M=>M.key==="Enter"&&(M.preventDefault(),re()),placeholder:"e.g., Internet access"}),e.jsx(te,{type:"button",onClick:re,size:"icon",children:e.jsx(st,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:o.resource_requirements?.map((M,oe)=>e.jsxs(he,{variant:"secondary",className:"gap-1",children:[M,e.jsx("button",{type:"button",onClick:()=>le(oe),className:"ml-1 hover:text-red-600",children:e.jsx(Ze,{className:"h-3 w-3"})})]},oe))})]}),e.jsxs("div",{children:[e.jsx(fe,{children:"Other Requirements"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(Ee,{value:z,onChange:M=>S(M.target.value),onKeyPress:M=>M.key==="Enter"&&(M.preventDefault(),se()),placeholder:"Any other prerequisites"}),e.jsx(te,{type:"button",onClick:se,size:"icon",children:e.jsx(st,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:o.other_requirements?.map((M,oe)=>e.jsxs(he,{variant:"secondary",className:"gap-1",children:[M,e.jsx("button",{type:"button",onClick:()=>R(oe),className:"ml-1 hover:text-red-600",children:e.jsx(Ze,{className:"h-3 w-3"})})]},oe))})]})]})]})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:"Behavior Complexity"}),e.jsx(Le,{children:"How complex is this behavior? This helps determine timeline detail level."})]}),e.jsx(xe,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:D.map(M=>e.jsxs("button",{type:"button",onClick:()=>h(M.value),className:`p-4 rounded-lg border-2 text-left transition-colors ${l===M.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx("div",{className:"font-medium",children:M.label}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:M.description})]},M.value))})})]})]})}function S0({formData:r,existingTimeline:t=[],onTimelineGenerated:s}){const[n,i]=B.useState(!1),[o,l]=B.useState(!1),[a,c]=B.useState(null),[p,d]=B.useState(null),m=!r.title,y=async()=>{l(!0),c(null),d(null);try{const b={behavior_title:r.title||"",behavior_description:r.description||"",location_context:r.location_context,behavior_settings:r.behavior_settings,temporal_context:r.temporal_context,complexity:r.complexity,existing_timeline:t.length>0?t:void 0},N=await fetch("/api/ai/generate-timeline",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!N.ok){const g=await N.json();throw new Error(g.message||g.error||"AI request failed")}const v=(await N.json()).events||[];d(v)}catch(b){console.error("Timeline generation error:",b),c(b instanceof Error?b.message:"Failed to generate timeline")}finally{l(!1)}},h=()=>{p&&(s(p),i(!1),d(null))},_=()=>{if(p){const b=[...t,...p];s(b),i(!1),d(null)}};return e.jsxs(e.Fragment,{children:[e.jsxs(te,{type:"button",variant:"outline",onClick:()=>i(!0),disabled:m,className:"gap-2",children:[e.jsx(ft,{className:"h-4 w-4"}),"AI Generate Timeline"]}),e.jsx(wt,{open:n,onOpenChange:i,children:e.jsxs(jt,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsxs(kt,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-5 w-5"}),"AI Timeline Generator"]}),e.jsx(It,{children:"Generate a detailed, step-by-step timeline with sub-steps and decision forks"})]}),e.jsxs("div",{className:"space-y-4",children:[m&&e.jsxs(Dt,{variant:"destructive",children:[e.jsx(wr,{className:"h-4 w-4"}),e.jsx(Mt,{children:"Please fill in the behavior title before generating a timeline."})]}),t.length>0&&e.jsx(Dt,{children:e.jsxs(Mt,{children:["You have ",t.length," existing timeline events. The AI will enhance your existing timeline or create a new one."]})}),!o&&!p&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"The AI will analyze your behavior description, location context, settings, and other details to create:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 list-disc list-inside space-y-1 ml-2",children:[e.jsx("li",{children:"Chronological sequence of steps"}),e.jsx("li",{children:"Time estimates for each step"}),e.jsx("li",{children:"Sub-steps for complex actions"}),e.jsx("li",{children:"Decision points and alternative paths (forks)"}),e.jsx("li",{children:"Location changes during the behavior"})]}),e.jsxs(te,{onClick:y,disabled:m||o,className:"w-full",children:[e.jsx(ft,{className:"h-4 w-4 mr-2"}),"Generate Timeline"]})]}),o&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(xt,{className:"h-12 w-12 animate-spin text-blue-600"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Analyzing behavior and generating detailed timeline..."})]}),a&&e.jsxs(Dt,{variant:"destructive",children:[e.jsx(wr,{className:"h-4 w-4"}),e.jsx(Mt,{children:a})]}),p&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 dark:bg-gray-900",children:[e.jsxs("h4",{className:"font-medium mb-3",children:["Generated Timeline (",p.length," events)"]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:p.map((b,N)=>e.jsx("div",{className:"border-l-4 border-blue-500 pl-3 py-1",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:[N+1,". ",b.label]}),b.time&&e.jsx(he,{variant:"outline",className:"text-xs",children:b.time}),b.is_decision_point&&e.jsx(he,{variant:"secondary",className:"text-xs",children:"Decision Point"})]}),b.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:b.description}),b.location&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["ðŸ“ ",b.location]}),b.sub_steps&&b.sub_steps.length>0&&e.jsx("ul",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2 ml-4 space-y-1",children:b.sub_steps.map((u,v)=>e.jsxs("li",{className:"list-disc",children:[e.jsx("strong",{children:u.label}),u.description&&`: ${u.description}`]},v))}),b.forks&&b.forks.length>0&&e.jsx("div",{className:"mt-2 ml-4 text-sm",children:b.forks.map((u,v)=>e.jsxs("div",{className:"text-orange-600 dark:text-orange-400",children:["â†³ ",e.jsxs("strong",{children:[u.condition,":"]})," ",u.label]},v))})]})})},b.id))})]}),e.jsxs("div",{className:"flex gap-2 justify-between",children:[e.jsxs(te,{onClick:()=>d(null),variant:"outline",size:"default",children:[e.jsx(tx,{className:"h-4 w-4 mr-2"}),"Regenerate"]}),e.jsxs("div",{className:"flex gap-2",children:[t.length>0&&e.jsxs(te,{onClick:_,variant:"outline",children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),"Merge with Existing"]}),e.jsxs(te,{onClick:h,variant:"default",size:"default",className:"min-w-[180px]",children:[e.jsx($t,{className:"h-4 w-4 mr-2"}),"Use This Timeline"]})]})]})]})]})]})})]})}const Wa={immediate:"Immediate",long_term:"Long-term",generational:"Generational"},Md={immediate:e.jsx(Im,{className:"h-4 w-4"}),long_term:e.jsx(Hr,{className:"h-4 w-4"}),generational:e.jsx(rx,{className:"h-4 w-4"})},C0={immediate:"Happens right away (minutes to days)",long_term:"Takes time to manifest (months to years)",generational:"Affects future generations (decades+)"},E0={positive:"bg-green-50 dark:bg-green-900/20 border-green-300 text-green-800 dark:text-green-200",negative:"bg-red-50 dark:bg-red-900/20 border-red-300 text-red-800 dark:text-red-200",neutral:"bg-gray-50 dark:bg-gray-800 border-gray-300 text-gray-800 dark:text-gray-200",mixed:"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-300 text-yellow-800 dark:text-yellow-200"},Ha={positive:"âœ“ Positive",negative:"âœ— Negative",neutral:"â—‹ Neutral",mixed:"Â± Mixed"};function A0({consequences:r,onChange:t}){const[s,n]=B.useState(""),[i,o]=B.useState("immediate"),[l,a]=B.useState("neutral"),[c,p]=B.useState(""),[d,m]=B.useState(""),[y,h]=B.useState(null),[_,b]=B.useState(""),[N,u]=B.useState("immediate"),[v,g]=B.useState("neutral"),[w,k]=B.useState(""),[A,T]=B.useState(""),z=()=>{if(!s.trim())return;const D={id:crypto.randomUUID(),consequence:s.trim(),timeframe:i,valence:l,description:c.trim()||void 0,who_affected:d.trim()||void 0};t([...r,D]),n(""),o("immediate"),a("neutral"),p(""),m("")},S=D=>{t(r.filter(J=>J.id!==D))},U=D=>{h(D.id),b(D.consequence),u(D.timeframe),g(D.valence),k(D.description||""),T(D.who_affected||"")},G=()=>{y&&(t(r.map(D=>D.id===y?{...D,consequence:_.trim(),timeframe:N,valence:v,description:w.trim()||void 0,who_affected:A.trim()||void 0}:D)),F())},F=()=>{h(null),b(""),u("immediate"),g("neutral"),k(""),T("")},C=r.reduce((D,J)=>(D[J.timeframe]||(D[J.timeframe]=[]),D[J.timeframe].push(J),D),{}),j={total:r.length,byTimeframe:{immediate:r.filter(D=>D.timeframe==="immediate").length,long_term:r.filter(D=>D.timeframe==="long_term").length,generational:r.filter(D=>D.timeframe==="generational").length},byValence:{positive:r.filter(D=>D.valence==="positive").length,negative:r.filter(D=>D.valence==="negative").length,neutral:r.filter(D=>D.valence==="neutral").length,mixed:r.filter(D=>D.valence==="mixed").length}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsx(Ae,{className:"text-lg",children:"Add Consequence or Outcome"})}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{children:"Timeframe *"}),e.jsxs(ct,{value:i,onValueChange:D=>o(D),children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsx(ht,{children:Object.entries(Wa).map(([D,J])=>e.jsx(Te,{value:D,children:e.jsxs("div",{className:"flex items-center gap-2",children:[Md[D],e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:J}),e.jsx("div",{className:"text-xs text-muted-foreground",children:C0[D]})]})]})},D))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{children:"Impact Type *"}),e.jsxs(ct,{value:l,onValueChange:D=>a(D),children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsx(ht,{children:Object.entries(Ha).map(([D,J])=>e.jsx(Te,{value:D,children:J},D))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{children:"Consequence/Outcome *"}),e.jsx(Ee,{placeholder:"What happens? (e.g., Increased community engagement, Financial burden, Environmental impact)",value:s,onChange:D=>n(D.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{children:"Who is Affected?"}),e.jsx(Ee,{placeholder:"Individual, family, community, society, future generations...",value:d,onChange:D=>m(D.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{children:"Additional Details"}),e.jsx($e,{placeholder:"Describe the consequence in more detail...",value:c,onChange:D=>p(D.target.value),rows:2})]}),e.jsxs(te,{onClick:z,className:"w-full",children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),"Add Consequence"]})]})]}),r.length>0&&e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsx(Ae,{className:"text-lg",children:"Overview"})}),e.jsxs(xe,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:j.total}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:j.byTimeframe.immediate}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Immediate"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:j.byTimeframe.long_term}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Long-term"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:j.byTimeframe.generational}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Generational"})]})]}),e.jsxs("div",{className:"mt-4 flex justify-center gap-4 flex-wrap",children:[e.jsxs(he,{variant:"outline",className:"bg-green-50",children:[j.byValence.positive," Positive"]}),e.jsxs(he,{variant:"outline",className:"bg-red-50",children:[j.byValence.negative," Negative"]}),e.jsxs(he,{variant:"outline",className:"bg-gray-50",children:[j.byValence.neutral," Neutral"]}),e.jsxs(he,{variant:"outline",className:"bg-yellow-50",children:[j.byValence.mixed," Mixed"]})]})]})]}),["immediate","long_term","generational"].map(D=>{const J=C[D]||[];return J.length===0?null:e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"text-lg flex items-center gap-2",children:[Md[D],Wa[D]," Consequences",e.jsx(he,{variant:"secondary",children:J.length})]})}),e.jsx(xe,{className:"space-y-3",children:J.map(q=>{const W=y===q.id;return e.jsx("div",{className:`p-4 rounded-lg border-2 ${E0[q.valence]}`,children:W?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs(ct,{value:N,onValueChange:$=>u($),children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsx(ht,{children:Object.entries(Wa).map(([$,ne])=>e.jsx(Te,{value:$,children:ne},$))})]}),e.jsxs(ct,{value:v,onValueChange:$=>g($),children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsx(ht,{children:Object.entries(Ha).map(([$,ne])=>e.jsx(Te,{value:$,children:ne},$))})]})]}),e.jsx(Ee,{placeholder:"Consequence...",value:_,onChange:$=>b($.target.value)}),e.jsx(Ee,{placeholder:"Who is affected?",value:A,onChange:$=>T($.target.value)}),e.jsx($e,{placeholder:"Additional details...",value:w,onChange:$=>k($.target.value),rows:2}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{size:"sm",onClick:G,children:[e.jsx($t,{className:"h-4 w-4 mr-1"}),"Save"]}),e.jsxs(te,{size:"sm",variant:"outline",onClick:F,children:[e.jsx(Ze,{className:"h-4 w-4 mr-1"}),"Cancel"]})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(he,{variant:"outline",className:"text-xs",children:Ha[q.valence]}),q.who_affected&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["â†’ ",q.who_affected]})]}),e.jsx("p",{className:"font-medium",children:q.consequence}),q.description&&e.jsx("p",{className:"text-sm mt-2 opacity-90",children:q.description})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>U(q),className:"h-7 w-7 p-0",children:e.jsx(kc,{className:"h-3.5 w-3.5"})}),e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>S(q.id),className:"h-7 w-7 p-0 text-red-600 hover:text-red-700",children:e.jsx(Ze,{className:"h-4 w-4"})})]})]})})},q.id)})})]},D)}),r.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:"No consequences added yet. Add consequences to see them organized by timeframe."})})]})}const di={visual:"Visual",auditory:"Auditory",social:"Social",other:"Other"},$d={visual:Xn,auditory:sx,social:ur,other:Pt},T0={visual:"bg-blue-50 dark:bg-blue-900/20 border-blue-300 text-blue-800 dark:text-blue-200",auditory:"bg-purple-50 dark:bg-purple-900/20 border-purple-300 text-purple-800 dark:text-purple-200",social:"bg-green-50 dark:bg-green-900/20 border-green-300 text-green-800 dark:text-green-200",other:"bg-gray-50 dark:bg-gray-800 border-gray-300 text-gray-800 dark:text-gray-200"},I0={visual:"Images, logos, colors, clothing, badges, signs",auditory:"Sounds, music, verbal phrases, audio cues",social:"Gestures, behaviors, social markers, status symbols",other:"Other types of symbols or signals"};function R0({symbols:r,onChange:t}){const[s,n]=B.useState(""),[i,o]=B.useState("visual"),[l,a]=B.useState(""),[c,p]=B.useState(""),[d,m]=B.useState(""),[y,h]=B.useState(""),[_,b]=B.useState("upload"),[N,u]=B.useState(""),[v,g]=B.useState(""),w=B.useRef(null),k=B.useRef(null),[A,T]=B.useState(null),[z,S]=B.useState(""),[U,G]=B.useState("visual"),[F,C]=B.useState(""),[j,D]=B.useState(""),[J,q]=B.useState(""),[W,$]=B.useState(""),[ne,K]=B.useState("upload"),[P,Y]=B.useState(""),[re,le]=B.useState(""),se=B.useRef(null),R=B.useRef(null),I=async(x,E=!1)=>{const H=x.target.files?.[0];if(!H)return;if(!H.type.startsWith("image/")){alert("Please upload an image file");return}if(H.size>5*1024*1024){alert("Image must be less than 5MB");return}const ee=new FileReader;ee.onload=Z=>{const ue=Z.target?.result;E?q(ue):m(ue)},ee.readAsDataURL(H)},Q=async(x,E=!1)=>{const H=x.target.files?.[0];if(!H)return;if(!H.type.startsWith("audio/")){alert("Please upload an audio file");return}if(H.size>10*1024*1024){alert("Audio must be less than 10MB");return}const ee=new FileReader;ee.onload=Z=>{const ue=Z.target?.result;E?$(ue):h(ue)},ee.readAsDataURL(H)},X=(x,E)=>{if(!x.trim())return!1;try{const H=new URL(x);return E==="image"?/\.(jpg|jpeg|png|gif|webp|svg)$/i.test(H.pathname)||x.includes("imgur")||x.includes("cloudinary"):/\.(mp3|wav|ogg|m4a|aac|flac)$/i.test(H.pathname)||x.includes("soundcloud")||x.includes("audio")}catch{return!1}},V=()=>{if(!s.trim()){alert("Please enter a symbol name");return}const x={id:crypto.randomUUID(),name:s.trim(),symbol_type:i,description:l.trim()||void 0,context:c.trim()||void 0,media_source:_};_==="upload"?i==="auditory"?x.audio_data=y||void 0:x.image_data=d||void 0:i==="auditory"?x.audio_url=v.trim()||void 0:x.image_url=N.trim()||void 0,t([...r,x]),n(""),o("visual"),a(""),p(""),m(""),h(""),u(""),g(""),b("upload"),w.current&&(w.current.value=""),k.current&&(k.current.value="")},M=x=>{t(r.filter(E=>E.id!==x))},oe=x=>{T(x.id),S(x.name),G(x.symbol_type),C(x.description||""),D(x.context||""),q(x.image_data||""),$(x.audio_data||""),Y(x.image_url||""),le(x.audio_url||""),K(x.media_source||"upload")},O=()=>{if(!A)return;const x={name:z.trim(),symbol_type:U,description:F.trim()||void 0,context:j.trim()||void 0,media_source:ne};ne==="upload"?U==="auditory"?(x.audio_data=W||void 0,x.audio_url=void 0):(x.image_data=J||void 0,x.image_url=void 0):U==="auditory"?(x.audio_url=re.trim()||void 0,x.audio_data=void 0):(x.image_url=P.trim()||void 0,x.image_data=void 0),t(r.map(E=>E.id===A?{...E,...x}:E)),ce()},ce=()=>{T(null),S(""),G("visual"),C(""),D(""),q(""),$(""),Y(""),le(""),K("upload"),se.current&&(se.current.value=""),R.current&&(R.current.value="")},L=r.reduce((x,E)=>(x[E.symbol_type]||(x[E.symbol_type]=[]),x[E.symbol_type].push(E),x),{}),f={total:r.length,byType:{visual:r.filter(x=>x.symbol_type==="visual").length,auditory:r.filter(x=>x.symbol_type==="auditory").length,social:r.filter(x=>x.symbol_type==="social").length,other:r.filter(x=>x.symbol_type==="other").length},withImages:r.filter(x=>x.image_data||x.image_url).length,withAudio:r.filter(x=>x.audio_data||x.audio_url).length};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsx(Ae,{className:"text-lg",children:"Add Symbol or Signal"})}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{children:"Symbol Type *"}),e.jsxs(ct,{value:i,onValueChange:x=>o(x),children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsx(ht,{children:Object.entries(di).map(([x,E])=>{const H=$d[x];return e.jsx(Te,{value:x,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:E}),e.jsx("div",{className:"text-xs text-muted-foreground",children:I0[x]})]})]})},x)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(fe,{children:[i==="auditory"?"Audio":"Image"," (Optional)"]}),e.jsxs(Ar,{value:_,onValueChange:x=>b(x),children:[e.jsxs(Tr,{className:"grid w-full grid-cols-2",children:[e.jsxs(Ye,{value:"upload",children:[e.jsx(nx,{className:"h-3 w-3 mr-1"}),"Upload"]}),e.jsxs(Ye,{value:"link",children:[e.jsx(Hn,{className:"h-3 w-3 mr-1"}),"Link URL"]})]}),e.jsx(pt,{value:"upload",className:"space-y-2",children:i==="auditory"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{type:"button",variant:"outline",onClick:()=>k.current?.click(),className:"flex-1",children:[e.jsx(Ed,{className:"h-4 w-4 mr-2"}),y?"Change Audio":"Upload Audio"]}),y&&e.jsx(te,{type:"button",variant:"ghost",size:"sm",onClick:()=>{h(""),k.current&&(k.current.value="")},children:e.jsx(Ze,{className:"h-4 w-4"})})]}),e.jsx("input",{ref:k,type:"file",accept:"audio/*",onChange:x=>Q(x,!1),className:"hidden"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Max 10MB. MP3, WAV, OGG, M4A"}),y&&e.jsx("audio",{controls:!0,className:"w-full mt-2",children:e.jsx("source",{src:y})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{type:"button",variant:"outline",onClick:()=>w.current?.click(),className:"flex-1",children:[e.jsx(za,{className:"h-4 w-4 mr-2"}),d?"Change Image":"Upload Image"]}),d&&e.jsx(te,{type:"button",variant:"ghost",size:"sm",onClick:()=>{m(""),w.current&&(w.current.value="")},children:e.jsx(Ze,{className:"h-4 w-4"})})]}),e.jsx("input",{ref:w,type:"file",accept:"image/*",onChange:x=>I(x,!1),className:"hidden"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Max 5MB. JPG, PNG, GIF, WEBP"}),d&&e.jsx("img",{src:d,alt:"Preview",className:"max-w-full h-32 object-contain rounded border mt-2"})]})}),e.jsx(pt,{value:"link",className:"space-y-2",children:i==="auditory"?e.jsxs(e.Fragment,{children:[e.jsx(Ee,{placeholder:"https://example.com/sound.mp3",value:v,onChange:x=>g(x.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Paste URL to audio file"}),v&&X(v,"audio")&&e.jsx("audio",{controls:!0,className:"w-full mt-2",children:e.jsx("source",{src:v})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{placeholder:"https://example.com/image.jpg",value:N,onChange:x=>u(x.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Paste URL to image"}),N&&X(N,"image")&&e.jsx("img",{src:N,alt:"Preview",className:"max-w-full h-32 object-contain rounded border mt-2"})]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{children:"Symbol Name *"}),e.jsx(Ee,{placeholder:"What is this symbol? (e.g., Red baseball cap, Peace sign, Company logo)",value:s,onChange:x=>n(x.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{children:"What Does It Represent?"}),e.jsx($e,{placeholder:"What does this symbol signify or communicate?",value:l,onChange:x=>a(x.target.value),rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{children:"Context / Usage"}),e.jsx(Ee,{placeholder:"When/where is this symbol used or displayed?",value:c,onChange:x=>p(x.target.value)})]}),e.jsxs(te,{onClick:V,className:"w-full",children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),"Add Symbol"]})]})]}),r.length>0&&e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsx(Ae,{className:"text-lg",children:"Overview"})}),e.jsx(xe,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:f.total}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:f.byType.visual}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Visual"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:f.byType.auditory}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Auditory"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:f.byType.social}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Social"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:f.withImages}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"With Images"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:f.withAudio}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"With Audio"})]})]})})]}),["visual","auditory","social","other"].map(x=>{const E=L[x]||[];if(E.length===0)return null;const H=$d[x];return e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"text-lg flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),di[x]," Symbols",e.jsx(he,{variant:"secondary",children:E.length})]})}),e.jsx(xe,{className:"space-y-3",children:E.map(ee=>{const Z=A===ee.id,ue=ee.image_data||ee.image_url;return e.jsx("div",{className:`p-4 rounded-lg border-2 ${T0[x]}`,children:Z?e.jsxs("div",{className:"space-y-3",children:[e.jsxs(ct,{value:U,onValueChange:pe=>G(pe),children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsx(ht,{children:Object.entries(di).map(([pe,ie])=>e.jsx(Te,{value:pe,children:ie},pe))})]}),e.jsxs(Ar,{value:ne,onValueChange:pe=>K(pe),children:[e.jsxs(Tr,{className:"grid w-full grid-cols-2",children:[e.jsx(Ye,{value:"upload",children:"Upload"}),e.jsx(Ye,{value:"link",children:"Link URL"})]}),e.jsx(pt,{value:"upload",className:"space-y-2",children:U==="auditory"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{type:"button",variant:"outline",size:"sm",onClick:()=>R.current?.click(),className:"flex-1",children:[e.jsx(Ed,{className:"h-4 w-4 mr-2"}),W?"Change":"Upload"]}),W&&e.jsx(te,{type:"button",variant:"ghost",size:"sm",onClick:()=>{$(""),R.current&&(R.current.value="")},children:e.jsx(Ze,{className:"h-4 w-4"})})]}),e.jsx("input",{ref:R,type:"file",accept:"audio/*",onChange:pe=>Q(pe,!0),className:"hidden"}),W&&e.jsx("audio",{controls:!0,className:"w-full",children:e.jsx("source",{src:W})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{type:"button",variant:"outline",size:"sm",onClick:()=>se.current?.click(),className:"flex-1",children:[e.jsx(za,{className:"h-4 w-4 mr-2"}),J?"Change":"Upload"]}),J&&e.jsx(te,{type:"button",variant:"ghost",size:"sm",onClick:()=>{q(""),se.current&&(se.current.value="")},children:e.jsx(Ze,{className:"h-4 w-4"})})]}),e.jsx("input",{ref:se,type:"file",accept:"image/*",onChange:pe=>I(pe,!0),className:"hidden"}),J&&e.jsx("img",{src:J,alt:"Preview",className:"max-w-full h-32 object-contain rounded border"})]})}),e.jsx(pt,{value:"link",className:"space-y-2",children:U==="auditory"?e.jsxs(e.Fragment,{children:[e.jsx(Ee,{placeholder:"https://example.com/sound.mp3",value:re,onChange:pe=>le(pe.target.value)}),re&&X(re,"audio")&&e.jsx("audio",{controls:!0,className:"w-full",children:e.jsx("source",{src:re})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{placeholder:"https://example.com/image.jpg",value:P,onChange:pe=>Y(pe.target.value)}),P&&X(P,"image")&&e.jsx("img",{src:P,alt:"Preview",className:"max-w-full h-32 object-contain rounded border"})]})})]}),e.jsx(Ee,{placeholder:"Symbol name...",value:z,onChange:pe=>S(pe.target.value)}),e.jsx($e,{placeholder:"What does it represent?",value:F,onChange:pe=>C(pe.target.value),rows:2}),e.jsx(Ee,{placeholder:"Context / usage...",value:j,onChange:pe=>D(pe.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{size:"sm",onClick:O,children:[e.jsx($t,{className:"h-4 w-4 mr-1"}),"Save"]}),e.jsxs(te,{size:"sm",variant:"outline",onClick:ce,children:[e.jsx(Ze,{className:"h-4 w-4 mr-1"}),"Cancel"]})]})]}):e.jsxs("div",{className:"flex gap-4",children:[ue&&ee.symbol_type!=="auditory"&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:ue,alt:ee.name,className:"w-24 h-24 object-cover rounded border"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(he,{variant:"outline",className:"text-xs",children:di[ee.symbol_type]}),!ue&&e.jsxs(he,{variant:"outline",className:"text-xs text-muted-foreground",children:[e.jsx(za,{className:"h-3 w-3 mr-1"}),"No image"]})]}),e.jsx("p",{className:"font-medium",children:ee.name}),ee.description&&e.jsx("p",{className:"text-sm mt-1 opacity-90",children:ee.description}),ee.context&&e.jsxs("p",{className:"text-xs mt-1 opacity-75",children:[e.jsx("span",{className:"font-medium",children:"Context:"})," ",ee.context]}),ee.symbol_type==="auditory"&&(ee.audio_data||ee.audio_url)&&e.jsx("div",{className:"mt-2",children:e.jsxs("audio",{controls:!0,className:"w-full max-w-sm",children:[e.jsx("source",{src:ee.audio_data||ee.audio_url}),"Your browser does not support audio playback."]})})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>oe(ee),className:"h-7 w-7 p-0",children:e.jsx(kc,{className:"h-3.5 w-3.5"})}),e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>M(ee.id),className:"h-7 w-7 p-0 text-red-600 hover:text-red-700",children:e.jsx(Ze,{className:"h-4 w-4"})})]})]})})]})},ee.id)})})]},x)}),r.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e.jsx("p",{children:"No symbols added yet. Add symbols to see them organized by type."})})]})}function O0({value:r,onChange:t,suggestedLocations:s=[]}){const[n,i]=B.useState(r);B.useEffect(()=>{t(n)},[n,t]);const o=(l,a)=>{i(c=>({...c,[l]:a}))};return e.jsxs(ge,{className:"border-l-4 border-blue-500",children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"h-5 w-5 text-blue-600"}),"Geographic Context"]}),e.jsx(Le,{children:"PMESII-PT analysis is location-specific. Define the geographic scope of your analysis."})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(fe,{className:"text-sm font-medium",children:["Country ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Ee,{placeholder:"e.g., Ukraine, Afghanistan, China",value:n.country||"",onChange:l=>o("country",l.target.value),className:"mt-1",required:!0}),s.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Detected locations:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.slice(0,5).map((l,a)=>e.jsx("button",{type:"button",onClick:()=>o("country",l),className:"text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/50",children:l},a))})]})]}),e.jsxs("div",{children:[e.jsx(fe,{className:"text-sm font-medium",children:"State / Region / Province (Optional)"}),e.jsx(Ee,{placeholder:"e.g., Donbas, Helmand, Xinjiang",value:n.region||"",onChange:l=>o("region",l.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(fe,{className:"text-sm font-medium",children:"City (Optional)"}),e.jsx(Ee,{placeholder:"e.g., Mariupol, Kandahar, Urumqi",value:n.city||"",onChange:l=>o("city",l.target.value),className:"mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(fe,{className:"text-sm font-medium flex items-center gap-1",children:[e.jsx(dr,{className:"h-3 w-3"}),"Start Date"]}),e.jsx(Ee,{type:"date",value:n.time_period_start||"",onChange:l=>o("time_period_start",l.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsxs(fe,{className:"text-sm font-medium flex items-center gap-1",children:[e.jsx(dr,{className:"h-3 w-3"}),"End Date"]}),e.jsx(Ee,{type:"date",value:n.time_period_end||"",onChange:l=>o("time_period_end",l.target.value),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(fe,{className:"text-sm font-medium",children:"Analysis Scope & Objectives"}),e.jsx($e,{placeholder:"Describe the purpose and scope of this analysis... e.g., 'Assess economic and military situation in contested border regions'",value:n.scope_objectives||"",onChange:l=>o("scope_objectives",l.target.value),className:"mt-1",rows:3}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"What specific aspects are you analyzing? What decisions will this support?"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 rounded-lg p-3 text-xs space-y-1",children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"ðŸ’¡ Why location matters:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-800 dark:text-blue-200 ml-2",children:[e.jsx("li",{children:"PMESII-PT evidence is tagged with location for reuse"}),e.jsx("li",{children:"Filter analyses by country/region in Evidence Library"}),e.jsx("li",{children:"Compare PMESII factors across different locations"}),e.jsx("li",{children:"Time period helps track changes and trends"})]})]})]})]})}function Ht(r){return"question"in r&&"answer"in r}function F0({sectionData:r,questionEvidence:t={}}){const s=["who","what","when","where","why","how"],n={who:"Who",what:"What",when:"When",where:"Where",why:"Why",how:"How"},i={who:"ðŸ‘¤",what:"â“",when:"â°",where:"ðŸ“",why:"ðŸ’¡",how:"âš™ï¸"},o={};let l=0,a=0,c=0;s.forEach(y=>{const _=(r[y]||[]).filter(Ht),b=_.filter(g=>g.answer&&g.answer.trim().length>0).length,N=_.filter(g=>g.answer&&g.answer.trim().length>0&&g.evidence_ids&&g.evidence_ids.length>0).length,u=_.filter(g=>g.priority==="critical").length,v=_.filter(g=>g.priority==="high").length;o[y]={total:_.length,answered:b,answeredWithEvidence:N,critical:u,high:v},l+=_.length,a+=b,c+=N});const p=l>0?a/l*100:0,d=a>0?c/a*100:0,m=[];return s.forEach(y=>{(r[y]||[]).filter(Ht).forEach(b=>{(!b.answer||b.answer.trim().length===0)&&(b.priority==="critical"||b.priority==="high")&&m.push({category:y,question:b.question,priority:b.priority||"medium"})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:"Analysis Progress"}),e.jsx(Le,{children:"Question completion overview"})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Questions Answered"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:[a," / ",l]})]}),e.jsx(Fs,{value:p,className:"h-3"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[p.toFixed(1),"% complete"]})]}),a>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"With Evidence Support"}),e.jsxs("span",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:[c," / ",a]})]}),e.jsx(Fs,{value:d,className:"h-2"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[d.toFixed(1),"% of answers have evidence"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{children:"Answered with evidence"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-500"}),e.jsx("span",{children:"Answered without evidence"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsx("span",{children:"Unanswered (high priority)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-300 dark:bg-gray-600"}),e.jsx("span",{children:"Unanswered (low priority)"})]})]})]})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:"Category Breakdown"}),e.jsx(Le,{children:"Progress by question type"})]}),e.jsx(xe,{children:e.jsx("div",{className:"space-y-3",children:s.map(y=>{const h=o[y],_=h.total>0?h.answered/h.total*100:0;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:i[y]}),e.jsx("span",{className:"font-medium text-sm",children:n[y]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-blue-600 dark:text-blue-400",children:[h.answered,"/",h.total]}),h.critical>0&&e.jsxs(he,{variant:"destructive",className:"text-xs h-5",children:[h.critical," critical"]}),h.high>0&&e.jsxs(he,{variant:"secondary",className:"text-xs h-5 bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400",children:[h.high," high"]})]})]}),e.jsx(Fs,{value:_,className:"h-2"})]},y)})})})]}),m.length>0&&e.jsxs(ge,{className:"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/10",children:[e.jsxs(Ce,{children:[e.jsx(Ae,{className:"text-red-700 dark:text-red-400",children:"High-Priority Unanswered"}),e.jsx(Le,{children:"Critical and high-priority questions needing answers"})]}),e.jsx(xe,{children:e.jsxs("div",{className:"space-y-2",children:[m.slice(0,5).map((y,h)=>e.jsxs("div",{className:"flex items-start gap-2 p-2 bg-white dark:bg-gray-800 rounded border border-red-200 dark:border-red-800",children:[e.jsx(he,{variant:y.priority==="critical"?"destructive":"secondary",className:"text-xs shrink-0 mt-0.5",children:y.priority}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-0.5",children:[i[y.category]," ",n[y.category]]}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-100 break-words",children:y.question})]})]},h)),m.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center pt-2",children:["+ ",m.length-5," more high-priority questions"]})]})})]})]})}function Bd({isOpen:r,onClose:t,selectedActors:s,onActorsChange:n,domainName:i}){const[o,l]=B.useState(""),[a,c]=B.useState(!1),[p,d]=B.useState([]),[m,y]=B.useState(s);B.useEffect(()=>{y(s)},[s,r]);const h=async()=>{if(!o.trim()){d([]);return}try{c(!0);const g=new URLSearchParams({search:o,limit:"20"}),w=await fetch(`/api/entities/actors?${g}`,{credentials:"include"});if(!w.ok)throw new Error("Failed to search actors");const k=await w.json();k.success&&d(k.actors||[])}catch(g){console.error("Error searching actors:",g),d([])}finally{c(!1)}},_=g=>{const w={id:g.id,name:g.name,type:g.type,category:g.category,role:g.role,affiliation:g.affiliation},k=m.find(A=>A.id===g.id);y(k?m.filter(A=>A.id!==g.id):[...m,w])},b=()=>{n(m),t()},N=()=>{y(s),t()},u=g=>{switch(g){case"PERSON":return"ðŸ‘¤";case"ORGANIZATION":return"ðŸ¢";case"UNIT":return"âš”ï¸";case"GOVERNMENT":return"ðŸ›ï¸";case"GROUP":return"ðŸ‘¥";default:return"â“"}},v=g=>{switch(g){case"PERSON":return"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400";case"ORGANIZATION":return"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400";case"UNIT":return"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400";case"GOVERNMENT":return"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400";case"GROUP":return"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400";default:return"bg-gray-100 text-gray-700 dark:bg-gray-900/20 dark:text-gray-400"}};return e.jsx(wt,{open:r,onOpenChange:N,children:e.jsxs(jt,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsxs(kt,{children:["Link Actors ",i&&`to ${i} Domain`]}),e.jsxs(It,{children:["Search for and select actors relevant to this ",i||"section"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ir,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ee,{placeholder:"Search actors by name, category, affiliation...",value:o,onChange:g=>l(g.target.value),onKeyDown:g=>g.key==="Enter"&&h(),className:"pl-10"})]}),e.jsx(te,{onClick:h,disabled:a,children:a?e.jsx(xt,{className:"h-4 w-4 animate-spin"}):"Search"})]}),m.length>0&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(gr,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),e.jsxs("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:[m.length," actor",m.length!==1?"s":""," selected"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(g=>e.jsxs(he,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx("span",{children:u(g.type)}),e.jsx("span",{children:g.name}),e.jsx(Ze,{className:"h-3 w-3 cursor-pointer hover:text-red-600",onClick:()=>_(g)})]},g.id))})]}),p.length>0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsxs("h5",{className:"text-sm font-medium",children:["Results (",p.length,")"]}),p.map(g=>{const w=m.some(k=>k.id===g.id);return e.jsx(ge,{className:`cursor-pointer transition-all ${w?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 border-2":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,onClick:()=>_(g),children:e.jsx(xe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xl",children:u(g.type)}),e.jsx("h6",{className:"font-medium text-sm",children:g.name}),w&&e.jsx(gr,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsx(he,{className:`text-xs ${v(g.type)}`,children:g.type}),g.category&&e.jsx(he,{variant:"outline",className:"text-xs",children:g.category}),g.role&&e.jsx(he,{variant:"outline",className:"text-xs",children:g.role})]}),g.affiliation&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:g.affiliation}),g.description&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1 line-clamp-2",children:g.description})]}),e.jsx("a",{href:`/dashboard/entities/actors/${g.id}`,target:"_blank",rel:"noopener noreferrer",onClick:k=>k.stopPropagation(),className:"ml-2 p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded",children:e.jsx(ar,{className:"h-4 w-4 text-gray-500"})})]})})},g.id)})]}),a&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(xt,{className:"h-6 w-6 animate-spin text-muted-foreground"})}),!a&&p.length===0&&o&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(ur,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"No actors found. Try a different search term."]}),!o&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(ur,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"Search for actors to link to this ",i||"section"]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(te,{variant:"outline",onClick:N,children:"Cancel"}),e.jsxs(te,{onClick:b,children:[e.jsx(gr,{className:"h-4 w-4 mr-2"}),"Link ",m.length>0&&`(${m.length})`]})]})]})})}function P0({actor:r,onRemove:t}){const s=i=>{switch(i){case"PERSON":return"ðŸ‘¤";case"ORGANIZATION":return"ðŸ¢";case"UNIT":return"âš”ï¸";case"GOVERNMENT":return"ðŸ›ï¸";case"GROUP":return"ðŸ‘¥";default:return"â“"}},n=i=>{switch(i){case"PERSON":return"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400";case"ORGANIZATION":return"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400";case"UNIT":return"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400";case"GOVERNMENT":return"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400";case"GROUP":return"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400";default:return"bg-gray-100 text-gray-700 dark:bg-gray-900/20 dark:text-gray-400"}};return e.jsxs(he,{className:`flex items-center gap-2 px-2 py-1 ${n(r.type)}`,children:[e.jsx("span",{children:s(r.type)}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium text-xs",children:r.name}),(r.category||r.role)&&e.jsx("span",{className:"text-xs opacity-75",children:[r.category,r.role].filter(Boolean).join(" â€¢ ")})]}),t&&e.jsx(Ze,{className:"h-3 w-3 cursor-pointer hover:text-red-600 ml-1",onClick:i=>{i.stopPropagation(),t()}})]})}function L0({isOpen:r,onClose:t,selectedPlaces:s,onPlacesChange:n,contextLabel:i}){const[o,l]=B.useState(""),[a,c]=B.useState(!1),[p,d]=B.useState([]),[m,y]=B.useState(s);B.useEffect(()=>{y(s)},[s,r]);const h=async()=>{if(!o.trim()){d([]);return}try{c(!0);const g=new URLSearchParams({search:o,limit:"20"}),w=await fetch(`/api/entities/places?${g}`,{credentials:"include"});if(!w.ok)throw new Error("Failed to search places");const k=await w.json();k.success&&d(k.places||[])}catch(g){console.error("Error searching places:",g),d([])}finally{c(!1)}},_=g=>{const w={id:g.id,name:g.name,place_type:g.place_type,coordinates:g.coordinates,address:g.address,country:g.country,region:g.region},k=m.find(A=>A.id===g.id);y(k?m.filter(A=>A.id!==g.id):[...m,w])},b=()=>{n(m),t()},N=()=>{y(s),t()},u=g=>{switch(g){case"FACILITY":return"ðŸ¢";case"CITY":return"ðŸ™ï¸";case"REGION":return"ðŸ—ºï¸";case"COUNTRY":return"ðŸŒ";case"INSTALLATION":return"ðŸ—ï¸";default:return"ðŸ“"}},v=g=>{switch(g){case"FACILITY":return"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400";case"CITY":return"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-400";case"REGION":return"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400";case"COUNTRY":return"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400";case"INSTALLATION":return"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400";default:return"bg-gray-100 text-gray-700 dark:bg-gray-900/20 dark:text-gray-400"}};return e.jsx(wt,{open:r,onOpenChange:N,children:e.jsxs(jt,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsxs(kt,{children:["Link Places ",i&&`to ${i}`]}),e.jsxs(It,{children:["Search for and select locations relevant to this ",i||"item"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ir,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ee,{placeholder:"Search places by name, country, region...",value:o,onChange:g=>l(g.target.value),onKeyDown:g=>g.key==="Enter"&&h(),className:"pl-10"})]}),e.jsx(te,{onClick:h,disabled:a,children:a?e.jsx(xt,{className:"h-4 w-4 animate-spin"}):"Search"})]}),m.length>0&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(gr,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),e.jsxs("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:[m.length," place",m.length!==1?"s":""," selected"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(g=>e.jsxs(he,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx("span",{children:u(g.place_type)}),e.jsx("span",{children:g.name}),e.jsx(Ze,{className:"h-3 w-3 cursor-pointer hover:text-red-600",onClick:()=>_(g)})]},g.id))})]}),p.length>0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsxs("h5",{className:"text-sm font-medium",children:["Results (",p.length,")"]}),p.map(g=>{const w=m.some(k=>k.id===g.id);return e.jsx(ge,{className:`cursor-pointer transition-all ${w?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 border-2":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,onClick:()=>_(g),children:e.jsx(xe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xl",children:u(g.place_type)}),e.jsx("h6",{className:"font-medium text-sm",children:g.name}),w&&e.jsx(gr,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsx(he,{className:`text-xs ${v(g.place_type)}`,children:g.place_type}),g.country&&e.jsxs(he,{variant:"outline",className:"text-xs",children:["ðŸŒ ",g.country]}),g.region&&e.jsxs(he,{variant:"outline",className:"text-xs",children:["ðŸ“ ",g.region]})]}),g.address&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:g.address}),g.description&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1 line-clamp-2",children:g.description})]}),e.jsx("a",{href:`/dashboard/entities/places/${g.id}`,target:"_blank",rel:"noopener noreferrer",onClick:k=>k.stopPropagation(),className:"ml-2 p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded",children:e.jsx(ar,{className:"h-4 w-4 text-gray-500"})})]})})},g.id)})]}),a&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(xt,{className:"h-6 w-6 animate-spin text-muted-foreground"})}),!a&&p.length===0&&o&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(bs,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"No places found. Try a different search term."]}),!o&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(bs,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"Search for locations to link to this ",i||"item"]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(te,{variant:"outline",onClick:N,children:"Cancel"}),e.jsxs(te,{onClick:b,children:[e.jsx(gr,{className:"h-4 w-4 mr-2"}),"Link ",m.length>0&&`(${m.length})`]})]})]})})}function D0({isOpen:r,onClose:t,selectedEvents:s,onEventsChange:n,contextLabel:i}){const[o,l]=B.useState(""),[a,c]=B.useState(!1),[p,d]=B.useState([]),[m,y]=B.useState(s);B.useEffect(()=>{y(s)},[s,r]);const h=async()=>{if(!o.trim()){d([]);return}try{c(!0);const k=new URLSearchParams({search:o,limit:"20"}),A=await fetch(`/api/entities/events?${k}`,{credentials:"include"});if(!A.ok)throw new Error("Failed to search events");const T=await A.json();T.success&&d(T.events||[])}catch(k){console.error("Error searching events:",k),d([])}finally{c(!1)}},_=k=>{const A={id:k.id,name:k.name,event_type:k.event_type,date_start:k.date_start,date_end:k.date_end,significance:k.significance,description:k.description},T=m.find(z=>z.id===k.id);y(T?m.filter(z=>z.id!==k.id):[...m,A])},b=()=>{n(m),t()},N=()=>{y(s),t()},u=k=>{switch(k){case"OPERATION":return"âš”ï¸";case"INCIDENT":return"âš ï¸";case"MEETING":return"ðŸ¤";case"ACTIVITY":return"ðŸ“…";default:return"ðŸ“Œ"}},v=k=>{switch(k){case"OPERATION":return"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400";case"INCIDENT":return"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400";case"MEETING":return"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400";case"ACTIVITY":return"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400";default:return"bg-gray-100 text-gray-700 dark:bg-gray-900/20 dark:text-gray-400"}},g=k=>{if(!k)return"";switch(k){case"CRITICAL":return"text-red-600 dark:text-red-400";case"HIGH":return"text-orange-600 dark:text-orange-400";case"MEDIUM":return"text-yellow-600 dark:text-yellow-400";case"LOW":return"text-gray-600 dark:text-gray-400";default:return""}},w=k=>{try{return new Date(k).toLocaleDateString()}catch{return k}};return e.jsx(wt,{open:r,onOpenChange:N,children:e.jsxs(jt,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsxs(kt,{children:["Link Events ",i&&`to ${i}`]}),e.jsxs(It,{children:["Search for and select events/incidents relevant to this ",i||"item"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ir,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ee,{placeholder:"Search events by name, type, date...",value:o,onChange:k=>l(k.target.value),onKeyDown:k=>k.key==="Enter"&&h(),className:"pl-10"})]}),e.jsx(te,{onClick:h,disabled:a,children:a?e.jsx(xt,{className:"h-4 w-4 animate-spin"}):"Search"})]}),m.length>0&&e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(gr,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),e.jsxs("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:[m.length," event",m.length!==1?"s":""," selected"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(k=>e.jsxs(he,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx("span",{children:u(k.event_type)}),e.jsx("span",{children:k.name}),e.jsx(Ze,{className:"h-3 w-3 cursor-pointer hover:text-red-600",onClick:()=>_(k)})]},k.id))})]}),p.length>0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsxs("h5",{className:"text-sm font-medium",children:["Results (",p.length,")"]}),p.map(k=>{const A=m.some(T=>T.id===k.id);return e.jsx(ge,{className:`cursor-pointer transition-all ${A?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 border-2":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,onClick:()=>_(k),children:e.jsx(xe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xl",children:u(k.event_type)}),e.jsx("h6",{className:"font-medium text-sm",children:k.name}),A&&e.jsx(gr,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsx(he,{className:`text-xs ${v(k.event_type)}`,children:k.event_type}),k.significance&&e.jsx(he,{variant:"outline",className:`text-xs ${g(k.significance)}`,children:k.significance}),e.jsxs(he,{variant:"outline",className:"text-xs",children:["ðŸ“… ",w(k.date_start),k.date_end&&` - ${w(k.date_end)}`]})]}),k.description&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2 line-clamp-2",children:k.description})]}),e.jsx("a",{href:`/dashboard/entities/events/${k.id}`,target:"_blank",rel:"noopener noreferrer",onClick:T=>T.stopPropagation(),className:"ml-2 p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded",children:e.jsx(ar,{className:"h-4 w-4 text-gray-500"})})]})})},k.id)})]}),a&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(xt,{className:"h-6 w-6 animate-spin text-muted-foreground"})}),!a&&p.length===0&&o&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(dr,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"No events found. Try a different search term."]}),!o&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(dr,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"Search for events to link to this ",i||"item"]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(te,{variant:"outline",onClick:N,children:"Cancel"}),e.jsxs(te,{onClick:b,children:[e.jsx(gr,{className:"h-4 w-4 mr-2"}),"Link ",m.length>0&&`(${m.length})`]})]})]})})}const cn={pest:{type:"pest",title:"PEST Analysis",description:"Political, Economic, Social, Technological",sections:[{key:"political",label:"Political",description:"Political factors affecting the organization",color:"border-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",icon:"ðŸ›ï¸"},{key:"economic",label:"Economic",description:"Economic factors and trends",color:"border-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",icon:"ðŸ’°"},{key:"social",label:"Social",description:"Social and cultural factors",color:"border-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",icon:"ðŸ‘¥"},{key:"technological",label:"Technological",description:"Technological innovations and trends",color:"border-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",icon:"ðŸ”¬"}]},"pmesii-pt":{type:"pmesii-pt",title:"PMESII-PT Analysis",description:"Political, Military, Economic, Social, Information, Infrastructure, Physical Environment, Time",itemType:"qa",sections:[{key:"political",label:"Political",description:"Political structures and governance",color:"border-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",icon:"ðŸ›ï¸"},{key:"military",label:"Military",description:"Military capabilities and posture",color:"border-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",icon:"ðŸŽ–ï¸"},{key:"economic",label:"Economic",description:"Economic systems and resources",color:"border-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",icon:"ðŸ’°"},{key:"social",label:"Social",description:"Social structures and demographics",color:"border-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",icon:"ðŸ‘¥"},{key:"information",label:"Information",description:"Information systems and flow",color:"border-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",icon:"ðŸ“¡"},{key:"infrastructure",label:"Infrastructure",description:"Physical and organizational infrastructure",color:"border-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",icon:"ðŸ—ï¸"},{key:"physical",label:"Physical Environment",description:"Geography, terrain, and climate",color:"border-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",icon:"ðŸŒ"},{key:"time",label:"Time",description:"Temporal factors and timing",color:"border-indigo-500",bgColor:"bg-indigo-50 dark:bg-indigo-900/20",icon:"â°"}]},dotmlpf:{type:"dotmlpf",title:"DOTMLPF Analysis",description:"Doctrine, Organization, Training, Material, Leadership, Personnel, Facilities",sections:[{key:"doctrine",label:"Doctrine",description:"Fundamental principles and tactics",color:"border-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",icon:"ðŸ“–"},{key:"organization",label:"Organization",description:"Organizational structure and design",color:"border-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",icon:"ðŸ¢"},{key:"training",label:"Training",description:"Training programs and readiness",color:"border-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",icon:"ðŸŽ“"},{key:"material",label:"Material",description:"Equipment and technology",color:"border-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",icon:"âš™ï¸"},{key:"leadership",label:"Leadership",description:"Leadership capabilities and development",color:"border-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",icon:"ðŸ‘”"},{key:"personnel",label:"Personnel",description:"Personnel management and resources",color:"border-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",icon:"ðŸ‘¥"},{key:"facilities",label:"Facilities",description:"Physical facilities and installations",color:"border-pink-500",bgColor:"bg-pink-50 dark:bg-pink-900/20",icon:"ðŸ—ï¸"}]},dime:{type:"dime",title:"DIME Framework",description:"Diplomatic, Information, Military, Economic",itemType:"qa",sections:[{key:"diplomatic",label:"Diplomatic",description:"Diplomatic relationships and negotiations",color:"border-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",icon:"ðŸ¤"},{key:"information",label:"Information",description:"Information operations and intelligence",color:"border-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",icon:"ðŸ“¡"},{key:"military",label:"Military",description:"Military capabilities and operations",color:"border-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",icon:"ðŸŽ–ï¸"},{key:"economic",label:"Economic",description:"Economic power and sanctions",color:"border-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",icon:"ðŸ’°"}]},cog:{type:"cog",title:"Center of Gravity Analysis",description:"Systematic COG analysis across DIMEFIL domains with vulnerability scoring and network visualization (JP 3-0 methodology)",itemType:"custom",sections:[{key:"operational_context",label:"Operational Context",description:"Define objectives, operating environment, and constraints",color:"border-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20",icon:"ðŸ“‹"},{key:"centers_of_gravity",label:"Centers of Gravity",description:"Identify COGs across DIMEFIL domains (Friendly, Adversary, Host Nation)",color:"border-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",icon:"ðŸŽ¯"},{key:"critical_capabilities",label:"Critical Capabilities",description:"Primary abilities (verbs) that enable the COG to function",color:"border-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",icon:"âš¡"},{key:"critical_requirements",label:"Critical Requirements",description:"Essential conditions and resources (nouns) needed for capabilities",color:"border-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",icon:"ðŸ“‹"},{key:"critical_vulnerabilities",label:"Critical Vulnerabilities",description:"Weaknesses that can be exploited with Impact/Attainability/Follow-up scoring",color:"border-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",icon:"âš ï¸"},{key:"network_analysis",label:"Network Analysis",description:"Visualize relationships and calculate centrality measures",color:"border-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",icon:"ðŸ•¸ï¸"}]},stakeholder:{type:"stakeholder",title:"Stakeholder Analysis",description:"Power/Interest Matrix - Comprehensive stakeholder mapping and engagement planning",itemType:"stakeholder",sections:[{key:"high_power_high_interest",label:"Key Players",description:"High Power, High Interest - Manage Closely: Engage actively, involve in decisions, build strong relationships",color:"border-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",icon:"ðŸ‘‘"},{key:"high_power_low_interest",label:"Keep Satisfied",description:"High Power, Low Interest - Keep Satisfied: Regular updates, ensure concerns addressed, maintain goodwill",color:"border-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",icon:"ðŸ¤"},{key:"low_power_high_interest",label:"Keep Informed",description:"Low Power, High Interest - Keep Informed: Regular communication, leverage as advocates, consult on issues",color:"border-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",icon:"ðŸ“¢"},{key:"low_power_low_interest",label:"Monitor",description:"Low Power, Low Interest - Monitor: Minimal effort, periodic updates, watch for changes in status",color:"border-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20",icon:"ðŸ‘¥"}]},deception:{type:"deception",title:"Deception Detection (SATS)",description:"CIA Structured Analytic Techniques for detecting deception - based on Richards J. Heuer Jr. methodology",sections:[{key:"scenario",label:"Scenario",description:"Describe the information or situation being analyzed for potential deception",color:"border-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20",icon:"ðŸ“‹"},{key:"mom",label:"MOM (Motive, Opportunity, Means)",description:"Assess whether the adversary has motive, opportunity, and means to deceive",color:"border-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",icon:"ðŸŽ¯"},{key:"pop",label:"POP (Patterns of Practice)",description:"Examine historical deception patterns of this actor",color:"border-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",icon:"ðŸ“Š"},{key:"moses",label:"MOSES (My Own Sources)",description:"Evaluate vulnerability of your information sources to manipulation",color:"border-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",icon:"ðŸ”"},{key:"eve",label:"EVE (Evaluation of Evidence)",description:"Assess internal consistency and corroboration of evidence",color:"border-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",icon:"âœ“"},{key:"assessment",label:"Overall Assessment",description:"Synthesize findings and determine deception likelihood",color:"border-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",icon:"ðŸ“"}]},behavior:{type:"behavior",title:"Behavior Analysis",description:"Objective documentation of behaviors in specific locations/contexts (based on U.S. Army FM TM 3-53.11)",sections:[{key:"basic_info",label:"Basic Information",description:"Define the behavior and context being analyzed (WHAT behavior, WHERE, WHEN)",color:"border-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",icon:"ðŸ“‹"},{key:"timeline",label:"Behavior Timeline",description:"Document when, where, and how long the behavior occurs (interactive timeline with forks)",color:"border-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",icon:"ðŸ“…"},{key:"environmental_factors",label:"Environmental Factors",description:"Physical and environmental context. What infrastructure, resources, and accessibility factors exist?",color:"border-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",icon:"ðŸŒ",promptQuestions:["What physical infrastructure exists? (buildings, roads, facilities)","What resources are available? (equipment, materials, spaces)","What are the accessibility considerations?","What physical constraints or enablers exist?","What environmental conditions affect this? (weather, climate, terrain)"]},{key:"social_context",label:"Social and Cultural Context",description:"Cultural norms, social influences, and community dynamics around this behavior.",color:"border-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",icon:"ðŸ‘¥",promptQuestions:["What are the cultural norms around this behavior?","What social influences exist? (family, peers, community)","Are there community leaders or influencers?","What group dynamics or social pressures exist?","How do people talk about or communicate about this behavior?"]},{key:"consequences",label:"Consequences and Outcomes",description:"What happens after someone performs this behavior? Rewards, costs, outcomes.",color:"border-pink-500",bgColor:"bg-pink-50 dark:bg-pink-900/20",icon:"âš–ï¸",promptQuestions:["What are the immediate consequences?","What are the long-term outcomes?","What rewards exist? (intrinsic and extrinsic)","What costs or penalties exist?","What unintended consequences occur?"]},{key:"symbols",label:"Symbols and Signals",description:"Visual, auditory, or social cues associated with this behavior.",color:"border-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",icon:"ðŸŽ­",promptQuestions:["What symbols are associated with this behavior?","What signals indicate someone is about to do this or has done it?","Are there visual cues? (clothing, logos, badges)","Are there auditory cues? (sounds, music, verbal phrases)","What social status or identity markers exist?"]},{key:"observed_patterns",label:"Observed Patterns",description:"Variations and patterns in how different people perform this behavior.",color:"border-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",icon:"ðŸ”„",promptQuestions:["What variations exist in how people perform this?","What are common sequences or typical paths?","What shortcuts or workarounds do people use?","How does performance vary by subgroup or demographic?","What adaptations do people make to constraints?"]},{key:"potential_audiences",label:"Potential Target Audiences",description:"Who performs this behavior? Who could but doesn't? Identify audience segments for COM-B Analysis.",color:"border-violet-500",bgColor:"bg-violet-50 dark:bg-violet-900/20",icon:"ðŸŽ¯",promptQuestions:["Who currently performs this behavior?","Who could perform it but doesn't?","What are the key demographic segments?","What psychographic differences exist between groups?","Who influences whether others perform this?"]}]},"comb-analysis":{type:"comb-analysis",title:"COM-B Analysis (Behaviour Change Wheel)",description:"Target-audience-specific assessment using the COM-B model and Behaviour Change Wheel methodology",sections:[{key:"setup",label:"Analysis Setup",description:"Link to behavior and define target audience",color:"border-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",icon:"ðŸŽ¯"},{key:"target_audience",label:"Target Audience Definition",description:"Demographics, psychographics, current relationship to behavior",color:"border-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",icon:"ðŸ‘¥"},{key:"physical_capability",label:"Physical Capability Assessment",description:"Does this audience have the physical skills, strength, stamina needed?",color:"border-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",icon:"ðŸ’ª",hasDeficitAssessment:!0,comBComponent:"physical_capability"},{key:"psychological_capability",label:"Psychological Capability Assessment",description:"Does this audience have the knowledge, cognitive skills, comprehension needed?",color:"border-amber-500",bgColor:"bg-amber-50 dark:bg-amber-900/20",icon:"ðŸ§ ",hasDeficitAssessment:!0,comBComponent:"psychological_capability"},{key:"physical_opportunity",label:"Physical Opportunity Assessment",description:"Does this audience have access to environmental factors, time, resources, infrastructure?",color:"border-teal-500",bgColor:"bg-teal-50 dark:bg-teal-900/20",icon:"ðŸŒ",hasDeficitAssessment:!0,comBComponent:"physical_opportunity"},{key:"social_opportunity",label:"Social Opportunity Assessment",description:"Do cultural norms, social cues, peer influence support this audience?",color:"border-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",icon:"ðŸ‘¥",hasDeficitAssessment:!0,comBComponent:"social_opportunity"},{key:"reflective_motivation",label:"Reflective Motivation Assessment",description:"Do this audience's beliefs, intentions, goals, identity align with the behavior?",color:"border-indigo-500",bgColor:"bg-indigo-50 dark:bg-indigo-900/20",icon:"ðŸŽ¯",hasDeficitAssessment:!0,comBComponent:"reflective_motivation"},{key:"automatic_motivation",label:"Automatic Motivation Assessment",description:"Do this audience's emotions, impulses, habits, desires support the behavior?",color:"border-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",icon:"âš¡",hasDeficitAssessment:!0,comBComponent:"automatic_motivation"},{key:"contextual_factors",label:"Contextual Factors",description:"Environmental, cultural, or situational factors affecting this audience",color:"border-slate-500",bgColor:"bg-slate-50 dark:bg-slate-900/20",icon:"ðŸŒ"},{key:"assumptions",label:"Assumptions",description:"What assumptions were made during this assessment?",color:"border-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",icon:"âš ï¸"},{key:"limitations",label:"Limitations",description:"What are the limitations of this analysis?",color:"border-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",icon:"ðŸš«"}]},starbursting:{type:"starbursting",title:"Starbursting",description:"Question-based brainstorming technique",itemType:"qa",sections:[{key:"who",label:"Who Questions",description:"Questions about people and stakeholders",color:"border-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",icon:"ðŸ‘¤",promptQuestions:["Who are the primary stakeholders?","Who benefits from this situation?","Who has the authority to make decisions?","Who are the influencers or opinion leaders?","Who might oppose this?","Who are the experts on this topic?"]},{key:"what",label:"What Questions",description:"Questions about the subject matter",color:"border-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",icon:"â“",promptQuestions:["What is the core issue or problem?","What are the stated objectives?","What evidence supports this?","What are the alternative explanations?","What are the potential consequences?","What assumptions are being made?"]},{key:"when",label:"When Questions",description:"Questions about timing and schedule",color:"border-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",icon:"â°",promptQuestions:["When did this situation begin?","When are key decisions being made?","When have similar situations occurred?","When is the critical timeframe?","When will we see outcomes?","When do deadlines occur?"]},{key:"where",label:"Where Questions",description:"Questions about location and place",color:"border-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",icon:"ðŸ“",promptQuestions:["Where is this occurring geographically?","Where are the stakeholders located?","Where could this spread or expand?","Where are safe zones or areas of concern?","Where is evidence being collected?","Where should resources be deployed?"]},{key:"why",label:"Why Questions",description:"Questions about reasons and motivations",color:"border-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",icon:"ðŸ’¡",promptQuestions:["Why is this happening now?","Why are actors motivated to act?","Why is this significant?","Why might deception be present?","Why are some perspectives being emphasized?","Why might this fail or succeed?"]},{key:"how",label:"How Questions",description:"Questions about methods and processes",color:"border-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",icon:"âš™ï¸",promptQuestions:["How did this situation develop?","How are actors coordinating?","How can we verify claims?","How might this evolve?","How can we influence outcomes?","How do we measure success?"]}]},causeway:{type:"causeway",title:"Causeway Analysis",description:"6-stage structured COG methodology: Identify threats, map critical capabilities/requirements, and determine leverage points for influence operations",itemType:"qa",sections:[{key:"threat_id",label:"Threat Identification",description:"Define the issue and location being analyzed",color:"border-gray-500",bgColor:"bg-gray-50 dark:bg-gray-900/20",icon:"ðŸ“‹"},{key:"problem",label:"Problem (P)",description:"What is the specific problem or threat behavior?",color:"border-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",icon:"âš ï¸"},{key:"undesired_actor",label:"Undesired Actor (U)",description:"Who is the adversary or actor of responsibility causing this problem?",color:"border-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",icon:"ðŸ‘¤"},{key:"target_audience",label:"Target Audience (TA)",description:"What audiences can be influenced to counter this threat?",color:"border-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",icon:"ðŸŽ¯"},{key:"remedy",label:"Remedy (R)",description:"What is the desired end state or solution?",color:"border-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",icon:"âœ…"},{key:"story",label:"Story (S)",description:"What narrative or messaging supports the remedy?",color:"border-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",icon:"ðŸ“–"},{key:"critical_capabilities",label:"Critical Capabilities",description:"What capabilities enable the undesired actor to execute the threat?",color:"border-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",icon:"âš¡"},{key:"critical_requirements",label:"Critical Requirements",description:"What essential conditions, resources, or dependencies support these capabilities?",color:"border-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",icon:"ðŸ“‹"},{key:"proximate_targets",label:"Proximate Targets",description:"What tangible entities can be influenced or targeted to disrupt critical requirements?",color:"border-pink-500",bgColor:"bg-pink-50 dark:bg-pink-900/20",icon:"ðŸŽª"}]},surveillance:{type:"surveillance",title:"Surveillance Framework (ISR Collection Planning)",description:"Intelligence, Surveillance, and Reconnaissance operations planning based on RAND Strategies-to-Tasks methodology",itemType:"qa",sections:[{key:"commanders_guidance",label:"Commander's Guidance",description:"Top-level strategic objectives and operational priorities",color:"border-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",icon:"â­"},{key:"intelligence_requirements",label:"Intelligence Requirements",description:"Priority Intelligence Requirements (PIRs) and Essential Elements of Information (EEIs)",color:"border-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",icon:"ðŸŽ¯"},{key:"collection_strategies",label:"Collection Strategies",description:"Methods, platforms, and approaches for information gathering",color:"border-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",icon:"ðŸ“¡"},{key:"surveillance_targets",label:"Surveillance Targets",description:"Entities, locations, or activities requiring persistent monitoring",color:"border-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",icon:"ðŸ‘ï¸"},{key:"reconnaissance_tasks",label:"Reconnaissance Tasks",description:"Specific information-gathering missions to answer intelligence questions",color:"border-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",icon:"ðŸ”"},{key:"collection_assets",label:"Collection Assets",description:"Available sensors, platforms, and resources for ISR operations",color:"border-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",icon:"ðŸ›°ï¸"},{key:"processing_plan",label:"Information Processing",description:"Analysis, fusion, and integration procedures",color:"border-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",icon:"âš™ï¸"},{key:"dissemination",label:"Dissemination Plan",description:"Intelligence sharing and distribution procedures",color:"border-pink-500",bgColor:"bg-pink-50 dark:bg-pink-900/20",icon:"ðŸ“¤"}]},"fundamental-flow":{type:"fundamental-flow",title:"Fundamental Flow Analysis",description:"Intelligence cycle and information flow analysis for process optimization",itemType:"qa",sections:[{key:"planning_direction",label:"Planning & Direction",description:"Requirements definition and collection priorities",color:"border-red-500",bgColor:"bg-red-50 dark:bg-red-900/20",icon:"ðŸ“‹"},{key:"collection",label:"Collection",description:"Information gathering from various sources and methods",color:"border-blue-500",bgColor:"bg-blue-50 dark:bg-blue-900/20",icon:"ðŸ“¡"},{key:"processing",label:"Processing",description:"Converting raw data into usable formats and structures",color:"border-green-500",bgColor:"bg-green-50 dark:bg-green-900/20",icon:"âš™ï¸"},{key:"exploitation_production",label:"Exploitation & Production",description:"Analysis and intelligence product creation",color:"border-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/20",icon:"ðŸ”¬"},{key:"dissemination",label:"Dissemination",description:"Distribution of intelligence to consumers and stakeholders",color:"border-purple-500",bgColor:"bg-purple-50 dark:bg-purple-900/20",icon:"ðŸ“¤"},{key:"feedback_evaluation",label:"Feedback & Evaluation",description:"Assessment of intelligence value and process effectiveness",color:"border-cyan-500",bgColor:"bg-cyan-50 dark:bg-cyan-900/20",icon:"ðŸ“Š"},{key:"information_sources",label:"Information Sources",description:"Catalog of available information feeds and collection capabilities",color:"border-yellow-500",bgColor:"bg-yellow-50 dark:bg-yellow-900/20",icon:"ðŸ—‚ï¸"},{key:"flow_metrics",label:"Flow Metrics",description:"Timeliness, accuracy, relevance, and efficiency measurements",color:"border-pink-500",bgColor:"bg-pink-50 dark:bg-pink-900/20",icon:"ðŸ“ˆ"}]}},zd=Kn("GenericFrameworkForm");function ks(){const r={"Content-Type":"application/json"},t=localStorage.getItem("omnicore_token");t&&(r.Authorization=`Bearer ${t}`);const s=localStorage.getItem("user_hash");return s&&(r["X-User-Hash"]=s),r}const M0=B.memo(({section:r,items:t,newItem:s,newAnswer:n,setNewItem:i,setNewAnswer:o,onAdd:l,onRemove:a,onEdit:c,linkedEvidence:p,onLinkEvidence:d,onRemoveEvidence:m,linkedActors:y,onLinkActors:h,onRemoveActor:_,frameworkType:b,allData:N,itemType:u,deficitLevel:v,onDeficitChange:g,sectionKey:w,onLinkQuestionActors:k,onLinkQuestionPlaces:A,onLinkQuestionEvents:T,onLinkQuestionEvidence:z,questionEvidence:S,onRemoveQuestionEvidence:U})=>{const G=u==="qa",[F,C]=B.useState(null),[j,D]=B.useState(""),[J,q]=B.useState(""),[W,$]=B.useState(""),[ne,K]=B.useState("medium"),[P,Y]=B.useState(!1),re=R=>{C(R.id),Ht(R)?(D(R.question),q(R.answer||""),K(R.priority||"medium")):"text"in R&&$(R.text)},le=()=>{F&&(G?c(F,{question:j,answer:J,priority:ne}):c(F,{text:W}),C(null),D(""),q(""),$(""),K("medium"))},se=()=>{C(null),D(""),q(""),$(""),K("medium")};return e.jsxs(ge,{className:`border-l-4 ${r.color}`,children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:r.icon}),r.label]}),e.jsx(Le,{children:r.description}),r.promptQuestions&&r.promptQuestions.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{onClick:()=>Y(!P),className:"w-full flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors",children:[e.jsxs("span",{className:"text-xs font-medium text-blue-900 dark:text-blue-100",children:["ðŸ’¡ ",G?"Template Questions":"Questions to consider"," (",r.promptQuestions.length,")"]}),e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:P?"â–¼":"â–¶"})]}),P&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800 space-y-2",children:r.promptQuestions.map((R,I)=>e.jsx("div",{className:"flex items-start gap-2 text-xs",children:G?e.jsxs(e.Fragment,{children:[e.jsx(te,{type:"button",variant:"ghost",size:"sm",onClick:()=>{i(R),o("")},className:"h-7 text-xs px-2 hover:bg-blue-200 dark:hover:bg-blue-800",title:"Add this question",children:e.jsx(st,{className:"h-3 w-3"})}),e.jsx("span",{className:"flex-1 text-blue-800 dark:text-blue-200 pt-1",children:R})]}):e.jsx("li",{className:"list-disc ml-4 text-blue-800 dark:text-blue-200",children:R})},I))})]}),r.hasDeficitAssessment&&g&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[e.jsx(fe,{className:"text-sm font-medium mb-2 block",children:"Deficit Assessment"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{type:"button",variant:v==="adequate"?"default":"outline",size:"sm",onClick:()=>g("adequate"),className:v==="adequate"?"bg-green-600 hover:bg-green-700":"",children:"âœ“ Adequate"}),e.jsx(te,{type:"button",variant:v==="deficit"?"default":"outline",size:"sm",onClick:()=>g("deficit"),className:v==="deficit"?"bg-orange-600 hover:bg-orange-700":"",children:"âš  Deficit"}),e.jsx(te,{type:"button",variant:v==="major_barrier"?"default":"outline",size:"sm",onClick:()=>g("major_barrier"),className:v==="major_barrier"?"bg-red-600 hover:bg-red-700":"",children:"âœ– Major Barrier"})]})]})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ee,{placeholder:G?"Add question...":`Add ${r.label.toLowerCase()}...`,value:s,onChange:R=>i(R.target.value),onKeyPress:R=>!G&&R.key==="Enter"&&l()}),!G&&e.jsxs(e.Fragment,{children:[e.jsx(gs,{fieldName:r.label,currentValue:s,onAccept:R=>i(R),context:{framework:b,relatedFields:N},placeholder:`Add ${r.label.toLowerCase()}...`}),e.jsx(te,{onClick:l,size:"sm",children:e.jsx(st,{className:"h-4 w-4"})})]})]}),G&&e.jsxs(e.Fragment,{children:[e.jsx($e,{placeholder:"Add answer (leave blank if unknown)...",value:n||"",onChange:R=>o?.(R.target.value),rows:2}),e.jsxs(te,{onClick:l,size:"sm",className:"w-full",children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),"Add Question & Answer"]})]})]}),e.jsx("div",{className:"space-y-2",children:t.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"No items added yet"}):t.map(R=>{const I=G&&Ht(R)&&(R.needsAnswer||!R.answer?.trim()),Q=F===R.id;return e.jsxs("div",{className:`flex items-start gap-2 p-3 rounded-lg ${I?"bg-red-50 dark:bg-red-900/20 border-2 border-red-200 dark:border-red-800":"bg-gray-50 dark:bg-gray-800"}`,children:[Q?e.jsx("div",{className:"flex-1 space-y-2",children:G&&Ht(R)?e.jsxs(e.Fragment,{children:[e.jsx($e,{placeholder:"Question...",value:j,onChange:X=>D(X.target.value),rows:2,className:"text-sm resize-y"}),e.jsx($e,{placeholder:"Answer...",value:J,onChange:X=>q(X.target.value),rows:3,className:"text-sm resize-y"}),b==="starbursting"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"text-xs font-medium whitespace-nowrap",children:"Priority:"}),e.jsxs("select",{value:ne,onChange:X=>K(X.target.value),className:"text-xs border rounded px-2 py-1 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]})]})]}):e.jsx($e,{placeholder:"Text...",value:W,onChange:X=>$(X.target.value),rows:2,className:"text-sm resize-y"})}):e.jsx(e.Fragment,{children:G&&Ht(R)?e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"text-sm font-medium flex items-start gap-2",children:[I&&e.jsx("span",{className:"text-red-600 dark:text-red-400 flex-shrink-0",children:"â—"}),e.jsxs("span",{className:"break-words flex-1",children:["Q: ",R.question]}),b==="starbursting"&&R.priority&&e.jsx(he,{variant:R.priority==="critical"?"destructive":R.priority==="high"?"secondary":"outline",className:`text-xs shrink-0 ${R.priority==="high"?"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-400":""}`,children:R.priority})]}),e.jsxs("div",{className:`text-sm break-words ${I?"text-red-700 dark:text-red-300":"text-gray-600 dark:text-gray-400"}`,children:["A: ",R.answer||e.jsx("span",{className:"italic font-semibold",children:"Needs answer - please fill in"})]}),b==="starbursting"&&e.jsxs("div",{className:"mt-2 space-y-2",children:[w&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[w==="who"&&k&&e.jsxs(te,{variant:"outline",size:"sm",onClick:()=>k(R.id),className:"h-7 text-xs",children:[e.jsx(ur,{className:"h-3 w-3 mr-1"}),"Link Actors (",R.linked_actors?.length||0,")"]}),w==="where"&&A&&e.jsxs(te,{variant:"outline",size:"sm",onClick:()=>A(R.id),className:"h-7 text-xs",children:[e.jsx(bs,{className:"h-3 w-3 mr-1"}),"Link Places (",R.linked_places?.length||0,")"]}),w==="when"&&T&&e.jsxs(te,{variant:"outline",size:"sm",onClick:()=>T(R.id),className:"h-7 text-xs",children:[e.jsx(dr,{className:"h-3 w-3 mr-1"}),"Link Events (",R.linked_events?.length||0,")"]}),z&&e.jsxs(te,{variant:"outline",size:"sm",onClick:()=>z(R.id),className:"h-7 text-xs",children:[e.jsx(rr,{className:"h-3 w-3 mr-1"}),"Link Evidence (",R.evidence_ids?.length||0,")"]})]}),R.linked_actors&&R.linked_actors.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:R.linked_actors.map(X=>e.jsxs(he,{variant:"secondary",className:"text-xs",children:["ðŸ‘¤ ",X.name]},X.id))}),R.linked_places&&R.linked_places.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:R.linked_places.map(X=>e.jsxs(he,{variant:"secondary",className:"text-xs",children:["ðŸ“ ",X.name]},X.id))}),R.linked_events&&R.linked_events.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:R.linked_events.map(X=>e.jsxs(he,{variant:"secondary",className:"text-xs",children:["ðŸ“… ",X.name]},X.id))}),S&&S[R.id]&&S[R.id].length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400 mr-2",children:"Evidence:"}),S[R.id].map(X=>e.jsx(Dd,{evidence:X,onRemove:U?()=>U(R.id,X):void 0,showDetails:!1},`${X.entity_type}-${X.entity_id}`))]})]})]}):e.jsx("span",{className:"flex-1 text-sm break-words",children:"text"in R?R.text:R.question||""})}),e.jsx("div",{className:"flex gap-1",children:Q?e.jsxs(e.Fragment,{children:[e.jsx(te,{variant:"ghost",size:"sm",onClick:le,className:"h-6 w-6 p-0 text-green-600 hover:text-green-700",children:e.jsx($t,{className:"h-4 w-4"})}),e.jsx(te,{variant:"ghost",size:"sm",onClick:se,className:"h-6 w-6 p-0",children:e.jsx(Ze,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>re(R),className:"h-6 w-6 p-0",children:e.jsx(kc,{className:"h-3.5 w-3.5"})}),e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>a(R.id),className:"h-6 w-6 p-0 text-red-600 hover:text-red-700",children:e.jsx(Ze,{className:"h-4 w-4"})})]})})]},R.id)})}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs(fe,{className:"text-sm font-medium",children:["Linked Evidence (",p.length,")"]}),e.jsxs(te,{variant:"outline",size:"sm",onClick:d,children:[e.jsx(rr,{className:"h-3 w-3 mr-2"}),"Link Evidence"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:p.length===0?e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:"No evidence linked to this section"}):p.map(R=>e.jsx(Dd,{evidence:R,onRemove:()=>m(R),showDetails:!0},`${R.entity_type}-${R.entity_id}`))})]}),h&&e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs(fe,{className:"text-sm font-medium",children:["Linked Actors (",y?.length||0,")"]}),e.jsxs(te,{variant:"outline",size:"sm",onClick:h,children:[e.jsx(ur,{className:"h-3 w-3 mr-2"}),"Link Actors"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:!y||y.length===0?e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:"No actors linked to this domain"}):y.map(R=>e.jsx(P0,{actor:R,onRemove:_?()=>_(R):void 0},R.id))})]}),e.jsxs(he,{variant:"secondary",children:[t.length," items"]})]})]})});function Ud({initialData:r,mode:t,sections:s,frameworkType:n,frameworkTitle:i,onSave:o,backPath:l,frameworkId:a}){const c=xr(),{currentWorkspaceId:p}=Kr(),[d,m]=B.useState(!1),[y,h]=B.useState(null),[_,b]=B.useState(null),[N,u]=B.useState(r?.title||""),[v,g]=B.useState(r?.description||""),[w,k]=B.useState(r?.source_url||""),[A,T]=B.useState(r?.linked_behavior_id),[z,S]=B.useState(r?.linked_behavior_title),[U,G]=B.useState(r?.location_context||{geographic_scope:"local",specific_locations:[]}),[F,C]=B.useState(r?.behavior_settings||{settings:[]}),[j,D]=B.useState(r?.temporal_context||{}),[J,q]=B.useState(r?.eligibility||{has_requirements:!1}),[W,$]=B.useState(r?.complexity||"simple_sequence"),[ne,K]=B.useState({country:r?.location_country||"",region:r?.location_region||"",city:r?.location_city||"",time_period_start:r?.time_period_start||"",time_period_end:r?.time_period_end||"",scope_objectives:r?.scope_objectives||""}),[P,Y]=B.useState(s.reduce((ae,de)=>(ae[de.key]=r?.[de.key]||[],ae),{})),[re,le]=B.useState(s.reduce((ae,de)=>(ae[de.key]="",ae),{})),[se,R]=B.useState(s.reduce((ae,de)=>(ae[de.key]="",ae),{})),[I,Q]=B.useState(s.reduce((ae,de)=>(ae[de.key]=[],ae),{})),[X,V]=B.useState(!1),[M,oe]=B.useState(null),[O,ce]=B.useState(s.reduce((ae,de)=>(ae[de.key]=r?.[`${de.key}_actors`]||[],ae),{})),[L,f]=B.useState(!1),[x,E]=B.useState(null),[H,ee]=B.useState(!1),[Z,ue]=B.useState(!1),[pe,ie]=B.useState(!1),[ke,Oe]=B.useState({}),[De,gt]=B.useState(!1),[be,we]=B.useState(!1),[Se,ye]=B.useState({physical_capability:r?.com_b_deficits?.physical_capability||"adequate",psychological_capability:r?.com_b_deficits?.psychological_capability||"adequate",physical_opportunity:r?.com_b_deficits?.physical_opportunity||"adequate",social_opportunity:r?.com_b_deficits?.social_opportunity||"adequate",reflective_motivation:r?.com_b_deficits?.reflective_motivation||"adequate",automatic_motivation:r?.com_b_deficits?.automatic_motivation||"adequate"}),[We,Ot]=B.useState(r?.selected_interventions||[]),[Qt,Pe]=B.useState(r?.imported_sources||[]),[Be,Ve]=B.useState(""),[zt,Gt]=B.useState(!1),[St,hr]=B.useState(null),Ke=cn[n]?.itemType||"text";B.useEffect(()=>{a&&t==="edit"&&oi()},[a,t]),B.useEffect(()=>{if(t!=="create")return;const ae=`draft_${n}_new`,de=setInterval(()=>{if(!(N.trim()||v.trim()||Object.values(P).some(Ge=>Ge.length>0)))return;const Re={title:N,description:v,sectionData:P,timestamp:new Date().toISOString()};try{localStorage.setItem(ae,JSON.stringify(Re))}catch(Ge){console.error("Failed to auto-save draft:",Ge)}},3e4);return()=>clearInterval(de)},[N,v,P,n,t]);const Us=B.useRef(!1);B.useEffect(()=>{if(t==="create"&&!r&&!Us.current){const ae=`draft_${n}_new`,de=localStorage.getItem(ae);if(de)try{const je=JSON.parse(de);if(Date.now()-new Date(je.timestamp).getTime()<1440*60*1e3)if(je.title?.trim()||""||je.description?.trim()||""||Object.values(je.sectionData||{}).some(et=>et.length>0)){const mt=`You have an unsaved draft from ${new Date(je.timestamp).toLocaleString()}.

Would you like to restore it and continue where you left off?

Click OK to restore, or Cancel to start fresh.`;confirm(mt)?(u(je.title||""),g(je.description||""),Y(je.sectionData||{})):localStorage.removeItem(ae)}else localStorage.removeItem(ae);else localStorage.removeItem(ae)}catch(je){console.error("Failed to restore draft:",je),localStorage.removeItem(ae)}Us.current=!0}},[t,n,r]);const oi=async()=>{if(a)try{const ae=await fetch(`/api/framework-evidence?framework_id=${a}&framework_type=${n}&workspace_id=${p}`,{headers:ks()});if(ae.ok){const de=await ae.json(),je={};s.forEach(Ge=>{je[Ge.key]=[]}),(de.evidence||[]).forEach(Ge=>{Ge.framework_item_id&&je[Ge.framework_item_id]&&je[Ge.framework_item_id].push(Ge)}),Q(je)}}catch(ae){console.error("Failed to load linked evidence:",ae)}},Da=(ae,de)=>{if(!de.trim())return;let je;Ke==="qa"?je={id:crypto.randomUUID(),question:de.trim(),answer:(se[ae]||"").trim()}:je={id:crypto.randomUUID(),text:de.trim()},Y(Re=>({...Re,[ae]:[...Re[ae],je]})),le(Re=>({...Re,[ae]:""})),Ke==="qa"&&R(Re=>({...Re,[ae]:""}))},Ma=(ae,de)=>{Y(je=>({...je,[ae]:je[ae].filter(Re=>Re.id!==de)}))},_g=(ae,de,je)=>{Y(Re=>({...Re,[ae]:Re[ae].map(Ge=>Ge.id===de?{...Ge,...je}:Ge)}))},kg=ae=>{oe(ae),V(!0)},Ng=async ae=>{if(M){if(!a){Q(de=>({...de,[M]:[...de[M]||[],...ae]}));return}try{for(const de of ae)await fetch(`/api/framework-evidence?workspace_id=${p}`,{method:"POST",headers:ks(),body:JSON.stringify({framework_type:n,framework_id:a,framework_item_id:M,entity_type:de.entity_type,entity_id:de.entity_id,relation:de.relation,notes:de.notes,workspace_id:p})});await oi()}catch(de){console.error("Failed to link evidence:",de),alert("Failed to link evidence. Please try again.")}}},Sg=async(ae,de)=>{if(!a){Q(je=>({...je,[ae]:je[ae].filter(Re=>!(Re.entity_type===de.entity_type&&Re.entity_id===de.entity_id))}));return}try{await fetch(`/api/framework-evidence?framework_type=${n}&framework_id=${a}&framework_item_id=${ae}&entity_type=${de.entity_type}&entity_id=${de.entity_id}&workspace_id=${p}`,{method:"DELETE",headers:ks()}),Q(je=>({...je,[ae]:je[ae].filter(Re=>!(Re.entity_type===de.entity_type&&Re.entity_id===de.entity_id))}))}catch(je){console.error("Failed to unlink evidence:",je),alert("Failed to unlink evidence. Please try again.")}},Cg=ae=>{oe(ae),f(!0)},Eg=ae=>{M&&ce(de=>({...de,[M]:ae}))},Ag=(ae,de)=>{ce(je=>({...je,[ae]:(je[ae]||[]).filter(Re=>Re.id!==de.id)}))},$a=(ae,de,je)=>{oe(ae),E(de),je==="actor"?f(!0):je==="place"?ee(!0):je==="event"&&ue(!0)},Tg=ae=>{!M||!x||Y(de=>({...de,[M]:de[M].map(je=>je.id===x&&Ht(je)?{...je,linked_actors:ae.map(Re=>({id:Re.id,name:Re.name,type:Re.type}))}:je)}))},Ig=ae=>{!M||!x||Y(de=>({...de,[M]:de[M].map(je=>je.id===x&&Ht(je)?{...je,linked_places:ae.map(Re=>({id:Re.id,name:Re.name,place_type:Re.place_type}))}:je)}))},Rg=ae=>{!M||!x||Y(de=>({...de,[M]:de[M].map(je=>je.id===x&&Ht(je)?{...je,linked_events:ae.map(Re=>({id:Re.id,name:Re.name,event_type:Re.event_type,date_start:Re.date_start}))}:je)}))},Og=(ae,de)=>{oe(ae),E(de),ie(!0)},Fg=ae=>{!M||!x||(Oe(de=>({...de,[x]:[...de[x]||[],...ae]})),Y(de=>({...de,[M]:de[M].map(je=>{if(je.id===x&&Ht(je)){const Re=je.evidence_ids||[],Ge=ae.map(et=>`${et.entity_type}-${et.entity_id}`);return{...je,evidence_ids:[...new Set([...Re,...Ge])]}}return je})})))},Pg=(ae,de)=>{Oe(je=>({...je,[ae]:(je[ae]||[]).filter(Re=>!(Re.entity_type===de.entity_type&&Re.entity_id===de.entity_id))})),M&&Y(je=>({...je,[M]:je[M].map(Re=>{if(Re.id===ae&&Ht(Re)){const Ge=`${de.entity_type}-${de.entity_id}`;return{...Re,evidence_ids:(Re.evidence_ids||[]).filter(et=>et!==Ge)}}return Re})}))},Lg=(ae,de)=>{const je={...P};s.forEach(Re=>{if(ae[Re.key]&&Array.isArray(ae[Re.key])){const Ge=ae[Re.key].map(et=>Ke==="qa"?typeof et=="object"&&"question"in et?{id:crypto.randomUUID(),question:et.question?.trim()||"",answer:et.answer?.trim()||"",needsAnswer:et.needsAnswer||!1}:{id:crypto.randomUUID(),question:typeof et=="string"?et.trim():"",answer:"",needsAnswer:!0}:{id:crypto.randomUUID(),text:typeof et=="string"?et.trim():et.text||et.question||""});je[Re.key]=[...je[Re.key],...Ge]}}),Y(je),k(de.url),!N.trim()&&de.title&&u(de.title),!v.trim()&&de.summary&&g(de.summary)},Dg=async()=>{gt(!0);try{const ae=await fetch(`/api/ai/generate-title?workspace_id=${p}`,{method:"POST",headers:ks(),body:JSON.stringify({frameworkType:n,data:P,description:v,workspace_id:p})});if(!ae.ok)throw new Error("Failed to generate title");const{title:de}=await ae.json();u(de)}catch(ae){console.error("Failed to generate title:",ae),alert("Failed to generate title. Please try again.")}finally{gt(!1)}},Mg=async()=>{if(["starbursting","dime"].includes(n)){we(!0);try{const ae=await fetch(`/api/ai/generate-questions?workspace_id=${p}`,{method:"POST",headers:ks(),body:JSON.stringify({framework:n,existingData:P,context:v,workspace_id:p})});if(!ae.ok){const je=await ae.json().catch(()=>({error:"Unknown error"}));throw new Error(je.error||"Failed to generate questions")}const{questions:de}=await ae.json();Y(je=>{const Re={...je};return Object.entries(de).forEach(([Ge,et])=>{if(Array.isArray(et)){const mt=et.map(tt=>({id:crypto.randomUUID(),question:tt,answer:"",needsAnswer:!0}));Re[Ge]=[...mt,...je[Ge]||[]]}}),Re})}catch(ae){console.error("Failed to generate questions:",ae),alert(ae instanceof Error?ae.message:"Failed to generate follow-up questions. Please try again.")}finally{we(!1)}}},jd=async()=>{if(Be.trim()){Gt(!0),hr(null);try{if(n==="pmesii-pt"){const ae=await fetch(`/api/frameworks/pmesii-pt/import-url?workspace_id=${p}`,{method:"POST",headers:ks(),body:JSON.stringify({url:Be.trim(),workspace_id:p})});if(!ae.ok)throw new Error("Failed to analyze URL");const{analysis_id:de,url:je,title:Re,dimensions:Ge}=await ae.json(),et={id:crypto.randomUUID(),url:je,title:Re||new URL(je).hostname,analysis_id:de};if(Pe(mt=>[...mt,et]),Ge){const mt={...P};Object.keys(Ge).forEach(tt=>{if(Ge[tt]&&Array.isArray(Ge[tt])){const qg=Ge[tt].map(Ba=>({id:crypto.randomUUID(),question:Ba.question,answer:Ba.answer||"",needsAnswer:!Ba.answer}));mt[tt]=[...mt[tt]||[],...qg]}}),Y(mt)}}else{const ae=await fetch(`/api/content-intelligence/analyze?workspace_id=${p}`,{method:"POST",headers:ks(),body:JSON.stringify({url:Be.trim(),mode:"quick",workspace_id:p})});if(!ae.ok)throw new Error("Failed to analyze URL");const{analysis:de}=await ae.json(),je={id:crypto.randomUUID(),url:Be.trim(),title:de.title||new URL(Be).hostname,analysis_id:de.id};Pe(Re=>[...Re,je]),await $g(de)}Ve("")}catch(ae){console.error("Import error:",ae),hr(ae instanceof Error?ae.message:"Failed to import URL")}finally{Gt(!1)}}},$g=async ae=>{const de={...P},je=[...(ae.entities?.people||[]).slice(0,5),...(ae.entities?.organizations||[]).filter(mt=>mt.name.toLowerCase().includes("government")||mt.name.toLowerCase().includes("party")||mt.name.toLowerCase().includes("ministry"))];if(je.length>0){const mt=je.map(tt=>({id:crypto.randomUUID(),question:`What is the role of ${tt.name}?`,answer:`Mentioned ${tt.count} times in the source. ${tt.contexts?.[0]||""}`,needsAnswer:!tt.contexts?.[0]}));de.political=[...de.political||[],...mt]}const Re=ae.entities?.money||[];if(Re.length>0){const mt=Re.slice(0,3).map(tt=>({id:crypto.randomUUID(),question:`What are the economic implications of ${tt.name}?`,answer:`Referenced ${tt.count} times. ${tt.contexts?.[0]||""}`,needsAnswer:!tt.contexts?.[0]}));de.economic=[...de.economic||[],...mt]}if(ae.summary){const mt={id:crypto.randomUUID(),question:"What are the key social and cultural factors?",answer:ae.summary,needsAnswer:!1};de.social=[...de.social||[],mt]}const Ge=ae.entities?.locations||[];if(Ge.length>0){const mt=Ge.slice(0,5).map(tt=>({id:crypto.randomUUID(),question:`What infrastructure exists in ${tt.name}?`,answer:`Location mentioned ${tt.count} times. ${tt.contexts?.[0]||""}`,needsAnswer:!tt.contexts?.[0]}));de.infrastructure=[...de.infrastructure||[],...mt]}const et=ae.entities?.dates||[];if(et.length>0){const mt=et.slice(0,3).map(tt=>({id:crypto.randomUUID(),question:`What happened on ${tt.name}?`,answer:`Referenced ${tt.count} times. ${tt.contexts?.[0]||""}`,needsAnswer:!tt.contexts?.[0]}));de.time=[...de.time||[],...mt]}Y(de)},Bg=ae=>{Pe(de=>de.filter(je=>je.id!==ae))},zg=()=>{const ae={title:N.trim(),description:v.trim(),source_url:w||void 0,...P,...n==="behavior"&&{location_context:U,behavior_settings:F,temporal_context:j,eligibility:J,complexity:W,com_b_deficits:Se,selected_interventions:We},...n==="comb-analysis"&&{linked_behavior_id:A,linked_behavior_title:z,com_b_deficits:Se,selected_interventions:We}},de=JSON.stringify(ae,null,2),je=new Blob([de],{type:"application/json"}),Re=URL.createObjectURL(je),Ge=document.createElement("a");Ge.href=Re,Ge.download=`${n}_${N.trim()||"untitled"}_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(Ge),Ge.click(),document.body.removeChild(Ge),URL.revokeObjectURL(Re)},Ug=()=>{const ae=[];ae.push(["Section","Item Type","Content","Additional Info"]),ae.push(["Title","text",N,""]),ae.push(["Description","text",v,""]),w&&ae.push(["Source URL","text",w,""]),n==="behavior"&&(U?.specific_locations?.length&&ae.push(["Location","list",U.specific_locations.join("; "),`Scope: ${U.geographic_scope}`]),F?.settings?.length&&ae.push(["Settings","list",F.settings.join(", "),F.setting_details||""]),j?.frequency_pattern&&ae.push(["Frequency","text",j.frequency_pattern,j.timing_notes||""]),ae.push(["Complexity","text",W,""])),s.forEach(et=>{(P[et.key]||[]).forEach(tt=>{Ht(tt)?ae.push([et.label,"Q&A",tt.question,tt.answer||""]):"text"in tt&&ae.push([et.label,"text",tt.text,""])})});const de=ae.map(et=>et.map(mt=>`"${String(mt).replace(/"/g,'""')}"`).join(",")).join(`
`),je=new Blob([de],{type:"text/csv;charset=utf-8;"}),Re=URL.createObjectURL(je),Ge=document.createElement("a");Ge.href=Re,Ge.download=`${n}_${N.trim()||"untitled"}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(Ge),Ge.click(),document.body.removeChild(Ge),URL.revokeObjectURL(Re)},_d=async()=>{if(!N.trim()){h("Please enter a title for your analysis"),alert(`Please enter a title for your ${i} analysis`);return}let ae=!1;if(n==="behavior"){if(ae=!!v.trim()||(U?.specific_locations?.length??0)>0||(F?.settings?.length??0)>0||!!j?.frequency_pattern||!!W||s.some(je=>P[je.key]?.length>0),!ae){h("Please add a description or fill in basic behavior information"),alert("Please add a description or fill in at least one field (location, settings, frequency, etc.)");return}}else if(n==="pmesii-pt"){if(!ne.country.trim()){h("Country is required for PMESII-PT analysis"),alert("Please specify a country for your PMESII-PT analysis. Location context is essential for this framework.");return}if(ae=!!v.trim()||s.some(de=>P[de.key]?.length>0),!ae){h("Please add a description or at least one item to any section"),alert("Please add a description or at least one item before saving");return}}else if(ae=!!v.trim()||s.some(de=>P[de.key]?.length>0),!ae){h("Please add a description or at least one item to any section"),alert("Please add a description or at least one item before saving");return}m(!0),h(null);try{const de={title:N.trim(),description:v.trim(),source_url:w||void 0,...P,...n==="behavior"&&{location_context:U,behavior_settings:F,temporal_context:j,eligibility:J,complexity:W,com_b_deficits:Se,selected_interventions:We},...n==="comb-analysis"&&{linked_behavior_id:A,linked_behavior_title:z,com_b_deficits:Se,selected_interventions:We},...n==="pmesii-pt"&&{location_country:ne.country||void 0,location_region:ne.region||void 0,location_city:ne.city||void 0,time_period_start:ne.time_period_start||void 0,time_period_end:ne.time_period_end||void 0,scope_objectives:ne.scope_objectives||void 0}};n==="pmesii-pt"&&s.forEach(Re=>{O[Re.key]&&O[Re.key].length>0&&(de[`${Re.key}_actors`]=O[Re.key])}),zd.info(`Saving ${n} analysis:`,de),await o(de);const je=`draft_${n}_${a||"new"}`;localStorage.removeItem(je),b(new Date),zd.info(`Successfully saved ${n} analysis`),setTimeout(()=>{c(l)},500)}catch(de){console.error(`Failed to save ${i} analysis:`,de);const je=de instanceof Error?de.message:"Unknown error";h(`Failed to save: ${je}`),alert(`Failed to save ${i} analysis. ${je}

Your data has been auto-saved locally. Please try again or contact support if the issue persists.`)}finally{m(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(te,{variant:"outline",onClick:()=>c(l),children:[e.jsx(Ir,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[t==="create"?"Create":"Edit"," ",i]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:[n," framework analysis"]}),_&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1",children:["âœ“ Saved at ",_.toLocaleTimeString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Om,{framework:n,onExtract:Lg}),cn[n]?.itemType==="qa"&&e.jsx(te,{variant:"outline",onClick:Mg,disabled:be||!v.trim(),title:v.trim()?"Generate questions from your description using AI":"Add a description to generate AI questions",children:be?e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ft,{className:"h-4 w-4 mr-2"}),"Generate Questions"]})}),e.jsx(Lc,{frameworkType:n,frameworkTitle:i,data:{title:N,description:v,...P},variant:"outline"}),e.jsxs(te,{onClick:_d,disabled:d,children:[e.jsx(on,{className:"h-4 w-4 mr-2"}),d?"Saving...":"Save Analysis"]})]})]}),y&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-red-600 dark:text-red-400 mt-0.5",children:"âš ï¸"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-red-800 dark:text-red-200",children:"Save Failed"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:y}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-2",children:"Your data has been auto-saved locally and will be restored if you refresh the page."}),e.jsxs("div",{className:"mt-3 flex gap-2",children:[e.jsxs(te,{variant:"outline",size:"sm",onClick:Ug,className:"border-red-300 text-red-700 hover:bg-red-100 dark:border-red-700 dark:text-red-300 dark:hover:bg-red-900/40",children:[e.jsx(ln,{className:"h-4 w-4 mr-2"}),"Download as CSV"]}),e.jsxs(te,{variant:"outline",size:"sm",onClick:zg,className:"border-red-300 text-red-700 hover:bg-red-100 dark:border-red-700 dark:text-red-300 dark:hover:bg-red-900/40",children:[e.jsx(ix,{className:"h-4 w-4 mr-2"}),"Download as JSON"]})]})]})]})}),n==="behavior"?e.jsx(N0,{title:N,description:v,locationContext:U,behaviorSettings:F,temporalContext:j,eligibility:J,complexity:W,onTitleChange:u,onDescriptionChange:g,onLocationContextChange:G,onBehaviorSettingsChange:C,onTemporalContextChange:D,onEligibilityChange:q,onComplexityChange:$}):e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:"Basic Information"}),e.jsx(Le,{children:"Provide a title and description for your analysis"})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Title *"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ee,{placeholder:`e.g., Q4 2025 ${i} Analysis`,value:N,onChange:ae=>u(ae.target.value),className:"flex-1"}),e.jsx(te,{type:"button",variant:"outline",onClick:Dg,disabled:De||Object.values(P).every(ae=>ae.length===0)&&!v,title:"Generate title using AI",children:De?e.jsx(xt,{className:"h-4 w-4 animate-spin"}):e.jsx(ft,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Description"}),e.jsx($e,{placeholder:"Provide context for this analysis...",value:v,onChange:ae=>g(ae.target.value),rows:3})]})]})]}),["pmesii-pt","dime","dotmlpf","pest"].includes(n)&&e.jsxs(ge,{className:"bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-950/30 dark:to-indigo-950/30 border-blue-200 dark:border-blue-800",children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(rr,{className:"h-5 w-5"}),"Import Sources"]}),e.jsxs(Le,{children:["Import analysis from URLs to auto-populate ",i," dimensions with extracted insights"]})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ee,{placeholder:"https://example.com/article",value:Be,onChange:ae=>Ve(ae.target.value),onKeyPress:ae=>ae.key==="Enter"&&jd(),disabled:zt,className:"flex-1"}),e.jsx(te,{onClick:jd,disabled:zt||!Be.trim(),children:zt?e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"h-4 w-4 mr-2 animate-spin"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(rr,{className:"h-4 w-4 mr-2"}),"Analyze URL"]})})]}),St&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:St})}),Qt.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Imported Sources (",Qt.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Qt.map(ae=>e.jsxs(he,{variant:"secondary",className:"pr-1 gap-1 bg-blue-100 dark:bg-blue-900/40 text-blue-800 dark:text-blue-200",children:[e.jsx("span",{className:"max-w-[200px] truncate",title:ae.url,children:ae.title}),e.jsx(te,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-red-200 dark:hover:bg-red-900",onClick:()=>Bg(ae.id),children:e.jsx(Ze,{className:"h-3 w-3"})})]},ae.id))})]}),e.jsxs("div",{className:"text-xs text-blue-700 dark:text-blue-300 bg-blue-100 dark:bg-blue-900/30 rounded p-3 border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"ðŸ’¡ How it works:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[e.jsx("li",{children:'Enter a URL and click "Analyze URL"'}),e.jsx("li",{children:"Content Intelligence extracts key information"}),e.jsxs("li",{children:["Entities and insights are mapped to ",i," dimensions"]}),e.jsx("li",{children:"Review and edit the auto-generated questions & answers below"})]})]})]})]}),n==="pmesii-pt"&&e.jsx(O0,{value:ne,onChange:ae=>K(ae),suggestedLocations:Qt.length>0?[]:[]}),n==="starbursting"&&e.jsx(F0,{sectionData:P,questionEvidence:ke}),e.jsx("div",{className:`grid grid-cols-1 ${s.length===4?"md:grid-cols-2":"md:grid-cols-1"} gap-6`,children:s.filter(ae=>ae.key!=="basic_info").map(ae=>{if(n==="comb-analysis"&&ae.key==="setup")return e.jsx(k0,{selectedBehaviorId:A,selectedBehaviorTitle:z,onSelect:(de,je)=>{T(de),S(je)},onClear:()=>{T(void 0),S(void 0)}},ae.key);if(n==="behavior"&&ae.key==="timeline"){const de=P[ae.key]||[];return e.jsx(ge,{children:e.jsxs(xe,{className:"pt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Behavior Timeline"}),e.jsx(S0,{formData:{title:N,description:v,location_context:U,behavior_settings:F,temporal_context:j,eligibility:J,complexity:W,timeline:de},existingTimeline:de,onTimelineGenerated:je=>{Y(Re=>({...Re,[ae.key]:je}))}})]}),e.jsx(Km,{events:de,onChange:je=>{Y(Re=>({...Re,[ae.key]:je}))}})]})},ae.key)}if(n==="behavior"&&ae.key==="consequences"){const de=P[ae.key]||[];return e.jsx("div",{children:e.jsx(A0,{consequences:de,onChange:je=>{Y(Re=>({...Re,[ae.key]:je}))}})},ae.key)}if(n==="behavior"&&ae.key==="symbols"){const de=P[ae.key]||[];return e.jsx("div",{children:e.jsx(R0,{symbols:de,onChange:je=>{Y(Re=>({...Re,[ae.key]:je}))}})},ae.key)}return e.jsx(M0,{section:ae,items:P[ae.key],newItem:re[ae.key],newAnswer:Ke==="qa"?se[ae.key]:void 0,setNewItem:de=>le(je=>({...je,[ae.key]:de})),setNewAnswer:Ke==="qa"?de=>R(je=>({...je,[ae.key]:de})):void 0,onAdd:()=>Da(ae.key,re[ae.key]),onRemove:de=>Ma(ae.key,de),onEdit:(de,je)=>_g(ae.key,de,je),linkedEvidence:I[ae.key]||[],onLinkEvidence:()=>kg(ae.key),onRemoveEvidence:de=>Sg(ae.key,de),linkedActors:n==="pmesii-pt"?O[ae.key]||[]:void 0,onLinkActors:n==="pmesii-pt"?()=>Cg(ae.key):void 0,onRemoveActor:n==="pmesii-pt"?de=>Ag(ae.key,de):void 0,frameworkType:n,allData:{title:N,description:v,...P},itemType:Ke,deficitLevel:ae.comBComponent?Se[ae.comBComponent]:void 0,onDeficitChange:ae.comBComponent?de=>ye(je=>({...je,[ae.comBComponent]:de})):void 0,sectionKey:ae.key,onLinkQuestionActors:n==="starbursting"?de=>$a(ae.key,de,"actor"):void 0,onLinkQuestionPlaces:n==="starbursting"?de=>$a(ae.key,de,"place"):void 0,onLinkQuestionEvents:n==="starbursting"?de=>$a(ae.key,de,"event"):void 0,onLinkQuestionEvidence:n==="starbursting"?de=>Og(ae.key,de):void 0,questionEvidence:n==="starbursting"?ke:void 0,onRemoveQuestionEvidence:n==="starbursting"?Pg:void 0},ae.key)})}),n==="behavior"&&e.jsx(Ym,{deficits:Se,selectedInterventions:We,onInterventionSelect:Ot}),e.jsx(Gn,{open:X,onClose:()=>{V(!1),oe(null)},onLink:Ng,alreadyLinked:M?I[M]||[]:[]}),n==="pmesii-pt"&&e.jsx(Bd,{isOpen:L,onClose:()=>{f(!1),oe(null)},selectedActors:M?O[M]||[]:[],onActorsChange:Eg,domainName:M?s.find(ae=>ae.key===M)?.label:void 0}),n==="starbursting"&&e.jsx(Bd,{isOpen:L,onClose:()=>{f(!1),oe(null),E(null)},selectedActors:M&&x?(()=>{const ae=P[M]?.find(de=>de.id===x);return ae&&Ht(ae)&&ae.linked_actors?ae.linked_actors.map(de=>({id:de.id,name:de.name,type:de.type})):[]})():[],onActorsChange:Tg,domainName:'"Who" question'}),n==="starbursting"&&e.jsx(L0,{isOpen:H,onClose:()=>{ee(!1),oe(null),E(null)},selectedPlaces:M&&x?(()=>{const ae=P[M]?.find(de=>de.id===x);return ae&&Ht(ae)&&ae.linked_places?ae.linked_places.map(de=>({id:de.id,name:de.name,place_type:de.place_type,coordinates:{lat:0,lng:0}})):[]})():[],onPlacesChange:Ig,contextLabel:'"Where" question'}),n==="starbursting"&&e.jsx(D0,{isOpen:Z,onClose:()=>{ue(!1),oe(null),E(null)},selectedEvents:M&&x?(()=>{const ae=P[M]?.find(de=>de.id===x);return ae&&Ht(ae)&&ae.linked_events?ae.linked_events.map(de=>({id:de.id,name:de.name,event_type:de.event_type,date_start:de.date_start})):[]})():[],onEventsChange:Rg,contextLabel:'"When" question'}),n==="starbursting"&&e.jsx(Gn,{open:pe,onClose:()=>{ie(!1),oe(null),E(null)},onLink:Fg,alreadyLinked:x?ke[x]||[]:[],title:"Link Evidence to Answer",description:"Select evidence that supports or contradicts this answer"}),n==="behavior"&&e.jsxs(ge,{className:"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800",children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-5 w-5 text-purple-600"}),"Using Your Behavior Analysis"]}),e.jsx(Le,{children:"Understand what happens next with your completed analysis"})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"ðŸ“š Standalone Reference Database"}),e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Your behavior analysis serves as a ",e.jsx("strong",{children:"reference database"})," documenting when, where, and how a behavior occurs. Use it to:"]}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-700 dark:text-gray-300 mt-2 space-y-1 ml-4",children:[e.jsx("li",{children:"Build a library of documented behaviors for your organization"}),e.jsx("li",{children:"Share contextual understanding across teams"}),e.jsx("li",{children:"Reference environmental factors and social context"}),e.jsx("li",{children:"Track behavioral patterns and sequences"})]})]}),e.jsxs("div",{className:"border-t border-purple-200 dark:border-purple-700 pt-4",children:[e.jsx("h4",{className:"font-semibold text-purple-900 dark:text-purple-100 mb-2",children:"ðŸŽ¯ Target-Audience Analysis with COM-B"}),e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["For ",e.jsx("strong",{children:"behavior change interventions"}),", create a ",e.jsx("strong",{children:"COM-B Analysis"})," linked to this behavior:"]}),e.jsxs("ul",{className:"list-disc list-inside text-sm text-gray-700 dark:text-gray-300 mt-2 space-y-1 ml-4",children:[e.jsx("li",{children:"Assess a specific target audience's Capability, Opportunity, and Motivation"}),e.jsx("li",{children:"Identify barriers preventing the behavior"}),e.jsx("li",{children:"Get AI-powered intervention recommendations"}),e.jsx("li",{children:"Design evidence-based behavior change strategies"})]}),e.jsxs("p",{className:"text-sm text-purple-800 dark:text-purple-200 mt-3 bg-purple-100 dark:bg-purple-900/50 p-3 rounded",children:[e.jsx("strong",{children:"ðŸ’¡ Pro Tip:"}),' After saving this analysis, click "Create COM-B Analysis" from the view page to design interventions for specific target audiences.']})]})]})]}),e.jsx(ge,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-blue-200 dark:border-blue-800",children:e.jsx(xe,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:t==="create"?"âœ… Save Your Analysis":"ðŸ’¾ Save Changes"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:t==="create"?"Create your analysis to access it later and create target-audience assessments":"Your changes are auto-saved locally. Click to sync with the server."})]}),e.jsx(te,{onClick:_d,disabled:d,size:"lg",className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700",children:d?e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"h-5 w-5 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(on,{className:"h-5 w-5 mr-2"}),t==="create"?"Save Analysis":"Save Changes"]})})]})})}),e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsx(Ae,{children:"Summary"})}),e.jsx(xe,{children:e.jsx("div",{className:`grid grid-cols-${s.filter(ae=>ae.key!=="basic_info").length} gap-4 text-center`,children:s.filter(ae=>ae.key!=="basic_info").map(ae=>e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:P[ae.key].length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:ae.label})]},ae.key))})})]})]})}function $0({citationId:r,sourceTitle:t,sourceDate:s,sourceAuthor:n,sourceUrl:i,onClick:o,size:l="sm"}){if(!r)return null;const a={sm:"text-xs px-2 py-0.5",md:"text-sm px-2.5 py-1",lg:"text-base px-3 py-1.5"},c={sm:"h-3 w-3",md:"h-4 w-4",lg:"h-5 w-5"},p=()=>e.jsxs("div",{className:"space-y-2 min-w-[250px] max-w-[400px]",children:[e.jsx("div",{className:"font-semibold border-b pb-1",children:"Source Citation"}),t&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Title:"}),e.jsx("div",{className:"text-gray-700 dark:text-gray-300 mt-0.5",children:t})]}),n&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Author:"})," ",n]}),s&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",s]}),i&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"URL:"}),e.jsx("div",{className:"text-blue-600 dark:text-blue-400 truncate mt-0.5 text-xs",children:i})]}),o&&e.jsx("div",{className:"text-xs text-gray-500 pt-2 border-t",children:"Click to view/edit citation"})]}),d=e.jsxs(he,{variant:"outline",className:`${a[l]} flex items-center gap-1 border-blue-300 bg-blue-50 text-blue-700 hover:bg-blue-100 dark:border-blue-700 dark:bg-blue-900/30 dark:text-blue-300 dark:hover:bg-blue-900/50 ${o?"cursor-pointer":""}`,onClick:o,children:[e.jsx(Ki,{className:c[l]}),e.jsx("span",{className:"font-medium",children:"Source"})]});return e.jsx(qt,{children:e.jsxs(Ct,{delayDuration:300,children:[e.jsx(Et,{asChild:!0,children:d}),e.jsx(At,{side:"top",className:"max-w-md",children:p()})]})})}function B0({open:r,onClose:t,onSelect:s,onCreateNew:n}){const[i,o]=B.useState([]),[l,a]=B.useState(""),[c,p]=B.useState([]);B.useEffect(()=>{if(r){const m=xx();o(m.citations)}},[r]),B.useEffect(()=>{const m=yx(i,l);p(m)},[i,l]);const d=m=>{s(m),t()};return e.jsx(wt,{open:r,onOpenChange:t,children:e.jsxs(jt,{className:"max-w-2xl max-h-[80vh]",children:[e.jsxs(_t,{children:[e.jsxs(kt,{className:"flex items-center gap-2",children:[e.jsx(Ki,{className:"h-5 w-5"}),"Select Citation"]}),e.jsx(It,{children:"Choose an existing citation from your library or create a new one"})]}),e.jsxs(Ar,{defaultValue:"existing",className:"w-full",children:[e.jsxs(Tr,{className:"grid w-full grid-cols-2",children:[e.jsxs(Ye,{value:"existing",children:["Existing Citations (",i.length,")"]}),e.jsx(Ye,{value:"new",onClick:n,disabled:!n,children:"Create New"})]}),e.jsxs(pt,{value:"existing",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"search",children:"Search Citations"}),e.jsxs("div",{className:"relative",children:[e.jsx(ir,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Ee,{id:"search",placeholder:"Search by title, author, or URL...",value:l,onChange:m=>a(m.target.value),className:"pl-10"})]})]}),e.jsx(ca,{className:"h-[400px] pr-4",children:c.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:l?e.jsxs(e.Fragment,{children:[e.jsx(ir,{className:"h-12 w-12 mx-auto mb-3 opacity-30"}),e.jsxs("p",{children:['No citations found matching "',l,'"']})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ki,{className:"h-12 w-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"Your citation library is empty"}),e.jsx("p",{className:"text-sm mt-2",children:"Create citations using the Citations Tool"})]})}):e.jsx("div",{className:"space-y-3",children:c.map(m=>{const{citation:y}=bx(m.fields,m.sourceType,"apa");return e.jsx("button",{onClick:()=>d(m),className:"w-full text-left p-4 rounded-lg border border-gray-200 hover:border-blue-400 hover:bg-blue-50 dark:border-gray-700 dark:hover:border-blue-600 dark:hover:bg-blue-900/20 transition-colors",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:m.fields.title}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs text-gray-600 dark:text-gray-400",children:[m.fields.authors&&m.fields.authors.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fi,{className:"h-3 w-3"}),e.jsxs("span",{children:[m.fields.authors[0].lastName,m.fields.authors.length>1&&" et al."]})]}),m.fields.year&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(dr,{className:"h-3 w-3"}),e.jsx("span",{children:m.fields.year})]}),m.fields.url&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ar,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[200px]",children:m.fields.url})]})]}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 p-2 rounded",children:y}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",children:m.sourceType}),e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200",children:m.citationStyle.toUpperCase()})]})]})},m.id)})})})]}),e.jsx(pt,{value:"new"})]}),e.jsx("div",{className:"flex justify-end gap-2 mt-4",children:e.jsx(te,{variant:"outline",onClick:t,children:"Cancel"})})]})})}function z0(r){const t=new Set;return r.filter(s=>{const n=`${s.source_entity_id}-${s.relationship_type}-${s.target_entity_id}`;return t.has(n)?!1:(t.add(n),!0)})}function Zl(r){const t=[];return r.source_entity_id||t.push("Missing source entity"),r.target_entity_id||t.push("Missing target entity"),r.relationship_type||t.push("Missing relationship type"),r.source_entity_id===r.target_entity_id&&t.push("Self-referential relationship not allowed"),r.weight!==void 0&&(r.weight<0||r.weight>1)&&t.push("Weight must be between 0 and 1"),{valid:t.length===0,errors:t}}async function U0(r,t){const s=[];let n=0,i=0;for(let o=0;o<r.length;o++){const l=r[o],a=Zl(l);if(!a.valid){i++,s.push({relationship:l,error:a.errors.join(", ")}),t?.(o+1,r.length,"error");continue}try{const c=await fetch("/api/relationships",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(c.ok)n++,t?.(o+1,r.length,"success");else{const p=await c.json().catch(()=>({message:"Unknown error"}));i++,s.push({relationship:l,error:p.message||`HTTP ${c.status}`}),t?.(o+1,r.length,"error")}}catch(c){i++,s.push({relationship:l,error:c instanceof Error?c.message:"Network error"}),t?.(o+1,r.length,"error")}}return{created:n,failed:i,errors:s}}function q0({open:r,onOpenChange:t,relationships:s,source:n,onComplete:i}){const[o,l]=B.useState([]),[a,c]=B.useState(new Set),[p,d]=B.useState(!1),[m,y]=B.useState({current:0,total:0}),[h,_]=B.useState(null);B.useEffect(()=>{if(r){const A=z0(s);l(A),c(new Set(A.map((T,z)=>z))),_(null),y({current:0,total:0})}},[r,s]);const b=A=>{const T=new Set(a);T.has(A)?T.delete(A):T.add(A),c(T)},N=()=>{c(new Set(o.map((A,T)=>T)))},u=()=>{c(new Set)},v=async()=>{const A=o.filter((T,z)=>a.has(z));if(A.length===0){alert("Please select at least one relationship to generate");return}d(!0),y({current:0,total:A.length});try{const T=await U0(A,(z,S,U)=>{y({current:z,total:S})});_(T),i?.(T.created,T.failed),T.failed===0&&setTimeout(()=>{t(!1)},2e3)}catch(T){console.error("Failed to generate relationships:",T),alert("An error occurred while generating relationships")}finally{d(!1)}},g=()=>({MOM:"bg-blue-100 text-blue-800",COG:"bg-purple-100 text-purple-800",CAUSEWAY:"bg-green-100 text-green-800",MIXED:"bg-gray-100 text-gray-800"})[n],w=A=>{const T={CONFIRMED:"bg-green-100 text-green-800",PROBABLE:"bg-blue-100 text-blue-800",POSSIBLE:"bg-yellow-100 text-yellow-800",SUSPECTED:"bg-orange-100 text-orange-800"};return T[A||"POSSIBLE"]||T.POSSIBLE},k=o.map((A,T)=>({index:T,validation:Zl(A)})).filter(A=>!A.validation.valid);return e.jsx(wt,{open:r,onOpenChange:t,children:e.jsxs(jt,{className:"sm:max-w-3xl max-h-[90vh]",children:[e.jsxs(_t,{children:[e.jsxs(kt,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-5 w-5"}),"Auto-Generate Relationships"]}),e.jsxs(It,{children:["Review and create relationships automatically generated from ",n," framework analysis"]})]}),h?e.jsxs("div",{className:"space-y-4 py-6",children:[e.jsxs("div",{className:"text-center",children:[h.failed===0?e.jsx(jr,{className:"h-16 w-16 text-green-600 mx-auto mb-4"}):e.jsx(Rr,{className:"h-16 w-16 text-yellow-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:h.failed===0?"Success!":"Partially Complete"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:[h.created," relationship",h.created!==1?"s":""," created",h.failed>0&&`, ${h.failed} failed`]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:h.created}),e.jsx("div",{className:"text-sm text-green-700 dark:text-green-300",children:"Created"})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-600",children:h.failed}),e.jsx("div",{className:"text-sm text-red-700 dark:text-red-300",children:"Failed"})]})]}),e.jsx("div",{className:"flex justify-center gap-2 pt-4",children:e.jsx(te,{onClick:()=>t(!1),children:"Close"})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(he,{className:g(),children:[n," Framework"]}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[o.length," relationships found"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{variant:"outline",size:"sm",onClick:N,children:"Select All"}),e.jsx(te,{variant:"outline",size:"sm",onClick:u,children:"Deselect All"})]})]}),k.length>0&&e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Rr,{className:"h-4 w-4 text-yellow-600"}),e.jsxs("span",{className:"text-sm font-semibold text-yellow-800 dark:text-yellow-200",children:[k.length," validation issue(s)"]})]}),e.jsxs("div",{className:"text-xs text-yellow-700 dark:text-yellow-300 space-y-1",children:[k.slice(0,3).map(A=>e.jsxs("div",{children:["Relationship ",A.index+1,": ",A.validation.errors.join(", ")]},A.index)),k.length>3&&e.jsxs("div",{children:["... and ",k.length-3," more"]})]})]}),e.jsx(ca,{className:"h-[400px] border rounded-lg",children:e.jsx("div",{className:"p-4 space-y-2",children:o.map((A,T)=>{const z=Zl(A),S=a.has(T);return e.jsx("div",{className:`border rounded-lg p-3 ${S?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200"} ${z.valid?"":"opacity-50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ts,{checked:S,onCheckedChange:()=>b(T),disabled:!z.valid,className:"mt-1"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:A.source_entity_type}),e.jsx(Kl,{className:"h-3 w-3"}),e.jsx(he,{variant:"outline",className:"text-xs",children:A.relationship_type}),e.jsx(Kl,{className:"h-3 w-3"}),e.jsx("span",{className:"font-medium",children:A.target_entity_type})]}),e.jsx(he,{className:w(A.confidence),children:A.confidence||"POSSIBLE"})]}),A.description&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:A.description}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("span",{children:["Weight: ",((A.weight||.5)*100).toFixed(0),"%"]}),A.start_date&&e.jsxs("span",{children:["Date: ",A.start_date]})]}),!z.valid&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-red-600",children:[e.jsx(pa,{className:"h-3 w-3"}),e.jsx("span",{children:z.errors.join(", ")})]})]})]})},T)})})}),p&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Creating relationships..."}),e.jsxs("span",{children:[m.current," / ",m.total]})]}),e.jsx(Fs,{value:m.current/m.total*100})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(te,{variant:"outline",onClick:()=>t(!1),disabled:p,children:"Cancel"}),e.jsxs(te,{onClick:v,disabled:p||a.size===0,children:[e.jsx(ft,{className:"h-4 w-4 mr-2"}),"Generate ",a.size," Relationship",a.size!==1?"s":""]})]})]})]})})}function Jm({relationships:r,source:t,onComplete:s,disabled:n=!1,variant:i="outline",size:o="default",label:l}){const[a,c]=B.useState(!1),p=r.length,d=(m,y)=>{s?.(m,y)};return e.jsxs(e.Fragment,{children:[e.jsxs(te,{variant:i,size:o,onClick:()=>c(!0),disabled:n||p===0,className:"relative",children:[e.jsx(ft,{className:"h-4 w-4 mr-2"}),l||"Auto-Generate Relationships",p>0&&e.jsx(he,{variant:"secondary",className:"ml-2",children:p})]}),e.jsx(q0,{open:a,onOpenChange:c,relationships:r,source:t,onComplete:d})]})}function W0({locationContext:r,variant:t="secondary",showIcon:s=!0,className:n=""}){const{geographic_scope:i,specific_locations:o}=r,l={local:"ðŸ“",regional:"ðŸ—ºï¸",national:"ðŸ›ï¸",international:"ðŸŒ",global:"ðŸŒ"},a={local:"Local",regional:"Regional",national:"National",international:"International",global:"Global"},c=o&&o.length>0?o.slice(0,2).join(", ")+(o.length>2?"...":""):a[i];return e.jsxs("div",{className:`inline-flex items-center gap-2 ${n}`,children:[s&&e.jsx("span",{className:"text-base",children:l[i]}),e.jsxs(he,{variant:t,className:"gap-1",children:[e.jsx(bs,{className:"h-3 w-3"}),c]}),e.jsx(he,{variant:"outline",className:"text-xs",children:a[i]})]})}const ds=Kn("GenericFrameworkView");function wn(){const r={"Content-Type":"application/json"},t=localStorage.getItem("omnicore_token");t&&(r.Authorization=`Bearer ${t}`);const s=localStorage.getItem("user_hash");return s&&(r["X-User-Hash"]=s),r}function H0({data:r,sections:t,frameworkTitle:s,onEdit:n,onDelete:i,backPath:o}){const l=xr(),{currentWorkspaceId:a}=Kr(),[c,p]=B.useState([]),[d,m]=B.useState(!1),[y,h]=B.useState(!1),[_,b]=B.useState(!1),[N,u]=B.useState("data"),[v,g]=B.useState(!1),[w,k]=B.useState(null),[A,T]=B.useState([]),z=s.toLowerCase().includes("cog")?"cog":s.toLowerCase().includes("causeway")?"causeway":null,S=s.toLowerCase().includes("cog")?"cog":s.toLowerCase().includes("pmesii")?"pmesii-pt":s.toLowerCase().includes("dotmlpf")?"dotmlpf":s.toLowerCase().includes("dime")?"dime":s.toLowerCase().includes("causeway")?"causeway":s.toLowerCase().includes("starbursting")?"starbursting":s.toLowerCase().includes("pest")?"pest":s.toLowerCase().includes("stakeholder")?"stakeholder":s.toLowerCase().includes("com-b")||s.toLowerCase().includes("comb")?"comb-analysis":s.toLowerCase().includes("behavior")?"behavior":"generic",U=cn[S]?.itemType||"text";B.useEffect(()=>{(async()=>{if(r.id)try{const ne=await fetch(`/api/framework-evidence?framework_id=${r.id}&workspace_id=${a}`,{headers:wn()});if(ne.ok){const P=((await ne.json()).links||[]).map(Y=>({entity_type:"data",entity_id:Y.evidence_id,entity_data:{id:Y.evidence_id,title:Y.title,description:Y.description,who:Y.who,what:Y.what,when_occurred:Y.when_occurred,where_location:Y.where_location,evidence_type:Y.evidence_type,evidence_level:Y.evidence_level,priority:Y.priority,status:Y.status,tags:Y.tags},linked_at:Y.created_at}));p(P)}}catch(ne){console.error("Failed to load linked evidence:",ne)}})()},[r.id]),B.useEffect(()=>{if(!z||c.length===0){T([]);return}const $=[];if(z==="cog"){const ne=[...(r.center_of_gravity||[]).map(K=>({...K,type:"CRITICAL_FACTOR"})),...(r.critical_capabilities||[]).map(K=>({...K,type:"CAPABILITY"})),...(r.critical_requirements||[]).map(K=>({...K,type:"REQUIREMENT"})),...(r.critical_vulnerabilities||[]).map(K=>({...K,type:"VULNERABILITY"}))];ds.debug("COG elements for relationship generation:",ne)}else if(z==="causeway"){const ne=[...r.putars||[],...r.proximate_targets||[]];ds.debug("Causeway rows for relationship generation:",ne)}T($)},[c,z,r]);const G=async $=>{if(r.id)try{const ne=$.map(P=>P.entity_id),K=await fetch(`/api/framework-evidence?workspace_id=${a}`,{method:"POST",headers:wn(),body:JSON.stringify({framework_id:r.id,evidence_ids:ne,workspace_id:a})});if(K.ok)p([...c,...$]),ds.info("Evidence linked successfully");else{const P=await K.json();ds.error("Failed to link evidence:",P),alert("Failed to link evidence. Please try again.")}}catch(ne){console.error("Error linking evidence:",ne),alert("An error occurred while linking evidence.")}},F=async($,ne)=>{if(r.id)try{const K=await fetch(`/api/framework-evidence?framework_id=${r.id}&evidence_id=${ne}&workspace_id=${a}`,{method:"DELETE",headers:wn()});if(K.ok)p(c.filter(P=>!(P.entity_type===$&&P.entity_id===ne))),ds.info("Evidence unlinked successfully");else{const P=await K.json();ds.error("Failed to unlink evidence:",P),alert("Failed to unlink evidence. Please try again.")}}catch(K){console.error("Error unlinking evidence:",K),alert("An error occurred while unlinking evidence.")}},C=($,ne)=>{const K={entity_type:$,entity_id:ne.id,entity_data:ne,linked_at:new Date().toISOString()};p([...c,K]),h(!0)},j=$=>{u($),b(!0)},D=($,ne)=>{k({section:$,itemId:ne}),g(!0)},J=async $=>{if(!w||!r.id)return;const{section:ne,itemId:K}=w;try{const P={...r};if(P[ne]&&Array.isArray(P[ne])&&(P[ne]=P[ne].map(re=>re.id===K&&Ht(re)?{...re,citationId:$.id,sourceUrl:$.fields.url,sourceTitle:$.fields.title,sourceDate:`${$.fields.year}-${$.fields.month?.padStart(2,"0")||"01"}-${$.fields.day?.padStart(2,"0")||"01"}`,sourceAuthor:$.fields.authors?.[0]?.lastName||"Unknown"}:re)),!(await fetch(`/api/frameworks?id=${r.id}&workspace_id=${a}`,{method:"PUT",headers:wn(),body:JSON.stringify({title:r.title,description:r.description,data:P,status:r.status||"draft",is_public:r.is_public||!1,workspace_id:a})})).ok)throw new Error("Failed to save citation");window.location.reload()}catch(P){console.error("Error saving citation:",P),alert("Failed to save citation. Please try again.")}finally{g(!1),k(null)}},q=async($,ne)=>{if(!(!confirm("Remove citation from this item?")||!r.id))try{const K={...r};if(K[$]&&Array.isArray(K[$])&&(K[$]=K[$].map(Y=>{if(Y.id===ne&&Ht(Y)){const{citationId:re,sourceUrl:le,sourceTitle:se,sourceDate:R,sourceAuthor:I,...Q}=Y;return Q}return Y})),!(await fetch(`/api/frameworks?id=${r.id}&workspace_id=${a}`,{method:"PUT",headers:wn(),body:JSON.stringify({title:r.title,description:r.description,data:K,status:r.status||"draft",is_public:r.is_public||!1,workspace_id:a})})).ok)throw new Error("Failed to remove citation");window.location.reload()}catch(K){console.error("Error removing citation:",K),alert("Failed to remove citation. Please try again.")}},W=({section:$,items:ne,sectionKey:K})=>e.jsxs(ge,{className:`border-l-4 ${$.color}`,children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:$.icon}),$.label,e.jsx(he,{variant:"secondary",className:"ml-auto",children:ne.length})]})}),e.jsx(xe,{children:ne.length===0?e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-8",children:["No ",$.label.toLowerCase()," identified"]}):e.jsx("ul",{className:"space-y-2",children:ne.map((P,Y)=>e.jsx("li",{className:`p-3 rounded-lg ${$.bgColor} text-sm`,children:U==="qa"&&Ht(P)?e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[Y+1,"."]})," Q: ",P.question]}),e.jsxs("div",{className:"text-gray-700 dark:text-gray-300 ml-5",children:["A: ",P.answer||e.jsx("span",{className:"italic text-gray-500 dark:text-gray-400",children:"No answer provided"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[P.citationId&&e.jsx($0,{citationId:P.citationId,sourceTitle:P.sourceTitle,sourceDate:P.sourceDate,sourceAuthor:P.sourceAuthor,sourceUrl:P.sourceUrl,size:"sm"}),e.jsxs(Ur,{children:[e.jsx(qr,{asChild:!0,children:e.jsx(te,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:e.jsx(gn,{className:"h-4 w-4"})})}),e.jsx(Wr,{align:"end",children:P.citationId?e.jsxs(e.Fragment,{children:[e.jsxs(rt,{onClick:()=>D(K,P.id),children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"}),"Change Citation"]}),e.jsxs(rt,{onClick:()=>q(K,P.id),className:"text-red-600 dark:text-red-400",children:[e.jsx(ax,{className:"h-4 w-4 mr-2"}),"Remove Citation"]})]}):e.jsxs(rt,{onClick:()=>D(K,P.id),children:[e.jsx(Ki,{className:"h-4 w-4 mr-2"}),"Add Citation"]})})]})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:[Y+1,"."]})," ","text"in P?P.text:P.question||""]})},P.id))})})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(te,{variant:"outline",onClick:()=>l(o),children:[e.jsx(Ir,{className:"h-4 w-4 mr-2"}),"Back to List"]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.title}),e.jsx(Hm,{linkedEvidence:c,onClick:()=>h(!y),showBreakdown:!0,size:"lg"}),S==="behavior"&&r.location_context&&e.jsx(W0,{locationContext:r.location_context})]}),r.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:r.description})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ur,{children:[e.jsx(qr,{asChild:!0,children:e.jsxs(te,{variant:"outline",children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),"Create Entity"]})}),e.jsxs(Wr,{align:"end",children:[e.jsx(rt,{onClick:()=>j("data"),children:"Create Data"}),e.jsx(rt,{onClick:()=>j("actor"),children:"Create Actor"}),e.jsx(rt,{onClick:()=>j("source"),children:"Create Source"}),e.jsx(rt,{onClick:()=>j("event"),children:"Create Event"})]})]}),e.jsxs(te,{variant:"outline",onClick:()=>m(!0),children:[e.jsx(rr,{className:"h-4 w-4 mr-2"}),"Link Evidence"]}),z&&e.jsx(Jm,{relationships:A,source:z==="cog"?"COG":"CAUSEWAY",onComplete:($,ne)=>{ds.info(`Created ${$} relationships, ${ne} failed`)},label:"Generate Relationships",variant:"outline",size:"default",disabled:A.length===0}),e.jsxs(te,{variant:"outline",onClick:async()=>{const $=[];for(const K of c)if(K.entity_type==="actor")$.push(K.entity_id.toString());else if(K.entity_type==="source")$.push(K.entity_id.toString());else if(K.entity_type==="event")$.push(K.entity_id.toString());else if(K.entity_type==="data")try{const P=await fetch(`/api/evidence-items?id=${K.entity_id}`);if(P.ok){const Y=await P.json();Y.linked_actors&&Array.isArray(Y.linked_actors)&&$.push(...Y.linked_actors)}}catch(P){ds.error("Error fetching evidence actors:",P)}const ne=[...new Set($)];l("/dashboard/network-graph",{state:{highlightEntities:ne,source:S,title:r.title}})},children:[e.jsx(ma,{className:"h-4 w-4 mr-2"}),"View in Network"]}),e.jsx(wa,{frameworkId:r.id,frameworkType:S,isPublic:r.is_public||!1,shareToken:r.share_token}),e.jsx(Lc,{frameworkType:S,frameworkTitle:s,data:r,analysisId:r.id.toString()}),e.jsxs(te,{variant:"outline",onClick:n,children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(te,{variant:"destructive",onClick:i,children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),(r.created_at||r.updated_at||r.source_url)&&e.jsx(ge,{children:e.jsx(xe,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex gap-6 text-sm text-gray-600 dark:text-gray-400",children:[r.created_at&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Created:"})," ",new Date(r.created_at).toLocaleDateString()]}),r.updated_at&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Last Updated:"})," ",new Date(r.updated_at).toLocaleDateString()]})]}),r.source_url&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"Source:"}),e.jsxs("a",{href:r.source_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 hover:underline flex items-center gap-1",children:[e.jsx(ar,{className:"h-3 w-3"}),r.source_url]})]})]})})}),e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsx(Ae,{children:"Analysis Summary"})}),e.jsx(xe,{children:e.jsx("div",{className:`grid grid-cols-${t.length} gap-4 text-center`,children:t.map($=>e.jsxs("div",{className:`p-4 rounded-lg ${$.bgColor}`,children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:r[$.key]?.length||0}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:$.label})]},$.key))})})]}),S==="stakeholder"&&e.jsxs(ge,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ“‹"}),"Engagement Strategy Summary"]})}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-red-700 dark:text-red-400",children:"ðŸŽ¯ Priority Actions (Key Players)"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{children:["â€¢ Schedule regular 1-on-1 meetings (",r.high_power_high_interest?.length||0," stakeholders)"]}),e.jsx("li",{children:"â€¢ Involve in major decision points"}),e.jsx("li",{children:"â€¢ Build strong personal relationships"}),e.jsx("li",{children:"â€¢ Seek input on strategy and direction"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-orange-700 dark:text-orange-400",children:"ðŸ¤ Maintain Satisfaction"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{children:["â€¢ Send monthly progress updates (",r.high_power_low_interest?.length||0," stakeholders)"]}),e.jsx("li",{children:"â€¢ Address concerns proactively"}),e.jsx("li",{children:"â€¢ Keep satisfied but don't over-engage"}),e.jsx("li",{children:"â€¢ Monitor for changes in interest level"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-blue-700 dark:text-blue-400",children:"ðŸ“¢ Communication Plan"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{children:["â€¢ Regular newsletters/updates (",r.low_power_high_interest?.length||0," stakeholders)"]}),e.jsx("li",{children:"â€¢ Leverage as advocates and champions"}),e.jsx("li",{children:"â€¢ Consult on relevant issues"}),e.jsx("li",{children:"â€¢ Build grassroots support"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-gray-700 dark:text-gray-400",children:"ðŸ‘€ Monitor & Watch"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{children:["â€¢ Periodic updates only (",r.low_power_low_interest?.length||0," stakeholders)"]}),e.jsx("li",{children:"â€¢ Minimal engagement effort"}),e.jsx("li",{children:"â€¢ Watch for status changes"}),e.jsx("li",{children:"â€¢ Include in broad communications"})]})]})]}),e.jsx("div",{className:"pt-4 border-t border-blue-300 dark:border-blue-700",children:e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("strong",{children:"Total Stakeholders:"})," ",(r.high_power_high_interest?.length||0)+(r.high_power_low_interest?.length||0)+(r.low_power_high_interest?.length||0)+(r.low_power_low_interest?.length||0)," â€¢ ",e.jsx("strong",{children:"High Priority:"})," ",(r.high_power_high_interest?.length||0)+(r.high_power_low_interest?.length||0)," stakeholders requiring active management"]})})]})]}),e.jsx("div",{className:`grid grid-cols-1 ${t.length===4?"md:grid-cols-2":"md:grid-cols-1"} gap-6`,children:t.map($=>{if(S==="behavior"&&$.key==="timeline"){const ne=r[$.key]||[];return e.jsx(ge,{children:e.jsx(xe,{className:"pt-6",children:e.jsx(Km,{events:ne,onChange:()=>{},readOnly:!0})})},$.key)}return e.jsx(W,{section:$,items:r[$.key]||[],sectionKey:$.key},$.key)})}),S==="comb-analysis"&&r.com_b_deficits&&e.jsx(Ym,{deficits:r.com_b_deficits,selectedInterventions:r.selected_interventions||[],readOnly:!0}),S==="behavior"&&e.jsxs(ge,{className:"bg-purple-50 dark:bg-purple-900/20 border-purple-200 dark:border-purple-800",children:[e.jsx(Ce,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŽ¯"}),"COM-B Analyses"]}),e.jsx(Le,{className:"mt-2",children:"Target-audience-specific assessments using the COM-B model (Capability, Opportunity, Motivation â†’ Behavior)"})]}),e.jsxs(te,{onClick:()=>{const $=`/dashboard/analysis-frameworks/comb-analysis/create?behavior_id=${r.id}&behavior_title=${encodeURIComponent(s)}`;window.open($,"_blank")},className:"bg-purple-600 hover:bg-purple-700",children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),"Create COM-B Analysis"]})]})}),e.jsxs(xe,{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Create target-audience-specific COM-B analyses for this behavior. Each analysis evaluates one audience's Capability, Opportunity, and Motivation to perform this behavior and generates evidence-based intervention recommendations."}),e.jsx("div",{className:"bg-white dark:bg-gray-800 border rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:"COM-B analyses linked to this behavior will appear here once created."})})]})]}),e.jsx(Vm,{open:_,onClose:()=>b(!1),onEntityCreated:C,defaultTab:N,frameworkContext:{frameworkType:s,frameworkId:r.id?.toString()}}),e.jsx(Gn,{open:d,onClose:()=>m(!1),onLink:G,alreadyLinked:c,title:`Link Evidence to ${s}`,description:"Select evidence items to support this analysis"}),y&&e.jsx("div",{className:"fixed right-0 top-0 h-screen w-96 z-50",children:e.jsx(Gm,{linkedEvidence:c,onUnlink:F,onClose:()=>h(!1),title:"Linked Evidence"})}),e.jsx(va,{entityType:"framework",entityId:r.id}),e.jsx(B0,{open:v,onClose:()=>{g(!1),k(null)},onSelect:J,onCreateNew:()=>{window.open("/dashboard/tools/citations-generator","_blank")}})]})}const bt={motive:{levels:[{value:0,label:"None",description:"No apparent motive"},{value:1,label:"Weak",description:"Minor benefits from deception"},{value:2,label:"Moderate",description:"Some strategic advantage"},{value:3,label:"Strong",description:"Significant political/military gain"},{value:4,label:"Very Strong",description:"Critical to regime survival/objectives"},{value:5,label:"Critical",description:"Existential threat if truth known"}]},opportunity:{levels:[{value:0,label:"None",description:"No access to our information sources"},{value:1,label:"Minimal",description:"Limited ability to influence"},{value:2,label:"Moderate",description:"Some control over information flow"},{value:3,label:"Strong",description:"Controls key information channels"},{value:4,label:"Extensive",description:"Broad control with few checks"},{value:5,label:"Total",description:"Complete information monopoly"}]},means:{levels:[{value:0,label:"None",description:"No demonstrated capability"},{value:1,label:"Basic",description:"Simple denial/misrepresentation"},{value:2,label:"Moderate",description:"Coordinated messaging capability"},{value:3,label:"Advanced",description:"Sophisticated propaganda apparatus"},{value:4,label:"Highly Developed",description:"State-level deception infrastructure"},{value:5,label:"Elite",description:"World-class maskirovka/denial-deception"}]},historicalPattern:{levels:[{value:0,label:"Never",description:"No history of deception"},{value:1,label:"Rarely",description:"1-2 incidents over many years"},{value:2,label:"Occasionally",description:"Several documented cases"},{value:3,label:"Frequently",description:"Regular pattern established"},{value:4,label:"Routinely",description:"Standard operating procedure"},{value:5,label:"Systematically",description:"Core doctrine/strategy"}]},sophisticationLevel:{levels:[{value:0,label:"N/A",description:"No past deceptions"},{value:1,label:"Crude",description:"Simple lies, easily detected"},{value:2,label:"Basic",description:"Some planning, moderate success"},{value:3,label:"Skillful",description:"Well-planned, multi-layered"},{value:4,label:"Advanced",description:"Highly sophisticated operations"},{value:5,label:"Masterful",description:"State-of-the-art tradecraft"}]},successRate:{levels:[{value:0,label:"N/A",description:"No past attempts"},{value:1,label:"Rarely Successful",description:"<20% success rate"},{value:2,label:"Sometimes Successful",description:"20-40% success"},{value:3,label:"Often Successful",description:"40-60% success"},{value:4,label:"Usually Successful",description:"60-80% success"},{value:5,label:"Consistently Successful",description:">80% success"}]},sourceVulnerability:{levels:[{value:0,label:"None",description:"Completely independent sources"},{value:1,label:"Low",description:"Multiple independent channels"},{value:2,label:"Moderate",description:"Some shared dependencies"},{value:3,label:"Significant",description:"Limited independent validation"},{value:4,label:"High",description:"Heavy reliance on few sources"},{value:5,label:"Extreme",description:"Single source or controlled channels"}]},manipulationEvidence:{levels:[{value:0,label:"None",description:"No indicators of manipulation"},{value:1,label:"Minimal",description:"Very weak indicators"},{value:2,label:"Some",description:"Suspicious but inconclusive"},{value:3,label:"Moderate",description:"Multiple suspicious indicators"},{value:4,label:"Strong",description:"Clear signs of manipulation"},{value:5,label:"Definitive",description:"Proven source compromise"}]},internalConsistency:{levels:[{value:5,label:"Highly Consistent",description:"All elements align perfectly"},{value:4,label:"Mostly Consistent",description:"Minor discrepancies only"},{value:3,label:"Moderately Consistent",description:"Some contradictions present"},{value:2,label:"Largely Inconsistent",description:"Major contradictions"},{value:1,label:"Highly Inconsistent",description:"Severe contradictions"},{value:0,label:"Contradictory",description:"Evidence contradicts itself"}]},externalCorroboration:{levels:[{value:5,label:"Fully Corroborated",description:"Multiple independent sources agree"},{value:4,label:"Largely Corroborated",description:"Most key points confirmed"},{value:3,label:"Partially Corroborated",description:"Some confirmation exists"},{value:2,label:"Minimally Corroborated",description:"Little independent confirmation"},{value:1,label:"Uncorroborated",description:"No independent sources"},{value:0,label:"Contradicted",description:"Independent sources disagree"}]},anomalyDetection:{levels:[{value:0,label:"None",description:"No anomalies detected"},{value:1,label:"Minor",description:"Slight irregularities"},{value:2,label:"Moderate",description:"Notable inconsistencies"},{value:3,label:"Significant",description:"Multiple red flags"},{value:4,label:"Major",description:"Serious anomalies present"},{value:5,label:"Critical",description:"Glaring impossibilities/contradictions"}]}},yr={mom:.3,pop:.25,moses:.25,eve:.2};function Gr(r){const t={motive:r.motive??0,opportunity:r.opportunity??0,means:r.means??0,historicalPattern:r.historicalPattern??0,sophisticationLevel:r.sophisticationLevel??0,successRate:r.successRate??0,sourceVulnerability:r.sourceVulnerability??0,manipulationEvidence:r.manipulationEvidence??0,internalConsistency:r.internalConsistency??0,externalCorroboration:r.externalCorroboration??0,anomalyDetection:r.anomalyDetection??0},s=(t.motive+t.opportunity+t.means)/3,n=(t.historicalPattern+t.sophisticationLevel+t.successRate)/3,i=(t.sourceVulnerability+t.manipulationEvidence)/2,o=(5-t.internalConsistency+(5-t.externalCorroboration)+t.anomalyDetection)/3,l={mom:s,pop:n,moses:i,eve:o},a=s*yr.mom+n*yr.pop+i*yr.moses+o*yr.eve,c=Math.round(a/5*100),p=Object.values(t).filter(h=>h>0).length,d=p>=10?"VERY_HIGH":p>=8?"HIGH":p>=6?"MODERATE":p>=4?"LOW":"VERY_LOW",m=c>=80?"CRITICAL":c>=60?"HIGH":c>=40?"MEDIUM":c>=20?"LOW":"MINIMAL",y=[{category:"MOM (Motive, Opportunity, Means)",score:s,weight:yr.mom,contribution:s*yr.mom,description:G0(s)},{category:"POP (Patterns of Practice)",score:n,weight:yr.pop,contribution:n*yr.pop,description:V0(n)},{category:"MOSES (My Own Sources)",score:i,weight:yr.moses,contribution:i*yr.moses,description:K0(i)},{category:"EVE (Evaluation of Evidence)",score:o,weight:yr.eve,contribution:o*yr.eve,description:X0(o)}];return{scores:t,overallLikelihood:c,confidenceLevel:d,riskLevel:m,categoryScores:l,breakdown:y}}function G0(r){return r>=4?"Adversary has strong capability and incentive to deceive":r>=3?"Adversary has moderate deception capability":r>=2?"Some deception capability exists":r>=1?"Limited deception capability":"Minimal or no deception capability"}function V0(r){return r>=4?"Strong historical pattern of sophisticated deception":r>=3?"Established pattern of successful deception":r>=2?"Some history of deception attempts":r>=1?"Limited deception history":"No significant deception history"}function K0(r){return r>=4?"Sources highly vulnerable to manipulation":r>=3?"Significant source vulnerability exists":r>=2?"Moderate source vulnerability":r>=1?"Some source vulnerability":"Sources appear secure"}function X0(r){return r>=4?"Evidence shows major inconsistencies and anomalies":r>=3?"Evidence has significant quality issues":r>=2?"Some evidence quality concerns":r>=1?"Minor evidence issues":"Evidence appears sound and well-corroborated"}function qd(r){switch(r){case"CRITICAL":return"text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20";case"HIGH":return"text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/20";case"MEDIUM":return"text-yellow-600 dark:text-yellow-400 bg-yellow-50 dark:bg-yellow-900/20";case"LOW":return"text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20";case"MINIMAL":return"text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/20"}}function Y0(r){switch(r){case"VERY_HIGH":return"text-green-600 dark:text-green-400";case"HIGH":return"text-blue-600 dark:text-blue-400";case"MODERATE":return"text-yellow-600 dark:text-yellow-400";case"LOW":return"text-orange-600 dark:text-orange-400";case"VERY_LOW":return"text-red-600 dark:text-red-400"}}function J0(r){const t=[],s=[],{scores:n}=r;return n.motive>=4&&t.push(`Strong motive: ${bt.motive.levels[n.motive].description}`),n.opportunity>=4&&t.push(`High opportunity: ${bt.opportunity.levels[n.opportunity].description}`),n.means>=4&&t.push(`Advanced capabilities: ${bt.means.levels[n.means].description}`),n.historicalPattern>=4&&t.push(`Routine deception pattern: ${bt.historicalPattern.levels[n.historicalPattern].description}`),n.sophisticationLevel>=4&&t.push(`Highly sophisticated operations: ${bt.sophisticationLevel.levels[n.sophisticationLevel].description}`),n.successRate>=4&&t.push(`High success rate: ${bt.successRate.levels[n.successRate].description}`),n.sourceVulnerability>=4&&t.push(`Sources highly vulnerable: ${bt.sourceVulnerability.levels[n.sourceVulnerability].description}`),n.manipulationEvidence>=3&&t.push(`Manipulation signs: ${bt.manipulationEvidence.levels[n.manipulationEvidence].description}`),n.internalConsistency<=1&&t.push(`Evidence highly inconsistent: ${bt.internalConsistency.levels[n.internalConsistency].description}`),n.externalCorroboration<=1&&t.push(`No corroboration: ${bt.externalCorroboration.levels[n.externalCorroboration].description}`),n.anomalyDetection>=4&&t.push(`Major anomalies: ${bt.anomalyDetection.levels[n.anomalyDetection].description}`),n.motive<=1&&s.push("Weak or no motive to deceive"),n.historicalPattern<=1&&s.push("No significant deception history"),n.sourceVulnerability<=1&&s.push("Independent, secure sources"),n.internalConsistency>=4&&s.push("Evidence highly consistent"),n.externalCorroboration>=4&&s.push("Strong independent corroboration"),n.anomalyDetection<=1&&s.push("No significant anomalies detected"),{deceptionIndicators:t,counterIndicators:s}}function He(r,t,s,n,i){if(typeof t=="function"?r!==t||!0:!t.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(r,s),s}function me(r,t,s,n){if(s==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?r!==t||!n:!t.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return s==="m"?n:s==="a"?n.call(r):n?n.value:t.get(r)}let Qm=function(){const{crypto:r}=globalThis;if(r?.randomUUID)return Qm=r.randomUUID.bind(r),r.randomUUID();const t=new Uint8Array(1),s=r?()=>r.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^s()&15>>+n/4).toString(16))};function ec(r){return typeof r=="object"&&r!==null&&("name"in r&&r.name==="AbortError"||"message"in r&&String(r.message).includes("FetchRequestCanceledException"))}const tc=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null){try{if(Object.prototype.toString.call(r)==="[object Error]"){const t=new Error(r.message,r.cause?{cause:r.cause}:{});return r.stack&&(t.stack=r.stack),r.cause&&!t.cause&&(t.cause=r.cause),r.name&&(t.name=r.name),t}}catch{}try{return new Error(JSON.stringify(r))}catch{}}return new Error(r)};class Me extends Error{}class Jt extends Me{constructor(t,s,n,i){super(`${Jt.makeMessage(t,s,n)}`),this.status=t,this.headers=i,this.requestID=i?.get("x-request-id"),this.error=s;const o=s;this.code=o?.code,this.param=o?.param,this.type=o?.type}static makeMessage(t,s,n){const i=s?.message?typeof s.message=="string"?s.message:JSON.stringify(s.message):s?JSON.stringify(s):n;return t&&i?`${t} ${i}`:t?`${t} status code (no body)`:i||"(no status code or body)"}static generate(t,s,n,i){if(!t||!i)return new ja({message:n,cause:tc(s)});const o=s?.error;return t===400?new Zm(t,o,n,i):t===401?new ep(t,o,n,i):t===403?new tp(t,o,n,i):t===404?new rp(t,o,n,i):t===409?new sp(t,o,n,i):t===422?new np(t,o,n,i):t===429?new ip(t,o,n,i):t>=500?new ap(t,o,n,i):new Jt(t,o,n,i)}}class vr extends Jt{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class ja extends Jt{constructor({message:t,cause:s}){super(void 0,void 0,t||"Connection error.",void 0),s&&(this.cause=s)}}class Dc extends ja{constructor({message:t}={}){super({message:t??"Request timed out."})}}class Zm extends Jt{}class ep extends Jt{}class tp extends Jt{}class rp extends Jt{}class sp extends Jt{}class np extends Jt{}class ip extends Jt{}class ap extends Jt{}class op extends Me{constructor(){super("Could not parse response content as the length limit was reached")}}class lp extends Me{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class An extends Error{constructor(t){super(t)}}const Q0=/^[a-z][a-z0-9+.-]*:/i,Z0=r=>Q0.test(r);let lr=r=>(lr=Array.isArray,lr(r)),Wd=lr;function cp(r){return typeof r!="object"?{}:r??{}}function ey(r){if(!r)return!0;for(const t in r)return!1;return!0}function ty(r,t){return Object.prototype.hasOwnProperty.call(r,t)}function Ga(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}const ry=(r,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new Me(`${r} must be an integer`);if(t<0)throw new Me(`${r} must be a positive integer`);return t},sy=r=>{try{return JSON.parse(r)}catch{return}},Qn=r=>new Promise(t=>setTimeout(t,r)),Ys="6.0.0",ny=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function iy(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const ay=()=>{const r=iy();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ys,"X-Stainless-OS":Gd(Deno.build.os),"X-Stainless-Arch":Hd(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ys,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ys,"X-Stainless-OS":Gd(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Hd(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const t=oy();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ys,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ys,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function oy(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:s}of r){const n=s.exec(navigator.userAgent);if(n){const i=n[1]||0,o=n[2]||0,l=n[3]||0;return{browser:t,version:`${i}.${o}.${l}`}}}return null}const Hd=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",Gd=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let Vd;const ly=()=>Vd??(Vd=ay());function cy(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function dp(...r){const t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...r)}function up(r){let t=Symbol.asyncIterator in r?r[Symbol.asyncIterator]():r[Symbol.iterator]();return dp({start(){},async pull(s){const{done:n,value:i}=await t.next();n?s.close():s.enqueue(i)},async cancel(){await t.return?.()}})}function hp(r){if(r[Symbol.asyncIterator])return r;const t=r.getReader();return{async next(){try{const s=await t.read();return s?.done&&t.releaseLock(),s}catch(s){throw t.releaseLock(),s}},async return(){const s=t.cancel();return t.releaseLock(),await s,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function dy(r){if(r===null||typeof r!="object")return;if(r[Symbol.asyncIterator]){await r[Symbol.asyncIterator]().return?.();return}const t=r.getReader(),s=t.cancel();t.releaseLock(),await s}const uy=({headers:r,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),mp="RFC3986",pp=r=>String(r),Kd={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:pp},hy="RFC1738";let rc=(r,t)=>(rc=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),rc(r,t));const Fr=(()=>{const r=[];for(let t=0;t<256;++t)r.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return r})(),Va=1024,my=(r,t,s,n,i)=>{if(r.length===0)return r;let o=r;if(typeof r=="symbol"?o=Symbol.prototype.toString.call(r):typeof r!="string"&&(o=String(r)),s==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});let l="";for(let a=0;a<o.length;a+=Va){const c=o.length>=Va?o.slice(a,a+Va):o,p=[];for(let d=0;d<c.length;++d){let m=c.charCodeAt(d);if(m===45||m===46||m===95||m===126||m>=48&&m<=57||m>=65&&m<=90||m>=97&&m<=122||i===hy&&(m===40||m===41)){p[p.length]=c.charAt(d);continue}if(m<128){p[p.length]=Fr[m];continue}if(m<2048){p[p.length]=Fr[192|m>>6]+Fr[128|m&63];continue}if(m<55296||m>=57344){p[p.length]=Fr[224|m>>12]+Fr[128|m>>6&63]+Fr[128|m&63];continue}d+=1,m=65536+((m&1023)<<10|c.charCodeAt(d)&1023),p[p.length]=Fr[240|m>>18]+Fr[128|m>>12&63]+Fr[128|m>>6&63]+Fr[128|m&63]}l+=p.join("")}return l};function py(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function Xd(r,t){if(lr(r)){const s=[];for(let n=0;n<r.length;n+=1)s.push(t(r[n]));return s}return t(r)}const fp={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,t){return String(r)+"["+t+"]"},repeat(r){return String(r)}},gp=function(r,t){Array.prototype.push.apply(r,lr(t)?t:[t])};let Yd;const Lt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:my,encodeValuesOnly:!1,format:mp,formatter:pp,indices:!1,serializeDate(r){return(Yd??(Yd=Function.prototype.call.bind(Date.prototype.toISOString)))(r)},skipNulls:!1,strictNullHandling:!1};function fy(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}const Ka={};function xp(r,t,s,n,i,o,l,a,c,p,d,m,y,h,_,b,N,u){let v=r,g=u,w=0,k=!1;for(;(g=g.get(Ka))!==void 0&&!k;){const U=g.get(r);if(w+=1,typeof U<"u"){if(U===w)throw new RangeError("Cyclic object value");k=!0}typeof g.get(Ka)>"u"&&(w=0)}if(typeof p=="function"?v=p(t,v):v instanceof Date?v=y?.(v):s==="comma"&&lr(v)&&(v=Xd(v,function(U){return U instanceof Date?y?.(U):U})),v===null){if(o)return c&&!b?c(t,Lt.encoder,N,"key",h):t;v=""}if(fy(v)||py(v)){if(c){const U=b?t:c(t,Lt.encoder,N,"key",h);return[_?.(U)+"="+_?.(c(v,Lt.encoder,N,"value",h))]}return[_?.(t)+"="+_?.(String(v))]}const A=[];if(typeof v>"u")return A;let T;if(s==="comma"&&lr(v))b&&c&&(v=Xd(v,c)),T=[{value:v.length>0?v.join(",")||null:void 0}];else if(lr(p))T=p;else{const U=Object.keys(v);T=d?U.sort(d):U}const z=a?String(t).replace(/\./g,"%2E"):String(t),S=n&&lr(v)&&v.length===1?z+"[]":z;if(i&&lr(v)&&v.length===0)return S+"[]";for(let U=0;U<T.length;++U){const G=T[U],F=typeof G=="object"&&typeof G.value<"u"?G.value:v[G];if(l&&F===null)continue;const C=m&&a?G.replace(/\./g,"%2E"):G,j=lr(v)?typeof s=="function"?s(S,C):S:S+(m?"."+C:"["+C+"]");u.set(r,w);const D=new WeakMap;D.set(Ka,u),gp(A,xp(F,j,s,n,i,o,l,a,s==="comma"&&b&&lr(v)?null:c,p,d,m,y,h,_,b,N,D))}return A}function gy(r=Lt){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");const t=r.charset||Lt.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let s=mp;if(typeof r.format<"u"){if(!rc(Kd,r.format))throw new TypeError("Unknown format option provided.");s=r.format}const n=Kd[s];let i=Lt.filter;(typeof r.filter=="function"||lr(r.filter))&&(i=r.filter);let o;if(r.arrayFormat&&r.arrayFormat in fp?o=r.arrayFormat:"indices"in r?o=r.indices?"indices":"repeat":o=Lt.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const l=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:Lt.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:Lt.addQueryPrefix,allowDots:l,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:Lt.allowEmptyArrays,arrayFormat:o,charset:t,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:Lt.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?Lt.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:Lt.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:Lt.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:Lt.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:Lt.encodeValuesOnly,filter:i,format:s,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:Lt.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:Lt.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:Lt.strictNullHandling}}function xy(r,t={}){let s=r;const n=gy(t);let i,o;typeof n.filter=="function"?(o=n.filter,s=o("",s)):lr(n.filter)&&(o=n.filter,i=o);const l=[];if(typeof s!="object"||s===null)return"";const a=fp[n.arrayFormat],c=a==="comma"&&n.commaRoundTrip;i||(i=Object.keys(s)),n.sort&&i.sort(n.sort);const p=new WeakMap;for(let y=0;y<i.length;++y){const h=i[y];n.skipNulls&&s[h]===null||gp(l,xp(s[h],h,a,c,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,p))}const d=l.join(n.delimiter);let m=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?m+="utf8=%26%2310003%3B&":m+="utf8=%E2%9C%93&"),d.length>0?m+d:""}function yy(r){let t=0;for(const i of r)t+=i.length;const s=new Uint8Array(t);let n=0;for(const i of r)s.set(i,n),n+=i.length;return s}let Jd;function Mc(r){let t;return(Jd??(t=new globalThis.TextEncoder,Jd=t.encode.bind(t)))(r)}let Qd;function Zd(r){let t;return(Qd??(t=new globalThis.TextDecoder,Qd=t.decode.bind(t)))(r)}var mr,pr;class _a{constructor(){mr.set(this,void 0),pr.set(this,void 0),He(this,mr,new Uint8Array),He(this,pr,null)}decode(t){if(t==null)return[];const s=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?Mc(t):t;He(this,mr,yy([me(this,mr,"f"),s]));const n=[];let i;for(;(i=by(me(this,mr,"f"),me(this,pr,"f")))!=null;){if(i.carriage&&me(this,pr,"f")==null){He(this,pr,i.index);continue}if(me(this,pr,"f")!=null&&(i.index!==me(this,pr,"f")+1||i.carriage)){n.push(Zd(me(this,mr,"f").subarray(0,me(this,pr,"f")-1))),He(this,mr,me(this,mr,"f").subarray(me(this,pr,"f"))),He(this,pr,null);continue}const o=me(this,pr,"f")!==null?i.preceding-1:i.preceding,l=Zd(me(this,mr,"f").subarray(0,o));n.push(l),He(this,mr,me(this,mr,"f").subarray(i.index)),He(this,pr,null)}return n}flush(){return me(this,mr,"f").length?this.decode(`
`):[]}}mr=new WeakMap,pr=new WeakMap;_a.NEWLINE_CHARS=new Set([`
`,"\r"]);_a.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function by(r,t){for(let i=t??0;i<r.length;i++){if(r[i]===10)return{preceding:i,index:i+1,carriage:!1};if(r[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function vy(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}const Zi={off:0,error:200,warn:300,info:400,debug:500},eu=(r,t,s)=>{if(r){if(ty(Zi,r))return r;Kt(s).warn(`${t} was set to ${JSON.stringify(r)}, expected one of ${JSON.stringify(Object.keys(Zi))}`)}};function Tn(){}function ui(r,t,s){return!t||Zi[r]>Zi[s]?Tn:t[r].bind(t)}const wy={error:Tn,warn:Tn,info:Tn,debug:Tn};let tu=new WeakMap;function Kt(r){const t=r.logger,s=r.logLevel??"off";if(!t)return wy;const n=tu.get(t);if(n&&n[0]===s)return n[1];const i={error:ui("error",t,s),warn:ui("warn",t,s),info:ui("info",t,s),debug:ui("debug",t,s)};return tu.set(t,[s,i]),i}const Es=r=>(r.options&&(r.options={...r.options},delete r.options.headers),r.headers&&(r.headers=Object.fromEntries((r.headers instanceof Headers?[...r.headers]:Object.entries(r.headers)).map(([t,s])=>[t,t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":s]))),"retryOfRequestLogID"in r&&(r.retryOfRequestLogID&&(r.retryOf=r.retryOfRequestLogID),delete r.retryOfRequestLogID),r);var jn;class Br{constructor(t,s,n){this.iterator=t,jn.set(this,void 0),this.controller=s,He(this,jn,n)}static fromSSEResponse(t,s,n){let i=!1;const o=n?Kt(n):console;async function*l(){if(i)throw new Me("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let a=!1;try{for await(const c of jy(t,s))if(!a){if(c.data.startsWith("[DONE]")){a=!0;continue}if(c.event===null||!c.event.startsWith("thread.")){let p;try{p=JSON.parse(c.data)}catch(d){throw o.error("Could not parse message into JSON:",c.data),o.error("From chunk:",c.raw),d}if(p&&p.error)throw new Jt(void 0,p.error,void 0,t.headers);yield p}else{let p;try{p=JSON.parse(c.data)}catch(d){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),d}if(c.event=="error")throw new Jt(void 0,p.error,p.message,void 0);yield{event:c.event,data:p}}}a=!0}catch(c){if(ec(c))return;throw c}finally{a||s.abort()}}return new Br(l,s,n)}static fromReadableStream(t,s,n){let i=!1;async function*o(){const a=new _a,c=hp(t);for await(const p of c)for(const d of a.decode(p))yield d;for(const p of a.flush())yield p}async function*l(){if(i)throw new Me("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let a=!1;try{for await(const c of o())a||c&&(yield JSON.parse(c));a=!0}catch(c){if(ec(c))return;throw c}finally{a||s.abort()}}return new Br(l,s,n)}[(jn=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const t=[],s=[],n=this.iterator(),i=o=>({next:()=>{if(o.length===0){const l=n.next();t.push(l),s.push(l)}return o.shift()}});return[new Br(()=>i(t),this.controller,me(this,jn,"f")),new Br(()=>i(s),this.controller,me(this,jn,"f"))]}toReadableStream(){const t=this;let s;return dp({async start(){s=t[Symbol.asyncIterator]()},async pull(n){try{const{value:i,done:o}=await s.next();if(o)return n.close();const l=Mc(JSON.stringify(i)+`
`);n.enqueue(l)}catch(i){n.error(i)}},async cancel(){await s.return?.()}})}}async function*jy(r,t){if(!r.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Me("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Me("Attempted to iterate over a response with no body");const s=new ky,n=new _a,i=hp(r.body);for await(const o of _y(i))for(const l of n.decode(o)){const a=s.decode(l);a&&(yield a)}for(const o of n.flush()){const l=s.decode(o);l&&(yield l)}}async function*_y(r){let t=new Uint8Array;for await(const s of r){if(s==null)continue;const n=s instanceof ArrayBuffer?new Uint8Array(s):typeof s=="string"?Mc(s):s;let i=new Uint8Array(t.length+n.length);i.set(t),i.set(n,t.length),t=i;let o;for(;(o=vy(t))!==-1;)yield t.slice(0,o),t=t.slice(o)}t.length>0&&(yield t)}class ky{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(t),t.startsWith(":"))return null;let[s,n,i]=Ny(t,":");return i.startsWith(" ")&&(i=i.substring(1)),s==="event"?this.event=i:s==="data"&&this.data.push(i),null}}function Ny(r,t){const s=r.indexOf(t);return s!==-1?[r.substring(0,s),t,r.substring(s+t.length)]:[r,"",""]}async function yp(r,t){const{response:s,requestLogID:n,retryOfRequestLogID:i,startTime:o}=t,l=await(async()=>{if(t.options.stream)return Kt(r).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(s,t.controller,r):Br.fromSSEResponse(s,t.controller,r);if(s.status===204)return null;if(t.options.__binaryResponse)return s;const c=s.headers.get("content-type")?.split(";")[0]?.trim();if(c?.includes("application/json")||c?.endsWith("+json")){const m=await s.json();return bp(m,s)}return await s.text()})();return Kt(r).debug(`[${n}] response parsed`,Es({retryOfRequestLogID:i,url:s.url,status:s.status,body:l,durationMs:Date.now()-o})),l}function bp(r,t){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}var In;class ka extends Promise{constructor(t,s,n=yp){super(i=>{i(null)}),this.responsePromise=s,this.parseResponse=n,In.set(this,void 0),He(this,In,t)}_thenUnwrap(t){return new ka(me(this,In,"f"),this.responsePromise,async(s,n)=>bp(t(await this.parseResponse(s,n),n),n.response))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,s]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:s,request_id:s.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(me(this,In,"f"),t))),this.parsedPromise}then(t,s){return this.parse().then(t,s)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}In=new WeakMap;var hi;class $c{constructor(t,s,n,i){hi.set(this,void 0),He(this,hi,t),this.options=i,this.response=s,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const t=this.nextPageRequestOptions();if(!t)throw new Me("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await me(this,hi,"f").requestAPIList(this.constructor,t)}async*iterPages(){let t=this;for(yield t;t.hasNextPage();)t=await t.getNextPage(),yield t}async*[(hi=new WeakMap,Symbol.asyncIterator)](){for await(const t of this.iterPages())for(const s of t.getPaginatedItems())yield s}}class Sy extends ka{constructor(t,s,n){super(t,s,async(i,o)=>new n(i,o.response,await yp(i,o),o.options))}async*[Symbol.asyncIterator](){const t=await this;for await(const s of t)yield s}}let Na=class extends $c{constructor(t,s,n,i){super(t,s,n,i),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}};class Rt extends $c{constructor(t,s,n,i){super(t,s,n,i),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const t=this.getPaginatedItems(),s=t[t.length-1]?.id;return s?{...this.options,query:{...cp(this.options.query),after:s}}:null}}class Cy extends $c{constructor(t,s,n,i){super(t,s,n,i),this.data=n.data||[],this.has_more=n.has_more||!1,this.last_id=n.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const t=this.last_id;return t?{...this.options,query:{...cp(this.options.query),after:t}}:null}}const vp=()=>{if(typeof File>"u"){const{process:r}=globalThis,t=typeof r?.versions?.node=="string"&&parseInt(r.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Bn(r,t,s){return vp(),new File(r,t??"unknown_file",s)}function Pi(r){return(typeof r=="object"&&r!==null&&("name"in r&&r.name&&String(r.name)||"url"in r&&r.url&&String(r.url)||"filename"in r&&r.filename&&String(r.filename)||"path"in r&&r.path&&String(r.path))||"").split(/[\\/]/).pop()||void 0}const wp=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",Ms=async(r,t)=>({...r,body:await Ay(r.body,t)}),ru=new WeakMap;function Ey(r){const t=typeof r=="function"?r:r.fetch,s=ru.get(t);if(s)return s;const n=(async()=>{try{const i="Response"in t?t.Response:(await t("data:,")).constructor,o=new FormData;return o.toString()!==await new i(o).text()}catch{return!0}})();return ru.set(t,n),n}const Ay=async(r,t)=>{if(!await Ey(t))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const s=new FormData;return await Promise.all(Object.entries(r||{}).map(([n,i])=>sc(s,n,i))),s},Ty=r=>r instanceof Blob&&"name"in r,sc=async(r,t,s)=>{if(s!==void 0){if(s==null)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")r.append(t,String(s));else if(s instanceof Response)r.append(t,Bn([await s.blob()],Pi(s)));else if(wp(s))r.append(t,Bn([await new Response(up(s)).blob()],Pi(s)));else if(Ty(s))r.append(t,s,Pi(s));else if(Array.isArray(s))await Promise.all(s.map(n=>sc(r,t+"[]",n)));else if(typeof s=="object")await Promise.all(Object.entries(s).map(([n,i])=>sc(r,`${t}[${n}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},jp=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",Iy=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&jp(r),Ry=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function";async function Oy(r,t,s){if(vp(),r=await r,Iy(r))return r instanceof File?r:Bn([await r.arrayBuffer()],r.name);if(Ry(r)){const i=await r.blob();return t||(t=new URL(r.url).pathname.split(/[\\/]/).pop()),Bn(await nc(i),t,s)}const n=await nc(r);if(t||(t=Pi(r)),!s?.type){const i=n.find(o=>typeof o=="object"&&"type"in o&&o.type);typeof i=="string"&&(s={...s,type:i})}return Bn(n,t,s)}async function nc(r){let t=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)t.push(r);else if(jp(r))t.push(r instanceof Blob?r:await r.arrayBuffer());else if(wp(r))for await(const s of r)t.push(...await nc(s));else{const s=r?.constructor?.name;throw new Error(`Unexpected data type: ${typeof r}${s?`; constructor: ${s}`:""}${Fy(r)}`)}return t}function Fy(r){return typeof r!="object"||r===null?"":`; props: [${Object.getOwnPropertyNames(r).map(s=>`"${s}"`).join(", ")}]`}class qe{constructor(t){this._client=t}}function _p(r){return r.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const su=Object.freeze(Object.create(null)),Py=(r=_p)=>function(s,...n){if(s.length===1)return s[0];let i=!1;const o=[],l=s.reduce((d,m,y)=>{/[?#]/.test(m)&&(i=!0);const h=n[y];let _=(i?encodeURIComponent:r)(""+h);return y!==n.length&&(h==null||typeof h=="object"&&h.toString===Object.getPrototypeOf(Object.getPrototypeOf(h.hasOwnProperty??su)??su)?.toString)&&(_=h+"",o.push({start:d.length+m.length,length:_.length,error:`Value of type ${Object.prototype.toString.call(h).slice(8,-1)} is not a valid path parameter`})),d+m+(y===n.length?"":_)},""),a=l.split(/[?#]/,1)[0],c=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;let p;for(;(p=c.exec(a))!==null;)o.push({start:p.index,length:p[0].length,error:`Value "${p[0]}" can't be safely passed as a path parameter`});if(o.sort((d,m)=>d.start-m.start),o.length>0){let d=0;const m=o.reduce((y,h)=>{const _=" ".repeat(h.start-d),b="^".repeat(h.length);return d=h.start+h.length,y+_+b},"");throw new Me(`Path parameters result in path with invalid segments:
${o.map(y=>y.error).join(`
`)}
${l}
${m}`)}return l},Ie=Py(_p);let kp=class extends qe{list(t,s={},n){return this._client.getAPIList(Ie`/chat/completions/${t}/messages`,Rt,{query:s,...n})}};function ea(r){return r!==void 0&&"function"in r&&r.function!==void 0}function Bc(r){return r?.$brand==="auto-parseable-response-format"}function Zn(r){return r?.$brand==="auto-parseable-tool"}function Ly(r,t){return!t||!Np(t)?{...r,choices:r.choices.map(s=>(Sp(s.message.tool_calls),{...s,message:{...s.message,parsed:null,...s.message.tool_calls?{tool_calls:s.message.tool_calls}:void 0}}))}:zc(r,t)}function zc(r,t){const s=r.choices.map(n=>{if(n.finish_reason==="length")throw new op;if(n.finish_reason==="content_filter")throw new lp;return Sp(n.message.tool_calls),{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:n.message.tool_calls?.map(i=>My(t,i))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?Dy(t,n.message.content):null}}});return{...r,choices:s}}function Dy(r,t){return r.response_format?.type!=="json_schema"?null:r.response_format?.type==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(t):JSON.parse(t):null}function My(r,t){const s=r.tools?.find(n=>ea(n)&&n.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:Zn(s)?s.$parseRaw(t.function.arguments):s?.function.strict?JSON.parse(t.function.arguments):null}}}function $y(r,t){if(!r||!("tools"in r)||!r.tools)return!1;const s=r.tools?.find(n=>ea(n)&&n.function?.name===t.function.name);return ea(s)&&(Zn(s)||s?.function.strict||!1)}function Np(r){return Bc(r.response_format)?!0:r.tools?.some(t=>Zn(t)||t.type==="function"&&t.function.strict===!0)??!1}function Sp(r){for(const t of r||[])if(t.type!=="function")throw new Me(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}function By(r){for(const t of r??[]){if(t.type!=="function")throw new Me(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(t.function.strict!==!0)throw new Me(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}const ta=r=>r?.role==="assistant",Cp=r=>r?.role==="tool";var ic,Li,Di,Rn,On,Mi,Fn,Zr,Pn,ra,sa,Js,Ep;class Uc{constructor(){ic.add(this),this.controller=new AbortController,Li.set(this,void 0),Di.set(this,()=>{}),Rn.set(this,()=>{}),On.set(this,void 0),Mi.set(this,()=>{}),Fn.set(this,()=>{}),Zr.set(this,{}),Pn.set(this,!1),ra.set(this,!1),sa.set(this,!1),Js.set(this,!1),He(this,Li,new Promise((t,s)=>{He(this,Di,t,"f"),He(this,Rn,s,"f")})),He(this,On,new Promise((t,s)=>{He(this,Mi,t,"f"),He(this,Fn,s,"f")})),me(this,Li,"f").catch(()=>{}),me(this,On,"f").catch(()=>{})}_run(t){setTimeout(()=>{t().then(()=>{this._emitFinal(),this._emit("end")},me(this,ic,"m",Ep).bind(this))},0)}_connected(){this.ended||(me(this,Di,"f").call(this),this._emit("connect"))}get ended(){return me(this,Pn,"f")}get errored(){return me(this,ra,"f")}get aborted(){return me(this,sa,"f")}abort(){this.controller.abort()}on(t,s){return(me(this,Zr,"f")[t]||(me(this,Zr,"f")[t]=[])).push({listener:s}),this}off(t,s){const n=me(this,Zr,"f")[t];if(!n)return this;const i=n.findIndex(o=>o.listener===s);return i>=0&&n.splice(i,1),this}once(t,s){return(me(this,Zr,"f")[t]||(me(this,Zr,"f")[t]=[])).push({listener:s,once:!0}),this}emitted(t){return new Promise((s,n)=>{He(this,Js,!0),t!=="error"&&this.once("error",n),this.once(t,s)})}async done(){He(this,Js,!0),await me(this,On,"f")}_emit(t,...s){if(me(this,Pn,"f"))return;t==="end"&&(He(this,Pn,!0),me(this,Mi,"f").call(this));const n=me(this,Zr,"f")[t];if(n&&(me(this,Zr,"f")[t]=n.filter(i=>!i.once),n.forEach(({listener:i})=>i(...s))),t==="abort"){const i=s[0];!me(this,Js,"f")&&!n?.length&&Promise.reject(i),me(this,Rn,"f").call(this,i),me(this,Fn,"f").call(this,i),this._emit("end");return}if(t==="error"){const i=s[0];!me(this,Js,"f")&&!n?.length&&Promise.reject(i),me(this,Rn,"f").call(this,i),me(this,Fn,"f").call(this,i),this._emit("end")}}_emitFinal(){}}Li=new WeakMap,Di=new WeakMap,Rn=new WeakMap,On=new WeakMap,Mi=new WeakMap,Fn=new WeakMap,Zr=new WeakMap,Pn=new WeakMap,ra=new WeakMap,sa=new WeakMap,Js=new WeakMap,ic=new WeakSet,Ep=function(t){if(He(this,ra,!0),t instanceof Error&&t.name==="AbortError"&&(t=new vr),t instanceof vr)return He(this,sa,!0),this._emit("abort",t);if(t instanceof Me)return this._emit("error",t);if(t instanceof Error){const s=new Me(t.message);return s.cause=t,this._emit("error",s)}return this._emit("error",new Me(String(t)))};function zy(r){return typeof r.parse=="function"}var tr,ac,na,oc,lc,cc,Ap,Tp;const Uy=10;class Ip extends Uc{constructor(){super(...arguments),tr.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(t){this._chatCompletions.push(t),this._emit("chatCompletion",t);const s=t.choices[0]?.message;return s&&this._addMessage(s),t}_addMessage(t,s=!0){if("content"in t||(t.content=null),this.messages.push(t),s){if(this._emit("message",t),Cp(t)&&t.content)this._emit("functionToolCallResult",t.content);else if(ta(t)&&t.tool_calls)for(const n of t.tool_calls)n.type==="function"&&this._emit("functionToolCall",n.function)}}async finalChatCompletion(){await this.done();const t=this._chatCompletions[this._chatCompletions.length-1];if(!t)throw new Me("stream ended without producing a ChatCompletion");return t}async finalContent(){return await this.done(),me(this,tr,"m",ac).call(this)}async finalMessage(){return await this.done(),me(this,tr,"m",na).call(this)}async finalFunctionToolCall(){return await this.done(),me(this,tr,"m",oc).call(this)}async finalFunctionToolCallResult(){return await this.done(),me(this,tr,"m",lc).call(this)}async totalUsage(){return await this.done(),me(this,tr,"m",cc).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const t=this._chatCompletions[this._chatCompletions.length-1];t&&this._emit("finalChatCompletion",t);const s=me(this,tr,"m",na).call(this);s&&this._emit("finalMessage",s);const n=me(this,tr,"m",ac).call(this);n&&this._emit("finalContent",n);const i=me(this,tr,"m",oc).call(this);i&&this._emit("finalFunctionToolCall",i);const o=me(this,tr,"m",lc).call(this);o!=null&&this._emit("finalFunctionToolCallResult",o),this._chatCompletions.some(l=>l.usage)&&this._emit("totalUsage",me(this,tr,"m",cc).call(this))}async _createChatCompletion(t,s,n){const i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),me(this,tr,"m",Ap).call(this,s);const o=await t.chat.completions.create({...s,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(zc(o,s))}async _runChatCompletion(t,s,n){for(const i of s.messages)this._addMessage(i,!1);return await this._createChatCompletion(t,s,n)}async _runTools(t,s,n){const i="tool",{tool_choice:o="auto",stream:l,...a}=s,c=typeof o!="string"&&o.type==="function"&&o?.function?.name,{maxChatCompletions:p=Uy}=n||{},d=s.tools.map(h=>{if(Zn(h)){if(!h.$callback)throw new Me("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:h.$callback,name:h.function.name,description:h.function.description||"",parameters:h.function.parameters,parse:h.$parseRaw,strict:!0}}}return h}),m={};for(const h of d)h.type==="function"&&(m[h.function.name||h.function.function.name]=h.function);const y="tools"in s?d.map(h=>h.type==="function"?{type:"function",function:{name:h.function.name||h.function.function.name,parameters:h.function.parameters,description:h.function.description,strict:h.function.strict}}:h):void 0;for(const h of s.messages)this._addMessage(h,!1);for(let h=0;h<p;++h){const b=(await this._createChatCompletion(t,{...a,tool_choice:o,tools:y,messages:[...this.messages]},n)).choices[0]?.message;if(!b)throw new Me("missing message in ChatCompletion response");if(!b.tool_calls?.length)return;for(const N of b.tool_calls){if(N.type!=="function")continue;const u=N.id,{name:v,arguments:g}=N.function,w=m[v];if(w){if(c&&c!==v){const z=`Invalid tool_call: ${JSON.stringify(v)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:i,tool_call_id:u,content:z});continue}}else{const z=`Invalid tool_call: ${JSON.stringify(v)}. Available options are: ${Object.keys(m).map(S=>JSON.stringify(S)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:u,content:z});continue}let k;try{k=zy(w)?await w.parse(g):g}catch(z){const S=z instanceof Error?z.message:String(z);this._addMessage({role:i,tool_call_id:u,content:S});continue}const A=await w.function(k,this),T=me(this,tr,"m",Tp).call(this,A);if(this._addMessage({role:i,tool_call_id:u,content:T}),c)return}}}}tr=new WeakSet,ac=function(){return me(this,tr,"m",na).call(this).content??null},na=function(){let t=this.messages.length;for(;t-- >0;){const s=this.messages[t];if(ta(s))return{...s,content:s.content??null,refusal:s.refusal??null}}throw new Me("stream ended without producing a ChatCompletionMessage with role=assistant")},oc=function(){for(let t=this.messages.length-1;t>=0;t--){const s=this.messages[t];if(ta(s)&&s?.tool_calls?.length)return s.tool_calls.filter(n=>n.type==="function").at(-1)?.function}},lc=function(){for(let t=this.messages.length-1;t>=0;t--){const s=this.messages[t];if(Cp(s)&&s.content!=null&&typeof s.content=="string"&&this.messages.some(n=>n.role==="assistant"&&n.tool_calls?.some(i=>i.type==="function"&&i.id===s.tool_call_id)))return s.content}},cc=function(){const t={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:s}of this._chatCompletions)s&&(t.completion_tokens+=s.completion_tokens,t.prompt_tokens+=s.prompt_tokens,t.total_tokens+=s.total_tokens);return t},Ap=function(t){if(t.n!=null&&t.n>1)throw new Me("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Tp=function(t){return typeof t=="string"?t:t===void 0?"undefined":JSON.stringify(t)};class qc extends Ip{static runTools(t,s,n){const i=new qc,o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(t,s,o)),i}_addMessage(t,s=!0){super._addMessage(t,s),ta(t)&&t.content&&this._emit("content",t.content)}}const Rp=1,Op=2,Fp=4,Pp=8,Lp=16,Dp=32,Mp=64,$p=128,Bp=256,zp=$p|Bp,Up=Lp|Dp|zp|Mp,qp=Rp|Op|Up,Wp=Fp|Pp,qy=qp|Wp,Ut={STR:Rp,NUM:Op,ARR:Fp,OBJ:Pp,NULL:Lp,BOOL:Dp,NAN:Mp,INFINITY:$p,MINUS_INFINITY:Bp,INF:zp,SPECIAL:Up,ATOM:qp,COLLECTION:Wp,ALL:qy};class Wy extends Error{}class Hy extends Error{}function Gy(r,t=Ut.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return Vy(r.trim(),t)}const Vy=(r,t)=>{const s=r.length;let n=0;const i=y=>{throw new Wy(`${y} at position ${n}`)},o=y=>{throw new Hy(`${y} at position ${n}`)},l=()=>(m(),n>=s&&i("Unexpected end of input"),r[n]==='"'?a():r[n]==="{"?c():r[n]==="["?p():r.substring(n,n+4)==="null"||Ut.NULL&t&&s-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||Ut.BOOL&t&&s-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||Ut.BOOL&t&&s-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||Ut.INFINITY&t&&s-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||Ut.MINUS_INFINITY&t&&1<s-n&&s-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||Ut.NAN&t&&s-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):d()),a=()=>{const y=n;let h=!1;for(n++;n<s&&(r[n]!=='"'||h&&r[n-1]==="\\");)h=r[n]==="\\"?!h:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(y,++n-Number(h)))}catch(_){o(String(_))}else if(Ut.STR&t)try{return JSON.parse(r.substring(y,n-Number(h))+'"')}catch{return JSON.parse(r.substring(y,r.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},c=()=>{n++,m();const y={};try{for(;r[n]!=="}";){if(m(),n>=s&&Ut.OBJ&t)return y;const h=a();m(),n++;try{const _=l();Object.defineProperty(y,h,{value:_,writable:!0,enumerable:!0,configurable:!0})}catch(_){if(Ut.OBJ&t)return y;throw _}m(),r[n]===","&&n++}}catch{if(Ut.OBJ&t)return y;i("Expected '}' at end of object")}return n++,y},p=()=>{n++;const y=[];try{for(;r[n]!=="]";)y.push(l()),m(),r[n]===","&&n++}catch{if(Ut.ARR&t)return y;i("Expected ']' at end of array")}return n++,y},d=()=>{if(n===0){r==="-"&&Ut.NUM&t&&i("Not sure what '-' is");try{return JSON.parse(r)}catch(h){if(Ut.NUM&t)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}o(String(h))}}const y=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==s&&!(Ut.NUM&t)&&i("Unterminated number literal");try{return JSON.parse(r.substring(y,n))}catch{r.substring(y,n)==="-"&&Ut.NUM&t&&i("Not sure what '-' is");try{return JSON.parse(r.substring(y,r.lastIndexOf("e")))}catch(_){o(String(_))}}},m=()=>{for(;n<s&&` 
\r	`.includes(r[n]);)n++};return l()},nu=r=>Gy(r,Ut.ALL^Ut.NUM);var Ft,Yr,Ws,us,Xa,mi,Ya,Ja,Qa,pi,Za,iu;class Vn extends Ip{constructor(t){super(),Ft.add(this),Yr.set(this,void 0),Ws.set(this,void 0),us.set(this,void 0),He(this,Yr,t),He(this,Ws,[])}get currentChatCompletionSnapshot(){return me(this,us,"f")}static fromReadableStream(t){const s=new Vn(null);return s._run(()=>s._fromReadableStream(t)),s}static createChatCompletion(t,s,n){const i=new Vn(s);return i._run(()=>i._runChatCompletion(t,{...s,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(t,s,n){super._createChatCompletion;const i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),me(this,Ft,"m",Xa).call(this);const o=await t.chat.completions.create({...s,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const l of o)me(this,Ft,"m",Ya).call(this,l);if(o.controller.signal?.aborted)throw new vr;return this._addChatCompletion(me(this,Ft,"m",pi).call(this))}async _fromReadableStream(t,s){const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),me(this,Ft,"m",Xa).call(this),this._connected();const i=Br.fromReadableStream(t,this.controller);let o;for await(const l of i)o&&o!==l.id&&this._addChatCompletion(me(this,Ft,"m",pi).call(this)),me(this,Ft,"m",Ya).call(this,l),o=l.id;if(i.controller.signal?.aborted)throw new vr;return this._addChatCompletion(me(this,Ft,"m",pi).call(this))}[(Yr=new WeakMap,Ws=new WeakMap,us=new WeakMap,Ft=new WeakSet,Xa=function(){this.ended||He(this,us,void 0)},mi=function(s){let n=me(this,Ws,"f")[s.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},me(this,Ws,"f")[s.index]=n,n)},Ya=function(s){if(this.ended)return;const n=me(this,Ft,"m",iu).call(this,s);this._emit("chunk",s,n);for(const i of s.choices){const o=n.choices[i.index];i.delta.content!=null&&o.message?.role==="assistant"&&o.message?.content&&(this._emit("content",i.delta.content,o.message.content),this._emit("content.delta",{delta:i.delta.content,snapshot:o.message.content,parsed:o.message.parsed})),i.delta.refusal!=null&&o.message?.role==="assistant"&&o.message?.refusal&&this._emit("refusal.delta",{delta:i.delta.refusal,snapshot:o.message.refusal}),i.logprobs?.content!=null&&o.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:i.logprobs?.content,snapshot:o.logprobs?.content??[]}),i.logprobs?.refusal!=null&&o.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:i.logprobs?.refusal,snapshot:o.logprobs?.refusal??[]});const l=me(this,Ft,"m",mi).call(this,o);o.finish_reason&&(me(this,Ft,"m",Qa).call(this,o),l.current_tool_call_index!=null&&me(this,Ft,"m",Ja).call(this,o,l.current_tool_call_index));for(const a of i.delta.tool_calls??[])l.current_tool_call_index!==a.index&&(me(this,Ft,"m",Qa).call(this,o),l.current_tool_call_index!=null&&me(this,Ft,"m",Ja).call(this,o,l.current_tool_call_index)),l.current_tool_call_index=a.index;for(const a of i.delta.tool_calls??[]){const c=o.message.tool_calls?.[a.index];c?.type&&(c?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:c.function?.name,index:a.index,arguments:c.function.arguments,parsed_arguments:c.function.parsed_arguments,arguments_delta:a.function?.arguments??""}):(c?.type,void 0))}}},Ja=function(s,n){if(me(this,Ft,"m",mi).call(this,s).done_tool_calls.has(n))return;const o=s.message.tool_calls?.[n];if(!o)throw new Error("no tool call snapshot");if(!o.type)throw new Error("tool call snapshot missing `type`");if(o.type==="function"){const l=me(this,Yr,"f")?.tools?.find(a=>ea(a)&&a.function.name===o.function.name);this._emit("tool_calls.function.arguments.done",{name:o.function.name,index:n,arguments:o.function.arguments,parsed_arguments:Zn(l)?l.$parseRaw(o.function.arguments):l?.function.strict?JSON.parse(o.function.arguments):null})}else o.type},Qa=function(s){const n=me(this,Ft,"m",mi).call(this,s);if(s.message.content&&!n.content_done){n.content_done=!0;const i=me(this,Ft,"m",Za).call(this);this._emit("content.done",{content:s.message.content,parsed:i?i.$parseRaw(s.message.content):null})}s.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:s.message.refusal})),s.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:s.logprobs.content})),s.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:s.logprobs.refusal}))},pi=function(){if(this.ended)throw new Me("stream has ended, this shouldn't happen");const s=me(this,us,"f");if(!s)throw new Me("request ended without sending any chunks");return He(this,us,void 0),He(this,Ws,[]),Ky(s,me(this,Yr,"f"))},Za=function(){const s=me(this,Yr,"f")?.response_format;return Bc(s)?s:null},iu=function(s){var n,i,o,l;let a=me(this,us,"f");const{choices:c,...p}=s;a?Object.assign(a,p):a=He(this,us,{...p,choices:[]});for(const{delta:d,finish_reason:m,index:y,logprobs:h=null,..._}of s.choices){let b=a.choices[y];if(b||(b=a.choices[y]={finish_reason:m,index:y,message:{},logprobs:h,..._}),h)if(!b.logprobs)b.logprobs=Object.assign({},h);else{const{content:A,refusal:T,...z}=h;Object.assign(b.logprobs,z),A&&((n=b.logprobs).content??(n.content=[]),b.logprobs.content.push(...A)),T&&((i=b.logprobs).refusal??(i.refusal=[]),b.logprobs.refusal.push(...T))}if(m&&(b.finish_reason=m,me(this,Yr,"f")&&Np(me(this,Yr,"f")))){if(m==="length")throw new op;if(m==="content_filter")throw new lp}if(Object.assign(b,_),!d)continue;const{content:N,refusal:u,function_call:v,role:g,tool_calls:w,...k}=d;if(Object.assign(b.message,k),u&&(b.message.refusal=(b.message.refusal||"")+u),g&&(b.message.role=g),v&&(b.message.function_call?(v.name&&(b.message.function_call.name=v.name),v.arguments&&((o=b.message.function_call).arguments??(o.arguments=""),b.message.function_call.arguments+=v.arguments)):b.message.function_call=v),N&&(b.message.content=(b.message.content||"")+N,!b.message.refusal&&me(this,Ft,"m",Za).call(this)&&(b.message.parsed=nu(b.message.content))),w){b.message.tool_calls||(b.message.tool_calls=[]);for(const{index:A,id:T,type:z,function:S,...U}of w){const G=(l=b.message.tool_calls)[A]??(l[A]={});Object.assign(G,U),T&&(G.id=T),z&&(G.type=z),S&&(G.function??(G.function={name:S.name??"",arguments:""})),S?.name&&(G.function.name=S.name),S?.arguments&&(G.function.arguments+=S.arguments,$y(me(this,Yr,"f"),G)&&(G.function.parsed_arguments=nu(G.function.arguments)))}}}return a},Symbol.asyncIterator)](){const t=[],s=[];let n=!1;return this.on("chunk",i=>{const o=s.shift();o?o.resolve(i):t.push(i)}),this.on("end",()=>{n=!0;for(const i of s)i.resolve(void 0);s.length=0}),this.on("abort",i=>{n=!0;for(const o of s)o.reject(i);s.length=0}),this.on("error",i=>{n=!0;for(const o of s)o.reject(i);s.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,l)=>s.push({resolve:o,reject:l})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Br(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Ky(r,t){const{id:s,choices:n,created:i,model:o,system_fingerprint:l,...a}=r,c={...a,id:s,choices:n.map(({message:p,finish_reason:d,index:m,logprobs:y,...h})=>{if(!d)throw new Me(`missing finish_reason for choice ${m}`);const{content:_=null,function_call:b,tool_calls:N,...u}=p,v=p.role;if(!v)throw new Me(`missing role for choice ${m}`);if(b){const{arguments:g,name:w}=b;if(g==null)throw new Me(`missing function_call.arguments for choice ${m}`);if(!w)throw new Me(`missing function_call.name for choice ${m}`);return{...h,message:{content:_,function_call:{arguments:g,name:w},role:v,refusal:p.refusal??null},finish_reason:d,index:m,logprobs:y}}return N?{...h,index:m,finish_reason:d,logprobs:y,message:{...u,role:v,content:_,refusal:p.refusal??null,tool_calls:N.map((g,w)=>{const{function:k,type:A,id:T,...z}=g,{arguments:S,name:U,...G}=k||{};if(T==null)throw new Me(`missing choices[${m}].tool_calls[${w}].id
${fi(r)}`);if(A==null)throw new Me(`missing choices[${m}].tool_calls[${w}].type
${fi(r)}`);if(U==null)throw new Me(`missing choices[${m}].tool_calls[${w}].function.name
${fi(r)}`);if(S==null)throw new Me(`missing choices[${m}].tool_calls[${w}].function.arguments
${fi(r)}`);return{...z,id:T,type:A,function:{...G,name:U,arguments:S}}})}}:{...h,message:{...u,content:_,role:v,refusal:p.refusal??null},finish_reason:d,index:m,logprobs:y}}),created:i,model:o,object:"chat.completion",...l?{system_fingerprint:l}:{}};return Ly(c,t)}function fi(r){return JSON.stringify(r)}class ia extends Vn{static fromReadableStream(t){const s=new ia(null);return s._run(()=>s._fromReadableStream(t)),s}static runTools(t,s,n){const i=new ia(s),o={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(t,s,o)),i}}let Wc=class extends qe{constructor(){super(...arguments),this.messages=new kp(this._client)}create(t,s){return this._client.post("/chat/completions",{body:t,...s,stream:t.stream??!1})}retrieve(t,s){return this._client.get(Ie`/chat/completions/${t}`,s)}update(t,s,n){return this._client.post(Ie`/chat/completions/${t}`,{body:s,...n})}list(t={},s){return this._client.getAPIList("/chat/completions",Rt,{query:t,...s})}delete(t,s){return this._client.delete(Ie`/chat/completions/${t}`,s)}parse(t,s){return By(t.tools),this._client.chat.completions.create(t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>zc(n,t))}runTools(t,s){return t.stream?ia.runTools(this._client,t,s):qc.runTools(this._client,t,s)}stream(t,s){return Vn.createChatCompletion(this._client,t,s)}};Wc.Messages=kp;class Hc extends qe{constructor(){super(...arguments),this.completions=new Wc(this._client)}}Hc.Completions=Wc;const Hp=Symbol("brand.privateNullableHeaders");function*Xy(r){if(!r)return;if(Hp in r){const{values:n,nulls:i}=r;yield*n.entries();for(const o of i)yield[o,null];return}let t=!1,s;r instanceof Headers?s=r.entries():Wd(r)?s=r:(t=!0,s=Object.entries(r??{}));for(let n of s){const i=n[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");const o=Wd(n[1])?n[1]:[n[1]];let l=!1;for(const a of o)a!==void 0&&(t&&!l&&(l=!0,yield[i,null]),yield[i,a])}}const ze=r=>{const t=new Headers,s=new Set;for(const n of r){const i=new Set;for(const[o,l]of Xy(n)){const a=o.toLowerCase();i.has(a)||(t.delete(o),i.add(a)),l===null?(t.delete(o),s.add(a)):(t.append(o,l),s.delete(a))}}return{[Hp]:!0,values:t,nulls:s}};class Gp extends qe{create(t,s){return this._client.post("/audio/speech",{body:t,...s,headers:ze([{Accept:"application/octet-stream"},s?.headers]),__binaryResponse:!0})}}class Vp extends qe{create(t,s){return this._client.post("/audio/transcriptions",Ms({body:t,...s,stream:t.stream??!1,__metadata:{model:t.model}},this._client))}}class Kp extends qe{create(t,s){return this._client.post("/audio/translations",Ms({body:t,...s,__metadata:{model:t.model}},this._client))}}class ei extends qe{constructor(){super(...arguments),this.transcriptions=new Vp(this._client),this.translations=new Kp(this._client),this.speech=new Gp(this._client)}}ei.Transcriptions=Vp;ei.Translations=Kp;ei.Speech=Gp;class Xp extends qe{create(t,s){return this._client.post("/batches",{body:t,...s})}retrieve(t,s){return this._client.get(Ie`/batches/${t}`,s)}list(t={},s){return this._client.getAPIList("/batches",Rt,{query:t,...s})}cancel(t,s){return this._client.post(Ie`/batches/${t}/cancel`,s)}}class Yp extends qe{create(t,s){return this._client.post("/assistants",{body:t,...s,headers:ze([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(t,s){return this._client.get(Ie`/assistants/${t}`,{...s,headers:ze([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(t,s,n){return this._client.post(Ie`/assistants/${t}`,{body:s,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(t={},s){return this._client.getAPIList("/assistants",Rt,{query:t,...s,headers:ze([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(t,s){return this._client.delete(Ie`/assistants/${t}`,{...s,headers:ze([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class Jp extends qe{create(t,s){return this._client.post("/realtime/sessions",{body:t,...s,headers:ze([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class Qp extends qe{create(t,s){return this._client.post("/realtime/transcription_sessions",{body:t,...s,headers:ze([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}let Sa=class extends qe{constructor(){super(...arguments),this.sessions=new Jp(this._client),this.transcriptionSessions=new Qp(this._client)}};Sa.Sessions=Jp;Sa.TranscriptionSessions=Qp;class Zp extends qe{create(t,s,n){return this._client.post(Ie`/threads/${t}/messages`,{body:s,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(t,s,n){const{thread_id:i}=s;return this._client.get(Ie`/threads/${i}/messages/${t}`,{...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(t,s,n){const{thread_id:i,...o}=s;return this._client.post(Ie`/threads/${i}/messages/${t}`,{body:o,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(t,s={},n){return this._client.getAPIList(Ie`/threads/${t}/messages`,Rt,{query:s,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(t,s,n){const{thread_id:i}=s;return this._client.delete(Ie`/threads/${i}/messages/${t}`,{...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class ef extends qe{retrieve(t,s,n){const{thread_id:i,run_id:o,...l}=s;return this._client.get(Ie`/threads/${i}/runs/${o}/steps/${t}`,{query:l,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(t,s,n){const{thread_id:i,...o}=s;return this._client.getAPIList(Ie`/threads/${i}/runs/${t}/steps`,Rt,{query:o,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}const Yy=r=>{if(typeof Buffer<"u"){const t=Buffer.from(r,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}else{const t=atob(r),s=t.length,n=new Uint8Array(s);for(let i=0;i<s;i++)n[i]=t.charCodeAt(i);return Array.from(new Float32Array(n.buffer))}};var Jy={};const Hs=r=>{if(typeof globalThis.process<"u")return Jy?.[r]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(r)?.trim()};var Xt,Ts,dc,Dr,$i,Er,Is,tn,As,aa,fr,Bi,zi,zn,Ln,Dn,au,ou,lu,cu,du,uu,hu;class Un extends Uc{constructor(){super(...arguments),Xt.add(this),dc.set(this,[]),Dr.set(this,{}),$i.set(this,{}),Er.set(this,void 0),Is.set(this,void 0),tn.set(this,void 0),As.set(this,void 0),aa.set(this,void 0),fr.set(this,void 0),Bi.set(this,void 0),zi.set(this,void 0),zn.set(this,void 0)}[(dc=new WeakMap,Dr=new WeakMap,$i=new WeakMap,Er=new WeakMap,Is=new WeakMap,tn=new WeakMap,As=new WeakMap,aa=new WeakMap,fr=new WeakMap,Bi=new WeakMap,zi=new WeakMap,zn=new WeakMap,Xt=new WeakSet,Symbol.asyncIterator)](){const t=[],s=[];let n=!1;return this.on("event",i=>{const o=s.shift();o?o.resolve(i):t.push(i)}),this.on("end",()=>{n=!0;for(const i of s)i.resolve(void 0);s.length=0}),this.on("abort",i=>{n=!0;for(const o of s)o.reject(i);s.length=0}),this.on("error",i=>{n=!0;for(const o of s)o.reject(i);s.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,l)=>s.push({resolve:o,reject:l})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(t){const s=new Ts;return s._run(()=>s._fromReadableStream(t)),s}async _fromReadableStream(t,s){const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=Br.fromReadableStream(t,this.controller);for await(const o of i)me(this,Xt,"m",Ln).call(this,o);if(i.controller.signal?.aborted)throw new vr;return this._addRun(me(this,Xt,"m",Dn).call(this))}toReadableStream(){return new Br(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(t,s,n,i){const o=new Ts;return o._run(()=>o._runToolAssistantStream(t,s,n,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createToolAssistantStream(t,s,n,i){const o=i?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const l={...n,stream:!0},a=await t.submitToolOutputs(s,l,{...i,signal:this.controller.signal});this._connected();for await(const c of a)me(this,Xt,"m",Ln).call(this,c);if(a.controller.signal?.aborted)throw new vr;return this._addRun(me(this,Xt,"m",Dn).call(this))}static createThreadAssistantStream(t,s,n){const i=new Ts;return i._run(()=>i._threadAssistantStream(t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(t,s,n,i){const o=new Ts;return o._run(()=>o._runAssistantStream(t,s,n,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),o}currentEvent(){return me(this,Bi,"f")}currentRun(){return me(this,zi,"f")}currentMessageSnapshot(){return me(this,Er,"f")}currentRunStepSnapshot(){return me(this,zn,"f")}async finalRunSteps(){return await this.done(),Object.values(me(this,Dr,"f"))}async finalMessages(){return await this.done(),Object.values(me(this,$i,"f"))}async finalRun(){if(await this.done(),!me(this,Is,"f"))throw Error("Final run was not received.");return me(this,Is,"f")}async _createThreadAssistantStream(t,s,n){const i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},l=await t.createAndRun(o,{...n,signal:this.controller.signal});this._connected();for await(const a of l)me(this,Xt,"m",Ln).call(this,a);if(l.controller.signal?.aborted)throw new vr;return this._addRun(me(this,Xt,"m",Dn).call(this))}async _createAssistantStream(t,s,n,i){const o=i?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const l={...n,stream:!0},a=await t.create(s,l,{...i,signal:this.controller.signal});this._connected();for await(const c of a)me(this,Xt,"m",Ln).call(this,c);if(a.controller.signal?.aborted)throw new vr;return this._addRun(me(this,Xt,"m",Dn).call(this))}static accumulateDelta(t,s){for(const[n,i]of Object.entries(s)){if(!t.hasOwnProperty(n)){t[n]=i;continue}let o=t[n];if(o==null){t[n]=i;continue}if(n==="index"||n==="type"){t[n]=i;continue}if(typeof o=="string"&&typeof i=="string")o+=i;else if(typeof o=="number"&&typeof i=="number")o+=i;else if(Ga(o)&&Ga(i))o=this.accumulateDelta(o,i);else if(Array.isArray(o)&&Array.isArray(i)){if(o.every(l=>typeof l=="string"||typeof l=="number")){o.push(...i);continue}for(const l of i){if(!Ga(l))throw new Error(`Expected array delta entry to be an object but got: ${l}`);const a=l.index;if(a==null)throw console.error(l),new Error("Expected array delta entry to have an `index` property");if(typeof a!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${a}`);const c=o[a];c==null?o.push(l):o[a]=this.accumulateDelta(c,l)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${i}, accValue: ${o}`);t[n]=o}return t}_addRun(t){return t}async _threadAssistantStream(t,s,n){return await this._createThreadAssistantStream(s,t,n)}async _runAssistantStream(t,s,n,i){return await this._createAssistantStream(s,t,n,i)}async _runToolAssistantStream(t,s,n,i){return await this._createToolAssistantStream(s,t,n,i)}}Ts=Un,Ln=function(t){if(!this.ended)switch(He(this,Bi,t),me(this,Xt,"m",lu).call(this,t),t.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":me(this,Xt,"m",hu).call(this,t);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":me(this,Xt,"m",ou).call(this,t);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":me(this,Xt,"m",au).call(this,t);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Dn=function(){if(this.ended)throw new Me("stream has ended, this shouldn't happen");if(!me(this,Is,"f"))throw Error("Final run has not been received");return me(this,Is,"f")},au=function(t){const[s,n]=me(this,Xt,"m",du).call(this,t,me(this,Er,"f"));He(this,Er,s),me(this,$i,"f")[s.id]=s;for(const i of n){const o=s.content[i.index];o?.type=="text"&&this._emit("textCreated",o.text)}switch(t.event){case"thread.message.created":this._emit("messageCreated",t.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",t.data.delta,s),t.data.delta.content)for(const i of t.data.delta.content){if(i.type=="text"&&i.text){let o=i.text,l=s.content[i.index];if(l&&l.type=="text")this._emit("textDelta",o,l.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=me(this,tn,"f")){if(me(this,As,"f"))switch(me(this,As,"f").type){case"text":this._emit("textDone",me(this,As,"f").text,me(this,Er,"f"));break;case"image_file":this._emit("imageFileDone",me(this,As,"f").image_file,me(this,Er,"f"));break}He(this,tn,i.index)}He(this,As,s.content[i.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(me(this,tn,"f")!==void 0){const i=t.data.content[me(this,tn,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,me(this,Er,"f"));break;case"text":this._emit("textDone",i.text,me(this,Er,"f"));break}}me(this,Er,"f")&&this._emit("messageDone",t.data),He(this,Er,void 0)}},ou=function(t){const s=me(this,Xt,"m",cu).call(this,t);switch(He(this,zn,s),t.event){case"thread.run.step.created":this._emit("runStepCreated",t.data);break;case"thread.run.step.delta":const n=t.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&s.step_details.type=="tool_calls")for(const o of n.step_details.tool_calls)o.index==me(this,aa,"f")?this._emit("toolCallDelta",o,s.step_details.tool_calls[o.index]):(me(this,fr,"f")&&this._emit("toolCallDone",me(this,fr,"f")),He(this,aa,o.index),He(this,fr,s.step_details.tool_calls[o.index]),me(this,fr,"f")&&this._emit("toolCallCreated",me(this,fr,"f")));this._emit("runStepDelta",t.data.delta,s);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":He(this,zn,void 0),t.data.step_details.type=="tool_calls"&&me(this,fr,"f")&&(this._emit("toolCallDone",me(this,fr,"f")),He(this,fr,void 0)),this._emit("runStepDone",t.data,s);break}},lu=function(t){me(this,dc,"f").push(t),this._emit("event",t)},cu=function(t){switch(t.event){case"thread.run.step.created":return me(this,Dr,"f")[t.data.id]=t.data,t.data;case"thread.run.step.delta":let s=me(this,Dr,"f")[t.data.id];if(!s)throw Error("Received a RunStepDelta before creation of a snapshot");let n=t.data;if(n.delta){const i=Ts.accumulateDelta(s,n.delta);me(this,Dr,"f")[t.data.id]=i}return me(this,Dr,"f")[t.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":me(this,Dr,"f")[t.data.id]=t.data;break}if(me(this,Dr,"f")[t.data.id])return me(this,Dr,"f")[t.data.id];throw new Error("No snapshot available")},du=function(t,s){let n=[];switch(t.event){case"thread.message.created":return[t.data,n];case"thread.message.delta":if(!s)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=t.data;if(i.delta.content)for(const o of i.delta.content)if(o.index in s.content){let l=s.content[o.index];s.content[o.index]=me(this,Xt,"m",uu).call(this,o,l)}else s.content[o.index]=o,n.push(o);return[s,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(s)return[s,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},uu=function(t,s){return Ts.accumulateDelta(s,t)},hu=function(t){switch(He(this,zi,t.data),t.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":He(this,Is,t.data),me(this,fr,"f")&&(this._emit("toolCallDone",me(this,fr,"f")),He(this,fr,void 0));break}};let Gc=class extends qe{constructor(){super(...arguments),this.steps=new ef(this._client)}create(t,s,n){const{include:i,...o}=s;return this._client.post(Ie`/threads/${t}/runs`,{query:{include:i},body:o,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:s.stream??!1})}retrieve(t,s,n){const{thread_id:i}=s;return this._client.get(Ie`/threads/${i}/runs/${t}`,{...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(t,s,n){const{thread_id:i,...o}=s;return this._client.post(Ie`/threads/${i}/runs/${t}`,{body:o,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(t,s={},n){return this._client.getAPIList(Ie`/threads/${t}/runs`,Rt,{query:s,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(t,s,n){const{thread_id:i}=s;return this._client.post(Ie`/threads/${i}/runs/${t}/cancel`,{...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(t,s,n){const i=await this.create(t,s,n);return await this.poll(i.id,{thread_id:t},n)}createAndStream(t,s,n){return Un.createAssistantStream(t,this._client.beta.threads.runs,s,n)}async poll(t,s,n){const i=ze([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:o,response:l}=await this.retrieve(t,s,{...n,headers:{...n?.headers,...i}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(n?.pollIntervalMs)a=n.pollIntervalMs;else{const c=l.headers.get("openai-poll-after-ms");if(c){const p=parseInt(c);isNaN(p)||(a=p)}}await Qn(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}}stream(t,s,n){return Un.createAssistantStream(t,this._client.beta.threads.runs,s,n)}submitToolOutputs(t,s,n){const{thread_id:i,...o}=s;return this._client.post(Ie`/threads/${i}/runs/${t}/submit_tool_outputs`,{body:o,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:s.stream??!1})}async submitToolOutputsAndPoll(t,s,n){const i=await this.submitToolOutputs(t,s,n);return await this.poll(i.id,s,n)}submitToolOutputsStream(t,s,n){return Un.createToolAssistantStream(t,this._client.beta.threads.runs,s,n)}};Gc.Steps=ef;class Ca extends qe{constructor(){super(...arguments),this.runs=new Gc(this._client),this.messages=new Zp(this._client)}create(t={},s){return this._client.post("/threads",{body:t,...s,headers:ze([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(t,s){return this._client.get(Ie`/threads/${t}`,{...s,headers:ze([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(t,s,n){return this._client.post(Ie`/threads/${t}`,{body:s,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(t,s){return this._client.delete(Ie`/threads/${t}`,{...s,headers:ze([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}createAndRun(t,s){return this._client.post("/threads/runs",{body:t,...s,headers:ze([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}async createAndRunPoll(t,s){const n=await this.createAndRun(t,s);return await this.runs.poll(n.id,{thread_id:n.thread_id},s)}createAndRunStream(t,s){return Un.createThreadAssistantStream(t,this._client.beta.threads,s)}}Ca.Runs=Gc;Ca.Messages=Zp;class ti extends qe{constructor(){super(...arguments),this.realtime=new Sa(this._client),this.assistants=new Yp(this._client),this.threads=new Ca(this._client)}}ti.Realtime=Sa;ti.Assistants=Yp;ti.Threads=Ca;class tf extends qe{create(t,s){return this._client.post("/completions",{body:t,...s,stream:t.stream??!1})}}class rf extends qe{retrieve(t,s,n){const{container_id:i}=s;return this._client.get(Ie`/containers/${i}/files/${t}/content`,{...n,headers:ze([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}}let Vc=class extends qe{constructor(){super(...arguments),this.content=new rf(this._client)}create(t,s,n){return this._client.post(Ie`/containers/${t}/files`,Ms({body:s,...n},this._client))}retrieve(t,s,n){const{container_id:i}=s;return this._client.get(Ie`/containers/${i}/files/${t}`,n)}list(t,s={},n){return this._client.getAPIList(Ie`/containers/${t}/files`,Rt,{query:s,...n})}delete(t,s,n){const{container_id:i}=s;return this._client.delete(Ie`/containers/${i}/files/${t}`,{...n,headers:ze([{Accept:"*/*"},n?.headers])})}};Vc.Content=rf;class Kc extends qe{constructor(){super(...arguments),this.files=new Vc(this._client)}create(t,s){return this._client.post("/containers",{body:t,...s})}retrieve(t,s){return this._client.get(Ie`/containers/${t}`,s)}list(t={},s){return this._client.getAPIList("/containers",Rt,{query:t,...s})}delete(t,s){return this._client.delete(Ie`/containers/${t}`,{...s,headers:ze([{Accept:"*/*"},s?.headers])})}}Kc.Files=Vc;class sf extends qe{create(t,s,n){const{include:i,...o}=s;return this._client.post(Ie`/conversations/${t}/items`,{query:{include:i},body:o,...n})}retrieve(t,s,n){const{conversation_id:i,...o}=s;return this._client.get(Ie`/conversations/${i}/items/${t}`,{query:o,...n})}list(t,s={},n){return this._client.getAPIList(Ie`/conversations/${t}/items`,Cy,{query:s,...n})}delete(t,s,n){const{conversation_id:i}=s;return this._client.delete(Ie`/conversations/${i}/items/${t}`,n)}}class Xc extends qe{constructor(){super(...arguments),this.items=new sf(this._client)}create(t={},s){return this._client.post("/conversations",{body:t,...s})}retrieve(t,s){return this._client.get(Ie`/conversations/${t}`,s)}update(t,s,n){return this._client.post(Ie`/conversations/${t}`,{body:s,...n})}delete(t,s){return this._client.delete(Ie`/conversations/${t}`,s)}}Xc.Items=sf;class nf extends qe{create(t,s){const n=!!t.encoding_format;let i=n?t.encoding_format:"base64";n&&Kt(this._client).debug("embeddings/user defined encoding_format:",t.encoding_format);const o=this._client.post("/embeddings",{body:{...t,encoding_format:i},...s});return n?o:(Kt(this._client).debug("embeddings/decoding base64 embeddings from base64"),o._thenUnwrap(l=>(l&&l.data&&l.data.forEach(a=>{const c=a.embedding;a.embedding=Yy(c)}),l)))}}class af extends qe{retrieve(t,s,n){const{eval_id:i,run_id:o}=s;return this._client.get(Ie`/evals/${i}/runs/${o}/output_items/${t}`,n)}list(t,s,n){const{eval_id:i,...o}=s;return this._client.getAPIList(Ie`/evals/${i}/runs/${t}/output_items`,Rt,{query:o,...n})}}class Yc extends qe{constructor(){super(...arguments),this.outputItems=new af(this._client)}create(t,s,n){return this._client.post(Ie`/evals/${t}/runs`,{body:s,...n})}retrieve(t,s,n){const{eval_id:i}=s;return this._client.get(Ie`/evals/${i}/runs/${t}`,n)}list(t,s={},n){return this._client.getAPIList(Ie`/evals/${t}/runs`,Rt,{query:s,...n})}delete(t,s,n){const{eval_id:i}=s;return this._client.delete(Ie`/evals/${i}/runs/${t}`,n)}cancel(t,s,n){const{eval_id:i}=s;return this._client.post(Ie`/evals/${i}/runs/${t}`,n)}}Yc.OutputItems=af;class Jc extends qe{constructor(){super(...arguments),this.runs=new Yc(this._client)}create(t,s){return this._client.post("/evals",{body:t,...s})}retrieve(t,s){return this._client.get(Ie`/evals/${t}`,s)}update(t,s,n){return this._client.post(Ie`/evals/${t}`,{body:s,...n})}list(t={},s){return this._client.getAPIList("/evals",Rt,{query:t,...s})}delete(t,s){return this._client.delete(Ie`/evals/${t}`,s)}}Jc.Runs=Yc;let of=class extends qe{create(t,s){return this._client.post("/files",Ms({body:t,...s},this._client))}retrieve(t,s){return this._client.get(Ie`/files/${t}`,s)}list(t={},s){return this._client.getAPIList("/files",Rt,{query:t,...s})}delete(t,s){return this._client.delete(Ie`/files/${t}`,s)}content(t,s){return this._client.get(Ie`/files/${t}/content`,{...s,headers:ze([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}async waitForProcessing(t,{pollInterval:s=5e3,maxWait:n=1800*1e3}={}){const i=new Set(["processed","error","deleted"]),o=Date.now();let l=await this.retrieve(t);for(;!l.status||!i.has(l.status);)if(await Qn(s),l=await this.retrieve(t),Date.now()-o>n)throw new Dc({message:`Giving up on waiting for file ${t} to finish processing after ${n} milliseconds.`});return l}};class lf extends qe{}let cf=class extends qe{run(t,s){return this._client.post("/fine_tuning/alpha/graders/run",{body:t,...s})}validate(t,s){return this._client.post("/fine_tuning/alpha/graders/validate",{body:t,...s})}};class Qc extends qe{constructor(){super(...arguments),this.graders=new cf(this._client)}}Qc.Graders=cf;class df extends qe{create(t,s,n){return this._client.getAPIList(Ie`/fine_tuning/checkpoints/${t}/permissions`,Na,{body:s,method:"post",...n})}retrieve(t,s={},n){return this._client.get(Ie`/fine_tuning/checkpoints/${t}/permissions`,{query:s,...n})}delete(t,s,n){const{fine_tuned_model_checkpoint:i}=s;return this._client.delete(Ie`/fine_tuning/checkpoints/${i}/permissions/${t}`,n)}}let Zc=class extends qe{constructor(){super(...arguments),this.permissions=new df(this._client)}};Zc.Permissions=df;class uf extends qe{list(t,s={},n){return this._client.getAPIList(Ie`/fine_tuning/jobs/${t}/checkpoints`,Rt,{query:s,...n})}}class ed extends qe{constructor(){super(...arguments),this.checkpoints=new uf(this._client)}create(t,s){return this._client.post("/fine_tuning/jobs",{body:t,...s})}retrieve(t,s){return this._client.get(Ie`/fine_tuning/jobs/${t}`,s)}list(t={},s){return this._client.getAPIList("/fine_tuning/jobs",Rt,{query:t,...s})}cancel(t,s){return this._client.post(Ie`/fine_tuning/jobs/${t}/cancel`,s)}listEvents(t,s={},n){return this._client.getAPIList(Ie`/fine_tuning/jobs/${t}/events`,Rt,{query:s,...n})}pause(t,s){return this._client.post(Ie`/fine_tuning/jobs/${t}/pause`,s)}resume(t,s){return this._client.post(Ie`/fine_tuning/jobs/${t}/resume`,s)}}ed.Checkpoints=uf;class xn extends qe{constructor(){super(...arguments),this.methods=new lf(this._client),this.jobs=new ed(this._client),this.checkpoints=new Zc(this._client),this.alpha=new Qc(this._client)}}xn.Methods=lf;xn.Jobs=ed;xn.Checkpoints=Zc;xn.Alpha=Qc;class hf extends qe{}class td extends qe{constructor(){super(...arguments),this.graderModels=new hf(this._client)}}td.GraderModels=hf;class mf extends qe{createVariation(t,s){return this._client.post("/images/variations",Ms({body:t,...s},this._client))}edit(t,s){return this._client.post("/images/edits",Ms({body:t,...s,stream:t.stream??!1},this._client))}generate(t,s){return this._client.post("/images/generations",{body:t,...s,stream:t.stream??!1})}}class pf extends qe{retrieve(t,s){return this._client.get(Ie`/models/${t}`,s)}list(t){return this._client.getAPIList("/models",Na,t)}delete(t,s){return this._client.delete(Ie`/models/${t}`,s)}}class ff extends qe{create(t,s){return this._client.post("/moderations",{body:t,...s})}}class gf extends qe{create(t,s){return this._client.post("/realtime/client_secrets",{body:t,...s})}}class rd extends qe{constructor(){super(...arguments),this.clientSecrets=new gf(this._client)}}rd.ClientSecrets=gf;function Qy(r,t){return!t||!eb(t)?{...r,output_parsed:null,output:r.output.map(s=>s.type==="function_call"?{...s,parsed_arguments:null}:s.type==="message"?{...s,content:s.content.map(n=>({...n,parsed:null}))}:s)}:xf(r,t)}function xf(r,t){const s=r.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:sb(t,i)};if(i.type==="message"){const o=i.content.map(l=>l.type==="output_text"?{...l,parsed:Zy(t,l.text)}:l);return{...i,content:o}}return i}),n=Object.assign({},r,{output:s});return Object.getOwnPropertyDescriptor(r,"output_text")||uc(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const i of n.output)if(i.type==="message"){for(const o of i.content)if(o.type==="output_text"&&o.parsed!==null)return o.parsed}return null}}),n}function Zy(r,t){return r.text?.format?.type!=="json_schema"?null:"$parseRaw"in r.text?.format?(r.text?.format).$parseRaw(t):JSON.parse(t)}function eb(r){return!!Bc(r.text?.format)}function tb(r){return r?.$brand==="auto-parseable-tool"}function rb(r,t){return r.find(s=>s.type==="function"&&s.name===t)}function sb(r,t){const s=rb(r.tools??[],t.name);return{...t,...t,parsed_arguments:tb(s)?s.$parseRaw(t.arguments):s?.strict?JSON.parse(t.arguments):null}}function uc(r){const t=[];for(const s of r.output)if(s.type==="message")for(const n of s.content)n.type==="output_text"&&t.push(n.text);r.output_text=t.join("")}var Gs,gi,hs,xi,mu,pu,fu,gu;class sd extends Uc{constructor(t){super(),Gs.add(this),gi.set(this,void 0),hs.set(this,void 0),xi.set(this,void 0),He(this,gi,t)}static createResponse(t,s,n){const i=new sd(s);return i._run(()=>i._createOrRetrieveResponse(t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(t,s,n){const i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),me(this,Gs,"m",mu).call(this);let o,l=null;"response_id"in s?(o=await t.responses.retrieve(s.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),l=s.starting_after??null):o=await t.responses.create({...s,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const a of o)me(this,Gs,"m",pu).call(this,a,l);if(o.controller.signal?.aborted)throw new vr;return me(this,Gs,"m",fu).call(this)}[(gi=new WeakMap,hs=new WeakMap,xi=new WeakMap,Gs=new WeakSet,mu=function(){this.ended||He(this,hs,void 0)},pu=function(s,n){if(this.ended)return;const i=(l,a)=>{(n==null||a.sequence_number>n)&&this._emit(l,a)},o=me(this,Gs,"m",gu).call(this,s);switch(i("event",s),s.type){case"response.output_text.delta":{const l=o.output[s.output_index];if(!l)throw new Me(`missing output at index ${s.output_index}`);if(l.type==="message"){const a=l.content[s.content_index];if(!a)throw new Me(`missing content at index ${s.content_index}`);if(a.type!=="output_text")throw new Me(`expected content to be 'output_text', got ${a.type}`);i("response.output_text.delta",{...s,snapshot:a.text})}break}case"response.function_call_arguments.delta":{const l=o.output[s.output_index];if(!l)throw new Me(`missing output at index ${s.output_index}`);l.type==="function_call"&&i("response.function_call_arguments.delta",{...s,snapshot:l.arguments});break}default:i(s.type,s);break}},fu=function(){if(this.ended)throw new Me("stream has ended, this shouldn't happen");const s=me(this,hs,"f");if(!s)throw new Me("request ended without sending any events");He(this,hs,void 0);const n=nb(s,me(this,gi,"f"));return He(this,xi,n),n},gu=function(s){let n=me(this,hs,"f");if(!n){if(s.type!=="response.created")throw new Me(`When snapshot hasn't been set yet, expected 'response.created' event, got ${s.type}`);return n=He(this,hs,s.response),n}switch(s.type){case"response.output_item.added":{n.output.push(s.item);break}case"response.content_part.added":{const i=n.output[s.output_index];if(!i)throw new Me(`missing output at index ${s.output_index}`);const o=i.type,l=s.part;o==="message"&&l.type!=="reasoning_text"?i.content.push(l):o==="reasoning"&&l.type==="reasoning_text"&&(i.content||(i.content=[]),i.content.push(l));break}case"response.output_text.delta":{const i=n.output[s.output_index];if(!i)throw new Me(`missing output at index ${s.output_index}`);if(i.type==="message"){const o=i.content[s.content_index];if(!o)throw new Me(`missing content at index ${s.content_index}`);if(o.type!=="output_text")throw new Me(`expected content to be 'output_text', got ${o.type}`);o.text+=s.delta}break}case"response.function_call_arguments.delta":{const i=n.output[s.output_index];if(!i)throw new Me(`missing output at index ${s.output_index}`);i.type==="function_call"&&(i.arguments+=s.delta);break}case"response.reasoning_text.delta":{const i=n.output[s.output_index];if(!i)throw new Me(`missing output at index ${s.output_index}`);if(i.type==="reasoning"){const o=i.content?.[s.content_index];if(!o)throw new Me(`missing content at index ${s.content_index}`);if(o.type!=="reasoning_text")throw new Me(`expected content to be 'reasoning_text', got ${o.type}`);o.text+=s.delta}break}case"response.completed":{He(this,hs,s.response);break}}return n},Symbol.asyncIterator)](){const t=[],s=[];let n=!1;return this.on("event",i=>{const o=s.shift();o?o.resolve(i):t.push(i)}),this.on("end",()=>{n=!0;for(const i of s)i.resolve(void 0);s.length=0}),this.on("abort",i=>{n=!0;for(const o of s)o.reject(i);s.length=0}),this.on("error",i=>{n=!0;for(const o of s)o.reject(i);s.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((o,l)=>s.push({resolve:o,reject:l})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const t=me(this,xi,"f");if(!t)throw new Me("stream ended without producing a ChatCompletion");return t}}function nb(r,t){return Qy(r,t)}class yf extends qe{list(t,s={},n){return this._client.getAPIList(Ie`/responses/${t}/input_items`,Rt,{query:s,...n})}}class nd extends qe{constructor(){super(...arguments),this.inputItems=new yf(this._client)}create(t,s){return this._client.post("/responses",{body:t,...s,stream:t.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&uc(n),n))}retrieve(t,s={},n){return this._client.get(Ie`/responses/${t}`,{query:s,...n,stream:s?.stream??!1})._thenUnwrap(i=>("object"in i&&i.object==="response"&&uc(i),i))}delete(t,s){return this._client.delete(Ie`/responses/${t}`,{...s,headers:ze([{Accept:"*/*"},s?.headers])})}parse(t,s){return this._client.responses.create(t,s)._thenUnwrap(n=>xf(n,t))}stream(t,s){return sd.createResponse(this._client,t,s)}cancel(t,s){return this._client.post(Ie`/responses/${t}/cancel`,s)}}nd.InputItems=yf;class bf extends qe{create(t,s,n){return this._client.post(Ie`/uploads/${t}/parts`,Ms({body:s,...n},this._client))}}class id extends qe{constructor(){super(...arguments),this.parts=new bf(this._client)}create(t,s){return this._client.post("/uploads",{body:t,...s})}cancel(t,s){return this._client.post(Ie`/uploads/${t}/cancel`,s)}complete(t,s,n){return this._client.post(Ie`/uploads/${t}/complete`,{body:s,...n})}}id.Parts=bf;const ib=async r=>{const t=await Promise.allSettled(r),s=t.filter(i=>i.status==="rejected");if(s.length){for(const i of s)console.error(i.reason);throw new Error(`${s.length} promise(s) failed - see the above errors`)}const n=[];for(const i of t)i.status==="fulfilled"&&n.push(i.value);return n};class vf extends qe{create(t,s,n){return this._client.post(Ie`/vector_stores/${t}/file_batches`,{body:s,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(t,s,n){const{vector_store_id:i}=s;return this._client.get(Ie`/vector_stores/${i}/file_batches/${t}`,{...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(t,s,n){const{vector_store_id:i}=s;return this._client.post(Ie`/vector_stores/${i}/file_batches/${t}/cancel`,{...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(t,s,n){const i=await this.create(t,s);return await this.poll(t,i.id,n)}listFiles(t,s,n){const{vector_store_id:i,...o}=s;return this._client.getAPIList(Ie`/vector_stores/${i}/file_batches/${t}/files`,Rt,{query:o,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(t,s,n){const i=ze([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:o,response:l}=await this.retrieve(s,{vector_store_id:t},{...n,headers:i}).withResponse();switch(o.status){case"in_progress":let a=5e3;if(n?.pollIntervalMs)a=n.pollIntervalMs;else{const c=l.headers.get("openai-poll-after-ms");if(c){const p=parseInt(c);isNaN(p)||(a=p)}}await Qn(a);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(t,{files:s,fileIds:n=[]},i){if(s==null||s.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const o=i?.maxConcurrency??5,l=Math.min(o,s.length),a=this._client,c=s.values(),p=[...n];async function d(y){for(let h of y){const _=await a.files.create({file:h,purpose:"assistants"},i);p.push(_.id)}}const m=Array(l).fill(c).map(d);return await ib(m),await this.createAndPoll(t,{file_ids:p})}}class wf extends qe{create(t,s,n){return this._client.post(Ie`/vector_stores/${t}/files`,{body:s,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(t,s,n){const{vector_store_id:i}=s;return this._client.get(Ie`/vector_stores/${i}/files/${t}`,{...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(t,s,n){const{vector_store_id:i,...o}=s;return this._client.post(Ie`/vector_stores/${i}/files/${t}`,{body:o,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(t,s={},n){return this._client.getAPIList(Ie`/vector_stores/${t}/files`,Rt,{query:s,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(t,s,n){const{vector_store_id:i}=s;return this._client.delete(Ie`/vector_stores/${i}/files/${t}`,{...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(t,s,n){const i=await this.create(t,s,n);return await this.poll(t,i.id,n)}async poll(t,s,n){const i=ze([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){const o=await this.retrieve(s,{vector_store_id:t},{...n,headers:i}).withResponse(),l=o.data;switch(l.status){case"in_progress":let a=5e3;if(n?.pollIntervalMs)a=n.pollIntervalMs;else{const c=o.response.headers.get("openai-poll-after-ms");if(c){const p=parseInt(c);isNaN(p)||(a=p)}}await Qn(a);break;case"failed":case"completed":return l}}}async upload(t,s,n){const i=await this._client.files.create({file:s,purpose:"assistants"},n);return this.create(t,{file_id:i.id},n)}async uploadAndPoll(t,s,n){const i=await this.upload(t,s,n);return await this.poll(t,i.id,n)}content(t,s,n){const{vector_store_id:i}=s;return this._client.getAPIList(Ie`/vector_stores/${i}/files/${t}/content`,Na,{...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}class Ea extends qe{constructor(){super(...arguments),this.files=new wf(this._client),this.fileBatches=new vf(this._client)}create(t,s){return this._client.post("/vector_stores",{body:t,...s,headers:ze([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(t,s){return this._client.get(Ie`/vector_stores/${t}`,{...s,headers:ze([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(t,s,n){return this._client.post(Ie`/vector_stores/${t}`,{body:s,...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(t={},s){return this._client.getAPIList("/vector_stores",Rt,{query:t,...s,headers:ze([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(t,s){return this._client.delete(Ie`/vector_stores/${t}`,{...s,headers:ze([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}search(t,s,n){return this._client.getAPIList(Ie`/vector_stores/${t}/search`,Na,{body:s,method:"post",...n,headers:ze([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}}Ea.Files=wf;Ea.FileBatches=vf;var Qs,jf,Ui;class _f extends qe{constructor(){super(...arguments),Qs.add(this)}async unwrap(t,s,n=this._client.webhookSecret,i=300){return await this.verifySignature(t,s,n,i),JSON.parse(t)}async verifySignature(t,s,n=this._client.webhookSecret,i=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");me(this,Qs,"m",jf).call(this,n);const o=ze([s]).values,l=me(this,Qs,"m",Ui).call(this,o,"webhook-signature"),a=me(this,Qs,"m",Ui).call(this,o,"webhook-timestamp"),c=me(this,Qs,"m",Ui).call(this,o,"webhook-id"),p=parseInt(a,10);if(isNaN(p))throw new An("Invalid webhook timestamp format");const d=Math.floor(Date.now()/1e3);if(d-p>i)throw new An("Webhook timestamp is too old");if(p>d+i)throw new An("Webhook timestamp is too new");const m=l.split(" ").map(b=>b.startsWith("v1,")?b.substring(3):b),y=n.startsWith("whsec_")?Buffer.from(n.replace("whsec_",""),"base64"):Buffer.from(n,"utf-8"),h=c?`${c}.${a}.${t}`:`${a}.${t}`,_=await crypto.subtle.importKey("raw",y,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const b of m)try{const N=Buffer.from(b,"base64");if(await crypto.subtle.verify("HMAC",_,N,new TextEncoder().encode(h)))return}catch{continue}throw new An("The given webhook signature does not match the expected signature")}}Qs=new WeakSet,jf=function(t){if(typeof t!="string"||t.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Ui=function(t,s){if(!t)throw new Error("Headers are required");const n=t.get(s);if(n==null)throw new Error(`Missing required header: ${s}`);return n};var hc,ad,qi,kf;class Je{constructor({baseURL:t=Hs("OPENAI_BASE_URL"),apiKey:s=Hs("OPENAI_API_KEY"),organization:n=Hs("OPENAI_ORG_ID")??null,project:i=Hs("OPENAI_PROJECT_ID")??null,webhookSecret:o=Hs("OPENAI_WEBHOOK_SECRET")??null,...l}={}){if(hc.add(this),qi.set(this,void 0),this.completions=new tf(this),this.chat=new Hc(this),this.embeddings=new nf(this),this.files=new of(this),this.images=new mf(this),this.audio=new ei(this),this.moderations=new ff(this),this.models=new pf(this),this.fineTuning=new xn(this),this.graders=new td(this),this.vectorStores=new Ea(this),this.webhooks=new _f(this),this.beta=new ti(this),this.batches=new Xp(this),this.uploads=new id(this),this.responses=new nd(this),this.realtime=new rd(this),this.conversations=new Xc(this),this.evals=new Jc(this),this.containers=new Kc(this),s===void 0)throw new Me("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const a={apiKey:s,organization:n,project:i,webhookSecret:o,...l,baseURL:t||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&ny())throw new Me(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=a.baseURL,this.timeout=a.timeout??ad.DEFAULT_TIMEOUT,this.logger=a.logger??console;const c="warn";this.logLevel=c,this.logLevel=eu(a.logLevel,"ClientOptions.logLevel",this)??eu(Hs("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??c,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??cy(),He(this,qi,uy),this._options=a,this.apiKey=typeof s=="string"?s:"Missing Key",this.organization=n,this.project=i,this.webhookSecret=o}withOptions(t){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...t})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:s}){}async authHeaders(t){return ze([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(t){return xy(t,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Ys}`}defaultIdempotencyKey(){return`stainless-node-retry-${Qm()}`}makeStatusError(t,s,n,i){return Jt.generate(t,s,n,i)}async _callApiKey(){const t=this._options.apiKey;if(typeof t!="function")return!1;let s;try{s=await t()}catch(n){throw n instanceof Me?n:new Me(`Failed to get token from 'apiKey' function: ${n.message}`,{cause:n})}if(typeof s!="string"||!s)throw new Me(`Expected 'apiKey' function argument to return a string but it returned ${s}`);return this.apiKey=s,!0}buildURL(t,s,n){const i=!me(this,hc,"m",kf).call(this)&&n||this.baseURL,o=Z0(t)?new URL(t):new URL(i+(i.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),l=this.defaultQuery();return ey(l)||(s={...l,...s}),typeof s=="object"&&s&&!Array.isArray(s)&&(o.search=this.stringifyQuery(s)),o.toString()}async prepareOptions(t){await this._callApiKey()}async prepareRequest(t,{url:s,options:n}){}get(t,s){return this.methodRequest("get",t,s)}post(t,s){return this.methodRequest("post",t,s)}patch(t,s){return this.methodRequest("patch",t,s)}put(t,s){return this.methodRequest("put",t,s)}delete(t,s){return this.methodRequest("delete",t,s)}methodRequest(t,s,n){return this.request(Promise.resolve(n).then(i=>({method:t,path:s,...i})))}request(t,s=null){return new ka(this,this.makeRequest(t,s,void 0))}async makeRequest(t,s,n){const i=await t,o=i.maxRetries??this.maxRetries;s==null&&(s=o),await this.prepareOptions(i);const{req:l,url:a,timeout:c}=await this.buildRequest(i,{retryCount:o-s});await this.prepareRequest(l,{url:a,options:i});const p="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),d=n===void 0?"":`, retryOf: ${n}`,m=Date.now();if(Kt(this).debug(`[${p}] sending request`,Es({retryOfRequestLogID:n,method:i.method,url:a,options:i,headers:l.headers})),i.signal?.aborted)throw new vr;const y=new AbortController,h=await this.fetchWithTimeout(a,l,c,y).catch(tc),_=Date.now();if(h instanceof globalThis.Error){const u=`retrying, ${s} attempts remaining`;if(i.signal?.aborted)throw new vr;const v=ec(h)||/timed? ?out/i.test(String(h)+("cause"in h?String(h.cause):""));if(s)return Kt(this).info(`[${p}] connection ${v?"timed out":"failed"} - ${u}`),Kt(this).debug(`[${p}] connection ${v?"timed out":"failed"} (${u})`,Es({retryOfRequestLogID:n,url:a,durationMs:_-m,message:h.message})),this.retryRequest(i,s,n??p);throw Kt(this).info(`[${p}] connection ${v?"timed out":"failed"} - error; no more retries left`),Kt(this).debug(`[${p}] connection ${v?"timed out":"failed"} (error; no more retries left)`,Es({retryOfRequestLogID:n,url:a,durationMs:_-m,message:h.message})),v?new Dc:new ja({cause:h})}const b=[...h.headers.entries()].filter(([u])=>u==="x-request-id").map(([u,v])=>", "+u+": "+JSON.stringify(v)).join(""),N=`[${p}${d}${b}] ${l.method} ${a} ${h.ok?"succeeded":"failed"} with status ${h.status} in ${_-m}ms`;if(!h.ok){const u=await this.shouldRetry(h);if(s&&u){const T=`retrying, ${s} attempts remaining`;return await dy(h.body),Kt(this).info(`${N} - ${T}`),Kt(this).debug(`[${p}] response error (${T})`,Es({retryOfRequestLogID:n,url:h.url,status:h.status,headers:h.headers,durationMs:_-m})),this.retryRequest(i,s,n??p,h.headers)}const v=u?"error; no more retries left":"error; not retryable";Kt(this).info(`${N} - ${v}`);const g=await h.text().catch(T=>tc(T).message),w=sy(g),k=w?void 0:g;throw Kt(this).debug(`[${p}] response error (${v})`,Es({retryOfRequestLogID:n,url:h.url,status:h.status,headers:h.headers,message:k,durationMs:Date.now()-m})),this.makeStatusError(h.status,w,k,h.headers)}return Kt(this).info(N),Kt(this).debug(`[${p}] response start`,Es({retryOfRequestLogID:n,url:h.url,status:h.status,headers:h.headers,durationMs:_-m})),{response:h,options:i,controller:y,requestLogID:p,retryOfRequestLogID:n,startTime:m}}getAPIList(t,s,n){return this.requestAPIList(s,{method:"get",path:t,...n})}requestAPIList(t,s){const n=this.makeRequest(s,null,void 0);return new Sy(this,n,t)}async fetchWithTimeout(t,s,n,i){const{signal:o,method:l,...a}=s||{};o&&o.addEventListener("abort",()=>i.abort());const c=setTimeout(()=>i.abort(),n),p=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||typeof a.body=="object"&&a.body!==null&&Symbol.asyncIterator in a.body,d={signal:i.signal,...p?{duplex:"half"}:{},method:"GET",...a};l&&(d.method=l.toUpperCase());try{return await this.fetch.call(void 0,t,d)}finally{clearTimeout(c)}}async shouldRetry(t){const s=t.headers.get("x-should-retry");return s==="true"?!0:s==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,s,n,i){let o;const l=i?.get("retry-after-ms");if(l){const c=parseFloat(l);Number.isNaN(c)||(o=c)}const a=i?.get("retry-after");if(a&&!o){const c=parseFloat(a);Number.isNaN(c)?o=Date.parse(a)-Date.now():o=c*1e3}if(!(o&&0<=o&&o<60*1e3)){const c=t.maxRetries??this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(s,c)}return await Qn(o),this.makeRequest(t,s-1,n)}calculateDefaultRetryTimeoutMillis(t,s){const o=s-t,l=Math.min(.5*Math.pow(2,o),8),a=1-Math.random()*.25;return l*a*1e3}async buildRequest(t,{retryCount:s=0}={}){const n={...t},{method:i,path:o,query:l,defaultBaseURL:a}=n,c=this.buildURL(o,l,a);"timeout"in n&&ry("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const{bodyHeaders:p,body:d}=this.buildBody({options:n}),m=await this.buildHeaders({options:t,method:i,bodyHeaders:p,retryCount:s});return{req:{method:i,headers:m,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&d instanceof globalThis.ReadableStream&&{duplex:"half"},...d&&{body:d},...this.fetchOptions??{},...n.fetchOptions??{}},url:c,timeout:n.timeout}}async buildHeaders({options:t,method:s,bodyHeaders:n,retryCount:i}){let o={};this.idempotencyHeader&&s!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=t.idempotencyKey);const l=ze([o,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i),...t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{},...ly(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(t),this._options.defaultHeaders,n,t.headers]);return this.validateHeaders(l),l.values}buildBody({options:{body:t,headers:s}}){if(!t)return{bodyHeaders:void 0,body:void 0};const n=ze([s]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&n.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:up(t)}:me(this,qi,"f").call(this,{body:t,headers:n})}}ad=Je,qi=new WeakMap,hc=new WeakSet,kf=function(){return this.baseURL!=="https://api.openai.com/v1"};Je.OpenAI=ad;Je.DEFAULT_TIMEOUT=6e5;Je.OpenAIError=Me;Je.APIError=Jt;Je.APIConnectionError=ja;Je.APIConnectionTimeoutError=Dc;Je.APIUserAbortError=vr;Je.NotFoundError=rp;Je.ConflictError=sp;Je.RateLimitError=ip;Je.BadRequestError=Zm;Je.AuthenticationError=ep;Je.InternalServerError=ap;Je.PermissionDeniedError=tp;Je.UnprocessableEntityError=np;Je.InvalidWebhookSignatureError=An;Je.toFile=Oy;Je.Completions=tf;Je.Chat=Hc;Je.Embeddings=nf;Je.Files=of;Je.Images=mf;Je.Audio=ei;Je.Moderations=ff;Je.Models=pf;Je.FineTuning=xn;Je.Graders=td;Je.VectorStores=Ea;Je.Webhooks=_f;Je.Beta=ti;Je.Batches=Xp;Je.Uploads=id;Je.Responses=nd;Je.Realtime=rd;Je.Conversations=Xc;Je.Evals=Jc;Je.Containers=Kc;const Nf=new Je({apiKey:"demo-key",dangerouslyAllowBrowser:!0});async function Sf(r){try{const t=ab(r),n=(await Nf.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"system",content:`You are a senior intelligence analyst expert in deception detection using CIA Structured Analytic Techniques (SATS). You follow the MOM-POP-MOSES-EVE framework developed by Richards J. Heuer Jr. for the CIA.

Your analysis must be:
- Conservative and evidence-based
- Follow intelligence community standards
- Provide actionable recommendations
- Consider alternative explanations
- Focus on what can be eliminated rather than confirmed`},{role:"user",content:t}],temperature:.2,max_tokens:3e3})).choices[0]?.message?.content;if(!n)throw new Error("No response from AI service");let i;try{i=JSON.parse(n)}catch(l){throw console.error("Failed to parse AI deception analysis response:",l),console.error("AI response content:",n?.substring(0,200)),new Error("Invalid JSON response from AI deception analysis")}const o=Gr(i.scores);return{scores:i.scores,assessment:o,executiveSummary:i.executiveSummary,bottomLine:i.bottomLine,deceptionLikelihood:o.overallLikelihood,keyIndicators:i.keyIndicators||[],counterIndicators:i.counterIndicators||[],recommendations:i.recommendations||[],collectionPriorities:i.collectionPriorities||[],riskMitigation:i.riskMitigation||[],alternativeExplanations:i.alternativeExplanations||[],confidenceFactors:i.confidenceFactors||{strengths:[],weaknesses:[]},trendAssessment:i.trendAssessment||"STABLE",indicatorsToWatch:i.indicatorsToWatch||[]}}catch(t){return console.error("Error in AI deception analysis:",t),ob(r)}}function ab(r){return`Conduct a deception detection analysis using the MOM-POP-MOSES-EVE framework.

SCENARIO:
${r.scenario}

${r.mom?`MOM (Motive, Opportunity, Means) ANALYSIS:
${r.mom}
`:""}
${r.pop?`POP (Patterns of Practice) ANALYSIS:
${r.pop}
`:""}
${r.moses?`MOSES (My Own Sources) ANALYSIS:
${r.moses}
`:""}
${r.eve?`EVE (Evaluation of Evidence) ANALYSIS:
${r.eve}
`:""}
${r.additionalContext?`ADDITIONAL CONTEXT:
${r.additionalContext}
`:""}

SCORING CRITERIA:
Assign scores (0-5) for each criterion based on the scenario and analysis:

MOM (Motive, Opportunity, Means):
- Motive: ${bt.motive.levels.map(t=>`${t.value}=${t.label}`).join(", ")}
- Opportunity: ${bt.opportunity.levels.map(t=>`${t.value}=${t.label}`).join(", ")}
- Means: ${bt.means.levels.map(t=>`${t.value}=${t.label}`).join(", ")}

POP (Patterns of Practice):
- Historical Pattern: ${bt.historicalPattern.levels.map(t=>`${t.value}=${t.label}`).join(", ")}
- Sophistication: ${bt.sophisticationLevel.levels.map(t=>`${t.value}=${t.label}`).join(", ")}
- Success Rate: ${bt.successRate.levels.map(t=>`${t.value}=${t.label}`).join(", ")}

MOSES (My Own Sources):
- Source Vulnerability: ${bt.sourceVulnerability.levels.map(t=>`${t.value}=${t.label}`).join(", ")}
- Manipulation Evidence: ${bt.manipulationEvidence.levels.map(t=>`${t.value}=${t.label}`).join(", ")}

EVE (Evaluation of Evidence):
- Internal Consistency: ${bt.internalConsistency.levels.map(t=>`${t.value}=${t.label}`).join(", ")}
- External Corroboration: ${bt.externalCorroboration.levels.map(t=>`${t.value}=${t.label}`).join(", ")}
- Anomaly Detection: ${bt.anomalyDetection.levels.map(t=>`${t.value}=${t.label}`).join(", ")}

ANALYSIS REQUIREMENTS:

1. SCORING: Assign conservative scores for each criterion based on available information
2. EXECUTIVE SUMMARY: Write a 3-4 sentence commander's brief (BLUF style)
3. BOTTOM LINE: One sentence conclusion about deception likelihood
4. KEY INDICATORS: List 3-5 specific signs pointing to deception
5. COUNTER-INDICATORS: List 2-3 pieces of evidence against deception
6. RECOMMENDATIONS: Provide 3-4 actionable next steps
7. COLLECTION PRIORITIES: What additional information would help most?
8. RISK MITIGATION: How to reduce exposure if deception is occurring?
9. ALTERNATIVE EXPLANATIONS: What else could explain the situation?
10. CONFIDENCE FACTORS: What strengthens/weakens confidence in assessment?
11. TREND: Is deception risk INCREASING, STABLE, or DECREASING?
12. INDICATORS TO WATCH: What would change the assessment?

Return response as JSON:
{
  "scores": {
    "motive": number,
    "opportunity": number,
    "means": number,
    "historicalPattern": number,
    "sophisticationLevel": number,
    "successRate": number,
    "sourceVulnerability": number,
    "manipulationEvidence": number,
    "internalConsistency": number,
    "externalCorroboration": number,
    "anomalyDetection": number
  },
  "executiveSummary": "CDR, based on MOM-POP-MOSES-EVE analysis...",
  "bottomLine": "One sentence conclusion",
  "keyIndicators": ["indicator 1", "indicator 2", ...],
  "counterIndicators": ["counter 1", "counter 2", ...],
  "recommendations": ["rec 1", "rec 2", ...],
  "collectionPriorities": ["priority 1", "priority 2", ...],
  "riskMitigation": ["mitigation 1", "mitigation 2", ...],
  "alternativeExplanations": ["explanation 1", "explanation 2", ...],
  "confidenceFactors": {
    "strengths": ["strength 1", ...],
    "weaknesses": ["weakness 1", ...]
  },
  "trendAssessment": "INCREASING|STABLE|DECREASING",
  "indicatorsToWatch": ["indicator 1", "indicator 2", ...]
}

Be conservative in scoring. When in doubt, assign lower scores. Focus on what the evidence allows us to eliminate or confirm.`}function ob(r){const t=lb(r),s=Gr(t);return{scores:t,assessment:s,executiveSummary:`CDR, preliminary MOM-POP-MOSES-EVE analysis of the scenario suggests ${s.overallLikelihood}% likelihood of deception (${s.riskLevel} risk). Assessment based on available indicators with ${s.confidenceLevel.toLowerCase().replace("_"," ")} confidence. Recommend additional collection to refine estimate.`,bottomLine:`Deception likelihood assessed at ${s.overallLikelihood}% based on initial analysis.`,deceptionLikelihood:s.overallLikelihood,keyIndicators:["Scenario contains elements suggesting potential deception","Further analysis required to confirm indicators","AI-assisted analysis unavailable - manual review recommended"],counterIndicators:["Insufficient data for definitive counter-indicators","Alternative explanations possible"],recommendations:["Conduct detailed MOM-POP-MOSES-EVE analysis with subject matter experts","Seek additional sources to corroborate or refute indicators","Monitor for pattern changes or new information"],collectionPriorities:["Independent source verification","Historical deception pattern research","Source credibility assessment"],riskMitigation:["Treat information as potentially compromised until verified","Seek alternative information channels","Implement deception countermeasures"],alternativeExplanations:["Information may be accurate but misinterpreted","Coincidental patterns not indicative of deception","Partial truth mixed with inaccuracies"],confidenceFactors:{strengths:["Systematic framework application","Multiple criteria evaluation"],weaknesses:["Limited AI analysis","Incomplete scenario information","Requires expert validation"]},trendAssessment:"STABLE",indicatorsToWatch:["Changes in source behavior or access","New corroborating or contradicting evidence","Pattern shifts in adversary activities"]}}function lb(r){const t=`${r.scenario} ${r.mom||""} ${r.pop||""} ${r.moses||""} ${r.eve||""}`.toLowerCase(),s={motive:2,opportunity:2,means:2,historicalPattern:2,sophisticationLevel:2,successRate:2,sourceVulnerability:2,manipulationEvidence:2,internalConsistency:3,externalCorroboration:3,anomalyDetection:2};return(t.includes("gain")||t.includes("benefit")||t.includes("advantage"))&&(s.motive+=1),(t.includes("critical")||t.includes("survival")||t.includes("threat"))&&(s.motive+=1),(t.includes("control")||t.includes("monopoly")||t.includes("exclusive"))&&(s.opportunity+=1),(t.includes("state media")||t.includes("censorship"))&&(s.opportunity+=1),(t.includes("propaganda")||t.includes("sophisticated")||t.includes("capabilities"))&&(s.means+=1),(t.includes("denial")||t.includes("deception")||t.includes("maskirovka"))&&(s.means+=1),(t.includes("history")||t.includes("past")||t.includes("previous"))&&(s.historicalPattern+=1),(t.includes("pattern")||t.includes("repeatedly")||t.includes("routine"))&&(s.historicalPattern+=1),(t.includes("single source")||t.includes("limited access")||t.includes("vulnerable"))&&(s.sourceVulnerability+=1),(t.includes("compromised")||t.includes("controlled"))&&(s.sourceVulnerability+=1),(t.includes("inconsistent")||t.includes("contradicts")||t.includes("conflicting"))&&(s.internalConsistency=Math.max(0,s.internalConsistency-2),s.anomalyDetection+=2),(t.includes("no corroboration")||t.includes("unverified")||t.includes("uncorroborated"))&&(s.externalCorroboration=Math.max(0,s.externalCorroboration-2)),Object.keys(s).forEach(n=>{s[n]=Math.min(5,s[n])}),s}async function Cf(){try{return!1}catch{return!1}}async function cb(r,t){if(t&&t.length>=3)return db(t);const s=r.deceptionLikelihood,n=r.assessment.confidenceLevel==="VERY_HIGH"?5:r.assessment.confidenceLevel==="HIGH"?10:r.assessment.confidenceLevel==="MODERATE"?15:r.assessment.confidenceLevel==="LOW"?20:25;return{futureRisk:r.trendAssessment,confidenceInterval:{min:Math.max(0,s-n),max:Math.min(100,s+n)},keyDrivers:r.keyIndicators.slice(0,3),scenarioForecasts:[{condition:"If additional corroborating evidence emerges",impact:"Deception likelihood increases 15-25%",likelihood:40},{condition:"If independent sources contradict current assessment",impact:"Deception likelihood decreases 20-30%",likelihood:30},{condition:"If pattern continues unchanged",impact:"Assessment remains stable within confidence interval",likelihood:60}]}}function db(r){const t=r.map(l=>Gr(l).overallLikelihood),s=(t[t.length-1]-t[0])/t.length,n=s>5?"INCREASING":s<-5?"DECREASING":"STABLE",i=t[t.length-1],o=Math.max(...t)-Math.min(...t);return{futureRisk:n,confidenceInterval:{min:Math.max(0,i-o/2),max:Math.min(100,i+o/2)},keyDrivers:["Historical pattern analysis","Trend direction confirmed","Multiple data points"],scenarioForecasts:[{condition:"Trend continues at current rate",impact:`Deception likelihood ${n.toLowerCase()} by ${Math.abs(s).toFixed(0)}% per assessment`,likelihood:70},{condition:"Significant pattern disruption",impact:"Trend may reverse or accelerate",likelihood:20},{condition:"No new information",impact:"Assessment stabilizes around current level",likelihood:50}]}}function ub(){const{t:r}=Bt("deception");return{getCriterionLabel:t=>r(`criteria.${t}.label`),getCriterionDescription:t=>r(`criteria.${t}.description`),getLevelLabel:(t,s)=>r(`criteria.${t}.levels.${s}.label`),getLevelDescription:(t,s)=>r(`criteria.${t}.levels.${s}.description`),getLevels:t=>{const s=[];for(let n=0;n<=5;n++)s.push({value:n,label:r(`criteria.${t}.levels.${n}.label`),description:r(`criteria.${t}.levels.${n}.description`)});return s}}}function hb({scenario:r,initialScores:t,onScoresChange:s,onAIAnalysisComplete:n}){const{t:i}=Bt("deception"),o=ub(),[l,a]=B.useState({motive:t?.motive??0,opportunity:t?.opportunity??0,means:t?.means??0,historicalPattern:t?.historicalPattern??0,sophisticationLevel:t?.sophisticationLevel??0,successRate:t?.successRate??0,sourceVulnerability:t?.sourceVulnerability??0,manipulationEvidence:t?.manipulationEvidence??0,internalConsistency:t?.internalConsistency??5,externalCorroboration:t?.externalCorroboration??5,anomalyDetection:t?.anomalyDetection??0}),[c,p]=B.useState(Gr(l)),[d,m]=B.useState(!1),[y,h]=B.useState(!1);B.useEffect(()=>{Cf().then(h)},[]),B.useEffect(()=>{const u=Gr(l);p(u),s?.(l,u)},[l]);const _=(u,v)=>{a(g=>({...g,[u]:v[0]}))},b=async()=>{m(!0);try{const u=await Sf(r);a(u.scores),n?.(u)}catch(u){console.error("AI analysis failed:",u)}finally{m(!1)}},N=J0(c);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ge,{className:`border-2 ${qd(c.riskLevel)}`,children:[e.jsx(Ce,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Ae,{className:"text-2xl",children:i("assessment.deceptionLikelihood")}),e.jsx(Le,{children:i("assessment.realTimeScoring")})]}),y&&e.jsxs(te,{onClick:b,disabled:d,variant:"outline",children:[e.jsx(ft,{className:"h-4 w-4 mr-2"}),i(d?"form.analyzing":"form.aiAssist")]})]})}),e.jsx(xe,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-6xl font-bold mb-2",style:{color:c.overallLikelihood>=80?"#dc2626":c.overallLikelihood>=60?"#ea580c":c.overallLikelihood>=40?"#ca8a04":c.overallLikelihood>=20?"#2563eb":"#16a34a"},children:[c.overallLikelihood,"%"]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:i("assessment.overallLikelihood")}),e.jsxs("div",{className:`text-lg font-semibold mt-2 ${qd(c.riskLevel)}`,children:[i(`riskLevels.${c.riskLevel.toLowerCase()}`)," ",i("assessment.riskLevel")]})]}),e.jsxs("div",{className:"col-span-2 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:i("categories.mom.shortTitle")}),e.jsxs("span",{className:"text-sm font-bold",children:[c.categoryScores.mom.toFixed(1),"/5.0"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-red-500 h-2 rounded-full",style:{width:`${c.categoryScores.mom/5*100}%`}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:i("categories.pop.shortTitle")}),e.jsxs("span",{className:"text-sm font-bold",children:[c.categoryScores.pop.toFixed(1),"/5.0"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-orange-500 h-2 rounded-full",style:{width:`${c.categoryScores.pop/5*100}%`}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:i("categories.moses.shortTitle")}),e.jsxs("span",{className:"text-sm font-bold",children:[c.categoryScores.moses.toFixed(1),"/5.0"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-500 h-2 rounded-full",style:{width:`${c.categoryScores.moses/5*100}%`}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:i("categories.eve.shortTitle")}),e.jsxs("span",{className:"text-sm font-bold",children:[c.categoryScores.eve.toFixed(1),"/5.0"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${c.categoryScores.eve/5*100}%`}})}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:[e.jsx("span",{className:"text-sm font-medium",children:i("assessment.confidenceLevel")}),e.jsx("span",{className:`text-sm font-bold ${Y0(c.confidenceLevel)}`,children:i(`confidenceLevels.${c.confidenceLevel.toLowerCase().replace("_","")}`)})]})]})]})})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-red-500"}),i("categories.mom.title")]}),e.jsx(Le,{children:i("categories.mom.description")})]}),e.jsxs(xe,{className:"space-y-6",children:[e.jsx(kr,{criterion:"motive",label:o.getCriterionLabel("motive"),description:o.getCriterionDescription("motive"),value:l.motive,levels:o.getLevels("motive"),onChange:u=>_("motive",u)}),e.jsx(kr,{criterion:"opportunity",label:o.getCriterionLabel("opportunity"),description:o.getCriterionDescription("opportunity"),value:l.opportunity,levels:o.getLevels("opportunity"),onChange:u=>_("opportunity",u)}),e.jsx(kr,{criterion:"means",label:o.getCriterionLabel("means"),description:o.getCriterionDescription("means"),value:l.means,levels:o.getLevels("means"),onChange:u=>_("means",u)})]})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-orange-500"}),i("categories.pop.title")]}),e.jsx(Le,{children:i("categories.pop.description")})]}),e.jsxs(xe,{className:"space-y-6",children:[e.jsx(kr,{criterion:"historicalPattern",label:o.getCriterionLabel("historicalPattern"),description:o.getCriterionDescription("historicalPattern"),value:l.historicalPattern,levels:o.getLevels("historicalPattern"),onChange:u=>_("historicalPattern",u)}),e.jsx(kr,{criterion:"sophisticationLevel",label:o.getCriterionLabel("sophisticationLevel"),description:o.getCriterionDescription("sophisticationLevel"),value:l.sophisticationLevel,levels:o.getLevels("sophisticationLevel"),onChange:u=>_("sophisticationLevel",u)}),e.jsx(kr,{criterion:"successRate",label:o.getCriterionLabel("successRate"),description:o.getCriterionDescription("successRate"),value:l.successRate,levels:o.getLevels("successRate"),onChange:u=>_("successRate",u)})]})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-yellow-500"}),i("categories.moses.title")]}),e.jsx(Le,{children:i("categories.moses.description")})]}),e.jsxs(xe,{className:"space-y-6",children:[e.jsx(kr,{criterion:"sourceVulnerability",label:o.getCriterionLabel("sourceVulnerability"),description:o.getCriterionDescription("sourceVulnerability"),value:l.sourceVulnerability,levels:o.getLevels("sourceVulnerability"),onChange:u=>_("sourceVulnerability",u)}),e.jsx(kr,{criterion:"manipulationEvidence",label:o.getCriterionLabel("manipulationEvidence"),description:o.getCriterionDescription("manipulationEvidence"),value:l.manipulationEvidence,levels:o.getLevels("manipulationEvidence"),onChange:u=>_("manipulationEvidence",u)})]})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-blue-500"}),i("categories.eve.title")]}),e.jsx(Le,{children:i("categories.eve.description")})]}),e.jsxs(xe,{className:"space-y-6",children:[e.jsx(kr,{criterion:"internalConsistency",label:o.getCriterionLabel("internalConsistency"),description:o.getCriterionDescription("internalConsistency"),value:l.internalConsistency,levels:o.getLevels("internalConsistency"),onChange:u=>_("internalConsistency",u),inverted:!0}),e.jsx(kr,{criterion:"externalCorroboration",label:o.getCriterionLabel("externalCorroboration"),description:o.getCriterionDescription("externalCorroboration"),value:l.externalCorroboration,levels:o.getLevels("externalCorroboration"),onChange:u=>_("externalCorroboration",u),inverted:!0}),e.jsx(kr,{criterion:"anomalyDetection",label:o.getCriterionLabel("anomalyDetection"),description:o.getCriterionDescription("anomalyDetection"),value:l.anomalyDetection,levels:o.getLevels("anomalyDetection"),onChange:u=>_("anomalyDetection",u)})]})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:i("indicators.title")}),e.jsx(Le,{children:i("indicators.description")})]}),e.jsxs(xe,{className:"space-y-4",children:[N.deceptionIndicators.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-red-600 dark:text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(Rr,{className:"h-4 w-4"}),i("indicators.deceptionIndicators")]}),e.jsx("ul",{className:"space-y-1",children:N.deceptionIndicators.map((u,v)=>e.jsxs("li",{className:"text-sm text-gray-700 dark:text-gray-300 flex items-start gap-2",children:[e.jsx(Hr,{className:"h-4 w-4 text-red-500 mt-0.5 flex-shrink-0"}),u]},v))})]}),N.counterIndicators.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-green-600 dark:text-green-400 mb-2 flex items-center gap-2",children:[e.jsx(jr,{className:"h-4 w-4"}),i("indicators.counterIndicators")]}),e.jsx("ul",{className:"space-y-1",children:N.counterIndicators.map((u,v)=>e.jsxs("li",{className:"text-sm text-gray-700 dark:text-gray-300 flex items-start gap-2",children:[e.jsx(Yn,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),u]},v))})]}),N.deceptionIndicators.length===0&&N.counterIndicators.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(fa,{className:"h-8 w-8 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:i("indicators.noIndicators")})]})]})]})]})}function kr({criterion:r,label:t,description:s,value:n,levels:i,onChange:o,inverted:l}){const a=i.find(c=>c.value===n);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{htmlFor:r,className:"font-medium",children:t}),e.jsx(qt,{children:e.jsxs(Ct,{children:[e.jsx(Et,{children:e.jsx(Pt,{className:"h-4 w-4 text-gray-400"})}),e.jsx(At,{children:e.jsx("p",{className:"max-w-xs",children:s})})]})})]}),e.jsxs("span",{className:"text-sm font-bold text-gray-700 dark:text-gray-300",children:[a?.label," (",n,"/5)"]})]}),e.jsx(ys,{id:r,min:0,max:5,step:1,value:[n],onValueChange:o,className:"w-full"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:l?i[i.length-1].label:i[0].label}),e.jsx("span",{children:l?i[0].label:i[i.length-1].label})]}),a&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 italic",children:a.description})]})}function Ef({scores:r,assessment:t,showHistorical:s=!1,historicalData:n=[]}){const{t:i}=Bt("deception"),o=B.useMemo(()=>t||Gr(r),[r,t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ge,{className:"border-2 border-primary/20",children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(Gi,{className:"h-5 w-5"}),i("dashboard.overallLikelihood")]}),e.jsx(Le,{children:i("dashboard.basedOnFramework")})]}),e.jsx(xe,{children:e.jsx(mb,{likelihood:o.overallLikelihood,riskLevel:o.riskLevel,confidenceLevel:o.confidenceLevel})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(yi,{title:i("dashboard.momRiskIndicators"),subtitle:i("dashboard.momSubtitle"),icon:e.jsx(Rr,{className:"h-4 w-4"}),score:o.categoryScores.mom,maxScore:15,items:[{label:i("criteria.motive.label"),value:r.motive||0,max:5},{label:i("criteria.opportunity.label"),value:r.opportunity||0,max:5},{label:i("criteria.means.label"),value:r.means||0,max:5}],color:"red",categoryScoreLabel:i("dashboard.categoryScore"),invertedLabel:i("dashboard.inverted")}),e.jsx(yi,{title:i("dashboard.popAnalysis"),subtitle:i("dashboard.popSubtitle"),icon:e.jsx(Hr,{className:"h-4 w-4"}),score:o.categoryScores.pop,maxScore:15,items:[{label:i("criteria.historicalPattern.label"),value:r.historicalPattern||0,max:5},{label:i("criteria.sophisticationLevel.label"),value:r.sophisticationLevel||0,max:5},{label:i("criteria.successRate.label"),value:r.successRate||0,max:5}],color:"orange",categoryScoreLabel:i("dashboard.categoryScore"),invertedLabel:i("dashboard.inverted")}),e.jsx(yi,{title:i("dashboard.mosesAssessment"),subtitle:i("dashboard.mosesSubtitle"),icon:e.jsx(Xn,{className:"h-4 w-4"}),score:o.categoryScores.moses,maxScore:10,items:[{label:i("criteria.sourceVulnerability.label"),value:r.sourceVulnerability||0,max:5},{label:i("criteria.manipulationEvidence.label"),value:r.manipulationEvidence||0,max:5}],color:"yellow",categoryScoreLabel:i("dashboard.categoryScore"),invertedLabel:i("dashboard.inverted")}),e.jsx(yi,{title:i("dashboard.eveEvaluation"),subtitle:i("dashboard.eveSubtitle"),icon:e.jsx(Hl,{className:"h-4 w-4"}),score:o.categoryScores.eve,maxScore:15,items:[{label:i("criteria.internalConsistency.label"),value:5-(r.internalConsistency||3),max:5,inverted:!0},{label:i("criteria.externalCorroboration.label"),value:5-(r.externalCorroboration||3),max:5,inverted:!0},{label:i("criteria.anomalyDetection.label"),value:r.anomalyDetection||0,max:5}],color:"blue",categoryScoreLabel:i("dashboard.categoryScore"),invertedLabel:i("dashboard.inverted")})]}),e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(Hl,{className:"h-5 w-5"}),i("dashboard.riskFactorMatrix")]})}),e.jsx(xe,{children:e.jsx(pb,{scores:r,assessment:o,labels:{motive:i("criteria.motive.label"),opportunity:i("criteria.opportunity.label"),means:i("criteria.means.label"),historicalPattern:i("criteria.historicalPattern.label"),sophistication:i("criteria.sophisticationLevel.label"),successRate:i("criteria.successRate.label"),sourceVulnerability:i("criteria.sourceVulnerability.label"),manipulationEvidence:i("criteria.manipulationEvidence.label"),anomalyDetection:i("criteria.anomalyDetection.label"),internalConsistency:i("criteria.internalConsistency.label"),externalCorroboration:i("criteria.externalCorroboration.label"),overallLikelihood:i("dashboard.overallLikelihoodLabel")},legend:{low:i("dashboard.matrixLegend.low"),medium:i("dashboard.matrixLegend.medium"),high:i("dashboard.matrixLegend.high"),critical:i("dashboard.matrixLegend.critical")}})})]}),s&&n.length>0&&e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(Hr,{className:"h-5 w-5"}),i("dashboard.historicalTrend")]}),e.jsx(Le,{children:i("dashboard.likelihoodOverTime")})]}),e.jsx(xe,{children:e.jsx(fb,{data:n,assessmentsLabel:i("dashboard.assessments"),trendLabel:i("dashboard.trend")})})]})]})}function mb({likelihood:r,riskLevel:t,confidenceLevel:s}){const i=r/100*180,o=-90+i,l=120,a=Math.cos(o*Math.PI/180)*l,c=Math.sin(o*Math.PI/180)*l,p=t==="CRITICAL"?"#dc2626":t==="HIGH"?"#ea580c":t==="MEDIUM"?"#ca8a04":t==="LOW"?"#16a34a":"#059669";return e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsx("div",{className:"relative",children:e.jsxs("svg",{width:"300",height:"180",viewBox:"0 0 300 180",className:"overflow-visible",children:[e.jsx("path",{d:"M 30 150 A 120 120 0 0 1 270 150",fill:"none",stroke:"currentColor",strokeWidth:"20",className:"text-muted/20"}),e.jsx("path",{d:"M 30 150 A 120 120 0 0 1 90 56",fill:"none",stroke:"#16a34a",strokeWidth:"20",opacity:"0.6"}),e.jsx("path",{d:"M 90 56 A 120 120 0 0 1 150 30",fill:"none",stroke:"#ca8a04",strokeWidth:"20",opacity:"0.6"}),e.jsx("path",{d:"M 150 30 A 120 120 0 0 1 210 56",fill:"none",stroke:"#ea580c",strokeWidth:"20",opacity:"0.6"}),e.jsx("path",{d:"M 210 56 A 120 120 0 0 1 270 150",fill:"none",stroke:"#dc2626",strokeWidth:"20",opacity:"0.6"}),e.jsx("path",{d:`M 30 150 A 120 120 0 ${i>90?1:0} 1 ${150+a} ${150+c}`,fill:"none",stroke:p,strokeWidth:"20",strokeLinecap:"round"}),e.jsxs("g",{transform:"translate(150, 150)",children:[e.jsx("line",{x1:"0",y1:"0",x2:a,y2:c,stroke:p,strokeWidth:"3",strokeLinecap:"round"}),e.jsx("circle",{cx:"0",cy:"0",r:"8",fill:p})]}),e.jsx("text",{x:"30",y:"170",fontSize:"12",fill:"currentColor",className:"text-xs opacity-60",children:"0%"}),e.jsx("text",{x:"135",y:"20",fontSize:"12",fill:"currentColor",className:"text-xs opacity-60",children:"50%"}),e.jsx("text",{x:"260",y:"170",fontSize:"12",fill:"currentColor",className:"text-xs opacity-60",children:"100%"})]})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("div",{className:"text-5xl font-bold",style:{color:p},children:[r,"%"]}),e.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[e.jsxs(he,{variant:"outline",className:"text-sm",style:{borderColor:p,color:p},children:[t.replace("_"," ")," RISK"]}),e.jsxs(he,{variant:"secondary",className:"text-sm",children:[s.replace("_"," ")," CONFIDENCE"]})]})]})]})}function yi({title:r,subtitle:t,icon:s,score:n,maxScore:i,items:o,color:l,categoryScoreLabel:a,invertedLabel:c}){const p=n/i*100,d={red:"text-red-600 bg-red-500/10 border-red-500/20",orange:"text-orange-600 bg-orange-500/10 border-orange-500/20",yellow:"text-yellow-600 bg-yellow-500/10 border-yellow-500/20",blue:"text-blue-600 bg-blue-500/10 border-blue-500/20"},m={red:"bg-red-500",orange:"bg-orange-500",yellow:"bg-yellow-500",blue:"bg-blue-500"};return e.jsxs(ge,{className:`border ${d[l]}`,children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2 text-base",children:[s,r]}),e.jsx(Le,{className:"text-xs",children:t})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"font-medium",children:a}),e.jsxs("span",{className:"font-bold",children:[n.toFixed(1),"/",i]})]}),e.jsx(Fs,{value:p,className:"h-2"})]}),e.jsx("div",{className:"space-y-3",children:o.map((y,h)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsxs("span",{className:"text-muted-foreground",children:[y.label,y.inverted&&e.jsx("span",{className:"ml-1 text-orange-500",children:c})]}),e.jsxs("span",{className:"font-medium",children:[y.value,"/",y.max]})]}),e.jsx("div",{className:"h-1.5 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${m[l]} transition-all duration-300`,style:{width:`${y.value/y.max*100}%`}})})]},h))})]})]})}function pb({scores:r,assessment:t,labels:s,legend:n}){const i=[[{label:s.motive,value:r.motive||0,category:"MOM"},{label:s.opportunity,value:r.opportunity||0,category:"MOM"},{label:s.means,value:r.means||0,category:"MOM"}],[{label:s.historicalPattern,value:r.historicalPattern||0,category:"POP"},{label:s.sophistication,value:r.sophisticationLevel||0,category:"POP"},{label:s.successRate,value:r.successRate||0,category:"POP"}],[{label:s.sourceVulnerability,value:r.sourceVulnerability||0,category:"MOSES"},{label:s.manipulationEvidence,value:r.manipulationEvidence||0,category:"MOSES"},{label:s.anomalyDetection,value:r.anomalyDetection||0,category:"EVE"}],[{label:s.internalConsistency,value:5-(r.internalConsistency||3),category:"EVE",inverted:!0},{label:s.externalCorroboration,value:5-(r.externalCorroboration||3),category:"EVE",inverted:!0},{label:s.overallLikelihood,value:Math.round(t.overallLikelihood/20),category:"ALL"}]];return e.jsxs("div",{className:"space-y-1",children:[i.map((o,l)=>e.jsx("div",{className:"flex gap-1",children:o.map((a,c)=>{const p=a.value/5,d=p>=.8?"bg-red-500":p>=.6?"bg-orange-500":p>=.4?"bg-yellow-500":p>=.2?"bg-green-500":"bg-green-600",m=p>=.4?"text-white":"text-gray-900";return e.jsxs("div",{className:`flex-1 p-3 rounded text-center transition-all duration-300 ${d} ${m}`,style:{opacity:.3+p*.7},children:[e.jsx("div",{className:"text-xs font-medium mb-1",children:a.label}),e.jsxs("div",{className:"text-lg font-bold",children:[a.inverted&&e.jsx("span",{className:"text-xs",children:"~"}),a.value,a.category==="ALL"&&e.jsx("span",{className:"text-xs",children:"â˜…"})]}),e.jsx("div",{className:"text-xs opacity-75",children:a.category})]},c)})},l)),e.jsxs("div",{className:"flex gap-2 mt-4 text-xs text-muted-foreground justify-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded"}),e.jsx("span",{children:n.low})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded"}),e.jsx("span",{children:n.medium})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded"}),e.jsx("span",{children:n.high})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{children:n.critical})]})]})]})}function fb({data:r,assessmentsLabel:t,trendLabel:s}){const l={top:20,right:20,bottom:40,left:50},a=600-l.left-l.right,c=200-l.top-l.bottom,p=r.map((_,b)=>({x:l.left+b/(r.length-1)*a,y:l.top+c-_.likelihood/100*c,value:_.likelihood,timestamp:_.timestamp})),d=p.map((_,b)=>`${b===0?"M":"L"} ${_.x} ${_.y}`).join(" "),m=r.length>=2?r[r.length-1].likelihood-r[0].likelihood:0,y=m>5?Hr:m<-5?Yn:fa,h=m>5?"text-red-500":m<-5?"text-green-500":"text-gray-500";return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[r.length," ",t]}),e.jsxs("div",{className:`flex items-center gap-2 ${h}`,children:[e.jsx(y,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm font-medium",children:[m>0&&"+",m.toFixed(1),"% ",s]})]})]}),e.jsxs("svg",{width:600,height:200,className:"w-full",children:[[0,25,50,75,100].map(_=>{const b=l.top+c-_/100*c;return e.jsxs("g",{children:[e.jsx("line",{x1:l.left,y1:b,x2:600-l.right,y2:b,stroke:"currentColor",strokeWidth:"1",className:"text-muted/20",strokeDasharray:"4 4"}),e.jsxs("text",{x:l.left-10,y:b+4,fontSize:"10",fill:"currentColor",className:"text-muted-foreground",textAnchor:"end",children:[_,"%"]})]},_)}),e.jsx("path",{d,fill:"none",stroke:"currentColor",strokeWidth:"2",className:"text-primary"}),e.jsx("path",{d:`${d} L ${p[p.length-1].x} ${l.top+c} L ${l.left} ${l.top+c} Z`,fill:"currentColor",className:"text-primary/10"}),p.map((_,b)=>e.jsx("g",{children:e.jsx("circle",{cx:_.x,cy:_.y,r:"4",fill:"currentColor",className:"text-primary"})},b)),p.map((_,b)=>b%Math.ceil(p.length/5)===0||b===p.length-1?e.jsx("text",{x:_.x,y:190,fontSize:"10",fill:"currentColor",className:"text-muted-foreground",textAnchor:"middle",children:new Date(_.timestamp).toLocaleDateString("en-US",{month:"short",day:"numeric"})},b):null)]})]})}function gb({analysis:r,variant:t="outline",size:s="default",className:n}){const[i,o]=B.useState(!1),l=async()=>{o(!0);try{const a=new xa({orientation:"portrait",unit:"mm",format:"letter"}),c=r.calculatedAssessment||Gr(r.scores),p={primary:[30,58,138],critical:[220,38,38],high:[234,88,12],medium:[202,138,4],low:[22,163,74],text:[31,41,55],light:[249,250,251]};let d=20;const m=a.internal.pageSize.getWidth(),y=a.internal.pageSize.getHeight(),h=20,_=()=>{a.addPage(),d=20,b()},b=()=>{const A=a.internal.pages.length-1;A>1&&(a.setFontSize(9),a.setTextColor(100,116,139),a.text(`Page ${A}`,m-h-10,y-10))},N=A=>d+A>y-30?(_(),!0):!1;a.setFillColor(...p.primary),a.rect(0,0,m,80,"F"),a.setFontSize(22),a.setTextColor(255,255,255),a.setFont("helvetica","bold"),a.text("DECEPTION DETECTION ANALYSIS",m/2,35,{align:"center"}),a.text("MOM-POP-MOSES-EVE Framework",m/2,50,{align:"center"}),a.setFontSize(14),a.setFont("helvetica","normal"),a.text(r.title,m/2,65,{align:"center"}),d=100,a.setFontSize(12),a.setTextColor(...p.text),a.setFont("helvetica","bold"),a.text("Classification:",h,d),a.setFont("helvetica","normal"),a.text("UNCLASSIFIED",h+50,d),d+=10,a.setFont("helvetica","bold"),a.text("Date:",h,d),a.setFont("helvetica","normal"),a.text(r.lastUpdated?new Date(r.lastUpdated).toLocaleDateString():new Date().toLocaleDateString(),h+50,d),d+=10,a.setFont("helvetica","bold"),a.text("Framework:",h,d),a.setFont("helvetica","normal"),a.text("CIA SATS MOM-POP-MOSES-EVE",h+50,d),d+=25,N(60);const u=c.riskLevel==="CRITICAL"?p.critical:c.riskLevel==="HIGH"?p.high:c.riskLevel==="MEDIUM"?p.medium:p.low;if(a.setFillColor(...u),a.roundedRect(h,d,m-2*h,50,3,3,"F"),a.setFontSize(16),a.setTextColor(255,255,255),a.setFont("helvetica","bold"),a.text("OVERALL DECEPTION LIKELIHOOD",m/2,d+15,{align:"center"}),a.setFontSize(36),a.text(`${c.overallLikelihood}%`,m/2,d+32,{align:"center"}),a.setFontSize(14),a.text(`${c.riskLevel} RISK - ${c.confidenceLevel} CONFIDENCE`,m/2,d+45,{align:"center"}),d+=65,r.description){N(30),a.setFontSize(11),a.setTextColor(...p.text),a.setFont("helvetica","bold"),a.text("Description:",h,d),d+=6,a.setFont("helvetica","normal");const A=a.splitTextToSize(r.description,m-2*h);a.text(A,h,d),d+=A.length*5+10}_(),a.setFontSize(16),a.setTextColor(...p.primary),a.setFont("helvetica","bold"),a.text("SCENARIO DESCRIPTION",h,d),d+=10,a.setFontSize(10),a.setTextColor(...p.text),a.setFont("helvetica","normal");const v=a.splitTextToSize(r.scenario,m-2*h);if(a.text(v,h,d),d+=v.length*5+15,N(80),a.setFontSize(16),a.setTextColor(...p.primary),a.setFont("helvetica","bold"),a.text("CATEGORY SCORES",h,d),d+=12,[{name:"MOM (Motive, Opportunity, Means)",score:c.categoryScores.mom,max:15,color:p.critical},{name:"POP (Patterns of Practice)",score:c.categoryScores.pop,max:15,color:p.high},{name:"MOSES (Source Vulnerability)",score:c.categoryScores.moses,max:10,color:p.medium},{name:"EVE (Evidence Evaluation)",score:c.categoryScores.eve,max:15,color:p.low}].forEach(A=>{N(15),a.setFontSize(11),a.setTextColor(...p.text),a.setFont("helvetica","bold"),a.text(A.name,h,d),a.setFont("helvetica","normal"),a.text(`${A.score.toFixed(1)} / ${A.max}`,m-h-25,d),d+=5;const T=m-2*h,z=A.score/A.max*T;a.setFillColor(220,220,220),a.rect(h,d,T,5,"F"),a.setFillColor(...A.color),a.rect(h,d,z,5,"F"),d+=12}),r.mom){_(),a.setFontSize(16),a.setTextColor(...p.primary),a.setFont("helvetica","bold"),a.text("MOM ANALYSIS",h,d),a.setFontSize(11),a.setTextColor(...p.text),a.text("(Motive, Opportunity, Means)",h,d+6),d+=14,a.setFontSize(10),a.setFont("helvetica","normal");const A=a.splitTextToSize(r.mom,m-2*h);a.text(A,h,d),d+=A.length*5+10}if(r.pop){N(40),a.setFontSize(16),a.setTextColor(...p.primary),a.setFont("helvetica","bold"),a.text("POP ANALYSIS",h,d),a.setFontSize(11),a.setTextColor(...p.text),a.text("(Patterns of Practice)",h,d+6),d+=14,a.setFontSize(10),a.setFont("helvetica","normal");const A=a.splitTextToSize(r.pop,m-2*h);a.text(A,h,d),d+=A.length*5+10}if(r.moses){N(40),a.setFontSize(16),a.setTextColor(...p.primary),a.setFont("helvetica","bold"),a.text("MOSES ANALYSIS",h,d),a.setFontSize(11),a.setTextColor(...p.text),a.text("(My Own Sources Evaluation)",h,d+6),d+=14,a.setFontSize(10),a.setFont("helvetica","normal");const A=a.splitTextToSize(r.moses,m-2*h);a.text(A,h,d),d+=A.length*5+10}if(r.eve){N(40),a.setFontSize(16),a.setTextColor(...p.primary),a.setFont("helvetica","bold"),a.text("EVE ANALYSIS",h,d),a.setFontSize(11),a.setTextColor(...p.text),a.text("(Evaluation of Evidence)",h,d+6),d+=14,a.setFontSize(10),a.setFont("helvetica","normal");const A=a.splitTextToSize(r.eve,m-2*h);a.text(A,h,d),d+=A.length*5+10}_(),a.setFontSize(16),a.setTextColor(...p.primary),a.setFont("helvetica","bold"),a.text("DETAILED SCORING MATRIX",h,d),d+=12;const w=[["Criterion","Score","Category"],["Motive",(r.scores.motive||0).toFixed(1),"MOM"],["Opportunity",(r.scores.opportunity||0).toFixed(1),"MOM"],["Means",(r.scores.means||0).toFixed(1),"MOM"],["Historical Pattern",(r.scores.historicalPattern||0).toFixed(1),"POP"],["Sophistication Level",(r.scores.sophisticationLevel||0).toFixed(1),"POP"],["Success Rate",(r.scores.successRate||0).toFixed(1),"POP"],["Source Vulnerability",(r.scores.sourceVulnerability||0).toFixed(1),"MOSES"],["Manipulation Evidence",(r.scores.manipulationEvidence||0).toFixed(1),"MOSES"],["Internal Consistency",(r.scores.internalConsistency||3).toFixed(1),"EVE"],["External Corroboration",(r.scores.externalCorroboration||3).toFixed(1),"EVE"],["Anomaly Detection",(r.scores.anomalyDetection||0).toFixed(1),"EVE"]];if(Nc(a,{startY:d,head:[w[0]],body:w.slice(1),theme:"grid",headStyles:{fillColor:p.primary,textColor:[255,255,255],fontSize:10,fontStyle:"bold"},bodyStyles:{fontSize:9},alternateRowStyles:{fillColor:p.light},margin:{left:h,right:h}}),d=a.lastAutoTable.finalY+15,r.assessment){N(40),a.setFontSize(16),a.setTextColor(...p.primary),a.setFont("helvetica","bold"),a.text("OVERALL ASSESSMENT",h,d),d+=12,a.setFontSize(10),a.setTextColor(...p.text),a.setFont("helvetica","normal");const A=a.splitTextToSize(r.assessment,m-2*h);a.text(A,h,d)}if(r.aiAnalysis){if(_(),a.setFontSize(16),a.setTextColor(...p.primary),a.setFont("helvetica","bold"),a.text("AI-POWERED ANALYSIS",h,d),d+=12,r.aiAnalysis.bottomLine){a.setFontSize(11),a.setFont("helvetica","bold"),a.text("Bottom Line:",h,d),d+=6,a.setFontSize(10),a.setFont("helvetica","normal");const A=a.splitTextToSize(r.aiAnalysis.bottomLine,m-2*h);a.text(A,h,d),d+=A.length*5+10}if(r.aiAnalysis.executiveSummary){a.setFontSize(11),a.setFont("helvetica","bold"),a.text("Executive Summary:",h,d),d+=6,a.setFontSize(10),a.setFont("helvetica","normal");const A=a.splitTextToSize(r.aiAnalysis.executiveSummary,m-2*h);a.text(A,h,d),d+=A.length*5+10}r.aiAnalysis.keyIndicators&&r.aiAnalysis.keyIndicators.length>0&&(a.setFontSize(11),a.setFont("helvetica","bold"),a.text("Key Indicators:",h,d),d+=6,a.setFontSize(10),a.setFont("helvetica","normal"),r.aiAnalysis.keyIndicators.forEach(A=>{N(8),a.text(`â€¢ ${A}`,h+5,d),d+=5}),d+=5),r.aiAnalysis.recommendations&&r.aiAnalysis.recommendations.length>0&&(a.setFontSize(11),a.setFont("helvetica","bold"),a.text("Recommendations:",h,d),d+=6,a.setFontSize(10),a.setFont("helvetica","normal"),r.aiAnalysis.recommendations.forEach(A=>{N(8),a.text(`â€¢ ${A}`,h+5,d),d+=5}))}const k=a.internal.pages.length-1;for(let A=2;A<=k;A++)a.setPage(A),a.setFontSize(9),a.setTextColor(100,116,139),a.setFont("helvetica","italic"),a.text("Generated by OmniCore Research Tools - CIA SATS MOM-POP-MOSES-EVE Framework",m/2,y-10,{align:"center"});a.save(`Deception_Analysis_${r.title.replace(/[^a-z0-9]/gi,"_")}_${new Date().toISOString().split("T")[0]}.pdf`)}catch(a){console.error("PDF export error:",a),alert("Failed to export PDF. Please try again.")}finally{o(!1)}};return e.jsx(te,{variant:t,size:s,onClick:l,disabled:i,className:n,children:i?e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"h-4 w-4 mr-2 animate-spin"}),"Exporting PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(nr,{className:"h-4 w-4 mr-2"}),"Export PDF"]})})}function xb({onImport:r}){const[t,s]=B.useState(!1),[n,i]=B.useState(""),[o,l]=B.useState(!1),[a,c]=B.useState([]),[p,d]=B.useState([]),m=async()=>{if(n.trim())try{l(!0);const N=new URLSearchParams({q:n,limit:"10"}),u=await fetch(`/api/content-intelligence/search?${N}`,{credentials:"include"});if(!u.ok)throw new Error("Failed to search");const v=await u.json();v.success&&c(v.results||[])}catch(N){console.error("Error searching claims:",N)}finally{l(!1)}},y=N=>{d(u=>u.find(g=>g.claim_text===N.claim_text)?u.filter(g=>g.claim_text!==N.claim_text):[...u,N])},h=()=>{if(p.length===0)return{scores:{},eveIndicators:[],mosesIndicators:[]};const N=[],u=[];let v=0,g=0,w=0,k=0,A=0,T=0,z=0;if(p.forEach(J=>{if(!J.deception_analysis)return;const q=J.deception_analysis.methods;z++,v+=q.internal_consistency.score/20,g+=q.source_credibility.score/20,w+=q.evidence_quality.score/20,k+=q.logical_coherence.score/20,A+=q.temporal_consistency.score/20,T+=q.specificity.score/20,J.deception_analysis.red_flags.forEach(W=>{W.toLowerCase().includes("source")||W.toLowerCase().includes("credibility")?u.push(W):N.push(W)})}),z===0)return{scores:{},eveIndicators:[],mosesIndicators:[]};const S=v/z,U=g/z,G=w/z,F=k/z,C=A/z,j=T/z;return{scores:{internalConsistency:Math.round(Math.max(S,F,C)),externalCorroboration:Math.round(G),anomalyDetection:Math.round(5-j),sourceVulnerability:Math.round(5-U),manipulationEvidence:U<2?3:U<3?2:1},eveIndicators:N,mosesIndicators:u}},_=()=>{const{scores:N,eveIndicators:u,mosesIndicators:v}=h(),g=p.map((k,A)=>`Claim ${A+1}: ${k.claim_text}`).join(`

`),w=p.map(k=>`${k.claim_text}${k.source_url?` (Source: ${k.source_url})`:""}`);r({scenario:g,scores:N,claimReferences:w,eveIndicators:[...new Set(u)],mosesIndicators:[...new Set(v)]}),s(!1)},b=N=>{switch(N){case"high":return"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400";case"medium":return"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400";case"low":return"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400";default:return"bg-gray-100 text-gray-700 dark:bg-gray-900/20 dark:text-gray-400"}};return e.jsxs(wt,{open:t,onOpenChange:s,children:[e.jsx(Sm,{asChild:!0,children:e.jsxs(te,{variant:"outline",size:"sm",children:[e.jsx(Wl,{className:"h-4 w-4 mr-2"}),"Import from Claims"]})}),e.jsxs(jt,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsx(kt,{children:"Import Claims for Deception Analysis"}),e.jsx(It,{children:"Search for content with automated deception detection, then select claims to import into SATS framework"})]}),e.jsxs(Dt,{children:[e.jsx(ha,{className:"h-4 w-4"}),e.jsxs(Mt,{children:[e.jsx("strong",{children:"Auto-mapping:"})," Claim deception indicators will be automatically mapped to EVE (Evidence Evaluation) and MOSES (Source Vulnerability) categories"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ir,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ee,{placeholder:"Search analyzed content by topic, URL, or keyword...",value:n,onChange:N=>i(N.target.value),onKeyDown:N=>N.key==="Enter"&&m(),className:"pl-10"})]}),e.jsx(te,{onClick:m,disabled:o,children:o?e.jsx(xt,{className:"h-4 w-4 animate-spin"}):"Search"})]}),p.length>0&&e.jsxs(Dt,{className:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:[e.jsx(gr,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),e.jsxs(Mt,{children:[p.length," claim",p.length!==1?"s":""," selected"]})]}),a.length>0&&e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("h5",{className:"text-sm font-medium",children:["Results (",a.length,")"]}),a.map(N=>e.jsx(ge,{children:e.jsx(xe,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h6",{className:"font-medium text-sm",children:N.title}),N.url&&e.jsxs("a",{href:N.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline flex items-center gap-1 mt-1",children:["View Source ",e.jsx(ar,{className:"h-3 w-3"})]})]}),e.jsxs(he,{variant:"outline",className:"text-xs",children:[N.claim_count," ",N.claim_count===1?"claim":"claims"]})]}),N.claims&&N.claims.length>0&&e.jsx("div",{className:"space-y-2",children:N.claims.map((u,v)=>{const g=p.some(A=>A.claim_text===u.claim_text),w=u.deception_analysis?.overall_risk||"unknown",k=u.deception_analysis?.risk_score||0;return e.jsx("div",{className:`p-3 rounded-lg border-2 cursor-pointer transition-colors ${g?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,onClick:()=>y(u),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm",children:u.claim_text}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(he,{className:`text-xs ${b(w)}`,children:[w.toUpperCase()," (",k,"%)"]}),u.claim_category&&e.jsx(he,{variant:"outline",className:"text-xs",children:u.claim_category}),u.deception_analysis?.red_flags&&u.deception_analysis.red_flags.length>0&&e.jsxs(he,{variant:"outline",className:"text-xs text-orange-600 dark:text-orange-400",children:[e.jsx(Rr,{className:"h-3 w-3 mr-1"}),u.deception_analysis.red_flags.length," red flags"]})]})]}),g&&e.jsx(gr,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0"})]})},v)})})]})})},N.id))]}),o&&e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(xt,{className:"h-6 w-6 animate-spin text-muted-foreground"})}),!o&&a.length===0&&n&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(os,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"No analyzed content found. Try a different search term."]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(te,{variant:"outline",onClick:()=>s(!1),children:"Cancel"}),e.jsxs(te,{onClick:_,disabled:p.length===0,children:[e.jsx(Wl,{className:"h-4 w-4 mr-2"}),"Import ",p.length>0&&`(${p.length})`]})]})]})]})}function xu({mode:r,initialData:t,onSave:s,backPath:n="/dashboard/analysis-frameworks/deception",frameworkId:i}){const o=xr(),{t:l}=Bt("deception"),[a,c]=B.useState(t?.title||""),[p,d]=B.useState(t?.description||""),[m,y]=B.useState(t?.scenario||""),[h,_]=B.useState(t?.mom||""),[b,N]=B.useState(t?.pop||""),[u,v]=B.useState(t?.moses||""),[g,w]=B.useState(t?.eve||""),[k,A]=B.useState(t?.assessment||""),[T,z]=B.useState(t?.scores||{}),[S,U]=B.useState(t?.aiAnalysis||null),[G,F]=B.useState(t?.claimReferences||[]),[C,j]=B.useState("scenario"),[D,J]=B.useState(!1),[q,W]=B.useState(!1),[$,ne]=B.useState(!1),[K,P]=B.useState(null);B.useEffect(()=>{Cf().then(W)},[]);const Y=I=>{I.scenario&&y(I.scenario),I.mom&&Array.isArray(I.mom)&&_(I.mom.join(`
`)),I.pop&&Array.isArray(I.pop)&&N(I.pop.join(`
`)),I.moses&&Array.isArray(I.moses)&&v(I.moses.join(`
`)),I.eve&&Array.isArray(I.eve)&&w(I.eve.join(`
`)),I.scenario&&j("scenario")},re=async()=>{if(!m){P(l("errors.scenarioRequired"));return}ne(!0),P(null);try{const I=await Sf({scenario:m,mom:h,pop:b,moses:u,eve:g,additionalContext:k});U(I),z(I.scores),A(I.bottomLine+`

`+I.executiveSummary),j("assessment")}catch(I){console.error("AI analysis error:",I),P(l("errors.aiAnalysisFailed"))}finally{ne(!1)}},le=I=>{if(y(Q=>Q?`${Q}

--- Imported Claims ---
${I.scenario}`:I.scenario),I.mosesIndicators.length>0){const Q=I.mosesIndicators.map((X,V)=>`${V+1}. ${X}`).join(`
`);v(X=>X?`${X}

--- From Claims ---
${Q}`:Q)}if(I.eveIndicators.length>0){const Q=I.eveIndicators.map((X,V)=>`${V+1}. ${X}`).join(`
`);w(X=>X?`${X}

--- From Claims ---
${Q}`:Q)}z(Q=>({...Q,...I.scores})),F(I.claimReferences),j("scenario")},se=async()=>{if(!a||!m){P(l("errors.titleRequired"));return}J(!0),P(null);try{const I=Gr(T);await s({title:a,description:p,scenario:m,mom:h,pop:b,moses:u,eve:g,assessment:k,scores:T,aiAnalysis:S,calculatedAssessment:I,claimReferences:G,lastUpdated:new Date().toISOString()}),o(n)}catch(I){console.error("Save error:",I),P(l("errors.saveFailed"))}finally{J(!1)}},R=T&&Object.keys(T).length>0?Gr(T):null;return e.jsxs("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(te,{variant:"ghost",onClick:()=>o(n),className:"mb-4",children:[e.jsx(Ir,{className:"h-4 w-4 mr-2"}),l("form.backToAnalyses")]}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:l(r==="create"?"form.newAnalysis":"form.editAnalysis")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:l("subtitle")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(xb,{onImport:le}),e.jsx(Om,{framework:"deception",onExtract:Y}),q&&e.jsxs(te,{variant:"outline",onClick:re,disabled:$||!m,children:[e.jsx(ft,{className:"h-4 w-4 mr-2"}),l($?"form.analyzing":"form.aiAnalysis")]}),r==="edit"&&R&&e.jsx(gb,{analysis:{title:a,description:p,scenario:m,mom:h,pop:b,moses:u,eve:g,assessment:k,scores:T,aiAnalysis:S,calculatedAssessment:R,claimReferences:G,lastUpdated:new Date().toISOString()},variant:"outline"}),e.jsxs(te,{onClick:se,disabled:D,children:[e.jsx(on,{className:"h-4 w-4 mr-2"}),l(D?"form.saving":"form.saveAnalysis")]})]})]})]}),K&&e.jsxs(Dt,{variant:"destructive",className:"mb-6",children:[e.jsx(Rr,{className:"h-4 w-4"}),e.jsx(Mt,{children:K})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:l("basicInfo.title")}),e.jsx(Le,{children:l("basicInfo.description")})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(fe,{htmlFor:"title",children:[l("basicInfo.analysisTitle")," *"]}),e.jsx(Ee,{id:"title",value:a,onChange:I=>c(I.target.value),placeholder:l("basicInfo.analysisTitlePlaceholder")})]}),e.jsxs("div",{children:[e.jsx(fe,{htmlFor:"description",children:l("basicInfo.descriptionLabel")}),e.jsx($e,{id:"description",value:p,onChange:I=>d(I.target.value),placeholder:l("basicInfo.descriptionPlaceholder"),rows:2})]})]})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:l("sats.title")}),e.jsx(Le,{children:l("sats.description")})]}),e.jsx(xe,{children:e.jsxs(Ar,{value:C,onValueChange:j,children:[e.jsxs(Tr,{className:"grid grid-cols-6 w-full",children:[e.jsx(Ye,{value:"scenario",children:l("sats.tabs.scenario")}),e.jsx(Ye,{value:"mom",children:l("sats.tabs.mom")}),e.jsx(Ye,{value:"pop",children:l("sats.tabs.pop")}),e.jsx(Ye,{value:"moses",children:l("sats.tabs.moses")}),e.jsx(Ye,{value:"eve",children:l("sats.tabs.eve")}),e.jsx(Ye,{value:"assessment",children:l("sats.tabs.assessment")})]}),e.jsx(pt,{value:"scenario",className:"space-y-4 mt-4",children:e.jsxs("div",{children:[e.jsxs(fe,{htmlFor:"scenario",children:[l("scenario.title")," *",e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:l("scenario.description")})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx($e,{id:"scenario",value:m,onChange:I=>y(I.target.value),placeholder:l("scenario.placeholder"),rows:10}),e.jsx(gs,{fieldName:l("scenario.title"),currentValue:m,onAccept:I=>y(I),context:{framework:"Deception Detection (MOM-POP-MOSES-EVE)",relatedFields:{title:a,description:p,mom:h,pop:b,moses:u,eve:g,assessment:k}},placeholder:l("scenario.placeholder")})]})]})}),e.jsx(pt,{value:"mom",className:"space-y-4 mt-4",children:e.jsxs("div",{children:[e.jsxs(fe,{htmlFor:"mom",children:[l("categories.mom.fieldLabel"),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:l("categories.mom.fieldDescription")})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx($e,{id:"mom",value:h,onChange:I=>_(I.target.value),placeholder:l("categories.mom.placeholder"),rows:10}),e.jsx(gs,{fieldName:l("categories.mom.fieldLabel"),currentValue:h,onAccept:I=>_(I),context:{framework:"Deception Detection (MOM)",relatedFields:{scenario:m,pop:b,moses:u,eve:g}},placeholder:l("categories.mom.placeholder")})]})]})}),e.jsx(pt,{value:"pop",className:"space-y-4 mt-4",children:e.jsxs("div",{children:[e.jsxs(fe,{htmlFor:"pop",children:[l("categories.pop.fieldLabel"),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:l("categories.pop.fieldDescription")})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx($e,{id:"pop",value:b,onChange:I=>N(I.target.value),placeholder:l("categories.pop.placeholder"),rows:10}),e.jsx(gs,{fieldName:l("categories.pop.fieldLabel"),currentValue:b,onAccept:I=>N(I),context:{framework:"Deception Detection (POP)",relatedFields:{scenario:m,mom:h,moses:u,eve:g}},placeholder:l("categories.pop.placeholder")})]})]})}),e.jsx(pt,{value:"moses",className:"space-y-4 mt-4",children:e.jsxs("div",{children:[e.jsxs(fe,{htmlFor:"moses",children:[l("categories.moses.fieldLabel"),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:l("categories.moses.fieldDescription")})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx($e,{id:"moses",value:u,onChange:I=>v(I.target.value),placeholder:l("categories.moses.placeholder"),rows:10}),e.jsx(gs,{fieldName:l("categories.moses.fieldLabel"),currentValue:u,onAccept:I=>v(I),context:{framework:"Deception Detection (MOSES)",relatedFields:{scenario:m,mom:h,pop:b,eve:g}},placeholder:l("categories.moses.placeholder")})]})]})}),e.jsx(pt,{value:"eve",className:"space-y-4 mt-4",children:e.jsxs("div",{children:[e.jsxs(fe,{htmlFor:"eve",children:[l("categories.eve.fieldLabel"),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:l("categories.eve.fieldDescription")})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx($e,{id:"eve",value:g,onChange:I=>w(I.target.value),placeholder:l("categories.eve.placeholder"),rows:10}),e.jsx(gs,{fieldName:l("categories.eve.fieldLabel"),currentValue:g,onAccept:I=>w(I),context:{framework:"Deception Detection (EVE)",relatedFields:{scenario:m,mom:h,pop:b,moses:u}},placeholder:l("categories.eve.placeholder")})]})]})}),e.jsxs(pt,{value:"assessment",className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsxs(fe,{htmlFor:"assessment",children:[l("assessment.title"),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:l("assessment.description")})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx($e,{id:"assessment",value:k,onChange:I=>A(I.target.value),placeholder:l("assessment.placeholder"),rows:10}),e.jsx(gs,{fieldName:l("assessment.title"),currentValue:k,onAccept:I=>A(I),context:{framework:"Deception Detection (SATS)",relatedFields:{scenario:m,mom:h,pop:b,moses:u,eve:g,scores:T}},placeholder:l("assessment.placeholder")})]})]}),S&&e.jsxs(ge,{className:"bg-blue-50 dark:bg-blue-900/10 border-blue-200 dark:border-blue-800",children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"text-base flex items-center gap-2",children:[e.jsx(ft,{className:"h-4 w-4"}),l("aiResults.title")]})}),e.jsxs(xe,{className:"space-y-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("strong",{children:[l("aiResults.bottomLine"),":"]}),e.jsx("p",{className:"mt-1",children:S.bottomLine})]}),e.jsxs("div",{children:[e.jsxs("strong",{children:[l("aiResults.executiveSummary"),":"]}),e.jsx("p",{className:"mt-1",children:S.executiveSummary})]}),e.jsxs("div",{children:[e.jsxs("strong",{children:[l("aiResults.keyIndicators"),":"]}),e.jsx("ul",{className:"list-disc list-inside mt-1 space-y-1",children:S.keyIndicators.map((I,Q)=>e.jsx("li",{children:I},Q))})]}),e.jsxs("div",{children:[e.jsxs("strong",{children:[l("aiResults.recommendations"),":"]}),e.jsx("ul",{className:"list-disc list-inside mt-1 space-y-1",children:S.recommendations.slice(0,3).map((I,Q)=>e.jsx("li",{children:I},Q))})]})]})]})]})]})})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:l("scoring.title")}),e.jsx(Le,{children:l("scoring.description")})]}),e.jsx(xe,{children:e.jsx(hb,{scenario:m,initialScores:T,onScoresChange:z,onAIAnalysisComplete:I=>{U(I),A(I.bottomLine+`

`+I.executiveSummary)}})})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"sticky top-8 space-y-4",children:[R&&e.jsx(Ef,{scores:T,assessment:R}),!R&&e.jsx(ge,{children:e.jsxs(xe,{className:"text-center py-12",children:[e.jsx(Rr,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l("scoring.fillScoring")})]})})]})})]})]})}function yb({currentAnalysis:r,historicalData:t=[],scenario:s}){const[n,i]=B.useState(null),[o,l]=B.useState(!1);B.useEffect(()=>{a()},[r,t]);const a=async()=>{l(!0);try{const m=t.map(h=>h.scores),y=await cb(r,m);i(y)}catch(m){console.error("Failed to generate predictions:",m)}finally{l(!1)}};if(o)return e.jsx(ge,{children:e.jsx(xe,{className:"py-12 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Generating predictions..."})})});if(!n)return null;const c=n.futureRisk==="INCREASING"?Hr:n.futureRisk==="DECREASING"?Yn:fa,p=n.futureRisk==="INCREASING"?"text-red-600":n.futureRisk==="DECREASING"?"text-green-600":"text-gray-600",d=n.futureRisk==="INCREASING"?"bg-red-50 dark:bg-red-900/20":n.futureRisk==="DECREASING"?"bg-green-50 dark:bg-green-900/20":"bg-gray-50 dark:bg-gray-900/20";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ge,{className:`border-2 ${d}`,children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(c,{className:`h-5 w-5 ${p}`}),"Future Risk Trend"]}),e.jsx(Le,{children:"Projected trajectory of deception likelihood"})]}),e.jsxs(xe,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold",children:n.futureRisk}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Trend Direction"})]}),e.jsx(he,{variant:n.futureRisk==="INCREASING"?"destructive":n.futureRisk==="DECREASING"?"default":"secondary",className:"text-lg px-4 py-2",children:n.futureRisk})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Confidence Interval"}),e.jsxs("span",{className:"font-medium",children:[n.confidenceInterval.min,"% - ",n.confidenceInterval.max,"%"]})]}),e.jsxs("div",{className:"relative h-8 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute h-full bg-blue-500/30",style:{left:`${n.confidenceInterval.min}%`,width:`${n.confidenceInterval.max-n.confidenceInterval.min}%`}}),e.jsx("div",{className:"absolute h-full w-1 bg-blue-600",style:{left:`${r.deceptionLikelihood}%`}})]}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"0%"}),e.jsxs("span",{children:["Current: ",r.deceptionLikelihood,"%"]}),e.jsx("span",{children:"100%"})]})]})]})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-5 w-5"}),"Key Risk Drivers"]}),e.jsx(Le,{children:"Primary factors influencing deception assessment"})]}),e.jsx(xe,{children:e.jsx("div",{className:"space-y-3",children:n.keyDrivers.map((m,y)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:e.jsx("div",{className:"h-6 w-6 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-blue-600 dark:text-blue-400",children:y+1})})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm",children:m})})]},y))})})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(Xn,{className:"h-5 w-5"}),"Scenario Forecasts"]}),e.jsx(Le,{children:'"What if..." analysis for different conditions'})]}),e.jsx(xe,{children:e.jsx("div",{className:"space-y-4",children:n.scenarioForecasts.map((m,y)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm mb-1",children:m.condition}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.impact})]}),e.jsxs(he,{variant:"outline",className:"ml-2",children:[m.likelihood,"% likely"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:"Likelihood"}),e.jsxs("span",{className:"font-medium",children:[m.likelihood,"%"]})]}),e.jsx(Fs,{value:m.likelihood,className:"h-2"})]})]},y))})})]}),r.indicatorsToWatch&&r.indicatorsToWatch.length>0&&e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(Rr,{className:"h-5 w-5 text-yellow-600"}),"Indicators to Watch"]}),e.jsx(Le,{children:"Monitor these factors for changes in assessment"})]}),e.jsx(xe,{children:e.jsx("div",{className:"space-y-3",children:r.indicatorsToWatch.map((m,y)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[e.jsx(gr,{className:"h-5 w-5 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm",children:m})]},y))})})]}),t.length>0&&e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:"Historical Context"}),e.jsxs(Le,{children:["Based on ",t.length," previous assessment",t.length!==1?"s":""]})]}),e.jsx(xe,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"First Assessment"}),e.jsxs("span",{className:"font-medium",children:[t[0].likelihood,"% deception likelihood"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Latest Assessment"}),e.jsxs("span",{className:"font-medium",children:[t[t.length-1].likelihood,"% deception likelihood"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Change Over Time"}),e.jsxs("span",{className:`font-medium ${t[t.length-1].likelihood-t[0].likelihood>0?"text-red-600":"text-green-600"}`,children:[t[t.length-1].likelihood-t[0].likelihood>0?"+":"",(t[t.length-1].likelihood-t[0].likelihood).toFixed(1),"%"]})]})]})})]}),r.collectionPriorities&&r.collectionPriorities.length>0&&e.jsxs(ge,{className:"border-blue-200 dark:border-blue-800",children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-5 w-5 text-blue-600"}),"Collection Priorities"]}),e.jsx(Le,{children:"Additional information that would refine this assessment"})]}),e.jsx(xe,{children:e.jsx("ul",{className:"space-y-2",children:r.collectionPriorities.map((m,y)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx("span",{className:"text-blue-600 mt-0.5",children:"â€¢"}),e.jsx("span",{children:m})]},y))})})]})]})}var bb=Object.defineProperty,vb=Object.defineProperties,wb=Object.getOwnPropertyDescriptors,yu=Object.getOwnPropertySymbols,jb=Object.prototype.hasOwnProperty,_b=Object.prototype.propertyIsEnumerable,mc=(r,t,s)=>t in r?bb(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Qe=(r,t)=>{for(var s in t||(t={}))jb.call(t,s)&&mc(r,s,t[s]);if(yu)for(var s of yu(t))_b.call(t,s)&&mc(r,s,t[s]);return r},dn=(r,t)=>vb(r,wb(t)),ve=(r,t,s)=>mc(r,typeof t!="symbol"?t+"":t,s),kb=(r,t,s)=>new Promise((n,i)=>{var o=c=>{try{a(s.next(c))}catch(p){i(p)}},l=c=>{try{a(s.throw(c))}catch(p){i(p)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,l);a((s=s.apply(r,t)).next())});class oa{constructor(t){ve(this,"rootKey"),this.rootKey=t}}const Nb=Object.seal({});class _e extends oa{constructor(t){super(t),ve(this,"root"),this.root=new Array}prepForXml(t){var s;t.stack.push(this);const n=this.root.map(i=>i instanceof oa?i.prepForXml(t):i).filter(i=>i!==void 0);return t.stack.pop(),{[this.rootKey]:n.length?n.length===1&&((s=n[0])!=null&&s._attr)?n[0]:n:Nb}}addChildElement(t){return this.root.push(t),this}}class ls extends _e{prepForXml(t){const s=super.prepForXml(t);if(s&&(typeof s[this.rootKey]!="object"||Object.keys(s[this.rootKey]).length))return s}}class Ue extends oa{constructor(t){super("_attr"),ve(this,"xmlKeys"),this.root=t}prepForXml(t){const s={};return Object.entries(this.root).forEach(([n,i])=>{if(i!==void 0){const o=this.xmlKeys&&this.xmlKeys[n]||n;s[o]=i}}),{_attr:s}}}class ws extends oa{constructor(t){super("_attr"),this.root=t}prepForXml(t){return{_attr:Object.values(this.root).filter(({value:n})=>n!==void 0).reduce((n,{key:i,value:o})=>dn(Qe({},n),{[i]:o}),{})}}}class vt extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{val:"w:val",color:"w:color",fill:"w:fill",space:"w:space",sz:"w:sz",type:"w:type",rsidR:"w:rsidR",rsidRPr:"w:rsidRPr",rsidSect:"w:rsidSect",w:"w:w",h:"w:h",top:"w:top",right:"w:right",bottom:"w:bottom",left:"w:left",header:"w:header",footer:"w:footer",gutter:"w:gutter",linePitch:"w:linePitch",pos:"w:pos"})}}var zr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Af(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var eo={},bi={exports:{}},bu;function od(){if(bu)return bi.exports;bu=1;var r=typeof Reflect=="object"?Reflect:null,t=r&&typeof r.apply=="function"?r.apply:function(k,A,T){return Function.prototype.apply.call(k,A,T)},s;r&&typeof r.ownKeys=="function"?s=r.ownKeys:Object.getOwnPropertySymbols?s=function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:s=function(k){return Object.getOwnPropertyNames(k)};function n(w){console&&console.warn&&console.warn(w)}var i=Number.isNaN||function(k){return k!==k};function o(){o.init.call(this)}bi.exports=o,bi.exports.once=u,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var l=10;function a(w){if(typeof w!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(w){if(typeof w!="number"||w<0||i(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");l=w}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(k){if(typeof k!="number"||k<0||i(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this};function c(w){return w._maxListeners===void 0?o.defaultMaxListeners:w._maxListeners}o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(k){for(var A=[],T=1;T<arguments.length;T++)A.push(arguments[T]);var z=k==="error",S=this._events;if(S!==void 0)z=z&&S.error===void 0;else if(!z)return!1;if(z){var U;if(A.length>0&&(U=A[0]),U instanceof Error)throw U;var G=new Error("Unhandled error."+(U?" ("+U.message+")":""));throw G.context=U,G}var F=S[k];if(F===void 0)return!1;if(typeof F=="function")t(F,this,A);else for(var C=F.length,j=_(F,C),T=0;T<C;++T)t(j[T],this,A);return!0};function p(w,k,A,T){var z,S,U;if(a(A),S=w._events,S===void 0?(S=w._events=Object.create(null),w._eventsCount=0):(S.newListener!==void 0&&(w.emit("newListener",k,A.listener?A.listener:A),S=w._events),U=S[k]),U===void 0)U=S[k]=A,++w._eventsCount;else if(typeof U=="function"?U=S[k]=T?[A,U]:[U,A]:T?U.unshift(A):U.push(A),z=c(w),z>0&&U.length>z&&!U.warned){U.warned=!0;var G=new Error("Possible EventEmitter memory leak detected. "+U.length+" "+String(k)+" listeners added. Use emitter.setMaxListeners() to increase limit");G.name="MaxListenersExceededWarning",G.emitter=w,G.type=k,G.count=U.length,n(G)}return w}o.prototype.addListener=function(k,A){return p(this,k,A,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(k,A){return p(this,k,A,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function m(w,k,A){var T={fired:!1,wrapFn:void 0,target:w,type:k,listener:A},z=d.bind(T);return z.listener=A,T.wrapFn=z,z}o.prototype.once=function(k,A){return a(A),this.on(k,m(this,k,A)),this},o.prototype.prependOnceListener=function(k,A){return a(A),this.prependListener(k,m(this,k,A)),this},o.prototype.removeListener=function(k,A){var T,z,S,U,G;if(a(A),z=this._events,z===void 0)return this;if(T=z[k],T===void 0)return this;if(T===A||T.listener===A)--this._eventsCount===0?this._events=Object.create(null):(delete z[k],z.removeListener&&this.emit("removeListener",k,T.listener||A));else if(typeof T!="function"){for(S=-1,U=T.length-1;U>=0;U--)if(T[U]===A||T[U].listener===A){G=T[U].listener,S=U;break}if(S<0)return this;S===0?T.shift():b(T,S),T.length===1&&(z[k]=T[0]),z.removeListener!==void 0&&this.emit("removeListener",k,G||A)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(k){var A,T,z;if(T=this._events,T===void 0)return this;if(T.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):T[k]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete T[k]),this;if(arguments.length===0){var S=Object.keys(T),U;for(z=0;z<S.length;++z)U=S[z],U!=="removeListener"&&this.removeAllListeners(U);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(A=T[k],typeof A=="function")this.removeListener(k,A);else if(A!==void 0)for(z=A.length-1;z>=0;z--)this.removeListener(k,A[z]);return this};function y(w,k,A){var T=w._events;if(T===void 0)return[];var z=T[k];return z===void 0?[]:typeof z=="function"?A?[z.listener||z]:[z]:A?N(z):_(z,z.length)}o.prototype.listeners=function(k){return y(this,k,!0)},o.prototype.rawListeners=function(k){return y(this,k,!1)},o.listenerCount=function(w,k){return typeof w.listenerCount=="function"?w.listenerCount(k):h.call(w,k)},o.prototype.listenerCount=h;function h(w){var k=this._events;if(k!==void 0){var A=k[w];if(typeof A=="function")return 1;if(A!==void 0)return A.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]};function _(w,k){for(var A=new Array(k),T=0;T<k;++T)A[T]=w[T];return A}function b(w,k){for(;k+1<w.length;k++)w[k]=w[k+1];w.pop()}function N(w){for(var k=new Array(w.length),A=0;A<k.length;++A)k[A]=w[A].listener||w[A];return k}function u(w,k){return new Promise(function(A,T){function z(U){w.removeListener(k,S),T(U)}function S(){typeof w.removeListener=="function"&&w.removeListener("error",z),A([].slice.call(arguments))}g(w,k,S,{once:!0}),k!=="error"&&v(w,z,{once:!0})})}function v(w,k,A){typeof w.on=="function"&&g(w,"error",k,A)}function g(w,k,A,T){if(typeof w.on=="function")T.once?w.once(k,A):w.on(k,A);else if(typeof w.addEventListener=="function")w.addEventListener(k,function z(S){T.once&&w.removeEventListener(k,z),A(S)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof w)}return bi.exports}var vi={exports:{}},vu;function js(){return vu||(vu=1,typeof Object.create=="function"?vi.exports=function(t,s){s&&(t.super_=s,t.prototype=Object.create(s.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:vi.exports=function(t,s){if(s){t.super_=s;var n=function(){};n.prototype=s.prototype,t.prototype=new n,t.prototype.constructor=t}}),vi.exports}function Sb(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Tf={exports:{}},Nt=Tf.exports={},Mr,$r;function pc(){throw new Error("setTimeout has not been defined")}function fc(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Mr=setTimeout:Mr=pc}catch{Mr=pc}try{typeof clearTimeout=="function"?$r=clearTimeout:$r=fc}catch{$r=fc}})();function If(r){if(Mr===setTimeout)return setTimeout(r,0);if((Mr===pc||!Mr)&&setTimeout)return Mr=setTimeout,setTimeout(r,0);try{return Mr(r,0)}catch{try{return Mr.call(null,r,0)}catch{return Mr.call(this,r,0)}}}function Cb(r){if($r===clearTimeout)return clearTimeout(r);if(($r===fc||!$r)&&clearTimeout)return $r=clearTimeout,clearTimeout(r);try{return $r(r)}catch{try{return $r.call(null,r)}catch{return $r.call(this,r)}}}var is=[],nn=!1,Rs,Wi=-1;function Eb(){!nn||!Rs||(nn=!1,Rs.length?is=Rs.concat(is):Wi=-1,is.length&&Rf())}function Rf(){if(!nn){var r=If(Eb);nn=!0;for(var t=is.length;t;){for(Rs=is,is=[];++Wi<t;)Rs&&Rs[Wi].run();Wi=-1,t=is.length}Rs=null,nn=!1,Cb(r)}}Nt.nextTick=function(r){var t=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];is.push(new Of(r,t)),is.length===1&&!nn&&If(Rf)};function Of(r,t){this.fun=r,this.array=t}Of.prototype.run=function(){this.fun.apply(null,this.array)};Nt.title="browser";Nt.browser=!0;Nt.env={};Nt.argv=[];Nt.version="";Nt.versions={};function cs(){}Nt.on=cs;Nt.addListener=cs;Nt.once=cs;Nt.off=cs;Nt.removeListener=cs;Nt.removeAllListeners=cs;Nt.emit=cs;Nt.prependListener=cs;Nt.prependOnceListener=cs;Nt.listeners=function(r){return[]};Nt.binding=function(r){throw new Error("process.binding is not supported")};Nt.cwd=function(){return"/"};Nt.chdir=function(r){throw new Error("process.chdir is not supported")};Nt.umask=function(){return 0};var Ab=Tf.exports;const Xe=Sb(Ab);var to,wu;function Ff(){return wu||(wu=1,to=od().EventEmitter),to}var ro={},_n={},ju;function Tb(){if(ju)return _n;ju=1,_n.byteLength=a,_n.toByteArray=p,_n.fromByteArray=y;for(var r=[],t=[],s=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,o=n.length;i<o;++i)r[i]=n[i],t[n.charCodeAt(i)]=i;t[45]=62,t[95]=63;function l(h){var _=h.length;if(_%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var b=h.indexOf("=");b===-1&&(b=_);var N=b===_?0:4-b%4;return[b,N]}function a(h){var _=l(h),b=_[0],N=_[1];return(b+N)*3/4-N}function c(h,_,b){return(_+b)*3/4-b}function p(h){var _,b=l(h),N=b[0],u=b[1],v=new s(c(h,N,u)),g=0,w=u>0?N-4:N,k;for(k=0;k<w;k+=4)_=t[h.charCodeAt(k)]<<18|t[h.charCodeAt(k+1)]<<12|t[h.charCodeAt(k+2)]<<6|t[h.charCodeAt(k+3)],v[g++]=_>>16&255,v[g++]=_>>8&255,v[g++]=_&255;return u===2&&(_=t[h.charCodeAt(k)]<<2|t[h.charCodeAt(k+1)]>>4,v[g++]=_&255),u===1&&(_=t[h.charCodeAt(k)]<<10|t[h.charCodeAt(k+1)]<<4|t[h.charCodeAt(k+2)]>>2,v[g++]=_>>8&255,v[g++]=_&255),v}function d(h){return r[h>>18&63]+r[h>>12&63]+r[h>>6&63]+r[h&63]}function m(h,_,b){for(var N,u=[],v=_;v<b;v+=3)N=(h[v]<<16&16711680)+(h[v+1]<<8&65280)+(h[v+2]&255),u.push(d(N));return u.join("")}function y(h){for(var _,b=h.length,N=b%3,u=[],v=16383,g=0,w=b-N;g<w;g+=v)u.push(m(h,g,g+v>w?w:g+v));return N===1?(_=h[b-1],u.push(r[_>>2]+r[_<<4&63]+"==")):N===2&&(_=(h[b-2]<<8)+h[b-1],u.push(r[_>>10]+r[_>>4&63]+r[_<<2&63]+"=")),u.join("")}return _n}var wi={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var _u;function Ib(){return _u||(_u=1,wi.read=function(r,t,s,n,i){var o,l,a=i*8-n-1,c=(1<<a)-1,p=c>>1,d=-7,m=s?i-1:0,y=s?-1:1,h=r[t+m];for(m+=y,o=h&(1<<-d)-1,h>>=-d,d+=a;d>0;o=o*256+r[t+m],m+=y,d-=8);for(l=o&(1<<-d)-1,o>>=-d,d+=n;d>0;l=l*256+r[t+m],m+=y,d-=8);if(o===0)o=1-p;else{if(o===c)return l?NaN:(h?-1:1)*(1/0);l=l+Math.pow(2,n),o=o-p}return(h?-1:1)*l*Math.pow(2,o-n)},wi.write=function(r,t,s,n,i,o){var l,a,c,p=o*8-i-1,d=(1<<p)-1,m=d>>1,y=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:o-1,_=n?1:-1,b=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,l=d):(l=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-l))<1&&(l--,c*=2),l+m>=1?t+=y/c:t+=y*Math.pow(2,1-m),t*c>=2&&(l++,c/=2),l+m>=d?(a=0,l=d):l+m>=1?(a=(t*c-1)*Math.pow(2,i),l=l+m):(a=t*Math.pow(2,m-1)*Math.pow(2,i),l=0));i>=8;r[s+h]=a&255,h+=_,a/=256,i-=8);for(l=l<<i|a,p+=i;p>0;r[s+h]=l&255,h+=_,l/=256,p-=8);r[s+h-_]|=b*128}),wi}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var ku;function Aa(){return ku||(ku=1,(function(r){var t=Tb(),s=Ib(),n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=a,r.SlowBuffer=v,r.INSPECT_MAX_BYTES=50;var i=2147483647;r.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=o(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function o(){try{var L=new Uint8Array(1),f={foo:function(){return 42}};return Object.setPrototypeOf(f,Uint8Array.prototype),Object.setPrototypeOf(L,f),L.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function l(L){if(L>i)throw new RangeError('The value "'+L+'" is invalid for option "size"');var f=new Uint8Array(L);return Object.setPrototypeOf(f,a.prototype),f}function a(L,f,x){if(typeof L=="number"){if(typeof f=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(L)}return c(L,f,x)}a.poolSize=8192;function c(L,f,x){if(typeof L=="string")return y(L,f);if(ArrayBuffer.isView(L))return _(L);if(L==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof L);if(oe(L,ArrayBuffer)||L&&oe(L.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(oe(L,SharedArrayBuffer)||L&&oe(L.buffer,SharedArrayBuffer)))return b(L,f,x);if(typeof L=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var E=L.valueOf&&L.valueOf();if(E!=null&&E!==L)return a.from(E,f,x);var H=N(L);if(H)return H;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof L[Symbol.toPrimitive]=="function")return a.from(L[Symbol.toPrimitive]("string"),f,x);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof L)}a.from=function(L,f,x){return c(L,f,x)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function p(L){if(typeof L!="number")throw new TypeError('"size" argument must be of type number');if(L<0)throw new RangeError('The value "'+L+'" is invalid for option "size"')}function d(L,f,x){return p(L),L<=0?l(L):f!==void 0?typeof x=="string"?l(L).fill(f,x):l(L).fill(f):l(L)}a.alloc=function(L,f,x){return d(L,f,x)};function m(L){return p(L),l(L<0?0:u(L)|0)}a.allocUnsafe=function(L){return m(L)},a.allocUnsafeSlow=function(L){return m(L)};function y(L,f){if((typeof f!="string"||f==="")&&(f="utf8"),!a.isEncoding(f))throw new TypeError("Unknown encoding: "+f);var x=g(L,f)|0,E=l(x),H=E.write(L,f);return H!==x&&(E=E.slice(0,H)),E}function h(L){for(var f=L.length<0?0:u(L.length)|0,x=l(f),E=0;E<f;E+=1)x[E]=L[E]&255;return x}function _(L){if(oe(L,Uint8Array)){var f=new Uint8Array(L);return b(f.buffer,f.byteOffset,f.byteLength)}return h(L)}function b(L,f,x){if(f<0||L.byteLength<f)throw new RangeError('"offset" is outside of buffer bounds');if(L.byteLength<f+(x||0))throw new RangeError('"length" is outside of buffer bounds');var E;return f===void 0&&x===void 0?E=new Uint8Array(L):x===void 0?E=new Uint8Array(L,f):E=new Uint8Array(L,f,x),Object.setPrototypeOf(E,a.prototype),E}function N(L){if(a.isBuffer(L)){var f=u(L.length)|0,x=l(f);return x.length===0||L.copy(x,0,0,f),x}if(L.length!==void 0)return typeof L.length!="number"||O(L.length)?l(0):h(L);if(L.type==="Buffer"&&Array.isArray(L.data))return h(L.data)}function u(L){if(L>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return L|0}function v(L){return+L!=L&&(L=0),a.alloc(+L)}a.isBuffer=function(f){return f!=null&&f._isBuffer===!0&&f!==a.prototype},a.compare=function(f,x){if(oe(f,Uint8Array)&&(f=a.from(f,f.offset,f.byteLength)),oe(x,Uint8Array)&&(x=a.from(x,x.offset,x.byteLength)),!a.isBuffer(f)||!a.isBuffer(x))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(f===x)return 0;for(var E=f.length,H=x.length,ee=0,Z=Math.min(E,H);ee<Z;++ee)if(f[ee]!==x[ee]){E=f[ee],H=x[ee];break}return E<H?-1:H<E?1:0},a.isEncoding=function(f){switch(String(f).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(f,x){if(!Array.isArray(f))throw new TypeError('"list" argument must be an Array of Buffers');if(f.length===0)return a.alloc(0);var E;if(x===void 0)for(x=0,E=0;E<f.length;++E)x+=f[E].length;var H=a.allocUnsafe(x),ee=0;for(E=0;E<f.length;++E){var Z=f[E];if(oe(Z,Uint8Array))ee+Z.length>H.length?a.from(Z).copy(H,ee):Uint8Array.prototype.set.call(H,Z,ee);else if(a.isBuffer(Z))Z.copy(H,ee);else throw new TypeError('"list" argument must be an Array of Buffers');ee+=Z.length}return H};function g(L,f){if(a.isBuffer(L))return L.length;if(ArrayBuffer.isView(L)||oe(L,ArrayBuffer))return L.byteLength;if(typeof L!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof L);var x=L.length,E=arguments.length>2&&arguments[2]===!0;if(!E&&x===0)return 0;for(var H=!1;;)switch(f){case"ascii":case"latin1":case"binary":return x;case"utf8":case"utf-8":return I(L).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x*2;case"hex":return x>>>1;case"base64":return V(L).length;default:if(H)return E?-1:I(L).length;f=(""+f).toLowerCase(),H=!0}}a.byteLength=g;function w(L,f,x){var E=!1;if((f===void 0||f<0)&&(f=0),f>this.length||((x===void 0||x>this.length)&&(x=this.length),x<=0)||(x>>>=0,f>>>=0,x<=f))return"";for(L||(L="utf8");;)switch(L){case"hex":return $(this,f,x);case"utf8":case"utf-8":return j(this,f,x);case"ascii":return q(this,f,x);case"latin1":case"binary":return W(this,f,x);case"base64":return C(this,f,x);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ne(this,f,x);default:if(E)throw new TypeError("Unknown encoding: "+L);L=(L+"").toLowerCase(),E=!0}}a.prototype._isBuffer=!0;function k(L,f,x){var E=L[f];L[f]=L[x],L[x]=E}a.prototype.swap16=function(){var f=this.length;if(f%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var x=0;x<f;x+=2)k(this,x,x+1);return this},a.prototype.swap32=function(){var f=this.length;if(f%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var x=0;x<f;x+=4)k(this,x,x+3),k(this,x+1,x+2);return this},a.prototype.swap64=function(){var f=this.length;if(f%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var x=0;x<f;x+=8)k(this,x,x+7),k(this,x+1,x+6),k(this,x+2,x+5),k(this,x+3,x+4);return this},a.prototype.toString=function(){var f=this.length;return f===0?"":arguments.length===0?j(this,0,f):w.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(f){if(!a.isBuffer(f))throw new TypeError("Argument must be a Buffer");return this===f?!0:a.compare(this,f)===0},a.prototype.inspect=function(){var f="",x=r.INSPECT_MAX_BYTES;return f=this.toString("hex",0,x).replace(/(.{2})/g,"$1 ").trim(),this.length>x&&(f+=" ... "),"<Buffer "+f+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(f,x,E,H,ee){if(oe(f,Uint8Array)&&(f=a.from(f,f.offset,f.byteLength)),!a.isBuffer(f))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof f);if(x===void 0&&(x=0),E===void 0&&(E=f?f.length:0),H===void 0&&(H=0),ee===void 0&&(ee=this.length),x<0||E>f.length||H<0||ee>this.length)throw new RangeError("out of range index");if(H>=ee&&x>=E)return 0;if(H>=ee)return-1;if(x>=E)return 1;if(x>>>=0,E>>>=0,H>>>=0,ee>>>=0,this===f)return 0;for(var Z=ee-H,ue=E-x,pe=Math.min(Z,ue),ie=this.slice(H,ee),ke=f.slice(x,E),Oe=0;Oe<pe;++Oe)if(ie[Oe]!==ke[Oe]){Z=ie[Oe],ue=ke[Oe];break}return Z<ue?-1:ue<Z?1:0};function A(L,f,x,E,H){if(L.length===0)return-1;if(typeof x=="string"?(E=x,x=0):x>2147483647?x=2147483647:x<-2147483648&&(x=-2147483648),x=+x,O(x)&&(x=H?0:L.length-1),x<0&&(x=L.length+x),x>=L.length){if(H)return-1;x=L.length-1}else if(x<0)if(H)x=0;else return-1;if(typeof f=="string"&&(f=a.from(f,E)),a.isBuffer(f))return f.length===0?-1:T(L,f,x,E,H);if(typeof f=="number")return f=f&255,typeof Uint8Array.prototype.indexOf=="function"?H?Uint8Array.prototype.indexOf.call(L,f,x):Uint8Array.prototype.lastIndexOf.call(L,f,x):T(L,[f],x,E,H);throw new TypeError("val must be string, number or Buffer")}function T(L,f,x,E,H){var ee=1,Z=L.length,ue=f.length;if(E!==void 0&&(E=String(E).toLowerCase(),E==="ucs2"||E==="ucs-2"||E==="utf16le"||E==="utf-16le")){if(L.length<2||f.length<2)return-1;ee=2,Z/=2,ue/=2,x/=2}function pe(gt,be){return ee===1?gt[be]:gt.readUInt16BE(be*ee)}var ie;if(H){var ke=-1;for(ie=x;ie<Z;ie++)if(pe(L,ie)===pe(f,ke===-1?0:ie-ke)){if(ke===-1&&(ke=ie),ie-ke+1===ue)return ke*ee}else ke!==-1&&(ie-=ie-ke),ke=-1}else for(x+ue>Z&&(x=Z-ue),ie=x;ie>=0;ie--){for(var Oe=!0,De=0;De<ue;De++)if(pe(L,ie+De)!==pe(f,De)){Oe=!1;break}if(Oe)return ie}return-1}a.prototype.includes=function(f,x,E){return this.indexOf(f,x,E)!==-1},a.prototype.indexOf=function(f,x,E){return A(this,f,x,E,!0)},a.prototype.lastIndexOf=function(f,x,E){return A(this,f,x,E,!1)};function z(L,f,x,E){x=Number(x)||0;var H=L.length-x;E?(E=Number(E),E>H&&(E=H)):E=H;var ee=f.length;E>ee/2&&(E=ee/2);for(var Z=0;Z<E;++Z){var ue=parseInt(f.substr(Z*2,2),16);if(O(ue))return Z;L[x+Z]=ue}return Z}function S(L,f,x,E){return M(I(f,L.length-x),L,x,E)}function U(L,f,x,E){return M(Q(f),L,x,E)}function G(L,f,x,E){return M(V(f),L,x,E)}function F(L,f,x,E){return M(X(f,L.length-x),L,x,E)}a.prototype.write=function(f,x,E,H){if(x===void 0)H="utf8",E=this.length,x=0;else if(E===void 0&&typeof x=="string")H=x,E=this.length,x=0;else if(isFinite(x))x=x>>>0,isFinite(E)?(E=E>>>0,H===void 0&&(H="utf8")):(H=E,E=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var ee=this.length-x;if((E===void 0||E>ee)&&(E=ee),f.length>0&&(E<0||x<0)||x>this.length)throw new RangeError("Attempt to write outside buffer bounds");H||(H="utf8");for(var Z=!1;;)switch(H){case"hex":return z(this,f,x,E);case"utf8":case"utf-8":return S(this,f,x,E);case"ascii":case"latin1":case"binary":return U(this,f,x,E);case"base64":return G(this,f,x,E);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,f,x,E);default:if(Z)throw new TypeError("Unknown encoding: "+H);H=(""+H).toLowerCase(),Z=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function C(L,f,x){return f===0&&x===L.length?t.fromByteArray(L):t.fromByteArray(L.slice(f,x))}function j(L,f,x){x=Math.min(L.length,x);for(var E=[],H=f;H<x;){var ee=L[H],Z=null,ue=ee>239?4:ee>223?3:ee>191?2:1;if(H+ue<=x){var pe,ie,ke,Oe;switch(ue){case 1:ee<128&&(Z=ee);break;case 2:pe=L[H+1],(pe&192)===128&&(Oe=(ee&31)<<6|pe&63,Oe>127&&(Z=Oe));break;case 3:pe=L[H+1],ie=L[H+2],(pe&192)===128&&(ie&192)===128&&(Oe=(ee&15)<<12|(pe&63)<<6|ie&63,Oe>2047&&(Oe<55296||Oe>57343)&&(Z=Oe));break;case 4:pe=L[H+1],ie=L[H+2],ke=L[H+3],(pe&192)===128&&(ie&192)===128&&(ke&192)===128&&(Oe=(ee&15)<<18|(pe&63)<<12|(ie&63)<<6|ke&63,Oe>65535&&Oe<1114112&&(Z=Oe))}}Z===null?(Z=65533,ue=1):Z>65535&&(Z-=65536,E.push(Z>>>10&1023|55296),Z=56320|Z&1023),E.push(Z),H+=ue}return J(E)}var D=4096;function J(L){var f=L.length;if(f<=D)return String.fromCharCode.apply(String,L);for(var x="",E=0;E<f;)x+=String.fromCharCode.apply(String,L.slice(E,E+=D));return x}function q(L,f,x){var E="";x=Math.min(L.length,x);for(var H=f;H<x;++H)E+=String.fromCharCode(L[H]&127);return E}function W(L,f,x){var E="";x=Math.min(L.length,x);for(var H=f;H<x;++H)E+=String.fromCharCode(L[H]);return E}function $(L,f,x){var E=L.length;(!f||f<0)&&(f=0),(!x||x<0||x>E)&&(x=E);for(var H="",ee=f;ee<x;++ee)H+=ce[L[ee]];return H}function ne(L,f,x){for(var E=L.slice(f,x),H="",ee=0;ee<E.length-1;ee+=2)H+=String.fromCharCode(E[ee]+E[ee+1]*256);return H}a.prototype.slice=function(f,x){var E=this.length;f=~~f,x=x===void 0?E:~~x,f<0?(f+=E,f<0&&(f=0)):f>E&&(f=E),x<0?(x+=E,x<0&&(x=0)):x>E&&(x=E),x<f&&(x=f);var H=this.subarray(f,x);return Object.setPrototypeOf(H,a.prototype),H};function K(L,f,x){if(L%1!==0||L<0)throw new RangeError("offset is not uint");if(L+f>x)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(f,x,E){f=f>>>0,x=x>>>0,E||K(f,x,this.length);for(var H=this[f],ee=1,Z=0;++Z<x&&(ee*=256);)H+=this[f+Z]*ee;return H},a.prototype.readUintBE=a.prototype.readUIntBE=function(f,x,E){f=f>>>0,x=x>>>0,E||K(f,x,this.length);for(var H=this[f+--x],ee=1;x>0&&(ee*=256);)H+=this[f+--x]*ee;return H},a.prototype.readUint8=a.prototype.readUInt8=function(f,x){return f=f>>>0,x||K(f,1,this.length),this[f]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(f,x){return f=f>>>0,x||K(f,2,this.length),this[f]|this[f+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(f,x){return f=f>>>0,x||K(f,2,this.length),this[f]<<8|this[f+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(f,x){return f=f>>>0,x||K(f,4,this.length),(this[f]|this[f+1]<<8|this[f+2]<<16)+this[f+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(f,x){return f=f>>>0,x||K(f,4,this.length),this[f]*16777216+(this[f+1]<<16|this[f+2]<<8|this[f+3])},a.prototype.readIntLE=function(f,x,E){f=f>>>0,x=x>>>0,E||K(f,x,this.length);for(var H=this[f],ee=1,Z=0;++Z<x&&(ee*=256);)H+=this[f+Z]*ee;return ee*=128,H>=ee&&(H-=Math.pow(2,8*x)),H},a.prototype.readIntBE=function(f,x,E){f=f>>>0,x=x>>>0,E||K(f,x,this.length);for(var H=x,ee=1,Z=this[f+--H];H>0&&(ee*=256);)Z+=this[f+--H]*ee;return ee*=128,Z>=ee&&(Z-=Math.pow(2,8*x)),Z},a.prototype.readInt8=function(f,x){return f=f>>>0,x||K(f,1,this.length),this[f]&128?(255-this[f]+1)*-1:this[f]},a.prototype.readInt16LE=function(f,x){f=f>>>0,x||K(f,2,this.length);var E=this[f]|this[f+1]<<8;return E&32768?E|4294901760:E},a.prototype.readInt16BE=function(f,x){f=f>>>0,x||K(f,2,this.length);var E=this[f+1]|this[f]<<8;return E&32768?E|4294901760:E},a.prototype.readInt32LE=function(f,x){return f=f>>>0,x||K(f,4,this.length),this[f]|this[f+1]<<8|this[f+2]<<16|this[f+3]<<24},a.prototype.readInt32BE=function(f,x){return f=f>>>0,x||K(f,4,this.length),this[f]<<24|this[f+1]<<16|this[f+2]<<8|this[f+3]},a.prototype.readFloatLE=function(f,x){return f=f>>>0,x||K(f,4,this.length),s.read(this,f,!0,23,4)},a.prototype.readFloatBE=function(f,x){return f=f>>>0,x||K(f,4,this.length),s.read(this,f,!1,23,4)},a.prototype.readDoubleLE=function(f,x){return f=f>>>0,x||K(f,8,this.length),s.read(this,f,!0,52,8)},a.prototype.readDoubleBE=function(f,x){return f=f>>>0,x||K(f,8,this.length),s.read(this,f,!1,52,8)};function P(L,f,x,E,H,ee){if(!a.isBuffer(L))throw new TypeError('"buffer" argument must be a Buffer instance');if(f>H||f<ee)throw new RangeError('"value" argument is out of bounds');if(x+E>L.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(f,x,E,H){if(f=+f,x=x>>>0,E=E>>>0,!H){var ee=Math.pow(2,8*E)-1;P(this,f,x,E,ee,0)}var Z=1,ue=0;for(this[x]=f&255;++ue<E&&(Z*=256);)this[x+ue]=f/Z&255;return x+E},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(f,x,E,H){if(f=+f,x=x>>>0,E=E>>>0,!H){var ee=Math.pow(2,8*E)-1;P(this,f,x,E,ee,0)}var Z=E-1,ue=1;for(this[x+Z]=f&255;--Z>=0&&(ue*=256);)this[x+Z]=f/ue&255;return x+E},a.prototype.writeUint8=a.prototype.writeUInt8=function(f,x,E){return f=+f,x=x>>>0,E||P(this,f,x,1,255,0),this[x]=f&255,x+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(f,x,E){return f=+f,x=x>>>0,E||P(this,f,x,2,65535,0),this[x]=f&255,this[x+1]=f>>>8,x+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(f,x,E){return f=+f,x=x>>>0,E||P(this,f,x,2,65535,0),this[x]=f>>>8,this[x+1]=f&255,x+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(f,x,E){return f=+f,x=x>>>0,E||P(this,f,x,4,4294967295,0),this[x+3]=f>>>24,this[x+2]=f>>>16,this[x+1]=f>>>8,this[x]=f&255,x+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(f,x,E){return f=+f,x=x>>>0,E||P(this,f,x,4,4294967295,0),this[x]=f>>>24,this[x+1]=f>>>16,this[x+2]=f>>>8,this[x+3]=f&255,x+4},a.prototype.writeIntLE=function(f,x,E,H){if(f=+f,x=x>>>0,!H){var ee=Math.pow(2,8*E-1);P(this,f,x,E,ee-1,-ee)}var Z=0,ue=1,pe=0;for(this[x]=f&255;++Z<E&&(ue*=256);)f<0&&pe===0&&this[x+Z-1]!==0&&(pe=1),this[x+Z]=(f/ue>>0)-pe&255;return x+E},a.prototype.writeIntBE=function(f,x,E,H){if(f=+f,x=x>>>0,!H){var ee=Math.pow(2,8*E-1);P(this,f,x,E,ee-1,-ee)}var Z=E-1,ue=1,pe=0;for(this[x+Z]=f&255;--Z>=0&&(ue*=256);)f<0&&pe===0&&this[x+Z+1]!==0&&(pe=1),this[x+Z]=(f/ue>>0)-pe&255;return x+E},a.prototype.writeInt8=function(f,x,E){return f=+f,x=x>>>0,E||P(this,f,x,1,127,-128),f<0&&(f=255+f+1),this[x]=f&255,x+1},a.prototype.writeInt16LE=function(f,x,E){return f=+f,x=x>>>0,E||P(this,f,x,2,32767,-32768),this[x]=f&255,this[x+1]=f>>>8,x+2},a.prototype.writeInt16BE=function(f,x,E){return f=+f,x=x>>>0,E||P(this,f,x,2,32767,-32768),this[x]=f>>>8,this[x+1]=f&255,x+2},a.prototype.writeInt32LE=function(f,x,E){return f=+f,x=x>>>0,E||P(this,f,x,4,2147483647,-2147483648),this[x]=f&255,this[x+1]=f>>>8,this[x+2]=f>>>16,this[x+3]=f>>>24,x+4},a.prototype.writeInt32BE=function(f,x,E){return f=+f,x=x>>>0,E||P(this,f,x,4,2147483647,-2147483648),f<0&&(f=4294967295+f+1),this[x]=f>>>24,this[x+1]=f>>>16,this[x+2]=f>>>8,this[x+3]=f&255,x+4};function Y(L,f,x,E,H,ee){if(x+E>L.length)throw new RangeError("Index out of range");if(x<0)throw new RangeError("Index out of range")}function re(L,f,x,E,H){return f=+f,x=x>>>0,H||Y(L,f,x,4),s.write(L,f,x,E,23,4),x+4}a.prototype.writeFloatLE=function(f,x,E){return re(this,f,x,!0,E)},a.prototype.writeFloatBE=function(f,x,E){return re(this,f,x,!1,E)};function le(L,f,x,E,H){return f=+f,x=x>>>0,H||Y(L,f,x,8),s.write(L,f,x,E,52,8),x+8}a.prototype.writeDoubleLE=function(f,x,E){return le(this,f,x,!0,E)},a.prototype.writeDoubleBE=function(f,x,E){return le(this,f,x,!1,E)},a.prototype.copy=function(f,x,E,H){if(!a.isBuffer(f))throw new TypeError("argument should be a Buffer");if(E||(E=0),!H&&H!==0&&(H=this.length),x>=f.length&&(x=f.length),x||(x=0),H>0&&H<E&&(H=E),H===E||f.length===0||this.length===0)return 0;if(x<0)throw new RangeError("targetStart out of bounds");if(E<0||E>=this.length)throw new RangeError("Index out of range");if(H<0)throw new RangeError("sourceEnd out of bounds");H>this.length&&(H=this.length),f.length-x<H-E&&(H=f.length-x+E);var ee=H-E;return this===f&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(x,E,H):Uint8Array.prototype.set.call(f,this.subarray(E,H),x),ee},a.prototype.fill=function(f,x,E,H){if(typeof f=="string"){if(typeof x=="string"?(H=x,x=0,E=this.length):typeof E=="string"&&(H=E,E=this.length),H!==void 0&&typeof H!="string")throw new TypeError("encoding must be a string");if(typeof H=="string"&&!a.isEncoding(H))throw new TypeError("Unknown encoding: "+H);if(f.length===1){var ee=f.charCodeAt(0);(H==="utf8"&&ee<128||H==="latin1")&&(f=ee)}}else typeof f=="number"?f=f&255:typeof f=="boolean"&&(f=Number(f));if(x<0||this.length<x||this.length<E)throw new RangeError("Out of range index");if(E<=x)return this;x=x>>>0,E=E===void 0?this.length:E>>>0,f||(f=0);var Z;if(typeof f=="number")for(Z=x;Z<E;++Z)this[Z]=f;else{var ue=a.isBuffer(f)?f:a.from(f,H),pe=ue.length;if(pe===0)throw new TypeError('The value "'+f+'" is invalid for argument "value"');for(Z=0;Z<E-x;++Z)this[Z+x]=ue[Z%pe]}return this};var se=/[^+/0-9A-Za-z-_]/g;function R(L){if(L=L.split("=")[0],L=L.trim().replace(se,""),L.length<2)return"";for(;L.length%4!==0;)L=L+"=";return L}function I(L,f){f=f||1/0;for(var x,E=L.length,H=null,ee=[],Z=0;Z<E;++Z){if(x=L.charCodeAt(Z),x>55295&&x<57344){if(!H){if(x>56319){(f-=3)>-1&&ee.push(239,191,189);continue}else if(Z+1===E){(f-=3)>-1&&ee.push(239,191,189);continue}H=x;continue}if(x<56320){(f-=3)>-1&&ee.push(239,191,189),H=x;continue}x=(H-55296<<10|x-56320)+65536}else H&&(f-=3)>-1&&ee.push(239,191,189);if(H=null,x<128){if((f-=1)<0)break;ee.push(x)}else if(x<2048){if((f-=2)<0)break;ee.push(x>>6|192,x&63|128)}else if(x<65536){if((f-=3)<0)break;ee.push(x>>12|224,x>>6&63|128,x&63|128)}else if(x<1114112){if((f-=4)<0)break;ee.push(x>>18|240,x>>12&63|128,x>>6&63|128,x&63|128)}else throw new Error("Invalid code point")}return ee}function Q(L){for(var f=[],x=0;x<L.length;++x)f.push(L.charCodeAt(x)&255);return f}function X(L,f){for(var x,E,H,ee=[],Z=0;Z<L.length&&!((f-=2)<0);++Z)x=L.charCodeAt(Z),E=x>>8,H=x%256,ee.push(H),ee.push(E);return ee}function V(L){return t.toByteArray(R(L))}function M(L,f,x,E){for(var H=0;H<E&&!(H+x>=f.length||H>=L.length);++H)f[H+x]=L[H];return H}function oe(L,f){return L instanceof f||L!=null&&L.constructor!=null&&L.constructor.name!=null&&L.constructor.name===f.name}function O(L){return L!==L}var ce=(function(){for(var L="0123456789abcdef",f=new Array(256),x=0;x<16;++x)for(var E=x*16,H=0;H<16;++H)f[E+H]=L[x]+L[H];return f})()})(ro)),ro}var so={},no={},io,Nu;function Pf(){return Nu||(Nu=1,io=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},s=Symbol("test"),n=Object(s);if(typeof s=="string"||Object.prototype.toString.call(s)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var i=42;t[s]=i;for(var o in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var l=Object.getOwnPropertySymbols(t);if(l.length!==1||l[0]!==s||!Object.prototype.propertyIsEnumerable.call(t,s))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,s);if(a.value!==i||a.enumerable!==!0)return!1}return!0}),io}var ao,Su;function ld(){if(Su)return ao;Su=1;var r=Pf();return ao=function(){return r()&&!!Symbol.toStringTag},ao}var oo,Cu;function Lf(){return Cu||(Cu=1,oo=Object),oo}var lo,Eu;function Rb(){return Eu||(Eu=1,lo=Error),lo}var co,Au;function Ob(){return Au||(Au=1,co=EvalError),co}var uo,Tu;function Fb(){return Tu||(Tu=1,uo=RangeError),uo}var ho,Iu;function Pb(){return Iu||(Iu=1,ho=ReferenceError),ho}var mo,Ru;function Df(){return Ru||(Ru=1,mo=SyntaxError),mo}var po,Ou;function ri(){return Ou||(Ou=1,po=TypeError),po}var fo,Fu;function Lb(){return Fu||(Fu=1,fo=URIError),fo}var go,Pu;function Db(){return Pu||(Pu=1,go=Math.abs),go}var xo,Lu;function Mb(){return Lu||(Lu=1,xo=Math.floor),xo}var yo,Du;function $b(){return Du||(Du=1,yo=Math.max),yo}var bo,Mu;function Bb(){return Mu||(Mu=1,bo=Math.min),bo}var vo,$u;function zb(){return $u||($u=1,vo=Math.pow),vo}var wo,Bu;function Ub(){return Bu||(Bu=1,wo=Math.round),wo}var jo,zu;function qb(){return zu||(zu=1,jo=Number.isNaN||function(t){return t!==t}),jo}var _o,Uu;function Wb(){if(Uu)return _o;Uu=1;var r=qb();return _o=function(s){return r(s)||s===0?s:s<0?-1:1},_o}var ko,qu;function Hb(){return qu||(qu=1,ko=Object.getOwnPropertyDescriptor),ko}var No,Wu;function si(){if(Wu)return No;Wu=1;var r=Hb();if(r)try{r([],"length")}catch{r=null}return No=r,No}var So,Hu;function Ta(){if(Hu)return So;Hu=1;var r=Object.defineProperty||!1;if(r)try{r({},"a",{value:1})}catch{r=!1}return So=r,So}var Co,Gu;function Gb(){if(Gu)return Co;Gu=1;var r=typeof Symbol<"u"&&Symbol,t=Pf();return Co=function(){return typeof r!="function"||typeof Symbol!="function"||typeof r("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},Co}var Eo,Vu;function Mf(){return Vu||(Vu=1,Eo=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Eo}var Ao,Ku;function $f(){if(Ku)return Ao;Ku=1;var r=Lf();return Ao=r.getPrototypeOf||null,Ao}var To,Xu;function Vb(){if(Xu)return To;Xu=1;var r="Function.prototype.bind called on incompatible ",t=Object.prototype.toString,s=Math.max,n="[object Function]",i=function(c,p){for(var d=[],m=0;m<c.length;m+=1)d[m]=c[m];for(var y=0;y<p.length;y+=1)d[y+c.length]=p[y];return d},o=function(c,p){for(var d=[],m=p,y=0;m<c.length;m+=1,y+=1)d[y]=c[m];return d},l=function(a,c){for(var p="",d=0;d<a.length;d+=1)p+=a[d],d+1<a.length&&(p+=c);return p};return To=function(c){var p=this;if(typeof p!="function"||t.apply(p)!==n)throw new TypeError(r+p);for(var d=o(arguments,1),m,y=function(){if(this instanceof m){var u=p.apply(this,i(d,arguments));return Object(u)===u?u:this}return p.apply(c,i(d,arguments))},h=s(0,p.length-d.length),_=[],b=0;b<h;b++)_[b]="$"+b;if(m=Function("binder","return function ("+l(_,",")+"){ return binder.apply(this,arguments); }")(y),p.prototype){var N=function(){};N.prototype=p.prototype,m.prototype=new N,N.prototype=null}return m},To}var Io,Yu;function ni(){if(Yu)return Io;Yu=1;var r=Vb();return Io=Function.prototype.bind||r,Io}var Ro,Ju;function cd(){return Ju||(Ju=1,Ro=Function.prototype.call),Ro}var Oo,Qu;function Bf(){return Qu||(Qu=1,Oo=Function.prototype.apply),Oo}var Fo,Zu;function Kb(){return Zu||(Zu=1,Fo=typeof Reflect<"u"&&Reflect&&Reflect.apply),Fo}var Po,eh;function Xb(){if(eh)return Po;eh=1;var r=ni(),t=Bf(),s=cd(),n=Kb();return Po=n||r.call(s,t),Po}var Lo,th;function Yb(){if(th)return Lo;th=1;var r=ni(),t=ri(),s=cd(),n=Xb();return Lo=function(o){if(o.length<1||typeof o[0]!="function")throw new t("a function is required");return n(r,s,o)},Lo}var Do,rh;function Jb(){if(rh)return Do;rh=1;var r=Yb(),t=si(),s;try{s=[].__proto__===Array.prototype}catch(l){if(!l||typeof l!="object"||!("code"in l)||l.code!=="ERR_PROTO_ACCESS")throw l}var n=!!s&&t&&t(Object.prototype,"__proto__"),i=Object,o=i.getPrototypeOf;return Do=n&&typeof n.get=="function"?r([n.get]):typeof o=="function"?(function(a){return o(a==null?a:i(a))}):!1,Do}var Mo,sh;function Qb(){if(sh)return Mo;sh=1;var r=Mf(),t=$f(),s=Jb();return Mo=r?function(i){return r(i)}:t?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return t(i)}:s?function(i){return s(i)}:null,Mo}var $o,nh;function Zb(){if(nh)return $o;nh=1;var r=Function.prototype.call,t=Object.prototype.hasOwnProperty,s=ni();return $o=s.call(r,t),$o}var Bo,ih;function dd(){if(ih)return Bo;ih=1;var r,t=Lf(),s=Rb(),n=Ob(),i=Fb(),o=Pb(),l=Df(),a=ri(),c=Lb(),p=Db(),d=Mb(),m=$b(),y=Bb(),h=zb(),_=Ub(),b=Wb(),N=Function,u=function(Q){try{return N('"use strict"; return ('+Q+").constructor;")()}catch{}},v=si(),g=Ta(),w=function(){throw new a},k=v?(function(){try{return arguments.callee,w}catch{try{return v(arguments,"callee").get}catch{return w}}})():w,A=Gb()(),T=Qb(),z=$f(),S=Mf(),U=Bf(),G=cd(),F={},C=typeof Uint8Array>"u"||!T?r:T(Uint8Array),j={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?r:ArrayBuffer,"%ArrayIteratorPrototype%":A&&T?T([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":F,"%AsyncGenerator%":F,"%AsyncGeneratorFunction%":F,"%AsyncIteratorPrototype%":F,"%Atomics%":typeof Atomics>"u"?r:Atomics,"%BigInt%":typeof BigInt>"u"?r:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?r:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":s,"%eval%":eval,"%EvalError%":n,"%Float16Array%":typeof Float16Array>"u"?r:Float16Array,"%Float32Array%":typeof Float32Array>"u"?r:Float32Array,"%Float64Array%":typeof Float64Array>"u"?r:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?r:FinalizationRegistry,"%Function%":N,"%GeneratorFunction%":F,"%Int8Array%":typeof Int8Array>"u"?r:Int8Array,"%Int16Array%":typeof Int16Array>"u"?r:Int16Array,"%Int32Array%":typeof Int32Array>"u"?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":A&&T?T(T([][Symbol.iterator]())):r,"%JSON%":typeof JSON=="object"?JSON:r,"%Map%":typeof Map>"u"?r:Map,"%MapIteratorPrototype%":typeof Map>"u"||!A||!T?r:T(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":t,"%Object.getOwnPropertyDescriptor%":v,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?r:Promise,"%Proxy%":typeof Proxy>"u"?r:Proxy,"%RangeError%":i,"%ReferenceError%":o,"%Reflect%":typeof Reflect>"u"?r:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?r:Set,"%SetIteratorPrototype%":typeof Set>"u"||!A||!T?r:T(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":A&&T?T(""[Symbol.iterator]()):r,"%Symbol%":A?Symbol:r,"%SyntaxError%":l,"%ThrowTypeError%":k,"%TypedArray%":C,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?r:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?r:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?r:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?r:Uint32Array,"%URIError%":c,"%WeakMap%":typeof WeakMap>"u"?r:WeakMap,"%WeakRef%":typeof WeakRef>"u"?r:WeakRef,"%WeakSet%":typeof WeakSet>"u"?r:WeakSet,"%Function.prototype.call%":G,"%Function.prototype.apply%":U,"%Object.defineProperty%":g,"%Object.getPrototypeOf%":z,"%Math.abs%":p,"%Math.floor%":d,"%Math.max%":m,"%Math.min%":y,"%Math.pow%":h,"%Math.round%":_,"%Math.sign%":b,"%Reflect.getPrototypeOf%":S};if(T)try{null.error}catch(Q){var D=T(T(Q));j["%Error.prototype%"]=D}var J=function Q(X){var V;if(X==="%AsyncFunction%")V=u("async function () {}");else if(X==="%GeneratorFunction%")V=u("function* () {}");else if(X==="%AsyncGeneratorFunction%")V=u("async function* () {}");else if(X==="%AsyncGenerator%"){var M=Q("%AsyncGeneratorFunction%");M&&(V=M.prototype)}else if(X==="%AsyncIteratorPrototype%"){var oe=Q("%AsyncGenerator%");oe&&T&&(V=T(oe.prototype))}return j[X]=V,V},q={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},W=ni(),$=Zb(),ne=W.call(G,Array.prototype.concat),K=W.call(U,Array.prototype.splice),P=W.call(G,String.prototype.replace),Y=W.call(G,String.prototype.slice),re=W.call(G,RegExp.prototype.exec),le=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,se=/\\(\\)?/g,R=function(X){var V=Y(X,0,1),M=Y(X,-1);if(V==="%"&&M!=="%")throw new l("invalid intrinsic syntax, expected closing `%`");if(M==="%"&&V!=="%")throw new l("invalid intrinsic syntax, expected opening `%`");var oe=[];return P(X,le,function(O,ce,L,f){oe[oe.length]=L?P(f,se,"$1"):ce||O}),oe},I=function(X,V){var M=X,oe;if($(q,M)&&(oe=q[M],M="%"+oe[0]+"%"),$(j,M)){var O=j[M];if(O===F&&(O=J(M)),typeof O>"u"&&!V)throw new a("intrinsic "+X+" exists, but is not available. Please file an issue!");return{alias:oe,name:M,value:O}}throw new l("intrinsic "+X+" does not exist!")};return Bo=function(X,V){if(typeof X!="string"||X.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof V!="boolean")throw new a('"allowMissing" argument must be a boolean');if(re(/^%?[^%]*%?$/,X)===null)throw new l("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var M=R(X),oe=M.length>0?M[0]:"",O=I("%"+oe+"%",V),ce=O.name,L=O.value,f=!1,x=O.alias;x&&(oe=x[0],K(M,ne([0,1],x)));for(var E=1,H=!0;E<M.length;E+=1){var ee=M[E],Z=Y(ee,0,1),ue=Y(ee,-1);if((Z==='"'||Z==="'"||Z==="`"||ue==='"'||ue==="'"||ue==="`")&&Z!==ue)throw new l("property names with quotes must have matching quotes");if((ee==="constructor"||!H)&&(f=!0),oe+="."+ee,ce="%"+oe+"%",$(j,ce))L=j[ce];else if(L!=null){if(!(ee in L)){if(!V)throw new a("base intrinsic for "+X+" exists, but the property is not available.");return}if(v&&E+1>=M.length){var pe=v(L,ee);H=!!pe,H&&"get"in pe&&!("originalValue"in pe.get)?L=pe.get:L=L[ee]}else H=$(L,ee),L=L[ee];H&&!f&&(j[ce]=L)}}return L},Bo}var zo={exports:{}},Uo,ah;function ev(){if(ah)return Uo;ah=1;var r=Ta(),t=Df(),s=ri(),n=si();return Uo=function(o,l,a){if(!o||typeof o!="object"&&typeof o!="function")throw new s("`obj` must be an object or a function`");if(typeof l!="string"&&typeof l!="symbol")throw new s("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new s("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new s("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new s("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new s("`loose`, if provided, must be a boolean");var c=arguments.length>3?arguments[3]:null,p=arguments.length>4?arguments[4]:null,d=arguments.length>5?arguments[5]:null,m=arguments.length>6?arguments[6]:!1,y=!!n&&n(o,l);if(r)r(o,l,{configurable:d===null&&y?y.configurable:!d,enumerable:c===null&&y?y.enumerable:!c,value:a,writable:p===null&&y?y.writable:!p});else if(m||!c&&!p&&!d)o[l]=a;else throw new t("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Uo}var qo,oh;function tv(){if(oh)return qo;oh=1;var r=Ta(),t=function(){return!!r};return t.hasArrayLengthDefineBug=function(){if(!r)return null;try{return r([],"length",{value:1}).length!==1}catch{return!0}},qo=t,qo}var Wo,lh;function rv(){if(lh)return Wo;lh=1;var r=dd(),t=ev(),s=tv()(),n=si(),i=ri(),o=r("%Math.floor%");return Wo=function(a,c){if(typeof a!="function")throw new i("`fn` is not a function");if(typeof c!="number"||c<0||c>4294967295||o(c)!==c)throw new i("`length` must be a positive 32-bit integer");var p=arguments.length>2&&!!arguments[2],d=!0,m=!0;if("length"in a&&n){var y=n(a,"length");y&&!y.configurable&&(d=!1),y&&!y.writable&&(m=!1)}return(d||m||!p)&&(s?t(a,"length",c,!0,!0):t(a,"length",c)),a},Wo}var ch;function zf(){return ch||(ch=1,(function(r){var t=ni(),s=dd(),n=rv(),i=ri(),o=s("%Function.prototype.apply%"),l=s("%Function.prototype.call%"),a=s("%Reflect.apply%",!0)||t.call(l,o),c=Ta(),p=s("%Math.max%");r.exports=function(y){if(typeof y!="function")throw new i("a function is required");var h=a(t,l,arguments);return n(h,1+p(0,y.length-(arguments.length-1)),!0)};var d=function(){return a(t,o,arguments)};c?c(r.exports,"apply",{value:d}):r.exports.apply=d})(zo)),zo.exports}var Ho,dh;function Uf(){if(dh)return Ho;dh=1;var r=dd(),t=zf(),s=t(r("String.prototype.indexOf"));return Ho=function(i,o){var l=r(i,!!o);return typeof l=="function"&&s(i,".prototype.")>-1?t(l):l},Ho}var Go,uh;function sv(){if(uh)return Go;uh=1;var r=ld()(),t=Uf(),s=t("Object.prototype.toString"),n=function(a){return r&&a&&typeof a=="object"&&Symbol.toStringTag in a?!1:s(a)==="[object Arguments]"},i=function(a){return n(a)?!0:a!==null&&typeof a=="object"&&typeof a.length=="number"&&a.length>=0&&s(a)!=="[object Array]"&&s(a.callee)==="[object Function]"},o=(function(){return n(arguments)})();return n.isLegacyArguments=i,Go=o?n:i,Go}var Vo,hh;function nv(){if(hh)return Vo;hh=1;var r=Object.prototype.toString,t=Function.prototype.toString,s=/^\s*(?:function)?\*/,n=ld()(),i=Object.getPrototypeOf,o=function(){if(!n)return!1;try{return Function("return function*() {}")()}catch{}},l;return Vo=function(c){if(typeof c!="function")return!1;if(s.test(t.call(c)))return!0;if(!n){var p=r.call(c);return p==="[object GeneratorFunction]"}if(!i)return!1;if(typeof l>"u"){var d=o();l=d?i(d):!1}return i(c)===l},Vo}var Ko,mh;function iv(){if(mh)return Ko;mh=1;var r=Function.prototype.toString,t=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,s,n;if(typeof t=="function"&&typeof Object.defineProperty=="function")try{s=Object.defineProperty({},"length",{get:function(){throw n}}),n={},t(function(){throw 42},null,s)}catch(v){v!==n&&(t=null)}else t=null;var i=/^\s*class\b/,o=function(g){try{var w=r.call(g);return i.test(w)}catch{return!1}},l=function(g){try{return o(g)?!1:(r.call(g),!0)}catch{return!1}},a=Object.prototype.toString,c="[object Object]",p="[object Function]",d="[object GeneratorFunction]",m="[object HTMLAllCollection]",y="[object HTML document.all class]",h="[object HTMLCollection]",_=typeof Symbol=="function"&&!!Symbol.toStringTag,b=!(0 in[,]),N=function(){return!1};if(typeof document=="object"){var u=document.all;a.call(u)===a.call(document.all)&&(N=function(g){if((b||!g)&&(typeof g>"u"||typeof g=="object"))try{var w=a.call(g);return(w===m||w===y||w===h||w===c)&&g("")==null}catch{}return!1})}return Ko=t?function(g){if(N(g))return!0;if(!g||typeof g!="function"&&typeof g!="object")return!1;try{t(g,null,s)}catch(w){if(w!==n)return!1}return!o(g)&&l(g)}:function(g){if(N(g))return!0;if(!g||typeof g!="function"&&typeof g!="object")return!1;if(_)return l(g);if(o(g))return!1;var w=a.call(g);return w!==p&&w!==d&&!/^\[object HTML/.test(w)?!1:l(g)},Ko}var Xo,ph;function av(){if(ph)return Xo;ph=1;var r=iv(),t=Object.prototype.toString,s=Object.prototype.hasOwnProperty,n=function(c,p,d){for(var m=0,y=c.length;m<y;m++)s.call(c,m)&&(d==null?p(c[m],m,c):p.call(d,c[m],m,c))},i=function(c,p,d){for(var m=0,y=c.length;m<y;m++)d==null?p(c.charAt(m),m,c):p.call(d,c.charAt(m),m,c)},o=function(c,p,d){for(var m in c)s.call(c,m)&&(d==null?p(c[m],m,c):p.call(d,c[m],m,c))},l=function(c,p,d){if(!r(p))throw new TypeError("iterator must be a function");var m;arguments.length>=3&&(m=d),t.call(c)==="[object Array]"?n(c,p,m):typeof c=="string"?i(c,p,m):o(c,p,m)};return Xo=l,Xo}var Yo,fh;function ov(){return fh||(fh=1,Yo=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]),Yo}var Jo,gh;function lv(){if(gh)return Jo;gh=1;var r=ov(),t=typeof globalThis>"u"?zr:globalThis;return Jo=function(){for(var n=[],i=0;i<r.length;i++)typeof t[r[i]]=="function"&&(n[n.length]=r[i]);return n},Jo}var Qo,xh;function qf(){if(xh)return Qo;xh=1;var r=av(),t=lv(),s=zf(),n=Uf(),i=si(),o=n("Object.prototype.toString"),l=ld()(),a=typeof globalThis>"u"?zr:globalThis,c=t(),p=n("String.prototype.slice"),d=Object.getPrototypeOf,m=n("Array.prototype.indexOf",!0)||function(N,u){for(var v=0;v<N.length;v+=1)if(N[v]===u)return v;return-1},y={__proto__:null};l&&i&&d?r(c,function(b){var N=new a[b];if(Symbol.toStringTag in N){var u=d(N),v=i(u,Symbol.toStringTag);if(!v){var g=d(u);v=i(g,Symbol.toStringTag)}y["$"+b]=s(v.get)}}):r(c,function(b){var N=new a[b],u=N.slice||N.set;u&&(y["$"+b]=s(u))});var h=function(N){var u=!1;return r(y,function(v,g){if(!u)try{"$"+v(N)===g&&(u=p(g,1))}catch{}}),u},_=function(N){var u=!1;return r(y,function(v,g){if(!u)try{v(N),u=p(g,1)}catch{}}),u};return Qo=function(N){if(!N||typeof N!="object")return!1;if(!l){var u=p(o(N),8,-1);return m(c,u)>-1?u:u!=="Object"?!1:_(N)}return i?h(N):null},Qo}var Zo,yh;function cv(){if(yh)return Zo;yh=1;var r=qf();return Zo=function(s){return!!r(s)},Zo}var bh;function dv(){return bh||(bh=1,(function(r){var t=sv(),s=nv(),n=qf(),i=cv();function o(E){return E.call.bind(E)}var l=typeof BigInt<"u",a=typeof Symbol<"u",c=o(Object.prototype.toString),p=o(Number.prototype.valueOf),d=o(String.prototype.valueOf),m=o(Boolean.prototype.valueOf);if(l)var y=o(BigInt.prototype.valueOf);if(a)var h=o(Symbol.prototype.valueOf);function _(E,H){if(typeof E!="object")return!1;try{return H(E),!0}catch{return!1}}r.isArgumentsObject=t,r.isGeneratorFunction=s,r.isTypedArray=i;function b(E){return typeof Promise<"u"&&E instanceof Promise||E!==null&&typeof E=="object"&&typeof E.then=="function"&&typeof E.catch=="function"}r.isPromise=b;function N(E){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(E):i(E)||Y(E)}r.isArrayBufferView=N;function u(E){return n(E)==="Uint8Array"}r.isUint8Array=u;function v(E){return n(E)==="Uint8ClampedArray"}r.isUint8ClampedArray=v;function g(E){return n(E)==="Uint16Array"}r.isUint16Array=g;function w(E){return n(E)==="Uint32Array"}r.isUint32Array=w;function k(E){return n(E)==="Int8Array"}r.isInt8Array=k;function A(E){return n(E)==="Int16Array"}r.isInt16Array=A;function T(E){return n(E)==="Int32Array"}r.isInt32Array=T;function z(E){return n(E)==="Float32Array"}r.isFloat32Array=z;function S(E){return n(E)==="Float64Array"}r.isFloat64Array=S;function U(E){return n(E)==="BigInt64Array"}r.isBigInt64Array=U;function G(E){return n(E)==="BigUint64Array"}r.isBigUint64Array=G;function F(E){return c(E)==="[object Map]"}F.working=typeof Map<"u"&&F(new Map);function C(E){return typeof Map>"u"?!1:F.working?F(E):E instanceof Map}r.isMap=C;function j(E){return c(E)==="[object Set]"}j.working=typeof Set<"u"&&j(new Set);function D(E){return typeof Set>"u"?!1:j.working?j(E):E instanceof Set}r.isSet=D;function J(E){return c(E)==="[object WeakMap]"}J.working=typeof WeakMap<"u"&&J(new WeakMap);function q(E){return typeof WeakMap>"u"?!1:J.working?J(E):E instanceof WeakMap}r.isWeakMap=q;function W(E){return c(E)==="[object WeakSet]"}W.working=typeof WeakSet<"u"&&W(new WeakSet);function $(E){return W(E)}r.isWeakSet=$;function ne(E){return c(E)==="[object ArrayBuffer]"}ne.working=typeof ArrayBuffer<"u"&&ne(new ArrayBuffer);function K(E){return typeof ArrayBuffer>"u"?!1:ne.working?ne(E):E instanceof ArrayBuffer}r.isArrayBuffer=K;function P(E){return c(E)==="[object DataView]"}P.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&P(new DataView(new ArrayBuffer(1),0,1));function Y(E){return typeof DataView>"u"?!1:P.working?P(E):E instanceof DataView}r.isDataView=Y;var re=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function le(E){return c(E)==="[object SharedArrayBuffer]"}function se(E){return typeof re>"u"?!1:(typeof le.working>"u"&&(le.working=le(new re)),le.working?le(E):E instanceof re)}r.isSharedArrayBuffer=se;function R(E){return c(E)==="[object AsyncFunction]"}r.isAsyncFunction=R;function I(E){return c(E)==="[object Map Iterator]"}r.isMapIterator=I;function Q(E){return c(E)==="[object Set Iterator]"}r.isSetIterator=Q;function X(E){return c(E)==="[object Generator]"}r.isGeneratorObject=X;function V(E){return c(E)==="[object WebAssembly.Module]"}r.isWebAssemblyCompiledModule=V;function M(E){return _(E,p)}r.isNumberObject=M;function oe(E){return _(E,d)}r.isStringObject=oe;function O(E){return _(E,m)}r.isBooleanObject=O;function ce(E){return l&&_(E,y)}r.isBigIntObject=ce;function L(E){return a&&_(E,h)}r.isSymbolObject=L;function f(E){return M(E)||oe(E)||O(E)||ce(E)||L(E)}r.isBoxedPrimitive=f;function x(E){return typeof Uint8Array<"u"&&(K(E)||se(E))}r.isAnyArrayBuffer=x,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(E){Object.defineProperty(r,E,{enumerable:!1,value:function(){throw new Error(E+" is not supported in userland")}})})})(no)),no}var el,vh;function uv(){return vh||(vh=1,el=function(t){return t&&typeof t=="object"&&typeof t.copy=="function"&&typeof t.fill=="function"&&typeof t.readUInt8=="function"}),el}var wh;function Wf(){return wh||(wh=1,(function(r){var t=Object.getOwnPropertyDescriptors||function(Y){for(var re=Object.keys(Y),le={},se=0;se<re.length;se++)le[re[se]]=Object.getOwnPropertyDescriptor(Y,re[se]);return le},s=/%[sdj%]/g;r.format=function(P){if(!k(P)){for(var Y=[],re=0;re<arguments.length;re++)Y.push(l(arguments[re]));return Y.join(" ")}for(var re=1,le=arguments,se=le.length,R=String(P).replace(s,function(Q){if(Q==="%%")return"%";if(re>=se)return Q;switch(Q){case"%s":return String(le[re++]);case"%d":return Number(le[re++]);case"%j":try{return JSON.stringify(le[re++])}catch{return"[Circular]"}default:return Q}}),I=le[re];re<se;I=le[++re])v(I)||!S(I)?R+=" "+I:R+=" "+l(I);return R},r.deprecate=function(P,Y){if(typeof Xe<"u"&&Xe.noDeprecation===!0)return P;if(typeof Xe>"u")return function(){return r.deprecate(P,Y).apply(this,arguments)};var re=!1;function le(){if(!re){if(Xe.throwDeprecation)throw new Error(Y);Xe.traceDeprecation?console.trace(Y):console.error(Y),re=!0}return P.apply(this,arguments)}return le};var n={},i=/^$/;if(Xe.env.NODE_DEBUG){var o=Xe.env.NODE_DEBUG;o=o.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),i=new RegExp("^"+o+"$","i")}r.debuglog=function(P){if(P=P.toUpperCase(),!n[P])if(i.test(P)){var Y=Xe.pid;n[P]=function(){var re=r.format.apply(r,arguments);console.error("%s %d: %s",P,Y,re)}}else n[P]=function(){};return n[P]};function l(P,Y){var re={seen:[],stylize:c};return arguments.length>=3&&(re.depth=arguments[2]),arguments.length>=4&&(re.colors=arguments[3]),u(Y)?re.showHidden=Y:Y&&r._extend(re,Y),T(re.showHidden)&&(re.showHidden=!1),T(re.depth)&&(re.depth=2),T(re.colors)&&(re.colors=!1),T(re.customInspect)&&(re.customInspect=!0),re.colors&&(re.stylize=a),d(re,P,re.depth)}r.inspect=l,l.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function a(P,Y){var re=l.styles[Y];return re?"\x1B["+l.colors[re][0]+"m"+P+"\x1B["+l.colors[re][1]+"m":P}function c(P,Y){return P}function p(P){var Y={};return P.forEach(function(re,le){Y[re]=!0}),Y}function d(P,Y,re){if(P.customInspect&&Y&&F(Y.inspect)&&Y.inspect!==r.inspect&&!(Y.constructor&&Y.constructor.prototype===Y)){var le=Y.inspect(re,P);return k(le)||(le=d(P,le,re)),le}var se=m(P,Y);if(se)return se;var R=Object.keys(Y),I=p(R);if(P.showHidden&&(R=Object.getOwnPropertyNames(Y)),G(Y)&&(R.indexOf("message")>=0||R.indexOf("description")>=0))return y(Y);if(R.length===0){if(F(Y)){var Q=Y.name?": "+Y.name:"";return P.stylize("[Function"+Q+"]","special")}if(z(Y))return P.stylize(RegExp.prototype.toString.call(Y),"regexp");if(U(Y))return P.stylize(Date.prototype.toString.call(Y),"date");if(G(Y))return y(Y)}var X="",V=!1,M=["{","}"];if(N(Y)&&(V=!0,M=["[","]"]),F(Y)){var oe=Y.name?": "+Y.name:"";X=" [Function"+oe+"]"}if(z(Y)&&(X=" "+RegExp.prototype.toString.call(Y)),U(Y)&&(X=" "+Date.prototype.toUTCString.call(Y)),G(Y)&&(X=" "+y(Y)),R.length===0&&(!V||Y.length==0))return M[0]+X+M[1];if(re<0)return z(Y)?P.stylize(RegExp.prototype.toString.call(Y),"regexp"):P.stylize("[Object]","special");P.seen.push(Y);var O;return V?O=h(P,Y,re,I,R):O=R.map(function(ce){return _(P,Y,re,I,ce,V)}),P.seen.pop(),b(O,X,M)}function m(P,Y){if(T(Y))return P.stylize("undefined","undefined");if(k(Y)){var re="'"+JSON.stringify(Y).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return P.stylize(re,"string")}if(w(Y))return P.stylize(""+Y,"number");if(u(Y))return P.stylize(""+Y,"boolean");if(v(Y))return P.stylize("null","null")}function y(P){return"["+Error.prototype.toString.call(P)+"]"}function h(P,Y,re,le,se){for(var R=[],I=0,Q=Y.length;I<Q;++I)W(Y,String(I))?R.push(_(P,Y,re,le,String(I),!0)):R.push("");return se.forEach(function(X){X.match(/^\d+$/)||R.push(_(P,Y,re,le,X,!0))}),R}function _(P,Y,re,le,se,R){var I,Q,X;if(X=Object.getOwnPropertyDescriptor(Y,se)||{value:Y[se]},X.get?X.set?Q=P.stylize("[Getter/Setter]","special"):Q=P.stylize("[Getter]","special"):X.set&&(Q=P.stylize("[Setter]","special")),W(le,se)||(I="["+se+"]"),Q||(P.seen.indexOf(X.value)<0?(v(re)?Q=d(P,X.value,null):Q=d(P,X.value,re-1),Q.indexOf(`
`)>-1&&(R?Q=Q.split(`
`).map(function(V){return"  "+V}).join(`
`).slice(2):Q=`
`+Q.split(`
`).map(function(V){return"   "+V}).join(`
`))):Q=P.stylize("[Circular]","special")),T(I)){if(R&&se.match(/^\d+$/))return Q;I=JSON.stringify(""+se),I.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(I=I.slice(1,-1),I=P.stylize(I,"name")):(I=I.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),I=P.stylize(I,"string"))}return I+": "+Q}function b(P,Y,re){var le=P.reduce(function(se,R){return R.indexOf(`
`)>=0,se+R.replace(/\u001b\[\d\d?m/g,"").length+1},0);return le>60?re[0]+(Y===""?"":Y+`
 `)+" "+P.join(`,
  `)+" "+re[1]:re[0]+Y+" "+P.join(", ")+" "+re[1]}r.types=dv();function N(P){return Array.isArray(P)}r.isArray=N;function u(P){return typeof P=="boolean"}r.isBoolean=u;function v(P){return P===null}r.isNull=v;function g(P){return P==null}r.isNullOrUndefined=g;function w(P){return typeof P=="number"}r.isNumber=w;function k(P){return typeof P=="string"}r.isString=k;function A(P){return typeof P=="symbol"}r.isSymbol=A;function T(P){return P===void 0}r.isUndefined=T;function z(P){return S(P)&&j(P)==="[object RegExp]"}r.isRegExp=z,r.types.isRegExp=z;function S(P){return typeof P=="object"&&P!==null}r.isObject=S;function U(P){return S(P)&&j(P)==="[object Date]"}r.isDate=U,r.types.isDate=U;function G(P){return S(P)&&(j(P)==="[object Error]"||P instanceof Error)}r.isError=G,r.types.isNativeError=G;function F(P){return typeof P=="function"}r.isFunction=F;function C(P){return P===null||typeof P=="boolean"||typeof P=="number"||typeof P=="string"||typeof P=="symbol"||typeof P>"u"}r.isPrimitive=C,r.isBuffer=uv();function j(P){return Object.prototype.toString.call(P)}function D(P){return P<10?"0"+P.toString(10):P.toString(10)}var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function q(){var P=new Date,Y=[D(P.getHours()),D(P.getMinutes()),D(P.getSeconds())].join(":");return[P.getDate(),J[P.getMonth()],Y].join(" ")}r.log=function(){console.log("%s - %s",q(),r.format.apply(r,arguments))},r.inherits=js(),r._extend=function(P,Y){if(!Y||!S(Y))return P;for(var re=Object.keys(Y),le=re.length;le--;)P[re[le]]=Y[re[le]];return P};function W(P,Y){return Object.prototype.hasOwnProperty.call(P,Y)}var $=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;r.promisify=function(Y){if(typeof Y!="function")throw new TypeError('The "original" argument must be of type Function');if($&&Y[$]){var re=Y[$];if(typeof re!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(re,$,{value:re,enumerable:!1,writable:!1,configurable:!0}),re}function re(){for(var le,se,R=new Promise(function(X,V){le=X,se=V}),I=[],Q=0;Q<arguments.length;Q++)I.push(arguments[Q]);I.push(function(X,V){X?se(X):le(V)});try{Y.apply(this,I)}catch(X){se(X)}return R}return Object.setPrototypeOf(re,Object.getPrototypeOf(Y)),$&&Object.defineProperty(re,$,{value:re,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(re,t(Y))},r.promisify.custom=$;function ne(P,Y){if(!P){var re=new Error("Promise was rejected with a falsy value");re.reason=P,P=re}return Y(P)}function K(P){if(typeof P!="function")throw new TypeError('The "original" argument must be of type Function');function Y(){for(var re=[],le=0;le<arguments.length;le++)re.push(arguments[le]);var se=re.pop();if(typeof se!="function")throw new TypeError("The last argument must be of type Function");var R=this,I=function(){return se.apply(R,arguments)};P.apply(this,re).then(function(Q){Xe.nextTick(I.bind(null,null,Q))},function(Q){Xe.nextTick(ne.bind(null,Q,I))})}return Object.setPrototypeOf(Y,Object.getPrototypeOf(P)),Object.defineProperties(Y,t(P)),Y}r.callbackify=K})(so)),so}var tl,jh;function hv(){if(jh)return tl;jh=1;function r(y,h){var _=Object.keys(y);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(y);h&&(b=b.filter(function(N){return Object.getOwnPropertyDescriptor(y,N).enumerable})),_.push.apply(_,b)}return _}function t(y){for(var h=1;h<arguments.length;h++){var _=arguments[h]!=null?arguments[h]:{};h%2?r(Object(_),!0).forEach(function(b){s(y,b,_[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(_)):r(Object(_)).forEach(function(b){Object.defineProperty(y,b,Object.getOwnPropertyDescriptor(_,b))})}return y}function s(y,h,_){return h in y?Object.defineProperty(y,h,{value:_,enumerable:!0,configurable:!0,writable:!0}):y[h]=_,y}function n(y,h){if(!(y instanceof h))throw new TypeError("Cannot call a class as a function")}function i(y,h){for(var _=0;_<h.length;_++){var b=h[_];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(y,b.key,b)}}function o(y,h,_){return h&&i(y.prototype,h),y}var l=Aa(),a=l.Buffer,c=Wf(),p=c.inspect,d=p&&p.custom||"inspect";function m(y,h,_){a.prototype.copy.call(y,h,_)}return tl=(function(){function y(){n(this,y),this.head=null,this.tail=null,this.length=0}return o(y,[{key:"push",value:function(_){var b={data:_,next:null};this.length>0?this.tail.next=b:this.head=b,this.tail=b,++this.length}},{key:"unshift",value:function(_){var b={data:_,next:this.head};this.length===0&&(this.tail=b),this.head=b,++this.length}},{key:"shift",value:function(){if(this.length!==0){var _=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,_}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(_){if(this.length===0)return"";for(var b=this.head,N=""+b.data;b=b.next;)N+=_+b.data;return N}},{key:"concat",value:function(_){if(this.length===0)return a.alloc(0);for(var b=a.allocUnsafe(_>>>0),N=this.head,u=0;N;)m(N.data,b,u),u+=N.data.length,N=N.next;return b}},{key:"consume",value:function(_,b){var N;return _<this.head.data.length?(N=this.head.data.slice(0,_),this.head.data=this.head.data.slice(_)):_===this.head.data.length?N=this.shift():N=b?this._getString(_):this._getBuffer(_),N}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(_){var b=this.head,N=1,u=b.data;for(_-=u.length;b=b.next;){var v=b.data,g=_>v.length?v.length:_;if(g===v.length?u+=v:u+=v.slice(0,_),_-=g,_===0){g===v.length?(++N,b.next?this.head=b.next:this.head=this.tail=null):(this.head=b,b.data=v.slice(g));break}++N}return this.length-=N,u}},{key:"_getBuffer",value:function(_){var b=a.allocUnsafe(_),N=this.head,u=1;for(N.data.copy(b),_-=N.data.length;N=N.next;){var v=N.data,g=_>v.length?v.length:_;if(v.copy(b,b.length-_,0,g),_-=g,_===0){g===v.length?(++u,N.next?this.head=N.next:this.head=this.tail=null):(this.head=N,N.data=v.slice(g));break}++u}return this.length-=u,b}},{key:d,value:function(_,b){return p(this,t({},b,{depth:0,customInspect:!1}))}}]),y})(),tl}var rl,_h;function Hf(){if(_h)return rl;_h=1;function r(l,a){var c=this,p=this._readableState&&this._readableState.destroyed,d=this._writableState&&this._writableState.destroyed;return p||d?(a?a(l):l&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,Xe.nextTick(i,this,l)):Xe.nextTick(i,this,l)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(l||null,function(m){!a&&m?c._writableState?c._writableState.errorEmitted?Xe.nextTick(s,c):(c._writableState.errorEmitted=!0,Xe.nextTick(t,c,m)):Xe.nextTick(t,c,m):a?(Xe.nextTick(s,c),a(m)):Xe.nextTick(s,c)}),this)}function t(l,a){i(l,a),s(l)}function s(l){l._writableState&&!l._writableState.emitClose||l._readableState&&!l._readableState.emitClose||l.emit("close")}function n(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function i(l,a){l.emit("error",a)}function o(l,a){var c=l._readableState,p=l._writableState;c&&c.autoDestroy||p&&p.autoDestroy?l.destroy(a):l.emit("error",a)}return rl={destroy:r,undestroy:n,errorOrDestroy:o},rl}var sl={},kh;function yn(){if(kh)return sl;kh=1;function r(a,c){a.prototype=Object.create(c.prototype),a.prototype.constructor=a,a.__proto__=c}var t={};function s(a,c,p){p||(p=Error);function d(y,h,_){return typeof c=="string"?c:c(y,h,_)}var m=(function(y){r(h,y);function h(_,b,N){return y.call(this,d(_,b,N))||this}return h})(p);m.prototype.name=p.name,m.prototype.code=a,t[a]=m}function n(a,c){if(Array.isArray(a)){var p=a.length;return a=a.map(function(d){return String(d)}),p>2?"one of ".concat(c," ").concat(a.slice(0,p-1).join(", "),", or ")+a[p-1]:p===2?"one of ".concat(c," ").concat(a[0]," or ").concat(a[1]):"of ".concat(c," ").concat(a[0])}else return"of ".concat(c," ").concat(String(a))}function i(a,c,p){return a.substr(0,c.length)===c}function o(a,c,p){return(p===void 0||p>a.length)&&(p=a.length),a.substring(p-c.length,p)===c}function l(a,c,p){return typeof p!="number"&&(p=0),p+c.length>a.length?!1:a.indexOf(c,p)!==-1}return s("ERR_INVALID_OPT_VALUE",function(a,c){return'The value "'+c+'" is invalid for option "'+a+'"'},TypeError),s("ERR_INVALID_ARG_TYPE",function(a,c,p){var d;typeof c=="string"&&i(c,"not ")?(d="must not be",c=c.replace(/^not /,"")):d="must be";var m;if(o(a," argument"))m="The ".concat(a," ").concat(d," ").concat(n(c,"type"));else{var y=l(a,".")?"property":"argument";m='The "'.concat(a,'" ').concat(y," ").concat(d," ").concat(n(c,"type"))}return m+=". Received type ".concat(typeof p),m},TypeError),s("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),s("ERR_METHOD_NOT_IMPLEMENTED",function(a){return"The "+a+" method is not implemented"}),s("ERR_STREAM_PREMATURE_CLOSE","Premature close"),s("ERR_STREAM_DESTROYED",function(a){return"Cannot call "+a+" after a stream was destroyed"}),s("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),s("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),s("ERR_STREAM_WRITE_AFTER_END","write after end"),s("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),s("ERR_UNKNOWN_ENCODING",function(a){return"Unknown encoding: "+a},TypeError),s("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),sl.codes=t,sl}var nl,Nh;function Gf(){if(Nh)return nl;Nh=1;var r=yn().codes.ERR_INVALID_OPT_VALUE;function t(n,i,o){return n.highWaterMark!=null?n.highWaterMark:i?n[o]:null}function s(n,i,o,l){var a=t(i,l,o);if(a!=null){if(!(isFinite(a)&&Math.floor(a)===a)||a<0){var c=l?o:"highWaterMark";throw new r(c,a)}return Math.floor(a)}return n.objectMode?16:16*1024}return nl={getHighWaterMark:s},nl}var il,Sh;function mv(){if(Sh)return il;Sh=1,il=r;function r(s,n){if(t("noDeprecation"))return s;var i=!1;function o(){if(!i){if(t("throwDeprecation"))throw new Error(n);t("traceDeprecation")?console.trace(n):console.warn(n),i=!0}return s.apply(this,arguments)}return o}function t(s){try{if(!zr.localStorage)return!1}catch{return!1}var n=zr.localStorage[s];return n==null?!1:String(n).toLowerCase()==="true"}return il}var al,Ch;function Vf(){if(Ch)return al;Ch=1,al=z;function r(se){var R=this;this.next=null,this.entry=null,this.finish=function(){le(R,se)}}var t;z.WritableState=A;var s={deprecate:mv()},n=Ff(),i=Aa().Buffer,o=zr.Uint8Array||function(){};function l(se){return i.from(se)}function a(se){return i.isBuffer(se)||se instanceof o}var c=Hf(),p=Gf(),d=p.getHighWaterMark,m=yn().codes,y=m.ERR_INVALID_ARG_TYPE,h=m.ERR_METHOD_NOT_IMPLEMENTED,_=m.ERR_MULTIPLE_CALLBACK,b=m.ERR_STREAM_CANNOT_PIPE,N=m.ERR_STREAM_DESTROYED,u=m.ERR_STREAM_NULL_VALUES,v=m.ERR_STREAM_WRITE_AFTER_END,g=m.ERR_UNKNOWN_ENCODING,w=c.errorOrDestroy;js()(z,n);function k(){}function A(se,R,I){t=t||un(),se=se||{},typeof I!="boolean"&&(I=R instanceof t),this.objectMode=!!se.objectMode,I&&(this.objectMode=this.objectMode||!!se.writableObjectMode),this.highWaterMark=d(this,se,"writableHighWaterMark",I),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Q=se.decodeStrings===!1;this.decodeStrings=!Q,this.defaultEncoding=se.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(X){J(R,X)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=se.emitClose!==!1,this.autoDestroy=!!se.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new r(this)}A.prototype.getBuffer=function(){for(var R=this.bufferedRequest,I=[];R;)I.push(R),R=R.next;return I},(function(){try{Object.defineProperty(A.prototype,"buffer",{get:s.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var T;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(T=Function.prototype[Symbol.hasInstance],Object.defineProperty(z,Symbol.hasInstance,{value:function(R){return T.call(this,R)?!0:this!==z?!1:R&&R._writableState instanceof A}})):T=function(R){return R instanceof this};function z(se){t=t||un();var R=this instanceof t;if(!R&&!T.call(z,this))return new z(se);this._writableState=new A(se,this,R),this.writable=!0,se&&(typeof se.write=="function"&&(this._write=se.write),typeof se.writev=="function"&&(this._writev=se.writev),typeof se.destroy=="function"&&(this._destroy=se.destroy),typeof se.final=="function"&&(this._final=se.final)),n.call(this)}z.prototype.pipe=function(){w(this,new b)};function S(se,R){var I=new v;w(se,I),Xe.nextTick(R,I)}function U(se,R,I,Q){var X;return I===null?X=new u:typeof I!="string"&&!R.objectMode&&(X=new y("chunk",["string","Buffer"],I)),X?(w(se,X),Xe.nextTick(Q,X),!1):!0}z.prototype.write=function(se,R,I){var Q=this._writableState,X=!1,V=!Q.objectMode&&a(se);return V&&!i.isBuffer(se)&&(se=l(se)),typeof R=="function"&&(I=R,R=null),V?R="buffer":R||(R=Q.defaultEncoding),typeof I!="function"&&(I=k),Q.ending?S(this,I):(V||U(this,Q,se,I))&&(Q.pendingcb++,X=F(this,Q,V,se,R,I)),X},z.prototype.cork=function(){this._writableState.corked++},z.prototype.uncork=function(){var se=this._writableState;se.corked&&(se.corked--,!se.writing&&!se.corked&&!se.bufferProcessing&&se.bufferedRequest&&$(this,se))},z.prototype.setDefaultEncoding=function(R){if(typeof R=="string"&&(R=R.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((R+"").toLowerCase())>-1))throw new g(R);return this._writableState.defaultEncoding=R,this},Object.defineProperty(z.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function G(se,R,I){return!se.objectMode&&se.decodeStrings!==!1&&typeof R=="string"&&(R=i.from(R,I)),R}Object.defineProperty(z.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function F(se,R,I,Q,X,V){if(!I){var M=G(R,Q,X);Q!==M&&(I=!0,X="buffer",Q=M)}var oe=R.objectMode?1:Q.length;R.length+=oe;var O=R.length<R.highWaterMark;if(O||(R.needDrain=!0),R.writing||R.corked){var ce=R.lastBufferedRequest;R.lastBufferedRequest={chunk:Q,encoding:X,isBuf:I,callback:V,next:null},ce?ce.next=R.lastBufferedRequest:R.bufferedRequest=R.lastBufferedRequest,R.bufferedRequestCount+=1}else C(se,R,!1,oe,Q,X,V);return O}function C(se,R,I,Q,X,V,M){R.writelen=Q,R.writecb=M,R.writing=!0,R.sync=!0,R.destroyed?R.onwrite(new N("write")):I?se._writev(X,R.onwrite):se._write(X,V,R.onwrite),R.sync=!1}function j(se,R,I,Q,X){--R.pendingcb,I?(Xe.nextTick(X,Q),Xe.nextTick(Y,se,R),se._writableState.errorEmitted=!0,w(se,Q)):(X(Q),se._writableState.errorEmitted=!0,w(se,Q),Y(se,R))}function D(se){se.writing=!1,se.writecb=null,se.length-=se.writelen,se.writelen=0}function J(se,R){var I=se._writableState,Q=I.sync,X=I.writecb;if(typeof X!="function")throw new _;if(D(I),R)j(se,I,Q,R,X);else{var V=ne(I)||se.destroyed;!V&&!I.corked&&!I.bufferProcessing&&I.bufferedRequest&&$(se,I),Q?Xe.nextTick(q,se,I,V,X):q(se,I,V,X)}}function q(se,R,I,Q){I||W(se,R),R.pendingcb--,Q(),Y(se,R)}function W(se,R){R.length===0&&R.needDrain&&(R.needDrain=!1,se.emit("drain"))}function $(se,R){R.bufferProcessing=!0;var I=R.bufferedRequest;if(se._writev&&I&&I.next){var Q=R.bufferedRequestCount,X=new Array(Q),V=R.corkedRequestsFree;V.entry=I;for(var M=0,oe=!0;I;)X[M]=I,I.isBuf||(oe=!1),I=I.next,M+=1;X.allBuffers=oe,C(se,R,!0,R.length,X,"",V.finish),R.pendingcb++,R.lastBufferedRequest=null,V.next?(R.corkedRequestsFree=V.next,V.next=null):R.corkedRequestsFree=new r(R),R.bufferedRequestCount=0}else{for(;I;){var O=I.chunk,ce=I.encoding,L=I.callback,f=R.objectMode?1:O.length;if(C(se,R,!1,f,O,ce,L),I=I.next,R.bufferedRequestCount--,R.writing)break}I===null&&(R.lastBufferedRequest=null)}R.bufferedRequest=I,R.bufferProcessing=!1}z.prototype._write=function(se,R,I){I(new h("_write()"))},z.prototype._writev=null,z.prototype.end=function(se,R,I){var Q=this._writableState;return typeof se=="function"?(I=se,se=null,R=null):typeof R=="function"&&(I=R,R=null),se!=null&&this.write(se,R),Q.corked&&(Q.corked=1,this.uncork()),Q.ending||re(this,Q,I),this},Object.defineProperty(z.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function ne(se){return se.ending&&se.length===0&&se.bufferedRequest===null&&!se.finished&&!se.writing}function K(se,R){se._final(function(I){R.pendingcb--,I&&w(se,I),R.prefinished=!0,se.emit("prefinish"),Y(se,R)})}function P(se,R){!R.prefinished&&!R.finalCalled&&(typeof se._final=="function"&&!R.destroyed?(R.pendingcb++,R.finalCalled=!0,Xe.nextTick(K,se,R)):(R.prefinished=!0,se.emit("prefinish")))}function Y(se,R){var I=ne(R);if(I&&(P(se,R),R.pendingcb===0&&(R.finished=!0,se.emit("finish"),R.autoDestroy))){var Q=se._readableState;(!Q||Q.autoDestroy&&Q.endEmitted)&&se.destroy()}return I}function re(se,R,I){R.ending=!0,Y(se,R),I&&(R.finished?Xe.nextTick(I):se.once("finish",I)),R.ended=!0,se.writable=!1}function le(se,R,I){var Q=se.entry;for(se.entry=null;Q;){var X=Q.callback;R.pendingcb--,X(I),Q=Q.next}R.corkedRequestsFree.next=se}return Object.defineProperty(z.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(R){this._writableState&&(this._writableState.destroyed=R)}}),z.prototype.destroy=c.destroy,z.prototype._undestroy=c.undestroy,z.prototype._destroy=function(se,R){R(se)},al}var ol,Eh;function un(){if(Eh)return ol;Eh=1;var r=Object.keys||function(p){var d=[];for(var m in p)d.push(m);return d};ol=l;var t=Kf(),s=Vf();js()(l,t);for(var n=r(s.prototype),i=0;i<n.length;i++){var o=n[i];l.prototype[o]||(l.prototype[o]=s.prototype[o])}function l(p){if(!(this instanceof l))return new l(p);t.call(this,p),s.call(this,p),this.allowHalfOpen=!0,p&&(p.readable===!1&&(this.readable=!1),p.writable===!1&&(this.writable=!1),p.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",a)))}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(l.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function a(){this._writableState.ended||Xe.nextTick(c,this)}function c(p){p.end()}return Object.defineProperty(l.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(d){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=d,this._writableState.destroyed=d)}}),ol}var ll={},ji={exports:{}},Ah;function pv(){return Ah||(Ah=1,(function(r,t){var s=Aa(),n=s.Buffer;function i(l,a){for(var c in l)a[c]=l[c]}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?r.exports=s:(i(s,t),t.Buffer=o);function o(l,a,c){return n(l,a,c)}i(n,o),o.from=function(l,a,c){if(typeof l=="number")throw new TypeError("Argument must not be a number");return n(l,a,c)},o.alloc=function(l,a,c){if(typeof l!="number")throw new TypeError("Argument must be a number");var p=n(l);return a!==void 0?typeof c=="string"?p.fill(a,c):p.fill(a):p.fill(0),p},o.allocUnsafe=function(l){if(typeof l!="number")throw new TypeError("Argument must be a number");return n(l)},o.allocUnsafeSlow=function(l){if(typeof l!="number")throw new TypeError("Argument must be a number");return s.SlowBuffer(l)}})(ji,ji.exports)),ji.exports}var Th;function gc(){if(Th)return ll;Th=1;var r=pv().Buffer,t=r.isEncoding||function(u){switch(u=""+u,u&&u.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(u){if(!u)return"utf8";for(var v;;)switch(u){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return u;default:if(v)return;u=(""+u).toLowerCase(),v=!0}}function n(u){var v=s(u);if(typeof v!="string"&&(r.isEncoding===t||!t(u)))throw new Error("Unknown encoding: "+u);return v||u}ll.StringDecoder=i;function i(u){this.encoding=n(u);var v;switch(this.encoding){case"utf16le":this.text=m,this.end=y,v=4;break;case"utf8":this.fillLast=c,v=4;break;case"base64":this.text=h,this.end=_,v=3;break;default:this.write=b,this.end=N;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(v)}i.prototype.write=function(u){if(u.length===0)return"";var v,g;if(this.lastNeed){if(v=this.fillLast(u),v===void 0)return"";g=this.lastNeed,this.lastNeed=0}else g=0;return g<u.length?v?v+this.text(u,g):this.text(u,g):v||""},i.prototype.end=d,i.prototype.text=p,i.prototype.fillLast=function(u){if(this.lastNeed<=u.length)return u.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);u.copy(this.lastChar,this.lastTotal-this.lastNeed,0,u.length),this.lastNeed-=u.length};function o(u){return u<=127?0:u>>5===6?2:u>>4===14?3:u>>3===30?4:u>>6===2?-1:-2}function l(u,v,g){var w=v.length-1;if(w<g)return 0;var k=o(v[w]);return k>=0?(k>0&&(u.lastNeed=k-1),k):--w<g||k===-2?0:(k=o(v[w]),k>=0?(k>0&&(u.lastNeed=k-2),k):--w<g||k===-2?0:(k=o(v[w]),k>=0?(k>0&&(k===2?k=0:u.lastNeed=k-3),k):0))}function a(u,v,g){if((v[0]&192)!==128)return u.lastNeed=0,"ï¿½";if(u.lastNeed>1&&v.length>1){if((v[1]&192)!==128)return u.lastNeed=1,"ï¿½";if(u.lastNeed>2&&v.length>2&&(v[2]&192)!==128)return u.lastNeed=2,"ï¿½"}}function c(u){var v=this.lastTotal-this.lastNeed,g=a(this,u);if(g!==void 0)return g;if(this.lastNeed<=u.length)return u.copy(this.lastChar,v,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);u.copy(this.lastChar,v,0,u.length),this.lastNeed-=u.length}function p(u,v){var g=l(this,u,v);if(!this.lastNeed)return u.toString("utf8",v);this.lastTotal=g;var w=u.length-(g-this.lastNeed);return u.copy(this.lastChar,0,w),u.toString("utf8",v,w)}function d(u){var v=u&&u.length?this.write(u):"";return this.lastNeed?v+"ï¿½":v}function m(u,v){if((u.length-v)%2===0){var g=u.toString("utf16le",v);if(g){var w=g.charCodeAt(g.length-1);if(w>=55296&&w<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=u[u.length-2],this.lastChar[1]=u[u.length-1],g.slice(0,-1)}return g}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=u[u.length-1],u.toString("utf16le",v,u.length-1)}function y(u){var v=u&&u.length?this.write(u):"";if(this.lastNeed){var g=this.lastTotal-this.lastNeed;return v+this.lastChar.toString("utf16le",0,g)}return v}function h(u,v){var g=(u.length-v)%3;return g===0?u.toString("base64",v):(this.lastNeed=3-g,this.lastTotal=3,g===1?this.lastChar[0]=u[u.length-1]:(this.lastChar[0]=u[u.length-2],this.lastChar[1]=u[u.length-1]),u.toString("base64",v,u.length-g))}function _(u){var v=u&&u.length?this.write(u):"";return this.lastNeed?v+this.lastChar.toString("base64",0,3-this.lastNeed):v}function b(u){return u.toString(this.encoding)}function N(u){return u&&u.length?this.write(u):""}return ll}var cl,Ih;function ud(){if(Ih)return cl;Ih=1;var r=yn().codes.ERR_STREAM_PREMATURE_CLOSE;function t(o){var l=!1;return function(){if(!l){l=!0;for(var a=arguments.length,c=new Array(a),p=0;p<a;p++)c[p]=arguments[p];o.apply(this,c)}}}function s(){}function n(o){return o.setHeader&&typeof o.abort=="function"}function i(o,l,a){if(typeof l=="function")return i(o,null,l);l||(l={}),a=t(a||s);var c=l.readable||l.readable!==!1&&o.readable,p=l.writable||l.writable!==!1&&o.writable,d=function(){o.writable||y()},m=o._writableState&&o._writableState.finished,y=function(){p=!1,m=!0,c||a.call(o)},h=o._readableState&&o._readableState.endEmitted,_=function(){c=!1,h=!0,p||a.call(o)},b=function(g){a.call(o,g)},N=function(){var g;if(c&&!h)return(!o._readableState||!o._readableState.ended)&&(g=new r),a.call(o,g);if(p&&!m)return(!o._writableState||!o._writableState.ended)&&(g=new r),a.call(o,g)},u=function(){o.req.on("finish",y)};return n(o)?(o.on("complete",y),o.on("abort",N),o.req?u():o.on("request",u)):p&&!o._writableState&&(o.on("end",d),o.on("close",d)),o.on("end",_),o.on("finish",y),l.error!==!1&&o.on("error",b),o.on("close",N),function(){o.removeListener("complete",y),o.removeListener("abort",N),o.removeListener("request",u),o.req&&o.req.removeListener("finish",y),o.removeListener("end",d),o.removeListener("close",d),o.removeListener("finish",y),o.removeListener("end",_),o.removeListener("error",b),o.removeListener("close",N)}}return cl=i,cl}var dl,Rh;function fv(){if(Rh)return dl;Rh=1;var r;function t(u,v,g){return v in u?Object.defineProperty(u,v,{value:g,enumerable:!0,configurable:!0,writable:!0}):u[v]=g,u}var s=ud(),n=Symbol("lastResolve"),i=Symbol("lastReject"),o=Symbol("error"),l=Symbol("ended"),a=Symbol("lastPromise"),c=Symbol("handlePromise"),p=Symbol("stream");function d(u,v){return{value:u,done:v}}function m(u){var v=u[n];if(v!==null){var g=u[p].read();g!==null&&(u[a]=null,u[n]=null,u[i]=null,v(d(g,!1)))}}function y(u){Xe.nextTick(m,u)}function h(u,v){return function(g,w){u.then(function(){if(v[l]){g(d(void 0,!0));return}v[c](g,w)},w)}}var _=Object.getPrototypeOf(function(){}),b=Object.setPrototypeOf((r={get stream(){return this[p]},next:function(){var v=this,g=this[o];if(g!==null)return Promise.reject(g);if(this[l])return Promise.resolve(d(void 0,!0));if(this[p].destroyed)return new Promise(function(T,z){Xe.nextTick(function(){v[o]?z(v[o]):T(d(void 0,!0))})});var w=this[a],k;if(w)k=new Promise(h(w,this));else{var A=this[p].read();if(A!==null)return Promise.resolve(d(A,!1));k=new Promise(this[c])}return this[a]=k,k}},t(r,Symbol.asyncIterator,function(){return this}),t(r,"return",function(){var v=this;return new Promise(function(g,w){v[p].destroy(null,function(k){if(k){w(k);return}g(d(void 0,!0))})})}),r),_),N=function(v){var g,w=Object.create(b,(g={},t(g,p,{value:v,writable:!0}),t(g,n,{value:null,writable:!0}),t(g,i,{value:null,writable:!0}),t(g,o,{value:null,writable:!0}),t(g,l,{value:v._readableState.endEmitted,writable:!0}),t(g,c,{value:function(A,T){var z=w[p].read();z?(w[a]=null,w[n]=null,w[i]=null,A(d(z,!1))):(w[n]=A,w[i]=T)},writable:!0}),g));return w[a]=null,s(v,function(k){if(k&&k.code!=="ERR_STREAM_PREMATURE_CLOSE"){var A=w[i];A!==null&&(w[a]=null,w[n]=null,w[i]=null,A(k)),w[o]=k;return}var T=w[n];T!==null&&(w[a]=null,w[n]=null,w[i]=null,T(d(void 0,!0))),w[l]=!0}),v.on("readable",y.bind(null,w)),w};return dl=N,dl}var ul,Oh;function gv(){return Oh||(Oh=1,ul=function(){throw new Error("Readable.from is not available in the browser")}),ul}var hl,Fh;function Kf(){if(Fh)return hl;Fh=1,hl=S;var r;S.ReadableState=z,od().EventEmitter;var t=function(M,oe){return M.listeners(oe).length},s=Ff(),n=Aa().Buffer,i=zr.Uint8Array||function(){};function o(V){return n.from(V)}function l(V){return n.isBuffer(V)||V instanceof i}var a=Wf(),c;a&&a.debuglog?c=a.debuglog("stream"):c=function(){};var p=hv(),d=Hf(),m=Gf(),y=m.getHighWaterMark,h=yn().codes,_=h.ERR_INVALID_ARG_TYPE,b=h.ERR_STREAM_PUSH_AFTER_EOF,N=h.ERR_METHOD_NOT_IMPLEMENTED,u=h.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,v,g,w;js()(S,s);var k=d.errorOrDestroy,A=["error","close","destroy","pause","resume"];function T(V,M,oe){if(typeof V.prependListener=="function")return V.prependListener(M,oe);!V._events||!V._events[M]?V.on(M,oe):Array.isArray(V._events[M])?V._events[M].unshift(oe):V._events[M]=[oe,V._events[M]]}function z(V,M,oe){r=r||un(),V=V||{},typeof oe!="boolean"&&(oe=M instanceof r),this.objectMode=!!V.objectMode,oe&&(this.objectMode=this.objectMode||!!V.readableObjectMode),this.highWaterMark=y(this,V,"readableHighWaterMark",oe),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=V.emitClose!==!1,this.autoDestroy=!!V.autoDestroy,this.destroyed=!1,this.defaultEncoding=V.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,V.encoding&&(v||(v=gc().StringDecoder),this.decoder=new v(V.encoding),this.encoding=V.encoding)}function S(V){if(r=r||un(),!(this instanceof S))return new S(V);var M=this instanceof r;this._readableState=new z(V,this,M),this.readable=!0,V&&(typeof V.read=="function"&&(this._read=V.read),typeof V.destroy=="function"&&(this._destroy=V.destroy)),s.call(this)}Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(M){this._readableState&&(this._readableState.destroyed=M)}}),S.prototype.destroy=d.destroy,S.prototype._undestroy=d.undestroy,S.prototype._destroy=function(V,M){M(V)},S.prototype.push=function(V,M){var oe=this._readableState,O;return oe.objectMode?O=!0:typeof V=="string"&&(M=M||oe.defaultEncoding,M!==oe.encoding&&(V=n.from(V,M),M=""),O=!0),U(this,V,M,!1,O)},S.prototype.unshift=function(V){return U(this,V,null,!0,!1)};function U(V,M,oe,O,ce){c("readableAddChunk",M);var L=V._readableState;if(M===null)L.reading=!1,J(V,L);else{var f;if(ce||(f=F(L,M)),f)k(V,f);else if(L.objectMode||M&&M.length>0)if(typeof M!="string"&&!L.objectMode&&Object.getPrototypeOf(M)!==n.prototype&&(M=o(M)),O)L.endEmitted?k(V,new u):G(V,L,M,!0);else if(L.ended)k(V,new b);else{if(L.destroyed)return!1;L.reading=!1,L.decoder&&!oe?(M=L.decoder.write(M),L.objectMode||M.length!==0?G(V,L,M,!1):$(V,L)):G(V,L,M,!1)}else O||(L.reading=!1,$(V,L))}return!L.ended&&(L.length<L.highWaterMark||L.length===0)}function G(V,M,oe,O){M.flowing&&M.length===0&&!M.sync?(M.awaitDrain=0,V.emit("data",oe)):(M.length+=M.objectMode?1:oe.length,O?M.buffer.unshift(oe):M.buffer.push(oe),M.needReadable&&q(V)),$(V,M)}function F(V,M){var oe;return!l(M)&&typeof M!="string"&&M!==void 0&&!V.objectMode&&(oe=new _("chunk",["string","Buffer","Uint8Array"],M)),oe}S.prototype.isPaused=function(){return this._readableState.flowing===!1},S.prototype.setEncoding=function(V){v||(v=gc().StringDecoder);var M=new v(V);this._readableState.decoder=M,this._readableState.encoding=this._readableState.decoder.encoding;for(var oe=this._readableState.buffer.head,O="";oe!==null;)O+=M.write(oe.data),oe=oe.next;return this._readableState.buffer.clear(),O!==""&&this._readableState.buffer.push(O),this._readableState.length=O.length,this};var C=1073741824;function j(V){return V>=C?V=C:(V--,V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,V|=V>>>16,V++),V}function D(V,M){return V<=0||M.length===0&&M.ended?0:M.objectMode?1:V!==V?M.flowing&&M.length?M.buffer.head.data.length:M.length:(V>M.highWaterMark&&(M.highWaterMark=j(V)),V<=M.length?V:M.ended?M.length:(M.needReadable=!0,0))}S.prototype.read=function(V){c("read",V),V=parseInt(V,10);var M=this._readableState,oe=V;if(V!==0&&(M.emittedReadable=!1),V===0&&M.needReadable&&((M.highWaterMark!==0?M.length>=M.highWaterMark:M.length>0)||M.ended))return c("read: emitReadable",M.length,M.ended),M.length===0&&M.ended?I(this):q(this),null;if(V=D(V,M),V===0&&M.ended)return M.length===0&&I(this),null;var O=M.needReadable;c("need readable",O),(M.length===0||M.length-V<M.highWaterMark)&&(O=!0,c("length less than watermark",O)),M.ended||M.reading?(O=!1,c("reading or ended",O)):O&&(c("do read"),M.reading=!0,M.sync=!0,M.length===0&&(M.needReadable=!0),this._read(M.highWaterMark),M.sync=!1,M.reading||(V=D(oe,M)));var ce;return V>0?ce=R(V,M):ce=null,ce===null?(M.needReadable=M.length<=M.highWaterMark,V=0):(M.length-=V,M.awaitDrain=0),M.length===0&&(M.ended||(M.needReadable=!0),oe!==V&&M.ended&&I(this)),ce!==null&&this.emit("data",ce),ce};function J(V,M){if(c("onEofChunk"),!M.ended){if(M.decoder){var oe=M.decoder.end();oe&&oe.length&&(M.buffer.push(oe),M.length+=M.objectMode?1:oe.length)}M.ended=!0,M.sync?q(V):(M.needReadable=!1,M.emittedReadable||(M.emittedReadable=!0,W(V)))}}function q(V){var M=V._readableState;c("emitReadable",M.needReadable,M.emittedReadable),M.needReadable=!1,M.emittedReadable||(c("emitReadable",M.flowing),M.emittedReadable=!0,Xe.nextTick(W,V))}function W(V){var M=V._readableState;c("emitReadable_",M.destroyed,M.length,M.ended),!M.destroyed&&(M.length||M.ended)&&(V.emit("readable"),M.emittedReadable=!1),M.needReadable=!M.flowing&&!M.ended&&M.length<=M.highWaterMark,se(V)}function $(V,M){M.readingMore||(M.readingMore=!0,Xe.nextTick(ne,V,M))}function ne(V,M){for(;!M.reading&&!M.ended&&(M.length<M.highWaterMark||M.flowing&&M.length===0);){var oe=M.length;if(c("maybeReadMore read 0"),V.read(0),oe===M.length)break}M.readingMore=!1}S.prototype._read=function(V){k(this,new N("_read()"))},S.prototype.pipe=function(V,M){var oe=this,O=this._readableState;switch(O.pipesCount){case 0:O.pipes=V;break;case 1:O.pipes=[O.pipes,V];break;default:O.pipes.push(V);break}O.pipesCount+=1,c("pipe count=%d opts=%j",O.pipesCount,M);var ce=(!M||M.end!==!1)&&V!==Xe.stdout&&V!==Xe.stderr,L=ce?x:ke;O.endEmitted?Xe.nextTick(L):oe.once("end",L),V.on("unpipe",f);function f(Oe,De){c("onunpipe"),Oe===oe&&De&&De.hasUnpiped===!1&&(De.hasUnpiped=!0,ee())}function x(){c("onend"),V.end()}var E=K(oe);V.on("drain",E);var H=!1;function ee(){c("cleanup"),V.removeListener("close",pe),V.removeListener("finish",ie),V.removeListener("drain",E),V.removeListener("error",ue),V.removeListener("unpipe",f),oe.removeListener("end",x),oe.removeListener("end",ke),oe.removeListener("data",Z),H=!0,O.awaitDrain&&(!V._writableState||V._writableState.needDrain)&&E()}oe.on("data",Z);function Z(Oe){c("ondata");var De=V.write(Oe);c("dest.write",De),De===!1&&((O.pipesCount===1&&O.pipes===V||O.pipesCount>1&&X(O.pipes,V)!==-1)&&!H&&(c("false write response, pause",O.awaitDrain),O.awaitDrain++),oe.pause())}function ue(Oe){c("onerror",Oe),ke(),V.removeListener("error",ue),t(V,"error")===0&&k(V,Oe)}T(V,"error",ue);function pe(){V.removeListener("finish",ie),ke()}V.once("close",pe);function ie(){c("onfinish"),V.removeListener("close",pe),ke()}V.once("finish",ie);function ke(){c("unpipe"),oe.unpipe(V)}return V.emit("pipe",oe),O.flowing||(c("pipe resume"),oe.resume()),V};function K(V){return function(){var oe=V._readableState;c("pipeOnDrain",oe.awaitDrain),oe.awaitDrain&&oe.awaitDrain--,oe.awaitDrain===0&&t(V,"data")&&(oe.flowing=!0,se(V))}}S.prototype.unpipe=function(V){var M=this._readableState,oe={hasUnpiped:!1};if(M.pipesCount===0)return this;if(M.pipesCount===1)return V&&V!==M.pipes?this:(V||(V=M.pipes),M.pipes=null,M.pipesCount=0,M.flowing=!1,V&&V.emit("unpipe",this,oe),this);if(!V){var O=M.pipes,ce=M.pipesCount;M.pipes=null,M.pipesCount=0,M.flowing=!1;for(var L=0;L<ce;L++)O[L].emit("unpipe",this,{hasUnpiped:!1});return this}var f=X(M.pipes,V);return f===-1?this:(M.pipes.splice(f,1),M.pipesCount-=1,M.pipesCount===1&&(M.pipes=M.pipes[0]),V.emit("unpipe",this,oe),this)},S.prototype.on=function(V,M){var oe=s.prototype.on.call(this,V,M),O=this._readableState;return V==="data"?(O.readableListening=this.listenerCount("readable")>0,O.flowing!==!1&&this.resume()):V==="readable"&&!O.endEmitted&&!O.readableListening&&(O.readableListening=O.needReadable=!0,O.flowing=!1,O.emittedReadable=!1,c("on readable",O.length,O.reading),O.length?q(this):O.reading||Xe.nextTick(Y,this)),oe},S.prototype.addListener=S.prototype.on,S.prototype.removeListener=function(V,M){var oe=s.prototype.removeListener.call(this,V,M);return V==="readable"&&Xe.nextTick(P,this),oe},S.prototype.removeAllListeners=function(V){var M=s.prototype.removeAllListeners.apply(this,arguments);return(V==="readable"||V===void 0)&&Xe.nextTick(P,this),M};function P(V){var M=V._readableState;M.readableListening=V.listenerCount("readable")>0,M.resumeScheduled&&!M.paused?M.flowing=!0:V.listenerCount("data")>0&&V.resume()}function Y(V){c("readable nexttick read 0"),V.read(0)}S.prototype.resume=function(){var V=this._readableState;return V.flowing||(c("resume"),V.flowing=!V.readableListening,re(this,V)),V.paused=!1,this};function re(V,M){M.resumeScheduled||(M.resumeScheduled=!0,Xe.nextTick(le,V,M))}function le(V,M){c("resume",M.reading),M.reading||V.read(0),M.resumeScheduled=!1,V.emit("resume"),se(V),M.flowing&&!M.reading&&V.read(0)}S.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function se(V){var M=V._readableState;for(c("flow",M.flowing);M.flowing&&V.read()!==null;);}S.prototype.wrap=function(V){var M=this,oe=this._readableState,O=!1;V.on("end",function(){if(c("wrapped end"),oe.decoder&&!oe.ended){var f=oe.decoder.end();f&&f.length&&M.push(f)}M.push(null)}),V.on("data",function(f){if(c("wrapped data"),oe.decoder&&(f=oe.decoder.write(f)),!(oe.objectMode&&f==null)&&!(!oe.objectMode&&(!f||!f.length))){var x=M.push(f);x||(O=!0,V.pause())}});for(var ce in V)this[ce]===void 0&&typeof V[ce]=="function"&&(this[ce]=(function(x){return function(){return V[x].apply(V,arguments)}})(ce));for(var L=0;L<A.length;L++)V.on(A[L],this.emit.bind(this,A[L]));return this._read=function(f){c("wrapped _read",f),O&&(O=!1,V.resume())},this},typeof Symbol=="function"&&(S.prototype[Symbol.asyncIterator]=function(){return g===void 0&&(g=fv()),g(this)}),Object.defineProperty(S.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(S.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(S.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(M){this._readableState&&(this._readableState.flowing=M)}}),S._fromList=R,Object.defineProperty(S.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function R(V,M){if(M.length===0)return null;var oe;return M.objectMode?oe=M.buffer.shift():!V||V>=M.length?(M.decoder?oe=M.buffer.join(""):M.buffer.length===1?oe=M.buffer.first():oe=M.buffer.concat(M.length),M.buffer.clear()):oe=M.buffer.consume(V,M.decoder),oe}function I(V){var M=V._readableState;c("endReadable",M.endEmitted),M.endEmitted||(M.ended=!0,Xe.nextTick(Q,M,V))}function Q(V,M){if(c("endReadableNT",V.endEmitted,V.length),!V.endEmitted&&V.length===0&&(V.endEmitted=!0,M.readable=!1,M.emit("end"),V.autoDestroy)){var oe=M._writableState;(!oe||oe.autoDestroy&&oe.finished)&&M.destroy()}}typeof Symbol=="function"&&(S.from=function(V,M){return w===void 0&&(w=gv()),w(S,V,M)});function X(V,M){for(var oe=0,O=V.length;oe<O;oe++)if(V[oe]===M)return oe;return-1}return hl}var ml,Ph;function Xf(){if(Ph)return ml;Ph=1,ml=a;var r=yn().codes,t=r.ERR_METHOD_NOT_IMPLEMENTED,s=r.ERR_MULTIPLE_CALLBACK,n=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,i=r.ERR_TRANSFORM_WITH_LENGTH_0,o=un();js()(a,o);function l(d,m){var y=this._transformState;y.transforming=!1;var h=y.writecb;if(h===null)return this.emit("error",new s);y.writechunk=null,y.writecb=null,m!=null&&this.push(m),h(d);var _=this._readableState;_.reading=!1,(_.needReadable||_.length<_.highWaterMark)&&this._read(_.highWaterMark)}function a(d){if(!(this instanceof a))return new a(d);o.call(this,d),this._transformState={afterTransform:l.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,d&&(typeof d.transform=="function"&&(this._transform=d.transform),typeof d.flush=="function"&&(this._flush=d.flush)),this.on("prefinish",c)}function c(){var d=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(m,y){p(d,m,y)}):p(this,null,null)}a.prototype.push=function(d,m){return this._transformState.needTransform=!1,o.prototype.push.call(this,d,m)},a.prototype._transform=function(d,m,y){y(new t("_transform()"))},a.prototype._write=function(d,m,y){var h=this._transformState;if(h.writecb=y,h.writechunk=d,h.writeencoding=m,!h.transforming){var _=this._readableState;(h.needTransform||_.needReadable||_.length<_.highWaterMark)&&this._read(_.highWaterMark)}},a.prototype._read=function(d){var m=this._transformState;m.writechunk!==null&&!m.transforming?(m.transforming=!0,this._transform(m.writechunk,m.writeencoding,m.afterTransform)):m.needTransform=!0},a.prototype._destroy=function(d,m){o.prototype._destroy.call(this,d,function(y){m(y)})};function p(d,m,y){if(m)return d.emit("error",m);if(y!=null&&d.push(y),d._writableState.length)throw new i;if(d._transformState.transforming)throw new n;return d.push(null)}return ml}var pl,Lh;function xv(){if(Lh)return pl;Lh=1,pl=t;var r=Xf();js()(t,r);function t(s){if(!(this instanceof t))return new t(s);r.call(this,s)}return t.prototype._transform=function(s,n,i){i(null,s)},pl}var fl,Dh;function yv(){if(Dh)return fl;Dh=1;var r;function t(y){var h=!1;return function(){h||(h=!0,y.apply(void 0,arguments))}}var s=yn().codes,n=s.ERR_MISSING_ARGS,i=s.ERR_STREAM_DESTROYED;function o(y){if(y)throw y}function l(y){return y.setHeader&&typeof y.abort=="function"}function a(y,h,_,b){b=t(b);var N=!1;y.on("close",function(){N=!0}),r===void 0&&(r=ud()),r(y,{readable:h,writable:_},function(v){if(v)return b(v);N=!0,b()});var u=!1;return function(v){if(!N&&!u){if(u=!0,l(y))return y.abort();if(typeof y.destroy=="function")return y.destroy();b(v||new i("pipe"))}}}function c(y){y()}function p(y,h){return y.pipe(h)}function d(y){return!y.length||typeof y[y.length-1]!="function"?o:y.pop()}function m(){for(var y=arguments.length,h=new Array(y),_=0;_<y;_++)h[_]=arguments[_];var b=d(h);if(Array.isArray(h[0])&&(h=h[0]),h.length<2)throw new n("streams");var N,u=h.map(function(v,g){var w=g<h.length-1,k=g>0;return a(v,w,k,function(A){N||(N=A),A&&u.forEach(c),!w&&(u.forEach(c),b(N))})});return h.reduce(p)}return fl=m,fl}var gl,Mh;function hd(){if(Mh)return gl;Mh=1,gl=s;var r=od().EventEmitter,t=js();t(s,r),s.Readable=Kf(),s.Writable=Vf(),s.Duplex=un(),s.Transform=Xf(),s.PassThrough=xv(),s.finished=ud(),s.pipeline=yv(),s.Stream=s;function s(){r.call(this)}return s.prototype.pipe=function(n,i){var o=this;function l(h){n.writable&&n.write(h)===!1&&o.pause&&o.pause()}o.on("data",l);function a(){o.readable&&o.resume&&o.resume()}n.on("drain",a),!n._isStdio&&(!i||i.end!==!1)&&(o.on("end",p),o.on("close",d));var c=!1;function p(){c||(c=!0,n.end())}function d(){c||(c=!0,typeof n.destroy=="function"&&n.destroy())}function m(h){if(y(),r.listenerCount(this,"error")===0)throw h}o.on("error",m),n.on("error",m);function y(){o.removeListener("data",l),n.removeListener("drain",a),o.removeListener("end",p),o.removeListener("close",d),o.removeListener("error",m),n.removeListener("error",m),o.removeListener("end",y),o.removeListener("close",y),n.removeListener("close",y)}return o.on("end",y),o.on("close",y),n.on("close",y),n.emit("pipe",o),n},gl}var $h;function bv(){return $h||($h=1,(function(r){(function(t){t.parser=function(R,I){return new n(R,I)},t.SAXParser=n,t.SAXStream=d,t.createStream=p,t.MAX_BUFFER_LENGTH=64*1024;var s=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];t.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function n(R,I){if(!(this instanceof n))return new n(R,I);var Q=this;o(Q),Q.q=Q.c="",Q.bufferCheckPosition=t.MAX_BUFFER_LENGTH,Q.opt=I||{},Q.opt.lowercase=Q.opt.lowercase||Q.opt.lowercasetags,Q.looseCase=Q.opt.lowercase?"toLowerCase":"toUpperCase",Q.tags=[],Q.closed=Q.closedRoot=Q.sawRoot=!1,Q.tag=Q.error=null,Q.strict=!!R,Q.noscript=!!(R||Q.opt.noscript),Q.state=S.BEGIN,Q.strictEntities=Q.opt.strictEntities,Q.ENTITIES=Q.strictEntities?Object.create(t.XML_ENTITIES):Object.create(t.ENTITIES),Q.attribList=[],Q.opt.xmlns&&(Q.ns=Object.create(b)),Q.trackPosition=Q.opt.position!==!1,Q.trackPosition&&(Q.position=Q.line=Q.column=0),G(Q,"onready")}Object.create||(Object.create=function(R){function I(){}I.prototype=R;var Q=new I;return Q}),Object.keys||(Object.keys=function(R){var I=[];for(var Q in R)R.hasOwnProperty(Q)&&I.push(Q);return I});function i(R){for(var I=Math.max(t.MAX_BUFFER_LENGTH,10),Q=0,X=0,V=s.length;X<V;X++){var M=R[s[X]].length;if(M>I)switch(s[X]){case"textNode":C(R);break;case"cdata":F(R,"oncdata",R.cdata),R.cdata="";break;case"script":F(R,"onscript",R.script),R.script="";break;default:D(R,"Max buffer length exceeded: "+s[X])}Q=Math.max(Q,M)}var oe=t.MAX_BUFFER_LENGTH-Q;R.bufferCheckPosition=oe+R.position}function o(R){for(var I=0,Q=s.length;I<Q;I++)R[s[I]]=""}function l(R){C(R),R.cdata!==""&&(F(R,"oncdata",R.cdata),R.cdata=""),R.script!==""&&(F(R,"onscript",R.script),R.script="")}n.prototype={end:function(){J(this)},write:se,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){l(this)}};var a;try{a=hd().Stream}catch{a=function(){}}var c=t.EVENTS.filter(function(R){return R!=="error"&&R!=="end"});function p(R,I){return new d(R,I)}function d(R,I){if(!(this instanceof d))return new d(R,I);a.apply(this),this._parser=new n(R,I),this.writable=!0,this.readable=!0;var Q=this;this._parser.onend=function(){Q.emit("end")},this._parser.onerror=function(X){Q.emit("error",X),Q._parser.error=null},this._decoder=null,c.forEach(function(X){Object.defineProperty(Q,"on"+X,{get:function(){return Q._parser["on"+X]},set:function(V){if(!V)return Q.removeAllListeners(X),Q._parser["on"+X]=V,V;Q.on(X,V)},enumerable:!0,configurable:!1})})}d.prototype=Object.create(a.prototype,{constructor:{value:d}}),d.prototype.write=function(R){if(typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(R)){if(!this._decoder){var I=gc().StringDecoder;this._decoder=new I("utf8")}R=this._decoder.write(R)}return this._parser.write(R.toString()),this.emit("data",R),!0},d.prototype.end=function(R){return R&&R.length&&this.write(R),this._parser.end(),!0},d.prototype.on=function(R,I){var Q=this;return!Q._parser["on"+R]&&c.indexOf(R)!==-1&&(Q._parser["on"+R]=function(){var X=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);X.splice(0,0,R),Q.emit.apply(Q,X)}),a.prototype.on.call(Q,R,I)};var m="[CDATA[",y="DOCTYPE",h="http://www.w3.org/XML/1998/namespace",_="http://www.w3.org/2000/xmlns/",b={xml:h,xmlns:_},N=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,u=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,v=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,g=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function w(R){return R===" "||R===`
`||R==="\r"||R==="	"}function k(R){return R==='"'||R==="'"}function A(R){return R===">"||w(R)}function T(R,I){return R.test(I)}function z(R,I){return!T(R,I)}var S=0;t.STATE={BEGIN:S++,BEGIN_WHITESPACE:S++,TEXT:S++,TEXT_ENTITY:S++,OPEN_WAKA:S++,SGML_DECL:S++,SGML_DECL_QUOTED:S++,DOCTYPE:S++,DOCTYPE_QUOTED:S++,DOCTYPE_DTD:S++,DOCTYPE_DTD_QUOTED:S++,COMMENT_STARTING:S++,COMMENT:S++,COMMENT_ENDING:S++,COMMENT_ENDED:S++,CDATA:S++,CDATA_ENDING:S++,CDATA_ENDING_2:S++,PROC_INST:S++,PROC_INST_BODY:S++,PROC_INST_ENDING:S++,OPEN_TAG:S++,OPEN_TAG_SLASH:S++,ATTRIB:S++,ATTRIB_NAME:S++,ATTRIB_NAME_SAW_WHITE:S++,ATTRIB_VALUE:S++,ATTRIB_VALUE_QUOTED:S++,ATTRIB_VALUE_CLOSED:S++,ATTRIB_VALUE_UNQUOTED:S++,ATTRIB_VALUE_ENTITY_Q:S++,ATTRIB_VALUE_ENTITY_U:S++,CLOSE_TAG:S++,CLOSE_TAG_SAW_WHITE:S++,SCRIPT:S++,SCRIPT_ENDING:S++},t.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},t.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(t.ENTITIES).forEach(function(R){var I=t.ENTITIES[R],Q=typeof I=="number"?String.fromCharCode(I):I;t.ENTITIES[R]=Q});for(var U in t.STATE)t.STATE[t.STATE[U]]=U;S=t.STATE;function G(R,I,Q){R[I]&&R[I](Q)}function F(R,I,Q){R.textNode&&C(R),G(R,I,Q)}function C(R){R.textNode=j(R.opt,R.textNode),R.textNode&&G(R,"ontext",R.textNode),R.textNode=""}function j(R,I){return R.trim&&(I=I.trim()),R.normalize&&(I=I.replace(/\s+/g," ")),I}function D(R,I){return C(R),R.trackPosition&&(I+=`
Line: `+R.line+`
Column: `+R.column+`
Char: `+R.c),I=new Error(I),R.error=I,G(R,"onerror",I),R}function J(R){return R.sawRoot&&!R.closedRoot&&q(R,"Unclosed root tag"),R.state!==S.BEGIN&&R.state!==S.BEGIN_WHITESPACE&&R.state!==S.TEXT&&D(R,"Unexpected end"),C(R),R.c="",R.closed=!0,G(R,"onend"),n.call(R,R.strict,R.opt),R}function q(R,I){if(typeof R!="object"||!(R instanceof n))throw new Error("bad call to strictFail");R.strict&&D(R,I)}function W(R){R.strict||(R.tagName=R.tagName[R.looseCase]());var I=R.tags[R.tags.length-1]||R,Q=R.tag={name:R.tagName,attributes:{}};R.opt.xmlns&&(Q.ns=I.ns),R.attribList.length=0,F(R,"onopentagstart",Q)}function $(R,I){var Q=R.indexOf(":"),X=Q<0?["",R]:R.split(":"),V=X[0],M=X[1];return I&&R==="xmlns"&&(V="xmlns",M=""),{prefix:V,local:M}}function ne(R){if(R.strict||(R.attribName=R.attribName[R.looseCase]()),R.attribList.indexOf(R.attribName)!==-1||R.tag.attributes.hasOwnProperty(R.attribName)){R.attribName=R.attribValue="";return}if(R.opt.xmlns){var I=$(R.attribName,!0),Q=I.prefix,X=I.local;if(Q==="xmlns")if(X==="xml"&&R.attribValue!==h)q(R,"xml: prefix must be bound to "+h+`
Actual: `+R.attribValue);else if(X==="xmlns"&&R.attribValue!==_)q(R,"xmlns: prefix must be bound to "+_+`
Actual: `+R.attribValue);else{var V=R.tag,M=R.tags[R.tags.length-1]||R;V.ns===M.ns&&(V.ns=Object.create(M.ns)),V.ns[X]=R.attribValue}R.attribList.push([R.attribName,R.attribValue])}else R.tag.attributes[R.attribName]=R.attribValue,F(R,"onattribute",{name:R.attribName,value:R.attribValue});R.attribName=R.attribValue=""}function K(R,I){if(R.opt.xmlns){var Q=R.tag,X=$(R.tagName);Q.prefix=X.prefix,Q.local=X.local,Q.uri=Q.ns[X.prefix]||"",Q.prefix&&!Q.uri&&(q(R,"Unbound namespace prefix: "+JSON.stringify(R.tagName)),Q.uri=X.prefix);var V=R.tags[R.tags.length-1]||R;Q.ns&&V.ns!==Q.ns&&Object.keys(Q.ns).forEach(function(Z){F(R,"onopennamespace",{prefix:Z,uri:Q.ns[Z]})});for(var M=0,oe=R.attribList.length;M<oe;M++){var O=R.attribList[M],ce=O[0],L=O[1],f=$(ce,!0),x=f.prefix,E=f.local,H=x===""?"":Q.ns[x]||"",ee={name:ce,value:L,prefix:x,local:E,uri:H};x&&x!=="xmlns"&&!H&&(q(R,"Unbound namespace prefix: "+JSON.stringify(x)),ee.uri=x),R.tag.attributes[ce]=ee,F(R,"onattribute",ee)}R.attribList.length=0}R.tag.isSelfClosing=!!I,R.sawRoot=!0,R.tags.push(R.tag),F(R,"onopentag",R.tag),I||(!R.noscript&&R.tagName.toLowerCase()==="script"?R.state=S.SCRIPT:R.state=S.TEXT,R.tag=null,R.tagName=""),R.attribName=R.attribValue="",R.attribList.length=0}function P(R){if(!R.tagName){q(R,"Weird empty close tag."),R.textNode+="</>",R.state=S.TEXT;return}if(R.script){if(R.tagName!=="script"){R.script+="</"+R.tagName+">",R.tagName="",R.state=S.SCRIPT;return}F(R,"onscript",R.script),R.script=""}var I=R.tags.length,Q=R.tagName;R.strict||(Q=Q[R.looseCase]());for(var X=Q;I--;){var V=R.tags[I];if(V.name!==X)q(R,"Unexpected close tag");else break}if(I<0){q(R,"Unmatched closing tag: "+R.tagName),R.textNode+="</"+R.tagName+">",R.state=S.TEXT;return}R.tagName=Q;for(var M=R.tags.length;M-- >I;){var oe=R.tag=R.tags.pop();R.tagName=R.tag.name,F(R,"onclosetag",R.tagName);var O={};for(var ce in oe.ns)O[ce]=oe.ns[ce];var L=R.tags[R.tags.length-1]||R;R.opt.xmlns&&oe.ns!==L.ns&&Object.keys(oe.ns).forEach(function(f){var x=oe.ns[f];F(R,"onclosenamespace",{prefix:f,uri:x})})}I===0&&(R.closedRoot=!0),R.tagName=R.attribValue=R.attribName="",R.attribList.length=0,R.state=S.TEXT}function Y(R){var I=R.entity,Q=I.toLowerCase(),X,V="";return R.ENTITIES[I]?R.ENTITIES[I]:R.ENTITIES[Q]?R.ENTITIES[Q]:(I=Q,I.charAt(0)==="#"&&(I.charAt(1)==="x"?(I=I.slice(2),X=parseInt(I,16),V=X.toString(16)):(I=I.slice(1),X=parseInt(I,10),V=X.toString(10))),I=I.replace(/^0+/,""),isNaN(X)||V.toLowerCase()!==I?(q(R,"Invalid character entity"),"&"+R.entity+";"):String.fromCodePoint(X))}function re(R,I){I==="<"?(R.state=S.OPEN_WAKA,R.startTagPosition=R.position):w(I)||(q(R,"Non-whitespace before first tag."),R.textNode=I,R.state=S.TEXT)}function le(R,I){var Q="";return I<R.length&&(Q=R.charAt(I)),Q}function se(R){var I=this;if(this.error)throw this.error;if(I.closed)return D(I,"Cannot write after close. Assign an onready handler.");if(R===null)return J(I);typeof R=="object"&&(R=R.toString());for(var Q=0,X="";X=le(R,Q++),I.c=X,!!X;)switch(I.trackPosition&&(I.position++,X===`
`?(I.line++,I.column=0):I.column++),I.state){case S.BEGIN:if(I.state=S.BEGIN_WHITESPACE,X==="\uFEFF")continue;re(I,X);continue;case S.BEGIN_WHITESPACE:re(I,X);continue;case S.TEXT:if(I.sawRoot&&!I.closedRoot){for(var V=Q-1;X&&X!=="<"&&X!=="&";)X=le(R,Q++),X&&I.trackPosition&&(I.position++,X===`
`?(I.line++,I.column=0):I.column++);I.textNode+=R.substring(V,Q-1)}X==="<"&&!(I.sawRoot&&I.closedRoot&&!I.strict)?(I.state=S.OPEN_WAKA,I.startTagPosition=I.position):(!w(X)&&(!I.sawRoot||I.closedRoot)&&q(I,"Text data outside of root node."),X==="&"?I.state=S.TEXT_ENTITY:I.textNode+=X);continue;case S.SCRIPT:X==="<"?I.state=S.SCRIPT_ENDING:I.script+=X;continue;case S.SCRIPT_ENDING:X==="/"?I.state=S.CLOSE_TAG:(I.script+="<"+X,I.state=S.SCRIPT);continue;case S.OPEN_WAKA:if(X==="!")I.state=S.SGML_DECL,I.sgmlDecl="";else if(!w(X))if(T(N,X))I.state=S.OPEN_TAG,I.tagName=X;else if(X==="/")I.state=S.CLOSE_TAG,I.tagName="";else if(X==="?")I.state=S.PROC_INST,I.procInstName=I.procInstBody="";else{if(q(I,"Unencoded <"),I.startTagPosition+1<I.position){var M=I.position-I.startTagPosition;X=new Array(M).join(" ")+X}I.textNode+="<"+X,I.state=S.TEXT}continue;case S.SGML_DECL:(I.sgmlDecl+X).toUpperCase()===m?(F(I,"onopencdata"),I.state=S.CDATA,I.sgmlDecl="",I.cdata=""):I.sgmlDecl+X==="--"?(I.state=S.COMMENT,I.comment="",I.sgmlDecl=""):(I.sgmlDecl+X).toUpperCase()===y?(I.state=S.DOCTYPE,(I.doctype||I.sawRoot)&&q(I,"Inappropriately located doctype declaration"),I.doctype="",I.sgmlDecl=""):X===">"?(F(I,"onsgmldeclaration",I.sgmlDecl),I.sgmlDecl="",I.state=S.TEXT):(k(X)&&(I.state=S.SGML_DECL_QUOTED),I.sgmlDecl+=X);continue;case S.SGML_DECL_QUOTED:X===I.q&&(I.state=S.SGML_DECL,I.q=""),I.sgmlDecl+=X;continue;case S.DOCTYPE:X===">"?(I.state=S.TEXT,F(I,"ondoctype",I.doctype),I.doctype=!0):(I.doctype+=X,X==="["?I.state=S.DOCTYPE_DTD:k(X)&&(I.state=S.DOCTYPE_QUOTED,I.q=X));continue;case S.DOCTYPE_QUOTED:I.doctype+=X,X===I.q&&(I.q="",I.state=S.DOCTYPE);continue;case S.DOCTYPE_DTD:I.doctype+=X,X==="]"?I.state=S.DOCTYPE:k(X)&&(I.state=S.DOCTYPE_DTD_QUOTED,I.q=X);continue;case S.DOCTYPE_DTD_QUOTED:I.doctype+=X,X===I.q&&(I.state=S.DOCTYPE_DTD,I.q="");continue;case S.COMMENT:X==="-"?I.state=S.COMMENT_ENDING:I.comment+=X;continue;case S.COMMENT_ENDING:X==="-"?(I.state=S.COMMENT_ENDED,I.comment=j(I.opt,I.comment),I.comment&&F(I,"oncomment",I.comment),I.comment=""):(I.comment+="-"+X,I.state=S.COMMENT);continue;case S.COMMENT_ENDED:X!==">"?(q(I,"Malformed comment"),I.comment+="--"+X,I.state=S.COMMENT):I.state=S.TEXT;continue;case S.CDATA:X==="]"?I.state=S.CDATA_ENDING:I.cdata+=X;continue;case S.CDATA_ENDING:X==="]"?I.state=S.CDATA_ENDING_2:(I.cdata+="]"+X,I.state=S.CDATA);continue;case S.CDATA_ENDING_2:X===">"?(I.cdata&&F(I,"oncdata",I.cdata),F(I,"onclosecdata"),I.cdata="",I.state=S.TEXT):X==="]"?I.cdata+="]":(I.cdata+="]]"+X,I.state=S.CDATA);continue;case S.PROC_INST:X==="?"?I.state=S.PROC_INST_ENDING:w(X)?I.state=S.PROC_INST_BODY:I.procInstName+=X;continue;case S.PROC_INST_BODY:if(!I.procInstBody&&w(X))continue;X==="?"?I.state=S.PROC_INST_ENDING:I.procInstBody+=X;continue;case S.PROC_INST_ENDING:X===">"?(F(I,"onprocessinginstruction",{name:I.procInstName,body:I.procInstBody}),I.procInstName=I.procInstBody="",I.state=S.TEXT):(I.procInstBody+="?"+X,I.state=S.PROC_INST_BODY);continue;case S.OPEN_TAG:T(u,X)?I.tagName+=X:(W(I),X===">"?K(I):X==="/"?I.state=S.OPEN_TAG_SLASH:(w(X)||q(I,"Invalid character in tag name"),I.state=S.ATTRIB));continue;case S.OPEN_TAG_SLASH:X===">"?(K(I,!0),P(I)):(q(I,"Forward-slash in opening tag not followed by >"),I.state=S.ATTRIB);continue;case S.ATTRIB:if(w(X))continue;X===">"?K(I):X==="/"?I.state=S.OPEN_TAG_SLASH:T(N,X)?(I.attribName=X,I.attribValue="",I.state=S.ATTRIB_NAME):q(I,"Invalid attribute name");continue;case S.ATTRIB_NAME:X==="="?I.state=S.ATTRIB_VALUE:X===">"?(q(I,"Attribute without value"),I.attribValue=I.attribName,ne(I),K(I)):w(X)?I.state=S.ATTRIB_NAME_SAW_WHITE:T(u,X)?I.attribName+=X:q(I,"Invalid attribute name");continue;case S.ATTRIB_NAME_SAW_WHITE:if(X==="=")I.state=S.ATTRIB_VALUE;else{if(w(X))continue;q(I,"Attribute without value"),I.tag.attributes[I.attribName]="",I.attribValue="",F(I,"onattribute",{name:I.attribName,value:""}),I.attribName="",X===">"?K(I):T(N,X)?(I.attribName=X,I.state=S.ATTRIB_NAME):(q(I,"Invalid attribute name"),I.state=S.ATTRIB)}continue;case S.ATTRIB_VALUE:if(w(X))continue;k(X)?(I.q=X,I.state=S.ATTRIB_VALUE_QUOTED):(q(I,"Unquoted attribute value"),I.state=S.ATTRIB_VALUE_UNQUOTED,I.attribValue=X);continue;case S.ATTRIB_VALUE_QUOTED:if(X!==I.q){X==="&"?I.state=S.ATTRIB_VALUE_ENTITY_Q:I.attribValue+=X;continue}ne(I),I.q="",I.state=S.ATTRIB_VALUE_CLOSED;continue;case S.ATTRIB_VALUE_CLOSED:w(X)?I.state=S.ATTRIB:X===">"?K(I):X==="/"?I.state=S.OPEN_TAG_SLASH:T(N,X)?(q(I,"No whitespace between attributes"),I.attribName=X,I.attribValue="",I.state=S.ATTRIB_NAME):q(I,"Invalid attribute name");continue;case S.ATTRIB_VALUE_UNQUOTED:if(!A(X)){X==="&"?I.state=S.ATTRIB_VALUE_ENTITY_U:I.attribValue+=X;continue}ne(I),X===">"?K(I):I.state=S.ATTRIB;continue;case S.CLOSE_TAG:if(I.tagName)X===">"?P(I):T(u,X)?I.tagName+=X:I.script?(I.script+="</"+I.tagName,I.tagName="",I.state=S.SCRIPT):(w(X)||q(I,"Invalid tagname in closing tag"),I.state=S.CLOSE_TAG_SAW_WHITE);else{if(w(X))continue;z(N,X)?I.script?(I.script+="</"+X,I.state=S.SCRIPT):q(I,"Invalid tagname in closing tag."):I.tagName=X}continue;case S.CLOSE_TAG_SAW_WHITE:if(w(X))continue;X===">"?P(I):q(I,"Invalid characters in closing tag");continue;case S.TEXT_ENTITY:case S.ATTRIB_VALUE_ENTITY_Q:case S.ATTRIB_VALUE_ENTITY_U:var oe,O;switch(I.state){case S.TEXT_ENTITY:oe=S.TEXT,O="textNode";break;case S.ATTRIB_VALUE_ENTITY_Q:oe=S.ATTRIB_VALUE_QUOTED,O="attribValue";break;case S.ATTRIB_VALUE_ENTITY_U:oe=S.ATTRIB_VALUE_UNQUOTED,O="attribValue";break}X===";"?(I[O]+=Y(I),I.entity="",I.state=oe):T(I.entity.length?g:v,X)?I.entity+=X:(q(I,"Invalid character in entity name"),I[O]+="&"+I.entity+X,I.entity="",I.state=oe);continue;default:throw new Error(I,"Unknown state: "+I.state)}return I.position>=I.bufferCheckPosition&&i(I),I}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */String.fromCodePoint||(function(){var R=String.fromCharCode,I=Math.floor,Q=function(){var X=16384,V=[],M,oe,O=-1,ce=arguments.length;if(!ce)return"";for(var L="";++O<ce;){var f=Number(arguments[O]);if(!isFinite(f)||f<0||f>1114111||I(f)!==f)throw RangeError("Invalid code point: "+f);f<=65535?V.push(f):(f-=65536,M=(f>>10)+55296,oe=f%1024+56320,V.push(M,oe)),(O+1===ce||V.length>X)&&(L+=R.apply(null,V),V.length=0)}return L};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:Q,configurable:!0,writable:!0}):String.fromCodePoint=Q})()})(r)})(eo)),eo}var xl,Bh;function md(){return Bh||(Bh=1,xl={isArray:function(r){return Array.isArray?Array.isArray(r):Object.prototype.toString.call(r)==="[object Array]"}}),xl}var yl,zh;function pd(){if(zh)return yl;zh=1;var r=md().isArray;return yl={copyOptions:function(t){var s,n={};for(s in t)t.hasOwnProperty(s)&&(n[s]=t[s]);return n},ensureFlagExists:function(t,s){(!(t in s)||typeof s[t]!="boolean")&&(s[t]=!1)},ensureSpacesExists:function(t){(!("spaces"in t)||typeof t.spaces!="number"&&typeof t.spaces!="string")&&(t.spaces=0)},ensureAlwaysArrayExists:function(t){(!("alwaysArray"in t)||typeof t.alwaysArray!="boolean"&&!r(t.alwaysArray))&&(t.alwaysArray=!1)},ensureKeyExists:function(t,s){(!(t+"Key"in s)||typeof s[t+"Key"]!="string")&&(s[t+"Key"]=s.compact?"_"+t:t)},checkFnExists:function(t,s){return t+"Fn"in s}},yl}var bl,Uh;function Yf(){if(Uh)return bl;Uh=1;var r=bv(),t=pd(),s=md().isArray,n,i;function o(u){return n=t.copyOptions(u),t.ensureFlagExists("ignoreDeclaration",n),t.ensureFlagExists("ignoreInstruction",n),t.ensureFlagExists("ignoreAttributes",n),t.ensureFlagExists("ignoreText",n),t.ensureFlagExists("ignoreComment",n),t.ensureFlagExists("ignoreCdata",n),t.ensureFlagExists("ignoreDoctype",n),t.ensureFlagExists("compact",n),t.ensureFlagExists("alwaysChildren",n),t.ensureFlagExists("addParent",n),t.ensureFlagExists("trim",n),t.ensureFlagExists("nativeType",n),t.ensureFlagExists("nativeTypeAttributes",n),t.ensureFlagExists("sanitize",n),t.ensureFlagExists("instructionHasAttributes",n),t.ensureFlagExists("captureSpacesBetweenElements",n),t.ensureAlwaysArrayExists(n),t.ensureKeyExists("declaration",n),t.ensureKeyExists("instruction",n),t.ensureKeyExists("attributes",n),t.ensureKeyExists("text",n),t.ensureKeyExists("comment",n),t.ensureKeyExists("cdata",n),t.ensureKeyExists("doctype",n),t.ensureKeyExists("type",n),t.ensureKeyExists("name",n),t.ensureKeyExists("elements",n),t.ensureKeyExists("parent",n),t.checkFnExists("doctype",n),t.checkFnExists("instruction",n),t.checkFnExists("cdata",n),t.checkFnExists("comment",n),t.checkFnExists("text",n),t.checkFnExists("instructionName",n),t.checkFnExists("elementName",n),t.checkFnExists("attributeName",n),t.checkFnExists("attributeValue",n),t.checkFnExists("attributes",n),n}function l(u){var v=Number(u);if(!isNaN(v))return v;var g=u.toLowerCase();return g==="true"?!0:g==="false"?!1:u}function a(u,v){var g;if(n.compact){if(!i[n[u+"Key"]]&&(s(n.alwaysArray)?n.alwaysArray.indexOf(n[u+"Key"])!==-1:n.alwaysArray)&&(i[n[u+"Key"]]=[]),i[n[u+"Key"]]&&!s(i[n[u+"Key"]])&&(i[n[u+"Key"]]=[i[n[u+"Key"]]]),u+"Fn"in n&&typeof v=="string"&&(v=n[u+"Fn"](v,i)),u==="instruction"&&("instructionFn"in n||"instructionNameFn"in n)){for(g in v)if(v.hasOwnProperty(g))if("instructionFn"in n)v[g]=n.instructionFn(v[g],g,i);else{var w=v[g];delete v[g],v[n.instructionNameFn(g,w,i)]=w}}s(i[n[u+"Key"]])?i[n[u+"Key"]].push(v):i[n[u+"Key"]]=v}else{i[n.elementsKey]||(i[n.elementsKey]=[]);var k={};if(k[n.typeKey]=u,u==="instruction"){for(g in v)if(v.hasOwnProperty(g))break;k[n.nameKey]="instructionNameFn"in n?n.instructionNameFn(g,v,i):g,n.instructionHasAttributes?(k[n.attributesKey]=v[g][n.attributesKey],"instructionFn"in n&&(k[n.attributesKey]=n.instructionFn(k[n.attributesKey],g,i))):("instructionFn"in n&&(v[g]=n.instructionFn(v[g],g,i)),k[n.instructionKey]=v[g])}else u+"Fn"in n&&(v=n[u+"Fn"](v,i)),k[n[u+"Key"]]=v;n.addParent&&(k[n.parentKey]=i),i[n.elementsKey].push(k)}}function c(u){if("attributesFn"in n&&u&&(u=n.attributesFn(u,i)),(n.trim||"attributeValueFn"in n||"attributeNameFn"in n||n.nativeTypeAttributes)&&u){var v;for(v in u)if(u.hasOwnProperty(v)&&(n.trim&&(u[v]=u[v].trim()),n.nativeTypeAttributes&&(u[v]=l(u[v])),"attributeValueFn"in n&&(u[v]=n.attributeValueFn(u[v],v,i)),"attributeNameFn"in n)){var g=u[v];delete u[v],u[n.attributeNameFn(v,u[v],i)]=g}}return u}function p(u){var v={};if(u.body&&(u.name.toLowerCase()==="xml"||n.instructionHasAttributes)){for(var g=/([\w:-]+)\s*=\s*(?:"([^"]*)"|'([^']*)'|(\w+))\s*/g,w;(w=g.exec(u.body))!==null;)v[w[1]]=w[2]||w[3]||w[4];v=c(v)}if(u.name.toLowerCase()==="xml"){if(n.ignoreDeclaration)return;i[n.declarationKey]={},Object.keys(v).length&&(i[n.declarationKey][n.attributesKey]=v),n.addParent&&(i[n.declarationKey][n.parentKey]=i)}else{if(n.ignoreInstruction)return;n.trim&&(u.body=u.body.trim());var k={};n.instructionHasAttributes&&Object.keys(v).length?(k[u.name]={},k[u.name][n.attributesKey]=v):k[u.name]=u.body,a("instruction",k)}}function d(u,v){var g;if(typeof u=="object"&&(v=u.attributes,u=u.name),v=c(v),"elementNameFn"in n&&(u=n.elementNameFn(u,i)),n.compact){if(g={},!n.ignoreAttributes&&v&&Object.keys(v).length){g[n.attributesKey]={};var w;for(w in v)v.hasOwnProperty(w)&&(g[n.attributesKey][w]=v[w])}!(u in i)&&(s(n.alwaysArray)?n.alwaysArray.indexOf(u)!==-1:n.alwaysArray)&&(i[u]=[]),i[u]&&!s(i[u])&&(i[u]=[i[u]]),s(i[u])?i[u].push(g):i[u]=g}else i[n.elementsKey]||(i[n.elementsKey]=[]),g={},g[n.typeKey]="element",g[n.nameKey]=u,!n.ignoreAttributes&&v&&Object.keys(v).length&&(g[n.attributesKey]=v),n.alwaysChildren&&(g[n.elementsKey]=[]),i[n.elementsKey].push(g);g[n.parentKey]=i,i=g}function m(u){n.ignoreText||!u.trim()&&!n.captureSpacesBetweenElements||(n.trim&&(u=u.trim()),n.nativeType&&(u=l(u)),n.sanitize&&(u=u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),a("text",u))}function y(u){n.ignoreComment||(n.trim&&(u=u.trim()),a("comment",u))}function h(u){var v=i[n.parentKey];n.addParent||delete i[n.parentKey],i=v}function _(u){n.ignoreCdata||(n.trim&&(u=u.trim()),a("cdata",u))}function b(u){n.ignoreDoctype||(u=u.replace(/^ /,""),n.trim&&(u=u.trim()),a("doctype",u))}function N(u){u.note=u}return bl=function(u,v){var g=r.parser(!0,{}),w={};if(i=w,n=o(v),g.opt={strictEntities:!0},g.onopentag=d,g.ontext=m,g.oncomment=y,g.onclosetag=h,g.onerror=N,g.oncdata=_,g.ondoctype=b,g.onprocessinginstruction=p,g.write(u).close(),w[n.elementsKey]){var k=w[n.elementsKey];delete w[n.elementsKey],w[n.elementsKey]=k,delete w.text}return w},bl}var vl,qh;function vv(){if(qh)return vl;qh=1;var r=pd(),t=Yf();function s(n){var i=r.copyOptions(n);return r.ensureSpacesExists(i),i}return vl=function(n,i){var o,l,a,c;return o=s(i),l=t(n,o),c="compact"in o&&o.compact?"_parent":"parent","addParent"in o&&o.addParent?a=JSON.stringify(l,function(p,d){return p===c?"_":d},o.spaces):a=JSON.stringify(l,null,o.spaces),a.replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},vl}var wl,Wh;function Jf(){if(Wh)return wl;Wh=1;var r=pd(),t=md().isArray,s,n;function i(g){var w=r.copyOptions(g);return r.ensureFlagExists("ignoreDeclaration",w),r.ensureFlagExists("ignoreInstruction",w),r.ensureFlagExists("ignoreAttributes",w),r.ensureFlagExists("ignoreText",w),r.ensureFlagExists("ignoreComment",w),r.ensureFlagExists("ignoreCdata",w),r.ensureFlagExists("ignoreDoctype",w),r.ensureFlagExists("compact",w),r.ensureFlagExists("indentText",w),r.ensureFlagExists("indentCdata",w),r.ensureFlagExists("indentAttributes",w),r.ensureFlagExists("indentInstruction",w),r.ensureFlagExists("fullTagEmptyElement",w),r.ensureFlagExists("noQuotesForNativeAttributes",w),r.ensureSpacesExists(w),typeof w.spaces=="number"&&(w.spaces=Array(w.spaces+1).join(" ")),r.ensureKeyExists("declaration",w),r.ensureKeyExists("instruction",w),r.ensureKeyExists("attributes",w),r.ensureKeyExists("text",w),r.ensureKeyExists("comment",w),r.ensureKeyExists("cdata",w),r.ensureKeyExists("doctype",w),r.ensureKeyExists("type",w),r.ensureKeyExists("name",w),r.ensureKeyExists("elements",w),r.checkFnExists("doctype",w),r.checkFnExists("instruction",w),r.checkFnExists("cdata",w),r.checkFnExists("comment",w),r.checkFnExists("text",w),r.checkFnExists("instructionName",w),r.checkFnExists("elementName",w),r.checkFnExists("attributeName",w),r.checkFnExists("attributeValue",w),r.checkFnExists("attributes",w),r.checkFnExists("fullTagEmptyElement",w),w}function o(g,w,k){return(!k&&g.spaces?`
`:"")+Array(w+1).join(g.spaces)}function l(g,w,k){if(w.ignoreAttributes)return"";"attributesFn"in w&&(g=w.attributesFn(g,n,s));var A,T,z,S,U=[];for(A in g)g.hasOwnProperty(A)&&g[A]!==null&&g[A]!==void 0&&(S=w.noQuotesForNativeAttributes&&typeof g[A]!="string"?"":'"',T=""+g[A],T=T.replace(/"/g,"&quot;"),z="attributeNameFn"in w?w.attributeNameFn(A,T,n,s):A,U.push(w.spaces&&w.indentAttributes?o(w,k+1,!1):" "),U.push(z+"="+S+("attributeValueFn"in w?w.attributeValueFn(T,A,n,s):T)+S));return g&&Object.keys(g).length&&w.spaces&&w.indentAttributes&&U.push(o(w,k,!1)),U.join("")}function a(g,w,k){return s=g,n="xml",w.ignoreDeclaration?"":"<?xml"+l(g[w.attributesKey],w,k)+"?>"}function c(g,w,k){if(w.ignoreInstruction)return"";var A;for(A in g)if(g.hasOwnProperty(A))break;var T="instructionNameFn"in w?w.instructionNameFn(A,g[A],n,s):A;if(typeof g[A]=="object")return s=g,n=T,"<?"+T+l(g[A][w.attributesKey],w,k)+"?>";var z=g[A]?g[A]:"";return"instructionFn"in w&&(z=w.instructionFn(z,A,n,s)),"<?"+T+(z?" "+z:"")+"?>"}function p(g,w){return w.ignoreComment?"":"<!--"+("commentFn"in w?w.commentFn(g,n,s):g)+"-->"}function d(g,w){return w.ignoreCdata?"":"<![CDATA["+("cdataFn"in w?w.cdataFn(g,n,s):g.replace("]]>","]]]]><![CDATA[>"))+"]]>"}function m(g,w){return w.ignoreDoctype?"":"<!DOCTYPE "+("doctypeFn"in w?w.doctypeFn(g,n,s):g)+">"}function y(g,w){return w.ignoreText?"":(g=""+g,g=g.replace(/&amp;/g,"&"),g=g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"textFn"in w?w.textFn(g,n,s):g)}function h(g,w){var k;if(g.elements&&g.elements.length)for(k=0;k<g.elements.length;++k)switch(g.elements[k][w.typeKey]){case"text":if(w.indentText)return!0;break;case"cdata":if(w.indentCdata)return!0;break;case"instruction":if(w.indentInstruction)return!0;break;case"doctype":case"comment":case"element":return!0;default:return!0}return!1}function _(g,w,k){s=g,n=g.name;var A=[],T="elementNameFn"in w?w.elementNameFn(g.name,g):g.name;A.push("<"+T),g[w.attributesKey]&&A.push(l(g[w.attributesKey],w,k));var z=g[w.elementsKey]&&g[w.elementsKey].length||g[w.attributesKey]&&g[w.attributesKey]["xml:space"]==="preserve";return z||("fullTagEmptyElementFn"in w?z=w.fullTagEmptyElementFn(g.name,g):z=w.fullTagEmptyElement),z?(A.push(">"),g[w.elementsKey]&&g[w.elementsKey].length&&(A.push(b(g[w.elementsKey],w,k+1)),s=g,n=g.name),A.push(w.spaces&&h(g,w)?`
`+Array(k+1).join(w.spaces):""),A.push("</"+T+">")):A.push("/>"),A.join("")}function b(g,w,k,A){return g.reduce(function(T,z){var S=o(w,k,A&&!T);switch(z.type){case"element":return T+S+_(z,w,k);case"comment":return T+S+p(z[w.commentKey],w);case"doctype":return T+S+m(z[w.doctypeKey],w);case"cdata":return T+(w.indentCdata?S:"")+d(z[w.cdataKey],w);case"text":return T+(w.indentText?S:"")+y(z[w.textKey],w);case"instruction":var U={};return U[z[w.nameKey]]=z[w.attributesKey]?z:z[w.instructionKey],T+(w.indentInstruction?S:"")+c(U,w,k)}},"")}function N(g,w,k){var A;for(A in g)if(g.hasOwnProperty(A))switch(A){case w.parentKey:case w.attributesKey:break;case w.textKey:if(w.indentText||k)return!0;break;case w.cdataKey:if(w.indentCdata||k)return!0;break;case w.instructionKey:if(w.indentInstruction||k)return!0;break;case w.doctypeKey:case w.commentKey:return!0;default:return!0}return!1}function u(g,w,k,A,T){s=g,n=w;var z="elementNameFn"in k?k.elementNameFn(w,g):w;if(typeof g>"u"||g===null||g==="")return"fullTagEmptyElementFn"in k&&k.fullTagEmptyElementFn(w,g)||k.fullTagEmptyElement?"<"+z+"></"+z+">":"<"+z+"/>";var S=[];if(w){if(S.push("<"+z),typeof g!="object")return S.push(">"+y(g,k)+"</"+z+">"),S.join("");g[k.attributesKey]&&S.push(l(g[k.attributesKey],k,A));var U=N(g,k,!0)||g[k.attributesKey]&&g[k.attributesKey]["xml:space"]==="preserve";if(U||("fullTagEmptyElementFn"in k?U=k.fullTagEmptyElementFn(w,g):U=k.fullTagEmptyElement),U)S.push(">");else return S.push("/>"),S.join("")}return S.push(v(g,k,A+1,!1)),s=g,n=w,w&&S.push((T?o(k,A,!1):"")+"</"+z+">"),S.join("")}function v(g,w,k,A){var T,z,S,U=[];for(z in g)if(g.hasOwnProperty(z))for(S=t(g[z])?g[z]:[g[z]],T=0;T<S.length;++T){switch(z){case w.declarationKey:U.push(a(S[T],w,k));break;case w.instructionKey:U.push((w.indentInstruction?o(w,k,A):"")+c(S[T],w,k));break;case w.attributesKey:case w.parentKey:break;case w.textKey:U.push((w.indentText?o(w,k,A):"")+y(S[T],w));break;case w.cdataKey:U.push((w.indentCdata?o(w,k,A):"")+d(S[T],w));break;case w.doctypeKey:U.push(o(w,k,A)+m(S[T],w));break;case w.commentKey:U.push(o(w,k,A)+p(S[T],w));break;default:U.push(o(w,k,A)+u(S[T],z,w,k,N(S[T],w)))}A=A&&!U.length}return U.join("")}return wl=function(g,w){w=i(w);var k=[];return s=g,n="_root_",w.compact?k.push(v(g,w,0,!0)):(g[w.declarationKey]&&k.push(a(g[w.declarationKey],w,0)),g[w.elementsKey]&&g[w.elementsKey].length&&k.push(b(g[w.elementsKey],w,0,!k.length))),k.join("")},wl}var jl,Hh;function wv(){if(Hh)return jl;Hh=1;var r=Jf();return jl=function(t,s){t instanceof Buffer&&(t=t.toString());var n=null;if(typeof t=="string")try{n=JSON.parse(t)}catch{throw new Error("The JSON structure is invalid")}else n=t;return r(n,s)},jl}var _l,Gh;function jv(){if(Gh)return _l;Gh=1;var r=Yf(),t=vv(),s=Jf(),n=wv();return _l={xml2js:r,xml2json:t,js2xml:s,json2xml:n},_l}var Qf=jv();const fd=r=>{switch(r.type){case void 0:case"element":const t=new kv(r.name,r.attributes),s=r.elements||[];for(const n of s){const i=fd(n);i!==void 0&&t.push(i)}return t;case"text":return r.text;default:return}};class _v extends Ue{}class kv extends _e{static fromXmlString(t){const s=Qf.xml2js(t,{compact:!1});return fd(s)}constructor(t,s){super(t),s&&this.root.push(new _v(s))}push(t){this.root.push(t)}}class Nv extends _e{constructor(t){super(""),this._attr=t}prepForXml(t){return{_attr:this._attr}}}class Zf extends _e{constructor(t,s){super(t),s&&(this.root=s.root)}}const er=r=>{if(isNaN(r))throw new Error(`Invalid value '${r}' specified. Must be an integer.`);return Math.floor(r)},Ia=r=>{const t=er(r);if(t<0)throw new Error(`Invalid value '${r}' specified. Must be a positive integer.`);return t},eg=(r,t)=>{const s=t*2;if(r.length!==s||isNaN(+`0x${r}`))throw new Error(`Invalid hex value '${r}'. Expected ${s} digit hex value`);return r},Vh=r=>eg(r,1),gd=r=>{const t=r.slice(-2),s=r.substring(0,r.length-2);return`${Number(s)}${t}`},tg=r=>{const t=gd(r);if(parseFloat(t)<0)throw new Error(`Invalid value '${t}' specified. Expected a positive number.`);return t},hn=r=>{if(r==="auto")return r;const t=r.charAt(0)==="#"?r.substring(1):r;return eg(t,3)},as=r=>typeof r=="string"?gd(r):er(r),Sv=r=>typeof r=="string"?tg(r):Ia(r),Yt=r=>typeof r=="string"?tg(r):Ia(r),Cv=r=>{const t=r.substring(0,r.length-1);return`${Number(t)}%`},rg=r=>typeof r=="number"?er(r):r.slice(-1)==="%"?Cv(r):gd(r),Ev=Ia,Av=Ia,Tv=r=>r.toISOString();class Ne extends _e{constructor(t,s=!0){super(t),s!==!0&&this.root.push(new vt({val:s}))}}class kl extends _e{constructor(t,s){super(t),this.root.push(new vt({val:Sv(s)}))}}class Ps extends _e{constructor(t,s){super(t),this.root.push(new vt({val:s}))}}const kn=(r,t)=>new Vr({name:r,attributes:{value:{key:"w:val",value:t}}});class qn extends _e{constructor(t,s){super(t),this.root.push(new vt({val:s}))}}class Iv extends _e{constructor(t,s){super(t),this.root.push(new vt({val:s}))}}class Ns extends _e{constructor(t,s){super(t),this.root.push(s)}}class Vr extends _e{constructor({name:t,attributes:s,children:n}){super(t),s&&this.root.push(new ws(s)),n&&this.root.push(...n)}}const or={START:"start",CENTER:"center",LEFT:"left"};class Rv extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{val:"w:val"})}}class sg extends _e{constructor(t){super("w:jc"),this.root.push(new Rv({val:t}))}}class lt extends _e{constructor(t,{color:s,size:n,space:i,style:o}){super(t),this.root.push(new Ov({style:o,color:s===void 0?void 0:hn(s),size:n===void 0?void 0:Ev(n),space:i===void 0?void 0:Av(i)}))}}class Ov extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{style:"w:val",color:"w:color",size:"w:sz",space:"w:space"})}}const xd={SINGLE:"single",NONE:"none"};class Fv extends ls{constructor(t){super("w:pBdr"),t.top&&this.root.push(new lt("w:top",t.top)),t.bottom&&this.root.push(new lt("w:bottom",t.bottom)),t.left&&this.root.push(new lt("w:left",t.left)),t.right&&this.root.push(new lt("w:right",t.right))}}class Pv extends _e{constructor(){super("w:pBdr");const t=new lt("w:bottom",{color:"auto",space:1,style:xd.SINGLE,size:6});this.root.push(t)}}class Lv extends _e{constructor({start:t,end:s,left:n,right:i,hanging:o,firstLine:l}){super("w:ind"),this.root.push(new ws({start:{key:"w:start",value:t===void 0?void 0:as(t)},end:{key:"w:end",value:s===void 0?void 0:as(s)},left:{key:"w:left",value:n===void 0?void 0:as(n)},right:{key:"w:right",value:i===void 0?void 0:as(i)},hanging:{key:"w:hanging",value:o===void 0?void 0:Yt(o)},firstLine:{key:"w:firstLine",value:l===void 0?void 0:Yt(l)}}))}}let Dv=class extends _e{constructor(){super("w:br")}};const yd={BEGIN:"begin",END:"end",SEPARATE:"separate"};class bd extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{type:"w:fldCharType",dirty:"w:dirty"})}}class _i extends _e{constructor(t){super("w:fldChar"),this.root.push(new bd({type:yd.BEGIN,dirty:t}))}}class ki extends _e{constructor(t){super("w:fldChar"),this.root.push(new bd({type:yd.SEPARATE,dirty:t}))}}class Ni extends _e{constructor(t){super("w:fldChar"),this.root.push(new bd({type:yd.END,dirty:t}))}}const mn={DEFAULT:"default",PRESERVE:"preserve"};class pn extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{space:"xml:space"})}}class Mv extends _e{constructor(){super("w:instrText"),this.root.push(new pn({space:mn.PRESERVE})),this.root.push("PAGE")}}class $v extends _e{constructor(){super("w:instrText"),this.root.push(new pn({space:mn.PRESERVE})),this.root.push("NUMPAGES")}}class Bv extends _e{constructor(){super("w:instrText"),this.root.push(new pn({space:mn.PRESERVE})),this.root.push("SECTIONPAGES")}}class zv extends _e{constructor(){super("w:instrText"),this.root.push(new pn({space:mn.PRESERVE})),this.root.push("SECTION")}}class Uv extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{fill:"w:fill",color:"w:color",type:"w:val"})}}class Ra extends _e{constructor({fill:t,color:s,type:n}){super("w:shd"),this.root.push(new Uv({fill:t===void 0?void 0:hn(t),color:s===void 0?void 0:hn(s),type:n}))}}class qv extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{id:"w:id",author:"w:author",date:"w:date"})}}const Wv={DOT:"dot"};class Hv extends _e{constructor(t){super("w:em"),this.root.push(new vt({val:t}))}}class Gv extends Hv{constructor(t=Wv.DOT){super(t)}}class Vv extends _e{constructor(t){super("w:spacing"),this.root.push(new vt({val:as(t)}))}}class Kv extends _e{constructor(t){super("w:color"),this.root.push(new vt({val:hn(t)}))}}class Xv extends _e{constructor(t){super("w:highlight"),this.root.push(new vt({val:t}))}}class Yv extends _e{constructor(t){super("w:highlightCs"),this.root.push(new vt({val:t}))}}const Jv=r=>new Vr({name:"w:lang",attributes:{value:{key:"w:val",value:r.value},eastAsia:{key:"w:eastAsia",value:r.eastAsia},bidirectional:{key:"w:bidi",value:r.bidirectional}}});class Kh extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{ascii:"w:ascii",cs:"w:cs",eastAsia:"w:eastAsia",hAnsi:"w:hAnsi",hint:"w:hint"})}}class Nl extends _e{constructor(t,s){if(super("w:rFonts"),typeof t=="string"){const n=t;this.root.push(new Kh({ascii:n,cs:n,eastAsia:n,hAnsi:n,hint:s}))}else{const n=t;this.root.push(new Kh(n))}}}let ng=class extends _e{constructor(t){super("w:vertAlign"),this.root.push(new vt({val:t}))}};class Qv extends ng{constructor(){super("superscript")}}class Zv extends ng{constructor(){super("subscript")}}const ig={SINGLE:"single"};class ew extends _e{constructor(t=ig.SINGLE,s){super("w:u"),this.root.push(new vt({val:t,color:s===void 0?void 0:hn(s)}))}}class Bs extends ls{constructor(t){var s,n;if(super("w:rPr"),!t)return;t.style&&this.push(new Ps("w:rStyle",t.style)),t.font&&(typeof t.font=="string"?this.push(new Nl(t.font)):"name"in t.font?this.push(new Nl(t.font.name,t.font.hint)):this.push(new Nl(t.font))),t.bold!==void 0&&this.push(new Ne("w:b",t.bold)),(t.boldComplexScript===void 0&&t.bold!==void 0||t.boldComplexScript)&&this.push(new Ne("w:bCs",(s=t.boldComplexScript)!=null?s:t.bold)),t.italics!==void 0&&this.push(new Ne("w:i",t.italics)),(t.italicsComplexScript===void 0&&t.italics!==void 0||t.italicsComplexScript)&&this.push(new Ne("w:iCs",(n=t.italicsComplexScript)!=null?n:t.italics)),t.smallCaps!==void 0?this.push(new Ne("w:smallCaps",t.smallCaps)):t.allCaps!==void 0&&this.push(new Ne("w:caps",t.allCaps)),t.strike!==void 0&&this.push(new Ne("w:strike",t.strike)),t.doubleStrike!==void 0&&this.push(new Ne("w:dstrike",t.doubleStrike)),t.emboss!==void 0&&this.push(new Ne("w:emboss",t.emboss)),t.imprint!==void 0&&this.push(new Ne("w:imprint",t.imprint)),t.noProof!==void 0&&this.push(new Ne("w:noProof",t.noProof)),t.snapToGrid!==void 0&&this.push(new Ne("w:snapToGrid",t.snapToGrid)),t.vanish&&this.push(new Ne("w:vanish",t.vanish)),t.color&&this.push(new Kv(t.color)),t.characterSpacing&&this.push(new Vv(t.characterSpacing)),t.scale!==void 0&&this.push(new qn("w:w",t.scale)),t.kern&&this.push(new kl("w:kern",t.kern)),t.position&&this.push(new Ps("w:position",t.position)),t.size!==void 0&&this.push(new kl("w:sz",t.size));const i=t.sizeComplexScript===void 0||t.sizeComplexScript===!0?t.size:t.sizeComplexScript;i&&this.push(new kl("w:szCs",i)),t.highlight&&this.push(new Xv(t.highlight));const o=t.highlightComplexScript===void 0||t.highlightComplexScript===!0?t.highlight:t.highlightComplexScript;o&&this.push(new Yv(o)),t.underline&&this.push(new ew(t.underline.type,t.underline.color)),t.effect&&this.push(new Ps("w:effect",t.effect)),t.border&&this.push(new lt("w:bdr",t.border)),t.shading&&this.push(new Ra(t.shading)),t.subScript&&this.push(new Zv),t.superScript&&this.push(new Qv),t.rightToLeft!==void 0&&this.push(new Ne("w:rtl",t.rightToLeft)),t.emphasisMark&&this.push(new Gv(t.emphasisMark.type)),t.language&&this.push(Jv(t.language)),t.specVanish&&this.push(new Ne("w:specVanish",t.vanish)),t.math&&this.push(new Ne("w:oMath",t.math)),t.revision&&this.push(new tw(t.revision))}push(t){this.root.push(t)}}class tw extends _e{constructor(t){super("w:rPrChange"),this.root.push(new qv({id:t.id,author:t.author,date:t.date})),this.addChildElement(new Bs(t))}}class Xh extends _e{constructor(t){var s;super("w:t"),typeof t=="string"?(this.root.push(new pn({space:mn.PRESERVE})),this.root.push(t)):(this.root.push(new pn({space:(s=t.space)!=null?s:mn.DEFAULT})),this.root.push(t.text))}}const Si={CURRENT:"CURRENT",TOTAL_PAGES:"TOTAL_PAGES",TOTAL_PAGES_IN_SECTION:"TOTAL_PAGES_IN_SECTION",CURRENT_SECTION:"SECTION"};class Oa extends _e{constructor(t){if(super("w:r"),ve(this,"properties"),this.properties=new Bs(t),this.root.push(this.properties),t.break)for(let s=0;s<t.break;s++)this.root.push(new Dv);if(t.children)for(const s of t.children){if(typeof s=="string"){switch(s){case Si.CURRENT:this.root.push(new _i),this.root.push(new Mv),this.root.push(new ki),this.root.push(new Ni);break;case Si.TOTAL_PAGES:this.root.push(new _i),this.root.push(new $v),this.root.push(new ki),this.root.push(new Ni);break;case Si.TOTAL_PAGES_IN_SECTION:this.root.push(new _i),this.root.push(new Bv),this.root.push(new ki),this.root.push(new Ni);break;case Si.CURRENT_SECTION:this.root.push(new _i),this.root.push(new zv),this.root.push(new ki),this.root.push(new Ni);break;default:this.root.push(new Xh(s));break}continue}this.root.push(s)}else t.text!==void 0&&this.root.push(new Xh(t.text))}}class Vt extends Oa{constructor(t){super(typeof t=="string"?{text:t}:t)}}var Sl={},ot={},Cl,Yh;function ii(){if(Yh)return Cl;Yh=1,Cl=r;function r(t,s){if(!t)throw new Error(s||"Assertion failed")}return r.equal=function(s,n,i){if(s!=n)throw new Error(i||"Assertion failed: "+s+" != "+n)},Cl}var Jh;function Xr(){if(Jh)return ot;Jh=1;var r=ii(),t=js();ot.inherits=t;function s(F,C){return(F.charCodeAt(C)&64512)!==55296||C<0||C+1>=F.length?!1:(F.charCodeAt(C+1)&64512)===56320}function n(F,C){if(Array.isArray(F))return F.slice();if(!F)return[];var j=[];if(typeof F=="string")if(C){if(C==="hex")for(F=F.replace(/[^a-z0-9]+/ig,""),F.length%2!==0&&(F="0"+F),J=0;J<F.length;J+=2)j.push(parseInt(F[J]+F[J+1],16))}else for(var D=0,J=0;J<F.length;J++){var q=F.charCodeAt(J);q<128?j[D++]=q:q<2048?(j[D++]=q>>6|192,j[D++]=q&63|128):s(F,J)?(q=65536+((q&1023)<<10)+(F.charCodeAt(++J)&1023),j[D++]=q>>18|240,j[D++]=q>>12&63|128,j[D++]=q>>6&63|128,j[D++]=q&63|128):(j[D++]=q>>12|224,j[D++]=q>>6&63|128,j[D++]=q&63|128)}else for(J=0;J<F.length;J++)j[J]=F[J]|0;return j}ot.toArray=n;function i(F){for(var C="",j=0;j<F.length;j++)C+=a(F[j].toString(16));return C}ot.toHex=i;function o(F){var C=F>>>24|F>>>8&65280|F<<8&16711680|(F&255)<<24;return C>>>0}ot.htonl=o;function l(F,C){for(var j="",D=0;D<F.length;D++){var J=F[D];C==="little"&&(J=o(J)),j+=c(J.toString(16))}return j}ot.toHex32=l;function a(F){return F.length===1?"0"+F:F}ot.zero2=a;function c(F){return F.length===7?"0"+F:F.length===6?"00"+F:F.length===5?"000"+F:F.length===4?"0000"+F:F.length===3?"00000"+F:F.length===2?"000000"+F:F.length===1?"0000000"+F:F}ot.zero8=c;function p(F,C,j,D){var J=j-C;r(J%4===0);for(var q=new Array(J/4),W=0,$=C;W<q.length;W++,$+=4){var ne;D==="big"?ne=F[$]<<24|F[$+1]<<16|F[$+2]<<8|F[$+3]:ne=F[$+3]<<24|F[$+2]<<16|F[$+1]<<8|F[$],q[W]=ne>>>0}return q}ot.join32=p;function d(F,C){for(var j=new Array(F.length*4),D=0,J=0;D<F.length;D++,J+=4){var q=F[D];C==="big"?(j[J]=q>>>24,j[J+1]=q>>>16&255,j[J+2]=q>>>8&255,j[J+3]=q&255):(j[J+3]=q>>>24,j[J+2]=q>>>16&255,j[J+1]=q>>>8&255,j[J]=q&255)}return j}ot.split32=d;function m(F,C){return F>>>C|F<<32-C}ot.rotr32=m;function y(F,C){return F<<C|F>>>32-C}ot.rotl32=y;function h(F,C){return F+C>>>0}ot.sum32=h;function _(F,C,j){return F+C+j>>>0}ot.sum32_3=_;function b(F,C,j,D){return F+C+j+D>>>0}ot.sum32_4=b;function N(F,C,j,D,J){return F+C+j+D+J>>>0}ot.sum32_5=N;function u(F,C,j,D){var J=F[C],q=F[C+1],W=D+q>>>0,$=(W<D?1:0)+j+J;F[C]=$>>>0,F[C+1]=W}ot.sum64=u;function v(F,C,j,D){var J=C+D>>>0,q=(J<C?1:0)+F+j;return q>>>0}ot.sum64_hi=v;function g(F,C,j,D){var J=C+D;return J>>>0}ot.sum64_lo=g;function w(F,C,j,D,J,q,W,$){var ne=0,K=C;K=K+D>>>0,ne+=K<C?1:0,K=K+q>>>0,ne+=K<q?1:0,K=K+$>>>0,ne+=K<$?1:0;var P=F+j+J+W+ne;return P>>>0}ot.sum64_4_hi=w;function k(F,C,j,D,J,q,W,$){var ne=C+D+q+$;return ne>>>0}ot.sum64_4_lo=k;function A(F,C,j,D,J,q,W,$,ne,K){var P=0,Y=C;Y=Y+D>>>0,P+=Y<C?1:0,Y=Y+q>>>0,P+=Y<q?1:0,Y=Y+$>>>0,P+=Y<$?1:0,Y=Y+K>>>0,P+=Y<K?1:0;var re=F+j+J+W+ne+P;return re>>>0}ot.sum64_5_hi=A;function T(F,C,j,D,J,q,W,$,ne,K){var P=C+D+q+$+K;return P>>>0}ot.sum64_5_lo=T;function z(F,C,j){var D=C<<32-j|F>>>j;return D>>>0}ot.rotr64_hi=z;function S(F,C,j){var D=F<<32-j|C>>>j;return D>>>0}ot.rotr64_lo=S;function U(F,C,j){return F>>>j}ot.shr64_hi=U;function G(F,C,j){var D=F<<32-j|C>>>j;return D>>>0}return ot.shr64_lo=G,ot}var El={},Qh;function ai(){if(Qh)return El;Qh=1;var r=Xr(),t=ii();function s(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}return El.BlockHash=s,s.prototype.update=function(i,o){if(i=r.toArray(i,o),this.pending?this.pending=this.pending.concat(i):this.pending=i,this.pendingTotal+=i.length,this.pending.length>=this._delta8){i=this.pending;var l=i.length%this._delta8;this.pending=i.slice(i.length-l,i.length),this.pending.length===0&&(this.pending=null),i=r.join32(i,0,i.length-l,this.endian);for(var a=0;a<i.length;a+=this._delta32)this._update(i,a,a+this._delta32)}return this},s.prototype.digest=function(i){return this.update(this._pad()),t(this.pending===null),this._digest(i)},s.prototype._pad=function(){var i=this.pendingTotal,o=this._delta8,l=o-(i+this.padLength)%o,a=new Array(l+this.padLength);a[0]=128;for(var c=1;c<l;c++)a[c]=0;if(i<<=3,this.endian==="big"){for(var p=8;p<this.padLength;p++)a[c++]=0;a[c++]=0,a[c++]=0,a[c++]=0,a[c++]=0,a[c++]=i>>>24&255,a[c++]=i>>>16&255,a[c++]=i>>>8&255,a[c++]=i&255}else for(a[c++]=i&255,a[c++]=i>>>8&255,a[c++]=i>>>16&255,a[c++]=i>>>24&255,a[c++]=0,a[c++]=0,a[c++]=0,a[c++]=0,p=8;p<this.padLength;p++)a[c++]=0;return a},El}var Ss={},Pr={},Zh;function ag(){if(Zh)return Pr;Zh=1;var r=Xr(),t=r.rotr32;function s(d,m,y,h){if(d===0)return n(m,y,h);if(d===1||d===3)return o(m,y,h);if(d===2)return i(m,y,h)}Pr.ft_1=s;function n(d,m,y){return d&m^~d&y}Pr.ch32=n;function i(d,m,y){return d&m^d&y^m&y}Pr.maj32=i;function o(d,m,y){return d^m^y}Pr.p32=o;function l(d){return t(d,2)^t(d,13)^t(d,22)}Pr.s0_256=l;function a(d){return t(d,6)^t(d,11)^t(d,25)}Pr.s1_256=a;function c(d){return t(d,7)^t(d,18)^d>>>3}Pr.g0_256=c;function p(d){return t(d,17)^t(d,19)^d>>>10}return Pr.g1_256=p,Pr}var Al,em;function rw(){if(em)return Al;em=1;var r=Xr(),t=ai(),s=ag(),n=r.rotl32,i=r.sum32,o=r.sum32_5,l=s.ft_1,a=t.BlockHash,c=[1518500249,1859775393,2400959708,3395469782];function p(){if(!(this instanceof p))return new p;a.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}return r.inherits(p,a),Al=p,p.blockSize=512,p.outSize=160,p.hmacStrength=80,p.padLength=64,p.prototype._update=function(m,y){for(var h=this.W,_=0;_<16;_++)h[_]=m[y+_];for(;_<h.length;_++)h[_]=n(h[_-3]^h[_-8]^h[_-14]^h[_-16],1);var b=this.h[0],N=this.h[1],u=this.h[2],v=this.h[3],g=this.h[4];for(_=0;_<h.length;_++){var w=~~(_/20),k=o(n(b,5),l(w,N,u,v),g,h[_],c[w]);g=v,v=u,u=n(N,30),N=b,b=k}this.h[0]=i(this.h[0],b),this.h[1]=i(this.h[1],N),this.h[2]=i(this.h[2],u),this.h[3]=i(this.h[3],v),this.h[4]=i(this.h[4],g)},p.prototype._digest=function(m){return m==="hex"?r.toHex32(this.h,"big"):r.split32(this.h,"big")},Al}var Tl,tm;function og(){if(tm)return Tl;tm=1;var r=Xr(),t=ai(),s=ag(),n=ii(),i=r.sum32,o=r.sum32_4,l=r.sum32_5,a=s.ch32,c=s.maj32,p=s.s0_256,d=s.s1_256,m=s.g0_256,y=s.g1_256,h=t.BlockHash,_=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function b(){if(!(this instanceof b))return new b;h.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=_,this.W=new Array(64)}return r.inherits(b,h),Tl=b,b.blockSize=512,b.outSize=256,b.hmacStrength=192,b.padLength=64,b.prototype._update=function(u,v){for(var g=this.W,w=0;w<16;w++)g[w]=u[v+w];for(;w<g.length;w++)g[w]=o(y(g[w-2]),g[w-7],m(g[w-15]),g[w-16]);var k=this.h[0],A=this.h[1],T=this.h[2],z=this.h[3],S=this.h[4],U=this.h[5],G=this.h[6],F=this.h[7];for(n(this.k.length===g.length),w=0;w<g.length;w++){var C=l(F,d(S),a(S,U,G),this.k[w],g[w]),j=i(p(k),c(k,A,T));F=G,G=U,U=S,S=i(z,C),z=T,T=A,A=k,k=i(C,j)}this.h[0]=i(this.h[0],k),this.h[1]=i(this.h[1],A),this.h[2]=i(this.h[2],T),this.h[3]=i(this.h[3],z),this.h[4]=i(this.h[4],S),this.h[5]=i(this.h[5],U),this.h[6]=i(this.h[6],G),this.h[7]=i(this.h[7],F)},b.prototype._digest=function(u){return u==="hex"?r.toHex32(this.h,"big"):r.split32(this.h,"big")},Tl}var Il,rm;function sw(){if(rm)return Il;rm=1;var r=Xr(),t=og();function s(){if(!(this instanceof s))return new s;t.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}return r.inherits(s,t),Il=s,s.blockSize=512,s.outSize=224,s.hmacStrength=192,s.padLength=64,s.prototype._digest=function(i){return i==="hex"?r.toHex32(this.h.slice(0,7),"big"):r.split32(this.h.slice(0,7),"big")},Il}var Rl,sm;function lg(){if(sm)return Rl;sm=1;var r=Xr(),t=ai(),s=ii(),n=r.rotr64_hi,i=r.rotr64_lo,o=r.shr64_hi,l=r.shr64_lo,a=r.sum64,c=r.sum64_hi,p=r.sum64_lo,d=r.sum64_4_hi,m=r.sum64_4_lo,y=r.sum64_5_hi,h=r.sum64_5_lo,_=t.BlockHash,b=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function N(){if(!(this instanceof N))return new N;_.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=b,this.W=new Array(160)}r.inherits(N,_),Rl=N,N.blockSize=1024,N.outSize=512,N.hmacStrength=192,N.padLength=128,N.prototype._prepareBlock=function(j,D){for(var J=this.W,q=0;q<32;q++)J[q]=j[D+q];for(;q<J.length;q+=2){var W=G(J[q-4],J[q-3]),$=F(J[q-4],J[q-3]),ne=J[q-14],K=J[q-13],P=S(J[q-30],J[q-29]),Y=U(J[q-30],J[q-29]),re=J[q-32],le=J[q-31];J[q]=d(W,$,ne,K,P,Y,re,le),J[q+1]=m(W,$,ne,K,P,Y,re,le)}},N.prototype._update=function(j,D){this._prepareBlock(j,D);var J=this.W,q=this.h[0],W=this.h[1],$=this.h[2],ne=this.h[3],K=this.h[4],P=this.h[5],Y=this.h[6],re=this.h[7],le=this.h[8],se=this.h[9],R=this.h[10],I=this.h[11],Q=this.h[12],X=this.h[13],V=this.h[14],M=this.h[15];s(this.k.length===J.length);for(var oe=0;oe<J.length;oe+=2){var O=V,ce=M,L=T(le,se),f=z(le,se),x=u(le,se,R,I,Q),E=v(le,se,R,I,Q,X),H=this.k[oe],ee=this.k[oe+1],Z=J[oe],ue=J[oe+1],pe=y(O,ce,L,f,x,E,H,ee,Z,ue),ie=h(O,ce,L,f,x,E,H,ee,Z,ue);O=k(q,W),ce=A(q,W),L=g(q,W,$,ne,K),f=w(q,W,$,ne,K,P);var ke=c(O,ce,L,f),Oe=p(O,ce,L,f);V=Q,M=X,Q=R,X=I,R=le,I=se,le=c(Y,re,pe,ie),se=p(re,re,pe,ie),Y=K,re=P,K=$,P=ne,$=q,ne=W,q=c(pe,ie,ke,Oe),W=p(pe,ie,ke,Oe)}a(this.h,0,q,W),a(this.h,2,$,ne),a(this.h,4,K,P),a(this.h,6,Y,re),a(this.h,8,le,se),a(this.h,10,R,I),a(this.h,12,Q,X),a(this.h,14,V,M)},N.prototype._digest=function(j){return j==="hex"?r.toHex32(this.h,"big"):r.split32(this.h,"big")};function u(C,j,D,J,q){var W=C&D^~C&q;return W<0&&(W+=4294967296),W}function v(C,j,D,J,q,W){var $=j&J^~j&W;return $<0&&($+=4294967296),$}function g(C,j,D,J,q){var W=C&D^C&q^D&q;return W<0&&(W+=4294967296),W}function w(C,j,D,J,q,W){var $=j&J^j&W^J&W;return $<0&&($+=4294967296),$}function k(C,j){var D=n(C,j,28),J=n(j,C,2),q=n(j,C,7),W=D^J^q;return W<0&&(W+=4294967296),W}function A(C,j){var D=i(C,j,28),J=i(j,C,2),q=i(j,C,7),W=D^J^q;return W<0&&(W+=4294967296),W}function T(C,j){var D=n(C,j,14),J=n(C,j,18),q=n(j,C,9),W=D^J^q;return W<0&&(W+=4294967296),W}function z(C,j){var D=i(C,j,14),J=i(C,j,18),q=i(j,C,9),W=D^J^q;return W<0&&(W+=4294967296),W}function S(C,j){var D=n(C,j,1),J=n(C,j,8),q=o(C,j,7),W=D^J^q;return W<0&&(W+=4294967296),W}function U(C,j){var D=i(C,j,1),J=i(C,j,8),q=l(C,j,7),W=D^J^q;return W<0&&(W+=4294967296),W}function G(C,j){var D=n(C,j,19),J=n(j,C,29),q=o(C,j,6),W=D^J^q;return W<0&&(W+=4294967296),W}function F(C,j){var D=i(C,j,19),J=i(j,C,29),q=l(C,j,6),W=D^J^q;return W<0&&(W+=4294967296),W}return Rl}var Ol,nm;function nw(){if(nm)return Ol;nm=1;var r=Xr(),t=lg();function s(){if(!(this instanceof s))return new s;t.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}return r.inherits(s,t),Ol=s,s.blockSize=1024,s.outSize=384,s.hmacStrength=192,s.padLength=128,s.prototype._digest=function(i){return i==="hex"?r.toHex32(this.h.slice(0,12),"big"):r.split32(this.h.slice(0,12),"big")},Ol}var im;function iw(){return im||(im=1,Ss.sha1=rw(),Ss.sha224=sw(),Ss.sha256=og(),Ss.sha384=nw(),Ss.sha512=lg()),Ss}var Fl={},am;function aw(){if(am)return Fl;am=1;var r=Xr(),t=ai(),s=r.rotl32,n=r.sum32,i=r.sum32_3,o=r.sum32_4,l=t.BlockHash;function a(){if(!(this instanceof a))return new a;l.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}r.inherits(a,l),Fl.ripemd160=a,a.blockSize=512,a.outSize=160,a.hmacStrength=192,a.padLength=64,a.prototype._update=function(N,u){for(var v=this.h[0],g=this.h[1],w=this.h[2],k=this.h[3],A=this.h[4],T=v,z=g,S=w,U=k,G=A,F=0;F<80;F++){var C=n(s(o(v,c(F,g,w,k),N[m[F]+u],p(F)),h[F]),A);v=A,A=k,k=s(w,10),w=g,g=C,C=n(s(o(T,c(79-F,z,S,U),N[y[F]+u],d(F)),_[F]),G),T=G,G=U,U=s(S,10),S=z,z=C}C=i(this.h[1],w,U),this.h[1]=i(this.h[2],k,G),this.h[2]=i(this.h[3],A,T),this.h[3]=i(this.h[4],v,z),this.h[4]=i(this.h[0],g,S),this.h[0]=C},a.prototype._digest=function(N){return N==="hex"?r.toHex32(this.h,"little"):r.split32(this.h,"little")};function c(b,N,u,v){return b<=15?N^u^v:b<=31?N&u|~N&v:b<=47?(N|~u)^v:b<=63?N&v|u&~v:N^(u|~v)}function p(b){return b<=15?0:b<=31?1518500249:b<=47?1859775393:b<=63?2400959708:2840853838}function d(b){return b<=15?1352829926:b<=31?1548603684:b<=47?1836072691:b<=63?2053994217:0}var m=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],y=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],h=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],_=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];return Fl}var Pl,om;function ow(){if(om)return Pl;om=1;var r=Xr(),t=ii();function s(n,i,o){if(!(this instanceof s))return new s(n,i,o);this.Hash=n,this.blockSize=n.blockSize/8,this.outSize=n.outSize/8,this.inner=null,this.outer=null,this._init(r.toArray(i,o))}return Pl=s,s.prototype._init=function(i){i.length>this.blockSize&&(i=new this.Hash().update(i).digest()),t(i.length<=this.blockSize);for(var o=i.length;o<this.blockSize;o++)i.push(0);for(o=0;o<i.length;o++)i[o]^=54;for(this.inner=new this.Hash().update(i),o=0;o<i.length;o++)i[o]^=106;this.outer=new this.Hash().update(i)},s.prototype.update=function(i,o){return this.inner.update(i,o),this},s.prototype.digest=function(i){return this.outer.update(this.inner.digest()),this.outer.digest(i)},Pl}var lm;function lw(){return lm||(lm=1,(function(r){var t=r;t.utils=Xr(),t.common=ai(),t.sha=iw(),t.ripemd=aw(),t.hmac=ow(),t.sha1=t.sha.sha1,t.sha256=t.sha.sha256,t.sha224=t.sha.sha224,t.sha384=t.sha.sha384,t.sha512=t.sha.sha512,t.ripemd160=t.ripemd.ripemd160})(Sl)),Sl}lw();let cw="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",dw=(r,t=21)=>(s=t)=>{let n="",i=s|0;for(;i--;)n+=r[Math.random()*r.length|0];return n},uw=(r=21)=>{let t="",s=r|0;for(;s--;)t+=cw[Math.random()*64|0];return t};const Nr=r=>Math.floor(r*72*20),vd=(r=0)=>{let t=r;return()=>++t},hw=()=>vd(),mw=()=>vd(1),pw=()=>vd(),fw=()=>uw().toLowerCase(),Nn=r=>dw("1234567890abcdef",r)(),gw=()=>`${Nn(8)}-${Nn(4)}-${Nn(4)}-${Nn(4)}-${Nn(12)}`;class xw extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{xmlns:"xmlns"})}}class yw extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{id:"Id",type:"Type",target:"Target",targetMode:"TargetMode"})}}const bw={EXTERNAL:"External"};class vw extends _e{constructor(t,s,n,i){super("Relationship"),this.root.push(new yw({id:t,type:s,target:n,targetMode:i}))}}class zs extends _e{constructor(){super("Relationships"),this.root.push(new xw({xmlns:"http://schemas.openxmlformats.org/package/2006/relationships"}))}createRelationship(t,s,n,i){const o=new vw(`rId${t}`,s,n,i);return this.root.push(o),o}get RelationshipCount(){return this.root.length-1}}class ww extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{id:"w:id",initials:"w:initials",author:"w:author",date:"w:date"})}}class jw extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{"xmlns:cx":"xmlns:cx","xmlns:cx1":"xmlns:cx1","xmlns:cx2":"xmlns:cx2","xmlns:cx3":"xmlns:cx3","xmlns:cx4":"xmlns:cx4","xmlns:cx5":"xmlns:cx5","xmlns:cx6":"xmlns:cx6","xmlns:cx7":"xmlns:cx7","xmlns:cx8":"xmlns:cx8","xmlns:mc":"xmlns:mc","xmlns:aink":"xmlns:aink","xmlns:am3d":"xmlns:am3d","xmlns:o":"xmlns:o","xmlns:r":"xmlns:r","xmlns:m":"xmlns:m","xmlns:v":"xmlns:v","xmlns:wp14":"xmlns:wp14","xmlns:wp":"xmlns:wp","xmlns:w10":"xmlns:w10","xmlns:w":"xmlns:w","xmlns:w14":"xmlns:w14","xmlns:w15":"xmlns:w15","xmlns:w16cex":"xmlns:w16cex","xmlns:w16cid":"xmlns:w16cid","xmlns:w16":"xmlns:w16","xmlns:w16sdtdh":"xmlns:w16sdtdh","xmlns:w16se":"xmlns:w16se","xmlns:wpg":"xmlns:wpg","xmlns:wpi":"xmlns:wpi","xmlns:wne":"xmlns:wne","xmlns:wps":"xmlns:wps"})}}class _w extends _e{constructor({id:t,initials:s,author:n,date:i=new Date,children:o}){super("w:comment"),this.root.push(new ww({id:t,initials:s,author:n,date:i.toISOString()}));for(const l of o)this.root.push(l)}}class kw extends _e{constructor({children:t}){super("w:comments"),ve(this,"relationships"),this.root.push(new jw({"xmlns:cx":"http://schemas.microsoft.com/office/drawing/2014/chartex","xmlns:cx1":"http://schemas.microsoft.com/office/drawing/2015/9/8/chartex","xmlns:cx2":"http://schemas.microsoft.com/office/drawing/2015/10/21/chartex","xmlns:cx3":"http://schemas.microsoft.com/office/drawing/2016/5/9/chartex","xmlns:cx4":"http://schemas.microsoft.com/office/drawing/2016/5/10/chartex","xmlns:cx5":"http://schemas.microsoft.com/office/drawing/2016/5/11/chartex","xmlns:cx6":"http://schemas.microsoft.com/office/drawing/2016/5/12/chartex","xmlns:cx7":"http://schemas.microsoft.com/office/drawing/2016/5/13/chartex","xmlns:cx8":"http://schemas.microsoft.com/office/drawing/2016/5/14/chartex","xmlns:mc":"http://schemas.openxmlformats.org/markup-compatibility/2006","xmlns:aink":"http://schemas.microsoft.com/office/drawing/2016/ink","xmlns:am3d":"http://schemas.microsoft.com/office/drawing/2017/model3d","xmlns:o":"urn:schemas-microsoft-com:office:office","xmlns:r":"http://schemas.openxmlformats.org/officeDocument/2006/relationships","xmlns:m":"http://schemas.openxmlformats.org/officeDocument/2006/math","xmlns:v":"urn:schemas-microsoft-com:vml","xmlns:wp14":"http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing","xmlns:wp":"http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing","xmlns:w10":"urn:schemas-microsoft-com:office:word","xmlns:w":"http://schemas.openxmlformats.org/wordprocessingml/2006/main","xmlns:w14":"http://schemas.microsoft.com/office/word/2010/wordml","xmlns:w15":"http://schemas.microsoft.com/office/word/2012/wordml","xmlns:w16cex":"http://schemas.microsoft.com/office/word/2018/wordml/cex","xmlns:w16cid":"http://schemas.microsoft.com/office/word/2016/wordml/cid","xmlns:w16":"http://schemas.microsoft.com/office/word/2018/wordml","xmlns:w16sdtdh":"http://schemas.microsoft.com/office/word/2020/wordml/sdtdatahash","xmlns:w16se":"http://schemas.microsoft.com/office/word/2015/wordml/symex","xmlns:wpg":"http://schemas.microsoft.com/office/word/2010/wordprocessingGroup","xmlns:wpi":"http://schemas.microsoft.com/office/word/2010/wordprocessingInk","xmlns:wne":"http://schemas.microsoft.com/office/word/2006/wordml","xmlns:wps":"http://schemas.microsoft.com/office/word/2010/wordprocessingShape"}));for(const s of t)this.root.push(new _w(s));this.relationships=new zs}get Relationships(){return this.relationships}}class Nw extends _e{constructor(){super("w:pageBreakBefore")}}const xc={AUTO:"auto"};class Sw extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{after:"w:after",before:"w:before",line:"w:line",lineRule:"w:lineRule",beforeAutoSpacing:"w:beforeAutospacing",afterAutoSpacing:"w:afterAutospacing"})}}class Cw extends _e{constructor(t){super("w:spacing"),this.root.push(new Sw(t))}}const Sr={HEADING_1:"Heading1",HEADING_2:"Heading2",HEADING_3:"Heading3",TITLE:"Title"};let Ci=class extends _e{constructor(t){super("w:pStyle"),this.root.push(new vt({val:t}))}};class Ew extends _e{constructor(t){super("w:tabs");for(const s of t)this.root.push(new Tw(s))}}const cm={LEFT:"left",RIGHT:"right"};class Aw extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{val:"w:val",pos:"w:pos",leader:"w:leader"})}}class Tw extends _e{constructor({type:t,position:s,leader:n}){super("w:tab"),this.root.push(new Aw({val:t,pos:s,leader:n}))}}class Ll extends _e{constructor(t,s){super("w:numPr"),this.root.push(new Iw(s)),this.root.push(new Rw(t))}}class Iw extends _e{constructor(t){if(super("w:ilvl"),t>9)throw new Error("Level cannot be greater than 9. Read more here: https://answers.microsoft.com/en-us/msoffice/forum/all/does-word-support-more-than-9-list-levels/d130fdcd-1781-446d-8c84-c6c79124e4d7");this.root.push(new vt({val:t}))}}class Rw extends _e{constructor(t){super("w:numId"),this.root.push(new vt({val:typeof t=="string"?`{${t}}`:t}))}}class cg extends _e{constructor(){super(...arguments),ve(this,"fileChild",Symbol())}}class Ow extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{id:"r:id",history:"w:history",anchor:"w:anchor"})}}class Fw extends _e{constructor(t,s,n){super("w:hyperlink"),ve(this,"linkId"),this.linkId=s;const i={history:1,anchor:n||void 0,id:n?void 0:`rId${this.linkId}`},o=new Ow(i);this.root.push(o),t.forEach(l=>{this.root.push(l)})}}class Pw extends _e{constructor(t){super("w:externalHyperlink"),this.options=t}}class Lw extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{id:"w:id",name:"w:name"})}}class Dw extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{id:"w:id"})}}class Mw{constructor(t){ve(this,"bookmarkUniqueNumericId",pw()),ve(this,"start"),ve(this,"children"),ve(this,"end");const s=this.bookmarkUniqueNumericId();this.start=new $w(t.id,s),this.children=t.children,this.end=new Bw(s)}}class $w extends _e{constructor(t,s){super("w:bookmarkStart");const n=new Lw({name:t,id:s});this.root.push(n)}}class Bw extends _e{constructor(t){super("w:bookmarkEnd");const s=new Dw({id:t});this.root.push(s)}}class zw extends _e{constructor(t){super("w:outlineLvl"),this.level=t,this.root.push(new vt({val:t}))}}const Uw={TOP:"top",CENTER:"center",BOTTOM:"bottom"};dn(Qe({},Uw),{BOTH:"both"});class qw extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{verticalAlign:"w:val"})}}class dg extends _e{constructor(t){super("w:vAlign"),this.root.push(new qw({verticalAlign:t}))}}class Ww extends _e{constructor({space:t,count:s,separate:n,equalWidth:i,children:o}){super("w:cols"),this.root.push(new ws({space:{key:"w:space",value:t===void 0?void 0:Yt(t)},count:{key:"w:num",value:s===void 0?void 0:er(s)},separate:{key:"w:sep",value:n},equalWidth:{key:"w:equalWidth",value:i}})),!i&&o&&o.forEach(l=>this.addChildElement(l))}}const Hw=({type:r,linePitch:t,charSpace:s})=>new Vr({name:"w:docGrid",attributes:{type:{key:"w:type",value:r},linePitch:{key:"w:linePitch",value:er(t)},charSpace:{key:"w:charSpace",value:s?er(s):void 0}}}),an={DEFAULT:"default",FIRST:"first",EVEN:"even"};class Gw extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{type:"w:type",id:"r:id"})}}const dm={HEADER:"w:headerReference",FOOTER:"w:footerReference"};class Dl extends _e{constructor(t,s){super(t),this.root.push(new Gw({type:s.type||an.DEFAULT,id:`rId${s.id}`}))}}const Vw=({countBy:r,start:t,restart:s,distance:n})=>new Vr({name:"w:lnNumType",attributes:{countBy:{key:"w:countBy",value:r===void 0?void 0:er(r)},start:{key:"w:start",value:t===void 0?void 0:er(t)},restart:{key:"w:restart",value:s},distance:{key:"w:distance",value:n===void 0?void 0:Yt(n)}}});class um extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{display:"w:display",offsetFrom:"w:offsetFrom",zOrder:"w:zOrder"})}}class Kw extends ls{constructor(t){if(super("w:pgBorders"),!t)return this;t.pageBorders?this.root.push(new um({display:t.pageBorders.display,offsetFrom:t.pageBorders.offsetFrom,zOrder:t.pageBorders.zOrder})):this.root.push(new um({})),t.pageBorderTop&&this.root.push(new lt("w:top",t.pageBorderTop)),t.pageBorderLeft&&this.root.push(new lt("w:left",t.pageBorderLeft)),t.pageBorderBottom&&this.root.push(new lt("w:bottom",t.pageBorderBottom)),t.pageBorderRight&&this.root.push(new lt("w:right",t.pageBorderRight))}}class Xw extends _e{constructor(t,s,n,i,o,l,a){super("w:pgMar"),this.root.push(new ws({top:{key:"w:top",value:as(t)},right:{key:"w:right",value:Yt(s)},bottom:{key:"w:bottom",value:as(n)},left:{key:"w:left",value:Yt(i)},header:{key:"w:header",value:Yt(o)},footer:{key:"w:footer",value:Yt(l)},gutter:{key:"w:gutter",value:Yt(a)}}))}}class Yw extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{start:"w:start",formatType:"w:fmt",separator:"w:chapSep"})}}class Jw extends _e{constructor({start:t,formatType:s,separator:n}){super("w:pgNumType"),this.root.push(new Yw({start:t===void 0?void 0:er(t),formatType:s,separator:n}))}}const yc={PORTRAIT:"portrait",LANDSCAPE:"landscape"},Qw=({width:r,height:t,orientation:s,code:n})=>{const i=Yt(r),o=Yt(t);return new Vr({name:"w:pgSz",attributes:{width:{key:"w:w",value:s===yc.LANDSCAPE?o:i},height:{key:"w:h",value:s===yc.LANDSCAPE?i:o},orientation:{key:"w:orient",value:s},code:{key:"w:code",value:n}}})};class Zw extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{val:"w:val"})}}class ej extends _e{constructor(t){super("w:textDirection"),this.root.push(new Zw({val:t}))}}class tj extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{val:"w:val"})}}class rj extends _e{constructor(t){super("w:type"),this.root.push(new tj({val:t}))}}const Cs={TOP:1440,RIGHT:1440,BOTTOM:1440,LEFT:1440,HEADER:708,FOOTER:708,GUTTER:0},Ml={WIDTH:11906,HEIGHT:16838,ORIENTATION:yc.PORTRAIT};class sj extends _e{constructor({page:{size:{width:t=Ml.WIDTH,height:s=Ml.HEIGHT,orientation:n=Ml.ORIENTATION}={},margin:{top:i=Cs.TOP,right:o=Cs.RIGHT,bottom:l=Cs.BOTTOM,left:a=Cs.LEFT,header:c=Cs.HEADER,footer:p=Cs.FOOTER,gutter:d=Cs.GUTTER}={},pageNumbers:m={},borders:y,textDirection:h}={},grid:{linePitch:_=360,charSpace:b,type:N}={},headerWrapperGroup:u={},footerWrapperGroup:v={},lineNumbers:g,titlePage:w,verticalAlign:k,column:A,type:T}={}){super("w:sectPr"),this.addHeaderFooterGroup(dm.HEADER,u),this.addHeaderFooterGroup(dm.FOOTER,v),T&&this.root.push(new rj(T)),this.root.push(Qw({width:t,height:s,orientation:n})),this.root.push(new Xw(i,o,l,a,c,p,d)),y&&this.root.push(new Kw(y)),g&&this.root.push(Vw(g)),this.root.push(new Jw(m)),A&&this.root.push(new Ww(A)),k&&this.root.push(new dg(k)),w!==void 0&&this.root.push(new Ne("w:titlePg",w)),h&&this.root.push(new ej(h)),this.root.push(Hw({linePitch:_,charSpace:b,type:N}))}addHeaderFooterGroup(t,s){s.default&&this.root.push(new Dl(t,{type:an.DEFAULT,id:s.default.View.ReferenceId})),s.first&&this.root.push(new Dl(t,{type:an.FIRST,id:s.first.View.ReferenceId})),s.even&&this.root.push(new Dl(t,{type:an.EVEN,id:s.even.View.ReferenceId}))}}class nj extends _e{constructor(){super("w:body"),ve(this,"sections",[])}addSection(t){const s=this.sections.pop();this.root.push(this.createSectionParagraph(s)),this.sections.push(new sj(t))}prepForXml(t){return this.sections.length===1&&(this.root.splice(0,1),this.root.push(this.sections.pop())),super.prepForXml(t)}push(t){this.root.push(t)}createSectionParagraph(t){const s=new Fe({}),n=new fn({});return n.push(t),s.addChildElement(n),s}}const hm={wpc:"http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas",mc:"http://schemas.openxmlformats.org/markup-compatibility/2006",o:"urn:schemas-microsoft-com:office:office",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",m:"http://schemas.openxmlformats.org/officeDocument/2006/math",v:"urn:schemas-microsoft-com:vml",wp14:"http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing",wp:"http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing",w10:"urn:schemas-microsoft-com:office:word",w:"http://schemas.openxmlformats.org/wordprocessingml/2006/main",w14:"http://schemas.microsoft.com/office/word/2010/wordml",w15:"http://schemas.microsoft.com/office/word/2012/wordml",wpg:"http://schemas.microsoft.com/office/word/2010/wordprocessingGroup",wpi:"http://schemas.microsoft.com/office/word/2010/wordprocessingInk",wne:"http://schemas.microsoft.com/office/word/2006/wordml",wps:"http://schemas.microsoft.com/office/word/2010/wordprocessingShape",cp:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",xsi:"http://www.w3.org/2001/XMLSchema-instance",cx:"http://schemas.microsoft.com/office/drawing/2014/chartex",cx1:"http://schemas.microsoft.com/office/drawing/2015/9/8/chartex",cx2:"http://schemas.microsoft.com/office/drawing/2015/10/21/chartex",cx3:"http://schemas.microsoft.com/office/drawing/2016/5/9/chartex",cx4:"http://schemas.microsoft.com/office/drawing/2016/5/10/chartex",cx5:"http://schemas.microsoft.com/office/drawing/2016/5/11/chartex",cx6:"http://schemas.microsoft.com/office/drawing/2016/5/12/chartex",cx7:"http://schemas.microsoft.com/office/drawing/2016/5/13/chartex",cx8:"http://schemas.microsoft.com/office/drawing/2016/5/14/chartex",aink:"http://schemas.microsoft.com/office/drawing/2016/ink",am3d:"http://schemas.microsoft.com/office/drawing/2017/model3d",w16cex:"http://schemas.microsoft.com/office/word/2018/wordml/cex",w16cid:"http://schemas.microsoft.com/office/word/2016/wordml/cid",w16:"http://schemas.microsoft.com/office/word/2018/wordml",w16sdtdh:"http://schemas.microsoft.com/office/word/2020/wordml/sdtdatahash",w16se:"http://schemas.microsoft.com/office/word/2015/wordml/symex"};class Fa extends Ue{constructor(t,s){super(Qe({Ignorable:s},Object.fromEntries(t.map(n=>[n,hm[n]])))),ve(this,"xmlKeys",Qe({Ignorable:"mc:Ignorable"},Object.fromEntries(Object.keys(hm).map(n=>[n,`xmlns:${n}`]))))}}class ij extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{color:"w:color",themeColor:"w:themeColor",themeShade:"w:themeShade",themeTint:"w:themeTint"})}}class aj extends _e{constructor(t){super("w:background"),this.root.push(new ij({color:t.color===void 0?void 0:hn(t.color),themeColor:t.themeColor,themeShade:t.themeShade===void 0?void 0:Vh(t.themeShade),themeTint:t.themeTint===void 0?void 0:Vh(t.themeTint)}))}}class oj extends _e{constructor(t){super("w:document"),ve(this,"body"),this.root.push(new Fa(["wpc","mc","o","r","m","v","wp14","wp","w10","w","w14","w15","wpg","wpi","wne","wps","cx","cx1","cx2","cx3","cx4","cx5","cx6","cx7","cx8","aink","am3d","w16cex","w16cid","w16","w16sdtdh","w16se"],"w14 w15 wp14")),this.body=new nj,t.background&&this.root.push(new aj(t.background)),this.root.push(this.body)}add(t){return this.body.push(t),this}get Body(){return this.body}}class ug{constructor(t){ve(this,"document"),ve(this,"relationships"),this.document=new oj(t),this.relationships=new zs}get View(){return this.document}get Relationships(){return this.relationships}}class lj extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{val:"w:val"})}}class cj extends _e{constructor(){super("w:wordWrap"),this.root.push(new lj({val:0}))}}const dj=r=>{var t,s;return new Vr({name:"w:framePr",attributes:{anchorLock:{key:"w:anchorLock",value:r.anchorLock},dropCap:{key:"w:dropCap",value:r.dropCap},width:{key:"w:w",value:r.width},height:{key:"w:h",value:r.height},x:{key:"w:x",value:r.position?r.position.x:void 0},y:{key:"w:y",value:r.position?r.position.y:void 0},anchorHorizontal:{key:"w:hAnchor",value:r.anchor.horizontal},anchorVertical:{key:"w:vAnchor",value:r.anchor.vertical},spaceHorizontal:{key:"w:hSpace",value:(t=r.space)==null?void 0:t.horizontal},spaceVertical:{key:"w:vSpace",value:(s=r.space)==null?void 0:s.vertical},rule:{key:"w:hRule",value:r.rule},alignmentX:{key:"w:xAlign",value:r.alignment?r.alignment.x:void 0},alignmentY:{key:"w:yAlign",value:r.alignment?r.alignment.y:void 0},lines:{key:"w:lines",value:r.lines},wrap:{key:"w:wrap",value:r.wrap}}})};class fn extends ls{constructor(t){var s,n;if(super("w:pPr"),ve(this,"numberingReferences",[]),!t)return this;t.heading&&this.push(new Ci(t.heading)),t.bullet&&this.push(new Ci("ListParagraph")),t.numbering&&!t.style&&!t.heading&&(t.numbering.custom||this.push(new Ci("ListParagraph"))),t.style&&this.push(new Ci(t.style)),t.keepNext!==void 0&&this.push(new Ne("w:keepNext",t.keepNext)),t.keepLines!==void 0&&this.push(new Ne("w:keepLines",t.keepLines)),t.pageBreakBefore&&this.push(new Nw),t.frame&&this.push(dj(t.frame)),t.widowControl!==void 0&&this.push(new Ne("w:widowControl",t.widowControl)),t.bullet&&this.push(new Ll(1,t.bullet.level)),t.numbering?(this.numberingReferences.push({reference:t.numbering.reference,instance:(s=t.numbering.instance)!=null?s:0}),this.push(new Ll(`${t.numbering.reference}-${(n=t.numbering.instance)!=null?n:0}`,t.numbering.level))):t.numbering===!1&&this.push(new Ll(0,0)),t.border&&this.push(new Fv(t.border)),t.thematicBreak&&this.push(new Pv),t.shading&&this.push(new Ra(t.shading)),t.wordWrap&&this.push(new cj),t.overflowPunctuation&&this.push(new Ne("w:overflowPunct",t.overflowPunctuation));const i=[...t.rightTabStop!==void 0?[{type:cm.RIGHT,position:t.rightTabStop}]:[],...t.tabStops?t.tabStops:[],...t.leftTabStop!==void 0?[{type:cm.LEFT,position:t.leftTabStop}]:[]];i.length>0&&this.push(new Ew(i)),t.bidirectional!==void 0&&this.push(new Ne("w:bidi",t.bidirectional)),t.spacing&&this.push(new Cw(t.spacing)),t.indent&&this.push(new Lv(t.indent)),t.contextualSpacing!==void 0&&this.push(new Ne("w:contextualSpacing",t.contextualSpacing)),t.alignment&&this.push(new sg(t.alignment)),t.outlineLevel!==void 0&&this.push(new zw(t.outlineLevel)),t.suppressLineNumbers!==void 0&&this.push(new Ne("w:suppressLineNumbers",t.suppressLineNumbers)),t.autoSpaceEastAsianText!==void 0&&this.push(new Ne("w:autoSpaceDN",t.autoSpaceEastAsianText)),t.run&&this.push(new Bs(t.run))}push(t){this.root.push(t)}prepForXml(t){if(t.viewWrapper instanceof ug)for(const s of this.numberingReferences)t.file.Numbering.createConcreteNumberingInstance(s.reference,s.instance);return super.prepForXml(t)}}class Fe extends cg{constructor(t){if(super("w:p"),ve(this,"properties"),typeof t=="string")return this.properties=new fn({}),this.root.push(this.properties),this.root.push(new Vt(t)),this;if(this.properties=new fn(t),this.root.push(this.properties),t.text&&this.root.push(new Vt(t.text)),t.children)for(const s of t.children){if(s instanceof Mw){this.root.push(s.start);for(const n of s.children)this.root.push(n);this.root.push(s.end);continue}this.root.push(s)}}prepForXml(t){for(const s of this.root)if(s instanceof Pw){const n=this.root.indexOf(s),i=new Fw(s.options.children,fw());t.viewWrapper.Relationships.createRelationship(i.linkId,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",s.options.link,bw.EXTERNAL),this.root[n]=i}return super.prepForXml(t)}addRunToFront(t){return this.root.splice(1,0,t),this}}class uj extends _e{constructor(t){super("w:tblGrid");for(const s of t)this.root.push(new hj(s))}}class hj extends _e{constructor(t){super("w:gridCol"),t!==void 0&&this.root.push(new ws({width:{key:"w:w",value:Yt(t)}}))}}const hg={TABLE:"w:tblCellMar",TABLE_CELL:"w:tcMar"};class mg extends ls{constructor(t,{marginUnitType:s=la.DXA,top:n,left:i,bottom:o,right:l}){super(t),n!==void 0&&this.root.push(new Os("w:top",{type:s,size:n})),i!==void 0&&this.root.push(new Os("w:left",{type:s,size:i})),o!==void 0&&this.root.push(new Os("w:bottom",{type:s,size:o})),l!==void 0&&this.root.push(new Os("w:right",{type:s,size:l}))}}const la={AUTO:"auto",DXA:"dxa",PERCENTAGE:"pct"};class Os extends _e{constructor(t,{type:s=la.AUTO,size:n}){super(t);let i=n;s===la.PERCENTAGE&&typeof n=="number"&&(i=`${n}%`),this.root.push(new ws({type:{key:"w:type",value:s},size:{key:"w:w",value:rg(i)}}))}}class mj extends ls{constructor(t){super("w:tcBorders"),t.top&&this.root.push(new lt("w:top",t.top)),t.start&&this.root.push(new lt("w:start",t.start)),t.left&&this.root.push(new lt("w:left",t.left)),t.bottom&&this.root.push(new lt("w:bottom",t.bottom)),t.end&&this.root.push(new lt("w:end",t.end)),t.right&&this.root.push(new lt("w:right",t.right))}}class pj extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{val:"w:val"})}}class fj extends _e{constructor(t){super("w:gridSpan"),this.root.push(new pj({val:er(t)}))}}const pg={CONTINUE:"continue",RESTART:"restart"};class gj extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{val:"w:val"})}}class mm extends _e{constructor(t){super("w:vMerge"),this.root.push(new gj({val:t}))}}class xj extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{val:"w:val"})}}class yj extends _e{constructor(t){super("w:textDirection"),this.root.push(new xj({val:t}))}}class bj extends ls{constructor(t){super("w:tcPr"),t.width&&this.root.push(new Os("w:tcW",t.width)),t.columnSpan&&this.root.push(new fj(t.columnSpan)),t.verticalMerge?this.root.push(new mm(t.verticalMerge)):t.rowSpan&&t.rowSpan>1&&this.root.push(new mm(pg.RESTART)),t.borders&&this.root.push(new mj(t.borders)),t.shading&&this.root.push(new Ra(t.shading)),t.margins&&this.root.push(new mg(hg.TABLE_CELL,t.margins)),t.textDirection&&this.root.push(new yj(t.textDirection)),t.verticalAlign&&this.root.push(new dg(t.verticalAlign))}}let Zt=class extends _e{constructor(t){super("w:tc"),this.options=t,this.root.push(new bj(t));for(const s of t.children)this.root.push(s)}prepForXml(t){return this.root[this.root.length-1]instanceof Fe||this.root.push(new Fe({})),super.prepForXml(t)}};const Vs={style:xd.NONE,size:0,color:"auto"},Ks={style:xd.SINGLE,size:4,color:"auto"};class fg extends _e{constructor(t){super("w:tblBorders"),t.top?this.root.push(new lt("w:top",t.top)):this.root.push(new lt("w:top",Ks)),t.left?this.root.push(new lt("w:left",t.left)):this.root.push(new lt("w:left",Ks)),t.bottom?this.root.push(new lt("w:bottom",t.bottom)):this.root.push(new lt("w:bottom",Ks)),t.right?this.root.push(new lt("w:right",t.right)):this.root.push(new lt("w:right",Ks)),t.insideHorizontal?this.root.push(new lt("w:insideH",t.insideHorizontal)):this.root.push(new lt("w:insideH",Ks)),t.insideVertical?this.root.push(new lt("w:insideV",t.insideVertical)):this.root.push(new lt("w:insideV",Ks))}}ve(fg,"NONE",{top:Vs,bottom:Vs,left:Vs,right:Vs,insideHorizontal:Vs,insideVertical:Vs});class vj extends _e{constructor({horizontalAnchor:t,verticalAnchor:s,absoluteHorizontalPosition:n,relativeHorizontalPosition:i,absoluteVerticalPosition:o,relativeVerticalPosition:l,bottomFromText:a,topFromText:c,leftFromText:p,rightFromText:d,overlap:m}){super("w:tblpPr"),this.root.push(new ws({leftFromText:{key:"w:leftFromText",value:p===void 0?void 0:Yt(p)},rightFromText:{key:"w:rightFromText",value:d===void 0?void 0:Yt(d)},topFromText:{key:"w:topFromText",value:c===void 0?void 0:Yt(c)},bottomFromText:{key:"w:bottomFromText",value:a===void 0?void 0:Yt(a)},absoluteHorizontalPosition:{key:"w:tblpX",value:n===void 0?void 0:as(n)},absoluteVerticalPosition:{key:"w:tblpY",value:o===void 0?void 0:as(o)},horizontalAnchor:{key:"w:horzAnchor",value:t===void 0?void 0:t},relativeHorizontalPosition:{key:"w:tblpXSpec",value:i},relativeVerticalPosition:{key:"w:tblpYSpec",value:l},verticalAnchor:{key:"w:vertAnchor",value:s}})),m&&this.root.push(new Iv("w:tblOverlap",m))}}class wj extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{type:"w:type"})}}class jj extends _e{constructor(t){super("w:tblLayout"),this.root.push(new wj({type:t}))}}const _j={DXA:"dxa"};class gg extends _e{constructor({type:t=_j.DXA,value:s}){super("w:tblCellSpacing"),this.root.push(new ws({type:{key:"w:type",value:t},value:{key:"w:w",value:rg(s)}}))}}class kj extends ls{constructor(t){super("w:tblPr"),t.style&&this.root.push(new Ps("w:tblStyle",t.style)),t.float&&this.root.push(new vj(t.float)),t.visuallyRightToLeft!==void 0&&this.root.push(new Ne("w:bidiVisual",t.visuallyRightToLeft)),t.width&&this.root.push(new Os("w:tblW",t.width)),t.alignment&&this.root.push(new sg(t.alignment)),t.indent&&this.root.push(new Os("w:tblInd",t.indent)),t.borders&&this.root.push(new fg(t.borders)),t.shading&&this.root.push(new Ra(t.shading)),t.layout&&this.root.push(new jj(t.layout)),t.cellMargin&&this.root.push(new mg(hg.TABLE,t.cellMargin)),t.cellSpacing&&this.root.push(new gg(t.cellSpacing))}}let Nj=class extends cg{constructor({rows:t,width:s,columnWidths:n=Array(Math.max(...t.map(h=>h.CellCount))).fill(100),margins:i,indent:o,float:l,layout:a,style:c,borders:p,alignment:d,visuallyRightToLeft:m,cellSpacing:y}){super("w:tbl"),this.root.push(new kj({borders:p??{},width:s??{size:100},indent:o,float:l,layout:a,style:c,alignment:d,cellMargin:i,visuallyRightToLeft:m,cellSpacing:y})),this.root.push(new uj(n));for(const h of t)this.root.push(h);t.forEach((h,_)=>{if(_===t.length-1)return;let b=0;h.cells.forEach(N=>{if(N.options.rowSpan&&N.options.rowSpan>1){const u=new Zt({rowSpan:N.options.rowSpan-1,columnSpan:N.options.columnSpan,borders:N.options.borders,children:[],verticalMerge:pg.CONTINUE});t[_+1].addCellToColumnIndex(u,b)}b+=N.options.columnSpan||1})})}};class Sj extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{value:"w:val",rule:"w:hRule"})}}class Cj extends _e{constructor(t,s){super("w:trHeight"),this.root.push(new Sj({value:Yt(t),rule:s}))}}class Ej extends ls{constructor(t){super("w:trPr"),t.cantSplit!==void 0&&this.root.push(new Ne("w:cantSplit",t.cantSplit)),t.tableHeader!==void 0&&this.root.push(new Ne("w:tblHeader",t.tableHeader)),t.height&&this.root.push(new Cj(t.height.value,t.height.rule)),t.cellSpacing&&this.root.push(new gg(t.cellSpacing))}}let Ei=class extends _e{constructor(t){super("w:tr"),this.options=t,this.root.push(new Ej(t));for(const s of t.children)this.root.push(s)}get CellCount(){return this.options.children.length}get cells(){return this.root.filter(t=>t instanceof Zt)}addCellToIndex(t,s){this.root.splice(s+1,0,t)}addCellToColumnIndex(t,s){const n=this.columnIndexToRootIndex(s,!0);this.addCellToIndex(t,n-1)}rootIndexToColumnIndex(t){if(t<1||t>=this.root.length)throw new Error(`cell 'rootIndex' should between 1 to ${this.root.length-1}`);let s=0;for(let n=1;n<t;n++){const i=this.root[n];s+=i.options.columnSpan||1}return s}columnIndexToRootIndex(t,s=!1){if(t<0)throw new Error("cell 'columnIndex' should not less than zero");let n=0,i=1;for(;n<=t;){if(i>=this.root.length){if(s)return this.root.length;throw new Error(`cell 'columnIndex' should not great than ${n-1}`)}const o=this.root[i];i+=1,n+=o&&o.options.columnSpan||1}return i-1}};class Aj extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{xmlns:"xmlns",vt:"xmlns:vt"})}}class Tj extends _e{constructor(){super("Properties"),this.root.push(new Aj({xmlns:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes"}))}}class Ij extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{xmlns:"xmlns"})}}class Rj extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{contentType:"ContentType",extension:"Extension"})}}class Jr extends _e{constructor(t,s){super("Default"),this.root.push(new Rj({contentType:t,extension:s}))}}class Oj extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{contentType:"ContentType",partName:"PartName"})}}class br extends _e{constructor(t,s){super("Override"),this.root.push(new Oj({contentType:t,partName:s}))}}class Fj extends _e{constructor(){super("Types"),this.root.push(new Ij({xmlns:"http://schemas.openxmlformats.org/package/2006/content-types"})),this.root.push(new Jr("image/png","png")),this.root.push(new Jr("image/jpeg","jpeg")),this.root.push(new Jr("image/jpeg","jpg")),this.root.push(new Jr("image/bmp","bmp")),this.root.push(new Jr("image/gif","gif")),this.root.push(new Jr("image/svg+xml","svg")),this.root.push(new Jr("application/vnd.openxmlformats-package.relationships+xml","rels")),this.root.push(new Jr("application/xml","xml")),this.root.push(new Jr("application/vnd.openxmlformats-officedocument.obfuscatedFont","odttf")),this.root.push(new br("application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml","/word/document.xml")),this.root.push(new br("application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml","/word/styles.xml")),this.root.push(new br("application/vnd.openxmlformats-package.core-properties+xml","/docProps/core.xml")),this.root.push(new br("application/vnd.openxmlformats-officedocument.custom-properties+xml","/docProps/custom.xml")),this.root.push(new br("application/vnd.openxmlformats-officedocument.extended-properties+xml","/docProps/app.xml")),this.root.push(new br("application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml","/word/numbering.xml")),this.root.push(new br("application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml","/word/footnotes.xml")),this.root.push(new br("application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml","/word/settings.xml")),this.root.push(new br("application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml","/word/comments.xml")),this.root.push(new br("application/vnd.openxmlformats-officedocument.wordprocessingml.fontTable+xml","/word/fontTable.xml"))}addFooter(t){this.root.push(new br("application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml",`/word/footer${t}.xml`))}addHeader(t){this.root.push(new br("application/vnd.openxmlformats-officedocument.wordprocessingml.header+xml",`/word/header${t}.xml`))}}class Pj extends _e{constructor(t){super("cp:coreProperties"),this.root.push(new Fa(["cp","dc","dcterms","dcmitype","xsi"])),t.title&&this.root.push(new Ns("dc:title",t.title)),t.subject&&this.root.push(new Ns("dc:subject",t.subject)),t.creator&&this.root.push(new Ns("dc:creator",t.creator)),t.keywords&&this.root.push(new Ns("cp:keywords",t.keywords)),t.description&&this.root.push(new Ns("dc:description",t.description)),t.lastModifiedBy&&this.root.push(new Ns("cp:lastModifiedBy",t.lastModifiedBy)),t.revision&&this.root.push(new Ns("cp:revision",String(t.revision))),this.root.push(new pm("dcterms:created")),this.root.push(new pm("dcterms:modified"))}}class Lj extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{type:"xsi:type"})}}class pm extends _e{constructor(t){super(t),this.root.push(new Lj({type:"dcterms:W3CDTF"})),this.root.push(Tv(new Date))}}class Dj extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{xmlns:"xmlns",vt:"xmlns:vt"})}}class Mj extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{fmtid:"fmtid",pid:"pid",name:"name"})}}class $j extends _e{constructor(t,s){super("property"),this.root.push(new Mj({fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:t.toString(),name:s.name})),this.root.push(new Bj(s.value))}}class Bj extends _e{constructor(t){super("vt:lpwstr"),this.root.push(t)}}class zj extends _e{constructor(t){super("Properties"),ve(this,"nextId"),ve(this,"properties",[]),this.root.push(new Dj({xmlns:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes"})),this.nextId=2;for(const s of t)this.addCustomProperty(s)}prepForXml(t){return this.properties.forEach(s=>this.root.push(s)),super.prepForXml(t)}addCustomProperty(t){this.properties.push(new $j(this.nextId++,t))}}const Ai=({id:r,fontKey:t,subsetted:s},n)=>new Vr({name:n,attributes:Qe({id:{key:"r:id",value:r}},t?{fontKey:{key:"w:fontKey",value:`{${t}}`}}:{}),children:[...s?[new Ne("w:subsetted",s)]:[]]}),Uj=({name:r,altName:t,panose1:s,charset:n,family:i,notTrueType:o,pitch:l,sig:a,embedRegular:c,embedBold:p,embedItalic:d,embedBoldItalic:m})=>new Vr({name:"w:font",attributes:{name:{key:"w:name",value:r}},children:[...t?[kn("w:altName",t)]:[],...s?[kn("w:panose1",s)]:[],...n?[kn("w:charset",n)]:[],kn("w:family",i),...o?[new Ne("w:notTrueType",o)]:[],kn("w:pitch",l),...a?[new Vr({name:"w:sig",attributes:{usb0:{key:"w:usb0",value:a.usb0},usb1:{key:"w:usb1",value:a.usb1},usb2:{key:"w:usb2",value:a.usb2},usb3:{key:"w:usb3",value:a.usb3},csb0:{key:"w:csb0",value:a.csb0},csb1:{key:"w:csb1",value:a.csb1}}})]:[],...c?[Ai(c,"w:embedRegular")]:[],...p?[Ai(p,"w:embedBold")]:[],...d?[Ai(d,"w:embedItalic")]:[],...m?[Ai(m,"w:embedBoldItalic")]:[]]}),qj=({name:r,index:t,fontKey:s,characterSet:n})=>Uj({name:r,sig:{usb0:"E0002AFF",usb1:"C000247B",usb2:"00000009",usb3:"00000000",csb0:"000001FF",csb1:"00000000"},charset:n,family:"auto",pitch:"variable",embedRegular:{fontKey:s,id:`rId${t}`}}),Wj=r=>new Vr({name:"w:fonts",attributes:{mc:{key:"xmlns:mc",value:"http://schemas.openxmlformats.org/markup-compatibility/2006"},r:{key:"xmlns:r",value:"http://schemas.openxmlformats.org/officeDocument/2006/relationships"},w:{key:"xmlns:w",value:"http://schemas.openxmlformats.org/wordprocessingml/2006/main"},w14:{key:"xmlns:w14",value:"http://schemas.microsoft.com/office/word/2010/wordml"},w15:{key:"xmlns:w15",value:"http://schemas.microsoft.com/office/word/2012/wordml"},w16cex:{key:"xmlns:w16cex",value:"http://schemas.microsoft.com/office/word/2018/wordml/cex"},w16cid:{key:"xmlns:w16cid",value:"http://schemas.microsoft.com/office/word/2016/wordml/cid"},w16:{key:"xmlns:w16",value:"http://schemas.microsoft.com/office/word/2018/wordml"},w16sdtdh:{key:"xmlns:w16sdtdh",value:"http://schemas.microsoft.com/office/word/2020/wordml/sdtdatahash"},w16se:{key:"xmlns:w16se",value:"http://schemas.microsoft.com/office/word/2015/wordml/symex"},Ignorable:{key:"mc:Ignorable",value:"w14 w15 w16se w16cid w16 w16cex w16sdtdh"}},children:r.map((t,s)=>qj({name:t.name,index:s+1,fontKey:t.fontKey}))});class Hj{constructor(t){ve(this,"fontTable"),ve(this,"relationships"),ve(this,"fontOptionsWithKey",[]),this.options=t,this.fontOptionsWithKey=t.map(s=>dn(Qe({},s),{fontKey:gw()})),this.fontTable=Wj(this.fontOptionsWithKey),this.relationships=new zs;for(let s=0;s<t.length;s++)this.relationships.createRelationship(s+1,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/font",`fonts/${t[s].name}.odttf`)}get View(){return this.fontTable}get Relationships(){return this.relationships}}class Gj extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{wpc:"xmlns:wpc",mc:"xmlns:mc",o:"xmlns:o",r:"xmlns:r",m:"xmlns:m",v:"xmlns:v",wp14:"xmlns:wp14",wp:"xmlns:wp",w10:"xmlns:w10",w:"xmlns:w",w14:"xmlns:w14",w15:"xmlns:w15",wpg:"xmlns:wpg",wpi:"xmlns:wpi",wne:"xmlns:wne",wps:"xmlns:wps",cp:"xmlns:cp",dc:"xmlns:dc",dcterms:"xmlns:dcterms",dcmitype:"xmlns:dcmitype",xsi:"xmlns:xsi",type:"xsi:type"})}}let Vj=class extends Zf{constructor(t,s){super("w:ftr",s),ve(this,"refId"),this.refId=t,s||this.root.push(new Gj({wpc:"http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas",mc:"http://schemas.openxmlformats.org/markup-compatibility/2006",o:"urn:schemas-microsoft-com:office:office",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",m:"http://schemas.openxmlformats.org/officeDocument/2006/math",v:"urn:schemas-microsoft-com:vml",wp14:"http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing",wp:"http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing",w10:"urn:schemas-microsoft-com:office:word",w:"http://schemas.openxmlformats.org/wordprocessingml/2006/main",w14:"http://schemas.microsoft.com/office/word/2010/wordml",w15:"http://schemas.microsoft.com/office/word/2012/wordml",wpg:"http://schemas.microsoft.com/office/word/2010/wordprocessingGroup",wpi:"http://schemas.microsoft.com/office/word/2010/wordprocessingInk",wne:"http://schemas.microsoft.com/office/word/2006/wordml",wps:"http://schemas.microsoft.com/office/word/2010/wordprocessingShape"}))}get ReferenceId(){return this.refId}add(t){this.root.push(t)}};class Kj{constructor(t,s,n){ve(this,"footer"),ve(this,"relationships"),this.media=t,this.footer=new Vj(s,n),this.relationships=new zs}add(t){this.footer.add(t)}addChildElement(t){this.footer.addChildElement(t)}get View(){return this.footer}get Relationships(){return this.relationships}get Media(){return this.media}}class Xj extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{type:"w:type",id:"w:id"})}}class Yj extends _e{constructor(){super("w:footnoteRef")}}class Jj extends Oa{constructor(){super({style:"FootnoteReference"}),this.root.push(new Yj)}}const fm={SEPERATOR:"separator",CONTINUATION_SEPERATOR:"continuationSeparator"};class $l extends _e{constructor(t){super("w:footnote"),this.root.push(new Xj({type:t.type,id:t.id}));for(let s=0;s<t.children.length;s++){const n=t.children[s];s===0&&n.addRunToFront(new Jj),this.root.push(n)}}}class Qj extends _e{constructor(){super("w:continuationSeparator")}}class Zj extends Oa{constructor(){super({}),this.root.push(new Qj)}}class e_ extends _e{constructor(){super("w:separator")}}class t_ extends Oa{constructor(){super({}),this.root.push(new e_)}}class r_ extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{wpc:"xmlns:wpc",mc:"xmlns:mc",o:"xmlns:o",r:"xmlns:r",m:"xmlns:m",v:"xmlns:v",wp14:"xmlns:wp14",wp:"xmlns:wp",w10:"xmlns:w10",w:"xmlns:w",w14:"xmlns:w14",w15:"xmlns:w15",wpg:"xmlns:wpg",wpi:"xmlns:wpi",wne:"xmlns:wne",wps:"xmlns:wps",Ignorable:"mc:Ignorable"})}}class s_ extends _e{constructor(){super("w:footnotes"),this.root.push(new r_({wpc:"http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas",mc:"http://schemas.openxmlformats.org/markup-compatibility/2006",o:"urn:schemas-microsoft-com:office:office",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",m:"http://schemas.openxmlformats.org/officeDocument/2006/math",v:"urn:schemas-microsoft-com:vml",wp14:"http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing",wp:"http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing",w10:"urn:schemas-microsoft-com:office:word",w:"http://schemas.openxmlformats.org/wordprocessingml/2006/main",w14:"http://schemas.microsoft.com/office/word/2010/wordml",w15:"http://schemas.microsoft.com/office/word/2012/wordml",wpg:"http://schemas.microsoft.com/office/word/2010/wordprocessingGroup",wpi:"http://schemas.microsoft.com/office/word/2010/wordprocessingInk",wne:"http://schemas.microsoft.com/office/word/2006/wordml",wps:"http://schemas.microsoft.com/office/word/2010/wordprocessingShape",Ignorable:"w14 w15 wp14"}));const t=new $l({id:-1,type:fm.SEPERATOR,children:[new Fe({spacing:{after:0,line:240,lineRule:xc.AUTO},children:[new t_]})]});this.root.push(t);const s=new $l({id:0,type:fm.CONTINUATION_SEPERATOR,children:[new Fe({spacing:{after:0,line:240,lineRule:xc.AUTO},children:[new Zj]})]});this.root.push(s)}createFootNote(t,s){const n=new $l({id:t,children:s});this.root.push(n)}}class n_{constructor(){ve(this,"footnotess"),ve(this,"relationships"),this.footnotess=new s_,this.relationships=new zs}get View(){return this.footnotess}get Relationships(){return this.relationships}}class i_ extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{wpc:"xmlns:wpc",mc:"xmlns:mc",o:"xmlns:o",r:"xmlns:r",m:"xmlns:m",v:"xmlns:v",wp14:"xmlns:wp14",wp:"xmlns:wp",w10:"xmlns:w10",w:"xmlns:w",w14:"xmlns:w14",w15:"xmlns:w15",wpg:"xmlns:wpg",wpi:"xmlns:wpi",wne:"xmlns:wne",wps:"xmlns:wps",cp:"xmlns:cp",dc:"xmlns:dc",dcterms:"xmlns:dcterms",dcmitype:"xmlns:dcmitype",xsi:"xmlns:xsi",type:"xsi:type",cx:"xmlns:cx",cx1:"xmlns:cx1",cx2:"xmlns:cx2",cx3:"xmlns:cx3",cx4:"xmlns:cx4",cx5:"xmlns:cx5",cx6:"xmlns:cx6",cx7:"xmlns:cx7",cx8:"xmlns:cx8",w16cid:"xmlns:w16cid",w16se:"xmlns:w16se"})}}let a_=class extends Zf{constructor(t,s){super("w:hdr",s),ve(this,"refId"),this.refId=t,s||this.root.push(new i_({wpc:"http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas",mc:"http://schemas.openxmlformats.org/markup-compatibility/2006",o:"urn:schemas-microsoft-com:office:office",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",m:"http://schemas.openxmlformats.org/officeDocument/2006/math",v:"urn:schemas-microsoft-com:vml",wp14:"http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing",wp:"http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing",w10:"urn:schemas-microsoft-com:office:word",w:"http://schemas.openxmlformats.org/wordprocessingml/2006/main",w14:"http://schemas.microsoft.com/office/word/2010/wordml",w15:"http://schemas.microsoft.com/office/word/2012/wordml",wpg:"http://schemas.microsoft.com/office/word/2010/wordprocessingGroup",wpi:"http://schemas.microsoft.com/office/word/2010/wordprocessingInk",wne:"http://schemas.microsoft.com/office/word/2006/wordml",wps:"http://schemas.microsoft.com/office/word/2010/wordprocessingShape",cx:"http://schemas.microsoft.com/office/drawing/2014/chartex",cx1:"http://schemas.microsoft.com/office/drawing/2015/9/8/chartex",cx2:"http://schemas.microsoft.com/office/drawing/2015/10/21/chartex",cx3:"http://schemas.microsoft.com/office/drawing/2016/5/9/chartex",cx4:"http://schemas.microsoft.com/office/drawing/2016/5/10/chartex",cx5:"http://schemas.microsoft.com/office/drawing/2016/5/11/chartex",cx6:"http://schemas.microsoft.com/office/drawing/2016/5/12/chartex",cx7:"http://schemas.microsoft.com/office/drawing/2016/5/13/chartex",cx8:"http://schemas.microsoft.com/office/drawing/2016/5/14/chartex",w16cid:"http://schemas.microsoft.com/office/word/2016/wordml/cid",w16se:"http://schemas.microsoft.com/office/word/2015/wordml/symex"}))}get ReferenceId(){return this.refId}add(t){this.root.push(t)}};class o_{constructor(t,s,n){ve(this,"header"),ve(this,"relationships"),this.media=t,this.header=new a_(s,n),this.relationships=new zs}add(t){return this.header.add(t),this}addChildElement(t){this.header.addChildElement(t)}get View(){return this.header}get Relationships(){return this.relationships}get Media(){return this.media}}class l_{constructor(){ve(this,"map"),this.map=new Map}addImage(t,s){this.map.set(t,s)}get Array(){return Array.from(this.map.values())}}const Qr={BULLET:"bullet"};class c_ extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{ilvl:"w:ilvl",tentative:"w15:tentative"})}}class d_ extends _e{constructor(t){super("w:numFmt"),this.root.push(new vt({val:t}))}}class u_ extends _e{constructor(t){super("w:lvlText"),this.root.push(new vt({val:t}))}}class h_ extends _e{constructor(t){super("w:lvlJc"),this.root.push(new vt({val:t}))}}class m_ extends _e{constructor(t){super("w:suff"),this.root.push(new vt({val:t}))}}class p_ extends _e{constructor(){super("w:isLgl")}}class f_ extends _e{constructor({level:t,format:s,text:n,alignment:i=or.START,start:o=1,style:l,suffix:a,isLegalNumberingStyle:c}){if(super("w:lvl"),ve(this,"paragraphProperties"),ve(this,"runProperties"),this.root.push(new qn("w:start",er(o))),s&&this.root.push(new d_(s)),a&&this.root.push(new m_(a)),c&&this.root.push(new p_),n&&this.root.push(new u_(n)),this.root.push(new h_(i)),this.paragraphProperties=new fn(l&&l.paragraph),this.runProperties=new Bs(l&&l.run),this.root.push(this.paragraphProperties),this.root.push(this.runProperties),t>9)throw new Error("Level cannot be greater than 9. Read more here: https://answers.microsoft.com/en-us/msoffice/forum/all/does-word-support-more-than-9-list-levels/d130fdcd-1781-446d-8c84-c6c79124e4d7");this.root.push(new c_({ilvl:er(t),tentative:1}))}}class g_ extends f_{}class x_ extends _e{constructor(t){super("w:multiLevelType"),this.root.push(new vt({val:t}))}}class y_ extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{abstractNumId:"w:abstractNumId",restartNumberingAfterBreak:"w15:restartNumberingAfterBreak"})}}class gm extends _e{constructor(t,s){super("w:abstractNum"),ve(this,"id"),this.root.push(new y_({abstractNumId:er(t),restartNumberingAfterBreak:0})),this.root.push(new x_("hybridMultilevel")),this.id=t;for(const n of s)this.root.push(new g_(n))}}class b_ extends _e{constructor(t){super("w:abstractNumId"),this.root.push(new vt({val:t}))}}class v_ extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{numId:"w:numId"})}}class xm extends _e{constructor(t){if(super("w:num"),ve(this,"numId"),ve(this,"reference"),ve(this,"instance"),this.numId=t.numId,this.reference=t.reference,this.instance=t.instance,this.root.push(new v_({numId:er(t.numId)})),this.root.push(new b_(er(t.abstractNumId))),t.overrideLevels&&t.overrideLevels.length)for(const s of t.overrideLevels)this.root.push(new j_(s.num,s.start))}}class w_ extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{ilvl:"w:ilvl"})}}class j_ extends _e{constructor(t,s){super("w:lvlOverride"),this.root.push(new w_({ilvl:t})),s!==void 0&&this.root.push(new k_(s))}}class __ extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{val:"w:val"})}}class k_ extends _e{constructor(t){super("w:startOverride"),this.root.push(new __({val:t}))}}class N_ extends _e{constructor(t){super("w:numbering"),ve(this,"abstractNumberingMap",new Map),ve(this,"concreteNumberingMap",new Map),ve(this,"referenceConfigMap",new Map),ve(this,"abstractNumUniqueNumericId",hw()),ve(this,"concreteNumUniqueNumericId",mw()),this.root.push(new Fa(["wpc","mc","o","r","m","v","wp14","wp","w10","w","w14","w15","wpg","wpi","wne","wps"],"w14 w15 wp14"));const s=new gm(this.abstractNumUniqueNumericId(),[{level:0,format:Qr.BULLET,text:"â—",alignment:or.LEFT,style:{paragraph:{indent:{left:Nr(.5),hanging:Nr(.25)}}}},{level:1,format:Qr.BULLET,text:"â—‹",alignment:or.LEFT,style:{paragraph:{indent:{left:Nr(1),hanging:Nr(.25)}}}},{level:2,format:Qr.BULLET,text:"â– ",alignment:or.LEFT,style:{paragraph:{indent:{left:2160,hanging:Nr(.25)}}}},{level:3,format:Qr.BULLET,text:"â—",alignment:or.LEFT,style:{paragraph:{indent:{left:2880,hanging:Nr(.25)}}}},{level:4,format:Qr.BULLET,text:"â—‹",alignment:or.LEFT,style:{paragraph:{indent:{left:3600,hanging:Nr(.25)}}}},{level:5,format:Qr.BULLET,text:"â– ",alignment:or.LEFT,style:{paragraph:{indent:{left:4320,hanging:Nr(.25)}}}},{level:6,format:Qr.BULLET,text:"â—",alignment:or.LEFT,style:{paragraph:{indent:{left:5040,hanging:Nr(.25)}}}},{level:7,format:Qr.BULLET,text:"â—",alignment:or.LEFT,style:{paragraph:{indent:{left:5760,hanging:Nr(.25)}}}},{level:8,format:Qr.BULLET,text:"â—",alignment:or.LEFT,style:{paragraph:{indent:{left:6480,hanging:Nr(.25)}}}}]);this.concreteNumberingMap.set("default-bullet-numbering",new xm({numId:1,abstractNumId:s.id,reference:"default-bullet-numbering",instance:0,overrideLevels:[{num:0,start:1}]})),this.abstractNumberingMap.set("default-bullet-numbering",s);for(const n of t.config)this.abstractNumberingMap.set(n.reference,new gm(this.abstractNumUniqueNumericId(),n.levels)),this.referenceConfigMap.set(n.reference,n.levels)}prepForXml(t){for(const s of this.abstractNumberingMap.values())this.root.push(s);for(const s of this.concreteNumberingMap.values())this.root.push(s);return super.prepForXml(t)}createConcreteNumberingInstance(t,s){const n=this.abstractNumberingMap.get(t);if(!n)return;const i=`${t}-${s}`;if(this.concreteNumberingMap.has(i))return;const o=this.referenceConfigMap.get(t),l=o&&o[0].start,a={numId:this.concreteNumUniqueNumericId(),abstractNumId:n.id,reference:t,instance:s,overrideLevels:[l&&Number.isInteger(l)?{num:0,start:l}:{num:0,start:1}]};this.concreteNumberingMap.set(i,new xm(a))}get ConcreteNumbering(){return Array.from(this.concreteNumberingMap.values())}get ReferenceConfig(){return Array.from(this.referenceConfigMap.values())}}class S_ extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{version:"w:val",name:"w:name",uri:"w:uri"})}}class C_ extends _e{constructor(t){super("w:compatSetting"),this.root.push(new S_({version:t,uri:"http://schemas.microsoft.com/office/word",name:"compatibilityMode"}))}}class E_ extends _e{constructor(t){super("w:compat"),t.version&&this.root.push(new C_(t.version)),t.useSingleBorderforContiguousCells&&this.root.push(new Ne("w:useSingleBorderforContiguousCells",t.useSingleBorderforContiguousCells)),t.wordPerfectJustification&&this.root.push(new Ne("w:wpJustification",t.wordPerfectJustification)),t.noTabStopForHangingIndent&&this.root.push(new Ne("w:noTabHangInd",t.noTabStopForHangingIndent)),t.noLeading&&this.root.push(new Ne("w:noLeading",t.noLeading)),t.spaceForUnderline&&this.root.push(new Ne("w:spaceForUL",t.spaceForUnderline)),t.noColumnBalance&&this.root.push(new Ne("w:noColumnBalance",t.noColumnBalance)),t.balanceSingleByteDoubleByteWidth&&this.root.push(new Ne("w:balanceSingleByteDoubleByteWidth",t.balanceSingleByteDoubleByteWidth)),t.noExtraLineSpacing&&this.root.push(new Ne("w:noExtraLineSpacing",t.noExtraLineSpacing)),t.doNotLeaveBackslashAlone&&this.root.push(new Ne("w:doNotLeaveBackslashAlone",t.doNotLeaveBackslashAlone)),t.underlineTrailingSpaces&&this.root.push(new Ne("w:ulTrailSpace",t.underlineTrailingSpaces)),t.doNotExpandShiftReturn&&this.root.push(new Ne("w:doNotExpandShiftReturn",t.doNotExpandShiftReturn)),t.spacingInWholePoints&&this.root.push(new Ne("w:spacingInWholePoints",t.spacingInWholePoints)),t.lineWrapLikeWord6&&this.root.push(new Ne("w:lineWrapLikeWord6",t.lineWrapLikeWord6)),t.printBodyTextBeforeHeader&&this.root.push(new Ne("w:printBodyTextBeforeHeader",t.printBodyTextBeforeHeader)),t.printColorsBlack&&this.root.push(new Ne("w:printColBlack",t.printColorsBlack)),t.spaceWidth&&this.root.push(new Ne("w:wpSpaceWidth",t.spaceWidth)),t.showBreaksInFrames&&this.root.push(new Ne("w:showBreaksInFrames",t.showBreaksInFrames)),t.subFontBySize&&this.root.push(new Ne("w:subFontBySize",t.subFontBySize)),t.suppressBottomSpacing&&this.root.push(new Ne("w:suppressBottomSpacing",t.suppressBottomSpacing)),t.suppressTopSpacing&&this.root.push(new Ne("w:suppressTopSpacing",t.suppressTopSpacing)),t.suppressSpacingAtTopOfPage&&this.root.push(new Ne("w:suppressSpacingAtTopOfPage",t.suppressSpacingAtTopOfPage)),t.suppressTopSpacingWP&&this.root.push(new Ne("w:suppressTopSpacingWP",t.suppressTopSpacingWP)),t.suppressSpBfAfterPgBrk&&this.root.push(new Ne("w:suppressSpBfAfterPgBrk",t.suppressSpBfAfterPgBrk)),t.swapBordersFacingPages&&this.root.push(new Ne("w:swapBordersFacingPages",t.swapBordersFacingPages)),t.convertMailMergeEsc&&this.root.push(new Ne("w:convMailMergeEsc",t.convertMailMergeEsc)),t.truncateFontHeightsLikeWP6&&this.root.push(new Ne("w:truncateFontHeightsLikeWP6",t.truncateFontHeightsLikeWP6)),t.macWordSmallCaps&&this.root.push(new Ne("w:mwSmallCaps",t.macWordSmallCaps)),t.usePrinterMetrics&&this.root.push(new Ne("w:usePrinterMetrics",t.usePrinterMetrics)),t.doNotSuppressParagraphBorders&&this.root.push(new Ne("w:doNotSuppressParagraphBorders",t.doNotSuppressParagraphBorders)),t.wrapTrailSpaces&&this.root.push(new Ne("w:wrapTrailSpaces",t.wrapTrailSpaces)),t.footnoteLayoutLikeWW8&&this.root.push(new Ne("w:footnoteLayoutLikeWW8",t.footnoteLayoutLikeWW8)),t.shapeLayoutLikeWW8&&this.root.push(new Ne("w:shapeLayoutLikeWW8",t.shapeLayoutLikeWW8)),t.alignTablesRowByRow&&this.root.push(new Ne("w:alignTablesRowByRow",t.alignTablesRowByRow)),t.forgetLastTabAlignment&&this.root.push(new Ne("w:forgetLastTabAlignment",t.forgetLastTabAlignment)),t.adjustLineHeightInTable&&this.root.push(new Ne("w:adjustLineHeightInTable",t.adjustLineHeightInTable)),t.autoSpaceLikeWord95&&this.root.push(new Ne("w:autoSpaceLikeWord95",t.autoSpaceLikeWord95)),t.noSpaceRaiseLower&&this.root.push(new Ne("w:noSpaceRaiseLower",t.noSpaceRaiseLower)),t.doNotUseHTMLParagraphAutoSpacing&&this.root.push(new Ne("w:doNotUseHTMLParagraphAutoSpacing",t.doNotUseHTMLParagraphAutoSpacing)),t.layoutRawTableWidth&&this.root.push(new Ne("w:layoutRawTableWidth",t.layoutRawTableWidth)),t.layoutTableRowsApart&&this.root.push(new Ne("w:layoutTableRowsApart",t.layoutTableRowsApart)),t.useWord97LineBreakRules&&this.root.push(new Ne("w:useWord97LineBreakRules",t.useWord97LineBreakRules)),t.doNotBreakWrappedTables&&this.root.push(new Ne("w:doNotBreakWrappedTables",t.doNotBreakWrappedTables)),t.doNotSnapToGridInCell&&this.root.push(new Ne("w:doNotSnapToGridInCell",t.doNotSnapToGridInCell)),t.selectFieldWithFirstOrLastCharacter&&this.root.push(new Ne("w:selectFldWithFirstOrLastChar",t.selectFieldWithFirstOrLastCharacter)),t.applyBreakingRules&&this.root.push(new Ne("w:applyBreakingRules",t.applyBreakingRules)),t.doNotWrapTextWithPunctuation&&this.root.push(new Ne("w:doNotWrapTextWithPunct",t.doNotWrapTextWithPunctuation)),t.doNotUseEastAsianBreakRules&&this.root.push(new Ne("w:doNotUseEastAsianBreakRules",t.doNotUseEastAsianBreakRules)),t.useWord2002TableStyleRules&&this.root.push(new Ne("w:useWord2002TableStyleRules",t.useWord2002TableStyleRules)),t.growAutofit&&this.root.push(new Ne("w:growAutofit",t.growAutofit)),t.useFELayout&&this.root.push(new Ne("w:useFELayout",t.useFELayout)),t.useNormalStyleForList&&this.root.push(new Ne("w:useNormalStyleForList",t.useNormalStyleForList)),t.doNotUseIndentAsNumberingTabStop&&this.root.push(new Ne("w:doNotUseIndentAsNumberingTabStop",t.doNotUseIndentAsNumberingTabStop)),t.useAlternateEastAsianLineBreakRules&&this.root.push(new Ne("w:useAltKinsokuLineBreakRules",t.useAlternateEastAsianLineBreakRules)),t.allowSpaceOfSameStyleInTable&&this.root.push(new Ne("w:allowSpaceOfSameStyleInTable",t.allowSpaceOfSameStyleInTable)),t.doNotSuppressIndentation&&this.root.push(new Ne("w:doNotSuppressIndentation",t.doNotSuppressIndentation)),t.doNotAutofitConstrainedTables&&this.root.push(new Ne("w:doNotAutofitConstrainedTables",t.doNotAutofitConstrainedTables)),t.autofitToFirstFixedWidthCell&&this.root.push(new Ne("w:autofitToFirstFixedWidthCell",t.autofitToFirstFixedWidthCell)),t.underlineTabInNumberingList&&this.root.push(new Ne("w:underlineTabInNumList",t.underlineTabInNumberingList)),t.displayHangulFixedWidth&&this.root.push(new Ne("w:displayHangulFixedWidth",t.displayHangulFixedWidth)),t.splitPgBreakAndParaMark&&this.root.push(new Ne("w:splitPgBreakAndParaMark",t.splitPgBreakAndParaMark)),t.doNotVerticallyAlignCellWithSp&&this.root.push(new Ne("w:doNotVertAlignCellWithSp",t.doNotVerticallyAlignCellWithSp)),t.doNotBreakConstrainedForcedTable&&this.root.push(new Ne("w:doNotBreakConstrainedForcedTable",t.doNotBreakConstrainedForcedTable)),t.ignoreVerticalAlignmentInTextboxes&&this.root.push(new Ne("w:doNotVertAlignInTxbx",t.ignoreVerticalAlignmentInTextboxes)),t.useAnsiKerningPairs&&this.root.push(new Ne("w:useAnsiKerningPairs",t.useAnsiKerningPairs)),t.cachedColumnBalance&&this.root.push(new Ne("w:cachedColBalance",t.cachedColumnBalance))}}class A_ extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{wpc:"xmlns:wpc",mc:"xmlns:mc",o:"xmlns:o",r:"xmlns:r",m:"xmlns:m",v:"xmlns:v",wp14:"xmlns:wp14",wp:"xmlns:wp",w10:"xmlns:w10",w:"xmlns:w",w14:"xmlns:w14",w15:"xmlns:w15",wpg:"xmlns:wpg",wpi:"xmlns:wpi",wne:"xmlns:wne",wps:"xmlns:wps",Ignorable:"mc:Ignorable"})}}class T_ extends _e{constructor(t){var s,n,i,o,l,a,c,p;super("w:settings"),this.root.push(new A_({wpc:"http://schemas.microsoft.com/office/word/2010/wordprocessingCanvas",mc:"http://schemas.openxmlformats.org/markup-compatibility/2006",o:"urn:schemas-microsoft-com:office:office",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",m:"http://schemas.openxmlformats.org/officeDocument/2006/math",v:"urn:schemas-microsoft-com:vml",wp14:"http://schemas.microsoft.com/office/word/2010/wordprocessingDrawing",wp:"http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing",w10:"urn:schemas-microsoft-com:office:word",w:"http://schemas.openxmlformats.org/wordprocessingml/2006/main",w14:"http://schemas.microsoft.com/office/word/2010/wordml",w15:"http://schemas.microsoft.com/office/word/2012/wordml",wpg:"http://schemas.microsoft.com/office/word/2010/wordprocessingGroup",wpi:"http://schemas.microsoft.com/office/word/2010/wordprocessingInk",wne:"http://schemas.microsoft.com/office/word/2006/wordml",wps:"http://schemas.microsoft.com/office/word/2010/wordprocessingShape",Ignorable:"w14 w15 wp14"})),this.root.push(new Ne("w:displayBackgroundShape",!0)),t.trackRevisions!==void 0&&this.root.push(new Ne("w:trackRevisions",t.trackRevisions)),t.evenAndOddHeaders!==void 0&&this.root.push(new Ne("w:evenAndOddHeaders",t.evenAndOddHeaders)),t.updateFields!==void 0&&this.root.push(new Ne("w:updateFields",t.updateFields)),t.defaultTabStop!==void 0&&this.root.push(new qn("w:defaultTabStop",t.defaultTabStop)),((s=t.hyphenation)==null?void 0:s.autoHyphenation)!==void 0&&this.root.push(new Ne("w:autoHyphenation",t.hyphenation.autoHyphenation)),((n=t.hyphenation)==null?void 0:n.hyphenationZone)!==void 0&&this.root.push(new qn("w:hyphenationZone",t.hyphenation.hyphenationZone)),((i=t.hyphenation)==null?void 0:i.consecutiveHyphenLimit)!==void 0&&this.root.push(new qn("w:consecutiveHyphenLimit",t.hyphenation.consecutiveHyphenLimit)),((o=t.hyphenation)==null?void 0:o.doNotHyphenateCaps)!==void 0&&this.root.push(new Ne("w:doNotHyphenateCaps",t.hyphenation.doNotHyphenateCaps)),this.root.push(new E_(dn(Qe({},(l=t.compatibility)!=null?l:{}),{version:(p=(c=(a=t.compatibility)==null?void 0:a.version)!=null?c:t.compatibilityModeVersion)!=null?p:15})))}}class xg extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{val:"w:val"})}}class I_ extends _e{constructor(t){super("w:name"),this.root.push(new xg({val:t}))}}class R_ extends _e{constructor(t){super("w:uiPriority"),this.root.push(new xg({val:er(t)}))}}class O_ extends Ue{constructor(){super(...arguments),ve(this,"xmlKeys",{type:"w:type",styleId:"w:styleId",default:"w:default",customStyle:"w:customStyle"})}}class yg extends _e{constructor(t,s){super("w:style"),this.root.push(new O_(t)),s.name&&this.root.push(new I_(s.name)),s.basedOn&&this.root.push(new Ps("w:basedOn",s.basedOn)),s.next&&this.root.push(new Ps("w:next",s.next)),s.link&&this.root.push(new Ps("w:link",s.link)),s.uiPriority!==void 0&&this.root.push(new R_(s.uiPriority)),s.semiHidden!==void 0&&this.root.push(new Ne("w:semiHidden",s.semiHidden)),s.unhideWhenUsed!==void 0&&this.root.push(new Ne("w:unhideWhenUsed",s.unhideWhenUsed)),s.quickFormat!==void 0&&this.root.push(new Ne("w:qFormat",s.quickFormat))}}class Pa extends yg{constructor(t){super({type:"paragraph",styleId:t.id},t),ve(this,"paragraphProperties"),ve(this,"runProperties"),this.paragraphProperties=new fn(t.paragraph),this.runProperties=new Bs(t.run),this.root.push(this.paragraphProperties),this.root.push(this.runProperties)}}class La extends yg{constructor(t){super({type:"character",styleId:t.id},Qe({uiPriority:99,unhideWhenUsed:!0},t)),ve(this,"runProperties"),this.runProperties=new Bs(t.run),this.root.push(this.runProperties)}}class _s extends Pa{constructor(t){super(Qe({basedOn:"Normal",next:"Normal",quickFormat:!0},t))}}class F_ extends _s{constructor(t){super(Qe({id:"Title",name:"Title"},t))}}class P_ extends _s{constructor(t){super(Qe({id:"Heading1",name:"Heading 1"},t))}}class L_ extends _s{constructor(t){super(Qe({id:"Heading2",name:"Heading 2"},t))}}class D_ extends _s{constructor(t){super(Qe({id:"Heading3",name:"Heading 3"},t))}}class M_ extends _s{constructor(t){super(Qe({id:"Heading4",name:"Heading 4"},t))}}class $_ extends _s{constructor(t){super(Qe({id:"Heading5",name:"Heading 5"},t))}}class B_ extends _s{constructor(t){super(Qe({id:"Heading6",name:"Heading 6"},t))}}class z_ extends _s{constructor(t){super(Qe({id:"Strong",name:"Strong"},t))}}class U_ extends Pa{constructor(t){super(Qe({id:"ListParagraph",name:"List Paragraph",basedOn:"Normal",quickFormat:!0},t))}}class q_ extends Pa{constructor(t){super(Qe({id:"FootnoteText",name:"footnote text",link:"FootnoteTextChar",basedOn:"Normal",uiPriority:99,semiHidden:!0,unhideWhenUsed:!0,paragraph:{spacing:{after:0,line:240,lineRule:xc.AUTO}},run:{size:20}},t))}}class W_ extends La{constructor(t){super(Qe({id:"FootnoteReference",name:"footnote reference",basedOn:"DefaultParagraphFont",semiHidden:!0,run:{superScript:!0}},t))}}class H_ extends La{constructor(t){super(Qe({id:"FootnoteTextChar",name:"Footnote Text Char",basedOn:"DefaultParagraphFont",link:"FootnoteText",semiHidden:!0,run:{size:20}},t))}}class G_ extends La{constructor(t){super(Qe({id:"Hyperlink",name:"Hyperlink",basedOn:"DefaultParagraphFont",run:{color:"0563C1",underline:{type:ig.SINGLE}}},t))}}class bc extends _e{constructor(t){if(super("w:styles"),t.initialStyles&&this.root.push(t.initialStyles),t.importedStyles)for(const s of t.importedStyles)this.root.push(s);if(t.paragraphStyles)for(const s of t.paragraphStyles)this.root.push(new Pa(s));if(t.characterStyles)for(const s of t.characterStyles)this.root.push(new La(s))}}class V_ extends _e{constructor(t){super("w:pPrDefault"),this.root.push(new fn(t))}}class K_ extends _e{constructor(t){super("w:rPrDefault"),this.root.push(new Bs(t))}}class X_ extends _e{constructor(t){super("w:docDefaults"),ve(this,"runPropertiesDefaults"),ve(this,"paragraphPropertiesDefaults"),this.runPropertiesDefaults=new K_(t.run),this.paragraphPropertiesDefaults=new V_(t.paragraph),this.root.push(this.runPropertiesDefaults),this.root.push(this.paragraphPropertiesDefaults)}}class Y_{newInstance(t){const s=Qf.xml2js(t,{compact:!1});let n;for(const l of s.elements||[])l.name==="w:styles"&&(n=l);if(n===void 0)throw new Error("can not find styles element");const i=n.elements||[];return new bc({initialStyles:new Nv(n.attributes),importedStyles:i.map(l=>fd(l))})}}class ym{newInstance(t={}){var s;return{initialStyles:new Fa(["mc","r","w","w14","w15"],"w14 w15"),importedStyles:[new X_((s=t.document)!=null?s:{}),new F_(Qe({run:{size:56}},t.title)),new P_(Qe({run:{color:"2E74B5",size:32}},t.heading1)),new L_(Qe({run:{color:"2E74B5",size:26}},t.heading2)),new D_(Qe({run:{color:"1F4D78",size:24}},t.heading3)),new M_(Qe({run:{color:"2E74B5",italics:!0}},t.heading4)),new $_(Qe({run:{color:"2E74B5"}},t.heading5)),new B_(Qe({run:{color:"1F4D78"}},t.heading6)),new z_(Qe({run:{bold:!0}},t.strong)),new U_(t.listParagraph||{}),new G_(t.hyperlink||{}),new W_(t.footnoteReference||{}),new q_(t.footnoteText||{}),new H_(t.footnoteTextChar||{})]}}}let J_=class{constructor(t){ve(this,"currentRelationshipId",1),ve(this,"documentWrapper"),ve(this,"headers",[]),ve(this,"footers",[]),ve(this,"coreProperties"),ve(this,"numbering"),ve(this,"media"),ve(this,"fileRelationships"),ve(this,"footnotesWrapper"),ve(this,"settings"),ve(this,"contentTypes"),ve(this,"customProperties"),ve(this,"appProperties"),ve(this,"styles"),ve(this,"comments"),ve(this,"fontWrapper");var s,n,i,o,l,a,c,p,d,m,y,h;if(this.coreProperties=new Pj(dn(Qe({},t),{creator:(s=t.creator)!=null?s:"Un-named",revision:(n=t.revision)!=null?n:1,lastModifiedBy:(i=t.lastModifiedBy)!=null?i:"Un-named"})),this.numbering=new N_(t.numbering?t.numbering:{config:[]}),this.comments=new kw((o=t.comments)!=null?o:{children:[]}),this.fileRelationships=new zs,this.customProperties=new zj((l=t.customProperties)!=null?l:[]),this.appProperties=new Tj,this.footnotesWrapper=new n_,this.contentTypes=new Fj,this.documentWrapper=new ug({background:t.background}),this.settings=new T_({compatibilityModeVersion:t.compatabilityModeVersion,compatibility:t.compatibility,evenAndOddHeaders:!!t.evenAndOddHeaderAndFooters,trackRevisions:(a=t.features)==null?void 0:a.trackRevisions,updateFields:(c=t.features)==null?void 0:c.updateFields,defaultTabStop:t.defaultTabStop,hyphenation:{autoHyphenation:(p=t.hyphenation)==null?void 0:p.autoHyphenation,hyphenationZone:(d=t.hyphenation)==null?void 0:d.hyphenationZone,consecutiveHyphenLimit:(m=t.hyphenation)==null?void 0:m.consecutiveHyphenLimit,doNotHyphenateCaps:(y=t.hyphenation)==null?void 0:y.doNotHyphenateCaps}}),this.media=new l_,t.externalStyles!==void 0){const _=new Y_;this.styles=_.newInstance(t.externalStyles)}else if(t.styles){const b=new ym().newInstance(t.styles.default);this.styles=new bc(Qe(Qe({},b),t.styles))}else{const _=new ym;this.styles=new bc(_.newInstance())}this.addDefaultRelationships();for(const _ of t.sections)this.addSection(_);if(t.footnotes)for(const _ in t.footnotes)this.footnotesWrapper.View.createFootNote(parseFloat(_),t.footnotes[_].children);this.fontWrapper=new Hj((h=t.fonts)!=null?h:[])}addSection({headers:t={},footers:s={},children:n,properties:i}){this.documentWrapper.View.Body.addSection(dn(Qe({},i),{headerWrapperGroup:{default:t.default?this.createHeader(t.default):void 0,first:t.first?this.createHeader(t.first):void 0,even:t.even?this.createHeader(t.even):void 0},footerWrapperGroup:{default:s.default?this.createFooter(s.default):void 0,first:s.first?this.createFooter(s.first):void 0,even:s.even?this.createFooter(s.even):void 0}}));for(const o of n)this.documentWrapper.View.add(o)}createHeader(t){const s=new o_(this.media,this.currentRelationshipId++);for(const n of t.options.children)s.add(n);return this.addHeaderToDocument(s),s}createFooter(t){const s=new Kj(this.media,this.currentRelationshipId++);for(const n of t.options.children)s.add(n);return this.addFooterToDocument(s),s}addHeaderToDocument(t,s=an.DEFAULT){this.headers.push({header:t,type:s}),this.documentWrapper.Relationships.createRelationship(t.View.ReferenceId,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/header",`header${this.headers.length}.xml`),this.contentTypes.addHeader(this.headers.length)}addFooterToDocument(t,s=an.DEFAULT){this.footers.push({footer:t,type:s}),this.documentWrapper.Relationships.createRelationship(t.View.ReferenceId,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/footer",`footer${this.footers.length}.xml`),this.contentTypes.addFooter(this.footers.length)}addDefaultRelationships(){this.fileRelationships.createRelationship(1,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument","word/document.xml"),this.fileRelationships.createRelationship(2,"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties","docProps/core.xml"),this.fileRelationships.createRelationship(3,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties","docProps/app.xml"),this.fileRelationships.createRelationship(4,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties","docProps/custom.xml"),this.documentWrapper.Relationships.createRelationship(this.currentRelationshipId++,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles","styles.xml"),this.documentWrapper.Relationships.createRelationship(this.currentRelationshipId++,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/numbering","numbering.xml"),this.documentWrapper.Relationships.createRelationship(this.currentRelationshipId++,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/footnotes","footnotes.xml"),this.documentWrapper.Relationships.createRelationship(this.currentRelationshipId++,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/settings","settings.xml"),this.documentWrapper.Relationships.createRelationship(this.currentRelationshipId++,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments","comments.xml")}get Document(){return this.documentWrapper}get Styles(){return this.styles}get CoreProperties(){return this.coreProperties}get Numbering(){return this.numbering}get Media(){return this.media}get FileRelationships(){return this.fileRelationships}get Headers(){return this.headers.map(t=>t.header)}get Footers(){return this.footers.map(t=>t.footer)}get ContentTypes(){return this.contentTypes}get CustomProperties(){return this.customProperties}get AppProperties(){return this.appProperties}get FootNotes(){return this.footnotesWrapper}get Settings(){return this.settings}get Comments(){return this.comments}get FontTable(){return this.fontWrapper}};var Q_=hd();function Ti(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Bl={exports:{}},bm;function Z_(){return bm||(bm=1,(function(r,t){(function(s){r.exports=s()})(function(){return(function s(n,i,o){function l(p,d){if(!i[p]){if(!n[p]){var m=typeof Ti=="function"&&Ti;if(!d&&m)return m(p,!0);if(a)return a(p,!0);var y=new Error("Cannot find module '"+p+"'");throw y.code="MODULE_NOT_FOUND",y}var h=i[p]={exports:{}};n[p][0].call(h.exports,function(_){var b=n[p][1][_];return l(b||_)},h,h.exports,s,n,i,o)}return i[p].exports}for(var a=typeof Ti=="function"&&Ti,c=0;c<o.length;c++)l(o[c]);return l})({1:[function(s,n,i){var o=s("./utils"),l=s("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var p,d,m,y,h,_,b,N=[],u=0,v=c.length,g=v,w=o.getTypeOf(c)!=="string";u<c.length;)g=v-u,m=w?(p=c[u++],d=u<v?c[u++]:0,u<v?c[u++]:0):(p=c.charCodeAt(u++),d=u<v?c.charCodeAt(u++):0,u<v?c.charCodeAt(u++):0),y=p>>2,h=(3&p)<<4|d>>4,_=1<g?(15&d)<<2|m>>6:64,b=2<g?63&m:64,N.push(a.charAt(y)+a.charAt(h)+a.charAt(_)+a.charAt(b));return N.join("")},i.decode=function(c){var p,d,m,y,h,_,b=0,N=0,u="data:";if(c.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");var v,g=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&g--,c.charAt(c.length-2)===a.charAt(64)&&g--,g%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=l.uint8array?new Uint8Array(0|g):new Array(0|g);b<c.length;)p=a.indexOf(c.charAt(b++))<<2|(y=a.indexOf(c.charAt(b++)))>>4,d=(15&y)<<4|(h=a.indexOf(c.charAt(b++)))>>2,m=(3&h)<<6|(_=a.indexOf(c.charAt(b++))),v[N++]=p,h!==64&&(v[N++]=d),_!==64&&(v[N++]=m);return v}},{"./support":30,"./utils":32}],2:[function(s,n,i){var o=s("./external"),l=s("./stream/DataWorker"),a=s("./stream/Crc32Probe"),c=s("./stream/DataLengthProbe");function p(d,m,y,h,_){this.compressedSize=d,this.uncompressedSize=m,this.crc32=y,this.compression=h,this.compressedContent=_}p.prototype={getContentWorker:function(){var d=new l(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),m=this;return d.on("end",function(){if(this.streamInfo.data_length!==m.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),d},getCompressedWorker:function(){return new l(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},p.createWorkerFrom=function(d,m,y){return d.pipe(new a).pipe(new c("uncompressedSize")).pipe(m.compressWorker(y)).pipe(new c("compressedSize")).withStreamInfo("compression",m)},n.exports=p},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(s,n,i){var o=s("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},i.DEFLATE=s("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(s,n,i){var o=s("./utils"),l=(function(){for(var a,c=[],p=0;p<256;p++){a=p;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;c[p]=a}return c})();n.exports=function(a,c){return a!==void 0&&a.length?o.getTypeOf(a)!=="string"?(function(p,d,m,y){var h=l,_=y+m;p^=-1;for(var b=y;b<_;b++)p=p>>>8^h[255&(p^d[b])];return-1^p})(0|c,a,a.length,0):(function(p,d,m,y){var h=l,_=y+m;p^=-1;for(var b=y;b<_;b++)p=p>>>8^h[255&(p^d.charCodeAt(b))];return-1^p})(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(s,n,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(s,n,i){var o=null;o=typeof Promise<"u"?Promise:s("lie"),n.exports={Promise:o}},{lie:37}],7:[function(s,n,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=s("pako"),a=s("./utils"),c=s("./stream/GenericWorker"),p=o?"uint8array":"array";function d(m,y){c.call(this,"FlateWorker/"+m),this._pako=null,this._pakoAction=m,this._pakoOptions=y,this.meta={}}i.magic="\b\0",a.inherits(d,c),d.prototype.processChunk=function(m){this.meta=m.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(p,m.data),!1)},d.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},d.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},d.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var m=this;this._pako.onData=function(y){m.push({data:y,meta:m.meta})}},i.compressWorker=function(m){return new d("Deflate",m)},i.uncompressWorker=function(){return new d("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(s,n,i){function o(h,_){var b,N="";for(b=0;b<_;b++)N+=String.fromCharCode(255&h),h>>>=8;return N}function l(h,_,b,N,u,v){var g,w,k=h.file,A=h.compression,T=v!==p.utf8encode,z=a.transformTo("string",v(k.name)),S=a.transformTo("string",p.utf8encode(k.name)),U=k.comment,G=a.transformTo("string",v(U)),F=a.transformTo("string",p.utf8encode(U)),C=S.length!==k.name.length,j=F.length!==U.length,D="",J="",q="",W=k.dir,$=k.date,ne={crc32:0,compressedSize:0,uncompressedSize:0};_&&!b||(ne.crc32=h.crc32,ne.compressedSize=h.compressedSize,ne.uncompressedSize=h.uncompressedSize);var K=0;_&&(K|=8),T||!C&&!j||(K|=2048);var P=0,Y=0;W&&(P|=16),u==="UNIX"?(Y=798,P|=(function(le,se){var R=le;return le||(R=se?16893:33204),(65535&R)<<16})(k.unixPermissions,W)):(Y=20,P|=(function(le){return 63&(le||0)})(k.dosPermissions)),g=$.getUTCHours(),g<<=6,g|=$.getUTCMinutes(),g<<=5,g|=$.getUTCSeconds()/2,w=$.getUTCFullYear()-1980,w<<=4,w|=$.getUTCMonth()+1,w<<=5,w|=$.getUTCDate(),C&&(J=o(1,1)+o(d(z),4)+S,D+="up"+o(J.length,2)+J),j&&(q=o(1,1)+o(d(G),4)+F,D+="uc"+o(q.length,2)+q);var re="";return re+=`
\0`,re+=o(K,2),re+=A.magic,re+=o(g,2),re+=o(w,2),re+=o(ne.crc32,4),re+=o(ne.compressedSize,4),re+=o(ne.uncompressedSize,4),re+=o(z.length,2),re+=o(D.length,2),{fileRecord:m.LOCAL_FILE_HEADER+re+z+D,dirRecord:m.CENTRAL_FILE_HEADER+o(Y,2)+re+o(G.length,2)+"\0\0\0\0"+o(P,4)+o(N,4)+z+D+G}}var a=s("../utils"),c=s("../stream/GenericWorker"),p=s("../utf8"),d=s("../crc32"),m=s("../signature");function y(h,_,b,N){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=_,this.zipPlatform=b,this.encodeFileName=N,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(y,c),y.prototype.push=function(h){var _=h.meta.percent||0,b=this.entriesCount,N=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,c.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:b?(_+100*(b-N-1))/b:100}}))},y.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var _=this.streamFiles&&!h.file.dir;if(_){var b=l(h,_,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:b.fileRecord,meta:{percent:0}})}else this.accumulate=!0},y.prototype.closedSource=function(h){this.accumulate=!1;var _=this.streamFiles&&!h.file.dir,b=l(h,_,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(b.dirRecord),_)this.push({data:(function(N){return m.DATA_DESCRIPTOR+o(N.crc32,4)+o(N.compressedSize,4)+o(N.uncompressedSize,4)})(h),meta:{percent:100}});else for(this.push({data:b.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},y.prototype.flush=function(){for(var h=this.bytesWritten,_=0;_<this.dirRecords.length;_++)this.push({data:this.dirRecords[_],meta:{percent:100}});var b=this.bytesWritten-h,N=(function(u,v,g,w,k){var A=a.transformTo("string",k(w));return m.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(u,2)+o(u,2)+o(v,4)+o(g,4)+o(A.length,2)+A})(this.dirRecords.length,b,h,this.zipComment,this.encodeFileName);this.push({data:N,meta:{percent:100}})},y.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},y.prototype.registerPrevious=function(h){this._sources.push(h);var _=this;return h.on("data",function(b){_.processChunk(b)}),h.on("end",function(){_.closedSource(_.previous.streamInfo),_._sources.length?_.prepareNextSource():_.end()}),h.on("error",function(b){_.error(b)}),this},y.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},y.prototype.error=function(h){var _=this._sources;if(!c.prototype.error.call(this,h))return!1;for(var b=0;b<_.length;b++)try{_[b].error(h)}catch{}return!0},y.prototype.lock=function(){c.prototype.lock.call(this);for(var h=this._sources,_=0;_<h.length;_++)h[_].lock()},n.exports=y},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(s,n,i){var o=s("../compressions"),l=s("./ZipFileWorker");i.generateWorker=function(a,c,p){var d=new l(c.streamFiles,p,c.platform,c.encodeFileName),m=0;try{a.forEach(function(y,h){m++;var _=(function(v,g){var w=v||g,k=o[w];if(!k)throw new Error(w+" is not a valid compression method !");return k})(h.options.compression,c.compression),b=h.options.compressionOptions||c.compressionOptions||{},N=h.dir,u=h.date;h._compressWorker(_,b).withStreamInfo("file",{name:y,dir:N,date:u,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(d)}),d.entriesCount=m}catch(y){d.error(y)}return d}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(s,n,i){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new o;for(var a in this)typeof this[a]!="function"&&(l[a]=this[a]);return l}}(o.prototype=s("./object")).loadAsync=s("./load"),o.support=s("./support"),o.defaults=s("./defaults"),o.version="3.10.1",o.loadAsync=function(l,a){return new o().loadAsync(l,a)},o.external=s("./external"),n.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(s,n,i){var o=s("./utils"),l=s("./external"),a=s("./utf8"),c=s("./zipEntries"),p=s("./stream/Crc32Probe"),d=s("./nodejsUtils");function m(y){return new l.Promise(function(h,_){var b=y.decompressed.getContentWorker().pipe(new p);b.on("error",function(N){_(N)}).on("end",function(){b.streamInfo.crc32!==y.decompressed.crc32?_(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}n.exports=function(y,h){var _=this;return h=o.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),d.isNode&&d.isStream(y)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",y,!0,h.optimizedBinaryString,h.base64).then(function(b){var N=new c(h);return N.load(b),N}).then(function(b){var N=[l.Promise.resolve(b)],u=b.files;if(h.checkCRC32)for(var v=0;v<u.length;v++)N.push(m(u[v]));return l.Promise.all(N)}).then(function(b){for(var N=b.shift(),u=N.files,v=0;v<u.length;v++){var g=u[v],w=g.fileNameStr,k=o.resolve(g.fileNameStr);_.file(k,g.decompressed,{binary:!0,optimizedBinaryString:!0,date:g.date,dir:g.dir,comment:g.fileCommentStr.length?g.fileCommentStr:null,unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions,createFolders:h.createFolders}),g.dir||(_.file(k).unsafeOriginalName=w)}return N.zipComment.length&&(_.comment=N.zipComment),_})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(s,n,i){var o=s("../utils"),l=s("../stream/GenericWorker");function a(c,p){l.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(p)}o.inherits(a,l),a.prototype._bindStream=function(c){var p=this;(this._stream=c).pause(),c.on("data",function(d){p.push({data:d,meta:{percent:0}})}).on("error",function(d){p.isPaused?this.generatedError=d:p.error(d)}).on("end",function(){p.isPaused?p._upstreamEnded=!0:p.end()})},a.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(s,n,i){var o=s("readable-stream").Readable;function l(a,c,p){o.call(this,c),this._helper=a;var d=this;a.on("data",function(m,y){d.push(m)||d._helper.pause(),p&&p(y)}).on("error",function(m){d.emit("error",m)}).on("end",function(){d.push(null)})}s("../utils").inherits(l,o),l.prototype._read=function(){this._helper.resume()},n.exports=l},{"../utils":32,"readable-stream":16}],14:[function(s,n,i){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,l);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,l)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var l=new Buffer(o);return l.fill(0),l},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(s,n,i){function o(k,A,T){var z,S=a.getTypeOf(A),U=a.extend(T||{},d);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(k=u(k)),U.createFolders&&(z=N(k))&&v.call(this,z,!0);var G=S==="string"&&U.binary===!1&&U.base64===!1;T&&T.binary!==void 0||(U.binary=!G),(A instanceof m&&A.uncompressedSize===0||U.dir||!A||A.length===0)&&(U.base64=!1,U.binary=!0,A="",U.compression="STORE",S="string");var F=null;F=A instanceof m||A instanceof c?A:_.isNode&&_.isStream(A)?new b(k,A):a.prepareContent(k,A,U.binary,U.optimizedBinaryString,U.base64);var C=new y(k,F,U);this.files[k]=C}var l=s("./utf8"),a=s("./utils"),c=s("./stream/GenericWorker"),p=s("./stream/StreamHelper"),d=s("./defaults"),m=s("./compressedObject"),y=s("./zipObject"),h=s("./generate"),_=s("./nodejsUtils"),b=s("./nodejs/NodejsStreamInputAdapter"),N=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var A=k.lastIndexOf("/");return 0<A?k.substring(0,A):""},u=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},v=function(k,A){return A=A!==void 0?A:d.createFolders,k=u(k),this.files[k]||o.call(this,k,null,{dir:!0,createFolders:A}),this.files[k]};function g(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var w={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var A,T,z;for(A in this.files)z=this.files[A],(T=A.slice(this.root.length,A.length))&&A.slice(0,this.root.length)===this.root&&k(T,z)},filter:function(k){var A=[];return this.forEach(function(T,z){k(T,z)&&A.push(z)}),A},file:function(k,A,T){if(arguments.length!==1)return k=this.root+k,o.call(this,k,A,T),this;if(g(k)){var z=k;return this.filter(function(U,G){return!G.dir&&z.test(U)})}var S=this.files[this.root+k];return S&&!S.dir?S:null},folder:function(k){if(!k)return this;if(g(k))return this.filter(function(S,U){return U.dir&&k.test(S)});var A=this.root+k,T=v.call(this,A),z=this.clone();return z.root=T.name,z},remove:function(k){k=this.root+k;var A=this.files[k];if(A||(k.slice(-1)!=="/"&&(k+="/"),A=this.files[k]),A&&!A.dir)delete this.files[k];else for(var T=this.filter(function(S,U){return U.name.slice(0,k.length)===k}),z=0;z<T.length;z++)delete this.files[T[z].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var A,T={};try{if((T=a.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=T.type.toLowerCase(),T.compression=T.compression.toUpperCase(),T.type==="binarystring"&&(T.type="string"),!T.type)throw new Error("No output type specified.");a.checkSupport(T.type),T.platform!=="darwin"&&T.platform!=="freebsd"&&T.platform!=="linux"&&T.platform!=="sunos"||(T.platform="UNIX"),T.platform==="win32"&&(T.platform="DOS");var z=T.comment||this.comment||"";A=h.generateWorker(this,T,z)}catch(S){(A=new c("error")).error(S)}return new p(A,T.type||"string",T.mimeType)},generateAsync:function(k,A){return this.generateInternalStream(k).accumulate(A)},generateNodeStream:function(k,A){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(A)}};n.exports=w},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(s,n,i){n.exports=s("stream")},{stream:void 0}],17:[function(s,n,i){var o=s("./DataReader");function l(a){o.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}s("../utils").inherits(l,o),l.prototype.byteAt=function(a){return this.data[this.zero+a]},l.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),p=a.charCodeAt(1),d=a.charCodeAt(2),m=a.charCodeAt(3),y=this.length-4;0<=y;--y)if(this.data[y]===c&&this.data[y+1]===p&&this.data[y+2]===d&&this.data[y+3]===m)return y-this.zero;return-1},l.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),p=a.charCodeAt(1),d=a.charCodeAt(2),m=a.charCodeAt(3),y=this.readData(4);return c===y[0]&&p===y[1]&&d===y[2]&&m===y[3]},l.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=l},{"../utils":32,"./DataReader":18}],18:[function(s,n,i){var o=s("../utils");function l(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,p=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)p=(p<<8)+this.byteAt(c);return this.index+=a,p},readString:function(a){return o.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},n.exports=l},{"../utils":32}],19:[function(s,n,i){var o=s("./Uint8ArrayReader");function l(a){o.call(this,a)}s("../utils").inherits(l,o),l.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(s,n,i){var o=s("./DataReader");function l(a){o.call(this,a)}s("../utils").inherits(l,o),l.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},l.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},l.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},l.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=l},{"../utils":32,"./DataReader":18}],21:[function(s,n,i){var o=s("./ArrayReader");function l(a){o.call(this,a)}s("../utils").inherits(l,o),l.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},n.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(s,n,i){var o=s("../utils"),l=s("../support"),a=s("./ArrayReader"),c=s("./StringReader"),p=s("./NodeBufferReader"),d=s("./Uint8ArrayReader");n.exports=function(m){var y=o.getTypeOf(m);return o.checkSupport(y),y!=="string"||l.uint8array?y==="nodebuffer"?new p(m):l.uint8array?new d(o.transformTo("uint8array",m)):new a(o.transformTo("array",m)):new c(m)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(s,n,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(s,n,i){var o=s("./GenericWorker"),l=s("../utils");function a(c){o.call(this,"ConvertWorker to "+c),this.destType=c}l.inherits(a,o),a.prototype.processChunk=function(c){this.push({data:l.transformTo(this.destType,c.data),meta:c.meta})},n.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(s,n,i){var o=s("./GenericWorker"),l=s("../crc32");function a(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}s("../utils").inherits(a,o),a.prototype.processChunk=function(c){this.streamInfo.crc32=l(c.data,this.streamInfo.crc32||0),this.push(c)},n.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(s,n,i){var o=s("../utils"),l=s("./GenericWorker");function a(c){l.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}o.inherits(a,l),a.prototype.processChunk=function(c){if(c){var p=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=p+c.data.length}l.prototype.processChunk.call(this,c)},n.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(s,n,i){var o=s("../utils"),l=s("./GenericWorker");function a(c){l.call(this,"DataWorker");var p=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(d){p.dataIsReady=!0,p.data=d,p.max=d&&d.length||0,p.type=o.getTypeOf(d),p.isPaused||p._tickAndRepeat()},function(d){p.error(d)})}o.inherits(a,l),a.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,p=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,p);break;case"uint8array":c=this.data.subarray(this.index,p);break;case"array":case"nodebuffer":c=this.data.slice(this.index,p)}return this.index=p,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(s,n,i){function o(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,a){return this._listeners[l].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,a){if(this._listeners[l])for(var c=0;c<this._listeners[l].length;c++)this._listeners[l][c].call(this,a)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var a=this;return l.on("data",function(c){a.processChunk(c)}),l.on("end",function(){a.end()}),l.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,a){return this.extraStreamInfo[l]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},n.exports=o},{}],29:[function(s,n,i){var o=s("../utils"),l=s("./ConvertWorker"),a=s("./GenericWorker"),c=s("../base64"),p=s("../support"),d=s("../external"),m=null;if(p.nodestream)try{m=s("../nodejs/NodejsStreamOutputAdapter")}catch{}function y(_,b){return new d.Promise(function(N,u){var v=[],g=_._internalType,w=_._outputType,k=_._mimeType;_.on("data",function(A,T){v.push(A),b&&b(T)}).on("error",function(A){v=[],u(A)}).on("end",function(){try{var A=(function(T,z,S){switch(T){case"blob":return o.newBlob(o.transformTo("arraybuffer",z),S);case"base64":return c.encode(z);default:return o.transformTo(T,z)}})(w,(function(T,z){var S,U=0,G=null,F=0;for(S=0;S<z.length;S++)F+=z[S].length;switch(T){case"string":return z.join("");case"array":return Array.prototype.concat.apply([],z);case"uint8array":for(G=new Uint8Array(F),S=0;S<z.length;S++)G.set(z[S],U),U+=z[S].length;return G;case"nodebuffer":return Buffer.concat(z);default:throw new Error("concat : unsupported type '"+T+"'")}})(g,v),k);N(A)}catch(T){u(T)}v=[]}).resume()})}function h(_,b,N){var u=b;switch(b){case"blob":case"arraybuffer":u="uint8array";break;case"base64":u="string"}try{this._internalType=u,this._outputType=b,this._mimeType=N,o.checkSupport(u),this._worker=_.pipe(new l(u)),_.lock()}catch(v){this._worker=new a("error"),this._worker.error(v)}}h.prototype={accumulate:function(_){return y(this,_)},on:function(_,b){var N=this;return _==="data"?this._worker.on(_,function(u){b.call(N,u.data,u.meta)}):this._worker.on(_,function(){o.delay(b,arguments,N)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(_){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new m(this,{objectMode:this._outputType!=="nodebuffer"},_)}},n.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(s,n,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var o=new ArrayBuffer(0);try{i.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(o),i.blob=l.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!s("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(s,n,i){for(var o=s("./utils"),l=s("./support"),a=s("./nodejsUtils"),c=s("./stream/GenericWorker"),p=new Array(256),d=0;d<256;d++)p[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;p[254]=p[254]=1;function m(){c.call(this,"utf-8 decode"),this.leftOver=null}function y(){c.call(this,"utf-8 encode")}i.utf8encode=function(h){return l.nodebuffer?a.newBufferFrom(h,"utf-8"):(function(_){var b,N,u,v,g,w=_.length,k=0;for(v=0;v<w;v++)(64512&(N=_.charCodeAt(v)))==55296&&v+1<w&&(64512&(u=_.charCodeAt(v+1)))==56320&&(N=65536+(N-55296<<10)+(u-56320),v++),k+=N<128?1:N<2048?2:N<65536?3:4;for(b=l.uint8array?new Uint8Array(k):new Array(k),v=g=0;g<k;v++)(64512&(N=_.charCodeAt(v)))==55296&&v+1<w&&(64512&(u=_.charCodeAt(v+1)))==56320&&(N=65536+(N-55296<<10)+(u-56320),v++),N<128?b[g++]=N:(N<2048?b[g++]=192|N>>>6:(N<65536?b[g++]=224|N>>>12:(b[g++]=240|N>>>18,b[g++]=128|N>>>12&63),b[g++]=128|N>>>6&63),b[g++]=128|63&N);return b})(h)},i.utf8decode=function(h){return l.nodebuffer?o.transformTo("nodebuffer",h).toString("utf-8"):(function(_){var b,N,u,v,g=_.length,w=new Array(2*g);for(b=N=0;b<g;)if((u=_[b++])<128)w[N++]=u;else if(4<(v=p[u]))w[N++]=65533,b+=v-1;else{for(u&=v===2?31:v===3?15:7;1<v&&b<g;)u=u<<6|63&_[b++],v--;1<v?w[N++]=65533:u<65536?w[N++]=u:(u-=65536,w[N++]=55296|u>>10&1023,w[N++]=56320|1023&u)}return w.length!==N&&(w.subarray?w=w.subarray(0,N):w.length=N),o.applyFromCharCode(w)})(h=o.transformTo(l.uint8array?"uint8array":"array",h))},o.inherits(m,c),m.prototype.processChunk=function(h){var _=o.transformTo(l.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var b=_;(_=new Uint8Array(b.length+this.leftOver.length)).set(this.leftOver,0),_.set(b,this.leftOver.length)}else _=this.leftOver.concat(_);this.leftOver=null}var N=(function(v,g){var w;for((g=g||v.length)>v.length&&(g=v.length),w=g-1;0<=w&&(192&v[w])==128;)w--;return w<0||w===0?g:w+p[v[w]]>g?w:g})(_),u=_;N!==_.length&&(l.uint8array?(u=_.subarray(0,N),this.leftOver=_.subarray(N,_.length)):(u=_.slice(0,N),this.leftOver=_.slice(N,_.length))),this.push({data:i.utf8decode(u),meta:h.meta})},m.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=m,o.inherits(y,c),y.prototype.processChunk=function(h){this.push({data:i.utf8encode(h.data),meta:h.meta})},i.Utf8EncodeWorker=y},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(s,n,i){var o=s("./support"),l=s("./base64"),a=s("./nodejsUtils"),c=s("./external");function p(b){return b}function d(b,N){for(var u=0;u<b.length;++u)N[u]=255&b.charCodeAt(u);return N}s("setimmediate"),i.newBlob=function(b,N){i.checkSupport("blob");try{return new Blob([b],{type:N})}catch{try{var u=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return u.append(b),u.getBlob(N)}catch{throw new Error("Bug : can't construct the Blob.")}}};var m={stringifyByChunk:function(b,N,u){var v=[],g=0,w=b.length;if(w<=u)return String.fromCharCode.apply(null,b);for(;g<w;)N==="array"||N==="nodebuffer"?v.push(String.fromCharCode.apply(null,b.slice(g,Math.min(g+u,w)))):v.push(String.fromCharCode.apply(null,b.subarray(g,Math.min(g+u,w)))),g+=u;return v.join("")},stringifyByChar:function(b){for(var N="",u=0;u<b.length;u++)N+=String.fromCharCode(b[u]);return N},applyCanBeUsed:{uint8array:(function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function y(b){var N=65536,u=i.getTypeOf(b),v=!0;if(u==="uint8array"?v=m.applyCanBeUsed.uint8array:u==="nodebuffer"&&(v=m.applyCanBeUsed.nodebuffer),v)for(;1<N;)try{return m.stringifyByChunk(b,u,N)}catch{N=Math.floor(N/2)}return m.stringifyByChar(b)}function h(b,N){for(var u=0;u<b.length;u++)N[u]=b[u];return N}i.applyFromCharCode=y;var _={};_.string={string:p,array:function(b){return d(b,new Array(b.length))},arraybuffer:function(b){return _.string.uint8array(b).buffer},uint8array:function(b){return d(b,new Uint8Array(b.length))},nodebuffer:function(b){return d(b,a.allocBuffer(b.length))}},_.array={string:y,array:p,arraybuffer:function(b){return new Uint8Array(b).buffer},uint8array:function(b){return new Uint8Array(b)},nodebuffer:function(b){return a.newBufferFrom(b)}},_.arraybuffer={string:function(b){return y(new Uint8Array(b))},array:function(b){return h(new Uint8Array(b),new Array(b.byteLength))},arraybuffer:p,uint8array:function(b){return new Uint8Array(b)},nodebuffer:function(b){return a.newBufferFrom(new Uint8Array(b))}},_.uint8array={string:y,array:function(b){return h(b,new Array(b.length))},arraybuffer:function(b){return b.buffer},uint8array:p,nodebuffer:function(b){return a.newBufferFrom(b)}},_.nodebuffer={string:y,array:function(b){return h(b,new Array(b.length))},arraybuffer:function(b){return _.nodebuffer.uint8array(b).buffer},uint8array:function(b){return h(b,new Uint8Array(b.length))},nodebuffer:p},i.transformTo=function(b,N){if(N=N||"",!b)return N;i.checkSupport(b);var u=i.getTypeOf(N);return _[u][b](N)},i.resolve=function(b){for(var N=b.split("/"),u=[],v=0;v<N.length;v++){var g=N[v];g==="."||g===""&&v!==0&&v!==N.length-1||(g===".."?u.pop():u.push(g))}return u.join("/")},i.getTypeOf=function(b){return typeof b=="string"?"string":Object.prototype.toString.call(b)==="[object Array]"?"array":o.nodebuffer&&a.isBuffer(b)?"nodebuffer":o.uint8array&&b instanceof Uint8Array?"uint8array":o.arraybuffer&&b instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(b){if(!o[b.toLowerCase()])throw new Error(b+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(b){var N,u,v="";for(u=0;u<(b||"").length;u++)v+="\\x"+((N=b.charCodeAt(u))<16?"0":"")+N.toString(16).toUpperCase();return v},i.delay=function(b,N,u){setImmediate(function(){b.apply(u||null,N||[])})},i.inherits=function(b,N){function u(){}u.prototype=N.prototype,b.prototype=new u},i.extend=function(){var b,N,u={};for(b=0;b<arguments.length;b++)for(N in arguments[b])Object.prototype.hasOwnProperty.call(arguments[b],N)&&u[N]===void 0&&(u[N]=arguments[b][N]);return u},i.prepareContent=function(b,N,u,v,g){return c.Promise.resolve(N).then(function(w){return o.blob&&(w instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(w))!==-1)&&typeof FileReader<"u"?new c.Promise(function(k,A){var T=new FileReader;T.onload=function(z){k(z.target.result)},T.onerror=function(z){A(z.target.error)},T.readAsArrayBuffer(w)}):w}).then(function(w){var k=i.getTypeOf(w);return k?(k==="arraybuffer"?w=i.transformTo("uint8array",w):k==="string"&&(g?w=l.decode(w):u&&v!==!0&&(w=(function(A){return d(A,o.uint8array?new Uint8Array(A.length):new Array(A.length))})(w))),w):c.Promise.reject(new Error("Can't read the data of '"+b+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(s,n,i){var o=s("./reader/readerFor"),l=s("./utils"),a=s("./signature"),c=s("./zipEntry"),p=s("./support");function d(m){this.files=[],this.loadOptions=m}d.prototype={checkSignature:function(m){if(!this.reader.readAndCheckSignature(m)){this.reader.index-=4;var y=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(y)+", expected "+l.pretty(m)+")")}},isSignature:function(m,y){var h=this.reader.index;this.reader.setIndex(m);var _=this.reader.readString(4)===y;return this.reader.setIndex(h),_},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var m=this.reader.readData(this.zipCommentLength),y=p.uint8array?"uint8array":"array",h=l.transformTo(y,m);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var m,y,h,_=this.zip64EndOfCentralSize-44;0<_;)m=this.reader.readInt(2),y=this.reader.readInt(4),h=this.reader.readData(y),this.zip64ExtensibleData[m]={id:m,length:y,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var m,y;for(m=0;m<this.files.length;m++)y=this.files[m],this.reader.setIndex(y.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),y.readLocalPart(this.reader),y.handleUTF8(),y.processAttributes()},readCentralDir:function(){var m;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(m=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(m);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var m=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(m<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(m);var y=m;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(m=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(m),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var _=y-h;if(0<_)this.isSignature(y,a.CENTRAL_FILE_HEADER)||(this.reader.zero=_);else if(_<0)throw new Error("Corrupted zip: missing "+Math.abs(_)+" bytes.")},prepareReader:function(m){this.reader=o(m)},load:function(m){this.prepareReader(m),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=d},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(s,n,i){var o=s("./reader/readerFor"),l=s("./utils"),a=s("./compressedObject"),c=s("./crc32"),p=s("./utf8"),d=s("./compressions"),m=s("./support");function y(h,_){this.options=h,this.loadOptions=_}y.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var _,b;if(h.skip(22),this.fileNameLength=h.readInt(2),b=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(b),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((_=(function(N){for(var u in d)if(Object.prototype.hasOwnProperty.call(d,u)&&d[u].magic===N)return d[u];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,_,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var _=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(_),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=o(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var _,b,N,u=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<u;)_=h.readInt(2),b=h.readInt(2),N=h.readData(b),this.extraFields[_]={id:_,length:b,value:N};h.setIndex(u)},handleUTF8:function(){var h=m.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=p.utf8decode(this.fileName),this.fileCommentStr=p.utf8decode(this.fileComment);else{var _=this.findExtraFieldUnicodePath();if(_!==null)this.fileNameStr=_;else{var b=l.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(b)}var N=this.findExtraFieldUnicodeComment();if(N!==null)this.fileCommentStr=N;else{var u=l.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(u)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var _=o(h.value);return _.readInt(1)!==1||c(this.fileName)!==_.readInt(4)?null:p.utf8decode(_.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var _=o(h.value);return _.readInt(1)!==1||c(this.fileComment)!==_.readInt(4)?null:p.utf8decode(_.readData(h.length-5))}return null}},n.exports=y},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(s,n,i){function o(_,b,N){this.name=_,this.dir=N.dir,this.date=N.date,this.comment=N.comment,this.unixPermissions=N.unixPermissions,this.dosPermissions=N.dosPermissions,this._data=b,this._dataBinary=N.binary,this.options={compression:N.compression,compressionOptions:N.compressionOptions}}var l=s("./stream/StreamHelper"),a=s("./stream/DataWorker"),c=s("./utf8"),p=s("./compressedObject"),d=s("./stream/GenericWorker");o.prototype={internalStream:function(_){var b=null,N="string";try{if(!_)throw new Error("No output type specified.");var u=(N=_.toLowerCase())==="string"||N==="text";N!=="binarystring"&&N!=="text"||(N="string"),b=this._decompressWorker();var v=!this._dataBinary;v&&!u&&(b=b.pipe(new c.Utf8EncodeWorker)),!v&&u&&(b=b.pipe(new c.Utf8DecodeWorker))}catch(g){(b=new d("error")).error(g)}return new l(b,N,"")},async:function(_,b){return this.internalStream(_).accumulate(b)},nodeStream:function(_,b){return this.internalStream(_||"nodebuffer").toNodejsStream(b)},_compressWorker:function(_,b){if(this._data instanceof p&&this._data.compression.magic===_.magic)return this._data.getCompressedWorker();var N=this._decompressWorker();return this._dataBinary||(N=N.pipe(new c.Utf8EncodeWorker)),p.createWorkerFrom(N,_,b)},_decompressWorker:function(){return this._data instanceof p?this._data.getContentWorker():this._data instanceof d?this._data:new a(this._data)}};for(var m=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],y=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<m.length;h++)o.prototype[m[h]]=y;n.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(s,n,i){(function(o){var l,a,c=o.MutationObserver||o.WebKitMutationObserver;if(c){var p=0,d=new c(_),m=o.document.createTextNode("");d.observe(m,{characterData:!0}),l=function(){m.data=p=++p%2}}else if(o.setImmediate||o.MessageChannel===void 0)l="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var b=o.document.createElement("script");b.onreadystatechange=function(){_(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},o.document.documentElement.appendChild(b)}:function(){setTimeout(_,0)};else{var y=new o.MessageChannel;y.port1.onmessage=_,l=function(){y.port2.postMessage(0)}}var h=[];function _(){var b,N;a=!0;for(var u=h.length;u;){for(N=h,h=[],b=-1;++b<u;)N[b]();u=h.length}a=!1}n.exports=function(b){h.push(b)!==1||a||l()}}).call(this,typeof zr<"u"?zr:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(s,n,i){var o=s("immediate");function l(){}var a={},c=["REJECTED"],p=["FULFILLED"],d=["PENDING"];function m(u){if(typeof u!="function")throw new TypeError("resolver must be a function");this.state=d,this.queue=[],this.outcome=void 0,u!==l&&b(this,u)}function y(u,v,g){this.promise=u,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof g=="function"&&(this.onRejected=g,this.callRejected=this.otherCallRejected)}function h(u,v,g){o(function(){var w;try{w=v(g)}catch(k){return a.reject(u,k)}w===u?a.reject(u,new TypeError("Cannot resolve promise with itself")):a.resolve(u,w)})}function _(u){var v=u&&u.then;if(u&&(typeof u=="object"||typeof u=="function")&&typeof v=="function")return function(){v.apply(u,arguments)}}function b(u,v){var g=!1;function w(T){g||(g=!0,a.reject(u,T))}function k(T){g||(g=!0,a.resolve(u,T))}var A=N(function(){v(k,w)});A.status==="error"&&w(A.value)}function N(u,v){var g={};try{g.value=u(v),g.status="success"}catch(w){g.status="error",g.value=w}return g}(n.exports=m).prototype.finally=function(u){if(typeof u!="function")return this;var v=this.constructor;return this.then(function(g){return v.resolve(u()).then(function(){return g})},function(g){return v.resolve(u()).then(function(){throw g})})},m.prototype.catch=function(u){return this.then(null,u)},m.prototype.then=function(u,v){if(typeof u!="function"&&this.state===p||typeof v!="function"&&this.state===c)return this;var g=new this.constructor(l);return this.state!==d?h(g,this.state===p?u:v,this.outcome):this.queue.push(new y(g,u,v)),g},y.prototype.callFulfilled=function(u){a.resolve(this.promise,u)},y.prototype.otherCallFulfilled=function(u){h(this.promise,this.onFulfilled,u)},y.prototype.callRejected=function(u){a.reject(this.promise,u)},y.prototype.otherCallRejected=function(u){h(this.promise,this.onRejected,u)},a.resolve=function(u,v){var g=N(_,v);if(g.status==="error")return a.reject(u,g.value);var w=g.value;if(w)b(u,w);else{u.state=p,u.outcome=v;for(var k=-1,A=u.queue.length;++k<A;)u.queue[k].callFulfilled(v)}return u},a.reject=function(u,v){u.state=c,u.outcome=v;for(var g=-1,w=u.queue.length;++g<w;)u.queue[g].callRejected(v);return u},m.resolve=function(u){return u instanceof this?u:a.resolve(new this(l),u)},m.reject=function(u){var v=new this(l);return a.reject(v,u)},m.all=function(u){var v=this;if(Object.prototype.toString.call(u)!=="[object Array]")return this.reject(new TypeError("must be an array"));var g=u.length,w=!1;if(!g)return this.resolve([]);for(var k=new Array(g),A=0,T=-1,z=new this(l);++T<g;)S(u[T],T);return z;function S(U,G){v.resolve(U).then(function(F){k[G]=F,++A!==g||w||(w=!0,a.resolve(z,k))},function(F){w||(w=!0,a.reject(z,F))})}},m.race=function(u){var v=this;if(Object.prototype.toString.call(u)!=="[object Array]")return this.reject(new TypeError("must be an array"));var g=u.length,w=!1;if(!g)return this.resolve([]);for(var k=-1,A=new this(l);++k<g;)T=u[k],v.resolve(T).then(function(z){w||(w=!0,a.resolve(A,z))},function(z){w||(w=!0,a.reject(A,z))});var T;return A}},{immediate:36}],38:[function(s,n,i){var o={};(0,s("./lib/utils/common").assign)(o,s("./lib/deflate"),s("./lib/inflate"),s("./lib/zlib/constants")),n.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(s,n,i){var o=s("./zlib/deflate"),l=s("./utils/common"),a=s("./utils/strings"),c=s("./zlib/messages"),p=s("./zlib/zstream"),d=Object.prototype.toString,m=0,y=-1,h=0,_=8;function b(u){if(!(this instanceof b))return new b(u);this.options=l.assign({level:y,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},u||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var g=o.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(g!==m)throw new Error(c[g]);if(v.header&&o.deflateSetHeader(this.strm,v.header),v.dictionary){var w;if(w=typeof v.dictionary=="string"?a.string2buf(v.dictionary):d.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(g=o.deflateSetDictionary(this.strm,w))!==m)throw new Error(c[g]);this._dict_set=!0}}function N(u,v){var g=new b(v);if(g.push(u,!0),g.err)throw g.msg||c[g.err];return g.result}b.prototype.push=function(u,v){var g,w,k=this.strm,A=this.options.chunkSize;if(this.ended)return!1;w=v===~~v?v:v===!0?4:0,typeof u=="string"?k.input=a.string2buf(u):d.call(u)==="[object ArrayBuffer]"?k.input=new Uint8Array(u):k.input=u,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new l.Buf8(A),k.next_out=0,k.avail_out=A),(g=o.deflate(k,w))!==1&&g!==m)return this.onEnd(g),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||w!==4&&w!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(l.shrinkBuf(k.output,k.next_out))):this.onData(l.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&g!==1);return w===4?(g=o.deflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===m):w!==2||(this.onEnd(m),!(k.avail_out=0))},b.prototype.onData=function(u){this.chunks.push(u)},b.prototype.onEnd=function(u){u===m&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=u,this.msg=this.strm.msg},i.Deflate=b,i.deflate=N,i.deflateRaw=function(u,v){return(v=v||{}).raw=!0,N(u,v)},i.gzip=function(u,v){return(v=v||{}).gzip=!0,N(u,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(s,n,i){var o=s("./zlib/inflate"),l=s("./utils/common"),a=s("./utils/strings"),c=s("./zlib/constants"),p=s("./zlib/messages"),d=s("./zlib/zstream"),m=s("./zlib/gzheader"),y=Object.prototype.toString;function h(b){if(!(this instanceof h))return new h(b);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},b||{});var N=this.options;N.raw&&0<=N.windowBits&&N.windowBits<16&&(N.windowBits=-N.windowBits,N.windowBits===0&&(N.windowBits=-15)),!(0<=N.windowBits&&N.windowBits<16)||b&&b.windowBits||(N.windowBits+=32),15<N.windowBits&&N.windowBits<48&&(15&N.windowBits)==0&&(N.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var u=o.inflateInit2(this.strm,N.windowBits);if(u!==c.Z_OK)throw new Error(p[u]);this.header=new m,o.inflateGetHeader(this.strm,this.header)}function _(b,N){var u=new h(N);if(u.push(b,!0),u.err)throw u.msg||p[u.err];return u.result}h.prototype.push=function(b,N){var u,v,g,w,k,A,T=this.strm,z=this.options.chunkSize,S=this.options.dictionary,U=!1;if(this.ended)return!1;v=N===~~N?N:N===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof b=="string"?T.input=a.binstring2buf(b):y.call(b)==="[object ArrayBuffer]"?T.input=new Uint8Array(b):T.input=b,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new l.Buf8(z),T.next_out=0,T.avail_out=z),(u=o.inflate(T,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&S&&(A=typeof S=="string"?a.string2buf(S):y.call(S)==="[object ArrayBuffer]"?new Uint8Array(S):S,u=o.inflateSetDictionary(this.strm,A)),u===c.Z_BUF_ERROR&&U===!0&&(u=c.Z_OK,U=!1),u!==c.Z_STREAM_END&&u!==c.Z_OK)return this.onEnd(u),!(this.ended=!0);T.next_out&&(T.avail_out!==0&&u!==c.Z_STREAM_END&&(T.avail_in!==0||v!==c.Z_FINISH&&v!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(g=a.utf8border(T.output,T.next_out),w=T.next_out-g,k=a.buf2string(T.output,g),T.next_out=w,T.avail_out=z-w,w&&l.arraySet(T.output,T.output,g,w,0),this.onData(k)):this.onData(l.shrinkBuf(T.output,T.next_out)))),T.avail_in===0&&T.avail_out===0&&(U=!0)}while((0<T.avail_in||T.avail_out===0)&&u!==c.Z_STREAM_END);return u===c.Z_STREAM_END&&(v=c.Z_FINISH),v===c.Z_FINISH?(u=o.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,u===c.Z_OK):v!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(T.avail_out=0))},h.prototype.onData=function(b){this.chunks.push(b)},h.prototype.onEnd=function(b){b===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},i.Inflate=h,i.inflate=_,i.inflateRaw=function(b,N){return(N=N||{}).raw=!0,_(b,N)},i.ungzip=_},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(s,n,i){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var p=Array.prototype.slice.call(arguments,1);p.length;){var d=p.shift();if(d){if(typeof d!="object")throw new TypeError(d+"must be non-object");for(var m in d)d.hasOwnProperty(m)&&(c[m]=d[m])}}return c},i.shrinkBuf=function(c,p){return c.length===p?c:c.subarray?c.subarray(0,p):(c.length=p,c)};var l={arraySet:function(c,p,d,m,y){if(p.subarray&&c.subarray)c.set(p.subarray(d,d+m),y);else for(var h=0;h<m;h++)c[y+h]=p[d+h]},flattenChunks:function(c){var p,d,m,y,h,_;for(p=m=0,d=c.length;p<d;p++)m+=c[p].length;for(_=new Uint8Array(m),p=y=0,d=c.length;p<d;p++)h=c[p],_.set(h,y),y+=h.length;return _}},a={arraySet:function(c,p,d,m,y){for(var h=0;h<m;h++)c[y+h]=p[d+h]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,l)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(o)},{}],42:[function(s,n,i){var o=s("./common"),l=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new o.Buf8(256),p=0;p<256;p++)c[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;function d(m,y){if(y<65537&&(m.subarray&&a||!m.subarray&&l))return String.fromCharCode.apply(null,o.shrinkBuf(m,y));for(var h="",_=0;_<y;_++)h+=String.fromCharCode(m[_]);return h}c[254]=c[254]=1,i.string2buf=function(m){var y,h,_,b,N,u=m.length,v=0;for(b=0;b<u;b++)(64512&(h=m.charCodeAt(b)))==55296&&b+1<u&&(64512&(_=m.charCodeAt(b+1)))==56320&&(h=65536+(h-55296<<10)+(_-56320),b++),v+=h<128?1:h<2048?2:h<65536?3:4;for(y=new o.Buf8(v),b=N=0;N<v;b++)(64512&(h=m.charCodeAt(b)))==55296&&b+1<u&&(64512&(_=m.charCodeAt(b+1)))==56320&&(h=65536+(h-55296<<10)+(_-56320),b++),h<128?y[N++]=h:(h<2048?y[N++]=192|h>>>6:(h<65536?y[N++]=224|h>>>12:(y[N++]=240|h>>>18,y[N++]=128|h>>>12&63),y[N++]=128|h>>>6&63),y[N++]=128|63&h);return y},i.buf2binstring=function(m){return d(m,m.length)},i.binstring2buf=function(m){for(var y=new o.Buf8(m.length),h=0,_=y.length;h<_;h++)y[h]=m.charCodeAt(h);return y},i.buf2string=function(m,y){var h,_,b,N,u=y||m.length,v=new Array(2*u);for(h=_=0;h<u;)if((b=m[h++])<128)v[_++]=b;else if(4<(N=c[b]))v[_++]=65533,h+=N-1;else{for(b&=N===2?31:N===3?15:7;1<N&&h<u;)b=b<<6|63&m[h++],N--;1<N?v[_++]=65533:b<65536?v[_++]=b:(b-=65536,v[_++]=55296|b>>10&1023,v[_++]=56320|1023&b)}return d(v,_)},i.utf8border=function(m,y){var h;for((y=y||m.length)>m.length&&(y=m.length),h=y-1;0<=h&&(192&m[h])==128;)h--;return h<0||h===0?y:h+c[m[h]]>y?h:y}},{"./common":41}],43:[function(s,n,i){n.exports=function(o,l,a,c){for(var p=65535&o|0,d=o>>>16&65535|0,m=0;a!==0;){for(a-=m=2e3<a?2e3:a;d=d+(p=p+l[c++]|0)|0,--m;);p%=65521,d%=65521}return p|d<<16|0}},{}],44:[function(s,n,i){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(s,n,i){var o=(function(){for(var l,a=[],c=0;c<256;c++){l=c;for(var p=0;p<8;p++)l=1&l?3988292384^l>>>1:l>>>1;a[c]=l}return a})();n.exports=function(l,a,c,p){var d=o,m=p+c;l^=-1;for(var y=p;y<m;y++)l=l>>>8^d[255&(l^a[y])];return-1^l}},{}],46:[function(s,n,i){var o,l=s("../utils/common"),a=s("./trees"),c=s("./adler32"),p=s("./crc32"),d=s("./messages"),m=0,y=4,h=0,_=-2,b=-1,N=4,u=2,v=8,g=9,w=286,k=30,A=19,T=2*w+1,z=15,S=3,U=258,G=U+S+1,F=42,C=113,j=1,D=2,J=3,q=4;function W(O,ce){return O.msg=d[ce],ce}function $(O){return(O<<1)-(4<O?9:0)}function ne(O){for(var ce=O.length;0<=--ce;)O[ce]=0}function K(O){var ce=O.state,L=ce.pending;L>O.avail_out&&(L=O.avail_out),L!==0&&(l.arraySet(O.output,ce.pending_buf,ce.pending_out,L,O.next_out),O.next_out+=L,ce.pending_out+=L,O.total_out+=L,O.avail_out-=L,ce.pending-=L,ce.pending===0&&(ce.pending_out=0))}function P(O,ce){a._tr_flush_block(O,0<=O.block_start?O.block_start:-1,O.strstart-O.block_start,ce),O.block_start=O.strstart,K(O.strm)}function Y(O,ce){O.pending_buf[O.pending++]=ce}function re(O,ce){O.pending_buf[O.pending++]=ce>>>8&255,O.pending_buf[O.pending++]=255&ce}function le(O,ce){var L,f,x=O.max_chain_length,E=O.strstart,H=O.prev_length,ee=O.nice_match,Z=O.strstart>O.w_size-G?O.strstart-(O.w_size-G):0,ue=O.window,pe=O.w_mask,ie=O.prev,ke=O.strstart+U,Oe=ue[E+H-1],De=ue[E+H];O.prev_length>=O.good_match&&(x>>=2),ee>O.lookahead&&(ee=O.lookahead);do if(ue[(L=ce)+H]===De&&ue[L+H-1]===Oe&&ue[L]===ue[E]&&ue[++L]===ue[E+1]){E+=2,L++;do;while(ue[++E]===ue[++L]&&ue[++E]===ue[++L]&&ue[++E]===ue[++L]&&ue[++E]===ue[++L]&&ue[++E]===ue[++L]&&ue[++E]===ue[++L]&&ue[++E]===ue[++L]&&ue[++E]===ue[++L]&&E<ke);if(f=U-(ke-E),E=ke-U,H<f){if(O.match_start=ce,ee<=(H=f))break;Oe=ue[E+H-1],De=ue[E+H]}}while((ce=ie[ce&pe])>Z&&--x!=0);return H<=O.lookahead?H:O.lookahead}function se(O){var ce,L,f,x,E,H,ee,Z,ue,pe,ie=O.w_size;do{if(x=O.window_size-O.lookahead-O.strstart,O.strstart>=ie+(ie-G)){for(l.arraySet(O.window,O.window,ie,ie,0),O.match_start-=ie,O.strstart-=ie,O.block_start-=ie,ce=L=O.hash_size;f=O.head[--ce],O.head[ce]=ie<=f?f-ie:0,--L;);for(ce=L=ie;f=O.prev[--ce],O.prev[ce]=ie<=f?f-ie:0,--L;);x+=ie}if(O.strm.avail_in===0)break;if(H=O.strm,ee=O.window,Z=O.strstart+O.lookahead,ue=x,pe=void 0,pe=H.avail_in,ue<pe&&(pe=ue),L=pe===0?0:(H.avail_in-=pe,l.arraySet(ee,H.input,H.next_in,pe,Z),H.state.wrap===1?H.adler=c(H.adler,ee,pe,Z):H.state.wrap===2&&(H.adler=p(H.adler,ee,pe,Z)),H.next_in+=pe,H.total_in+=pe,pe),O.lookahead+=L,O.lookahead+O.insert>=S)for(E=O.strstart-O.insert,O.ins_h=O.window[E],O.ins_h=(O.ins_h<<O.hash_shift^O.window[E+1])&O.hash_mask;O.insert&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[E+S-1])&O.hash_mask,O.prev[E&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=E,E++,O.insert--,!(O.lookahead+O.insert<S)););}while(O.lookahead<G&&O.strm.avail_in!==0)}function R(O,ce){for(var L,f;;){if(O.lookahead<G){if(se(O),O.lookahead<G&&ce===m)return j;if(O.lookahead===0)break}if(L=0,O.lookahead>=S&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+S-1])&O.hash_mask,L=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart),L!==0&&O.strstart-L<=O.w_size-G&&(O.match_length=le(O,L)),O.match_length>=S)if(f=a._tr_tally(O,O.strstart-O.match_start,O.match_length-S),O.lookahead-=O.match_length,O.match_length<=O.max_lazy_match&&O.lookahead>=S){for(O.match_length--;O.strstart++,O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+S-1])&O.hash_mask,L=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart,--O.match_length!=0;);O.strstart++}else O.strstart+=O.match_length,O.match_length=0,O.ins_h=O.window[O.strstart],O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+1])&O.hash_mask;else f=a._tr_tally(O,0,O.window[O.strstart]),O.lookahead--,O.strstart++;if(f&&(P(O,!1),O.strm.avail_out===0))return j}return O.insert=O.strstart<S-1?O.strstart:S-1,ce===y?(P(O,!0),O.strm.avail_out===0?J:q):O.last_lit&&(P(O,!1),O.strm.avail_out===0)?j:D}function I(O,ce){for(var L,f,x;;){if(O.lookahead<G){if(se(O),O.lookahead<G&&ce===m)return j;if(O.lookahead===0)break}if(L=0,O.lookahead>=S&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+S-1])&O.hash_mask,L=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart),O.prev_length=O.match_length,O.prev_match=O.match_start,O.match_length=S-1,L!==0&&O.prev_length<O.max_lazy_match&&O.strstart-L<=O.w_size-G&&(O.match_length=le(O,L),O.match_length<=5&&(O.strategy===1||O.match_length===S&&4096<O.strstart-O.match_start)&&(O.match_length=S-1)),O.prev_length>=S&&O.match_length<=O.prev_length){for(x=O.strstart+O.lookahead-S,f=a._tr_tally(O,O.strstart-1-O.prev_match,O.prev_length-S),O.lookahead-=O.prev_length-1,O.prev_length-=2;++O.strstart<=x&&(O.ins_h=(O.ins_h<<O.hash_shift^O.window[O.strstart+S-1])&O.hash_mask,L=O.prev[O.strstart&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=O.strstart),--O.prev_length!=0;);if(O.match_available=0,O.match_length=S-1,O.strstart++,f&&(P(O,!1),O.strm.avail_out===0))return j}else if(O.match_available){if((f=a._tr_tally(O,0,O.window[O.strstart-1]))&&P(O,!1),O.strstart++,O.lookahead--,O.strm.avail_out===0)return j}else O.match_available=1,O.strstart++,O.lookahead--}return O.match_available&&(f=a._tr_tally(O,0,O.window[O.strstart-1]),O.match_available=0),O.insert=O.strstart<S-1?O.strstart:S-1,ce===y?(P(O,!0),O.strm.avail_out===0?J:q):O.last_lit&&(P(O,!1),O.strm.avail_out===0)?j:D}function Q(O,ce,L,f,x){this.good_length=O,this.max_lazy=ce,this.nice_length=L,this.max_chain=f,this.func=x}function X(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*T),this.dyn_dtree=new l.Buf16(2*(2*k+1)),this.bl_tree=new l.Buf16(2*(2*A+1)),ne(this.dyn_ltree),ne(this.dyn_dtree),ne(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(z+1),this.heap=new l.Buf16(2*w+1),ne(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*w+1),ne(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function V(O){var ce;return O&&O.state?(O.total_in=O.total_out=0,O.data_type=u,(ce=O.state).pending=0,ce.pending_out=0,ce.wrap<0&&(ce.wrap=-ce.wrap),ce.status=ce.wrap?F:C,O.adler=ce.wrap===2?0:1,ce.last_flush=m,a._tr_init(ce),h):W(O,_)}function M(O){var ce=V(O);return ce===h&&(function(L){L.window_size=2*L.w_size,ne(L.head),L.max_lazy_match=o[L.level].max_lazy,L.good_match=o[L.level].good_length,L.nice_match=o[L.level].nice_length,L.max_chain_length=o[L.level].max_chain,L.strstart=0,L.block_start=0,L.lookahead=0,L.insert=0,L.match_length=L.prev_length=S-1,L.match_available=0,L.ins_h=0})(O.state),ce}function oe(O,ce,L,f,x,E){if(!O)return _;var H=1;if(ce===b&&(ce=6),f<0?(H=0,f=-f):15<f&&(H=2,f-=16),x<1||g<x||L!==v||f<8||15<f||ce<0||9<ce||E<0||N<E)return W(O,_);f===8&&(f=9);var ee=new X;return(O.state=ee).strm=O,ee.wrap=H,ee.gzhead=null,ee.w_bits=f,ee.w_size=1<<ee.w_bits,ee.w_mask=ee.w_size-1,ee.hash_bits=x+7,ee.hash_size=1<<ee.hash_bits,ee.hash_mask=ee.hash_size-1,ee.hash_shift=~~((ee.hash_bits+S-1)/S),ee.window=new l.Buf8(2*ee.w_size),ee.head=new l.Buf16(ee.hash_size),ee.prev=new l.Buf16(ee.w_size),ee.lit_bufsize=1<<x+6,ee.pending_buf_size=4*ee.lit_bufsize,ee.pending_buf=new l.Buf8(ee.pending_buf_size),ee.d_buf=1*ee.lit_bufsize,ee.l_buf=3*ee.lit_bufsize,ee.level=ce,ee.strategy=E,ee.method=L,M(O)}o=[new Q(0,0,0,0,function(O,ce){var L=65535;for(L>O.pending_buf_size-5&&(L=O.pending_buf_size-5);;){if(O.lookahead<=1){if(se(O),O.lookahead===0&&ce===m)return j;if(O.lookahead===0)break}O.strstart+=O.lookahead,O.lookahead=0;var f=O.block_start+L;if((O.strstart===0||O.strstart>=f)&&(O.lookahead=O.strstart-f,O.strstart=f,P(O,!1),O.strm.avail_out===0)||O.strstart-O.block_start>=O.w_size-G&&(P(O,!1),O.strm.avail_out===0))return j}return O.insert=0,ce===y?(P(O,!0),O.strm.avail_out===0?J:q):(O.strstart>O.block_start&&(P(O,!1),O.strm.avail_out),j)}),new Q(4,4,8,4,R),new Q(4,5,16,8,R),new Q(4,6,32,32,R),new Q(4,4,16,16,I),new Q(8,16,32,32,I),new Q(8,16,128,128,I),new Q(8,32,128,256,I),new Q(32,128,258,1024,I),new Q(32,258,258,4096,I)],i.deflateInit=function(O,ce){return oe(O,ce,v,15,8,0)},i.deflateInit2=oe,i.deflateReset=M,i.deflateResetKeep=V,i.deflateSetHeader=function(O,ce){return O&&O.state?O.state.wrap!==2?_:(O.state.gzhead=ce,h):_},i.deflate=function(O,ce){var L,f,x,E;if(!O||!O.state||5<ce||ce<0)return O?W(O,_):_;if(f=O.state,!O.output||!O.input&&O.avail_in!==0||f.status===666&&ce!==y)return W(O,O.avail_out===0?-5:_);if(f.strm=O,L=f.last_flush,f.last_flush=ce,f.status===F)if(f.wrap===2)O.adler=0,Y(f,31),Y(f,139),Y(f,8),f.gzhead?(Y(f,(f.gzhead.text?1:0)+(f.gzhead.hcrc?2:0)+(f.gzhead.extra?4:0)+(f.gzhead.name?8:0)+(f.gzhead.comment?16:0)),Y(f,255&f.gzhead.time),Y(f,f.gzhead.time>>8&255),Y(f,f.gzhead.time>>16&255),Y(f,f.gzhead.time>>24&255),Y(f,f.level===9?2:2<=f.strategy||f.level<2?4:0),Y(f,255&f.gzhead.os),f.gzhead.extra&&f.gzhead.extra.length&&(Y(f,255&f.gzhead.extra.length),Y(f,f.gzhead.extra.length>>8&255)),f.gzhead.hcrc&&(O.adler=p(O.adler,f.pending_buf,f.pending,0)),f.gzindex=0,f.status=69):(Y(f,0),Y(f,0),Y(f,0),Y(f,0),Y(f,0),Y(f,f.level===9?2:2<=f.strategy||f.level<2?4:0),Y(f,3),f.status=C);else{var H=v+(f.w_bits-8<<4)<<8;H|=(2<=f.strategy||f.level<2?0:f.level<6?1:f.level===6?2:3)<<6,f.strstart!==0&&(H|=32),H+=31-H%31,f.status=C,re(f,H),f.strstart!==0&&(re(f,O.adler>>>16),re(f,65535&O.adler)),O.adler=1}if(f.status===69)if(f.gzhead.extra){for(x=f.pending;f.gzindex<(65535&f.gzhead.extra.length)&&(f.pending!==f.pending_buf_size||(f.gzhead.hcrc&&f.pending>x&&(O.adler=p(O.adler,f.pending_buf,f.pending-x,x)),K(O),x=f.pending,f.pending!==f.pending_buf_size));)Y(f,255&f.gzhead.extra[f.gzindex]),f.gzindex++;f.gzhead.hcrc&&f.pending>x&&(O.adler=p(O.adler,f.pending_buf,f.pending-x,x)),f.gzindex===f.gzhead.extra.length&&(f.gzindex=0,f.status=73)}else f.status=73;if(f.status===73)if(f.gzhead.name){x=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>x&&(O.adler=p(O.adler,f.pending_buf,f.pending-x,x)),K(O),x=f.pending,f.pending===f.pending_buf_size)){E=1;break}E=f.gzindex<f.gzhead.name.length?255&f.gzhead.name.charCodeAt(f.gzindex++):0,Y(f,E)}while(E!==0);f.gzhead.hcrc&&f.pending>x&&(O.adler=p(O.adler,f.pending_buf,f.pending-x,x)),E===0&&(f.gzindex=0,f.status=91)}else f.status=91;if(f.status===91)if(f.gzhead.comment){x=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>x&&(O.adler=p(O.adler,f.pending_buf,f.pending-x,x)),K(O),x=f.pending,f.pending===f.pending_buf_size)){E=1;break}E=f.gzindex<f.gzhead.comment.length?255&f.gzhead.comment.charCodeAt(f.gzindex++):0,Y(f,E)}while(E!==0);f.gzhead.hcrc&&f.pending>x&&(O.adler=p(O.adler,f.pending_buf,f.pending-x,x)),E===0&&(f.status=103)}else f.status=103;if(f.status===103&&(f.gzhead.hcrc?(f.pending+2>f.pending_buf_size&&K(O),f.pending+2<=f.pending_buf_size&&(Y(f,255&O.adler),Y(f,O.adler>>8&255),O.adler=0,f.status=C)):f.status=C),f.pending!==0){if(K(O),O.avail_out===0)return f.last_flush=-1,h}else if(O.avail_in===0&&$(ce)<=$(L)&&ce!==y)return W(O,-5);if(f.status===666&&O.avail_in!==0)return W(O,-5);if(O.avail_in!==0||f.lookahead!==0||ce!==m&&f.status!==666){var ee=f.strategy===2?(function(Z,ue){for(var pe;;){if(Z.lookahead===0&&(se(Z),Z.lookahead===0)){if(ue===m)return j;break}if(Z.match_length=0,pe=a._tr_tally(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++,pe&&(P(Z,!1),Z.strm.avail_out===0))return j}return Z.insert=0,ue===y?(P(Z,!0),Z.strm.avail_out===0?J:q):Z.last_lit&&(P(Z,!1),Z.strm.avail_out===0)?j:D})(f,ce):f.strategy===3?(function(Z,ue){for(var pe,ie,ke,Oe,De=Z.window;;){if(Z.lookahead<=U){if(se(Z),Z.lookahead<=U&&ue===m)return j;if(Z.lookahead===0)break}if(Z.match_length=0,Z.lookahead>=S&&0<Z.strstart&&(ie=De[ke=Z.strstart-1])===De[++ke]&&ie===De[++ke]&&ie===De[++ke]){Oe=Z.strstart+U;do;while(ie===De[++ke]&&ie===De[++ke]&&ie===De[++ke]&&ie===De[++ke]&&ie===De[++ke]&&ie===De[++ke]&&ie===De[++ke]&&ie===De[++ke]&&ke<Oe);Z.match_length=U-(Oe-ke),Z.match_length>Z.lookahead&&(Z.match_length=Z.lookahead)}if(Z.match_length>=S?(pe=a._tr_tally(Z,1,Z.match_length-S),Z.lookahead-=Z.match_length,Z.strstart+=Z.match_length,Z.match_length=0):(pe=a._tr_tally(Z,0,Z.window[Z.strstart]),Z.lookahead--,Z.strstart++),pe&&(P(Z,!1),Z.strm.avail_out===0))return j}return Z.insert=0,ue===y?(P(Z,!0),Z.strm.avail_out===0?J:q):Z.last_lit&&(P(Z,!1),Z.strm.avail_out===0)?j:D})(f,ce):o[f.level].func(f,ce);if(ee!==J&&ee!==q||(f.status=666),ee===j||ee===J)return O.avail_out===0&&(f.last_flush=-1),h;if(ee===D&&(ce===1?a._tr_align(f):ce!==5&&(a._tr_stored_block(f,0,0,!1),ce===3&&(ne(f.head),f.lookahead===0&&(f.strstart=0,f.block_start=0,f.insert=0))),K(O),O.avail_out===0))return f.last_flush=-1,h}return ce!==y?h:f.wrap<=0?1:(f.wrap===2?(Y(f,255&O.adler),Y(f,O.adler>>8&255),Y(f,O.adler>>16&255),Y(f,O.adler>>24&255),Y(f,255&O.total_in),Y(f,O.total_in>>8&255),Y(f,O.total_in>>16&255),Y(f,O.total_in>>24&255)):(re(f,O.adler>>>16),re(f,65535&O.adler)),K(O),0<f.wrap&&(f.wrap=-f.wrap),f.pending!==0?h:1)},i.deflateEnd=function(O){var ce;return O&&O.state?(ce=O.state.status)!==F&&ce!==69&&ce!==73&&ce!==91&&ce!==103&&ce!==C&&ce!==666?W(O,_):(O.state=null,ce===C?W(O,-3):h):_},i.deflateSetDictionary=function(O,ce){var L,f,x,E,H,ee,Z,ue,pe=ce.length;if(!O||!O.state||(E=(L=O.state).wrap)===2||E===1&&L.status!==F||L.lookahead)return _;for(E===1&&(O.adler=c(O.adler,ce,pe,0)),L.wrap=0,pe>=L.w_size&&(E===0&&(ne(L.head),L.strstart=0,L.block_start=0,L.insert=0),ue=new l.Buf8(L.w_size),l.arraySet(ue,ce,pe-L.w_size,L.w_size,0),ce=ue,pe=L.w_size),H=O.avail_in,ee=O.next_in,Z=O.input,O.avail_in=pe,O.next_in=0,O.input=ce,se(L);L.lookahead>=S;){for(f=L.strstart,x=L.lookahead-(S-1);L.ins_h=(L.ins_h<<L.hash_shift^L.window[f+S-1])&L.hash_mask,L.prev[f&L.w_mask]=L.head[L.ins_h],L.head[L.ins_h]=f,f++,--x;);L.strstart=f,L.lookahead=S-1,se(L)}return L.strstart+=L.lookahead,L.block_start=L.strstart,L.insert=L.lookahead,L.lookahead=0,L.match_length=L.prev_length=S-1,L.match_available=0,O.next_in=ee,O.input=Z,O.avail_in=H,L.wrap=E,h},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(s,n,i){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(s,n,i){n.exports=function(o,l){var a,c,p,d,m,y,h,_,b,N,u,v,g,w,k,A,T,z,S,U,G,F,C,j,D;a=o.state,c=o.next_in,j=o.input,p=c+(o.avail_in-5),d=o.next_out,D=o.output,m=d-(l-o.avail_out),y=d+(o.avail_out-257),h=a.dmax,_=a.wsize,b=a.whave,N=a.wnext,u=a.window,v=a.hold,g=a.bits,w=a.lencode,k=a.distcode,A=(1<<a.lenbits)-1,T=(1<<a.distbits)-1;e:do{g<15&&(v+=j[c++]<<g,g+=8,v+=j[c++]<<g,g+=8),z=w[v&A];t:for(;;){if(v>>>=S=z>>>24,g-=S,(S=z>>>16&255)===0)D[d++]=65535&z;else{if(!(16&S)){if((64&S)==0){z=w[(65535&z)+(v&(1<<S)-1)];continue t}if(32&S){a.mode=12;break e}o.msg="invalid literal/length code",a.mode=30;break e}U=65535&z,(S&=15)&&(g<S&&(v+=j[c++]<<g,g+=8),U+=v&(1<<S)-1,v>>>=S,g-=S),g<15&&(v+=j[c++]<<g,g+=8,v+=j[c++]<<g,g+=8),z=k[v&T];r:for(;;){if(v>>>=S=z>>>24,g-=S,!(16&(S=z>>>16&255))){if((64&S)==0){z=k[(65535&z)+(v&(1<<S)-1)];continue r}o.msg="invalid distance code",a.mode=30;break e}if(G=65535&z,g<(S&=15)&&(v+=j[c++]<<g,(g+=8)<S&&(v+=j[c++]<<g,g+=8)),h<(G+=v&(1<<S)-1)){o.msg="invalid distance too far back",a.mode=30;break e}if(v>>>=S,g-=S,(S=d-m)<G){if(b<(S=G-S)&&a.sane){o.msg="invalid distance too far back",a.mode=30;break e}if(C=u,(F=0)===N){if(F+=_-S,S<U){for(U-=S;D[d++]=u[F++],--S;);F=d-G,C=D}}else if(N<S){if(F+=_+N-S,(S-=N)<U){for(U-=S;D[d++]=u[F++],--S;);if(F=0,N<U){for(U-=S=N;D[d++]=u[F++],--S;);F=d-G,C=D}}}else if(F+=N-S,S<U){for(U-=S;D[d++]=u[F++],--S;);F=d-G,C=D}for(;2<U;)D[d++]=C[F++],D[d++]=C[F++],D[d++]=C[F++],U-=3;U&&(D[d++]=C[F++],1<U&&(D[d++]=C[F++]))}else{for(F=d-G;D[d++]=D[F++],D[d++]=D[F++],D[d++]=D[F++],2<(U-=3););U&&(D[d++]=D[F++],1<U&&(D[d++]=D[F++]))}break}}break}}while(c<p&&d<y);c-=U=g>>3,v&=(1<<(g-=U<<3))-1,o.next_in=c,o.next_out=d,o.avail_in=c<p?p-c+5:5-(c-p),o.avail_out=d<y?y-d+257:257-(d-y),a.hold=v,a.bits=g}},{}],49:[function(s,n,i){var o=s("../utils/common"),l=s("./adler32"),a=s("./crc32"),c=s("./inffast"),p=s("./inftrees"),d=1,m=2,y=0,h=-2,_=1,b=852,N=592;function u(F){return(F>>>24&255)+(F>>>8&65280)+((65280&F)<<8)+((255&F)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function g(F){var C;return F&&F.state?(C=F.state,F.total_in=F.total_out=C.total=0,F.msg="",C.wrap&&(F.adler=1&C.wrap),C.mode=_,C.last=0,C.havedict=0,C.dmax=32768,C.head=null,C.hold=0,C.bits=0,C.lencode=C.lendyn=new o.Buf32(b),C.distcode=C.distdyn=new o.Buf32(N),C.sane=1,C.back=-1,y):h}function w(F){var C;return F&&F.state?((C=F.state).wsize=0,C.whave=0,C.wnext=0,g(F)):h}function k(F,C){var j,D;return F&&F.state?(D=F.state,C<0?(j=0,C=-C):(j=1+(C>>4),C<48&&(C&=15)),C&&(C<8||15<C)?h:(D.window!==null&&D.wbits!==C&&(D.window=null),D.wrap=j,D.wbits=C,w(F))):h}function A(F,C){var j,D;return F?(D=new v,(F.state=D).window=null,(j=k(F,C))!==y&&(F.state=null),j):h}var T,z,S=!0;function U(F){if(S){var C;for(T=new o.Buf32(512),z=new o.Buf32(32),C=0;C<144;)F.lens[C++]=8;for(;C<256;)F.lens[C++]=9;for(;C<280;)F.lens[C++]=7;for(;C<288;)F.lens[C++]=8;for(p(d,F.lens,0,288,T,0,F.work,{bits:9}),C=0;C<32;)F.lens[C++]=5;p(m,F.lens,0,32,z,0,F.work,{bits:5}),S=!1}F.lencode=T,F.lenbits=9,F.distcode=z,F.distbits=5}function G(F,C,j,D){var J,q=F.state;return q.window===null&&(q.wsize=1<<q.wbits,q.wnext=0,q.whave=0,q.window=new o.Buf8(q.wsize)),D>=q.wsize?(o.arraySet(q.window,C,j-q.wsize,q.wsize,0),q.wnext=0,q.whave=q.wsize):(D<(J=q.wsize-q.wnext)&&(J=D),o.arraySet(q.window,C,j-D,J,q.wnext),(D-=J)?(o.arraySet(q.window,C,j-D,D,0),q.wnext=D,q.whave=q.wsize):(q.wnext+=J,q.wnext===q.wsize&&(q.wnext=0),q.whave<q.wsize&&(q.whave+=J))),0}i.inflateReset=w,i.inflateReset2=k,i.inflateResetKeep=g,i.inflateInit=function(F){return A(F,15)},i.inflateInit2=A,i.inflate=function(F,C){var j,D,J,q,W,$,ne,K,P,Y,re,le,se,R,I,Q,X,V,M,oe,O,ce,L,f,x=0,E=new o.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!F||!F.state||!F.output||!F.input&&F.avail_in!==0)return h;(j=F.state).mode===12&&(j.mode=13),W=F.next_out,J=F.output,ne=F.avail_out,q=F.next_in,D=F.input,$=F.avail_in,K=j.hold,P=j.bits,Y=$,re=ne,ce=y;e:for(;;)switch(j.mode){case _:if(j.wrap===0){j.mode=13;break}for(;P<16;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}if(2&j.wrap&&K===35615){E[j.check=0]=255&K,E[1]=K>>>8&255,j.check=a(j.check,E,2,0),P=K=0,j.mode=2;break}if(j.flags=0,j.head&&(j.head.done=!1),!(1&j.wrap)||(((255&K)<<8)+(K>>8))%31){F.msg="incorrect header check",j.mode=30;break}if((15&K)!=8){F.msg="unknown compression method",j.mode=30;break}if(P-=4,O=8+(15&(K>>>=4)),j.wbits===0)j.wbits=O;else if(O>j.wbits){F.msg="invalid window size",j.mode=30;break}j.dmax=1<<O,F.adler=j.check=1,j.mode=512&K?10:12,P=K=0;break;case 2:for(;P<16;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}if(j.flags=K,(255&j.flags)!=8){F.msg="unknown compression method",j.mode=30;break}if(57344&j.flags){F.msg="unknown header flags set",j.mode=30;break}j.head&&(j.head.text=K>>8&1),512&j.flags&&(E[0]=255&K,E[1]=K>>>8&255,j.check=a(j.check,E,2,0)),P=K=0,j.mode=3;case 3:for(;P<32;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}j.head&&(j.head.time=K),512&j.flags&&(E[0]=255&K,E[1]=K>>>8&255,E[2]=K>>>16&255,E[3]=K>>>24&255,j.check=a(j.check,E,4,0)),P=K=0,j.mode=4;case 4:for(;P<16;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}j.head&&(j.head.xflags=255&K,j.head.os=K>>8),512&j.flags&&(E[0]=255&K,E[1]=K>>>8&255,j.check=a(j.check,E,2,0)),P=K=0,j.mode=5;case 5:if(1024&j.flags){for(;P<16;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}j.length=K,j.head&&(j.head.extra_len=K),512&j.flags&&(E[0]=255&K,E[1]=K>>>8&255,j.check=a(j.check,E,2,0)),P=K=0}else j.head&&(j.head.extra=null);j.mode=6;case 6:if(1024&j.flags&&($<(le=j.length)&&(le=$),le&&(j.head&&(O=j.head.extra_len-j.length,j.head.extra||(j.head.extra=new Array(j.head.extra_len)),o.arraySet(j.head.extra,D,q,le,O)),512&j.flags&&(j.check=a(j.check,D,le,q)),$-=le,q+=le,j.length-=le),j.length))break e;j.length=0,j.mode=7;case 7:if(2048&j.flags){if($===0)break e;for(le=0;O=D[q+le++],j.head&&O&&j.length<65536&&(j.head.name+=String.fromCharCode(O)),O&&le<$;);if(512&j.flags&&(j.check=a(j.check,D,le,q)),$-=le,q+=le,O)break e}else j.head&&(j.head.name=null);j.length=0,j.mode=8;case 8:if(4096&j.flags){if($===0)break e;for(le=0;O=D[q+le++],j.head&&O&&j.length<65536&&(j.head.comment+=String.fromCharCode(O)),O&&le<$;);if(512&j.flags&&(j.check=a(j.check,D,le,q)),$-=le,q+=le,O)break e}else j.head&&(j.head.comment=null);j.mode=9;case 9:if(512&j.flags){for(;P<16;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}if(K!==(65535&j.check)){F.msg="header crc mismatch",j.mode=30;break}P=K=0}j.head&&(j.head.hcrc=j.flags>>9&1,j.head.done=!0),F.adler=j.check=0,j.mode=12;break;case 10:for(;P<32;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}F.adler=j.check=u(K),P=K=0,j.mode=11;case 11:if(j.havedict===0)return F.next_out=W,F.avail_out=ne,F.next_in=q,F.avail_in=$,j.hold=K,j.bits=P,2;F.adler=j.check=1,j.mode=12;case 12:if(C===5||C===6)break e;case 13:if(j.last){K>>>=7&P,P-=7&P,j.mode=27;break}for(;P<3;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}switch(j.last=1&K,P-=1,3&(K>>>=1)){case 0:j.mode=14;break;case 1:if(U(j),j.mode=20,C!==6)break;K>>>=2,P-=2;break e;case 2:j.mode=17;break;case 3:F.msg="invalid block type",j.mode=30}K>>>=2,P-=2;break;case 14:for(K>>>=7&P,P-=7&P;P<32;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}if((65535&K)!=(K>>>16^65535)){F.msg="invalid stored block lengths",j.mode=30;break}if(j.length=65535&K,P=K=0,j.mode=15,C===6)break e;case 15:j.mode=16;case 16:if(le=j.length){if($<le&&(le=$),ne<le&&(le=ne),le===0)break e;o.arraySet(J,D,q,le,W),$-=le,q+=le,ne-=le,W+=le,j.length-=le;break}j.mode=12;break;case 17:for(;P<14;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}if(j.nlen=257+(31&K),K>>>=5,P-=5,j.ndist=1+(31&K),K>>>=5,P-=5,j.ncode=4+(15&K),K>>>=4,P-=4,286<j.nlen||30<j.ndist){F.msg="too many length or distance symbols",j.mode=30;break}j.have=0,j.mode=18;case 18:for(;j.have<j.ncode;){for(;P<3;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}j.lens[H[j.have++]]=7&K,K>>>=3,P-=3}for(;j.have<19;)j.lens[H[j.have++]]=0;if(j.lencode=j.lendyn,j.lenbits=7,L={bits:j.lenbits},ce=p(0,j.lens,0,19,j.lencode,0,j.work,L),j.lenbits=L.bits,ce){F.msg="invalid code lengths set",j.mode=30;break}j.have=0,j.mode=19;case 19:for(;j.have<j.nlen+j.ndist;){for(;Q=(x=j.lencode[K&(1<<j.lenbits)-1])>>>16&255,X=65535&x,!((I=x>>>24)<=P);){if($===0)break e;$--,K+=D[q++]<<P,P+=8}if(X<16)K>>>=I,P-=I,j.lens[j.have++]=X;else{if(X===16){for(f=I+2;P<f;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}if(K>>>=I,P-=I,j.have===0){F.msg="invalid bit length repeat",j.mode=30;break}O=j.lens[j.have-1],le=3+(3&K),K>>>=2,P-=2}else if(X===17){for(f=I+3;P<f;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}P-=I,O=0,le=3+(7&(K>>>=I)),K>>>=3,P-=3}else{for(f=I+7;P<f;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}P-=I,O=0,le=11+(127&(K>>>=I)),K>>>=7,P-=7}if(j.have+le>j.nlen+j.ndist){F.msg="invalid bit length repeat",j.mode=30;break}for(;le--;)j.lens[j.have++]=O}}if(j.mode===30)break;if(j.lens[256]===0){F.msg="invalid code -- missing end-of-block",j.mode=30;break}if(j.lenbits=9,L={bits:j.lenbits},ce=p(d,j.lens,0,j.nlen,j.lencode,0,j.work,L),j.lenbits=L.bits,ce){F.msg="invalid literal/lengths set",j.mode=30;break}if(j.distbits=6,j.distcode=j.distdyn,L={bits:j.distbits},ce=p(m,j.lens,j.nlen,j.ndist,j.distcode,0,j.work,L),j.distbits=L.bits,ce){F.msg="invalid distances set",j.mode=30;break}if(j.mode=20,C===6)break e;case 20:j.mode=21;case 21:if(6<=$&&258<=ne){F.next_out=W,F.avail_out=ne,F.next_in=q,F.avail_in=$,j.hold=K,j.bits=P,c(F,re),W=F.next_out,J=F.output,ne=F.avail_out,q=F.next_in,D=F.input,$=F.avail_in,K=j.hold,P=j.bits,j.mode===12&&(j.back=-1);break}for(j.back=0;Q=(x=j.lencode[K&(1<<j.lenbits)-1])>>>16&255,X=65535&x,!((I=x>>>24)<=P);){if($===0)break e;$--,K+=D[q++]<<P,P+=8}if(Q&&(240&Q)==0){for(V=I,M=Q,oe=X;Q=(x=j.lencode[oe+((K&(1<<V+M)-1)>>V)])>>>16&255,X=65535&x,!(V+(I=x>>>24)<=P);){if($===0)break e;$--,K+=D[q++]<<P,P+=8}K>>>=V,P-=V,j.back+=V}if(K>>>=I,P-=I,j.back+=I,j.length=X,Q===0){j.mode=26;break}if(32&Q){j.back=-1,j.mode=12;break}if(64&Q){F.msg="invalid literal/length code",j.mode=30;break}j.extra=15&Q,j.mode=22;case 22:if(j.extra){for(f=j.extra;P<f;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}j.length+=K&(1<<j.extra)-1,K>>>=j.extra,P-=j.extra,j.back+=j.extra}j.was=j.length,j.mode=23;case 23:for(;Q=(x=j.distcode[K&(1<<j.distbits)-1])>>>16&255,X=65535&x,!((I=x>>>24)<=P);){if($===0)break e;$--,K+=D[q++]<<P,P+=8}if((240&Q)==0){for(V=I,M=Q,oe=X;Q=(x=j.distcode[oe+((K&(1<<V+M)-1)>>V)])>>>16&255,X=65535&x,!(V+(I=x>>>24)<=P);){if($===0)break e;$--,K+=D[q++]<<P,P+=8}K>>>=V,P-=V,j.back+=V}if(K>>>=I,P-=I,j.back+=I,64&Q){F.msg="invalid distance code",j.mode=30;break}j.offset=X,j.extra=15&Q,j.mode=24;case 24:if(j.extra){for(f=j.extra;P<f;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}j.offset+=K&(1<<j.extra)-1,K>>>=j.extra,P-=j.extra,j.back+=j.extra}if(j.offset>j.dmax){F.msg="invalid distance too far back",j.mode=30;break}j.mode=25;case 25:if(ne===0)break e;if(le=re-ne,j.offset>le){if((le=j.offset-le)>j.whave&&j.sane){F.msg="invalid distance too far back",j.mode=30;break}se=le>j.wnext?(le-=j.wnext,j.wsize-le):j.wnext-le,le>j.length&&(le=j.length),R=j.window}else R=J,se=W-j.offset,le=j.length;for(ne<le&&(le=ne),ne-=le,j.length-=le;J[W++]=R[se++],--le;);j.length===0&&(j.mode=21);break;case 26:if(ne===0)break e;J[W++]=j.length,ne--,j.mode=21;break;case 27:if(j.wrap){for(;P<32;){if($===0)break e;$--,K|=D[q++]<<P,P+=8}if(re-=ne,F.total_out+=re,j.total+=re,re&&(F.adler=j.check=j.flags?a(j.check,J,re,W-re):l(j.check,J,re,W-re)),re=ne,(j.flags?K:u(K))!==j.check){F.msg="incorrect data check",j.mode=30;break}P=K=0}j.mode=28;case 28:if(j.wrap&&j.flags){for(;P<32;){if($===0)break e;$--,K+=D[q++]<<P,P+=8}if(K!==(4294967295&j.total)){F.msg="incorrect length check",j.mode=30;break}P=K=0}j.mode=29;case 29:ce=1;break e;case 30:ce=-3;break e;case 31:return-4;case 32:default:return h}return F.next_out=W,F.avail_out=ne,F.next_in=q,F.avail_in=$,j.hold=K,j.bits=P,(j.wsize||re!==F.avail_out&&j.mode<30&&(j.mode<27||C!==4))&&G(F,F.output,F.next_out,re-F.avail_out)?(j.mode=31,-4):(Y-=F.avail_in,re-=F.avail_out,F.total_in+=Y,F.total_out+=re,j.total+=re,j.wrap&&re&&(F.adler=j.check=j.flags?a(j.check,J,re,F.next_out-re):l(j.check,J,re,F.next_out-re)),F.data_type=j.bits+(j.last?64:0)+(j.mode===12?128:0)+(j.mode===20||j.mode===15?256:0),(Y==0&&re===0||C===4)&&ce===y&&(ce=-5),ce)},i.inflateEnd=function(F){if(!F||!F.state)return h;var C=F.state;return C.window&&(C.window=null),F.state=null,y},i.inflateGetHeader=function(F,C){var j;return F&&F.state?(2&(j=F.state).wrap)==0?h:((j.head=C).done=!1,y):h},i.inflateSetDictionary=function(F,C){var j,D=C.length;return F&&F.state?(j=F.state).wrap!==0&&j.mode!==11?h:j.mode===11&&l(1,C,D,0)!==j.check?-3:G(F,C,D,D)?(j.mode=31,-4):(j.havedict=1,y):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(s,n,i){var o=s("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(d,m,y,h,_,b,N,u){var v,g,w,k,A,T,z,S,U,G=u.bits,F=0,C=0,j=0,D=0,J=0,q=0,W=0,$=0,ne=0,K=0,P=null,Y=0,re=new o.Buf16(16),le=new o.Buf16(16),se=null,R=0;for(F=0;F<=15;F++)re[F]=0;for(C=0;C<h;C++)re[m[y+C]]++;for(J=G,D=15;1<=D&&re[D]===0;D--);if(D<J&&(J=D),D===0)return _[b++]=20971520,_[b++]=20971520,u.bits=1,0;for(j=1;j<D&&re[j]===0;j++);for(J<j&&(J=j),F=$=1;F<=15;F++)if($<<=1,($-=re[F])<0)return-1;if(0<$&&(d===0||D!==1))return-1;for(le[1]=0,F=1;F<15;F++)le[F+1]=le[F]+re[F];for(C=0;C<h;C++)m[y+C]!==0&&(N[le[m[y+C]]++]=C);if(T=d===0?(P=se=N,19):d===1?(P=l,Y-=257,se=a,R-=257,256):(P=c,se=p,-1),F=j,A=b,W=C=K=0,w=-1,k=(ne=1<<(q=J))-1,d===1&&852<ne||d===2&&592<ne)return 1;for(;;){for(z=F-W,U=N[C]<T?(S=0,N[C]):N[C]>T?(S=se[R+N[C]],P[Y+N[C]]):(S=96,0),v=1<<F-W,j=g=1<<q;_[A+(K>>W)+(g-=v)]=z<<24|S<<16|U|0,g!==0;);for(v=1<<F-1;K&v;)v>>=1;if(v!==0?(K&=v-1,K+=v):K=0,C++,--re[F]==0){if(F===D)break;F=m[y+N[C]]}if(J<F&&(K&k)!==w){for(W===0&&(W=J),A+=j,$=1<<(q=F-W);q+W<D&&!(($-=re[q+W])<=0);)q++,$<<=1;if(ne+=1<<q,d===1&&852<ne||d===2&&592<ne)return 1;_[w=K&k]=J<<24|q<<16|A-b|0}}return K!==0&&(_[A+K]=F-W<<24|64<<16|0),u.bits=J,0}},{"../utils/common":41}],51:[function(s,n,i){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(s,n,i){var o=s("../utils/common"),l=0,a=1;function c(x){for(var E=x.length;0<=--E;)x[E]=0}var p=0,d=29,m=256,y=m+1+d,h=30,_=19,b=2*y+1,N=15,u=16,v=7,g=256,w=16,k=17,A=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=new Array(2*(y+2));c(G);var F=new Array(2*h);c(F);var C=new Array(512);c(C);var j=new Array(256);c(j);var D=new Array(d);c(D);var J,q,W,$=new Array(h);function ne(x,E,H,ee,Z){this.static_tree=x,this.extra_bits=E,this.extra_base=H,this.elems=ee,this.max_length=Z,this.has_stree=x&&x.length}function K(x,E){this.dyn_tree=x,this.max_code=0,this.stat_desc=E}function P(x){return x<256?C[x]:C[256+(x>>>7)]}function Y(x,E){x.pending_buf[x.pending++]=255&E,x.pending_buf[x.pending++]=E>>>8&255}function re(x,E,H){x.bi_valid>u-H?(x.bi_buf|=E<<x.bi_valid&65535,Y(x,x.bi_buf),x.bi_buf=E>>u-x.bi_valid,x.bi_valid+=H-u):(x.bi_buf|=E<<x.bi_valid&65535,x.bi_valid+=H)}function le(x,E,H){re(x,H[2*E],H[2*E+1])}function se(x,E){for(var H=0;H|=1&x,x>>>=1,H<<=1,0<--E;);return H>>>1}function R(x,E,H){var ee,Z,ue=new Array(N+1),pe=0;for(ee=1;ee<=N;ee++)ue[ee]=pe=pe+H[ee-1]<<1;for(Z=0;Z<=E;Z++){var ie=x[2*Z+1];ie!==0&&(x[2*Z]=se(ue[ie]++,ie))}}function I(x){var E;for(E=0;E<y;E++)x.dyn_ltree[2*E]=0;for(E=0;E<h;E++)x.dyn_dtree[2*E]=0;for(E=0;E<_;E++)x.bl_tree[2*E]=0;x.dyn_ltree[2*g]=1,x.opt_len=x.static_len=0,x.last_lit=x.matches=0}function Q(x){8<x.bi_valid?Y(x,x.bi_buf):0<x.bi_valid&&(x.pending_buf[x.pending++]=x.bi_buf),x.bi_buf=0,x.bi_valid=0}function X(x,E,H,ee){var Z=2*E,ue=2*H;return x[Z]<x[ue]||x[Z]===x[ue]&&ee[E]<=ee[H]}function V(x,E,H){for(var ee=x.heap[H],Z=H<<1;Z<=x.heap_len&&(Z<x.heap_len&&X(E,x.heap[Z+1],x.heap[Z],x.depth)&&Z++,!X(E,ee,x.heap[Z],x.depth));)x.heap[H]=x.heap[Z],H=Z,Z<<=1;x.heap[H]=ee}function M(x,E,H){var ee,Z,ue,pe,ie=0;if(x.last_lit!==0)for(;ee=x.pending_buf[x.d_buf+2*ie]<<8|x.pending_buf[x.d_buf+2*ie+1],Z=x.pending_buf[x.l_buf+ie],ie++,ee===0?le(x,Z,E):(le(x,(ue=j[Z])+m+1,E),(pe=T[ue])!==0&&re(x,Z-=D[ue],pe),le(x,ue=P(--ee),H),(pe=z[ue])!==0&&re(x,ee-=$[ue],pe)),ie<x.last_lit;);le(x,g,E)}function oe(x,E){var H,ee,Z,ue=E.dyn_tree,pe=E.stat_desc.static_tree,ie=E.stat_desc.has_stree,ke=E.stat_desc.elems,Oe=-1;for(x.heap_len=0,x.heap_max=b,H=0;H<ke;H++)ue[2*H]!==0?(x.heap[++x.heap_len]=Oe=H,x.depth[H]=0):ue[2*H+1]=0;for(;x.heap_len<2;)ue[2*(Z=x.heap[++x.heap_len]=Oe<2?++Oe:0)]=1,x.depth[Z]=0,x.opt_len--,ie&&(x.static_len-=pe[2*Z+1]);for(E.max_code=Oe,H=x.heap_len>>1;1<=H;H--)V(x,ue,H);for(Z=ke;H=x.heap[1],x.heap[1]=x.heap[x.heap_len--],V(x,ue,1),ee=x.heap[1],x.heap[--x.heap_max]=H,x.heap[--x.heap_max]=ee,ue[2*Z]=ue[2*H]+ue[2*ee],x.depth[Z]=(x.depth[H]>=x.depth[ee]?x.depth[H]:x.depth[ee])+1,ue[2*H+1]=ue[2*ee+1]=Z,x.heap[1]=Z++,V(x,ue,1),2<=x.heap_len;);x.heap[--x.heap_max]=x.heap[1],(function(De,gt){var be,we,Se,ye,We,Ot,Qt=gt.dyn_tree,Pe=gt.max_code,Be=gt.stat_desc.static_tree,Ve=gt.stat_desc.has_stree,zt=gt.stat_desc.extra_bits,Gt=gt.stat_desc.extra_base,St=gt.stat_desc.max_length,hr=0;for(ye=0;ye<=N;ye++)De.bl_count[ye]=0;for(Qt[2*De.heap[De.heap_max]+1]=0,be=De.heap_max+1;be<b;be++)St<(ye=Qt[2*Qt[2*(we=De.heap[be])+1]+1]+1)&&(ye=St,hr++),Qt[2*we+1]=ye,Pe<we||(De.bl_count[ye]++,We=0,Gt<=we&&(We=zt[we-Gt]),Ot=Qt[2*we],De.opt_len+=Ot*(ye+We),Ve&&(De.static_len+=Ot*(Be[2*we+1]+We)));if(hr!==0){do{for(ye=St-1;De.bl_count[ye]===0;)ye--;De.bl_count[ye]--,De.bl_count[ye+1]+=2,De.bl_count[St]--,hr-=2}while(0<hr);for(ye=St;ye!==0;ye--)for(we=De.bl_count[ye];we!==0;)Pe<(Se=De.heap[--be])||(Qt[2*Se+1]!==ye&&(De.opt_len+=(ye-Qt[2*Se+1])*Qt[2*Se],Qt[2*Se+1]=ye),we--)}})(x,E),R(ue,Oe,x.bl_count)}function O(x,E,H){var ee,Z,ue=-1,pe=E[1],ie=0,ke=7,Oe=4;for(pe===0&&(ke=138,Oe=3),E[2*(H+1)+1]=65535,ee=0;ee<=H;ee++)Z=pe,pe=E[2*(ee+1)+1],++ie<ke&&Z===pe||(ie<Oe?x.bl_tree[2*Z]+=ie:Z!==0?(Z!==ue&&x.bl_tree[2*Z]++,x.bl_tree[2*w]++):ie<=10?x.bl_tree[2*k]++:x.bl_tree[2*A]++,ue=Z,Oe=(ie=0)===pe?(ke=138,3):Z===pe?(ke=6,3):(ke=7,4))}function ce(x,E,H){var ee,Z,ue=-1,pe=E[1],ie=0,ke=7,Oe=4;for(pe===0&&(ke=138,Oe=3),ee=0;ee<=H;ee++)if(Z=pe,pe=E[2*(ee+1)+1],!(++ie<ke&&Z===pe)){if(ie<Oe)for(;le(x,Z,x.bl_tree),--ie!=0;);else Z!==0?(Z!==ue&&(le(x,Z,x.bl_tree),ie--),le(x,w,x.bl_tree),re(x,ie-3,2)):ie<=10?(le(x,k,x.bl_tree),re(x,ie-3,3)):(le(x,A,x.bl_tree),re(x,ie-11,7));ue=Z,Oe=(ie=0)===pe?(ke=138,3):Z===pe?(ke=6,3):(ke=7,4)}}c($);var L=!1;function f(x,E,H,ee){re(x,(p<<1)+(ee?1:0),3),(function(Z,ue,pe,ie){Q(Z),Y(Z,pe),Y(Z,~pe),o.arraySet(Z.pending_buf,Z.window,ue,pe,Z.pending),Z.pending+=pe})(x,E,H)}i._tr_init=function(x){L||((function(){var E,H,ee,Z,ue,pe=new Array(N+1);for(Z=ee=0;Z<d-1;Z++)for(D[Z]=ee,E=0;E<1<<T[Z];E++)j[ee++]=Z;for(j[ee-1]=Z,Z=ue=0;Z<16;Z++)for($[Z]=ue,E=0;E<1<<z[Z];E++)C[ue++]=Z;for(ue>>=7;Z<h;Z++)for($[Z]=ue<<7,E=0;E<1<<z[Z]-7;E++)C[256+ue++]=Z;for(H=0;H<=N;H++)pe[H]=0;for(E=0;E<=143;)G[2*E+1]=8,E++,pe[8]++;for(;E<=255;)G[2*E+1]=9,E++,pe[9]++;for(;E<=279;)G[2*E+1]=7,E++,pe[7]++;for(;E<=287;)G[2*E+1]=8,E++,pe[8]++;for(R(G,y+1,pe),E=0;E<h;E++)F[2*E+1]=5,F[2*E]=se(E,5);J=new ne(G,T,m+1,y,N),q=new ne(F,z,0,h,N),W=new ne(new Array(0),S,0,_,v)})(),L=!0),x.l_desc=new K(x.dyn_ltree,J),x.d_desc=new K(x.dyn_dtree,q),x.bl_desc=new K(x.bl_tree,W),x.bi_buf=0,x.bi_valid=0,I(x)},i._tr_stored_block=f,i._tr_flush_block=function(x,E,H,ee){var Z,ue,pe=0;0<x.level?(x.strm.data_type===2&&(x.strm.data_type=(function(ie){var ke,Oe=4093624447;for(ke=0;ke<=31;ke++,Oe>>>=1)if(1&Oe&&ie.dyn_ltree[2*ke]!==0)return l;if(ie.dyn_ltree[18]!==0||ie.dyn_ltree[20]!==0||ie.dyn_ltree[26]!==0)return a;for(ke=32;ke<m;ke++)if(ie.dyn_ltree[2*ke]!==0)return a;return l})(x)),oe(x,x.l_desc),oe(x,x.d_desc),pe=(function(ie){var ke;for(O(ie,ie.dyn_ltree,ie.l_desc.max_code),O(ie,ie.dyn_dtree,ie.d_desc.max_code),oe(ie,ie.bl_desc),ke=_-1;3<=ke&&ie.bl_tree[2*U[ke]+1]===0;ke--);return ie.opt_len+=3*(ke+1)+5+5+4,ke})(x),Z=x.opt_len+3+7>>>3,(ue=x.static_len+3+7>>>3)<=Z&&(Z=ue)):Z=ue=H+5,H+4<=Z&&E!==-1?f(x,E,H,ee):x.strategy===4||ue===Z?(re(x,2+(ee?1:0),3),M(x,G,F)):(re(x,4+(ee?1:0),3),(function(ie,ke,Oe,De){var gt;for(re(ie,ke-257,5),re(ie,Oe-1,5),re(ie,De-4,4),gt=0;gt<De;gt++)re(ie,ie.bl_tree[2*U[gt]+1],3);ce(ie,ie.dyn_ltree,ke-1),ce(ie,ie.dyn_dtree,Oe-1)})(x,x.l_desc.max_code+1,x.d_desc.max_code+1,pe+1),M(x,x.dyn_ltree,x.dyn_dtree)),I(x),ee&&Q(x)},i._tr_tally=function(x,E,H){return x.pending_buf[x.d_buf+2*x.last_lit]=E>>>8&255,x.pending_buf[x.d_buf+2*x.last_lit+1]=255&E,x.pending_buf[x.l_buf+x.last_lit]=255&H,x.last_lit++,E===0?x.dyn_ltree[2*H]++:(x.matches++,E--,x.dyn_ltree[2*(j[H]+m+1)]++,x.dyn_dtree[2*P(E)]++),x.last_lit===x.lit_bufsize-1},i._tr_align=function(x){re(x,2,3),le(x,g,G),(function(E){E.bi_valid===16?(Y(E,E.bi_buf),E.bi_buf=0,E.bi_valid=0):8<=E.bi_valid&&(E.pending_buf[E.pending++]=255&E.bi_buf,E.bi_buf>>=8,E.bi_valid-=8)})(x)}},{"../utils/common":41}],53:[function(s,n,i){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(s,n,i){(function(o){(function(l,a){if(!l.setImmediate){var c,p,d,m,y=1,h={},_=!1,b=l.document,N=Object.getPrototypeOf&&Object.getPrototypeOf(l);N=N&&N.setTimeout?N:l,c={}.toString.call(l.process)==="[object process]"?function(w){Xe.nextTick(function(){v(w)})}:(function(){if(l.postMessage&&!l.importScripts){var w=!0,k=l.onmessage;return l.onmessage=function(){w=!1},l.postMessage("","*"),l.onmessage=k,w}})()?(m="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",g,!1):l.attachEvent("onmessage",g),function(w){l.postMessage(m+w,"*")}):l.MessageChannel?((d=new MessageChannel).port1.onmessage=function(w){v(w.data)},function(w){d.port2.postMessage(w)}):b&&"onreadystatechange"in b.createElement("script")?(p=b.documentElement,function(w){var k=b.createElement("script");k.onreadystatechange=function(){v(w),k.onreadystatechange=null,p.removeChild(k),k=null},p.appendChild(k)}):function(w){setTimeout(v,0,w)},N.setImmediate=function(w){typeof w!="function"&&(w=new Function(""+w));for(var k=new Array(arguments.length-1),A=0;A<k.length;A++)k[A]=arguments[A+1];var T={callback:w,args:k};return h[y]=T,c(y),y++},N.clearImmediate=u}function u(w){delete h[w]}function v(w){if(_)setTimeout(v,0,w);else{var k=h[w];if(k){_=!0;try{(function(A){var T=A.callback,z=A.args;switch(z.length){case 0:T();break;case 1:T(z[0]);break;case 2:T(z[0],z[1]);break;case 3:T(z[0],z[1],z[2]);break;default:T.apply(a,z)}})(k)}finally{u(w),_=!1}}}}function g(w){w.source===l&&typeof w.data=="string"&&w.data.indexOf(m)===0&&v(+w.data.slice(m.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof zr<"u"?zr:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Bl)),Bl.exports}var ek=Z_();const tk=Af(ek);var Sn={exports:{}},zl,vm;function rk(){if(vm)return zl;vm=1;var r={"&":"&amp;",'"':"&quot;","'":"&apos;","<":"&lt;",">":"&gt;"};function t(s){return s&&s.replace?s.replace(/([&"<>'])/g,function(n,i){return r[i]}):s}return zl=t,zl}var wm;function sk(){if(wm)return Sn.exports;wm=1;var r=rk(),t=hd().Stream,s="    ";function n(p,d){typeof d!="object"&&(d={indent:d});var m=d.stream?new t:null,y="",h=!1,_=d.indent?d.indent===!0?s:d.indent:"",b=!0;function N(k){b?Xe.nextTick(k):k()}function u(k,A){if(A!==void 0&&(y+=A),k&&!h&&(m=m||new t,h=!0),k&&h){var T=y;N(function(){m.emit("data",T)}),y=""}}function v(k,A){a(u,l(k,_,_?1:0),A)}function g(){if(m){var k=y;N(function(){m.emit("data",k),m.emit("end"),m.readable=!1,m.emit("close")})}}function w(k){var A=k.encoding||"UTF-8",T={version:"1.0",encoding:A};k.standalone&&(T.standalone=k.standalone),v({"?xml":{_attr:T}}),y=y.replace("/>","?>")}return N(function(){b=!1}),d.declaration&&w(d.declaration),p&&p.forEach?p.forEach(function(k,A){var T;A+1===p.length&&(T=g),v(k,T)}):v(p,g),m?(m.readable=!0,m):y}function i(){var p=Array.prototype.slice.call(arguments),d={_elem:l(p)};return d.push=function(m){if(!this.append)throw new Error("not assigned to a parent!");var y=this,h=this._elem.indent;a(this.append,l(m,h,this._elem.icount+(h?1:0)),function(){y.append(!0)})},d.close=function(m){m!==void 0&&this.push(m),this.end&&this.end()},d}function o(p,d){return new Array(d||0).join(p||"")}function l(p,d,m){m=m||0;var y=o(d,m),h,_=p,b=!1;if(typeof p=="object"){var N=Object.keys(p);if(h=N[0],_=p[h],_&&_._elem)return _._elem.name=h,_._elem.icount=m,_._elem.indent=d,_._elem.indents=y,_._elem.interrupt=_,_._elem}var u=[],v=[],g;function w(k){var A=Object.keys(k);A.forEach(function(T){u.push(c(T,k[T]))})}switch(typeof _){case"object":if(_===null)break;_._attr&&w(_._attr),_._cdata&&v.push(("<![CDATA["+_._cdata).replace(/\]\]>/g,"]]]]><![CDATA[>")+"]]>"),_.forEach&&(g=!1,v.push(""),_.forEach(function(k){if(typeof k=="object"){var A=Object.keys(k)[0];A=="_attr"?w(k._attr):v.push(l(k,d,m+1))}else v.pop(),g=!0,v.push(r(k))}),g||v.push(""));break;default:v.push(r(_))}return{name:h,interrupt:b,attributes:u,content:v,icount:m,indents:y,indent:d}}function a(p,d,m){if(typeof d!="object")return p(!1,d);var y=d.interrupt?1:d.content.length;function h(){for(;d.content.length;){var b=d.content.shift();if(b!==void 0){if(_(b))return;a(p,b)}}p(!1,(y>1?d.indents:"")+(d.name?"</"+d.name+">":"")+(d.indent&&!m?`
`:"")),m&&m()}function _(b){return b.interrupt?(b.interrupt.append=p,b.interrupt.end=h,b.interrupt=!1,p(!0),!0):!1}if(p(!1,d.indents+(d.name?"<"+d.name:"")+(d.attributes.length?" "+d.attributes.join(" "):"")+(y?d.name?">":"":d.name?"/>":"")+(d.indent&&y>1?`
`:"")),!y)return p(!1,d.indent?`
`:"");_(d)||h()}function c(p,d){return p+'="'+r(d)+'"'}return Sn.exports=n,Sn.exports.element=Sn.exports.Element=i,Sn.exports}var nk=sk();const yt=Af(nk),Cn=0,Ul=32,ik=32,ak=(r,t)=>{const s=t.replace(/-/g,"");if(s.length!==ik)throw new Error(`Error: Cannot extract GUID from font filename: ${t}`);const i=s.replace(/(..)/g,"$1 ").trim().split(" ").map(c=>parseInt(c,16));i.reverse();const l=r.slice(Cn,Ul).map((c,p)=>c^i[p%i.length]),a=new Uint8Array(Cn+l.length+Math.max(0,r.length-Ul));return a.set(r.slice(0,Cn)),a.set(l,Cn),a.set(r.slice(Ul),Cn+l.length),a};class ok{format(t,s={stack:[]}){const n=t.prepForXml(s);if(n)return n;throw Error("XMLComponent did not format correctly")}}class lk{replace(t,s,n){let i=t;return s.forEach((o,l)=>{i=i.replace(new RegExp(`{${o.fileName}}`,"g"),(n+l).toString())}),i}getMediaData(t,s){return s.Array.filter(n=>t.search(`{${n.fileName}}`)>0)}}class ck{replace(t,s){let n=t;for(const i of s)n=n.replace(new RegExp(`{${i.reference}-${i.instance}}`,"g"),i.numId.toString());return n}}class dk{constructor(){ve(this,"formatter"),ve(this,"imageReplacer"),ve(this,"numberingReplacer"),this.formatter=new ok,this.imageReplacer=new lk,this.numberingReplacer=new ck}compile(t,s,n=[]){const i=new tk,o=this.xmlifyFile(t,s),l=new Map(Object.entries(o));for(const[,a]of l)if(Array.isArray(a))for(const c of a)i.file(c.path,c.data);else i.file(a.path,a.data);for(const a of n)i.file(a.path,a.data);for(const a of t.Media.Array)a.type!=="svg"?i.file(`word/media/${a.fileName}`,a.data):(i.file(`word/media/${a.fileName}`,a.data),i.file(`word/media/${a.fallback.fileName}`,a.fallback.data));for(const{data:a,name:c,fontKey:p}of t.FontTable.fontOptionsWithKey){const[d]=c.split(".");i.file(`word/fonts/${d}.odttf`,ak(a,p))}return i}xmlifyFile(t,s){const n=t.Document.Relationships.RelationshipCount+1,i=yt(this.formatter.format(t.Document.View,{viewWrapper:t.Document,file:t,stack:[]}),{indent:s,declaration:{standalone:"yes",encoding:"UTF-8"}}),o=t.Comments.Relationships.RelationshipCount+1,l=yt(this.formatter.format(t.Comments,{viewWrapper:{View:t.Comments,Relationships:t.Comments.Relationships},file:t,stack:[]}),{indent:s,declaration:{standalone:"yes",encoding:"UTF-8"}}),a=this.imageReplacer.getMediaData(i,t.Media),c=this.imageReplacer.getMediaData(l,t.Media);return{Relationships:{data:(a.forEach((p,d)=>{t.Document.Relationships.createRelationship(n+d,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",`media/${p.fileName}`)}),t.Document.Relationships.createRelationship(t.Document.Relationships.RelationshipCount+1,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/fontTable","fontTable.xml"),yt(this.formatter.format(t.Document.Relationships,{viewWrapper:t.Document,file:t,stack:[]}),{indent:s,declaration:{encoding:"UTF-8"}})),path:"word/_rels/document.xml.rels"},Document:{data:(()=>{const p=this.imageReplacer.replace(i,a,n);return this.numberingReplacer.replace(p,t.Numbering.ConcreteNumbering)})(),path:"word/document.xml"},Styles:{data:(()=>{const p=yt(this.formatter.format(t.Styles,{viewWrapper:t.Document,file:t,stack:[]}),{indent:s,declaration:{standalone:"yes",encoding:"UTF-8"}});return this.numberingReplacer.replace(p,t.Numbering.ConcreteNumbering)})(),path:"word/styles.xml"},Properties:{data:yt(this.formatter.format(t.CoreProperties,{viewWrapper:t.Document,file:t,stack:[]}),{indent:s,declaration:{standalone:"yes",encoding:"UTF-8"}}),path:"docProps/core.xml"},Numbering:{data:yt(this.formatter.format(t.Numbering,{viewWrapper:t.Document,file:t,stack:[]}),{indent:s,declaration:{standalone:"yes",encoding:"UTF-8"}}),path:"word/numbering.xml"},FileRelationships:{data:yt(this.formatter.format(t.FileRelationships,{viewWrapper:t.Document,file:t,stack:[]}),{indent:s,declaration:{encoding:"UTF-8"}}),path:"_rels/.rels"},HeaderRelationships:t.Headers.map((p,d)=>{const m=yt(this.formatter.format(p.View,{viewWrapper:p,file:t,stack:[]}),{indent:s,declaration:{encoding:"UTF-8"}});return this.imageReplacer.getMediaData(m,t.Media).forEach((h,_)=>{p.Relationships.createRelationship(_,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",`media/${h.fileName}`)}),{data:yt(this.formatter.format(p.Relationships,{viewWrapper:p,file:t,stack:[]}),{indent:s,declaration:{encoding:"UTF-8"}}),path:`word/_rels/header${d+1}.xml.rels`}}),FooterRelationships:t.Footers.map((p,d)=>{const m=yt(this.formatter.format(p.View,{viewWrapper:p,file:t,stack:[]}),{indent:s,declaration:{encoding:"UTF-8"}});return this.imageReplacer.getMediaData(m,t.Media).forEach((h,_)=>{p.Relationships.createRelationship(_,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",`media/${h.fileName}`)}),{data:yt(this.formatter.format(p.Relationships,{viewWrapper:p,file:t,stack:[]}),{indent:s,declaration:{encoding:"UTF-8"}}),path:`word/_rels/footer${d+1}.xml.rels`}}),Headers:t.Headers.map((p,d)=>{const m=yt(this.formatter.format(p.View,{viewWrapper:p,file:t,stack:[]}),{indent:s,declaration:{encoding:"UTF-8"}}),y=this.imageReplacer.getMediaData(m,t.Media),h=this.imageReplacer.replace(m,y,0);return{data:this.numberingReplacer.replace(h,t.Numbering.ConcreteNumbering),path:`word/header${d+1}.xml`}}),Footers:t.Footers.map((p,d)=>{const m=yt(this.formatter.format(p.View,{viewWrapper:p,file:t,stack:[]}),{indent:s,declaration:{encoding:"UTF-8"}}),y=this.imageReplacer.getMediaData(m,t.Media),h=this.imageReplacer.replace(m,y,0);return{data:this.numberingReplacer.replace(h,t.Numbering.ConcreteNumbering),path:`word/footer${d+1}.xml`}}),ContentTypes:{data:yt(this.formatter.format(t.ContentTypes,{viewWrapper:t.Document,file:t,stack:[]}),{indent:s,declaration:{encoding:"UTF-8"}}),path:"[Content_Types].xml"},CustomProperties:{data:yt(this.formatter.format(t.CustomProperties,{viewWrapper:t.Document,file:t,stack:[]}),{indent:s,declaration:{standalone:"yes",encoding:"UTF-8"}}),path:"docProps/custom.xml"},AppProperties:{data:yt(this.formatter.format(t.AppProperties,{viewWrapper:t.Document,file:t,stack:[]}),{indent:s,declaration:{standalone:"yes",encoding:"UTF-8"}}),path:"docProps/app.xml"},FootNotes:{data:yt(this.formatter.format(t.FootNotes.View,{viewWrapper:t.FootNotes,file:t,stack:[]}),{indent:s,declaration:{encoding:"UTF-8"}}),path:"word/footnotes.xml"},FootNotesRelationships:{data:yt(this.formatter.format(t.FootNotes.Relationships,{viewWrapper:t.FootNotes,file:t,stack:[]}),{indent:s,declaration:{encoding:"UTF-8"}}),path:"word/_rels/footnotes.xml.rels"},Settings:{data:yt(this.formatter.format(t.Settings,{viewWrapper:t.Document,file:t,stack:[]}),{indent:s,declaration:{standalone:"yes",encoding:"UTF-8"}}),path:"word/settings.xml"},Comments:{data:(()=>{const p=this.imageReplacer.replace(l,c,o);return this.numberingReplacer.replace(p,t.Numbering.ConcreteNumbering)})(),path:"word/comments.xml"},CommentsRelationships:{data:(c.forEach((p,d)=>{t.Comments.Relationships.createRelationship(o+d,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",`media/${p.fileName}`)}),yt(this.formatter.format(t.Comments.Relationships,{viewWrapper:{View:t.Comments,Relationships:t.Comments.Relationships},file:t,stack:[]}),{indent:s,declaration:{encoding:"UTF-8"}})),path:"word/_rels/comments.xml.rels"},FontTable:{data:yt(this.formatter.format(t.FontTable.View,{viewWrapper:t.Document,file:t,stack:[]}),{indent:s,declaration:{standalone:"yes",encoding:"UTF-8"}}),path:"word/fontTable.xml"},FontTableRelationships:{data:yt(this.formatter.format(t.FontTable.Relationships,{viewWrapper:t.Document,file:t,stack:[]}),{indent:s,declaration:{encoding:"UTF-8"}}),path:"word/_rels/fontTable.xml.rels"}}}}const uk={WITH_2_BLANKS:"  "},jm=r=>r===!0?uk.WITH_2_BLANKS:r===!1?void 0:r,bg=class Zs{static pack(t,s,n){return kb(this,arguments,function*(i,o,l,a=[]){return this.compiler.compile(i,jm(l),a).generateAsync({type:o,mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",compression:"DEFLATE"})})}static toString(t,s,n=[]){return Zs.pack(t,"string",s,n)}static toBuffer(t,s,n=[]){return Zs.pack(t,"nodebuffer",s,n)}static toBase64String(t,s,n=[]){return Zs.pack(t,"base64",s,n)}static toBlob(t,s,n=[]){return Zs.pack(t,"blob",s,n)}static toArrayBuffer(t,s,n=[]){return Zs.pack(t,"arraybuffer",s,n)}static toStream(t,s,n=[]){const i=new Q_.Stream;return this.compiler.compile(t,jm(s),n).generateAsync({type:"nodebuffer",mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",compression:"DEFLATE"}).then(l=>{i.emit("data",l),i.emit("end")}),i}};ve(bg,"compiler",new dk);let hk=bg;const wd={classification:"UNCLASSIFIED",organizationName:"Intelligence Analysis Unit",analystName:"AI-Assisted Analysis",distributionStatement:"DISTRIBUTION AUTHORIZED TO U.S. GOVERNMENT AGENCIES ONLY",includeVisualizations:!0,includeAIAnalysis:!0};async function mk(r,t={}){const s={...wd,...t},n=new xa;let i=20;const o=(c,p,d,m,y=10)=>{n.setFontSize(y);const h=n.splitTextToSize(c,m);return n.text(h,p,d),d+h.length*y*.5};if(n.setFillColor(s.classification==="UNCLASSIFIED"?100:200,50,50),n.rect(0,0,210,15,"F"),n.setTextColor(255,255,255),n.setFontSize(12),n.setFont("helvetica","bold"),n.text(s.classification||"UNCLASSIFIED",105,10,{align:"center"}),n.setTextColor(0,0,0),i=25,n.setFontSize(16),n.setFont("helvetica","bold"),i=o(r.title,20,i,170,16),i+=5,n.setFontSize(9),n.setFont("helvetica","normal"),n.text(`Organization: ${s.organizationName}`,20,i),i+=5,n.text(`Analyst: ${s.analystName}`,20,i),i+=5,n.text(`Date: ${new Date().toLocaleDateString()}`,20,i),i+=5,r.updated_at&&(n.text(`Last Updated: ${new Date(r.updated_at).toLocaleDateString()}`,20,i),i+=5),i+=5,r.calculatedAssessment){const c=r.calculatedAssessment;n.setFillColor(c.riskLevel==="CRITICAL"?220:c.riskLevel==="HIGH"||c.riskLevel==="MEDIUM"?255:200,c.riskLevel==="CRITICAL"?50:c.riskLevel==="HIGH"?140:c.riskLevel==="MEDIUM"?200:220,c.riskLevel==="CRITICAL"||c.riskLevel==="HIGH"?50:200),n.rect(20,i,170,20,"F"),n.setTextColor(0,0,0),n.setFontSize(14),n.setFont("helvetica","bold"),n.text("BOTTOM LINE UP FRONT (BLUF)",105,i+7,{align:"center"}),n.setFontSize(18),n.text(`${c.overallLikelihood}% DECEPTION LIKELIHOOD`,105,i+15,{align:"center"}),n.setTextColor(0,0,0),i+=25}if(i>250&&(n.addPage(),i=20),n.setFontSize(12),n.setFont("helvetica","bold"),n.text("EXECUTIVE SUMMARY",20,i),i+=7,n.setFontSize(10),n.setFont("helvetica","normal"),r.aiAnalysis?.executiveSummary?i=o(r.aiAnalysis.executiveSummary,20,i,170):r.description&&(i=o(r.description,20,i,170)),i+=10,i>240&&(n.addPage(),i=20),n.setFontSize(12),n.setFont("helvetica","bold"),n.text("1. SCENARIO",20,i),i+=7,n.setFontSize(10),n.setFont("helvetica","normal"),i=o(r.scenario,20,i,170),i+=10,r.mom&&(i>240&&(n.addPage(),i=20),n.setFontSize(12),n.setFont("helvetica","bold"),n.text("2. MOM (MOTIVE, OPPORTUNITY, MEANS)",20,i),i+=7,n.setFontSize(10),n.setFont("helvetica","normal"),i=o(r.mom,20,i,170),i+=10),r.pop&&(i>240&&(n.addPage(),i=20),n.setFontSize(12),n.setFont("helvetica","bold"),n.text("3. POP (PATTERNS OF PRACTICE)",20,i),i+=7,n.setFontSize(10),n.setFont("helvetica","normal"),i=o(r.pop,20,i,170),i+=10),r.moses&&(i>240&&(n.addPage(),i=20),n.setFontSize(12),n.setFont("helvetica","bold"),n.text("4. MOSES (MY OWN SOURCES EVALUATION)",20,i),i+=7,n.setFontSize(10),n.setFont("helvetica","normal"),i=o(r.moses,20,i,170),i+=10),r.eve&&(i>240&&(n.addPage(),i=20),n.setFontSize(12),n.setFont("helvetica","bold"),n.text("5. EVE (EVALUATION OF EVIDENCE)",20,i),i+=7,n.setFontSize(10),n.setFont("helvetica","normal"),i=o(r.eve,20,i,170),i+=10),r.scores&&r.calculatedAssessment){i>200&&(n.addPage(),i=20),n.setFontSize(12),n.setFont("helvetica","bold"),n.text("6. DECEPTION SCORING MATRIX",20,i),i+=7;const c=[["Category","Criterion","Score","Weight"],["MOM","Motive",String(r.scores.motive||0),"10%"],["","Opportunity",String(r.scores.opportunity||0),"10%"],["","Means",String(r.scores.means||0),"10%"],["POP","Historical Pattern",String(r.scores.historicalPattern||0),"8.3%"],["","Sophistication",String(r.scores.sophisticationLevel||0),"8.3%"],["","Success Rate",String(r.scores.successRate||0),"8.3%"],["MOSES","Source Vulnerability",String(r.scores.sourceVulnerability||0),"12.5%"],["","Manipulation Evidence",String(r.scores.manipulationEvidence||0),"12.5%"],["EVE","Internal Consistency",String(r.scores.internalConsistency||0),"6.7%"],["","External Corroboration",String(r.scores.externalCorroboration||0),"6.7%"],["","Anomaly Detection",String(r.scores.anomalyDetection||0),"6.7%"],["","","",""],["OVERALL","Deception Likelihood",`${r.calculatedAssessment.overallLikelihood}%`,`${r.calculatedAssessment.riskLevel} RISK`]];Nc(n,{startY:i,head:[c[0]],body:c.slice(1),theme:"grid",styles:{fontSize:9},headStyles:{fillColor:[66,66,66]},columnStyles:{0:{cellWidth:30},1:{cellWidth:80},2:{cellWidth:25,halign:"center"},3:{cellWidth:25,halign:"center"}}}),i=n.lastAutoTable.finalY+10}s.includeAIAnalysis&&r.aiAnalysis&&(i>220&&(n.addPage(),i=20),n.setFontSize(12),n.setFont("helvetica","bold"),n.text("7. AI-GENERATED ANALYSIS",20,i),i+=7,r.aiAnalysis.keyIndicators.length>0&&(n.setFontSize(11),n.setFont("helvetica","bold"),n.text("Key Indicators:",25,i),i+=6,n.setFontSize(9),n.setFont("helvetica","normal"),r.aiAnalysis.keyIndicators.forEach(c=>{i>280&&(n.addPage(),i=20),i=o(`â€¢ ${c}`,30,i,160,9),i+=2}),i+=5),r.aiAnalysis.recommendations.length>0&&(i>250&&(n.addPage(),i=20),n.setFontSize(11),n.setFont("helvetica","bold"),n.text("Recommendations:",25,i),i+=6,n.setFontSize(9),n.setFont("helvetica","normal"),r.aiAnalysis.recommendations.forEach(c=>{i>280&&(n.addPage(),i=20),i=o(`â€¢ ${c}`,30,i,160,9),i+=2}),i+=5),r.aiAnalysis.collectionPriorities.length>0&&(i>250&&(n.addPage(),i=20),n.setFontSize(11),n.setFont("helvetica","bold"),n.text("Collection Priorities:",25,i),i+=6,n.setFontSize(9),n.setFont("helvetica","normal"),r.aiAnalysis.collectionPriorities.forEach(c=>{i>280&&(n.addPage(),i=20),i=o(`â€¢ ${c}`,30,i,160,9),i+=2})));const l=n.getNumberOfPages();for(let c=1;c<=l;c++)n.setPage(c),n.setFillColor(s.classification==="UNCLASSIFIED"?100:200,50,50),n.rect(0,282,210,15,"F"),n.setTextColor(255,255,255),n.setFontSize(10),n.setFont("helvetica","bold"),n.text(s.classification||"UNCLASSIFIED",105,290,{align:"center"}),n.setFontSize(8),n.text(`Page ${c} of ${l}`,190,290,{align:"right"});const a=`Deception_Analysis_${r.title.replace(/[^a-z0-9]/gi,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;n.save(a)}async function pk(r,t={}){const s={...wd,...t},n=[];if(n.push(new Fe({text:s.classification||"UNCLASSIFIED",heading:Sr.TITLE,alignment:or.CENTER,shading:{fill:s.classification==="UNCLASSIFIED"?"CCCCCC":"FF0000"}})),n.push(new Fe({text:""})),n.push(new Fe({text:r.title,heading:Sr.HEADING_1,alignment:or.CENTER})),n.push(new Fe({text:""})),n.push(new Fe({children:[new Vt({text:"Organization: ",bold:!0}),new Vt(s.organizationName||"")]}),new Fe({children:[new Vt({text:"Analyst: ",bold:!0}),new Vt(s.analystName||"")]}),new Fe({children:[new Vt({text:"Date: ",bold:!0}),new Vt(new Date().toLocaleDateString())]})),r.updated_at&&n.push(new Fe({children:[new Vt({text:"Last Updated: ",bold:!0}),new Vt(new Date(r.updated_at).toLocaleDateString())]})),n.push(new Fe({text:""})),r.calculatedAssessment&&n.push(new Fe({text:"BOTTOM LINE UP FRONT (BLUF)",heading:Sr.HEADING_2,shading:{fill:"EEEEEE"}}),new Fe({children:[new Vt({text:`${r.calculatedAssessment.overallLikelihood}% DECEPTION LIKELIHOOD - ${r.calculatedAssessment.riskLevel} RISK`,bold:!0,size:28})],alignment:or.CENTER}),new Fe({text:""})),n.push(new Fe({text:"EXECUTIVE SUMMARY",heading:Sr.HEADING_2})),r.aiAnalysis?.executiveSummary?n.push(new Fe({text:r.aiAnalysis.executiveSummary})):r.description&&n.push(new Fe({text:r.description})),n.push(new Fe({text:""})),n.push(new Fe({text:"1. SCENARIO",heading:Sr.HEADING_2}),new Fe({text:r.scenario}),new Fe({text:""})),r.mom&&n.push(new Fe({text:"2. MOM (MOTIVE, OPPORTUNITY, MEANS)",heading:Sr.HEADING_2}),new Fe({text:r.mom}),new Fe({text:""})),r.pop&&n.push(new Fe({text:"3. POP (PATTERNS OF PRACTICE)",heading:Sr.HEADING_2}),new Fe({text:r.pop}),new Fe({text:""})),r.moses&&n.push(new Fe({text:"4. MOSES (MY OWN SOURCES EVALUATION)",heading:Sr.HEADING_2}),new Fe({text:r.moses}),new Fe({text:""})),r.eve&&n.push(new Fe({text:"5. EVE (EVALUATION OF EVIDENCE)",heading:Sr.HEADING_2}),new Fe({text:r.eve}),new Fe({text:""})),r.scores&&r.calculatedAssessment){n.push(new Fe({text:"6. DECEPTION SCORING MATRIX",heading:Sr.HEADING_2}));const a=new Nj({rows:[new Ei({children:[new Zt({children:[new Fe({children:[new Vt({text:"Category",bold:!0})]})]}),new Zt({children:[new Fe({children:[new Vt({text:"Criterion",bold:!0})]})]}),new Zt({children:[new Fe({children:[new Vt({text:"Score",bold:!0})]})]}),new Zt({children:[new Fe({children:[new Vt({text:"Weight",bold:!0})]})]})]}),new Ei({children:[new Zt({children:[new Fe("MOM")],rowSpan:3}),new Zt({children:[new Fe("Motive")]}),new Zt({children:[new Fe(String(r.scores.motive||0))]}),new Zt({children:[new Fe("10%")]})]}),new Ei({children:[new Zt({children:[new Fe("Opportunity")]}),new Zt({children:[new Fe(String(r.scores.opportunity||0))]}),new Zt({children:[new Fe("10%")]})]}),new Ei({children:[new Zt({children:[new Fe("Means")]}),new Zt({children:[new Fe(String(r.scores.means||0))]}),new Zt({children:[new Fe("10%")]})]})],width:{size:100,type:la.PERCENTAGE}});n.push(a,new Fe({text:""}))}s.includeAIAnalysis&&r.aiAnalysis&&(n.push(new Fe({text:"7. AI-GENERATED ANALYSIS",heading:Sr.HEADING_2})),r.aiAnalysis.keyIndicators.length>0&&(n.push(new Fe({children:[new Vt({text:"Key Indicators:",bold:!0})]})),r.aiAnalysis.keyIndicators.forEach(a=>{n.push(new Fe({text:`â€¢ ${a}`,bullet:{level:0}}))}),n.push(new Fe({text:""}))),r.aiAnalysis.recommendations.length>0&&(n.push(new Fe({children:[new Vt({text:"Recommendations:",bold:!0})]})),r.aiAnalysis.recommendations.forEach(a=>{n.push(new Fe({text:`â€¢ ${a}`,bullet:{level:0}}))}))),n.push(new Fe({text:""}),new Fe({text:s.classification||"UNCLASSIFIED",alignment:or.CENTER,shading:{fill:s.classification==="UNCLASSIFIED"?"CCCCCC":"FF0000"}}));const i=new J_({sections:[{properties:{},children:n}]}),o=await hk.toBlob(i),l=`Deception_Analysis_${r.title.replace(/[^a-z0-9]/gi,"_")}_${new Date().toISOString().split("T")[0]}.docx`;Rm.saveAs(o,l)}async function fk(r,t={}){const s={...wd,...t},n=new xa;n.setFillColor(s.classification==="UNCLASSIFIED"?100:200,50,50),n.rect(0,0,210,15,"F"),n.setTextColor(255,255,255),n.setFontSize(12),n.setFont("helvetica","bold"),n.text(s.classification||"UNCLASSIFIED",105,10,{align:"center"}),n.setTextColor(0,0,0);let i=25;if(n.setFontSize(14),n.setFont("helvetica","bold"),n.text("EXECUTIVE BRIEFING",105,i,{align:"center"}),i+=8,n.setFontSize(12),n.text(r.title,105,i,{align:"center"}),i+=10,r.calculatedAssessment){const l=r.calculatedAssessment;n.setFillColor(l.riskLevel==="CRITICAL"?220:255,l.riskLevel==="CRITICAL"||l.riskLevel==="HIGH"?140:200,50),n.rect(20,i,170,25,"F"),n.setTextColor(0,0,0),n.setFontSize(11),n.setFont("helvetica","bold"),n.text("DECEPTION LIKELIHOOD",105,i+8,{align:"center"}),n.setFontSize(20),n.text(`${l.overallLikelihood}%`,105,i+18,{align:"center"}),n.setFontSize(10),n.text(`${l.riskLevel} RISK | ${l.confidenceLevel} CONFIDENCE`,105,i+23,{align:"center"}),n.setTextColor(0,0,0),i+=35}if(n.setFontSize(11),n.setFont("helvetica","bold"),n.text("EXECUTIVE SUMMARY",20,i),i+=7,n.setFontSize(9),n.setFont("helvetica","normal"),r.aiAnalysis?.executiveSummary){const l=n.splitTextToSize(r.aiAnalysis.executiveSummary,170);n.text(l,20,i),i+=l.length*4}i+=5,r.aiAnalysis?.keyIndicators&&r.aiAnalysis.keyIndicators.length>0&&(n.setFontSize(11),n.setFont("helvetica","bold"),n.text("KEY FINDINGS",20,i),i+=7,n.setFontSize(9),n.setFont("helvetica","normal"),r.aiAnalysis.keyIndicators.slice(0,3).forEach(l=>{const a=n.splitTextToSize(`â€¢ ${l}`,165);n.text(a,25,i),i+=a.length*4}),i+=5),r.aiAnalysis?.recommendations&&r.aiAnalysis.recommendations.length>0&&(n.setFontSize(11),n.setFont("helvetica","bold"),n.text("RECOMMENDATIONS",20,i),i+=7,n.setFontSize(9),n.setFont("helvetica","normal"),r.aiAnalysis.recommendations.slice(0,3).forEach(l=>{const a=n.splitTextToSize(`â€¢ ${l}`,165);n.text(a,25,i),i+=a.length*4})),n.setFillColor(s.classification==="UNCLASSIFIED"?100:200,50,50),n.rect(0,282,210,15,"F"),n.setTextColor(255,255,255),n.setFontSize(10),n.setFont("helvetica","bold"),n.text(s.classification||"UNCLASSIFIED",105,290,{align:"center"});const o=`Executive_Briefing_${r.title.replace(/[^a-z0-9]/gi,"_")}_${new Date().toISOString().split("T")[0]}.pdf`;n.save(o)}function gk({data:r,onEdit:t,onDelete:s,backPath:n="/dashboard/analysis-frameworks/deception"}){const[i,o]=B.useState(!1),[l,a]=B.useState("pdf"),[c,p]=B.useState("UNCLASSIFIED"),[d,m]=B.useState("Intelligence Analysis Unit"),[y,h]=B.useState("AI-Assisted Analysis"),[_,b]=B.useState(!1),[N,u]=B.useState([]),[v,g]=B.useState(!1),[w,k]=B.useState(!1),[A,T]=B.useState(!1),[z,S]=B.useState("data"),[U,G]=B.useState([]),F=r.calculatedAssessment||(r.scores&&Object.keys(r.scores).length>0?Gr(r.scores):null);B.useEffect(()=>{const W=N.filter(ne=>ne.entity_type==="actor"),$=N.filter(ne=>ne.entity_type==="event");W.length>0&&$.length>0&&F&&G([])},[N,F]),B.useEffect(()=>{(async()=>{if(r.id)try{const $=await fetch(`/api/framework-evidence?framework_id=${r.id}`);if($.ok){const K=((await $.json()).links||[]).map(P=>({entity_type:"data",entity_id:P.evidence_id,entity_data:{id:P.evidence_id,title:P.title,description:P.description,who:P.who,what:P.what,when_occurred:P.when_occurred,where_location:P.where_location,evidence_type:P.evidence_type,evidence_level:P.evidence_level,priority:P.priority,status:P.status,tags:P.tags},linked_at:P.created_at}));u(K)}}catch($){console.error("Failed to load linked evidence:",$)}})()},[r.id]);const C=(W,$)=>{const ne={entity_type:W,entity_id:$.id,entity_data:$,linked_at:new Date().toISOString()};u([...N,ne]),k(!0)},j=W=>{S(W),T(!0)},D=async()=>{b(!0);try{const W={...r,id:r.id,created_at:r.created_at,updated_at:r.updated_at,calculatedAssessment:F},$={classification:c,organizationName:d,analystName:y,includeVisualizations:!0,includeAIAnalysis:!0};l==="pdf"?await mk(W,$):l==="docx"?await pk(W,$):l==="briefing"&&await fk(W,$),o(!1)}catch(W){console.error("Export failed:",W),alert("Export failed. Please try again.")}finally{b(!1)}},J=async W=>{if(r.id)try{const $=W.map(K=>K.entity_id),ne=await fetch("/api/framework-evidence",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({framework_id:r.id,evidence_ids:$})});if(ne.ok)u([...N,...W]),console.log("Evidence linked successfully");else{const K=await ne.json();console.error("Failed to link evidence:",K),alert("Failed to link evidence. Please try again.")}}catch($){console.error("Error linking evidence:",$),alert("An error occurred while linking evidence.")}},q=async(W,$)=>{if(r.id)try{const ne=await fetch(`/api/framework-evidence?framework_id=${r.id}&evidence_id=${$}`,{method:"DELETE"});if(ne.ok)u(N.filter(K=>!(K.entity_type===W&&K.entity_id===$))),console.log("Evidence unlinked successfully");else{const K=await ne.json();console.error("Failed to unlink evidence:",K),alert("Failed to unlink evidence. Please try again.")}}catch(ne){console.error("Error unlinking evidence:",ne),alert("An error occurred while unlinking evidence.")}};return e.jsxs("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(te,{variant:"ghost",onClick:()=>window.location.href=n,className:"mb-4",children:[e.jsx(Ir,{className:"h-4 w-4 mr-2"}),"Back to Analyses"]}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:r.title}),e.jsx(Hm,{linkedEvidence:N,onClick:()=>k(!w),showBreakdown:!0,size:"lg"})]}),r.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:r.description}),e.jsxs("div",{className:"flex gap-2 mt-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Created ",new Date(r.created_at).toLocaleDateString()]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:["Updated ",new Date(r.updated_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ur,{children:[e.jsx(qr,{asChild:!0,children:e.jsxs(te,{variant:"outline",children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),"Create Entity"]})}),e.jsxs(Wr,{align:"end",children:[e.jsx(rt,{onClick:()=>j("data"),children:"Create Data"}),e.jsx(rt,{onClick:()=>j("actor"),children:"Create Actor"}),e.jsx(rt,{onClick:()=>j("source"),children:"Create Source"}),e.jsx(rt,{onClick:()=>j("event"),children:"Create Event"})]})]}),e.jsxs(te,{variant:"outline",onClick:()=>g(!0),children:[e.jsx(rr,{className:"h-4 w-4 mr-2"}),"Link Evidence"]}),e.jsx(Jm,{relationships:U,source:"MOM",onComplete:(W,$)=>{console.log(`Created ${W} relationships, ${$} failed`)},label:"Generate Relationships",variant:"outline",size:"default",disabled:U.length===0}),e.jsx(wa,{frameworkId:r.id,frameworkType:"deception",isPublic:r.is_public||!1,shareToken:r.share_token}),e.jsxs(wt,{open:i,onOpenChange:o,children:[e.jsx(Sm,{asChild:!0,children:e.jsxs(te,{variant:"outline",children:[e.jsx(ln,{className:"h-4 w-4 mr-2"}),"Export"]})}),e.jsxs(jt,{className:"sm:max-w-[500px]",children:[e.jsxs(_t,{children:[e.jsx(kt,{children:"Export Intelligence Report"}),e.jsx(It,{children:"Generate a professional intelligence report with classification markings"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"format",children:"Report Format"}),e.jsxs(ct,{value:l,onValueChange:W=>a(W),children:[e.jsx(dt,{id:"format",children:e.jsx(ut,{})}),e.jsxs(ht,{children:[e.jsx(Te,{value:"pdf",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(nr,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Full Report (PDF)"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Complete analysis with all sections"})]})]})}),e.jsx(Te,{value:"briefing",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(nr,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Executive Briefing (PDF)"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"1-page summary for commanders"})]})]})}),e.jsx(Te,{value:"docx",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ox,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Editable Report (DOCX)"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Microsoft Word format"})]})]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"classification",children:"Classification Level"}),e.jsxs(ct,{value:c,onValueChange:W=>p(W),children:[e.jsx(dt,{id:"classification",children:e.jsx(ut,{})}),e.jsxs(ht,{children:[e.jsx(Te,{value:"UNCLASSIFIED",children:"UNCLASSIFIED"}),e.jsx(Te,{value:"CONFIDENTIAL",children:"CONFIDENTIAL"}),e.jsx(Te,{value:"SECRET",children:"SECRET"}),e.jsx(Te,{value:"TOP SECRET",children:"TOP SECRET"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"org",children:"Organization Name"}),e.jsx(Ee,{id:"org",value:d,onChange:W=>m(W.target.value),placeholder:"Intelligence Analysis Unit"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"analyst",children:"Analyst Name"}),e.jsx(Ee,{id:"analyst",value:y,onChange:W=>h(W.target.value),placeholder:"AI-Assisted Analysis"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(te,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),e.jsx(te,{onClick:D,disabled:_,children:_?"Generating...":"Generate Report"})]})]})]}),e.jsxs(te,{variant:"outline",onClick:t,children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(te,{variant:"outline",onClick:s,className:"text-red-600 hover:text-red-700",children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“‹"}),"Scenario"]}),e.jsx(Le,{children:"Information or situation being analyzed for potential deception"})]}),e.jsx(xe,{children:e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx("p",{className:"whitespace-pre-wrap",children:r.scenario})})})]}),r.mom&&e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŽ¯"}),"MOM (Motive, Opportunity, Means)"]}),e.jsx(Le,{children:"Assessment of adversary's capability to deceive"})]}),e.jsx(xe,{children:e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx("p",{className:"whitespace-pre-wrap",children:r.mom})})})]}),r.pop&&e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“Š"}),"POP (Patterns of Practice)"]}),e.jsx(Le,{children:"Historical deception patterns of this actor"})]}),e.jsx(xe,{children:e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx("p",{className:"whitespace-pre-wrap",children:r.pop})})})]}),r.moses&&e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ”"}),"MOSES (My Own Sources Evaluation)"]}),e.jsx(Le,{children:"Vulnerability of information sources to manipulation"})]}),e.jsx(xe,{children:e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx("p",{className:"whitespace-pre-wrap",children:r.moses})})})]}),r.eve&&e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"âœ“"}),"EVE (Evaluation of Evidence)"]}),e.jsx(Le,{children:"Internal consistency and corroboration of evidence"})]}),e.jsx(xe,{children:e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx("p",{className:"whitespace-pre-wrap",children:r.eve})})})]}),r.assessment&&e.jsxs(ge,{className:"border-2 border-primary/20",children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ“"}),"Overall Assessment"]}),e.jsx(Le,{children:"Synthesized findings and deception likelihood determination"})]}),e.jsx(xe,{children:e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx("p",{className:"whitespace-pre-wrap",children:r.assessment})})})]}),r.aiAnalysis&&e.jsxs(ge,{className:"border-2 border-blue-500/30 bg-blue-50/50 dark:bg-blue-900/10",children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-5 w-5 text-blue-600"}),"AI-Generated Analysis"]}),e.jsx(Le,{children:"GPT-4 powered deception detection insights"})]}),e.jsxs(xe,{className:"space-y-6",children:[r.aiAnalysis.bottomLine&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:"Bottom Line Up Front (BLUF)"}),e.jsx("p",{className:"text-sm",children:r.aiAnalysis.bottomLine})]}),e.jsx(Cr,{})]}),!r.aiAnalysis.bottomLine&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-center py-4 text-sm text-muted-foreground",children:e.jsx("p",{children:"BLUF not generated. Run AI Analysis to generate comprehensive deception assessment."})}),e.jsx(Cr,{})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Executive Summary"}),e.jsx("p",{className:"text-sm",children:r.aiAnalysis.executiveSummary})]}),e.jsx(Cr,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Key Indicators"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm",children:r.aiAnalysis.keyIndicators.map((W,$)=>e.jsx("li",{children:W},$))})]}),r.aiAnalysis.counterIndicators.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Cr,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Counter-Indicators"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm",children:r.aiAnalysis.counterIndicators.map((W,$)=>e.jsx("li",{children:W},$))})]})]}),e.jsx(Cr,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Recommendations"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm",children:r.aiAnalysis.recommendations.map((W,$)=>e.jsx("li",{children:W},$))})]}),r.aiAnalysis.collectionPriorities.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Cr,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Collection Priorities"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm",children:r.aiAnalysis.collectionPriorities.map((W,$)=>e.jsx("li",{children:W},$))})]})]}),r.aiAnalysis.alternativeExplanations.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Cr,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Alternative Explanations"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm",children:r.aiAnalysis.alternativeExplanations.map((W,$)=>e.jsx("li",{children:W},$))})]})]}),e.jsx(Cr,{}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Trend Assessment"}),e.jsx(he,{variant:r.aiAnalysis.trendAssessment==="INCREASING"?"destructive":r.aiAnalysis.trendAssessment==="DECREASING"?"default":"secondary",children:r.aiAnalysis.trendAssessment})]})})]})]}),r.aiAnalysis&&e.jsxs(ge,{className:"border-2 border-purple-200 dark:border-purple-800",children:[e.jsxs(Ce,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-5 w-5 text-purple-600"}),"Predictions & Trend Analysis"]}),e.jsx(Le,{children:"Future risk projections and indicators to monitor"})]}),e.jsx(xe,{children:e.jsx(yb,{currentAnalysis:r.aiAnalysis,scenario:{scenario:r.scenario,mom:r.mom,pop:r.pop,moses:r.moses,eve:r.eve}})})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"sticky top-8",children:[r.scores&&F&&e.jsx(Ef,{scores:r.scores,assessment:F}),(!r.scores||!F)&&e.jsx(ge,{children:e.jsx(xe,{className:"text-center py-12",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"No scoring data available for this analysis. Complete the scoring section to see risk assessment dashboard."})})})]})})]}),e.jsx(Vm,{open:A,onClose:()=>T(!1),onEntityCreated:C,defaultTab:z,frameworkContext:{frameworkType:"deception",frameworkId:r.id?.toString()}}),e.jsx(Gn,{open:v,onClose:()=>g(!1),onLink:J,alreadyLinked:N,title:"Link Evidence to Deception Analysis",description:"Select evidence items (Data, Actors, Sources, Events) that support or inform this deception analysis"}),e.jsx(va,{entityType:"framework",entityId:r.id}),w&&e.jsx("div",{className:"fixed right-0 top-0 h-screen w-96 shadow-2xl z-50",children:e.jsx(Gm,{linkedEvidence:N,onUnlink:q,onClose:()=>k(!1),title:"Linked Evidence"})})]})}const xk=[1,2,3,4,5],yk=[1,3,5,8,12],Ii={impact_on_cog:{name:"Impact on COG (I)",definition:"How significantly would exploiting the vulnerability affect the COG's essential functionality or stability?",linear:{1:"Negligible - Minimal impact",2:"Minor - Some disruption",3:"Moderate - Noticeable degradation",4:"Major - Significant impairment",5:"Critical - Complete failure"},logarithmic:{1:"Negligible impact",3:"Minor disruption",5:"Moderate degradation",8:"Major impairment",12:"Critical failure or mission failure"}},attainability:{name:"Attainability (A)",definition:"How feasible is exploiting or mitigating this vulnerability with available resources, capabilities, and constraints?",linear:{1:"Very difficult - Requires extraordinary resources",2:"Difficult - Significant resources required",3:"Moderate - Standard resources needed",4:"Easy - Readily available resources",5:"Very easy - Minimal resources required"},logarithmic:{1:"Extreme difficulty",3:"Significant challenge",5:"Moderate effort",8:"Readily achievable",12:"Easily achievable with minimal resources"}},follow_up_potential:{name:"Potential for Follow-Up Actions (F)",definition:"What strategic advantages or additional actions does addressing this vulnerability enable?",linear:{1:"None - No follow-up opportunities",2:"Limited - Few additional options",3:"Moderate - Some strategic advantages",4:"Significant - Multiple follow-up options",5:"Extensive - Opens many strategic opportunities"},logarithmic:{1:"No follow-up potential",3:"Limited opportunities",5:"Moderate strategic advantage",8:"Significant cascading effects",12:"Transformational strategic advantage"}}};function bk(r){return r.impact_on_cog+r.attainability+r.follow_up_potential}function vk(r){return Object.values(r).reduce((t,s)=>t+s,0)}function vc(r){return r.scoring?bk(r.scoring):r.custom_scoring?vk(r.custom_scoring):0}function ql(r){return[...r].sort((t,s)=>s.composite_score-t.composite_score).map((t,s)=>({...t,priority_rank:s+1}))}function wk(r){const t=[];return r.critical_capabilities.forEach(s=>{t.push({source:s.cog_id,source_type:"cog",target:s.id,target_type:"capability",weight:s.composite_score||1,relationship:"enables"})}),r.critical_requirements.forEach(s=>{t.push({source:s.capability_id,source_type:"capability",target:s.id,target_type:"requirement",weight:1,relationship:"requires"})}),r.critical_vulnerabilities.forEach(s=>{t.push({source:s.requirement_id,source_type:"requirement",target:s.id,target_type:"vulnerability",weight:s.composite_score,relationship:"exposes"})}),t}function jk(r){const t=new Map,s=new Set;r.forEach(a=>{s.add(a.source),s.add(a.target),t.has(a.source)||t.set(a.source,new Set),t.get(a.source).add(a.target)});const n={};s.forEach(a=>{n[a]=t.get(a)?.size||0});const i={...n},o={...n},l={...n};return{degree_centrality:n,betweenness_centrality:i,closeness_centrality:o,eigenvector_centrality:l}}function _k({open:r,onClose:t,vulnerabilities:s,onUpdate:n,scoringSystem:i}){const{t:o}=Bt("cog"),[l,a]=B.useState(s),[c,p]=B.useState("custom"),d={high:{name:o("quickScore.presets.high.name"),description:o("quickScore.presets.high.description"),icon:Hr,color:"text-red-600",scores:{linear:{impact_on_cog:5,attainability:4,follow_up_potential:5}}},medium:{name:o("quickScore.presets.medium.name"),description:o("quickScore.presets.medium.description"),icon:fa,color:"text-yellow-600",scores:{linear:{impact_on_cog:3,attainability:3,follow_up_potential:3}}},low:{name:o("quickScore.presets.low.name"),description:o("quickScore.presets.low.description"),icon:Yn,color:"text-green-600",scores:{linear:{impact_on_cog:2,attainability:2,follow_up_potential:2}}}},m=(N,u)=>{if(u==="custom")return;const v=d[u].scores.linear,g=l.map(w=>w.id===N&&i!=="custom"?{...w,scoring:v,composite_score:vc({...w,scoring:v})}:w);a(g)},y=(N,u,v)=>{const g=l.map(w=>{if(w.id===N&&w.scoring){const k={...w.scoring,[u]:v};return{...w,scoring:k,composite_score:vc({...w,scoring:k})}}return w});a(g)},h=()=>{n(l),t()},_=()=>[...l].sort((N,u)=>u.composite_score-N.composite_score),b=N=>N>=12?"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200":N>=9?"bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200":N>=6?"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200":"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200";return i==="custom"?e.jsx(wt,{open:r,onOpenChange:t,children:e.jsxs(jt,{children:[e.jsxs(_t,{children:[e.jsx(kt,{children:o("quickScore.dialog.title")}),e.jsx(It,{children:o("quickScore.dialog.customSystemNotSupported")})]}),e.jsx(Wn,{children:e.jsx(te,{onClick:t,children:o("common.close")})})]})}):e.jsx(wt,{open:r,onOpenChange:t,children:e.jsxs(jt,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsxs(kt,{className:"flex items-center gap-2",children:[e.jsx(Vi,{className:"h-5 w-5 text-yellow-500"}),o("quickScore.dialog.title")]}),e.jsx(It,{children:o("quickScore.dialog.description")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(ge,{className:"bg-blue-50 dark:bg-blue-950",children:[e.jsx(Ce,{className:"pb-3",children:e.jsx(Ae,{className:"text-sm",children:o("quickScore.legend.title")})}),e.jsx(xe,{children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(d).map(([N,u])=>{const v=u.icon;return e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(v,{className:`h-4 w-4 ${u.color}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:u.name}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:u.description})]})]},N)})})})]}),e.jsxs("div",{className:"space-y-2",children:[_().map((N,u)=>e.jsx(ge,{className:"bg-gray-50 dark:bg-gray-900",children:e.jsx(xe,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs(he,{variant:"outline",className:"text-xs",children:["#",u+1]}),e.jsx(he,{className:b(N.composite_score),children:o("quickScore.labels.score",{score:N.composite_score})})]}),e.jsx("h4",{className:"font-semibold text-sm mb-1",children:N.vulnerability}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 line-clamp-1",children:N.description})]}),e.jsxs(ct,{value:"custom",onValueChange:v=>m(N.id,v),children:[e.jsx(dt,{className:"w-40",children:e.jsx(ut,{placeholder:o("quickScore.select.placeholder")})}),e.jsxs(ht,{children:[e.jsx(Te,{value:"custom",children:o("quickScore.select.custom")}),e.jsx(Te,{value:"high",children:o("quickScore.select.highPriority")}),e.jsx(Te,{value:"medium",children:o("quickScore.select.mediumPriority")}),e.jsx(Te,{value:"low",children:o("quickScore.select.lowPriority")})]})]})]}),N.scoring&&e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium",children:o("quickScore.sliders.impact")}),e.jsx(he,{variant:"outline",className:"text-xs",children:N.scoring.impact_on_cog})]}),e.jsx(ys,{value:[N.scoring.impact_on_cog],onValueChange:([v])=>y(N.id,"impact_on_cog",v),min:1,max:i==="linear"?5:12,step:1,className:"cursor-pointer"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium",children:o("quickScore.sliders.attainability")}),e.jsx(he,{variant:"outline",className:"text-xs",children:N.scoring.attainability})]}),e.jsx(ys,{value:[N.scoring.attainability],onValueChange:([v])=>y(N.id,"attainability",v),min:1,max:i==="linear"?5:12,step:1,className:"cursor-pointer"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium",children:o("quickScore.sliders.followUp")}),e.jsx(he,{variant:"outline",className:"text-xs",children:N.scoring.follow_up_potential})]}),e.jsx(ys,{value:[N.scoring.follow_up_potential],onValueChange:([v])=>y(N.id,"follow_up_potential",v),min:1,max:i==="linear"?5:12,step:1,className:"cursor-pointer"})]})]})]})})},N.id)),l.length===0&&e.jsx(ge,{children:e.jsx(xe,{className:"text-center py-8 text-gray-500",children:o("quickScore.emptyState")})})]})]}),e.jsxs(Wn,{children:[e.jsx(te,{variant:"outline",onClick:t,children:o("common.cancel")}),e.jsxs(te,{onClick:h,children:[e.jsx(Vi,{className:"h-4 w-4 mr-2"}),o("quickScore.buttons.applyScores")]})]})]})})}function kk(){const{enabled:r,loading:t}=Sc(),[s,n]=B.useState(!1),[i,o]=B.useState(null),l=B.useCallback(async y=>{if(!r)return o("AI features are not enabled"),null;n(!0),o(null);try{const h=await fetch("/api/ai/cog-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"suggest-cog",context:y})});if(!h.ok){const b=await h.json().catch(()=>({message:"Failed to suggest COGs"}));throw new Error(b.message||"COG suggestion failed")}return(await h.json()).result}catch(h){const _=h instanceof Error?h.message:"COG suggestion failed";return o(_),console.error("COG suggestion error:",h),null}finally{n(!1)}},[r]),a=B.useCallback(async(y,h)=>{if(!r)return o("AI features are not enabled"),null;n(!0),o(null);try{const _=await fetch("/api/ai/cog-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"validate-cog",cog:y,context:h})});if(!_.ok){const N=await _.json().catch(()=>({message:"Failed to validate COG"}));throw new Error(N.message||"COG validation failed")}return(await _.json()).result}catch(_){const b=_ instanceof Error?_.message:"COG validation failed";return o(b),console.error("COG validation error:",_),null}finally{n(!1)}},[r]),c=B.useCallback(async(y,h)=>{if(!r)return o("AI features are not enabled"),null;n(!0),o(null);try{const _=await fetch("/api/ai/cog-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"generate-capabilities",cog:y,context:h})});if(!_.ok){const N=await _.json().catch(()=>({message:"Failed to generate capabilities"}));throw new Error(N.message||"Capability generation failed")}return(await _.json()).result}catch(_){const b=_ instanceof Error?_.message:"Capability generation failed";return o(b),console.error("Capability generation error:",_),null}finally{n(!1)}},[r]),p=B.useCallback(async(y,h,_)=>{if(!r)return o("AI features are not enabled"),null;n(!0),o(null);try{const b=await fetch("/api/ai/cog-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"generate-requirements",capability:y,cog:h,context:_})});if(!b.ok){const u=await b.json().catch(()=>({message:"Failed to generate requirements"}));throw new Error(u.message||"Requirements generation failed")}return(await b.json()).result}catch(b){const N=b instanceof Error?b.message:"Requirements generation failed";return o(N),console.error("Requirements generation error:",b),null}finally{n(!1)}},[r]),d=B.useCallback(async(y,h,_,b)=>{if(!r)return o("AI features are not enabled"),null;n(!0),o(null);try{const N=await fetch("/api/ai/cog-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"generate-vulnerabilities",requirement:y,capability:h,cog:_,context:b})});if(!N.ok){const v=await N.json().catch(()=>({message:"Failed to generate vulnerabilities"}));throw new Error(v.message||"Vulnerabilities generation failed")}return(await N.json()).result}catch(N){const u=N instanceof Error?N.message:"Vulnerabilities generation failed";return o(u),console.error("Vulnerabilities generation error:",N),null}finally{n(!1)}},[r]),m=B.useCallback(async(y,h,_,b,N)=>{if(!r)return o("AI features are not enabled"),null;n(!0),o(null);try{const u=await fetch("/api/ai/cog-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"generate-impact",requirement:y,capabilities:h,requirements:_,cog:b,context:N})});if(!u.ok){const g=await u.json().catch(()=>({message:"Failed to generate impact analysis"}));throw new Error(g.message||"Impact analysis failed")}return(await u.json()).result}catch(u){const v=u instanceof Error?u.message:"Impact analysis failed";return o(v),console.error("Impact analysis error:",u),null}finally{n(!1)}},[r]);return{enabled:r,loading:t,analyzing:s,error:i,suggestCOGs:l,validateCOG:a,generateCapabilities:c,generateRequirements:p,generateVulnerabilities:d,generateImpact:m}}function rs({mode:r,context:t,cog:s,capability:n,requirement:i,capabilities:o,requirements:l,onAccept:a,buttonText:c,buttonVariant:p="outline",buttonSize:d="sm"}){const{t:m}=Bt("cog"),[y,h]=B.useState(!1),[_,b]=B.useState(null),[N,u]=B.useState(null),{enabled:v,analyzing:g,error:w,suggestCOGs:k,validateCOG:A,generateCapabilities:T,generateRequirements:z,generateVulnerabilities:S,generateImpact:U}=kk(),{toast:G}=jc(),F=async()=>{b(null),u(null);let W=null;try{switch(r){case"suggest-cog":W=await k(t||{});break;case"validate-cog":if(!s){G({title:m("common.error"),description:m("aiAssistant.errors.cogRequired"),variant:"destructive"});return}W=await A(s,t);break;case"generate-capabilities":if(!s){G({title:m("common.error"),description:m("aiAssistant.errors.cogRequiredForCapabilities"),variant:"destructive"});return}W=await T(s,t);break;case"generate-requirements":if(!n){G({title:m("common.error"),description:m("aiAssistant.errors.capabilityRequired"),variant:"destructive"});return}W=await z(n,s,t);break;case"generate-vulnerabilities":if(!i){G({title:m("common.error"),description:m("aiAssistant.errors.requirementRequired"),variant:"destructive"});return}W=await S(i,n,s,t);break;case"generate-impact":if(!i||!o||o.length===0){G({title:m("common.error"),description:m("aiAssistant.errors.vulnerabilityAndCapabilitiesRequired"),variant:"destructive"});return}W=await U(i,o,l,s,t);break}b(W),W||G({title:m("aiAssistant.noResults.title"),description:m("aiAssistant.noResults.description"),variant:"destructive"})}catch($){console.error("AI generation error:",$)}},C=()=>{h(!0),_||F()},j=W=>{a(W||_),h(!1),G({title:m("aiAssistant.acceptToast.title"),description:m("aiAssistant.acceptToast.description")})};if(!v)return null;const D=()=>{switch(r){case"suggest-cog":return m("aiAssistant.modes.suggestCog.title");case"validate-cog":return m("aiAssistant.modes.validateCog.title");case"generate-capabilities":return m("aiAssistant.modes.generateCapabilities.title");case"generate-requirements":return m("aiAssistant.modes.generateRequirements.title");case"generate-vulnerabilities":return m("aiAssistant.modes.generateVulnerabilities.title");case"generate-impact":return m("aiAssistant.modes.generateImpact.title");default:return m("aiAssistant.modes.default.title")}},J=()=>{switch(r){case"suggest-cog":return m("aiAssistant.modes.suggestCog.description");case"validate-cog":return m("aiAssistant.modes.validateCog.description");case"generate-capabilities":return m("aiAssistant.modes.generateCapabilities.description");case"generate-requirements":return m("aiAssistant.modes.generateRequirements.description");case"generate-vulnerabilities":return m("aiAssistant.modes.generateVulnerabilities.description");case"generate-impact":return m("aiAssistant.modes.generateImpact.description");default:return m("aiAssistant.modes.default.description")}},q=()=>{switch(r){case"suggest-cog":return m("aiAssistant.modes.suggestCog.button");case"validate-cog":return m("aiAssistant.modes.validateCog.button");case"generate-capabilities":return m("aiAssistant.modes.generateCapabilities.button");case"generate-requirements":return m("aiAssistant.modes.generateRequirements.button");case"generate-vulnerabilities":return m("aiAssistant.modes.generateVulnerabilities.button");case"generate-impact":return m("aiAssistant.modes.generateImpact.button");default:return m("aiAssistant.modes.default.button")}};return e.jsxs(e.Fragment,{children:[e.jsxs(te,{variant:p,size:d,onClick:C,disabled:!v,children:[e.jsx(ft,{className:"h-4 w-4 mr-1"}),c||q()]}),e.jsx(wt,{open:y,onOpenChange:h,children:e.jsxs(jt,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsxs(kt,{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-5 w-5 text-purple-600"}),D()]}),e.jsx(It,{children:J()})]}),e.jsxs("div",{className:"space-y-4",children:[g&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-3",children:[e.jsx(xt,{className:"h-8 w-8 animate-spin text-purple-600"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m("aiAssistant.analyzing")})]}),w&&!g&&e.jsx("div",{className:"bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(wr,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-red-900 dark:text-red-100",children:m("aiAssistant.analysisFailed")}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:w}),e.jsx(te,{variant:"outline",size:"sm",onClick:F,className:"mt-3",children:m("aiAssistant.tryAgain")})]})]})}),_&&!g&&e.jsxs("div",{className:"space-y-4",children:[r==="suggest-cog"&&Array.isArray(_)&&e.jsx("div",{className:"space-y-3",children:_.map((W,$)=>e.jsx("div",{className:"border rounded-lg p-4 hover:border-purple-300 dark:hover:border-purple-700 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{variant:"secondary",children:W.actor}),e.jsx(he,{variant:"outline",children:W.domain})]}),e.jsx("h4",{className:"font-semibold text-lg",children:W.description}),e.jsx("p",{className:"text-sm text-muted-foreground",children:W.rationale})]}),e.jsxs(te,{size:"sm",onClick:()=>j(W),children:[e.jsx($t,{className:"h-4 w-4 mr-1"}),m("aiAssistant.useThis")]})]})},$))}),r==="validate-cog"&&_.criteria&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg border-2 ${_.isValid?"bg-green-50 dark:bg-green-950 border-green-300 dark:border-green-700":"bg-yellow-50 dark:bg-yellow-950 border-yellow-300 dark:border-yellow-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[_.isValid?e.jsx($t,{className:"h-5 w-5 text-green-600"}):e.jsx(wr,{className:"h-5 w-5 text-yellow-600"}),e.jsx("h4",{className:"font-semibold",children:_.isValid?m("aiAssistant.validation.validCog"):m("aiAssistant.validation.needsRefinement")})]}),e.jsx("p",{className:"text-sm",children:_.overallAssessment})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"font-semibold text-sm",children:m("aiAssistant.validation.criteria")}),Object.entries(_.criteria).map(([W,$])=>e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[$.passes?e.jsx($t,{className:"h-4 w-4 text-green-600 flex-shrink-0 mt-0.5"}):e.jsx(Ze,{className:"h-4 w-4 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium capitalize",children:[W.replace(/([A-Z])/g," $1"),": "]}),e.jsx("span",{className:"text-muted-foreground",children:$.explanation})]})]},W))]}),_.recommendations&&_.recommendations.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"font-semibold text-sm",children:m("aiAssistant.validation.recommendations")}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground",children:_.recommendations.map((W,$)=>e.jsx("li",{children:W},$))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{onClick:()=>j(),disabled:!_.isValid,children:[e.jsx($t,{className:"h-4 w-4 mr-1"}),m("aiAssistant.validation.acceptValidation")]}),e.jsx(te,{variant:"outline",onClick:F,children:m("aiAssistant.validation.revalidate")})]})]}),(r==="generate-capabilities"||r==="generate-requirements"||r==="generate-vulnerabilities")&&Array.isArray(_)&&e.jsxs("div",{className:"space-y-3",children:[_.map((W,$)=>{const ne=N===$,K=W.capability||W.requirement||W.vulnerability;return e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[W.type&&e.jsx(he,{variant:"secondary",className:"text-xs",children:W.type}),W.confidence&&e.jsx(he,{variant:"outline",className:"text-xs",children:W.confidence})]}),e.jsx("h4",{className:"font-semibold",children:K}),W.description&&!ne&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:W.description})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx(te,{size:"icon",variant:"ghost",onClick:()=>u(ne?null:$),children:ne?e.jsx(Vl,{className:"h-4 w-4"}):e.jsx(es,{className:"h-4 w-4"})}),e.jsx(te,{size:"sm",onClick:()=>j(W),children:e.jsx($t,{className:"h-4 w-4"})})]})]}),ne&&e.jsxs("div",{className:"mt-4 space-y-3 text-sm",children:[W.description&&e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[m("aiAssistant.details.description"),": "]}),e.jsx("span",{className:"text-muted-foreground",children:W.description})]}),W.expectedEffect&&e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[m("aiAssistant.details.expectedEffect"),": "]}),e.jsx("span",{className:"text-muted-foreground",children:W.expectedEffect})]}),W.recommendedActions&&e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[m("aiAssistant.details.recommendedActions"),":"]}),e.jsx("ul",{className:"list-disc list-inside mt-1 text-muted-foreground",children:W.recommendedActions.map((P,Y)=>e.jsx("li",{children:P},Y))})]}),W.scoring&&e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[e.jsxs("div",{className:"text-center p-2 bg-blue-50 dark:bg-blue-950 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:m("scoring.impact")}),e.jsxs("div",{className:"font-semibold",children:[W.scoring.impact_on_cog,"/5"]})]}),e.jsxs("div",{className:"text-center p-2 bg-green-50 dark:bg-green-950 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:m("scoring.attainability")}),e.jsxs("div",{className:"font-semibold",children:[W.scoring.attainability,"/5"]})]}),e.jsxs("div",{className:"text-center p-2 bg-purple-50 dark:bg-purple-950 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:m("scoring.followUp")}),e.jsxs("div",{className:"font-semibold",children:[W.scoring.follow_up_potential,"/5"]})]})]})]})]})},$)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{onClick:()=>j(_),children:[e.jsx($t,{className:"h-4 w-4 mr-1"}),m("aiAssistant.acceptAll",{count:_.length})]}),e.jsx(te,{variant:"outline",onClick:F,children:m("aiAssistant.regenerate")})]})]}),r==="generate-impact"&&_.expectedEffect&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"font-semibold text-sm mb-2",children:[m("aiAssistant.impact.expectedEffect"),":"]}),e.jsx("p",{className:"text-sm",children:_.expectedEffect})]}),_.cascadingEffects&&e.jsxs("div",{children:[e.jsxs("h5",{className:"font-semibold text-sm mb-2",children:[m("aiAssistant.impact.cascadingEffects"),":"]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground",children:_.cascadingEffects.map((W,$)=>e.jsx("li",{children:W},$))})]}),_.recommendedActions&&e.jsxs("div",{children:[e.jsxs("h5",{className:"font-semibold text-sm mb-2",children:[m("aiAssistant.impact.recommendedActions"),":"]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground",children:_.recommendedActions.map((W,$)=>e.jsx("li",{children:W},$))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-900 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:m("aiAssistant.impact.confidence")}),e.jsx("div",{className:"font-semibold capitalize",children:_.confidence}),_.confidenceRationale&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:_.confidenceRationale})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-900 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:m("aiAssistant.impact.timeToEffect")}),e.jsx("div",{className:"font-semibold capitalize",children:_.timeToEffect})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-900 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:m("aiAssistant.impact.reversibility")}),e.jsx("div",{className:"font-semibold capitalize",children:_.reversibility})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-900 rounded",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:m("aiAssistant.impact.riskToFriendlyForces")}),e.jsx("div",{className:"font-semibold capitalize",children:_.riskToFriendlyForces})]})]}),_.considerations&&e.jsxs("div",{children:[e.jsxs("h5",{className:"font-semibold text-sm mb-2",children:[m("aiAssistant.impact.considerations"),":"]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground",children:_.considerations.map((W,$)=>e.jsx("li",{children:W},$))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{onClick:()=>j(),children:[e.jsx($t,{className:"h-4 w-4 mr-1"}),m("aiAssistant.impact.acceptAnalysis")]}),e.jsx(te,{variant:"outline",onClick:F,children:m("aiAssistant.regenerate")})]})]})]})]})]})})]})}function _m({initialData:r,mode:t,onSave:s,backPath:n,frameworkId:i}){const o=xr(),{t:l}=Bt("cog"),[a,c]=B.useState(!1),[p,d]=B.useState("context"),m=[{value:"friendly",label:l("actorCategories.friendly")},{value:"adversary",label:l("actorCategories.adversary")},{value:"host_nation",label:l("actorCategories.hostNation")},{value:"third_party",label:l("actorCategories.thirdParty")}],y=[{value:"diplomatic",label:l("domains.diplomatic"),icon:"ðŸ¤"},{value:"information",label:l("domains.information"),icon:"ðŸ“¡"},{value:"military",label:l("domains.military"),icon:"ðŸŽ–ï¸"},{value:"economic",label:l("domains.economic"),icon:"ðŸ’°"},{value:"financial",label:l("domains.financial"),icon:"ðŸ’µ"},{value:"intelligence",label:l("domains.intelligence"),icon:"ðŸ”"},{value:"law_enforcement",label:l("domains.lawEnforcement"),icon:"ðŸ‘®"},{value:"cyber",label:l("domains.cyber"),icon:"ðŸ’»"},{value:"space",label:l("domains.space"),icon:"ðŸ›°ï¸"}],h=[{value:"personnel",label:l("form.requirementTypes.personnel")},{value:"equipment",label:l("form.requirementTypes.equipment")},{value:"logistics",label:l("form.requirementTypes.logistics")},{value:"information",label:l("form.requirementTypes.information")},{value:"infrastructure",label:l("form.requirementTypes.infrastructure")},{value:"other",label:l("form.requirementTypes.other")}],_=[{value:"physical",label:l("form.vulnerabilityTypes.physical")},{value:"cyber",label:l("form.vulnerabilityTypes.cyber")},{value:"human",label:l("form.vulnerabilityTypes.human")},{value:"logistical",label:l("form.vulnerabilityTypes.logistical")},{value:"informational",label:l("form.vulnerabilityTypes.informational")},{value:"other",label:l("form.vulnerabilityTypes.other")}],b=[{value:"tactical",label:l("form.strategicLevels.tactical")},{value:"operational",label:l("form.strategicLevels.operational")},{value:"strategic",label:l("form.strategicLevels.strategic")}],[N,u]=B.useState(r?.title||""),[v,g]=B.useState(r?.description||""),[w,k]=B.useState(r?.operational_context||{objective:"",desired_impact:"",our_identity:"",operating_environment:"",constraints:[],restraints:[],timeframe:"",strategic_level:"operational"}),[A,T]=B.useState(r?.scoring_system||"linear"),[z,S]=B.useState(r?.custom_criteria||[{id:"criterion1",name:"Impact",definition:"How significantly would this affect the objective?"},{id:"criterion2",name:"Feasibility",definition:"How feasible is addressing this?"},{id:"criterion3",name:"Follow-up",definition:"What strategic advantages does this enable?"}]),[U,G]=B.useState(r?.centers_of_gravity||[]),[F,C]=B.useState(r?.critical_capabilities||[]),[j,D]=B.useState(r?.critical_requirements||[]),[J,q]=B.useState(r?.critical_vulnerabilities||[]),[W,$]=B.useState(new Set),[ne,K]=B.useState(new Set),[P,Y]=B.useState(new Set),[re,le]=B.useState(new Set),[se,R]=B.useState(!1),[I,Q]=B.useState(!1),[X,V]=B.useState(null),M=async()=>{if(!N.trim()){alert(l("form.validation.titleRequired"));return}c(!0);try{const be={id:i||crypto.randomUUID(),title:N.trim(),description:v.trim(),operational_context:w,scoring_system:A,custom_criteria:A==="custom"?z:void 0,centers_of_gravity:U,critical_capabilities:F,critical_requirements:j,critical_vulnerabilities:J,created_at:r?.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),created_by:r?.created_by||1,status:"active"};await s(be),o(n)}catch(be){console.error("Failed to save COG analysis:",be),alert(l("form.validation.saveFailed"))}finally{c(!1)}},oe=()=>{const be={id:crypto.randomUUID(),actor_category:"friendly",domain:"military",description:"",rationale:"",linked_evidence:[]};G([...U,be]),$(new Set([...W,be.id]))},O=(be,we)=>{G(U.map(Se=>Se.id===be?{...Se,...we}:Se))},ce=be=>{if(!confirm(l("form.confirmations.removeCOG")))return;G(U.filter(ye=>ye.id!==be));const we=F.filter(ye=>ye.cog_id===be).map(ye=>ye.id);C(F.filter(ye=>ye.cog_id!==be));const Se=j.filter(ye=>we.includes(ye.capability_id)).map(ye=>ye.id);D(j.filter(ye=>!we.includes(ye.capability_id))),q(J.filter(ye=>!Se.includes(ye.requirement_id)))},L=be=>{const we={id:crypto.randomUUID(),cog_id:be,capability:"",description:"",strategic_contribution:"",linked_evidence:[]};C([...F,we]),K(new Set([...ne,we.id]))},f=(be,we)=>{C(F.map(Se=>Se.id===be?{...Se,...we}:Se))},x=be=>{if(!confirm(l("form.confirmations.removeCapability")))return;C(F.filter(Se=>Se.id!==be));const we=j.filter(Se=>Se.capability_id===be).map(Se=>Se.id);D(j.filter(Se=>Se.capability_id!==be)),q(J.filter(Se=>!we.includes(Se.requirement_id)))},E=be=>{const we={id:crypto.randomUUID(),capability_id:be,requirement:"",requirement_type:"other",description:"",linked_evidence:[]};D([...j,we]),Y(new Set([...P,we.id]))},H=(be,we)=>{D(j.map(Se=>Se.id===be?{...Se,...we}:Se))},ee=be=>{confirm(l("form.confirmations.removeRequirement"))&&(D(j.filter(we=>we.id!==be)),q(J.filter(we=>we.requirement_id!==be)))},Z=be=>{const we={id:crypto.randomUUID(),requirement_id:be,vulnerability:"",vulnerability_type:"other",description:"",...A==="custom"?{custom_scoring:z.reduce((Se,ye)=>({...Se,[ye.id]:1}),{}),composite_score:z.length}:{scoring:{impact_on_cog:1,attainability:1,follow_up_potential:1},composite_score:3},linked_evidence:[]};q([...J,we])},ue=(be,we)=>{q(J.map(Se=>{if(Se.id===be){const ye={...Se,...we};return(we.scoring||we.custom_scoring)&&(ye.composite_score=vc(ye)),ye}return Se}))},pe=be=>{confirm(l("form.confirmations.removeVulnerability"))&&q(J.filter(we=>we.id!==be))},ie=(be,we)=>{V({type:be,id:we}),R(!0)},ke=async be=>{if(!X)return;const we=be.map(Se=>String(Se.entity_id));switch(X.type){case"cog":O(X.id,{linked_evidence:[...U.find(Se=>Se.id===X.id)?.linked_evidence||[],...we]});break;case"capability":f(X.id,{linked_evidence:[...F.find(Se=>Se.id===X.id)?.linked_evidence||[],...we]});break;case"requirement":H(X.id,{linked_evidence:[...j.find(Se=>Se.id===X.id)?.linked_evidence||[],...we]});break;case"vulnerability":ue(X.id,{linked_evidence:[...J.find(Se=>Se.id===X.id)?.linked_evidence||[],...we]});break}R(!1),V(null)},Oe=()=>A==="linear"?xk:yk,De=(be,we)=>{const Se=Ii[be];return A==="linear"?Se.linear[we]||"":Se.logarithmic[we]||""},gt=(be,we,Se)=>{const ye=new Set(be);ye.has(Se)?ye.delete(Se):ye.add(Se),we(ye)};return e.jsx(qt,{children:e.jsxs("div",{className:"space-y-6 pb-20",children:[e.jsxs("div",{className:"flex items-center justify-between sticky top-0 bg-white dark:bg-gray-950 z-10 py-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(te,{variant:"outline",onClick:()=>o(n),children:[e.jsx(Ir,{className:"h-4 w-4 mr-2"}),l("form.buttons.back")]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l(t==="create"?"form.header.createTitle":"form.header.editTitle")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:l("form.header.subtitle")})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{variant:"outline",onClick:()=>window.open("https://irregularpedia.org/index.php/Center_of_Gravity_Analysis_Guide","_blank"),children:[e.jsx(ar,{className:"h-4 w-4 mr-2"}),l("form.buttons.referenceGuide")]}),e.jsxs(te,{onClick:M,disabled:a,children:[e.jsx(on,{className:"h-4 w-4 mr-2"}),l(a?"form.buttons.saving":"form.buttons.saveAnalysis")]})]})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:l("form.basicInfo.title")}),e.jsx(Le,{children:l("form.basicInfo.description")})]}),e.jsxs(xe,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(fe,{children:l("form.basicInfo.titleLabel")}),e.jsx(Ee,{value:N,onChange:be=>u(be.target.value),placeholder:l("form.basicInfo.titlePlaceholder")})]}),e.jsxs("div",{children:[e.jsx(fe,{children:l("form.basicInfo.descriptionLabel")}),e.jsx($e,{value:v,onChange:be=>g(be.target.value),placeholder:l("form.basicInfo.descriptionPlaceholder"),rows:3})]})]})]}),e.jsxs(Ar,{value:p,onValueChange:d,children:[e.jsxs(Tr,{className:"grid w-full grid-cols-3",children:[e.jsx(Ye,{value:"context",children:l("form.tabs.operationalContext")}),e.jsx(Ye,{value:"cogs",children:l("form.tabs.cogAnalysis")}),e.jsx(Ye,{value:"scoring",children:l("form.tabs.scoringSystem")})]}),e.jsx(pt,{value:"context",className:"space-y-4",children:e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:l("form.operationalContext.title")}),e.jsx(Le,{children:l("form.operationalContext.description")})]}),e.jsxs(xe,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fe,{children:["ðŸŽ¯ ",l("form.operationalContext.objectiveLabel")]}),e.jsx(qt,{children:e.jsxs(Ct,{children:[e.jsx(Et,{asChild:!0,children:e.jsx(Pt,{className:"h-4 w-4 text-gray-400 cursor-help"})}),e.jsxs(At,{className:"max-w-md",children:[e.jsx("p",{className:"font-semibold mb-2",children:l("form.tooltips.objective.title")}),e.jsx("p",{className:"text-sm",children:l("form.tooltips.objective.examples")}),e.jsxs("ul",{className:"text-sm list-disc ml-4 mt-1",children:[e.jsx("li",{children:l("form.tooltips.objective.example1")}),e.jsx("li",{children:l("form.tooltips.objective.example2")}),e.jsx("li",{children:l("form.tooltips.objective.example3")})]})]})]})})]}),e.jsx($e,{value:w.objective,onChange:be=>k({...w,objective:be.target.value}),placeholder:l("form.operationalContext.objectivePlaceholder"),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fe,{children:["ðŸ’¥ ",l("form.operationalContext.impactLabel")]}),e.jsx(qt,{children:e.jsxs(Ct,{children:[e.jsx(Et,{asChild:!0,children:e.jsx(Pt,{className:"h-4 w-4 text-gray-400 cursor-help"})}),e.jsxs(At,{className:"max-w-md",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Describe the desired end-state or effect."}),e.jsx("p",{className:"text-sm",children:"Consider:"}),e.jsxs("ul",{className:"text-sm list-disc ml-4 mt-1",children:[e.jsx("li",{children:"What changes in adversary behavior?"}),e.jsx("li",{children:"What capabilities are degraded/neutralized?"}),e.jsx("li",{children:"What strategic advantage is gained?"})]})]})]})})]}),e.jsx($e,{value:w.desired_impact,onChange:be=>k({...w,desired_impact:be.target.value}),placeholder:l("form.operationalContext.impactPlaceholder"),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fe,{children:["ðŸ‘¥ ",l("form.operationalContext.identityLabel")]}),e.jsx(qt,{children:e.jsxs(Ct,{children:[e.jsx(Et,{asChild:!0,children:e.jsx(Pt,{className:"h-4 w-4 text-gray-400 cursor-help"})}),e.jsxs(At,{className:"max-w-md",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Describe friendly force composition and capabilities."}),e.jsx("p",{className:"text-sm",children:"Include: organizational structure, key capabilities, partnered forces, unique advantages"})]})]})})]}),e.jsx($e,{value:w.our_identity,onChange:be=>k({...w,our_identity:be.target.value}),placeholder:l("form.operationalContext.identityPlaceholder"),rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fe,{children:["ðŸŒ ",l("form.operationalContext.environmentLabel")]}),e.jsx(qt,{children:e.jsxs(Ct,{children:[e.jsx(Et,{asChild:!0,children:e.jsx(Pt,{className:"h-4 w-4 text-gray-400 cursor-help"})}),e.jsxs(At,{className:"max-w-md",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Describe the operational environment using PMESII-PT:"}),e.jsxs("ul",{className:"text-sm list-disc ml-4 mt-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"P"}),"olitical: Government, power structures"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"M"}),"ilitary: Forces, capabilities, posture"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"E"}),"conomic: Resources, trade, infrastructure"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"S"}),"ocial: Demographics, culture, grievances"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"I"}),"nformation: Media, narratives, connectivity"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"I"}),"nfrastructure: Critical systems, networks"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"P"}),"hysical: Terrain, climate, geography"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"T"}),"ime: Tempo, windows, constraints"]})]})]})]})})]}),e.jsx($e,{value:w.operating_environment,onChange:be=>k({...w,operating_environment:be.target.value}),placeholder:l("form.operationalContext.environmentPlaceholder"),rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fe,{children:["â›“ï¸ ",l("form.operationalContext.constraintsLabel")]}),e.jsx(qt,{children:e.jsxs(Ct,{children:[e.jsx(Et,{asChild:!0,children:e.jsx(Pt,{className:"h-4 w-4 text-gray-400 cursor-help"})}),e.jsxs(At,{className:"max-w-md",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Constraints are things you MUST do or CONDITIONS that limit action."}),e.jsx("p",{className:"text-sm",children:l("form.tooltips.objective.examples")}),e.jsxs("ul",{className:"text-sm list-disc ml-4 mt-1",children:[e.jsx("li",{children:"Must coordinate with State Department"}),e.jsx("li",{children:"Limited to defensive cyber operations only"}),e.jsx("li",{children:"Budget ceiling of $5M"}),e.jsx("li",{children:"Requires host nation approval for any kinetic action"})]})]})]})})]}),e.jsx(Ee,{value:w.constraints.join(", "),onChange:be=>k({...w,constraints:be.target.value.split(",").map(we=>we.trim()).filter(Boolean)}),placeholder:l("form.operationalContext.constraintsPlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fe,{children:["ðŸš« ",l("form.operationalContext.restraintsLabel")]}),e.jsx(qt,{children:e.jsxs(Ct,{children:[e.jsx(Et,{asChild:!0,children:e.jsx(Pt,{className:"h-4 w-4 text-gray-400 cursor-help"})}),e.jsxs(At,{className:"max-w-md",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Restraints are things you MUST NOT do or PROHIBITED actions."}),e.jsx("p",{className:"text-sm",children:l("form.tooltips.objective.examples")}),e.jsxs("ul",{className:"text-sm list-disc ml-4 mt-1",children:[e.jsx("li",{children:"No strikes on religious sites"}),e.jsx("li",{children:"No engagement of state media infrastructure"}),e.jsx("li",{children:"Cannot operate within 50km of border"}),e.jsx("li",{children:"Prohibited from targeting specific platforms"})]})]})]})})]}),e.jsx(Ee,{value:w.restraints.join(", "),onChange:be=>k({...w,restraints:be.target.value.split(",").map(we=>we.trim()).filter(Boolean)}),placeholder:l("form.operationalContext.restraintsPlaceholder")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fe,{children:["â±ï¸ ",l("form.operationalContext.timeframeLabel")]}),e.jsx(qt,{children:e.jsxs(Ct,{children:[e.jsx(Et,{asChild:!0,children:e.jsx(Pt,{className:"h-4 w-4 text-gray-400 cursor-help"})}),e.jsx(At,{className:"max-w-sm",children:e.jsx("p",{className:"text-sm",children:"Specify the planning horizon or operational window. This helps prioritize vulnerabilities based on when effects are needed."})})]})})]}),e.jsx(Ee,{value:w.timeframe,onChange:be=>k({...w,timeframe:be.target.value}),placeholder:l("form.operationalContext.timeframePlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fe,{children:["ðŸ“Š ",l("form.operationalContext.strategicLevelLabel")]}),e.jsx(qt,{children:e.jsxs(Ct,{children:[e.jsx(Et,{asChild:!0,children:e.jsx(Pt,{className:"h-4 w-4 text-gray-400 cursor-help"})}),e.jsxs(At,{className:"max-w-sm",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Strategic levels of war:"}),e.jsxs("ul",{className:"text-sm list-disc ml-4",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Strategic:"})," National/theater objectives"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Operational:"})," Campaign/major operation"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Tactical:"})," Battle/engagement level"]})]})]})]})})]}),e.jsxs(ct,{value:w.strategic_level,onValueChange:be=>k({...w,strategic_level:be}),children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsxs(ht,{children:[e.jsx(Te,{value:"tactical",children:b[0].label}),e.jsx(Te,{value:"operational",children:b[1].label}),e.jsx(Te,{value:"strategic",children:b[2].label})]})]})]})]})]})]})}),e.jsx(pt,{value:"cogs",className:"space-y-4",children:e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Ae,{children:l("form.cog.title")}),e.jsx(Le,{children:l("form.cog.description")})]}),e.jsxs("div",{className:"flex gap-2",children:[J.length>0&&e.jsxs(te,{variant:"outline",onClick:()=>Q(!0),children:[e.jsx(Vi,{className:"h-4 w-4 mr-2"}),l("form.buttons.quickScore")]}),e.jsx(rs,{mode:"suggest-cog",context:{objective:w.objective,impactGoal:w.desired_impact,friendlyForces:w.our_identity,operatingEnvironment:w.operating_environment},onAccept:be=>{const we={id:crypto.randomUUID(),description:be.description||"",actor_category:be.actor||"Adversary",domain:be.domain||"Military",rationale:be.rationale||"",linked_evidence:[]};G([...U,we])},buttonText:"{t('form.buttons.suggestCOG')}",buttonVariant:"outline"}),e.jsxs(te,{onClick:oe,children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),l("form.buttons.addCOG")]})]})]})}),e.jsx(xe,{className:"space-y-4",children:U.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:l("form.cog.emptyState")}):U.map(be=>e.jsx(ge,{className:"border-l-4 border-red-500",children:e.jsx(xe,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(fe,{className:"text-xs",children:l("form.cog.actorCategoryLabel")}),e.jsxs(ct,{value:be.actor_category,onValueChange:we=>O(be.id,{actor_category:we}),children:[e.jsx(dt,{className:"h-9",children:e.jsx(ut,{})}),e.jsx(ht,{children:m.map(we=>e.jsx(Te,{value:we.value,children:we.label},we.value))})]})]}),e.jsxs("div",{children:[e.jsx(fe,{className:"text-xs",children:l("form.cog.domainLabel")}),e.jsxs(ct,{value:be.domain,onValueChange:we=>O(be.id,{domain:we}),children:[e.jsx(dt,{className:"h-9",children:e.jsx(ut,{})}),e.jsx(ht,{children:y.map(we=>e.jsxs(Te,{value:we.value,children:[we.icon," ",we.label]},we.value))})]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>gt(W,$,be.id),children:W.has(be.id)?e.jsx(es,{className:"h-4 w-4"}):e.jsx(Xs,{className:"h-4 w-4"})}),e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>ce(be.id),className:"text-red-600",children:e.jsx(vs,{className:"h-4 w-4"})})]})]}),W.has(be.id)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fe,{className:"text-sm",children:["ðŸ“ ",l("form.cog.descriptionLabel")]}),e.jsx(qt,{children:e.jsxs(Ct,{children:[e.jsx(Et,{asChild:!0,children:e.jsx(Pt,{className:"h-3 w-3 text-gray-400 cursor-help"})}),e.jsxs(At,{className:"max-w-md",children:[e.jsx("p",{className:"font-semibold mb-2",children:"A COG is a source of power that provides moral or physical strength, freedom of action, or will to act."}),e.jsx("p",{className:"text-sm mb-2",children:"Examples:"}),e.jsxs("ul",{className:"text-sm list-disc ml-4",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Military:"})," Integrated air defense system"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Information:"})," State-controlled media apparatus"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Economic:"})," Oil export infrastructure"]})]})]})]})})]}),e.jsx($e,{value:be.description,onChange:we=>O(be.id,{description:we.target.value}),placeholder:l("form.cog.descriptionPlaceholder"),rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fe,{className:"text-sm",children:["ðŸ¤” ",l("form.cog.rationaleLabel")]}),e.jsx(qt,{children:e.jsxs(Ct,{children:[e.jsx(Et,{asChild:!0,children:e.jsx(Pt,{className:"h-3 w-3 text-gray-400 cursor-help"})}),e.jsxs(At,{className:"max-w-md",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Explain what makes this a true COG:"}),e.jsxs("ul",{className:"text-sm list-disc ml-4",children:[e.jsx("li",{children:"What happens if this is neutralized?"}),e.jsx("li",{children:"What evidence supports this assessment?"}),e.jsx("li",{children:"How does this enable the actor's objectives?"})]})]})]})})]}),e.jsx($e,{value:be.rationale,onChange:we=>O(be.id,{rationale:we.target.value}),placeholder:l("form.cog.rationalePlaceholder"),rows:3})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 p-2 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>{const we=`checklist-${be.id}`;le(Se=>{const ye=new Set(Se);return ye.has(we)?ye.delete(we):ye.add(we),ye})},children:[e.jsxs("p",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100 cursor-pointer",children:["âœ… ",l("form.cog.validationChecklist")]}),re.has(`checklist-${be.id}`)?e.jsx(es,{className:"h-4 w-4"}):e.jsx(Xs,{className:"h-4 w-4"})]}),re.has(`checklist-${be.id}`)&&e.jsxs("ul",{className:"text-xs text-blue-800 dark:text-blue-200 space-y-1 mt-2",children:[e.jsxs("li",{children:["â˜ ",l("form.cog.validationCheck1")]}),e.jsxs("li",{children:["â˜ ",l("form.cog.validationCheck2")]}),e.jsxs("li",{children:["â˜ ",l("form.cog.validationCheck3")]}),e.jsxs("li",{children:["â˜ ",l("form.cog.validationCheck4")]})]})]}),e.jsxs("div",{children:[e.jsx(fe,{className:"text-xs",children:l("form.cog.linkedEvidenceLabel",{count:be.linked_evidence.length})}),e.jsxs(te,{variant:"outline",size:"sm",onClick:()=>ie("cog",be.id),className:"mt-1",children:[e.jsx(rr,{className:"h-3 w-3 mr-2"}),l("form.buttons.linkEvidence")]})]}),e.jsxs("div",{className:"ml-6 space-y-3 border-l-2 border-blue-300 pl-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fe,{className:"text-sm font-semibold",children:["âš¡ ",l("form.capabilities.title")]}),e.jsx(qt,{children:e.jsxs(Ct,{children:[e.jsx(Et,{asChild:!0,children:e.jsx(Pt,{className:"h-3 w-3 text-gray-400 cursor-help"})}),e.jsxs(At,{className:"max-w-md",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Capabilities are ACTIONS (verbs) the COG can perform."}),e.jsx("p",{className:"text-sm mb-2",children:"Examples:"}),e.jsxs("ul",{className:"text-sm list-disc ml-4",children:[e.jsx("li",{children:'"Project military power across theater"'}),e.jsx("li",{children:'"Influence regional public opinion"'}),e.jsx("li",{children:'"Coordinate multi-domain strike operations"'}),e.jsx("li",{children:'"Control information narrative"'})]})]})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(rs,{mode:"generate-capabilities",context:{objective:w.objective,impactGoal:w.desired_impact,friendlyForces:w.our_identity,operatingEnvironment:w.operating_environment},cog:{description:be.description,actor:be.actor_category,domain:be.domain,rationale:be.rationale},onAccept:we=>{const Se=we.map(ye=>({id:crypto.randomUUID(),cog_id:be.id,capability:ye.capability||"",description:ye.description||"",strategic_contribution:ye.strategic_contribution||"",linked_evidence:[]}));C([...F,...Se])},buttonText:"{t('form.buttons.generateCapabilities')}",buttonVariant:"outline",buttonSize:"sm"}),e.jsxs(te,{variant:"outline",size:"sm",onClick:()=>L(be.id),children:[e.jsx(st,{className:"h-3 w-3 mr-1"}),l("form.buttons.addCapability")]})]})]}),F.filter(we=>we.cog_id===be.id).map(we=>e.jsx(ge,{className:"border-blue-200",children:e.jsx(xe,{className:"pt-3 pb-3",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx(Ee,{value:we.capability,onChange:Se=>f(we.id,{capability:Se.target.value}),placeholder:l("form.capabilities.capabilityPlaceholder"),className:"flex-1"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>gt(ne,K,we.id),children:ne.has(we.id)?e.jsx(es,{className:"h-3 w-3"}):e.jsx(Xs,{className:"h-3 w-3"})}),e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>x(we.id),className:"text-red-600",children:e.jsx(Ze,{className:"h-3 w-3"})})]})]}),ne.has(we.id)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(fe,{className:"text-xs",children:l("form.capabilities.howItWorksLabel")}),e.jsx($e,{value:we.description,onChange:Se=>f(we.id,{description:Se.target.value}),placeholder:l("form.capabilities.howItWorksPlaceholder"),rows:2,className:"text-sm"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(fe,{className:"text-xs",children:l("form.capabilities.strategicContributionLabel")}),e.jsx($e,{value:we.strategic_contribution,onChange:Se=>f(we.id,{strategic_contribution:Se.target.value}),placeholder:l("form.capabilities.strategicContributionPlaceholder"),rows:2,className:"text-sm"})]}),e.jsxs(te,{variant:"outline",size:"sm",onClick:()=>ie("capability",we.id),children:[e.jsx(rr,{className:"h-3 w-3 mr-2"}),l("form.cog.linkedEvidenceLabel",{count:we.linked_evidence.length})]}),e.jsxs("div",{className:"ml-4 space-y-2 border-l-2 border-yellow-300 pl-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fe,{className:"text-xs font-semibold",children:["ðŸ“‹ ",l("form.requirements.title")]}),e.jsx(qt,{children:e.jsxs(Ct,{children:[e.jsx(Et,{asChild:!0,children:e.jsx(Pt,{className:"h-3 w-3 text-gray-400 cursor-help"})}),e.jsxs(At,{className:"max-w-md",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Requirements are RESOURCES/CONDITIONS (nouns) the capability needs to function."}),e.jsx("p",{className:"text-sm mb-2",children:"Examples:"}),e.jsxs("ul",{className:"text-sm list-disc ml-4",children:[e.jsx("li",{children:'"Trained personnel"'}),e.jsx("li",{children:'"Logistics support network"'}),e.jsx("li",{children:'"Command and control infrastructure"'}),e.jsx("li",{children:'"Platform access (social media accounts)"'})]})]})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(rs,{mode:"generate-requirements",context:{objective:w.objective,impactGoal:w.desired_impact,friendlyForces:w.our_identity,operatingEnvironment:w.operating_environment},cog:{description:be.description,actor:be.actor_category,domain:be.domain,rationale:be.rationale},capability:{capability:we.capability,description:we.description},onAccept:Se=>{const ye=Se.map(We=>({id:crypto.randomUUID(),capability_id:we.id,requirement:We.requirement||"",requirement_type:We.type||"other",description:We.description||"",linked_evidence:[]}));D([...j,...ye])},buttonText:"{t('form.buttons.generateCapabilities')}",buttonVariant:"outline",buttonSize:"sm"}),e.jsxs(te,{variant:"outline",size:"sm",onClick:()=>E(we.id),children:[e.jsx(st,{className:"h-3 w-3 mr-1"}),l("form.buttons.addRequirement")]})]})]}),j.filter(Se=>Se.capability_id===we.id).map(Se=>e.jsx(ge,{className:"border-yellow-200",children:e.jsx(xe,{className:"pt-2 pb-2",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ee,{value:Se.requirement,onChange:ye=>H(Se.id,{requirement:ye.target.value}),placeholder:l("form.requirements.requirementPlaceholder"),className:"flex-1 h-8 text-sm"}),e.jsxs(ct,{value:Se.requirement_type,onValueChange:ye=>H(Se.id,{requirement_type:ye}),children:[e.jsx(dt,{className:"w-32 h-8 text-xs",children:e.jsx(ut,{})}),e.jsx(ht,{children:h.map(ye=>e.jsx(Te,{value:ye.value,children:ye.label},ye.value))})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>gt(P,Y,Se.id),children:P.has(Se.id)?e.jsx(es,{className:"h-3 w-3"}):e.jsx(Xs,{className:"h-3 w-3"})}),e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>ee(Se.id),className:"text-red-600",children:e.jsx(Ze,{className:"h-3 w-3"})})]})]}),P.has(Se.id)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(fe,{className:"text-xs",children:l("form.requirements.descriptionLabel")}),e.jsx($e,{value:Se.description,onChange:ye=>H(Se.id,{description:ye.target.value}),placeholder:l("form.requirements.descriptionPlaceholder"),rows:2,className:"text-xs"})]}),e.jsxs(te,{variant:"outline",size:"sm",onClick:()=>ie("requirement",Se.id),children:[e.jsx(rr,{className:"h-3 w-3 mr-1"}),l("form.cog.linkedEvidenceLabel",{count:Se.linked_evidence.length})]}),e.jsxs("div",{className:"ml-3 space-y-2 border-l-2 border-orange-300 pl-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(fe,{className:"text-xs font-semibold",children:["âš ï¸ ",l("form.vulnerabilities.title")]}),e.jsx(qt,{children:e.jsxs(Ct,{children:[e.jsx(Et,{asChild:!0,children:e.jsx(Pt,{className:"h-3 w-3 text-gray-400 cursor-help"})}),e.jsxs(At,{className:"max-w-md",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Vulnerabilities are deficiencies or weaknesses in a requirement that can be exploited."}),e.jsx("p",{className:"text-sm mb-2",children:"Examples:"}),e.jsxs("ul",{className:"text-sm list-disc ml-4",children:[e.jsx("li",{children:'"Platform policy enforcement" (requirement: account access)'}),e.jsx("li",{children:'"Single point of failure" (requirement: C2 node)'}),e.jsx("li",{children:'"Insufficient redundancy" (requirement: supply route)'})]})]})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(rs,{mode:"generate-vulnerabilities",context:{objective:w.objective,impactGoal:w.desired_impact,friendlyForces:w.our_identity,operatingEnvironment:w.operating_environment},cog:{description:be.description,actor:be.actor_category,domain:be.domain,rationale:be.rationale},capability:{capability:we.capability,description:we.description},requirement:{requirement:Se.requirement,type:Se.requirement_type},onAccept:ye=>{const We=ye.map(Ot=>({id:crypto.randomUUID(),requirement_id:Se.id,vulnerability:Ot.vulnerability||"",vulnerability_type:Ot.type||"other",description:Ot.description||"",feasibility_score:Ot.feasibility||3,impact_score:Ot.impact||3,composite_score:(Ot.feasibility||3)*(Ot.impact||3),linked_evidence:[]}));q([...J,...We])},buttonText:"{t('form.buttons.generateCapabilities')}",buttonVariant:"outline",buttonSize:"sm"}),e.jsxs(te,{variant:"outline",size:"sm",onClick:()=>Z(Se.id),children:[e.jsx(st,{className:"h-3 w-3 mr-1"}),l("form.buttons.addVulnerability")]})]})]}),J.filter(ye=>ye.requirement_id===Se.id).map(ye=>e.jsx(ge,{className:"border-orange-200 bg-orange-50 dark:bg-orange-900/10",children:e.jsx(xe,{className:"pt-2 pb-2",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ee,{value:ye.vulnerability,onChange:We=>ue(ye.id,{vulnerability:We.target.value}),placeholder:l("form.vulnerabilities.vulnerabilityPlaceholder"),className:"flex-1 h-8 text-xs"}),e.jsxs(ct,{value:ye.vulnerability_type,onValueChange:We=>ue(ye.id,{vulnerability_type:We}),children:[e.jsx(dt,{className:"w-28 h-8 text-xs",children:e.jsx(ut,{})}),e.jsx(ht,{children:_.map(We=>e.jsx(Te,{value:We.value,children:We.label},We.value))})]}),e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>pe(ye.id),className:"text-red-600",children:e.jsx(Ze,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(fe,{className:"text-xs",children:l("form.vulnerabilities.descriptionLabel")}),e.jsx($e,{value:ye.description,onChange:We=>ue(ye.id,{description:We.target.value}),placeholder:l("form.vulnerabilities.descriptionPlaceholder"),rows:2,className:"text-xs"})]}),e.jsxs("div",{className:"space-y-2 bg-white dark:bg-gray-900 p-2 rounded",children:[e.jsx(fe,{className:"text-xs font-semibold",children:l("form.vulnerabilities.scoringLabel",{score:ye.composite_score})}),A!=="custom"&&ye.scoring&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(fe,{className:"text-xs",children:l("form.vulnerabilities.impactLabel")}),e.jsxs(Ct,{children:[e.jsx(Et,{children:e.jsx(Pt,{className:"h-3 w-3"})}),e.jsx(At,{children:e.jsx("p",{className:"max-w-xs text-xs",children:Ii.impact_on_cog.definition})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{value:[ye.scoring.impact_on_cog],onValueChange:([We])=>ue(ye.id,{scoring:{...ye.scoring,impact_on_cog:We}}),min:Oe()[0],max:Oe()[Oe().length-1],step:1,className:"flex-1"}),e.jsx(he,{variant:"outline",className:"min-w-[3rem] justify-center",children:ye.scoring.impact_on_cog})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:De("impact_on_cog",ye.scoring.impact_on_cog)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(fe,{className:"text-xs",children:l("form.vulnerabilities.attainabilityLabel")}),e.jsxs(Ct,{children:[e.jsx(Et,{children:e.jsx(Pt,{className:"h-3 w-3"})}),e.jsx(At,{children:e.jsx("p",{className:"max-w-xs text-xs",children:Ii.attainability.definition})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{value:[ye.scoring.attainability],onValueChange:([We])=>ue(ye.id,{scoring:{...ye.scoring,attainability:We}}),min:Oe()[0],max:Oe()[Oe().length-1],step:1,className:"flex-1"}),e.jsx(he,{variant:"outline",className:"min-w-[3rem] justify-center",children:ye.scoring.attainability})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:De("attainability",ye.scoring.attainability)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(fe,{className:"text-xs",children:l("form.vulnerabilities.followUpLabel")}),e.jsxs(Ct,{children:[e.jsx(Et,{children:e.jsx(Pt,{className:"h-3 w-3"})}),e.jsx(At,{children:e.jsx("p",{className:"max-w-xs text-xs",children:Ii.follow_up_potential.definition})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{value:[ye.scoring.follow_up_potential],onValueChange:([We])=>ue(ye.id,{scoring:{...ye.scoring,follow_up_potential:We}}),min:Oe()[0],max:Oe()[Oe().length-1],step:1,className:"flex-1"}),e.jsx(he,{variant:"outline",className:"min-w-[3rem] justify-center",children:ye.scoring.follow_up_potential})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:De("follow_up_potential",ye.scoring.follow_up_potential)})]})]}),A==="custom"&&ye.custom_scoring&&e.jsx(e.Fragment,{children:z.map(We=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(fe,{className:"text-xs",children:We.name}),e.jsxs(Ct,{children:[e.jsx(Et,{children:e.jsx(Pt,{className:"h-3 w-3"})}),e.jsx(At,{children:e.jsx("p",{className:"max-w-xs text-xs",children:We.definition})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{value:[ye.custom_scoring?.[We.id]||1],onValueChange:([Ot])=>ue(ye.id,{custom_scoring:{...ye.custom_scoring,[We.id]:Ot}}),min:1,max:5,step:1,className:"flex-1"}),e.jsx(he,{variant:"outline",className:"min-w-[3rem] justify-center",children:ye.custom_scoring[We.id]||1})]})]},We.id))})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-950 p-2 rounded-lg border border-green-200 dark:border-green-800",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>gt(re,le,ye.id),children:[e.jsxs(fe,{className:"text-sm font-semibold text-green-900 dark:text-green-100 cursor-pointer",children:["ðŸ’¡ ",l("form.vulnerabilities.soWhatTitle")]}),re.has(ye.id)?e.jsx(es,{className:"h-4 w-4"}):e.jsx(Xs,{className:"h-4 w-4"})]}),re.has(ye.id)&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(fe,{className:"text-xs",children:l("form.vulnerabilities.expectedEffectLabel")}),e.jsx($e,{value:ye.expected_effect||"",onChange:We=>ue(ye.id,{expected_effect:We.target.value}),placeholder:l("form.vulnerabilities.expectedEffectPlaceholder"),rows:2,className:"text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(fe,{className:"text-xs",children:l("form.vulnerabilities.recommendedActionsLabel")}),e.jsx(Ee,{value:(ye.recommended_actions||[]).join(", "),onChange:We=>ue(ye.id,{recommended_actions:We.target.value.split(",").map(Ot=>Ot.trim()).filter(Boolean)}),placeholder:l("form.vulnerabilities.recommendedActionsPlaceholder"),className:"text-xs"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(fe,{className:"text-xs",children:l("form.vulnerabilities.confidenceLabel")}),e.jsxs(ct,{value:ye.confidence||"medium",onValueChange:We=>ue(ye.id,{confidence:We}),children:[e.jsx(dt,{className:"h-8 text-xs",children:e.jsx(ut,{})}),e.jsxs(ht,{children:[e.jsx(Te,{value:"low",children:l("form.vulnerabilities.confidenceLow")}),e.jsx(Te,{value:"medium",children:l("form.vulnerabilities.confidenceMedium")}),e.jsx(Te,{value:"high",children:l("form.vulnerabilities.confidenceHigh")}),e.jsx(Te,{value:"confirmed",children:l("form.vulnerabilities.confidenceConfirmed")})]})]})]})]})]}),e.jsxs(te,{variant:"outline",size:"sm",onClick:()=>ie("vulnerability",ye.id),children:[e.jsx(rr,{className:"h-3 w-3 mr-1"}),l("form.cog.linkedEvidenceLabel",{count:ye.linked_evidence.length})]})]})})},ye.id))]})]})]})})},Se.id))]})]})]})})},we.id))]})]})]})})},be.id))})]})}),e.jsx(pt,{value:"scoring",className:"space-y-4",children:e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:l("form.scoring.title")}),e.jsx(Le,{children:l("form.scoring.description")})]}),e.jsxs(xe,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(ge,{className:`cursor-pointer transition-all ${A==="linear"?"border-blue-500 border-2":""}`,onClick:()=>T("linear"),children:e.jsxs(xe,{className:"pt-6",children:[e.jsx("h3",{className:"font-semibold mb-2",children:l("form.scoring.linearTitle")}),e.jsx("p",{className:"text-xs text-gray-600 mb-4",children:l("form.scoring.linearDescription")}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:"1"}),e.jsx("span",{children:"2"}),e.jsx("span",{children:"3"}),e.jsx("span",{children:"4"}),e.jsx("span",{children:"5"})]})]})}),e.jsx(ge,{className:`cursor-pointer transition-all ${A==="logarithmic"?"border-blue-500 border-2":""}`,onClick:()=>T("logarithmic"),children:e.jsxs(xe,{className:"pt-6",children:[e.jsx("h3",{className:"font-semibold mb-2",children:l("form.scoring.logarithmicTitle")}),e.jsx("p",{className:"text-xs text-gray-600 mb-4",children:l("form.scoring.logarithmicDescription")}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:"1"}),e.jsx("span",{children:"3"}),e.jsx("span",{children:"5"}),e.jsx("span",{children:"8"}),e.jsx("span",{children:"12"})]})]})}),e.jsx(ge,{className:`cursor-pointer transition-all ${A==="custom"?"border-blue-500 border-2":""}`,onClick:()=>T("custom"),children:e.jsxs(xe,{className:"pt-6",children:[e.jsx("h3",{className:"font-semibold mb-2",children:l("form.scoring.customTitle")}),e.jsx("p",{className:"text-xs text-gray-600 mb-4",children:l("form.scoring.customDescription")}),e.jsx("div",{className:"text-xs text-center text-gray-500",children:l("form.scoring.customCriteriaRange")})]})})]}),(A==="linear"||A==="logarithmic")&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:l("form.scoring.defaultCriteriaTitle")}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsx("li",{children:e.jsx("strong",{children:l("form.scoring.impactCriterion")})}),e.jsx("li",{children:e.jsx("strong",{children:l("form.scoring.attainabilityCriterion")})}),e.jsx("li",{children:e.jsx("strong",{children:l("form.scoring.followUpCriterion")})}),e.jsx("li",{className:"pt-2 border-t",children:e.jsx("strong",{children:l("form.scoring.compositeFormula")})})]})]}),A==="custom"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold",children:l("form.scoring.customCriteriaTitle")}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(te,{size:"sm",variant:"outline",onClick:()=>{z.length<5&&S([...z,{id:`criterion${z.length+1}`,name:"",definition:""}])},disabled:z.length>=5,children:[e.jsx(st,{className:"h-4 w-4 mr-1"}),l("form.buttons.addCriterion")]})})]}),e.jsx("div",{className:"space-y-3",children:z.map((be,we)=>e.jsx(ge,{className:"bg-gray-50 dark:bg-gray-900",children:e.jsx(xe,{className:"pt-4 space-y-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(fe,{className:"text-xs",children:l("form.scoring.criterionNameLabel")}),e.jsx(Ee,{value:be.name,onChange:Se=>{const ye=[...z];ye[we].name=Se.target.value,S(ye)},placeholder:l("form.scoring.criterionNamePlaceholder"),className:"h-9"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(fe,{className:"text-xs",children:l("form.scoring.criterionDefinitionLabel")}),e.jsx(Ee,{value:be.definition,onChange:Se=>{const ye=[...z];ye[we].definition=Se.target.value,S(ye)},placeholder:l("form.scoring.criterionDefinitionPlaceholder"),className:"h-9"})]})]}),e.jsx(te,{size:"sm",variant:"ghost",onClick:()=>{z.length>1&&S(z.filter((Se,ye)=>ye!==we))},disabled:z.length<=1,className:"text-red-600 mt-6",children:e.jsx(Ze,{className:"h-4 w-4"})})]})})},be.id))}),e.jsx("div",{className:"bg-green-50 dark:bg-green-950 p-3 rounded-lg border border-green-200 dark:border-green-800",children:e.jsx("p",{className:"text-sm text-green-900 dark:text-green-100",children:e.jsx("strong",{children:l("form.scoring.customCompositeNote")})})})]})]})]})})]}),e.jsx(Gn,{open:se,onClose:()=>{R(!1),V(null)},onLink:ke,alreadyLinked:[]}),e.jsx(_k,{open:I,onClose:()=>Q(!1),vulnerabilities:J,onUpdate:be=>q(be),scoringSystem:A})]})})}const vg=B.forwardRef(({className:r,...t},s)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:s,className:cr("w-full caption-bottom text-sm",r),...t})}));vg.displayName="Table";const wg=B.forwardRef(({className:r,...t},s)=>e.jsx("thead",{ref:s,className:cr("[&_tr]:border-b",r),...t}));wg.displayName="TableHeader";const jg=B.forwardRef(({className:r,...t},s)=>e.jsx("tbody",{ref:s,className:cr("[&_tr:last-child]:border-0",r),...t}));jg.displayName="TableBody";const Nk=B.forwardRef(({className:r,...t},s)=>e.jsx("tfoot",{ref:s,className:cr("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...t}));Nk.displayName="TableFooter";const wc=B.forwardRef(({className:r,...t},s)=>e.jsx("tr",{ref:s,className:cr("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...t}));wc.displayName="TableRow";const ps=B.forwardRef(({className:r,...t},s)=>e.jsx("th",{ref:s,className:cr("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...t}));ps.displayName="TableHead";const fs=B.forwardRef(({className:r,...t},s)=>e.jsx("td",{ref:s,className:cr("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...t}));fs.displayName="TableCell";const Sk=B.forwardRef(({className:r,...t},s)=>e.jsx("caption",{ref:s,className:cr("mt-4 text-sm text-muted-foreground",r),...t}));Sk.displayName="TableCaption";const ms={cog:"#ef4444",capability:"#3b82f6",requirement:"#f59e0b",vulnerability:"#10b981"},Ri={cog:12,capability:8,requirement:6,vulnerability:10};function Ck({analysis:r,edges:t,onNodeClick:s}){const{t:n}=Bt(["cog","common"]),i=B.useRef(void 0),[o,l]=B.useState(null),[a,c]=B.useState(!1),[p,d]=B.useState(new Set),[m,y]=B.useState(!0),[h,_]=B.useState(new Set),[b,N]=B.useState(new Set),u=B.useMemo(()=>{const C=[];return r.centers_of_gravity.forEach(j=>{p.has(j.id)||C.push({id:j.id,label:j.description||"COG",type:"cog",data:j,color:ms.cog,size:Ri.cog})}),r.critical_capabilities.forEach(j=>{!p.has(j.id)&&!p.has(j.cog_id)&&C.push({id:j.id,label:j.capability||"Capability",type:"capability",data:j,color:ms.capability,size:Ri.capability})}),r.critical_requirements.forEach(j=>{const D=r.critical_capabilities.find(J=>J.id===j.capability_id);!p.has(j.id)&&!p.has(j.capability_id)&&D&&!p.has(D.cog_id)&&C.push({id:j.id,label:j.requirement||"Requirement",type:"requirement",data:j,color:ms.requirement,size:Ri.requirement})}),r.critical_vulnerabilities.forEach(j=>{const D=r.critical_requirements.find(q=>q.id===j.requirement_id),J=D?r.critical_capabilities.find(q=>q.id===D.capability_id):null;!p.has(j.id)&&!p.has(j.requirement_id)&&D&&!p.has(D.capability_id)&&J&&!p.has(J.cog_id)&&C.push({id:j.id,label:j.vulnerability||"Vulnerability",type:"vulnerability",data:j,color:ms.vulnerability,size:Ri.vulnerability})}),C},[r,p]),v=B.useMemo(()=>t.filter(C=>!p.has(C.source)&&!p.has(C.target)&&u.some(j=>j.id===C.source)&&u.some(j=>j.id===C.target)).map(C=>({source:C.source,target:C.target,weight:C.weight,relationship:C.relationship})),[t,p,u]),g=B.useCallback(C=>{l(C),s?.(C);const j=new Set,D=new Set;v.forEach(J=>{const q=J.source,W=J.target;if(!q||!W)return;const $=typeof q=="object"?q.id:q,ne=typeof W=="object"?W.id:W;$&&ne&&($===C.id||ne===C.id)&&(j.add($),j.add(ne),D.add(`${$}-${ne}`))}),_(j),N(D)},[v,s]),w=B.useCallback(()=>{l(null),_(new Set),N(new Set)},[]),k=B.useCallback(C=>{a&&(d(j=>new Set([...j,C])),o?.id===C&&(l(null),_(new Set),N(new Set)))},[a,o]),A=B.useCallback(()=>{d(new Set),l(null),_(new Set),N(new Set)},[]),T=B.useCallback(()=>{i.current&&i.current.zoom(1.5,400)},[]),z=B.useCallback(()=>{i.current&&i.current.zoom(.67,400)},[]),S=B.useCallback(()=>{i.current&&i.current.zoomToFit(400,50)},[]),U=B.useCallback(()=>{const C=document.querySelector("canvas");if(C){const j=C.toDataURL("image/png"),D=document.createElement("a");D.download=`${r.title}-network.png`,D.href=j,D.click()}},[r.title]),G=B.useCallback((C,j,D)=>{const J=C.label,q=12/D,W=C.size||5;if(j.beginPath(),j.arc(C.x,C.y,W,0,2*Math.PI),C.id===o?.id?(j.fillStyle="#facc15",j.strokeStyle="#854d0e",j.lineWidth=3/D):h.has(C.id)?(j.fillStyle=C.color||"#666",j.strokeStyle="#facc15",j.lineWidth=2/D):(j.fillStyle=C.color||"#666",j.strokeStyle="#fff",j.lineWidth=1/D),j.fill(),j.stroke(),m){j.font=`${q}px Sans-Serif`,j.textAlign="center",j.textBaseline="middle",j.fillStyle="#000";const $=J.length>20?J.substring(0,20)+"...":J;j.fillText($,C.x,C.y+W+q)}},[o,h,m]),F=B.useCallback((C,j,D)=>{const J=typeof C.source=="object"?C.source:u.find(K=>K.id===C.source),q=typeof C.target=="object"?C.target:u.find(K=>K.id===C.target);if(!J||!q)return;const W=typeof C.source=="object"?C.source.id:C.source,$=typeof C.target=="object"?C.target.id:C.target,ne=`${W}-${$}`;b.has(ne)?(j.strokeStyle="#facc15",j.lineWidth=3/D):(j.strokeStyle="rgba(100, 100, 100, 0.3)",j.lineWidth=1/D),j.beginPath(),j.moveTo(J.x,J.y),j.lineTo(q.x,q.y),j.stroke()},[u,b]);return B.useEffect(()=>{i.current&&u.length>0&&setTimeout(()=>{i.current?.zoomToFit(400,50)},100)},[u.length]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Ae,{children:n("cog:export.network.title")}),e.jsx(Le,{children:n("cog:export.network.tooltips.dragToPan")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{variant:"outline",size:"sm",onClick:T,title:n("cog:export.network.controls.zoomIn"),children:e.jsx(lx,{className:"h-4 w-4"})}),e.jsx(te,{variant:"outline",size:"sm",onClick:z,title:n("cog:export.network.controls.zoomOut"),children:e.jsx(cx,{className:"h-4 w-4"})}),e.jsx(te,{variant:"outline",size:"sm",onClick:S,title:n("cog:export.network.controls.fitView"),children:e.jsx(dx,{className:"h-4 w-4"})}),e.jsxs(te,{variant:"outline",size:"sm",onClick:U,children:[e.jsx(ln,{className:"h-4 w-4 mr-2"}),n("cog:export.network.controls.exportPNG")]})]})]})}),e.jsxs(xe,{children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xl,{id:"show-labels",checked:m,onCheckedChange:y}),e.jsxs(fe,{htmlFor:"show-labels",className:"flex items-center gap-1",children:[m?e.jsx(Xn,{className:"h-4 w-4"}):e.jsx(ux,{className:"h-4 w-4"}),n("cog:export.network.controls.toggleLabels")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xl,{id:"simulation-mode",checked:a,onCheckedChange:c}),e.jsxs(fe,{htmlFor:"simulation-mode",className:"flex items-center gap-1",children:[e.jsx(ha,{className:"h-4 w-4"}),n("cog:export.network.simulation.title")]})]}),p.size>0&&e.jsxs(te,{variant:"outline",size:"sm",onClick:A,children:[e.jsx(Cm,{className:"h-4 w-4 mr-2"}),n("cog:export.network.controls.reset")," (",p.size,")"]}),e.jsxs("div",{className:"flex gap-3 ml-auto",children:[e.jsx(he,{style:{backgroundColor:ms.cog},className:"text-white",children:n("cog:export.network.legend.cog")}),e.jsx(he,{style:{backgroundColor:ms.capability},className:"text-white",children:n("cog:export.network.legend.capability")}),e.jsx(he,{style:{backgroundColor:ms.requirement},className:"text-white",children:n("cog:export.network.legend.requirement")}),e.jsx(he,{style:{backgroundColor:ms.vulnerability},className:"text-white",children:n("cog:export.network.legend.vulnerability")})]})]}),a&&e.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded border border-yellow-200 dark:border-yellow-800 text-sm",children:[e.jsx("p",{className:"font-semibold text-yellow-900 dark:text-yellow-100 mb-1",children:n("cog:export.network.simulation.enable")}),e.jsx("p",{className:"text-yellow-800 dark:text-yellow-200",children:n("cog:export.network.simulation.instructions")})]})]})]}),e.jsx(ge,{children:e.jsx(xe,{className:"p-0",children:e.jsxs("div",{className:"relative",style:{height:"600px",background:"#f9fafb"},children:[e.jsx(vx,{ref:i,graphData:{nodes:u,links:v},nodeId:"id",nodeLabel:"label",linkSource:"source",linkTarget:"target",nodeCanvasObject:G,linkCanvasObject:F,onNodeClick:C=>{a?k(C.id):g(C)},onBackgroundClick:w,linkDirectionalParticles:2,linkDirectionalParticleWidth:2,cooldownTicks:100,d3AlphaDecay:.02,d3VelocityDecay:.3,enableNodeDrag:!a,enableZoomInteraction:!0,enablePanInteraction:!0}),o&&!a&&e.jsxs("div",{className:"absolute top-4 left-4 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg border max-w-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:o.label}),e.jsx(te,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>l(null),children:"Ã—"})]}),e.jsx(he,{className:"mb-2",style:{backgroundColor:o.color},children:n(`cog:export.network.legend.${o.type}`)}),o.type==="vulnerability"&&e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[n("cog:export.network.nodeInfo.type"),":"]})," ",o.data.vulnerability_type]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[n("cog:scoring.composite"),":"]})," ",o.data.composite_score]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-600",children:[n("cog:export.network.nodeInfo.connections"),": ",h.size-1]})]}),e.jsx("div",{className:"absolute bottom-4 right-4 bg-white dark:bg-gray-800 p-3 rounded-lg shadow border text-sm",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[n("cog:export.network.statistics.totalNodes"),":"]})," ",u.length]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[n("cog:export.network.statistics.totalEdges"),":"]})," ",v.length]}),p.size>0&&e.jsxs("div",{className:"text-red-600",children:[e.jsxs("span",{className:"font-medium",children:[n("cog:export.network.statistics.removedNodes"),":"]})," ",p.size]})]})})]})})})]})}function Ek({analysis:r,vulnerabilities:t,edges:s,variant:n="outline",size:i="default",className:o}){const[l,a]=B.useState(!1),{t:c}=Bt(["cog","common"]),p=async()=>{a(!0);try{const m=(await sn(()=>import("./pptxgen.es-CeCpILHn.js"),__vite__mapDeps([8,2,3,4,5,6,7,9]))).default,y=new m;y.author="COG Analysis Tool",y.company="Research Tools",y.title=r.title,y.subject="Center of Gravity Analysis";const h={primary:"1E3A8A",secondary:"64748B",accent:"EF4444",text:"1F2937",light:"F9FAFB"},_=y.addSlide();_.background={color:h.primary},_.addText(c("cog:export.powerpoint.slides.title"),{x:.5,y:1.5,w:9,h:1,fontSize:44,bold:!0,color:"FFFFFF",align:"center"}),_.addText(r.title,{x:.5,y:2.7,w:9,h:.8,fontSize:32,color:"FFFFFF",align:"center"}),_.addText([{text:"Created: ",options:{fontSize:14,color:"CBD5E1"}},{text:new Date(r.created_at).toLocaleDateString(),options:{fontSize:14,color:"FFFFFF"}}],{x:.5,y:5,w:9,h:.4,align:"center"}),_.addText([{text:"Scoring System: ",options:{fontSize:14,color:"CBD5E1"}},{text:r.scoring_system.toUpperCase(),options:{fontSize:14,color:"FFFFFF",bold:!0}}],{x:.5,y:5.5,w:9,h:.4,align:"center"});const b=y.addSlide();b.addText(c("cog:export.powerpoint.slides.operationalContext"),{x:.5,y:.3,w:9,h:.6,fontSize:32,bold:!0,color:h.primary});const N=1.2;[{label:"Objective",value:r.operational_context.objective||"Not specified"},{label:"Desired Impact",value:r.operational_context.desired_impact||"Not specified"},{label:"Our Identity",value:r.operational_context.our_identity||"Not specified"},{label:"Operating Environment",value:r.operational_context.operating_environment||"Not specified"},{label:"Timeframe",value:r.operational_context.timeframe||"Not specified"},{label:"Strategic Level",value:r.operational_context.strategic_level||"Not specified"}].forEach((C,j)=>{b.addText(C.label,{x:.5,y:N+j*.8,w:2.5,h:.6,fontSize:16,bold:!0,color:h.secondary}),b.addText(C.value,{x:3.2,y:N+j*.8,w:6.3,h:.6,fontSize:14,color:h.text})});const v=["friendly","adversary","host_nation","third_party"],g={friendly:c("cog:actorCategories.friendly").toUpperCase(),adversary:c("cog:actorCategories.adversary").toUpperCase(),host_nation:c("cog:actorCategories.hostNation").toUpperCase(),third_party:c("cog:actorCategories.thirdParty").toUpperCase()},w={friendly:"10B981",adversary:"EF4444",host_nation:"3B82F6",third_party:"6B7280"};v.forEach(C=>{const j=r.centers_of_gravity.filter(J=>J.actor_category===C);if(j.length===0)return;const D=y.addSlide();D.addText(g[C]+" CENTERS OF GRAVITY",{x:.5,y:.3,w:9,h:.6,fontSize:28,bold:!0,color:w[C]}),j.forEach((J,q)=>{const W=1.2+q*1.8;D.addShape(y.ShapeType.rect,{x:.5,y:W,w:9,h:1.6,fill:{color:h.light},line:{color:w[C],width:2}}),D.addText(J.description||"COG",{x:.7,y:W+.15,w:8.6,h:.5,fontSize:18,bold:!0,color:h.text}),D.addText(J.domain.toUpperCase(),{x:.7,y:W+.7,w:2,h:.35,fontSize:12,color:"FFFFFF",fill:{color:h.secondary},align:"center"});const $=r.critical_capabilities.filter(ne=>ne.cog_id===J.id).length;D.addText(`${$} Capabilities`,{x:3,y:W+.7,w:2,h:.35,fontSize:11,color:h.secondary}),J.rationale&&D.addText(J.rationale.substring(0,150)+(J.rationale.length>150?"...":""),{x:.7,y:W+1.1,w:8.6,h:.4,fontSize:10,color:h.secondary,italic:!0})})});const k=y.addSlide();k.addText("TOP VULNERABILITIES",{x:.5,y:.3,w:9,h:.6,fontSize:28,bold:!0,color:h.primary});const A=[...t].sort((C,j)=>j.composite_score-C.composite_score).slice(0,10),T=[];if(T.push([{text:"#",options:{bold:!0,fontSize:12,color:"FFFFFF",fill:h.primary}},{text:"Vulnerability",options:{bold:!0,fontSize:12,color:"FFFFFF",fill:h.primary}},{text:"Type",options:{bold:!0,fontSize:12,color:"FFFFFF",fill:h.primary}},{text:"Score",options:{bold:!0,fontSize:12,color:"FFFFFF",fill:h.primary}}]),A.forEach((C,j)=>{const D=C.composite_score>=12?"EF4444":C.composite_score>=9?"F59E0B":"10B981";T.push([{text:(j+1).toString(),options:{fontSize:11}},{text:C.vulnerability.substring(0,60)+(C.vulnerability.length>60?"...":""),options:{fontSize:11}},{text:C.vulnerability_type,options:{fontSize:10}},{text:C.composite_score.toString(),options:{fontSize:11,bold:!0,color:D}}])}),k.addTable(T,{x:.5,y:1.2,w:9,h:5,colW:[.5,6,1.5,1],fontSize:11,border:{pt:1,color:"D1D5DB"},fill:{color:"FFFFFF"}}),s&&s.length>0){const C=y.addSlide();C.addText("NETWORK ANALYSIS",{x:.5,y:.3,w:9,h:.6,fontSize:28,bold:!0,color:h.primary}),[{label:"Total Centers of Gravity",value:r.centers_of_gravity.length},{label:"Total Capabilities",value:r.critical_capabilities.length},{label:"Total Requirements",value:r.critical_requirements.length},{label:"Total Vulnerabilities",value:r.critical_vulnerabilities.length},{label:"Network Edges",value:s.length}].forEach((D,J)=>{const q=1.5+J*.9;C.addShape(y.ShapeType.rect,{x:1,y:q,w:8,h:.7,fill:{color:h.light},line:{color:h.secondary,width:1}}),C.addText(D.label,{x:1.3,y:q+.15,w:5,h:.4,fontSize:16,color:h.text}),C.addText(D.value.toString(),{x:6.5,y:q+.15,w:2,h:.4,fontSize:24,bold:!0,color:h.accent,align:"center"})}),C.addText("Note: Use the Network tab in the application for interactive visualization.",{x:.5,y:6.5,w:9,h:.4,fontSize:11,italic:!0,color:h.secondary,align:"center"})}const z=y.addSlide();z.addText("KEY RECOMMENDATIONS",{x:.5,y:.3,w:9,h:.6,fontSize:28,bold:!0,color:h.primary}),A.filter(C=>C.recommended_actions).slice(0,5).forEach((C,j)=>{const D=1.3+j*1.1;z.addText(`${j+1}. ${C.vulnerability}`,{x:.7,y:D,w:8.6,h:.4,fontSize:14,bold:!0,color:h.text});const J=Array.isArray(C.recommended_actions)?C.recommended_actions.join(", "):C.recommended_actions||"No specific actions recommended";z.addText(J,{x:1,y:D+.45,w:8.3,h:.5,fontSize:11,color:h.secondary})});const U=y.addSlide();U.background={color:h.primary},U.addText("ANALYSIS COMPLETE",{x:.5,y:2.5,w:9,h:1,fontSize:36,bold:!0,color:"FFFFFF",align:"center"}),U.addText("Continue analysis in the COG Analysis Tool for:",{x:1,y:3.8,w:8,h:.4,fontSize:16,color:"CBD5E1",align:"center"}),["â€¢ Interactive network visualization",'â€¢ "What if?" simulation mode',"â€¢ Vulnerability scoring and comparison","â€¢ AI-assisted analysis"].forEach((C,j)=>{U.addText(C,{x:2,y:4.4+j*.4,w:6,h:.3,fontSize:14,color:"FFFFFF",align:"center"})});const F=`${r.title.replace(/[^a-z0-9]/gi,"_")}-COG-Analysis.pptx`;await y.writeFile({fileName:F})}catch(d){console.error("PowerPoint export error:",d),alert("Failed to export PowerPoint. Please try again.")}finally{a(!1)}};return e.jsx(te,{variant:n,size:i,onClick:p,disabled:l,className:o,children:l?e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"h-4 w-4 mr-2 animate-spin"}),c("cog:export.powerpoint.generating")]}):e.jsxs(e.Fragment,{children:[e.jsx(Em,{className:"h-4 w-4 mr-2"}),c("cog:export.powerpoint.button")]})})}function Ak({analysis:r,vulnerabilities:t,edges:s,variant:n="outline",size:i="default",className:o}){const[l,a]=B.useState(!1),{t:c}=Bt(["cog","common"]),p=async()=>{a(!0);try{const d=await sn(()=>import("./exceljs.min-RL4gfToV.js").then(T=>T.e),__vite__mapDeps([23,4,9])),m=new d.default.Workbook;m.creator="COG Analysis Tool",m.created=new Date,m.modified=new Date,m.properties.date1904=!1;const y=m.addWorksheet(c("cog:export.excel.sheets.targetingMatrix"),{views:[{state:"frozen",xSplit:0,ySplit:1}]});y.columns=[{header:c("cog:export.excel.headers.priority"),key:"priority",width:10},{header:c("cog:export.excel.headers.vulnerability"),key:"vulnerability",width:40},{header:c("cog:export.excel.headers.cog"),key:"cog",width:35},{header:c("cog:export.excel.headers.actor"),key:"actor",width:15},{header:c("cog:export.excel.headers.domain"),key:"domain",width:15},{header:c("cog:export.excel.headers.capability"),key:"capability",width:35},{header:c("cog:export.excel.headers.requirement"),key:"requirement",width:35},{header:c("cog:export.excel.headers.type"),key:"type",width:15},{header:c("cog:export.excel.headers.impact"),key:"impact",width:10},{header:c("cog:export.excel.headers.attainability"),key:"attainability",width:13},{header:c("cog:export.excel.headers.followUp"),key:"followup",width:11},{header:c("cog:export.excel.headers.composite"),key:"composite",width:15},{header:c("cog:export.excel.headers.actions"),key:"actions",width:45},{header:"Expected Effect",key:"effect",width:40},{header:c("cog:export.excel.headers.confidence"),key:"confidence",width:12},{header:c("cog:export.excel.headers.status"),key:"status",width:12}];const h=y.getRow(1);h.font={bold:!0,color:{argb:"FFFFFFFF"}},h.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF1E3A8A"}},h.alignment={vertical:"middle",horizontal:"center",wrapText:!0},h.height=30;const _=[...t].sort((T,z)=>z.composite_score-T.composite_score);_.forEach((T,z)=>{const S=r.critical_requirements.find(j=>j.id===T.requirement_id),U=S?r.critical_capabilities.find(j=>j.id===S.capability_id):null,G=U?r.centers_of_gravity.find(j=>j.id===U.cog_id):null,F=y.addRow({priority:z+1,vulnerability:T.vulnerability||"N/A",cog:G?.description||"N/A",actor:G?.actor_category||"N/A",domain:G?.domain||"N/A",capability:U?.capability||"N/A",requirement:S?.requirement||"N/A",type:T.vulnerability_type||"N/A",impact:T.scoring?.impact_on_cog||T.custom_scoring?.impact||0,attainability:T.scoring?.attainability||T.custom_scoring?.attainability||0,followup:T.scoring?.follow_up_potential||T.custom_scoring?.follow_up||0,composite:T.composite_score,actions:Array.isArray(T.recommended_actions)?T.recommended_actions.join(", "):T.recommended_actions||"N/A",effect:T.expected_effect||"N/A",confidence:T.confidence||"N/A",status:"Open"});F.alignment={vertical:"top",wrapText:!0},F.height=45;const C=F.getCell("composite");C.font={bold:!0},T.composite_score>=12?(C.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEF4444"}},C.font={bold:!0,color:{argb:"FFFFFFFF"}}):T.composite_score>=9?(C.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF59E0B"}},C.font={bold:!0,color:{argb:"FF000000"}}):T.composite_score>=6?(C.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFFBBF24"}},C.font={bold:!0,color:{argb:"FF000000"}}):(C.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF10B981"}},C.font={bold:!0,color:{argb:"FFFFFFFF"}}),F.eachCell({includeEmpty:!0},j=>{j.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})}),y.autoFilter={from:{row:1,column:1},to:{row:1,column:16}},y.addConditionalFormatting({ref:`I2:I${_.length+1}`,rules:[{type:"cellIs",operator:"greaterThan",formulae:[3],priority:1,style:{fill:{type:"pattern",pattern:"solid",bgColor:{argb:"FFFECACA"}}}}]}),y.addConditionalFormatting({ref:`J2:J${_.length+1}`,rules:[{type:"cellIs",operator:"greaterThan",formulae:[3],priority:1,style:{fill:{type:"pattern",pattern:"solid",bgColor:{argb:"FFD1FAE5"}}}}]}),y.addConditionalFormatting({ref:`K2:K${_.length+1}`,rules:[{type:"cellIs",operator:"greaterThan",formulae:[3],priority:1,style:{fill:{type:"pattern",pattern:"solid",bgColor:{argb:"FFFEF3C7"}}}}]});const b=m.addWorksheet(c("cog:export.excel.sheets.cogSummary"),{views:[{state:"frozen",xSplit:0,ySplit:1}]});b.columns=[{header:c("cog:export.excel.headers.cog"),key:"cog",width:40},{header:c("cog:export.excel.headers.actor"),key:"actor",width:15},{header:c("cog:export.excel.headers.domain"),key:"domain",width:15},{header:c("cog:export.excel.headers.rationale"),key:"rationale",width:50},{header:c("cog:capabilities.title"),key:"capabilities",width:12},{header:c("cog:requirements.title"),key:"requirements",width:13},{header:c("cog:vulnerabilities.title"),key:"vulnerabilities",width:14},{header:"Avg Score",key:"avg_score",width:12}];const N=b.getRow(1);N.font={bold:!0,color:{argb:"FFFFFFFF"}},N.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF1E3A8A"}},N.alignment={vertical:"middle",horizontal:"center",wrapText:!0},N.height=25,r.centers_of_gravity.forEach(T=>{const z=r.critical_capabilities.filter(C=>C.cog_id===T.id),S=r.critical_requirements.filter(C=>z.some(j=>j.id===C.capability_id)),U=t.filter(C=>S.some(j=>j.id===C.requirement_id)),G=U.length>0?U.reduce((C,j)=>C+j.composite_score,0)/U.length:0,F=b.addRow({cog:T.description||"N/A",actor:T.actor_category||"N/A",domain:T.domain||"N/A",rationale:T.rationale||"N/A",capabilities:z.length,requirements:S.length,vulnerabilities:U.length,avg_score:G.toFixed(2)});F.alignment={vertical:"top",wrapText:!0},F.height=35,F.eachCell({includeEmpty:!0},C=>{C.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}})});const u=m.addWorksheet("Analysis Summary");u.mergeCells("A1:D1");const v=u.getCell("A1");v.value="CENTER OF GRAVITY ANALYSIS",v.font={size:18,bold:!0,color:{argb:"FF1E3A8A"}},v.alignment={horizontal:"center",vertical:"middle"},u.getRow(1).height=30,u.addRow([]),u.addRow(["Analysis Title:",r.title]),u.addRow(["Created:",new Date(r.created_at).toLocaleDateString()]),u.addRow(["Scoring System:",r.scoring_system.toUpperCase()]),u.addRow([]),u.addRow(["OPERATIONAL CONTEXT"]),u.getRow(7).font={bold:!0,color:{argb:"FF1E3A8A"}},u.addRow(["Objective:",r.operational_context.objective||"N/A"]),u.addRow(["Desired Impact:",r.operational_context.desired_impact||"N/A"]),u.addRow(["Our Identity:",r.operational_context.our_identity||"N/A"]),u.addRow(["Operating Environment:",r.operational_context.operating_environment||"N/A"]),u.addRow(["Timeframe:",r.operational_context.timeframe||"N/A"]),u.addRow(["Strategic Level:",r.operational_context.strategic_level||"N/A"]),u.addRow([]),u.addRow(["STATISTICS"]),u.getRow(15).font={bold:!0,color:{argb:"FF1E3A8A"}},u.addRow(["Total COGs:",r.centers_of_gravity.length]),u.addRow(["Total Capabilities:",r.critical_capabilities.length]),u.addRow(["Total Requirements:",r.critical_requirements.length]),u.addRow(["Total Vulnerabilities:",r.critical_vulnerabilities.length]),s&&u.addRow(["Network Edges:",s.length]),u.addRow([]),u.addRow(["TOP 10 VULNERABILITIES"]),u.getRow(s?22:21).font={bold:!0,color:{argb:"FF1E3A8A"}},_.slice(0,10).forEach((T,z)=>{u.addRow([`${z+1}.`,T.vulnerability,`Score: ${T.composite_score}`])}),u.getColumn(1).width=25,u.getColumn(2).width=60,u.getColumn(3).width=15,u.getColumn(4).width=15,u.eachRow({includeEmpty:!1},T=>{T.alignment={vertical:"top",wrapText:!0}});const w=await m.xlsx.writeBuffer(),k=new Blob([w],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),A=`${r.title.replace(/[^a-z0-9]/gi,"_")}-Targeting-Matrix.xlsx`;Rm.saveAs(k,A)}catch(d){console.error("Excel export error:",d),alert("Failed to export Excel file. Please try again.")}finally{a(!1)}};return e.jsx(te,{variant:n,size:i,onClick:p,disabled:l,className:o,children:l?e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"h-4 w-4 mr-2 animate-spin"}),c("cog:export.excel.generating")]}):e.jsxs(e.Fragment,{children:[e.jsx(Am,{className:"h-4 w-4 mr-2"}),c("cog:export.excel.button")]})})}function Tk({analysis:r,vulnerabilities:t,edges:s,variant:n="outline",size:i="default",className:o}){const[l,a]=B.useState(!1),{t:c}=Bt(["cog","common"]),p=async()=>{a(!0);try{const d=new xa({orientation:"portrait",unit:"mm",format:"letter"}),m={primary:[30,58,138],secondary:[100,116,139],accent:[239,68,68],text:[31,41,55],light:[249,250,251]};let y=20;const h=d.internal.pageSize.getWidth(),_=d.internal.pageSize.getHeight(),b=20,N=()=>{d.addPage(),y=20,u()},u=()=>{const $=d.internal.pages.length-1;$>1&&(d.setFontSize(9),d.setTextColor(100,116,139),d.text(`Page ${$}`,h-b-10,_-10))},v=$=>y+$>_-30?(N(),!0):!1;d.setFillColor(...m.primary),d.rect(0,0,h,80,"F"),d.setFontSize(24),d.setTextColor(255,255,255),d.setFont("helvetica","bold"),d.text(c("cog:export.pdf.cover.title"),h/2,35,{align:"center"}),d.text(c("cog:export.pdf.cover.subtitle"),h/2,50,{align:"center"}),d.setFontSize(14),d.setFont("helvetica","normal"),d.text(r.title,h/2,65,{align:"center"}),y=100,d.setFontSize(12),d.setTextColor(...m.text),d.setFont("helvetica","bold"),d.text(c("cog:export.pdf.cover.classification"),b,y),d.setFont("helvetica","normal"),d.text(c("cog:export.pdf.cover.unclassified"),b+50,y),y+=10,d.setFont("helvetica","bold"),d.text(c("cog:export.pdf.cover.date"),b,y),d.setFont("helvetica","normal"),d.text(new Date(r.created_at).toLocaleDateString(),b+50,y),y+=10,d.setFont("helvetica","bold"),d.text(c("cog:export.pdf.cover.scoringSystem"),b,y),d.setFont("helvetica","normal"),d.text(r.scoring_system.toUpperCase(),b+50,y),y=_-60,d.setFontSize(9),d.setTextColor(100,116,139),d.setFont("helvetica","italic"),d.text("This document is generated for analytical purposes. Verify all information before operational use.",h/2,y,{align:"center",maxWidth:h-40}),y=_-40,d.setFontSize(8),d.text("Generated by COG Analysis Tool",h/2,y,{align:"center"}),d.text("https://github.com/gitayam/researchtoolspy",h/2,y+5,{align:"center"}),N(),y=20,d.setFontSize(18),d.setTextColor(...m.primary),d.setFont("helvetica","bold"),d.text(c("cog:export.pdf.sections.executiveSummary"),b,y),y+=12,d.setFontSize(11),d.setTextColor(...m.text),d.setFont("helvetica","normal");const w=`This Center of Gravity (COG) analysis identifies and assesses ${r.centers_of_gravity.length} center(s) of gravity across ${new Set(r.centers_of_gravity.map($=>$.actor_category)).size} actor categor${new Set(r.centers_of_gravity.map($=>$.actor_category)).size===1?"y":"ies"}. The analysis examined ${r.critical_capabilities.length} critical capabilities, ${r.critical_requirements.length} critical requirements, and identified ${r.critical_vulnerabilities.length} critical vulnerabilities.`,k=d.splitTextToSize(w,h-2*b);d.text(k,b,y),y+=k.length*6+8,d.setFont("helvetica","bold"),d.text("KEY STATISTICS",b,y),y+=8;const A=[["Centers of Gravity:",r.centers_of_gravity.length.toString()],["Critical Capabilities:",r.critical_capabilities.length.toString()],["Critical Requirements:",r.critical_requirements.length.toString()],["Critical Vulnerabilities:",r.critical_vulnerabilities.length.toString()]];s&&s.length>0&&A.push(["Network Edges:",s.length.toString()]),d.setFont("helvetica","normal"),A.forEach(([$,ne])=>{d.text($,b+5,y),d.setFont("helvetica","bold"),d.text(ne,b+70,y),d.setFont("helvetica","normal"),y+=6}),y+=8,d.setFont("helvetica","bold"),d.text("TOP 5 VULNERABILITIES (BY COMPOSITE SCORE)",b,y),y+=8;const T=[...t].sort(($,ne)=>ne.composite_score-$.composite_score),z=T.slice(0,5);d.setFont("helvetica","normal"),z.forEach(($,ne)=>{const K=$.composite_score>=12?m.accent:$.composite_score>=9?[245,158,11]:[16,185,129];d.setTextColor(...K),d.setFont("helvetica","bold"),d.text(`${ne+1}.`,b+5,y),d.setTextColor(...m.text),d.setFont("helvetica","normal");const P=d.splitTextToSize($.vulnerability,h-2*b-30);d.text(P,b+12,y),d.setFont("helvetica","bold"),d.text(`Score: ${$.composite_score}`,h-b-30,y),y+=Math.max(P.length*5,5)+3,v(20)&&d.setFont("helvetica","normal")}),v(100)||N(),y=20,d.setFontSize(18),d.setTextColor(...m.primary),d.setFont("helvetica","bold"),d.text(c("cog:export.pdf.sections.operationalContext"),b,y),y+=12,d.setFontSize(11),d.setTextColor(...m.text),d.setFont("helvetica","normal"),[{label:"1.1 OBJECTIVE",value:r.operational_context.objective},{label:"1.2 DESIRED IMPACT",value:r.operational_context.desired_impact},{label:"1.3 OUR IDENTITY",value:r.operational_context.our_identity},{label:"1.4 OPERATING ENVIRONMENT",value:r.operational_context.operating_environment},{label:"1.5 TIMEFRAME",value:r.operational_context.timeframe},{label:"1.6 STRATEGIC LEVEL",value:r.operational_context.strategic_level}].forEach($=>{v(30),d.setFont("helvetica","bold"),d.text($.label,b,y),y+=6,d.setFont("helvetica","normal");const ne=d.splitTextToSize($.value||"Not specified",h-2*b-5);d.text(ne,b+5,y),y+=ne.length*5+8}),v(80)||N(),y=20,d.setFontSize(18),d.setTextColor(...m.primary),d.setFont("helvetica","bold"),d.text(c("cog:export.pdf.sections.cogAnalysis"),b,y),y+=12;const U=["friendly","adversary","host_nation","third_party"],G={friendly:c("cog:actorCategories.friendly"),adversary:c("cog:actorCategories.adversary"),host_nation:c("cog:actorCategories.hostNation"),third_party:c("cog:actorCategories.thirdParty")};U.forEach($=>{const ne=r.centers_of_gravity.filter(K=>K.actor_category===$);ne.length!==0&&(v(60),d.setFontSize(14),d.setTextColor(...m.primary),d.setFont("helvetica","bold"),d.text(`2.${U.indexOf($)+1} ${G[$].toUpperCase()}`,b,y),y+=10,ne.forEach((K,P)=>{if(v(50),d.setFontSize(12),d.setTextColor(...m.text),d.setFont("helvetica","bold"),d.text(`COG ${P+1}: ${K.description||"Unnamed COG"}`,b+5,y),y+=7,d.setFontSize(10),d.setFont("helvetica","normal"),d.text(`${c("cog:export.pdf.cogLabels.domain")} ${K.domain}`,b+10,y),y+=6,K.rationale){d.setFont("helvetica","italic");const re=d.splitTextToSize(`${c("cog:export.pdf.cogLabels.rationale")} ${K.rationale}`,h-2*b-15);d.text(re,b+10,y),y+=re.length*5+5}const Y=r.critical_capabilities.filter(re=>re.cog_id===K.id);Y.length>0&&(v(30),d.setFont("helvetica","bold"),d.text(`${c("cog:export.pdf.cogLabels.capabilities")}`,b+10,y),y+=6,Y.forEach((re,le)=>{v(20),d.setFont("helvetica","normal");const se=d.splitTextToSize(`${le+1}. ${re.capability}`,h-2*b-20);d.text(se,b+15,y),y+=se.length*5+3})),y+=5}),y+=5)}),v(80)||N(),y=20,d.setFontSize(18),d.setTextColor(...m.primary),d.setFont("helvetica","bold"),d.text(c("cog:export.pdf.sections.vulnerabilityAssessment"),b,y),y+=12,d.setFontSize(11),d.setTextColor(...m.text),d.setFont("helvetica","normal");const F=`This section provides a prioritized assessment of ${t.length} identified critical vulnerabilities, ranked by composite score. Each vulnerability is linked to its parent requirement and capability.`,C=d.splitTextToSize(F,h-2*b);d.text(C,b,y),y+=C.length*5+10;const j=T.slice(0,20).map(($,ne)=>{const K=r.critical_requirements.find(re=>re.id===$.requirement_id),P=K?r.critical_capabilities.find(re=>re.id===K.capability_id):null,Y=P?r.centers_of_gravity.find(re=>re.id===P.cog_id):null;return[(ne+1).toString(),$.vulnerability.substring(0,60)+($.vulnerability.length>60?"...":""),Y?.description?.substring(0,30)||"N/A",$.composite_score.toString(),$.vulnerability_type||"N/A"]});Nc(d,{startY:y,head:[[c("cog:export.pdf.vulnerabilityLabels.rank"),c("cog:export.pdf.vulnerabilityLabels.vulnerability"),c("cog:export.pdf.vulnerabilityLabels.cog"),c("cog:export.pdf.vulnerabilityLabels.score"),"Type"]],body:j,theme:"grid",headStyles:{fillColor:m.primary,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:8,cellPadding:2},columnStyles:{0:{cellWidth:10},1:{cellWidth:80},2:{cellWidth:50},3:{cellWidth:15,halign:"center"},4:{cellWidth:25}},didDrawCell:$=>{if($.column.index===3&&$.section==="body"){const ne=parseInt($.cell.text[0]);ne>=12?($.cell.styles.textColor=m.accent,$.cell.styles.fontStyle="bold"):ne>=9&&($.cell.styles.textColor=[245,158,11],$.cell.styles.fontStyle="bold")}}}),y=d.lastAutoTable.finalY+10,v(80)||N(),y=20,d.setFontSize(18),d.setTextColor(...m.primary),d.setFont("helvetica","bold"),d.text(c("cog:export.pdf.sections.recommendations"),b,y),y+=12,d.setFontSize(11),d.setTextColor(...m.text),d.setFont("helvetica","normal"),T.filter($=>$.recommended_actions).slice(0,10).forEach(($,ne)=>{v(35),d.setFont("helvetica","bold"),d.text(`${ne+1}. ${$.vulnerability}`,b,y),y+=6,d.setFont("helvetica","normal");const K=d.splitTextToSize(`Recommended Actions: ${$.recommended_actions}`,h-2*b-5);if(d.text(K,b+5,y),y+=K.length*5+3,$.expected_effect){d.setFont("helvetica","italic");const P=d.splitTextToSize(`Expected Effect: ${$.expected_effect}`,h-2*b-5);d.text(P,b+5,y),y+=P.length*5+3}d.setFont("helvetica","normal"),d.setFontSize(9),d.setTextColor(100,116,139),d.text(`Composite Score: ${$.composite_score} | Confidence: ${$.confidence||"N/A"}`,b+5,y),y+=8,d.setFontSize(11),d.setTextColor(...m.text)}),v(80)||N(),y=20,d.setFontSize(18),d.setTextColor(...m.primary),d.setFont("helvetica","bold"),d.text(c("cog:export.pdf.sections.opordIntegration"),b,y),y+=12,d.setFontSize(11),d.setTextColor(...m.text),d.setFont("helvetica","normal"),["This COG analysis can be integrated into your Operations Order (OPORD) as follows:","","1. SITUATION","   a. Enemy Forces: Use adversary COG analysis from Section 2","   b. Friendly Forces: Reference friendly COG analysis for own vulnerabilities","","2. MISSION","   Use the Operational Context (Section 1) to inform mission statement","","3. EXECUTION","   a. Commander's Intent: Leverage desired impact from operational context","   b. Tasks: Prioritize actions based on vulnerability assessment (Section 3)","   c. Coordinating Instructions: Reference recommended actions (Section 4)","","4. SUSTAINMENT","   Identify logistics requirements from critical requirements analysis","","5. COMMAND AND SIGNAL","   Consider information vulnerabilities from analysis","","TARGETING GUIDANCE:","- Focus efforts on high-priority vulnerabilities (Score >= 12)","- Target critical requirements that support multiple capabilities","- Exploit cascading effects identified in network analysis","- Reassess COG validity after major operational changes"].forEach($=>{v(10),d.text($,b,y),y+=5});const q=d.internal.pages.length-1;for(let $=2;$<=q;$++)d.setPage($),u();const W=`${r.title.replace(/[^a-z0-9]/gi,"_")}-COG-Report.pdf`;d.save(W)}catch(d){console.error("PDF export error:",d),alert("Failed to export PDF. Please try again.")}finally{a(!1)}};return e.jsx(te,{variant:n,size:i,onClick:p,disabled:l,className:o,children:l?e.jsxs(e.Fragment,{children:[e.jsx(xt,{className:"h-4 w-4 mr-2 animate-spin"}),c("cog:export.pdf.generating")]}):e.jsxs(e.Fragment,{children:[e.jsx(nr,{className:"h-4 w-4 mr-2"}),c("cog:export.pdf.button")]})})}function Ik({open:r,onOpenChange:t,frameworkId:s,frameworkType:n,defaultTitle:i="",defaultDescription:o=""}){const{t:l}=Bt(["library","common"]),{toast:a}=jc(),[c,p]=B.useState(!1),[d,m]=B.useState({title:i,description:o,category:"",tags:""}),y=async()=>{const h=localStorage.getItem("omnicore_user_hash");if(!h){a({title:l("common:errors.error"),description:l("common:errors.loginRequired"),variant:"destructive"});return}if(!d.title.trim()){a({title:l("common:errors.error"),description:l("library:publish.form.titlePlaceholder"),variant:"destructive"});return}p(!0);try{const _=await fetch("/api/library",{method:"POST",headers:{"Content-Type":"application/json","X-User-Hash":h},body:JSON.stringify({framework_id:s,framework_type:n,title:d.title,description:d.description,category:d.category||null,tags:d.tags})}),b=await _.json();_.ok?(a({title:l("common:success"),description:l("library:publish.success")}),t(!1),m({title:"",description:"",category:"",tags:""})):a({title:l("common:errors.error"),description:b.error||l("library:publish.error"),variant:"destructive"})}catch(_){console.error("[PublishDialog] Error:",_),a({title:l("common:errors.error"),description:l("library:publish.error"),variant:"destructive"})}finally{p(!1)}};return e.jsx(wt,{open:r,onOpenChange:t,children:e.jsxs(jt,{className:"sm:max-w-[600px]",children:[e.jsxs(_t,{children:[e.jsx(kt,{children:l("library:publish.title")}),e.jsx(It,{children:l("library:publish.description")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"title",children:l("library:publish.form.title")}),e.jsx(Ee,{id:"title",value:d.title,onChange:h=>m({...d,title:h.target.value}),placeholder:l("library:publish.form.titlePlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"description",children:l("library:publish.form.description")}),e.jsx($e,{id:"description",value:d.description,onChange:h=>m({...d,description:h.target.value}),placeholder:l("library:publish.form.descriptionPlaceholder"),rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"category",children:l("library:publish.form.category")}),e.jsxs(ct,{value:d.category,onValueChange:h=>m({...d,category:h}),children:[e.jsx(dt,{children:e.jsx(ut,{placeholder:l("library:publish.form.categoryPlaceholder")})}),e.jsxs(ht,{children:[e.jsx(Te,{value:"adversary_analysis",children:l("library:categories.adversary_analysis")}),e.jsx(Te,{value:"friendly_analysis",children:l("library:categories.friendly_analysis")}),e.jsx(Te,{value:"host_nation",children:l("library:categories.host_nation")}),e.jsx(Te,{value:"strategic_planning",children:l("library:categories.strategic_planning")}),e.jsx(Te,{value:"operational_planning",children:l("library:categories.operational_planning")}),e.jsx(Te,{value:"tactical_analysis",children:l("library:categories.tactical_analysis")}),e.jsx(Te,{value:"intelligence",children:l("library:categories.intelligence")}),e.jsx(Te,{value:"deception",children:l("library:categories.deception")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(fe,{htmlFor:"tags",children:l("library:publish.form.tags")}),e.jsx(Ee,{id:"tags",value:d.tags,onChange:h=>m({...d,tags:h.target.value}),placeholder:l("library:publish.form.tagsPlaceholder")}),e.jsx("p",{className:"text-xs text-gray-500",children:l("library:publish.form.tagsHint")})]})]}),e.jsxs(Wn,{children:[e.jsx(te,{variant:"outline",onClick:()=>t(!1),disabled:c,children:l("common:cancel")}),e.jsx(te,{onClick:y,disabled:c,children:l(c?"library:publish.publishing":"library:publish.confirm")})]})]})})}const Rk={friendly:"bg-green-100 text-green-800 border-green-300",adversary:"bg-red-100 text-red-800 border-red-300",host_nation:"bg-blue-100 text-blue-800 border-blue-300",third_party:"bg-gray-100 text-gray-800 border-gray-300"},km={diplomatic:"ðŸ¤",information:"ðŸ“¡",military:"ðŸŽ–ï¸",economic:"ðŸ’°",financial:"ðŸ’µ",intelligence:"ðŸ”",law_enforcement:"ðŸ‘®",cyber:"ðŸ’»",space:"ðŸ›°ï¸"};function Ok({data:r,onEdit:t,onDelete:s,backPath:n}){const{t:i}=Bt(["cog"]),o=xr(),[l,a]=B.useState("overview"),[c,p]=B.useState(new Set),[d,m]=B.useState(!1),y=B.useMemo(()=>ql(r.critical_vulnerabilities),[r.critical_vulnerabilities]),h=B.useMemo(()=>wk(r),[r]),_=B.useMemo(()=>jk(h),[h]),b=B.useMemo(()=>{const S={friendly:[],adversary:[],host_nation:[],third_party:[]};return r.centers_of_gravity.forEach(U=>{S[U.actor_category]&&S[U.actor_category].push(U)}),S},[r.centers_of_gravity]),N=S=>{const U=r.scoring_system==="linear"?15:36,G=S/U*100;return G>=80?"bg-red-100 text-red-900 border-red-300":G>=60?"bg-orange-100 text-orange-900 border-orange-300":G>=40?"bg-yellow-100 text-yellow-900 border-yellow-300":"bg-gray-100 text-gray-900 border-gray-300"},u=S=>r.critical_capabilities.filter(U=>U.cog_id===S),v=S=>r.critical_requirements.filter(U=>U.capability_id===S),g=S=>r.critical_vulnerabilities.filter(U=>U.requirement_id===S),w=S=>{const U=new Set(c);U.has(S)?U.delete(S):U.add(S),p(U)},k=()=>{const S=[`${i("view.export.csvHeaders.source")},${i("view.export.csvHeaders.sourceType")},${i("view.export.csvHeaders.target")},${i("view.export.csvHeaders.targetType")},${i("view.export.csvHeaders.weight")},${i("view.export.csvHeaders.relationship")}`,...h.map(C=>`${C.source},${C.source_type},${C.target},${C.target_type},${C.weight},${C.relationship}`)].join(`
`),U=new Blob([S],{type:"text/csv"}),G=URL.createObjectURL(U),F=document.createElement("a");F.href=G,F.download=i("view.export.edgeListFilename",{title:r.title.replace(/\s+/g,"_")}),F.click(),URL.revokeObjectURL(G)},A=()=>{const S=ql(r.critical_vulnerabilities),U=`# ${i("view.markdown.title",{title:r.title})}

${r.description}

## ${i("view.markdown.operationalContextTitle")}

- **${i("view.markdown.objective")}:** ${r.operational_context.objective}
- **${i("view.markdown.desiredImpact")}:** ${r.operational_context.desired_impact}
- **${i("view.markdown.ourIdentity")}:** ${r.operational_context.our_identity}
- **${i("view.markdown.operatingEnvironment")}:** ${r.operational_context.operating_environment}
- **${i("view.markdown.constraints")}:** ${r.operational_context.constraints.join(", ")}
- **${i("view.markdown.restraints")}:** ${r.operational_context.restraints.join(", ")}
- **${i("view.markdown.timeframe")}:** ${r.operational_context.timeframe}
- **${i("view.markdown.strategicLevel")}:** ${r.operational_context.strategic_level.toUpperCase()}

## ${i("view.markdown.centersOfGravity")}

${r.centers_of_gravity.map(j=>`
### ${j.actor_category.toUpperCase()} - ${j.domain.toUpperCase()}${j.actor_name?` (${j.actor_name})`:""}

${j.description}

**${i("view.markdown.rationale")}:** ${j.rationale}

**${i("view.markdown.criticalCapabilities")}:**
${u(j.id).map(D=>`
- **${D.capability}**
  - ${D.description}
  - ${i("view.markdown.strategicContribution")}: ${D.strategic_contribution}
  - ${i("view.markdown.requirements")}:
${v(D.id).map(J=>`    - ${J.requirement} (${J.requirement_type})
${g(J.id).map(q=>`      - âš ï¸ **${q.vulnerability}** (${q.vulnerability_type})
        - Score: ${q.composite_score} (I:${q.scoring.impact_on_cog}, A:${q.scoring.attainability}, F:${q.scoring.follow_up_potential})`).join(`
`)}`).join(`
`)}`).join(`
`)}
`).join(`
`)}

## ${i("view.markdown.criticalVulnerabilitiesPrioritized")}

${S.map((j,D)=>`
### ${D+1}. ${j.vulnerability} (Score: ${j.composite_score})

- **${i("view.markdown.type")}:** ${j.vulnerability_type}
- **${i("view.markdown.descriptionLabel")}:** ${j.description||i("view.markdown.notAvailable")}
- **${i("view.markdown.impactOnCOG")}:** ${j.scoring.impact_on_cog}
- **${i("view.markdown.attainability")}:** ${j.scoring.attainability}
- **${i("view.markdown.followUpPotential")}:** ${j.scoring.follow_up_potential}
${j.exploitation_method?`- **${i("view.markdown.exploitationMethod")}:** ${j.exploitation_method}`:""}
`).join(`
`)}

## ${i("view.markdown.networkAnalysis")}

### ${i("view.markdown.topNodesByDegreeCentrality")}

${Object.entries(_.degree_centrality).sort(([,j],[,D])=>D-j).slice(0,10).map(([j,D],J)=>`${J+1}. ${j.substring(0,8)} (${D} ${i("view.network.connections")})`).join(`
`)}

---

*${i("view.markdown.generatedFrom")}*
*${i("view.markdown.referenceLink")}*
`,G=new Blob([U],{type:"text/markdown"}),F=URL.createObjectURL(G),C=document.createElement("a");C.href=F,C.download=i("view.export.reportFilename",{title:r.title.replace(/\s+/g,"_")}),C.click(),URL.revokeObjectURL(F)},T=()=>{const S=ql(r.critical_vulnerabilities),U=[`${i("view.export.csvHeaders.rank")},${i("view.export.csvHeaders.vulnerability")},${i("view.export.csvHeaders.type")},${i("view.export.csvHeaders.impact")},${i("view.export.csvHeaders.attainability")},${i("view.export.csvHeaders.followUp")},${i("view.export.csvHeaders.compositeScore")},${i("view.export.csvHeaders.description")}`,...S.map((j,D)=>`${D+1},"${j.vulnerability}","${j.vulnerability_type}",${j.scoring.impact_on_cog},${j.scoring.attainability},${j.scoring.follow_up_potential},${j.composite_score},"${j.description||""}"`)].join(`
`),G=new Blob([U],{type:"text/csv"}),F=URL.createObjectURL(G),C=document.createElement("a");C.href=F,C.download=i("view.export.vulnerabilitiesFilename",{title:r.title.replace(/\s+/g,"_")}),C.click(),URL.revokeObjectURL(F)},z=()=>{confirm(i("view.alerts.confirmDelete",{title:r.title}))&&s()};return e.jsxs("div",{className:"space-y-6 pb-20",children:[e.jsxs("div",{className:"flex items-center justify-between sticky top-0 bg-white dark:bg-gray-950 z-10 py-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(te,{variant:"outline",onClick:()=>o(n),children:[e.jsx(Ir,{className:"h-4 w-4 mr-2"}),i("view.header.back")]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.title}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:[i("view.header.cogAnalysis")," â€¢ ",r.scoring_system==="linear"?i("view.header.linearScoring"):i("view.header.logarithmicScoring")]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{variant:"outline",onClick:()=>window.open("https://irregularpedia.org/index.php/Center_of_Gravity_Analysis_Guide","_blank"),children:[e.jsx(ar,{className:"h-4 w-4 mr-2"}),i("view.header.reference")]}),e.jsxs(te,{variant:"outline",onClick:()=>{const S=r.centers_of_gravity.filter(U=>U.actor_id).map(U=>U.actor_id);o("/dashboard/network-graph",{state:{source:"cog",title:r.title,highlightEntities:S}})},children:[e.jsx(ma,{className:"h-4 w-4 mr-2"}),i("view.header.viewInNetwork")]}),e.jsx(wa,{frameworkId:r.id,frameworkType:"cog",isPublic:r.is_public||!1,shareToken:r.share_token}),e.jsxs(te,{variant:"outline",onClick:()=>m(!0),children:[e.jsx(hx,{className:"h-4 w-4 mr-2"}),i("view.header.publishToLibrary")]}),e.jsxs(te,{variant:"outline",onClick:t,children:[e.jsx(Ls,{className:"h-4 w-4 mr-2"}),i("view.header.edit")]}),e.jsxs(te,{variant:"outline",onClick:z,className:"text-red-600",children:[e.jsx(vs,{className:"h-4 w-4 mr-2"}),i("view.header.delete")]})]})]}),r.description&&e.jsx(ge,{children:e.jsx(xe,{className:"pt-6",children:e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:r.description})})}),e.jsxs(Ar,{value:l,onValueChange:a,children:[e.jsxs(Tr,{className:"grid w-full grid-cols-5",children:[e.jsx(Ye,{value:"overview",children:i("view.tabs.overview")}),e.jsx(Ye,{value:"hierarchy",children:i("view.tabs.hierarchy")}),e.jsx(Ye,{value:"vulnerabilities",children:i("view.tabs.vulnerabilities")}),e.jsx(Ye,{value:"network",children:i("view.tabs.network")}),e.jsx(Ye,{value:"comments",children:i("view.tabs.comments")})]}),e.jsxs(pt,{value:"overview",className:"space-y-6",children:[e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsx(Ae,{children:i("view.operationalContext.title")})}),e.jsxs(xe,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400",children:i("view.operationalContext.objective")}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:r.operational_context.objective||i("view.operationalContext.notSpecified")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400",children:i("view.operationalContext.desiredImpact")}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:r.operational_context.desired_impact||i("view.operationalContext.notSpecified")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400",children:i("view.operationalContext.ourIdentity")}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:r.operational_context.our_identity||i("view.operationalContext.notSpecified")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400",children:i("view.operationalContext.operatingEnvironment")}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:r.operational_context.operating_environment||i("view.operationalContext.notSpecified")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400",children:i("view.operationalContext.timeframe")}),e.jsx("div",{className:"text-gray-900 dark:text-white",children:r.operational_context.timeframe||i("view.operationalContext.notSpecified")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400",children:i("view.operationalContext.strategicLevel")}),e.jsx(he,{variant:"outline",children:r.operational_context.strategic_level.toUpperCase()})]})]}),r.operational_context.constraints.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400 mb-1",children:i("view.operationalContext.constraints")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.operational_context.constraints.map((S,U)=>e.jsx(he,{variant:"secondary",children:S},U))})]}),r.operational_context.restraints.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400 mb-1",children:i("view.operationalContext.restraints")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.operational_context.restraints.map((S,U)=>e.jsx(he,{variant:"secondary",children:S},U))})]})]})]}),Object.entries(b).map(([S,U])=>U.length>0&&e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(he,{className:Rk[S],children:S.replace("_"," ").toUpperCase()}),e.jsxs("span",{className:"text-gray-500 text-sm font-normal",children:["(",i("view.cogsByActor.count",{count:U.length}),")"]})]})}),e.jsx(xe,{className:"space-y-3",children:U.map(G=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-2xl",children:km[G.domain]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-lg",children:G.domain.replace("_"," ").toUpperCase()}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mt-1",children:G.description}),G.rationale&&e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsxs("span",{className:"font-semibold text-gray-600",children:[i("view.markdown.rationale"),":"]})," ",G.rationale]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:[i("view.metrics.capabilitiesCount",{count:u(G.id).length})," â€¢ ",i("view.metrics.requirementsCount",{count:r.critical_requirements.filter(F=>u(G.id).some(C=>C.id===F.capability_id)).length})," â€¢"," ",i("view.metrics.vulnerabilitiesCount",{count:r.critical_vulnerabilities.filter(F=>r.critical_requirements.filter(C=>u(G.id).some(j=>j.id===C.capability_id)).some(C=>C.id===F.requirement_id)).length})]})]})]})},G.id))})]},S)),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(ge,{children:e.jsxs(xe,{className:"pt-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:r.centers_of_gravity.length}),e.jsx("div",{className:"text-sm text-gray-600",children:i("view.statistics.cogs")})]})}),e.jsx(ge,{children:e.jsxs(xe,{className:"pt-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:r.critical_capabilities.length}),e.jsx("div",{className:"text-sm text-gray-600",children:i("view.statistics.capabilities")})]})}),e.jsx(ge,{children:e.jsxs(xe,{className:"pt-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600",children:r.critical_requirements.length}),e.jsx("div",{className:"text-sm text-gray-600",children:i("view.statistics.requirements")})]})}),e.jsx(ge,{children:e.jsxs(xe,{className:"pt-6 text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:r.critical_vulnerabilities.length}),e.jsx("div",{className:"text-sm text-gray-600",children:i("view.statistics.vulnerabilities")})]})})]})]}),e.jsx(pt,{value:"hierarchy",className:"space-y-4",children:e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ae,{children:i("view.hierarchy.title")}),e.jsx("div",{className:"text-sm text-gray-500",children:i("view.hierarchy.clickToExpandCollapse")})]})}),e.jsx(xe,{className:"space-y-4",children:r.centers_of_gravity.map(S=>e.jsxs("div",{className:"border rounded-lg",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>w(S.id),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xl",children:km[S.domain]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-semibold",children:["ðŸŽ¯ ",S.actor_category.toUpperCase()," - ",S.domain.replace("_"," ").toUpperCase()]}),S.actor_name&&e.jsxs("div",{className:"text-sm text-blue-600 dark:text-blue-400 flex items-center gap-1 mt-1",children:[e.jsx("span",{children:"ðŸ‘¤ Linked Entity:"}),e.jsx(he,{variant:"outline",className:"font-normal",children:S.actor_name})]}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:S.description})]}),e.jsx(he,{variant:"outline",children:c.has(S.id)?i("view.hierarchy.collapseIcon"):i("view.hierarchy.expandIcon")})]})}),c.has(S.id)&&e.jsx("div",{className:"p-4 pt-0 space-y-3",children:u(S.id).map(U=>e.jsxs("div",{className:"ml-8 border-l-2 border-blue-300 pl-4 space-y-2",children:[e.jsxs("div",{className:"font-medium",children:["âš¡ ",U.capability]}),e.jsx("div",{className:"text-sm text-gray-600",children:U.description}),v(U.id).map(G=>e.jsxs("div",{className:"ml-6 border-l-2 border-yellow-300 pl-3 space-y-2",children:[e.jsxs("div",{className:"text-sm font-medium",children:["ðŸ“‹ ",G.requirement," ",e.jsx(he,{variant:"secondary",children:G.requirement_type})]}),g(G.id).map(F=>e.jsxs("div",{className:"ml-4 border-l-2 border-orange-300 pl-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:["âš ï¸ ",F.vulnerability]}),e.jsxs(he,{className:`ml-2 ${N(F.composite_score)}`,children:["Score: ",F.composite_score]}),e.jsxs(he,{variant:"outline",className:"ml-1",children:["Rank #",F.priority_rank]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["I:",F.scoring.impact_on_cog," â€¢ A:",F.scoring.attainability," â€¢ F:",F.scoring.follow_up_potential]})]},F.id))]},G.id))]},U.id))})]},S.id))})]})}),e.jsx(pt,{value:"vulnerabilities",className:"space-y-4",children:e.jsxs(ge,{children:[e.jsx(Ce,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Ae,{children:i("view.vulnerabilitiesTab.title")}),e.jsx(Le,{children:i("view.vulnerabilitiesTab.description")})]}),e.jsxs(te,{variant:"outline",onClick:T,children:[e.jsx(ln,{className:"h-4 w-4 mr-2"}),i("view.vulnerabilitiesTab.exportCSV")]})]})}),e.jsx(xe,{children:e.jsxs(vg,{children:[e.jsx(wg,{children:e.jsxs(wc,{children:[e.jsx(ps,{className:"w-12",children:i("view.vulnerabilitiesTab.tableHeaders.rank")}),e.jsx(ps,{children:i("view.vulnerabilitiesTab.tableHeaders.vulnerability")}),e.jsx(ps,{children:i("view.vulnerabilitiesTab.tableHeaders.type")}),e.jsx(ps,{className:"text-center",children:i("view.vulnerabilitiesTab.tableHeaders.impact")}),e.jsx(ps,{className:"text-center",children:i("view.vulnerabilitiesTab.tableHeaders.attainability")}),e.jsx(ps,{className:"text-center",children:i("view.vulnerabilitiesTab.tableHeaders.followUp")}),e.jsx(ps,{className:"text-center",children:i("view.vulnerabilitiesTab.tableHeaders.score")})]})}),e.jsx(jg,{children:y.map((S,U)=>e.jsxs(wc,{children:[e.jsxs(fs,{className:"font-bold",children:["#",U+1]}),e.jsxs(fs,{children:[e.jsx("div",{className:"font-medium",children:S.vulnerability}),S.description&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:S.description})]}),e.jsx(fs,{children:e.jsx(he,{variant:"outline",children:S.vulnerability_type})}),e.jsx(fs,{className:"text-center",children:S.scoring.impact_on_cog}),e.jsx(fs,{className:"text-center",children:S.scoring.attainability}),e.jsx(fs,{className:"text-center",children:S.scoring.follow_up_potential}),e.jsx(fs,{className:"text-center",children:e.jsx(he,{className:N(S.composite_score),children:S.composite_score})})]},S.id))})]})})]})}),e.jsxs(pt,{value:"network",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:i("view.network.title")}),e.jsx(Le,{children:i("view.network.description")})]}),e.jsx(xe,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-600 mb-2",children:i("view.network.topNodesDegree")}),e.jsx("div",{className:"space-y-1",children:Object.entries(_.degree_centrality).sort(([,S],[,U])=>U-S).slice(0,5).map(([S,U])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"font-mono text-xs",children:[S.substring(0,12),"..."]}),e.jsxs(he,{variant:"secondary",children:[U," ",i("view.network.connections")]})]},S))})]}),e.jsxs("div",{className:"pt-3 border-t",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-600 mb-1",children:i("view.network.statistics")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[i("view.network.totalNodes"),": ",Object.keys(_.degree_centrality).length]}),e.jsxs("div",{children:[i("view.network.totalEdges"),": ",h.length]})]})]})]})})]}),e.jsxs(ge,{children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:i("view.network.exportOptions")}),e.jsx(Le,{children:i("view.network.exportDescription")})]}),e.jsxs(xe,{className:"space-y-2",children:[e.jsx(Ek,{analysis:r,vulnerabilities:y,edges:h,variant:"outline",className:"w-full justify-start"}),e.jsx(Ak,{analysis:r,vulnerabilities:y,edges:h,variant:"outline",className:"w-full justify-start"}),e.jsx(Tk,{analysis:r,vulnerabilities:y,edges:h,variant:"outline",className:"w-full justify-start"}),e.jsxs(te,{variant:"outline",className:"w-full justify-start",onClick:k,children:[e.jsx(mx,{className:"h-4 w-4 mr-2"}),i("view.network.edgeListCSV")]}),e.jsxs(te,{variant:"outline",className:"w-full justify-start",onClick:A,children:[e.jsx(nr,{className:"h-4 w-4 mr-2"}),i("view.network.fullReportMarkdown")]}),e.jsxs(te,{variant:"outline",className:"w-full justify-start",onClick:T,children:[e.jsx(ln,{className:"h-4 w-4 mr-2"}),i("view.vulnerabilitiesTab.exportCSV")]})]})]})]}),e.jsx(Ck,{analysis:r,edges:h})]}),e.jsx(pt,{value:"comments",className:"space-y-4",children:e.jsx(va,{entityType:"cog_analysis",entityId:r.id})})]}),e.jsx(Ik,{open:d,onOpenChange:m,frameworkId:r.id,frameworkType:"cog",defaultTitle:r.title,defaultDescription:r.description})]})}function Fk({value:r,onChange:t,label:s="Actor",placeholder:n="Search for an actor...",helperText:i}){const[o,l]=B.useState(""),[a,c]=B.useState([]),[p,d]=B.useState(!1),[m,y]=B.useState(!1);B.useEffect(()=>{o.length>=2?h():(c([]),y(!1))},[o]);const h=async()=>{d(!0);try{const v=await fetch(`/api/claims/search-actors?q=${encodeURIComponent(o)}&limit=10`,{credentials:"include"});if(!v.ok)throw new Error("Failed to search actors");const g=await v.json();g.success&&(c(g.actors||[]),y(!0))}catch(v){console.error("Error searching actors:",v)}finally{d(!1)}},_=v=>{t({actor_id:v.id,actor_name:v.name}),l(""),y(!1)},b=()=>{t(null)},N=v=>{switch(v){case"person":return e.jsx(Fi,{className:"h-4 w-4"});case"organization":return e.jsx(px,{className:"h-4 w-4"});case"location":return e.jsx(bs,{className:"h-4 w-4"});case"group":return e.jsx(ur,{className:"h-4 w-4"});default:return e.jsx(Fi,{className:"h-4 w-4"})}},u=v=>v?v>=80?"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-400":v>=60?"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400":v>=40?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/20 dark:text-yellow-400":"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-400":"bg-gray-100 text-gray-600";return e.jsxs("div",{className:"space-y-2",children:[s&&e.jsx(fe,{children:s}),r&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-accent rounded-lg",children:[e.jsx(Fi,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"flex-1 font-medium",children:r.actor_name}),e.jsx(te,{variant:"ghost",size:"sm",onClick:b,children:e.jsx(Ze,{className:"h-4 w-4"})})]}),!r&&e.jsxs("div",{className:"relative",children:[e.jsx(ir,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ee,{type:"text",placeholder:n,value:o,onChange:v=>l(v.target.value),className:"pl-10"}),m&&a.length>0&&e.jsx(ge,{className:"absolute z-50 w-full mt-1 max-h-80 overflow-y-auto",children:e.jsx(xe,{className:"p-2",children:e.jsx("div",{className:"space-y-1",children:a.map(v=>e.jsx("button",{onClick:()=>_(v),className:"w-full text-left p-3 hover:bg-accent rounded-lg transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:N(v.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:v.name}),v.description&&e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:v.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(he,{variant:"outline",className:"text-xs capitalize",children:v.type}),v.credibility_rating!==void 0&&e.jsxs(he,{className:`text-xs ${u(v.credibility_rating)}`,children:["Credibility: ",v.credibility_rating]})]})]})]})},v.id))})})}),m&&a.length===0&&!p&&e.jsx(ge,{className:"absolute z-50 w-full mt-1",children:e.jsx(xe,{className:"p-4 text-center text-muted-foreground",children:"No actors found. Try a different search term."})}),p&&e.jsx(ge,{className:"absolute z-50 w-full mt-1",children:e.jsx(xe,{className:"p-4 text-center text-muted-foreground",children:"Searching..."})})]}),i&&!r&&e.jsx("p",{className:"text-sm text-muted-foreground",children:i})]})}function Pk(){const r={"Content-Type":"application/json"},t=localStorage.getItem("omnicore_token");t&&(r.Authorization=`Bearer ${t}`);const s=localStorage.getItem("user_hash");return s&&(r["X-User-Hash"]=s),r}function Lk({initialData:r,onSave:t,backPath:s}){const n=xr(),{t:i}=Bt("cog"),{currentWorkspaceId:o}=Kr(),l=[{id:1,name:i("wizard.steps.context.name"),description:i("wizard.steps.context.description")},{id:2,name:i("wizard.steps.cog.name"),description:i("wizard.steps.cog.description")},{id:3,name:i("wizard.steps.capabilities.name"),description:i("wizard.steps.capabilities.description")},{id:4,name:i("wizard.steps.requirements.name"),description:i("wizard.steps.requirements.description")},{id:5,name:i("wizard.steps.vulnerabilities.name"),description:i("wizard.steps.vulnerabilities.description")},{id:6,name:i("wizard.steps.review.name"),description:i("wizard.steps.review.description")}],[a,c]=B.useState(!1),[p,d]=B.useState(!1),[m,y]=B.useState(r?.id||null),h=[{value:"friendly",label:i("actorCategories.friendly")},{value:"adversary",label:i("actorCategories.adversary")},{value:"host_nation",label:i("actorCategories.hostNation")},{value:"third_party",label:i("actorCategories.thirdParty")}],_=[{value:"diplomatic",label:i("domains.diplomatic")},{value:"information",label:i("domains.information")},{value:"military",label:i("domains.military")},{value:"economic",label:i("domains.economic")},{value:"financial",label:i("domains.financial")},{value:"intelligence",label:i("domains.intelligence")},{value:"law_enforcement",label:i("domains.lawEnforcement")},{value:"cyber",label:i("domains.cyber")},{value:"space",label:i("domains.space")}],[b,N]=B.useState(1),[u,v]=B.useState(!1),[g,w]=B.useState(r?.title||""),[k,A]=B.useState(r?.description||""),[T,z]=B.useState(r?.operational_context||{objective:"",desired_impact:"",our_identity:"",operating_environment:"",constraints:[],restraints:[],timeframe:"",strategic_level:"operational"}),[S,U]=B.useState("adversary"),[G,F]=B.useState(null),[C,j]=B.useState("military"),[D,J]=B.useState(""),[q,W]=B.useState(""),[$,ne]=B.useState({criticallyDegrades:!1,sourceOfPower:!1,rightLevel:!1,canBeExploited:!1}),[K,P]=B.useState([{id:crypto.randomUUID(),capability:"",description:""}]),[Y,re]=B.useState([{id:crypto.randomUUID(),requirement:"",type:"other",capability_id:""}]),[le,se]=B.useState([{id:crypto.randomUUID(),vulnerability:"",description:"",type:"other",expectedEffect:"",recommendedActions:"",requirement_ids:[]}]),[R,I]=B.useState("linear"),Q=b/l.length*100,X=()=>{switch(b){case 1:return!!(g&&T.objective&&T.desired_impact&&T.our_identity);case 2:return!!(D&&q&&$.criticallyDegrades&&$.sourceOfPower);case 3:return K.some(f=>f.capability&&f.description);case 4:return Y.some(f=>f.requirement);case 5:return le.some(f=>f.vulnerability&&f.description);case 6:return!0;default:return!1}},V=()=>{b<l.length&&(N(b+1),window.scrollTo({top:0,behavior:"smooth"}))},M=()=>{b>1&&(N(b-1),window.scrollTo({top:0,behavior:"smooth"}))},oe=async()=>{if(!m){alert("âŒ Please save the COG analysis first before generating entities.");return}if(!(p&&!confirm("Entities have already been generated. Generate again? This will create duplicate entities."))){c(!0);try{const f=await fetch(`/api/frameworks/${m}/generate-entities?workspace_id=${o}`,{method:"POST",headers:Pk()});if(!f.ok){const H=await f.json();throw new Error(H.error||"Entity generation failed")}const x=await f.json();d(!0);const E=`âœ… Successfully generated ${x.summary.actors} actors, ${x.summary.behaviors} behaviors, and ${x.summary.relationships} relationships!

View them in the Network Graph.`;confirm(E+`

Go to Network Graph now?`)&&n("/network")}catch(f){console.error("Failed to generate entities:",f),alert(`âŒ Entity generation failed: ${f instanceof Error?f.message:"Unknown error"}`)}finally{c(!1)}}},O=async()=>{v(!0);try{const f=crypto.randomUUID(),x=crypto.randomUUID(),E=crypto.randomUUID(),H=D?[{id:f,actor_category:S||"adversary",actor_name:G?.actor_name,actor_id:G?.actor_id,domain:C||"military",description:D,rationale:q||"",validated:Object.values($).every(ie=>ie),confidence:Object.values($).every(ie=>ie)?"high":"medium",priority:1,linked_evidence:[]}]:[],ee=K.filter(ie=>ie.capability).map((ie,ke)=>({id:ie.id||(ke===0?x:crypto.randomUUID()),cog_id:f,capability:ie.capability,description:ie.description||"",strategic_contribution:ie.description||"",linked_evidence:[]})),Z=Y.filter(ie=>ie.requirement&&ie.capability_id).map((ie,ke)=>({id:ie.id||(ke===0?E:crypto.randomUUID()),capability_id:ie.capability_id,requirement:ie.requirement,requirement_type:ie.type,description:ie.requirement,linked_evidence:[]})),ue=le.filter(ie=>ie.vulnerability&&ie.requirement_ids.length>0).flatMap(ie=>ie.requirement_ids.map(ke=>({id:crypto.randomUUID(),requirement_id:ke,vulnerability:ie.vulnerability,vulnerability_type:ie.type,description:ie.description||"",expected_effect:ie.expectedEffect||"",recommended_actions:ie.recommendedActions?ie.recommendedActions.split(",").map(Oe=>Oe.trim()):[],confidence:"medium",scoring:{impact_on_cog:3,attainability:3,follow_up_potential:3},composite_score:9,linked_evidence:[]}))),pe={id:r?.id||crypto.randomUUID(),title:g||`Draft - ${new Date().toLocaleDateString()}`,description:k||"",operational_context:T,scoring_system:R,centers_of_gravity:H,critical_capabilities:ee,critical_requirements:Z,critical_vulnerabilities:ue,created_at:r?.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),created_by:r?.created_by||1,status:"draft"};await t(pe),y(pe.id),alert("âœ… Draft saved successfully! You can continue working or come back later.")}catch(f){console.error("Failed to save draft:",f),alert("âŒ Failed to save draft. Please try again.")}finally{v(!1)}},ce=async()=>{v(!0);try{const f=crypto.randomUUID(),x=crypto.randomUUID(),E=crypto.randomUUID(),H={id:f,actor_category:S,domain:C,description:D,rationale:q,validated:Object.values($).every(ie=>ie),confidence:Object.values($).every(ie=>ie)?"high":"medium",priority:1,linked_evidence:[]},ee=K.filter(ie=>ie.capability).map((ie,ke)=>({id:ie.id||(ke===0?x:crypto.randomUUID()),cog_id:f,capability:ie.capability,description:ie.description,strategic_contribution:ie.description,linked_evidence:[]})),Z=Y.filter(ie=>ie.requirement&&ie.capability_id).map((ie,ke)=>({id:ie.id||(ke===0?E:crypto.randomUUID()),capability_id:ie.capability_id,requirement:ie.requirement,requirement_type:ie.type,description:ie.requirement,linked_evidence:[]})),ue=le.filter(ie=>ie.vulnerability&&ie.requirement_ids.length>0).flatMap(ie=>ie.requirement_ids.map(ke=>({id:crypto.randomUUID(),requirement_id:ke,vulnerability:ie.vulnerability,vulnerability_type:ie.type,description:ie.description,expected_effect:ie.expectedEffect,recommended_actions:ie.recommendedActions?ie.recommendedActions.split(",").map(Oe=>Oe.trim()):[],confidence:"medium",scoring:{impact_on_cog:3,attainability:3,follow_up_potential:3},composite_score:9,linked_evidence:[]}))),pe={id:r?.id||crypto.randomUUID(),title:g,description:k,operational_context:T,scoring_system:R,centers_of_gravity:[H],critical_capabilities:ee,critical_requirements:Z,critical_vulnerabilities:ue,created_at:r?.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),created_by:r?.created_by||1,status:"active"};await t(pe),y(pe.id),n(s)}catch(f){console.error("Failed to save:",f)}finally{v(!1)}},L=()=>{if(confirm(i("wizard.navigation.switchToAdvanced"))){const f=crypto.randomUUID(),x=crypto.randomUUID(),E=crypto.randomUUID(),H=D&&q?{id:f,actor_category:S,actor_name:G?.actor_name,actor_id:G?.actor_id,domain:C,description:D,rationale:q,validated:Object.values($).every(ie=>ie),confidence:Object.values($).every(ie=>ie)?"high":"medium",priority:1,linked_evidence:[]}:void 0,ee=K.filter(ie=>ie.capability).map((ie,ke)=>({id:ie.id||(ke===0?x:crypto.randomUUID()),cog_id:H?.id||f,capability:ie.capability,description:ie.description,strategic_contribution:ie.description,linked_evidence:[]})),Z=Y.filter(ie=>ie.requirement&&ie.capability_id).map((ie,ke)=>({id:ie.id||(ke===0?E:crypto.randomUUID()),capability_id:ie.capability_id,requirement:ie.requirement,requirement_type:ie.type,description:ie.requirement,linked_evidence:[]})),ue=le.filter(ie=>ie.vulnerability&&ie.requirement_ids.length>0).flatMap(ie=>ie.requirement_ids.map(ke=>({id:crypto.randomUUID(),requirement_id:ke,vulnerability:ie.vulnerability,vulnerability_type:ie.type,description:ie.description,expected_effect:ie.expectedEffect,recommended_actions:ie.recommendedActions?ie.recommendedActions.split(",").map(Oe=>Oe.trim()):[],confidence:"medium",scoring:{impact_on_cog:3,attainability:3,follow_up_potential:3},composite_score:9,linked_evidence:[]}))),pe={title:g,description:k,operational_context:T,scoring_system:R,centers_of_gravity:H?[H]:[],critical_capabilities:ee,critical_requirements:Z,critical_vulnerabilities:ue};n(`${s}/create`,{state:{wizardData:pe}})}};return e.jsx(qt,{children:e.jsxs("div",{className:"container mx-auto py-8 px-4 max-w-5xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(te,{variant:"outline",onClick:()=>n(s),children:[e.jsx(Ir,{className:"h-4 w-4 mr-2"}),i("wizard.navigation.back")]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:i("wizard.title")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i("wizard.subtitle")})]})]}),e.jsxs(te,{variant:"outline",onClick:L,children:[e.jsx(fx,{className:"h-4 w-4 mr-2"}),i("wizard.buttons.advancedMode")]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:i("wizard.navigation.stepOf",{current:b,total:l.length,name:l[b-1].name})}),e.jsxs("div",{className:"text-sm text-gray-500",children:[Math.round(Q),"% ",i("wizard.progressComplete")]})]}),e.jsx(Fs,{value:Q,className:"h-2"}),e.jsx("div",{className:"flex justify-between mt-4",children:l.map(f=>e.jsxs("div",{className:`flex-1 text-center ${f.id===b?"text-blue-600 dark:text-blue-400":""} ${f.id<b?"text-green-600 dark:text-green-400":""} ${f.id>b?"text-gray-400":""}`,children:[e.jsx("div",{className:"flex items-center justify-center mb-1",children:f.id<b?e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center",children:e.jsx($t,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}):e.jsx("div",{className:`w-8 h-8 rounded-full ${f.id===b?"bg-blue-100 dark:bg-blue-900 border-2 border-blue-600":"bg-gray-100 dark:bg-gray-700"} flex items-center justify-center text-sm font-semibold`,children:f.id})}),e.jsx("div",{className:"text-xs hidden sm:block",children:f.name})]},f.id))})]}),e.jsxs(ge,{className:"mb-6",children:[e.jsxs(Ce,{children:[e.jsx(Ae,{children:l[b-1].name}),e.jsx(Le,{children:l[b-1].description})]}),e.jsxs(xe,{className:"space-y-6",children:[b===1&&e.jsxs(e.Fragment,{children:[e.jsxs(Dt,{children:[e.jsx(xs,{className:"h-4 w-4"}),e.jsx(Mt,{children:i("wizard.step1.alert")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step1.titleRequired")}),e.jsx(Ee,{value:g,onChange:f=>w(f.target.value),placeholder:i("wizard.step1.titlePlaceholder")})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step1.descriptionLabel")}),e.jsx($e,{value:k,onChange:f=>A(f.target.value),placeholder:i("wizard.step1.descriptionPlaceholder"),rows:2})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step1.objectiveRequired")}),e.jsx($e,{value:T.objective,onChange:f=>z({...T,objective:f.target.value}),placeholder:i("wizard.step1.objectivePlaceholder"),rows:3})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step1.impactRequired")}),e.jsx($e,{value:T.desired_impact,onChange:f=>z({...T,desired_impact:f.target.value}),placeholder:i("wizard.step1.impactPlaceholder"),rows:3})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step1.identityRequired")}),e.jsx(Ee,{value:T.our_identity,onChange:f=>z({...T,our_identity:f.target.value}),placeholder:i("wizard.step1.identityPlaceholder")})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step1.environmentLabel")}),e.jsx($e,{value:T.operating_environment,onChange:f=>z({...T,operating_environment:f.target.value}),placeholder:i("wizard.step1.environmentPlaceholder"),rows:2})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step1.timeframeLabel")}),e.jsx(Ee,{value:T.timeframe,onChange:f=>z({...T,timeframe:f.target.value}),placeholder:i("wizard.step1.timeframePlaceholder")})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step1.strategicLevelLabel")}),e.jsxs(ct,{value:T.strategic_level,onValueChange:f=>z({...T,strategic_level:f}),children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsxs(ht,{children:[e.jsx(Te,{value:"tactical",children:i("wizard.step1.strategicLevels.tactical")}),e.jsx(Te,{value:"operational",children:i("wizard.step1.strategicLevels.operational")}),e.jsx(Te,{value:"strategic",children:i("wizard.step1.strategicLevels.strategic")})]})]})]})]})]}),b===2&&e.jsxs(e.Fragment,{children:[e.jsxs(Dt,{children:[e.jsx(xs,{className:"h-4 w-4"}),e.jsx(Mt,{children:i("wizard.step2.alert")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step2.actorLabel")}),e.jsxs(ct,{value:S,onValueChange:f=>U(f),children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsx(ht,{children:h.map(f=>e.jsx(Te,{value:f.value,children:f.label},f.value))})]})]}),e.jsx(Fk,{value:G,onChange:F,label:"Link to Actor Entity (Optional)",placeholder:"Search for an actor in your database...",helperText:"Link this COG to a specific actor from your knowledge base to track credibility and enable cross-analysis pivoting."}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step2.domainLabel")}),e.jsxs(ct,{value:C,onValueChange:f=>j(f),children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsx(ht,{children:_.map(f=>e.jsx(Te,{value:f.value,children:f.label},f.value))})]})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step2.descriptionRequired")}),e.jsx($e,{value:D,onChange:f=>J(f.target.value),placeholder:i("wizard.step2.descriptionPlaceholder"),rows:3})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step2.rationaleRequired")}),e.jsx($e,{value:q,onChange:f=>W(f.target.value),placeholder:i("wizard.step2.rationalePlaceholder"),rows:4})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(rs,{mode:"suggest-cog",context:{objective:T.objective,impactGoal:T.desired_impact,friendlyForces:T.our_identity,operatingEnvironment:T.operating_environment,constraints:T.constraints?.join(", "),timeframe:T.timeframe,strategicLevel:T.strategic_level},onAccept:f=>{J(f.description),U(f.actor),j(f.domain),W(f.rationale)},buttonText:i("wizard.step2.suggestCOG")}),D&&e.jsx(rs,{mode:"validate-cog",context:{objective:T.objective,impactGoal:T.desired_impact,friendlyForces:T.our_identity,operatingEnvironment:T.operating_environment},cog:{description:D,actor:S,domain:C,rationale:q},onAccept:f=>{ne({criticallyDegrades:f.criteria.criticalDegradation.passes,sourceOfPower:f.criteria.sourceOfPower.passes,rightLevel:f.criteria.appropriateLevel.passes,canBeExploited:f.criteria.exploitable.passes})},buttonText:i("wizard.step2.validateCOG")})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950 p-4 rounded-lg",children:[e.jsx(fe,{className:"text-sm font-semibold mb-3 block",children:i("wizard.step2.validationTitle")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ts,{checked:$.criticallyDegrades,onCheckedChange:f=>ne({...$,criticallyDegrades:!!f})}),e.jsx("label",{className:"text-sm",children:i("wizard.step2.validationChecks.criticallyDegrades")})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ts,{checked:$.sourceOfPower,onCheckedChange:f=>ne({...$,sourceOfPower:!!f})}),e.jsx("label",{className:"text-sm",children:i("wizard.step2.validationChecks.sourceOfPower")})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ts,{checked:$.rightLevel,onCheckedChange:f=>ne({...$,rightLevel:!!f})}),e.jsx("label",{className:"text-sm",children:i("wizard.step2.validationChecks.rightLevel")})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ts,{checked:$.canBeExploited,onCheckedChange:f=>ne({...$,canBeExploited:!!f})}),e.jsx("label",{className:"text-sm",children:i("wizard.step2.validationChecks.canBeExploited")})]})]})]}),!Object.values($).every(f=>f)&&e.jsxs(Dt,{variant:"destructive",children:[e.jsx(wr,{className:"h-4 w-4"}),e.jsx(Mt,{children:i("wizard.step2.validationWarning")})]})]})]}),b===3&&e.jsxs(e.Fragment,{children:[e.jsxs(Dt,{children:[e.jsx(xs,{className:"h-4 w-4"}),e.jsx(Mt,{children:i("wizard.step3.alert")})]}),e.jsxs("div",{className:"space-y-4",children:[K.map((f,x)=>e.jsx(ge,{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs(xe,{className:"pt-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step3.capabilityLabel",{number:x+1})}),e.jsx(Ee,{value:f.capability,onChange:E=>{const H=[...K];H[x].capability=E.target.value,P(H)},placeholder:i("wizard.step3.capabilityPlaceholder")})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step3.descriptionLabel")}),e.jsx($e,{value:f.description,onChange:E=>{const H=[...K];H[x].description=E.target.value,P(H)},placeholder:i("wizard.step3.descriptionPlaceholder"),rows:2})]}),x>0&&e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>P(K.filter((E,H)=>H!==x)),children:i("wizard.step3.removeButton")})]})},x)),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(te,{variant:"outline",onClick:()=>P([...K,{id:crypto.randomUUID(),capability:"",description:""}]),children:i("wizard.step3.addButton")}),D&&e.jsx(rs,{mode:"generate-capabilities",context:{objective:T.objective,impactGoal:T.desired_impact,friendlyForces:T.our_identity,operatingEnvironment:T.operating_environment},cog:{description:D,actor:S,domain:C,rationale:q},onAccept:f=>{const x=f.map(E=>({id:crypto.randomUUID(),capability:E.capability,description:E.description}));P([...K.filter(E=>E.capability),...x])},buttonText:i("wizard.step3.generateButton")})]}),!X()&&e.jsxs(Dt,{variant:"destructive",children:[e.jsx(wr,{className:"h-4 w-4"}),e.jsx(Mt,{children:i("wizard.step3.validationError")})]})]})]}),b===4&&e.jsxs(e.Fragment,{children:[e.jsxs(Dt,{children:[e.jsx(xs,{className:"h-4 w-4"}),e.jsx(Mt,{children:i("wizard.step4.alert")})]}),e.jsxs("div",{className:"space-y-4",children:[Y.map((f,x)=>e.jsx(ge,{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs(xe,{className:"pt-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step4.requirementLabel",{number:x+1})}),e.jsx(Ee,{value:f.requirement,onChange:E=>{const H=[...Y];H[x].requirement=E.target.value,re(H)},placeholder:i("wizard.step4.requirementPlaceholder")})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step4.typeLabel")}),e.jsxs(ct,{value:f.type,onValueChange:E=>{const H=[...Y];H[x].type=E,re(H)},children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsxs(ht,{children:[e.jsx(Te,{value:"personnel",children:i("wizard.step4.types.personnel")}),e.jsx(Te,{value:"equipment",children:i("wizard.step4.types.equipment")}),e.jsx(Te,{value:"logistics",children:i("wizard.step4.types.logistics")}),e.jsx(Te,{value:"information",children:i("wizard.step4.types.information")}),e.jsx(Te,{value:"infrastructure",children:i("wizard.step4.types.infrastructure")}),e.jsx(Te,{value:"other",children:i("wizard.step4.types.other")})]})]})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step4.capabilityLinkRequired")}),e.jsxs(ct,{value:f.capability_id,onValueChange:E=>{const H=[...Y];H[x].capability_id=E,re(H)},children:[e.jsx(dt,{children:e.jsx(ut,{placeholder:i("wizard.step4.capabilityLinkPlaceholder")})}),e.jsx(ht,{children:K.filter(E=>E.capability).map(E=>e.jsx(Te,{value:E.id,children:E.capability||i("wizard.step4.capabilityItem",{number:K.indexOf(E)+1})},E.id))})]}),!f.capability_id&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:i("wizard.step4.capabilityLinkWarning")})]}),x>0&&e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>re(Y.filter((E,H)=>H!==x)),children:i("wizard.step4.removeButton")})]})},x)),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(te,{variant:"outline",onClick:()=>re([...Y,{id:crypto.randomUUID(),requirement:"",type:"other",capability_id:""}]),children:i("wizard.step4.addButton")}),K.filter(f=>f.capability).length>0&&e.jsx(rs,{mode:"generate-requirements",context:{objective:T.objective,impactGoal:T.desired_impact},cog:{description:D,actor:S,domain:C},capability:{capability:K.filter(f=>f.capability)[0].capability,description:K.filter(f=>f.capability)[0].description},onAccept:f=>{const x=K.filter(H=>H.capability)[0].id,E=f.map(H=>({id:crypto.randomUUID(),requirement:H.requirement,type:H.type||"other",capability_id:x}));re([...Y.filter(H=>H.requirement),...E])},buttonText:i("wizard.step4.generateButton")})]})]})]}),b===5&&e.jsxs(e.Fragment,{children:[e.jsxs(Dt,{children:[e.jsx(xs,{className:"h-4 w-4"}),e.jsx(Mt,{children:i("wizard.step5.alert")})]}),e.jsxs("div",{className:"space-y-4",children:[le.map((f,x)=>e.jsx(ge,{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs(xe,{className:"pt-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step5.vulnerabilityLabel",{number:x+1})}),e.jsx(Ee,{value:f.vulnerability,onChange:E=>{const H=[...le];H[x].vulnerability=E.target.value,se(H)},placeholder:i("wizard.step5.vulnerabilityPlaceholder")})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step5.descriptionLabel")}),e.jsx($e,{value:f.description,onChange:E=>{const H=[...le];H[x].description=E.target.value,se(H)},placeholder:i("wizard.step5.descriptionPlaceholder"),rows:2})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step5.typeLabel")}),e.jsxs(ct,{value:f.type,onValueChange:E=>{const H=[...le];H[x].type=E,se(H)},children:[e.jsx(dt,{children:e.jsx(ut,{})}),e.jsxs(ht,{children:[e.jsx(Te,{value:"physical",children:i("wizard.step5.types.physical")}),e.jsx(Te,{value:"cyber",children:i("wizard.step5.types.cyber")}),e.jsx(Te,{value:"human",children:i("wizard.step5.types.human")}),e.jsx(Te,{value:"logistical",children:i("wizard.step5.types.logistical")}),e.jsx(Te,{value:"informational",children:i("wizard.step5.types.informational")}),e.jsx(Te,{value:"other",children:i("wizard.step5.types.other")})]})]})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step5.expectedEffectRequired")}),e.jsx($e,{value:f.expectedEffect,onChange:E=>{const H=[...le];H[x].expectedEffect=E.target.value,se(H)},placeholder:i("wizard.step5.expectedEffectPlaceholder"),rows:2})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step5.recommendedActionsLabel")}),e.jsx(Ee,{value:f.recommendedActions,onChange:E=>{const H=[...le];H[x].recommendedActions=E.target.value,se(H)},placeholder:i("wizard.step5.recommendedActionsPlaceholder")})]}),e.jsxs("div",{children:[e.jsx(fe,{children:i("wizard.step5.requirementLinkRequired")}),e.jsxs("div",{className:"space-y-2 p-3 border rounded-lg bg-white dark:bg-gray-950 max-h-48 overflow-y-auto",children:[Y.filter(E=>E.requirement).map(E=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ts,{checked:f.requirement_ids.includes(E.id),onCheckedChange:H=>{const ee=[...le];H?ee[x].requirement_ids.push(E.id):ee[x].requirement_ids=ee[x].requirement_ids.filter(Z=>Z!==E.id),se(ee)}}),e.jsxs("label",{className:"text-sm flex-1 cursor-pointer",children:[E.requirement,e.jsx(he,{variant:"outline",className:"ml-2 text-xs",children:K.find(H=>H.id===E.capability_id)?.capability||i("wizard.step5.unknownCapability")})]})]},E.id)),Y.filter(E=>E.requirement).length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:i("wizard.step5.noRequirementsWarning")})]}),f.requirement_ids.length===0&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:i("wizard.step5.requirementLinkWarning")})]}),x>0&&e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>se(le.filter((E,H)=>H!==x)),children:i("wizard.step5.removeButton")})]})},x)),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(te,{variant:"outline",onClick:()=>se([...le,{id:crypto.randomUUID(),vulnerability:"",description:"",type:"other",expectedEffect:"",recommendedActions:"",requirement_ids:[]}]),children:i("wizard.step5.addButton")}),Y.filter(f=>f.requirement).length>0&&K.filter(f=>f.capability).length>0&&e.jsx(rs,{mode:"generate-vulnerabilities",context:{objective:T.objective,impactGoal:T.desired_impact},cog:{description:D,actor:S,domain:C},capability:{capability:K.filter(f=>f.capability)[0].capability,description:K.filter(f=>f.capability)[0].description},requirement:{requirement:Y.filter(f=>f.requirement)[0].requirement,type:Y.filter(f=>f.requirement)[0].type},onAccept:f=>{const x=Y.filter(H=>H.requirement)[0].id,E=f.map(H=>({id:crypto.randomUUID(),vulnerability:H.vulnerability,description:H.description,type:H.type||"other",expectedEffect:H.expectedEffect||"",recommendedActions:H.recommendedActions?.join(", ")||"",requirement_ids:[x]}));se([...le.filter(H=>H.vulnerability),...E])},buttonText:i("wizard.step5.generateButton")})]})]})]}),b===6&&e.jsxs(e.Fragment,{children:[e.jsxs(Dt,{className:"bg-green-50 dark:bg-green-950 border-green-200",children:[e.jsx($t,{className:"h-4 w-4 text-green-600"}),e.jsx(Mt,{className:"text-green-900 dark:text-green-100",children:i("wizard.step6.alert")})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:i("wizard.step6.summaryTitle")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:i("wizard.step6.titleLabel")}),e.jsx("p",{className:"font-medium",children:g})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:i("wizard.step6.strategicLevelLabel")}),e.jsx("p",{className:"font-medium capitalize",children:T.strategic_level})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:i("wizard.step6.cogLabel")}),e.jsx("p",{className:"font-medium",children:D||i("wizard.step6.notSpecified")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:i("wizard.step6.domainLabel")}),e.jsx(he,{variant:"outline",className:"capitalize",children:C})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:K.filter(f=>f.capability).length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:i("wizard.step6.capabilitiesCount")})]}),e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:Y.filter(f=>f.requirement).length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:i("wizard.step6.requirementsCount")})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:le.filter(f=>f.vulnerability).length}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:i("wizard.step6.vulnerabilitiesCount")})]})]}),e.jsxs(Dt,{children:[e.jsx(wr,{className:"h-4 w-4"}),e.jsx(Mt,{children:i("wizard.step6.advancedModeNote")})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(te,{variant:"outline",onClick:M,disabled:b===1,children:[e.jsx(Ir,{className:"h-4 w-4 mr-2"}),i("wizard.buttons.previous")]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{variant:"outline",onClick:O,disabled:u||!g,title:"Save your progress and continue later",children:u?i("wizard.buttons.saving"):"Save Draft"}),b===l.length&&m&&e.jsxs(te,{variant:"outline",onClick:oe,disabled:a||u,title:"Automatically generate actors and behaviors from this COG analysis",children:[e.jsx(ma,{className:"h-4 w-4 mr-2"}),a?"Generating...":p?"Regenerate Entities":"Generate Entities"]}),b<l.length?e.jsxs(te,{onClick:V,disabled:!X(),children:[i("wizard.buttons.next"),e.jsx(Kl,{className:"h-4 w-4 ml-2"})]}):e.jsx(te,{onClick:ce,disabled:!X()||u,children:i(u?"wizard.buttons.saving":"wizard.buttons.save")})]})]})]})})}const Dk={id:"template-adversary-c2",name:"Adversary Command & Control",description:"Template for analyzing adversary command and control structures and identifying vulnerabilities in military decision-making processes",i18nKey:"adversaryC2",category:"adversary",icon:"ðŸŽ–ï¸",template_data:{title:"Adversary Command & Control Analysis",description:"Analysis of adversary command and control structure to identify critical vulnerabilities for targeting",operational_context:{objective:"Identify and prioritize adversary command and control vulnerabilities to degrade their decision-making capability",desired_impact:"Disrupt adversary ability to coordinate forces and execute operational plans, forcing reactive posture",our_identity:"Joint Task Force with multi-domain capabilities including cyber, EW, and kinetic strike",operating_environment:"Theater-level operations against peer adversary with integrated air defense and sophisticated C2 architecture (PMESII-PT: contested electromagnetic spectrum, urban population centers, complex terrain)",constraints:["Must minimize civilian casualties","Limited precision strike munitions","Restricted cyber authorities requiring approval"],restraints:["Cannot target civilian infrastructure","Rules of engagement prohibit strikes on certain facilities","No cross-border operations without authorization"],timeframe:"30-45 days from current assessment to decision point",strategic_level:"operational"},scoring_system:"linear",centers_of_gravity:[{id:"cog-1",actor_category:"adversary",actor_name:"Adversary Forces",domain:"military",description:"Integrated Command and Control System enabling synchronized multi-domain operations",rationale:"Without this C2 system, adversary cannot coordinate air, ground, and naval forces effectively. Loss of this capability would force decentralized operations and significantly degrade combat power.",confidence:"high",priority:1,validated:!0,linked_evidence:[]}],critical_capabilities:[{id:"cap-1",cog_id:"cog-1",capability:"Coordinate multi-domain strike operations across theater",description:"Ability to synchronize air, naval, ground, and cyber operations in real-time against multiple targets",strategic_contribution:"Enables adversary to achieve decision superiority and mass effects at critical points",linked_evidence:[]},{id:"cap-2",cog_id:"cog-1",capability:"Maintain situational awareness of friendly forces disposition",description:"Real-time intelligence picture of friendly forces locations, capabilities, and intentions",strategic_contribution:"Allows adversary to exploit gaps, avoid strengths, and time operations for maximum effect",linked_evidence:[]}],critical_requirements:[{id:"req-1",capability_id:"cap-1",requirement:"Redundant communication network (fiber, satellite, radio)",requirement_type:"infrastructure",description:"Multiple communication pathways ensuring C2 connectivity even under attack",linked_evidence:[]},{id:"req-2",capability_id:"cap-1",requirement:"Centralized operations center with decision-making authority",requirement_type:"infrastructure",description:"Physical location where senior leaders make time-sensitive operational decisions",linked_evidence:[]},{id:"req-3",capability_id:"cap-2",requirement:"ISR platform network (satellites, UAVs, SIGINT)",requirement_type:"equipment",description:"Collection assets providing continuous coverage of friendly force movements",linked_evidence:[]}],critical_vulnerabilities:[{id:"vuln-1",requirement_id:"req-1",vulnerability:"Fiber optic cable hub located at known chokepoint",vulnerability_type:"physical",description:"Critical fiber junction serving three command nodes concentrated in small geographic area, single point of failure",exploitation_method:"Precision strike or cyber attack on fiber junction to sever communications between forward units and strategic command",expected_effect:"Adversary loses primary C2 link to forward forces within 2-4 hours. Command authority devolves to lower echelons, degrading coordination by 60-70%. Recovery time: 48-72 hours.",recommended_actions:["Conduct detailed target analysis of fiber hub","Develop kinetic and non-kinetic strike options","Coordinate with cyber command for dual-pronged approach","Plan follow-on strikes to prevent rapid repair"],confidence:"high",scoring:{impact_on_cog:5,attainability:4,follow_up_potential:5},composite_score:14,linked_evidence:[]},{id:"vuln-2",requirement_id:"req-2",vulnerability:"Operations center lacks hardening against cyber attack",vulnerability_type:"cyber",description:"Command center network vulnerable to intrusion due to legacy systems and insufficient segmentation",exploitation_method:"Cyber operations to disrupt or degrade C2 systems, potentially insert false information",expected_effect:"Temporary loss of C2 situational awareness (12-24 hours). Potential for decision-making based on corrupted data. Forces confusion and delays in adversary response.",recommended_actions:["Develop cyber operation plan targeting C2 network","Coordinate with national-level cyber authorities","Prepare information operations to exploit confusion","Plan complementary kinetic strikes during degraded C2 window"],confidence:"medium",scoring:{impact_on_cog:4,attainability:3,follow_up_potential:4},composite_score:11,linked_evidence:[]},{id:"vuln-3",requirement_id:"req-3",vulnerability:"Limited number of over-the-horizon relay satellites",vulnerability_type:"physical",description:"Only 3 satellites provide relay capability for theater ISR assets, creating temporal coverage gaps",exploitation_method:"Anti-satellite weapons or electronic warfare to deny adversary ISR during critical operations",expected_effect:"Adversary loses 40-50% ISR coverage during satellite denial window (6-8 hour gaps). Creates opportunity for friendly maneuver without detection.",recommended_actions:["Coordinate ASAT employment with national command authority","Time friendly operations to coincide with ISR gaps","Develop EW plan for satellite jamming as alternative","Exploit gaps for force repositioning"],confidence:"medium",scoring:{impact_on_cog:4,attainability:2,follow_up_potential:5},composite_score:11,linked_evidence:[]}]}},Mk={id:"template-adversary-info-ops",name:"Adversary Information Operations",description:"Template for analyzing adversary information warfare capabilities and identifying weaknesses in propaganda and influence networks",i18nKey:"adversaryInfoOps",category:"information",icon:"ðŸ“¡",template_data:{title:"Adversary Information Operations Analysis",description:"Analysis of adversary information warfare ecosystem to identify vulnerabilities for counter-IO operations",operational_context:{objective:"Identify critical vulnerabilities in adversary information operations to degrade their ability to influence target populations",desired_impact:"Reduce adversary information influence by 50-60%, expose disinformation campaigns, and restore confidence in legitimate information sources",our_identity:"Joint Information Operations Task Force with cyber, PSYOP, and strategic communications capabilities",operating_environment:"Global information environment with focus on contested regions (PMESII-PT: high social media penetration, low media literacy, existing distrust of institutions)",constraints:["Must avoid censorship appearance","Limited platform cooperation","Cannot violate free speech norms","Budget constraints on counter-messaging"],restraints:["No offensive cyber operations against civilian platforms","Cannot directly attribute without evidence","Avoid escalation to kinetic domain"],timeframe:"60-90 days for measurable effect on information environment",strategic_level:"strategic"},scoring_system:"linear",centers_of_gravity:[{id:"cog-1",actor_category:"adversary",actor_name:"State Information Apparatus",domain:"information",description:"Coordinated network of state media, troll farms, and proxy accounts enabling large-scale influence operations",rationale:"This apparatus is the primary mechanism for adversary strategic messaging and disinformation. Without it, adversary loses ability to shape narrative and influence foreign populations at scale.",confidence:"high",priority:1,validated:!0,linked_evidence:[]}],critical_capabilities:[{id:"cap-1",cog_id:"cog-1",capability:"Amplify narratives across multiple platforms simultaneously",description:"Ability to coordinate messaging across state media, social media, and proxy sites to flood information space",strategic_contribution:"Creates perception of grassroots support and drowns out counter-narratives",linked_evidence:[]},{id:"cap-2",cog_id:"cog-1",capability:"Evade platform detection and content moderation",description:"Sophisticated techniques to avoid automated and human detection of coordinated inauthentic behavior",strategic_contribution:"Ensures persistent presence on platforms even during enforcement actions",linked_evidence:[]}],critical_requirements:[{id:"req-1",capability_id:"cap-1",requirement:"Network of coordinated social media accounts (estimated 10,000+ accounts)",requirement_type:"infrastructure",description:"Large-scale network of accounts operated by troll farms to amplify and distribute content",linked_evidence:[]},{id:"req-2",capability_id:"cap-2",requirement:"Platform policy compliance and technical evasion tactics",requirement_type:"information",description:"Understanding of platform algorithms and moderation to avoid detection while maximizing reach",linked_evidence:[]}],critical_vulnerabilities:[{id:"vuln-1",requirement_id:"req-1",vulnerability:"Centralized account management infrastructure",vulnerability_type:"cyber",description:"Account credentials and automation scripts managed through limited number of servers, creating single point of failure",exploitation_method:"Coordinate with platforms to identify and remove coordinated accounts in synchronized takedown",expected_effect:"Adversary loses 60-70% of amplification network within 48 hours. IO effectiveness drops significantly, requiring 2-3 months to rebuild network. Follow-on degradation as users lose trust in remaining accounts.",recommended_actions:["Compile account network mapping data","Brief platforms on coordinated behavior patterns","Coordinate multi-platform takedown timing","Prepare messaging to highlight takedown success","Monitor for reconstitution attempts"],confidence:"high",scoring:{impact_on_cog:5,attainability:4,follow_up_potential:5},composite_score:14,linked_evidence:[]},{id:"vuln-2",requirement_id:"req-2",vulnerability:"Dependence on specific platform features and algorithms",vulnerability_type:"informational",description:"IO campaigns optimized for current platform recommendation algorithms; vulnerable to algorithm changes",exploitation_method:"Work with platforms to adjust algorithms to de-prioritize coordinated inauthentic behavior",expected_effect:"Reach and engagement metrics drop 40-50% as content stops appearing in recommendations. Adversary forced to adapt tactics, creating temporary disruption window.",recommended_actions:["Engage platform trust & safety teams","Provide technical indicators of coordinated behavior","Advocate for algorithm adjustments","Monitor effectiveness of changes"],confidence:"medium",scoring:{impact_on_cog:4,attainability:3,follow_up_potential:3},composite_score:10,linked_evidence:[]}]}},$k={id:"template-friendly-logistics",name:"Friendly Logistics COG",description:"Template for analyzing friendly forces logistics to identify and protect critical vulnerabilities in supply chains",i18nKey:"friendlyLogistics",category:"friendly",icon:"ðŸšš",template_data:{title:"Friendly Logistics COG Protection Analysis",description:"Self-assessment of friendly logistics vulnerabilities to prioritize protection measures",operational_context:{objective:"Identify critical vulnerabilities in friendly logistics system to prioritize force protection and redundancy measures",desired_impact:"Ensure uninterrupted logistics support to deployed forces despite adversary targeting",our_identity:"Deployed Joint Task Force operating 800km from strategic support base",operating_environment:"Extended logistics lines through contested territory with adversary long-range fires and cyber threats (PMESII-PT: limited host nation support, degraded infrastructure, austere forward operating bases)",constraints:["Limited airlift capacity","Restricted ground convoy routes","Budget limits on redundancy","Cannot rely on local sourcing"],restraints:["Force protection requirements limit convoy speed","Environmental regulations restrict fuel storage","Cannot militarize civilian infrastructure without host nation approval"],timeframe:"Immediate assessment for next 90 days of operations",strategic_level:"operational"},scoring_system:"linear",centers_of_gravity:[{id:"cog-1",actor_category:"friendly",actor_name:"Joint Task Force",domain:"military",description:"Logistics supply chain enabling sustained forward operations",rationale:"Without continuous logistics, forward forces cannot sustain operations beyond 7-10 days. This supply chain is essential to mission accomplishment.",confidence:"confirmed",priority:1,validated:!0,linked_evidence:[]}],critical_capabilities:[{id:"cap-1",cog_id:"cog-1",capability:"Deliver fuel, ammunition, and supplies to forward operating bases",description:"Ability to transport critical supplies from rear logistics hub to forward units within operational timeline",strategic_contribution:"Enables sustained combat operations and freedom of maneuver",linked_evidence:[]}],critical_requirements:[{id:"req-1",capability_id:"cap-1",requirement:"Ground convoy routes and forward logistics nodes",requirement_type:"infrastructure",description:"Primary supply route (MSR) and forward staging areas for redistribution",linked_evidence:[]},{id:"req-2",capability_id:"cap-1",requirement:"Logistics tracking and coordination systems",requirement_type:"information",description:"Movement tracking and inventory management systems to coordinate supply delivery",linked_evidence:[]}],critical_vulnerabilities:[{id:"vuln-1",requirement_id:"req-1",vulnerability:"Single bridge chokepoint on primary supply route",vulnerability_type:"physical",description:"MSR crosses river at single bridge; no alternate route within 200km. Bridge vulnerable to adversary strike or sabotage",exploitation_method:"Adversary could destroy bridge with precision strike, severing primary logistics line",expected_effect:"If bridge destroyed, forward forces limited to 7-10 days supply before significant degradation. Airlift insufficient to sustain operations. Mission failure risk: HIGH.",recommended_actions:["Establish alternate supply route (even if longer)","Pre-position 30-day supply forward","Install bridge protection systems (air defense, counter-UAS)","Develop expedient bridging plan with engineer assets","Coordinate host nation for route redundancy"],confidence:"confirmed",scoring:{impact_on_cog:5,attainability:4,follow_up_potential:2},composite_score:11,linked_evidence:[]},{id:"vuln-2",requirement_id:"req-2",vulnerability:"Logistics systems vulnerable to cyber attack",vulnerability_type:"cyber",description:"Movement tracking systems accessible via network; insufficient cyber hardening and backup procedures",exploitation_method:"Adversary cyber operations could corrupt data or deny access to tracking systems",expected_effect:"Loss of visibility on supply status and locations. Manual tracking reduces efficiency by 50%, increases delivery times, and creates potential for shortages. Recovery time: 48-72 hours.",recommended_actions:["Implement network segmentation for logistics systems","Develop manual backup procedures and train personnel","Conduct cyber resilience exercise","Establish alternate communications for convoy coordination"],confidence:"high",scoring:{impact_on_cog:4,attainability:3,follow_up_potential:3},composite_score:10,linked_evidence:[]}]}},Bk={id:"template-cyber-domain",name:"Cyber Domain COG",description:"Template for analyzing adversary cyber capabilities and critical infrastructure dependencies",i18nKey:"cyberDomain",category:"cyber",icon:"ðŸ’»",template_data:{title:"Adversary Cyber Operations COG Analysis",description:"Analysis of adversary cyber warfare capabilities to identify vulnerabilities for defensive and offensive cyber operations",operational_context:{objective:"Identify vulnerabilities in adversary cyber operations infrastructure to enable defensive measures and potential offensive operations",desired_impact:"Degrade adversary cyber attack capabilities while protecting friendly critical infrastructure",our_identity:"Cyber Command element supporting Joint Task Force operations",operating_environment:"Global cyberspace with focus on critical infrastructure protection (PMESII-PT: high internet connectivity, legacy OT systems, limited cyber workforce)",constraints:["Legal authorities for offensive cyber operations","Risk of collateral damage to civilian infrastructure","Limited cyber operations capacity"],restraints:["Cannot conduct operations without proper authorization","Must avoid escalation","Cannot target civilian-only infrastructure"],timeframe:"30-60 days for initial effects",strategic_level:"strategic"},scoring_system:"linear",centers_of_gravity:[{id:"cog-1",actor_category:"adversary",actor_name:"State Cyber Forces",domain:"cyber",description:"Adversary cyber operations infrastructure enabling attacks on critical infrastructure",rationale:"This infrastructure is the foundation of adversary cyber power projection. Without it, adversary cannot conduct large-scale cyber operations against strategic targets.",confidence:"high",priority:1,validated:!0,linked_evidence:[]}],critical_capabilities:[{id:"cap-1",cog_id:"cog-1",capability:"Launch coordinated cyber attacks against critical infrastructure",description:"Ability to compromise and disrupt power grids, communications, financial systems simultaneously",strategic_contribution:"Enables strategic coercion and degradation of adversary warfighting capability without kinetic strikes",linked_evidence:[]}],critical_requirements:[{id:"req-1",capability_id:"cap-1",requirement:"Command and control infrastructure for cyber operations",requirement_type:"infrastructure",description:"Servers, networks, and personnel coordinating cyber attack campaigns",linked_evidence:[]},{id:"req-2",capability_id:"cap-1",requirement:"Zero-day exploits and access to target networks",requirement_type:"information",description:"Pre-positioned access and sophisticated exploits for critical infrastructure systems",linked_evidence:[]}],critical_vulnerabilities:[{id:"vuln-1",requirement_id:"req-1",vulnerability:"Known IP ranges for cyber operations infrastructure",vulnerability_type:"cyber",description:"Cyber attack infrastructure operates from identifiable network ranges, enabling targeting",exploitation_method:"Offensive cyber operations to disrupt C2 infrastructure or defensive measures to block communications",expected_effect:"Disrupts adversary ability to coordinate cyber operations for 24-48 hours. Creates window for defensive hardening and forces adversary to re-establish C2 through alternate channels.",recommended_actions:["Develop offensive cyber operation plan targeting C2 infrastructure","Coordinate with ISPs for traffic blocking","Prepare defensive measures to exploit disruption window","Monitor for infrastructure reconstitution"],confidence:"high",scoring:{impact_on_cog:4,attainability:4,follow_up_potential:4},composite_score:12,linked_evidence:[]},{id:"vuln-2",requirement_id:"req-2",vulnerability:"Dependence on specific exploit types and vectors",vulnerability_type:"cyber",description:"Adversary cyber operations rely heavily on known exploit classes (e.g., phishing, supply chain)",exploitation_method:"Accelerate patching and implement compensating controls for targeted vulnerabilities",expected_effect:"Reduces adversary attack surface by 40-60%. Forces shift to less reliable attack vectors, decreasing success rate and increasing cost of operations.",recommended_actions:["Conduct vulnerability assessment of critical systems","Accelerate patch deployment for targeted vulnerabilities","Implement network segmentation","Enhance email security and user training","Monitor for adversary adaptation"],confidence:"high",scoring:{impact_on_cog:3,attainability:5,follow_up_potential:3},composite_score:11,linked_evidence:[]}]}},zk={id:"template-host-nation-infrastructure",name:"Host Nation Critical Infrastructure",description:"Template for analyzing host nation critical infrastructure to identify protection priorities during operations",i18nKey:"hostNationInfrastructure",category:"host_nation",icon:"ðŸ­",template_data:{title:"Host Nation Critical Infrastructure Protection Analysis",description:"Assessment of host nation critical infrastructure vulnerabilities to prioritize protection during operations",operational_context:{objective:"Identify critical vulnerabilities in host nation infrastructure that adversary will likely target, prioritize protection measures",desired_impact:"Prevent adversary from achieving strategic effects through infrastructure attacks, maintain host nation support for operations",our_identity:"Joint Task Force supporting host nation defense",operating_environment:"Host nation with aging infrastructure and limited protection capabilities (PMESII-PT: high infrastructure interdependence, limited maintenance budgets, growing population straining capacity)",constraints:["Host nation sovereignty limits our authorities","Limited resources for infrastructure protection","Cannot interfere with civilian operations"],restraints:["Must coordinate all actions with host nation government","Cannot unilaterally deploy protection systems","Limited to advisory and assistance role in some areas"],timeframe:"Immediate assessment for next 180 days",strategic_level:"strategic"},scoring_system:"linear",centers_of_gravity:[{id:"cog-1",actor_category:"host_nation",actor_name:"Host Nation Government",domain:"economic",description:"Electrical power grid supporting critical government functions, economy, and population centers",rationale:"Power grid failure would cripple government operations, collapse economy, and turn population against coalition forces. This infrastructure is essential to mission success and host nation stability.",confidence:"confirmed",priority:1,validated:!0,linked_evidence:[]}],critical_capabilities:[{id:"cap-1",cog_id:"cog-1",capability:"Provide reliable electrical power to capital region and industrial centers",description:"Ability to generate and distribute electricity to support government, economy, and 5 million residents",strategic_contribution:"Enables continued governance, economic activity, and popular support for host nation government",linked_evidence:[]}],critical_requirements:[{id:"req-1",capability_id:"cap-1",requirement:"Three primary power generation stations",requirement_type:"infrastructure",description:"Main power plants (2 natural gas, 1 hydroelectric) providing 80% of capital region electricity",linked_evidence:[]},{id:"req-2",capability_id:"cap-1",requirement:"SCADA systems controlling power distribution",requirement_type:"equipment",description:"Supervisory control and data acquisition systems managing grid operations",linked_evidence:[]}],critical_vulnerabilities:[{id:"vuln-1",requirement_id:"req-1",vulnerability:"Power stations lack air defense protection",vulnerability_type:"physical",description:"Generation facilities vulnerable to cruise missile, UAV, or SOF attack with no organic defenses",exploitation_method:"Adversary could conduct standoff strike against power stations with high probability of success",expected_effect:"Loss of 1-2 power stations would cause cascading grid failure affecting 4-5 million people. Restoration time: 2-4 weeks. Severe economic impact, humanitarian crisis, loss of host nation support for coalition operations. STRATEGIC FAILURE RISK.",recommended_actions:["Deploy air defense systems to protect power generation sites (PRIORITY 1)","Establish no-fly zones around critical infrastructure","Coordinate with host nation on expedient hardening","Develop contingency plans for distributed power generation","Pre-position generators for critical facilities","Prepare IO campaign to mitigate population impact"],confidence:"confirmed",scoring:{impact_on_cog:5,attainability:5,follow_up_potential:2},composite_score:12,linked_evidence:[]},{id:"vuln-2",requirement_id:"req-2",vulnerability:"SCADA systems accessible via internet with weak security",vulnerability_type:"cyber",description:"Legacy SCADA systems with default passwords, no network segmentation, remotely accessible for maintenance",exploitation_method:"Adversary cyber operations could compromise SCADA to cause grid instability or shutdown",expected_effect:"SCADA compromise could cause controlled shutdown (24-48 hour outage) or uncontrolled cascading failure (2-4 week outage). Significant economic and humanitarian impact. Host nation blame likely to fall on coalition forces.",recommended_actions:["Conduct immediate SCADA security assessment with host nation","Implement network segmentation and access controls (PRIORITY 1)","Deploy cyber monitoring and defense capabilities","Develop manual override procedures","Train host nation personnel on cyber resilience","Establish 24/7 monitoring"],confidence:"high",scoring:{impact_on_cog:5,attainability:4,follow_up_potential:3},composite_score:12,linked_evidence:[]}]}},Uk=[Dk,Mk,$k,Bk,zk],rn=Kn("Frameworks");function Tt(){const r={"Content-Type":"application/json"},t=localStorage.getItem("omnicore_token");if(t)return r.Authorization=`Bearer ${t}`,r;let s=localStorage.getItem("omnicore_user_hash");return s||(s=crypto.randomUUID().substring(0,16),localStorage.setItem("omnicore_user_hash",s),rn.info("Generated new guest user hash:",s)),r.Authorization=`Bearer ${s}`,r}const qk=()=>{const{t:r}=Bt(),{currentWorkspaceId:t}=Kr(),[s,n]=B.useState(""),[i,o]=B.useState([]),[l,a]=B.useState([]),[c,p]=B.useState(null),[d,m]=B.useState(!1),[y,h]=B.useState(!1),[_,b]=B.useState(null),[N,u]=B.useState(!1),v=xr(),{id:g}=da(),w=ua(),k=w.pathname.includes("/create"),A=w.pathname.includes("/edit"),T=g&&!A&&!k;B.useEffect(()=>{z()},[]),B.useEffect(()=>{g&&S(g)},[g]);const z=async()=>{try{const P=await fetch(`/api/frameworks?workspace_id=${t}`,{headers:Tt()});if(P.ok){const re=((await P.json()).frameworks||[]).filter(le=>le.framework_type==="swot");a(re)}else console.error("Failed to load analyses:",P.status,P.statusText)}catch(P){console.error("Failed to load analyses:",P)}},S=async P=>{m(!0);try{const Y=await fetch(`/api/frameworks?id=${P}&workspace_id=${t}`,{headers:Tt()});if(Y.ok){const re=await Y.json();if(re.data&&typeof re.data=="string")try{re.data=JSON.parse(re.data)}catch(le){console.error("Failed to parse framework data:",le)}p(re)}else console.error("Failed to load analysis:",Y.status,Y.statusText)}catch(Y){console.error("Failed to load analysis:",Y)}finally{m(!1)}},U=async P=>{const Y={framework_type:"swot",title:P.title,description:P.description,data:P,status:"active",is_public:!1,workspace_id:t};if(A&&g){const re=await fetch(`/api/frameworks?id=${g}&workspace_id=${t}`,{method:"PUT",headers:Tt(),body:JSON.stringify(Y)});if(!re.ok){const le=await re.json().catch(()=>({error:"Unknown error"}));throw new Error(le.error||le.message||"Failed to update")}}else{const re=await fetch(`/api/frameworks?workspace_id=${t}`,{method:"POST",headers:Tt(),body:JSON.stringify(Y)});if(!re.ok){const le=await re.json().catch(()=>({error:"Unknown error"}));throw console.error("API Error:",le),new Error(le.error||le.message||"Failed to create")}}},G=async P=>{const Y=P||g;if(Y&&confirm(r("frameworkPages.confirmDeleteAnalysis")))try{(await fetch(`/api/frameworks?id=${Y}&workspace_id=${t}`,{method:"DELETE",headers:Tt()})).ok&&(P?await z():v("/dashboard/analysis-frameworks/swot-dashboard"))}catch(re){console.error("Failed to delete:",re),alert("Failed to delete analysis")}},F=async P=>{await U(P),await z(),alert("Analyses merged successfully!")},C=async(P,Y)=>{await U(P),await z(),alert(`Extracted items with tags: ${Y.join(", ")}`)};if(k){let P={};if(w.state?.fromInvestigation){const{investigationData:Y}=w.state,{content:re}=Y||{},se=(re?.flatMap(R=>R.claims||[])||[]).filter(R=>(R.adjusted_risk_score??R.original_risk_score)>=60).slice(0,3);P={title:`${w.state.investigationTitle} - SWOT Analysis`,description:Y?.description||`Generated from investigation: ${w.state.investigationTitle}`,threats:se.map(R=>({id:crypto.randomUUID(),text:R.claim_text})),strengths:[],weaknesses:[],opportunities:[],source_investigation_id:w.state.investigationId}}return e.jsx(Id,{mode:"create",onSave:U,initialData:P})}if(A&&c){const P=typeof c.data=="object"?c.data:Wt(c.data,{});return e.jsx(Id,{mode:"edit",initialData:{...P,title:c.title,description:c.description},onSave:U})}if(T&&c){const P=typeof c.data=="object"?c.data:Wt(c.data,{});return e.jsx(u0,{data:{...P,id:c.id,title:c.title,description:c.description,created_at:c.created_at,updated_at:c.updated_at},onEdit:()=>v(`/dashboard/analysis-frameworks/swot-dashboard/${g}/edit`),onDelete:G})}if((A||T)&&d)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:r("frameworkPages.loading")})});const j=Array.from(new Set(l.flatMap(P=>(typeof P.data=="object"?P.data:Wt(P.data,{})).tags||[]))).sort();if(y&&_){const P=l.filter(Y=>((typeof Y.data=="object"?Y.data:Wt(Y.data,{})).tags||[]).includes(_)).map(Y=>({...typeof Y.data=="object"?Y.data:Wt(Y.data,{}),id:Y.id,title:Y.title,description:Y.description}));return e.jsx(h0,{analyses:P,comparisonTag:_,onClose:()=>{h(!1),b(null)}})}const D=l.filter(P=>{const Y=P.title.toLowerCase().includes(s.toLowerCase())||P.description&&P.description.toLowerCase().includes(s.toLowerCase());if(i.length>0){const le=(typeof P.data=="object"?P.data:Wt(P.data,{})).tags||[],se=i.every(R=>le.includes(R));return Y&&se}return Y}),J=P=>{switch(P){case"completed":return"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200";case"active":return"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200";case"draft":return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200";default:return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}},q="swot",W=r(`frameworkDescriptions.${q}.context`),$=r(`frameworkDescriptions.${q}.wikipediaUrl`,{defaultValue:null}),ne=r(`frameworkDescriptions.${q}.goodUseCases`,{returnObjects:!0}),K=r(`frameworkDescriptions.${q}.notIdealFor`,{returnObjects:!0});return e.jsxs("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"SWOT Analysis"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Strengths, Weaknesses, Opportunities, and Threats"})]}),e.jsxs("div",{className:"flex gap-2",children:[l.length>=2&&e.jsxs(te,{variant:"outline",onClick:()=>u(!0),children:[e.jsx(Gl,{className:"h-4 w-4 mr-2"}),"Merge/Split"]}),e.jsxs(te,{onClick:()=>{rn.debug("SWOT New Analysis button clicked, navigating to:","/dashboard/analysis-frameworks/swot-dashboard/create"),v("/dashboard/analysis-frameworks/swot-dashboard/create")},children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),r("frameworkPages.newAnalysis")]})]})]}),e.jsx(ge,{className:"mb-6 bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:e.jsx(xe,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:W}),$&&e.jsxs("a",{href:$,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-blue-600 dark:text-blue-400 hover:underline",children:[r("frameworkPages.learnMoreWikipedia"),e.jsx(ar,{className:"h-4 w-4"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-green-700 dark:text-green-400 mb-2 flex items-center gap-2",children:[e.jsx(jr,{className:"h-4 w-4"}),r("frameworkPages.goodUseCases")]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-700 dark:text-gray-300 space-y-1",children:ne.map((P,Y)=>e.jsx("li",{children:P},Y))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-red-700 dark:text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(pa,{className:"h-4 w-4"}),r("frameworkPages.notIdealFor")]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-700 dark:text-gray-300 space-y-1",children:K.map((P,Y)=>e.jsx("li",{children:P},Y))})]})]})]})})}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ir,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(Ee,{type:"text",placeholder:r("frameworkPages.searchAnalyses"),value:s,onChange:P=>n(P.target.value),className:"pl-10"})]}),j.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(Hi,{className:"h-4 w-4"}),e.jsx("span",{children:"Filter by tags:"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(P=>{const Y=i.includes(P),re=l.filter(se=>((typeof se.data=="object"?se.data:Wt(se.data,{})).tags||[]).includes(P)).length,le=re>=2;return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(he,{variant:Y?"default":"outline",className:`cursor-pointer transition-all hover:scale-105 ${Y?"bg-blue-600 text-white hover:bg-blue-700":"bg-white dark:bg-gray-800 hover:bg-blue-50 dark:hover:bg-blue-900/20"}`,onClick:()=>{o(Y?i.filter(se=>se!==P):[...i,P])},children:[e.jsx(Hi,{className:"h-3 w-3 mr-1"}),P,Y&&e.jsx(Ze,{className:"h-3 w-3 ml-1"})]}),le&&e.jsxs(te,{size:"sm",variant:"ghost",className:"h-6 px-2 text-xs",onClick:()=>{b(P),h(!0)},children:["Compare (",re,")"]})]},P)})}),i.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Filtering by ",i.length," tag",i.length>1?"s":""]}),e.jsx(te,{variant:"ghost",size:"sm",onClick:()=>o([]),className:"h-7 text-xs",children:"Clear all"})]})]})]}),e.jsx("div",{className:"grid gap-4",children:D.map(P=>{const Y=typeof P.data=="object"?P.data:Wt(P.data,{});return e.jsx(ge,{className:"hover:shadow-lg transition-shadow",children:e.jsx(xe,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-semibold hover:text-blue-600 transition-colors cursor-pointer",onClick:()=>v(`/dashboard/analysis-frameworks/swot-dashboard/${P.id}`),children:P.title}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${J(P.status)}`,children:P.status})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:P.description}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-2 bg-green-50 dark:bg-green-900/20 rounded",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Strengths"}),e.jsx("p",{className:"text-xl font-semibold text-green-600 dark:text-green-400",children:Y.strengths?.length||0})]}),e.jsxs("div",{className:"text-center p-2 bg-red-50 dark:bg-red-900/20 rounded",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Weaknesses"}),e.jsx("p",{className:"text-xl font-semibold text-red-600 dark:text-red-400",children:Y.weaknesses?.length||0})]}),e.jsxs("div",{className:"text-center p-2 bg-blue-50 dark:bg-blue-900/20 rounded",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Opportunities"}),e.jsx("p",{className:"text-xl font-semibold text-blue-600 dark:text-blue-400",children:Y.opportunities?.length||0})]}),e.jsxs("div",{className:"text-center p-2 bg-orange-50 dark:bg-orange-900/20 rounded",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Threats"}),e.jsx("p",{className:"text-xl font-semibold text-orange-600 dark:text-orange-400",children:Y.threats?.length||0})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-500",children:[r("frameworkPages.updated")," ",new Date(P.updated_at).toLocaleDateString()]})]}),e.jsxs(Ur,{children:[e.jsx(qr,{asChild:!0,children:e.jsx(te,{variant:"ghost",size:"icon",children:e.jsx(gn,{className:"h-4 w-4"})})}),e.jsxs(Wr,{align:"end",children:[e.jsx(rt,{onClick:()=>v(`/dashboard/analysis-frameworks/swot-dashboard/${P.id}`),children:r("frameworkPages.view")}),e.jsx(rt,{onClick:()=>v(`/dashboard/analysis-frameworks/swot-dashboard/${P.id}/edit`),children:r("buttons.edit")}),e.jsx(rt,{onClick:()=>v(`/dashboard/analysis-frameworks/swot-dashboard/${P.id}`),children:r("frameworkPages.export")}),e.jsx(rt,{className:"text-red-600",onClick:re=>{re.stopPropagation(),G(P.id.toString())},children:r("buttons.delete")})]})]})]})})},P.id)})}),D.length===0&&e.jsx(ge,{children:e.jsxs(xe,{className:"text-center py-12",children:[e.jsx(ga,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:r("frameworkPages.noAnalysesFound")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:s?r("frameworkPages.tryAdjustingSearch"):`${r("frameworkPages.getStartedFirst")} SWOT ${r("frameworkPages.analysis")}`}),!s&&e.jsxs(te,{onClick:()=>v("/dashboard/analysis-frameworks/swot-dashboard/create"),children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),r("frameworkPages.createAnalysis")]})]})}),e.jsx(m0,{open:N,onClose:()=>u(!1),analyses:l.map(P=>({...typeof P.data=="object"?P.data:Wt(P.data,{}),id:P.id,title:P.title,description:P.description})),onMerge:F,onExtract:C})]})},Or=({frameworkKey:r})=>{const{t}=Bt(),{currentWorkspaceId:s}=Kr(),n=cn[r],[i,o]=B.useState([]),[l,a]=B.useState(null),[c,p]=B.useState(!1),[d,m]=B.useState(""),y=xr(),{id:h}=da(),_=ua(),b=_.pathname.includes("/create"),N=_.pathname.includes("/edit"),u=h&&!N&&!b,v=`/dashboard/analysis-frameworks/${r}`;B.useEffect(()=>{g()},[]),B.useEffect(()=>{h&&w(h)},[h]);const g=async()=>{try{const C=await fetch(`/api/frameworks?workspace_id=${s}`,{headers:Tt()});if(C.ok){const D=((await C.json()).frameworks||[]).filter(J=>J.framework_type===r);o(D)}}catch(C){console.error("Failed to load analyses:",C)}},w=async C=>{p(!0);try{const j=await fetch(`/api/frameworks?id=${C}&workspace_id=${s}`,{headers:Tt()});if(j.ok){const D=await j.json();if(D.data&&typeof D.data=="string")try{D.data=JSON.parse(D.data)}catch(J){console.error("Failed to parse framework data:",J)}a(D)}}catch(j){console.error("Failed to load analysis:",j)}finally{p(!1)}},k=async C=>{const j={framework_type:r,title:C.title,description:C.description,data:C,status:"active",is_public:!1,workspace_id:s};if(N&&h){if(!(await fetch(`/api/frameworks?id=${h}&workspace_id=${s}`,{method:"PUT",headers:Tt(),body:JSON.stringify(j)})).ok)throw new Error("Failed to update")}else if(!(await fetch(`/api/frameworks?workspace_id=${s}`,{method:"POST",headers:Tt(),body:JSON.stringify(j)})).ok)throw new Error("Failed to create")},A=async C=>{const j=C||h;if(j&&confirm(t("frameworkPages.confirmDeleteAnalysis")))try{(await fetch(`/api/frameworks?id=${j}&workspace_id=${s}`,{method:"DELETE",headers:Tt()})).ok&&(C?await g():y(v))}catch(D){console.error("Failed to delete:",D),alert("Failed to delete analysis")}};if(b)return e.jsx(Ud,{mode:"create",sections:n.sections,frameworkType:n.type,frameworkTitle:n.title,onSave:k,backPath:v});if(N&&l){const C=typeof l.data=="object"?l.data:Wt(l.data,{});return e.jsx(Ud,{mode:"edit",sections:n.sections,frameworkType:n.type,frameworkTitle:n.title,initialData:{...C,title:l.title,description:l.description},onSave:k,backPath:v,frameworkId:l.id.toString()})}if(u&&l){const C=typeof l.data=="object"?l.data:Wt(l.data,{});return e.jsx(H0,{data:{...C,id:l.id,title:l.title,description:l.description,created_at:l.created_at,updated_at:l.updated_at},sections:n.sections,frameworkTitle:n.title,onEdit:()=>y(`${v}/${h}/edit`),onDelete:A,backPath:v})}if((N||u)&&c)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:t("frameworkPages.loading")})});const T=i.filter(C=>C.title.toLowerCase().includes(d.toLowerCase())||C.description&&C.description.toLowerCase().includes(d.toLowerCase())),z=C=>{switch(C){case"completed":return"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200";case"active":return"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200";case"draft":return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200";default:return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}},S=t(`frameworkDescriptions.${r}.context`,{defaultValue:""}),U=t(`frameworkDescriptions.${r}.wikipediaUrl`,{defaultValue:null}),G=t(`frameworkDescriptions.${r}.goodUseCases`,{returnObjects:!0,defaultValue:[]}),F=t(`frameworkDescriptions.${r}.notIdealFor`,{returnObjects:!0,defaultValue:[]});return e.jsxs("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:n.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:n.description})]}),e.jsxs(te,{onClick:()=>y(`${v}/create`),children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),t("frameworkPages.newAnalysis")]})]}),S&&e.jsx(ge,{className:"mb-6 bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:e.jsx(xe,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:S}),U&&e.jsxs("a",{href:U,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-blue-600 dark:text-blue-400 hover:underline",children:[t("frameworkPages.learnMoreWikipedia"),e.jsx(ar,{className:"h-4 w-4"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-green-700 dark:text-green-400 mb-2 flex items-center gap-2",children:[e.jsx(jr,{className:"h-4 w-4"}),t("frameworkPages.goodUseCases")]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-700 dark:text-gray-300 space-y-1",children:G.map((C,j)=>e.jsx("li",{children:C},j))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-red-700 dark:text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(pa,{className:"h-4 w-4"}),t("frameworkPages.notIdealFor")]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-700 dark:text-gray-300 space-y-1",children:F.map((C,j)=>e.jsx("li",{children:C},j))})]})]})]})})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(ir,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(Ee,{type:"text",placeholder:t("frameworkPages.searchAnalyses"),value:d,onChange:C=>m(C.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"grid gap-4",children:T.map(C=>{const j=typeof C.data=="object"?C.data:Wt(C.data,{});return e.jsx(ge,{className:"hover:shadow-lg transition-shadow",children:e.jsx(xe,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-semibold hover:text-blue-600 transition-colors cursor-pointer",onClick:()=>y(`${v}/${C.id}`),children:C.title}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${z(C.status)}`,children:C.status})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:C.description}),e.jsx("div",{className:`grid grid-cols-${n.sections.length} gap-2 mb-4`,children:n.sections.map(D=>e.jsxs("div",{className:`text-center p-2 ${D.bgColor} rounded`,children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:D.label}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:j[D.key]?.length||0})]},D.key))}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-500",children:[t("frameworkPages.updated")," ",new Date(C.updated_at).toLocaleDateString()]})]}),e.jsxs(Ur,{children:[e.jsx(qr,{asChild:!0,children:e.jsx(te,{variant:"ghost",size:"icon",children:e.jsx(gn,{className:"h-4 w-4"})})}),e.jsxs(Wr,{align:"end",children:[e.jsx(rt,{onClick:()=>y(`${v}/${C.id}`),children:t("frameworkPages.view")}),e.jsx(rt,{onClick:()=>y(`${v}/${C.id}/edit`),children:t("buttons.edit")}),e.jsx(rt,{onClick:()=>y(`${v}/${C.id}`),children:t("frameworkPages.export")}),e.jsx(rt,{className:"text-red-600",onClick:D=>{D.stopPropagation(),A(C.id.toString())},children:t("buttons.delete")})]})]})]})})},C.id)})}),T.length===0&&e.jsx(ge,{children:e.jsxs(xe,{className:"text-center py-12",children:[e.jsx(ga,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:t("frameworkPages.noAnalysesFound")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:d?t("frameworkPages.tryAdjustingSearch"):`${t("frameworkPages.getStartedFirst")} ${n.title} ${t("frameworkPages.analysis")}`}),!d&&e.jsxs(te,{onClick:()=>y(`${v}/create`),children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),t("frameworkPages.createAnalysis")]})]})})]})},Wk=()=>{const{t:r}=Bt(),{currentWorkspaceId:t}=Kr(),s=cn.cog,[n,i]=B.useState([]),[o,l]=B.useState(null),[a,c]=B.useState(!1),[p,d]=B.useState(""),[m,y]=B.useState(!1),[h,_]=B.useState(null),b=xr(),{id:N}=da(),u=ua(),v=u.pathname.includes("/create"),g=u.pathname.includes("/wizard"),w=u.pathname.includes("/edit"),k=N&&!w&&!v&&!g,A="/dashboard/analysis-frameworks/cog";B.useEffect(()=>{T()},[]),B.useEffect(()=>{N&&z(N)},[N]);const T=async()=>{try{const J=await fetch(`/api/frameworks?workspace_id=${t}`,{headers:Tt()});if(J.ok){const W=((await J.json()).frameworks||[]).filter($=>$.framework_type==="cog");i(W);return}}catch{rn.debug("API not available, loading from localStorage")}const D=JSON.parse(localStorage.getItem("cog_analyses")||"[]");i(D)},z=async j=>{c(!0);try{const W=await fetch(`/api/frameworks?id=${j}&workspace_id=${t}`,{headers:Tt()});if(W.ok){const $=await W.json();l($),c(!1);return}}catch{rn.debug("API not available, loading from localStorage")}const q=JSON.parse(localStorage.getItem("cog_analyses")||"[]").find(W=>W.id===j);q&&l(q),c(!1)},S=async j=>{const D={id:j.id||crypto.randomUUID(),framework_type:"cog",title:j.title,description:j.description,data:j,status:"active",is_public:!1,workspace_id:t,created_at:j.created_at||new Date().toISOString(),updated_at:new Date().toISOString()};try{if(w&&N){if(!(await fetch(`/api/frameworks?id=${N}&workspace_id=${t}`,{method:"PUT",headers:Tt(),body:JSON.stringify(D)})).ok)throw new Error("API not available")}else if(!(await fetch(`/api/frameworks?workspace_id=${t}`,{method:"POST",headers:Tt(),body:JSON.stringify(D)})).ok)throw new Error("API not available")}catch{rn.debug("API not available, using localStorage fallback");const q="cog_analyses",W=JSON.parse(localStorage.getItem(q)||"[]");if(w&&N){const $=W.findIndex(ne=>ne.id===N);$!==-1&&(W[$]=D)}else W.push(D);localStorage.setItem(q,JSON.stringify(W))}},U=async j=>{const D=j||N;if(!D||!confirm(r("frameworkPages.confirmDeleteAnalysis")))return;try{if((await fetch(`/api/frameworks?id=${D}&workspace_id=${t}`,{method:"DELETE",headers:Tt()})).ok){j?await T():b(A);return}}catch{rn.debug("API not available, using localStorage")}const J="cog_analyses",W=JSON.parse(localStorage.getItem(J)||"[]").filter($=>$.id!==D);localStorage.setItem(J,JSON.stringify(W)),j?await T():b(A)},G=(j,D)=>{_(j),y(!1);const J=D==="wizard"?`${A}/wizard`:`${A}/create`;b(J,{state:{template:j}})};if(g){const j=u.state?.template?.template_data;return e.jsx(Lk,{onSave:S,backPath:A,initialData:j})}if(v){const j=u.state?.wizardData,D=u.state?.template?.template_data,J=u.state?.investigationData;let q=j||D;if(u.state?.fromInvestigation&&J){const{content:W,statistics:$}=J;(W?.flatMap(K=>K.claims||[])||[]).filter(K=>(K.adjusted_risk_score??K.original_risk_score)>=50).slice(0,5),q={title:`${u.state.investigationTitle} - COG Analysis`,description:J.description||`Generated from investigation: ${u.state.investigationTitle}`,operational_context:{objective:`Analysis of ${u.state.investigationTitle}`,desired_impact:"",our_identity:"",operating_environment:"",constraints:[],restraints:[],timeframe:"",strategic_level:"operational"},source_investigation_id:u.state.investigationId}}return e.jsx(_m,{mode:"create",onSave:S,backPath:A,initialData:q})}if(w&&o){const j=typeof o.data=="object"?o.data:Wt(o.data,{});return e.jsx(_m,{mode:"edit",initialData:j,onSave:S,backPath:A,frameworkId:o.id.toString()})}if(k&&o){const j=typeof o.data=="object"?o.data:Wt(o.data,{});return e.jsx(Ok,{data:j,onEdit:()=>b(`${A}/${N}/edit`),onDelete:U,backPath:A})}if((w||k)&&a)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:r("frameworkPages.loading")})});const F=n.filter(j=>j.title.toLowerCase().includes(p.toLowerCase())||j.description&&j.description.toLowerCase().includes(p.toLowerCase())),C=j=>{switch(j){case"completed":return"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200";case"active":return"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200";case"draft":return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200";default:return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}};return e.jsxs("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:s.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:s.description})]}),e.jsxs(te,{onClick:()=>y(!0),children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),r("frameworkPages.newAnalysis")]})]}),e.jsx(ge,{className:"mb-6 bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:e.jsxs(xe,{className:"p-6",children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-3",children:"Systematic COG analysis using Joint Publication 3-0 methodology with DIMEFIL domain analysis, vulnerability scoring, and network visualization."}),e.jsxs("a",{href:"https://irregularpedia.org/index.php/Center_of_Gravity_Analysis_Guide",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-blue-600 dark:text-blue-400 hover:underline",children:["View Irregularpedia Reference Guide",e.jsx(ar,{className:"h-4 w-4"})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(ir,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(Ee,{type:"text",placeholder:r("frameworkPages.searchAnalyses"),value:p,onChange:j=>d(j.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"grid gap-4",children:F.map(j=>{const D=typeof j.data=="object"?j.data:Wt(j.data,{});return e.jsx(ge,{className:"hover:shadow-lg transition-shadow",children:e.jsx(xe,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-semibold hover:text-blue-600 transition-colors cursor-pointer",onClick:()=>b(`${A}/${j.id}`),children:j.title}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${C(j.status)}`,children:j.status}),D.scoring_system&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-purple-100 text-purple-800",children:D.scoring_system==="linear"?"Linear":"Logarithmic"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:j.description}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-4",children:[e.jsxs("div",{className:"text-center p-2 bg-red-50 dark:bg-red-900/20 rounded",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"COGs"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:D.centers_of_gravity?.length||0})]}),e.jsxs("div",{className:"text-center p-2 bg-blue-50 dark:bg-blue-900/20 rounded",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Capabilities"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:D.critical_capabilities?.length||0})]}),e.jsxs("div",{className:"text-center p-2 bg-yellow-50 dark:bg-yellow-900/20 rounded",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Requirements"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:D.critical_requirements?.length||0})]}),e.jsxs("div",{className:"text-center p-2 bg-orange-50 dark:bg-orange-900/20 rounded",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Vulnerabilities"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:D.critical_vulnerabilities?.length||0})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-500",children:[r("frameworkPages.updated")," ",new Date(j.updated_at).toLocaleDateString()]})]}),e.jsxs(Ur,{children:[e.jsx(qr,{asChild:!0,children:e.jsx(te,{variant:"ghost",size:"icon",children:e.jsx(gn,{className:"h-4 w-4"})})}),e.jsxs(Wr,{align:"end",children:[e.jsx(rt,{onClick:()=>b(`${A}/${j.id}`),children:r("frameworkPages.view")}),e.jsx(rt,{onClick:()=>b(`${A}/${j.id}/edit`),children:r("buttons.edit")}),e.jsx(rt,{className:"text-red-600",onClick:J=>{J.stopPropagation(),U(j.id.toString())},children:r("buttons.delete")})]})]})]})})},j.id)})}),F.length===0&&e.jsx(ge,{children:e.jsxs(xe,{className:"text-center py-12",children:[e.jsx(ga,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:r("frameworkPages.noAnalysesFound")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:p?r("frameworkPages.tryAdjustingSearch"):`${r("frameworkPages.getStartedFirst")} COG ${r("frameworkPages.analysis")}`}),!p&&e.jsxs(te,{onClick:()=>y(!0),children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),r("frameworkPages.createAnalysis")]})]})}),e.jsx(wt,{open:m,onOpenChange:y,children:e.jsxs(jt,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsx(kt,{children:r("cog:templates.dialog.title")}),e.jsx(It,{children:r("cog:templates.dialog.description")})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx(ge,{className:"border-2",children:e.jsx(xe,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"text-4xl",children:"ðŸ“„"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:r("cog:templates.dialog.blankAnalysis")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:r("cog:templates.dialog.blankDescription")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{size:"sm",onClick:()=>G(null,"wizard"),children:["ðŸ§™ ",r("cog:templates.dialog.startWithWizard")]}),e.jsxs(te,{size:"sm",variant:"outline",onClick:()=>G(null,"advanced"),children:["âš¡ ",r("cog:templates.dialog.advancedMode")]})]})]})]})})}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-gray-700 dark:text-gray-300",children:r("cog:templates.dialog.orStartFromTemplate")}),e.jsx("div",{className:"grid gap-3",children:Uk.map(j=>e.jsx(ge,{className:"border",children:e.jsx(xe,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-3xl",children:j.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold",children:r(`cog:templates.list.${j.i18nKey}.name`)}),e.jsx(he,{variant:"outline",className:"text-xs capitalize",children:r(`cog:templates.categories.${j.category}`)})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2 mb-2",children:r(`cog:templates.list.${j.i18nKey}.description`)}),e.jsxs("div",{className:"flex gap-4 text-xs text-gray-500 mb-3",children:[e.jsxs("span",{children:["â€¢ ",j.template_data.centers_of_gravity.length," ",r("cog:templates.stats.cogs")]}),e.jsxs("span",{children:["â€¢ ",j.template_data.critical_capabilities.length," ",r("cog:templates.stats.capabilities")]}),e.jsxs("span",{children:["â€¢ ",j.template_data.critical_vulnerabilities.length," ",r("cog:templates.stats.vulnerabilities")]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(te,{size:"sm",variant:"default",onClick:()=>G(j,"wizard"),children:["ðŸ§™ ",r("cog:templates.dialog.wizard")]}),e.jsxs(te,{size:"sm",variant:"outline",onClick:()=>G(j,"advanced"),children:["âš¡ ",r("cog:templates.dialog.advanced")]})]})]})]})})},j.id))})]})]})]})})]})},Hk=()=>e.jsx(Or,{frameworkKey:"pmesii-pt"}),Gk=()=>e.jsx(Or,{frameworkKey:"dotmlpf"}),Vk=()=>{const{t:r}=Bt(),{currentWorkspaceId:t}=Kr(),s=cn.deception,[n,i]=B.useState([]),[o,l]=B.useState(null),[a,c]=B.useState(!1),[p,d]=B.useState(""),m=xr(),{id:y}=da(),h=ua(),_=h.pathname.includes("/create"),b=h.pathname.includes("/edit"),N=y&&!b&&!_,u="/dashboard/analysis-frameworks/deception";B.useEffect(()=>{v()},[]),B.useEffect(()=>{y&&g(y)},[y]);const v=async()=>{try{const C=await fetch(`/api/frameworks?workspace_id=${t}`,{headers:Tt()});if(C.ok){const D=((await C.json()).frameworks||[]).filter(J=>J.framework_type==="deception");i(D)}}catch(C){console.error("Failed to load analyses:",C)}},g=async C=>{c(!0);try{const j=await fetch(`/api/frameworks?id=${C}&workspace_id=${t}`,{headers:Tt()});if(j.ok){const D=await j.json();if(D.data&&typeof D.data=="string")try{D.data=JSON.parse(D.data)}catch(J){console.error("Failed to parse framework data:",J)}l(D)}}catch(j){console.error("Failed to load analysis:",j)}finally{c(!1)}},w=async C=>{const j={framework_type:"deception",title:C.title,description:C.description,data:C,status:"active",is_public:!1,workspace_id:t};if(b&&y){if(!(await fetch(`/api/frameworks?id=${y}&workspace_id=${t}`,{method:"PUT",headers:Tt(),body:JSON.stringify(j)})).ok)throw new Error("Failed to update")}else if(!(await fetch(`/api/frameworks?workspace_id=${t}`,{method:"POST",headers:Tt(),body:JSON.stringify(j)})).ok)throw new Error("Failed to create")},k=async C=>{const j=C||y;if(j&&confirm(r("frameworkPages.confirmDeleteAnalysis")))try{(await fetch(`/api/frameworks?id=${j}&workspace_id=${t}`,{method:"DELETE",headers:Tt()})).ok&&(C?await v():m(u))}catch(D){console.error("Failed to delete:",D),alert("Failed to delete analysis")}};if(_)return e.jsx(xu,{mode:"create",onSave:w,backPath:u});if(b&&o){const C=typeof o.data=="object"?o.data:Wt(o.data,{});return e.jsx(xu,{mode:"edit",initialData:{...C,title:o.title,description:o.description},onSave:w,backPath:u,frameworkId:o.id.toString()})}if(N&&o){const C=typeof o.data=="object"?o.data:Wt(o.data,{});return e.jsx(gk,{data:{...C,id:o.id,title:o.title,description:o.description,created_at:o.created_at,updated_at:o.updated_at},onEdit:()=>m(`${u}/${y}/edit`),onDelete:k,backPath:u})}if((b||N)&&a)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:r("frameworkPages.loading")})});const A=n.filter(C=>C.title.toLowerCase().includes(p.toLowerCase())||C.description&&C.description.toLowerCase().includes(p.toLowerCase())),T=C=>{switch(C){case"completed":return"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200";case"active":return"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200";case"draft":return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200";default:return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}},z="deception",S=r(`frameworkDescriptions.${z}.context`),U=r(`frameworkDescriptions.${z}.wikipediaUrl`,{defaultValue:null}),G=r(`frameworkDescriptions.${z}.goodUseCases`,{returnObjects:!0}),F=r(`frameworkDescriptions.${z}.notIdealFor`,{returnObjects:!0});return e.jsxs("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:s.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:s.description})]}),e.jsxs(te,{onClick:()=>m(`${u}/create`),children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),r("frameworkPages.newAnalysis")]})]}),e.jsx(ge,{className:"mb-6 bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:e.jsx(xe,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:S}),U&&e.jsxs("a",{href:U,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 text-blue-600 dark:text-blue-400 hover:underline",children:[r("frameworkPages.learnMoreWikipedia"),e.jsx(ar,{className:"h-4 w-4"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-green-700 dark:text-green-400 mb-2 flex items-center gap-2",children:[e.jsx(jr,{className:"h-4 w-4"}),r("frameworkPages.goodUseCases")]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-700 dark:text-gray-300 space-y-1",children:G.map((C,j)=>e.jsx("li",{children:C},j))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-red-700 dark:text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(pa,{className:"h-4 w-4"}),r("frameworkPages.notIdealFor")]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-700 dark:text-gray-300 space-y-1",children:F.map((C,j)=>e.jsx("li",{children:C},j))})]})]})]})})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(ir,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(Ee,{type:"text",placeholder:r("frameworkPages.searchAnalyses"),value:p,onChange:C=>d(C.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"grid gap-4",children:A.map(C=>{const D=Wt(C.data,{}).calculatedAssessment;return e.jsx(ge,{className:"hover:shadow-lg transition-shadow",children:e.jsx(xe,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-semibold hover:text-blue-600 transition-colors cursor-pointer",onClick:()=>m(`${u}/${C.id}`),children:C.title}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${T(C.status)}`,children:C.status}),D&&e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${D.riskLevel==="CRITICAL"?"bg-red-600 text-white":D.riskLevel==="HIGH"?"bg-orange-500 text-white":D.riskLevel==="MEDIUM"?"bg-yellow-500 text-gray-900":"bg-green-600 text-white"}`,children:[D.overallLikelihood,"% DECEPTION RISK"]})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:C.description}),D&&e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-4",children:[e.jsxs("div",{className:"text-center p-2 bg-red-50 dark:bg-red-900/20 rounded",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"MOM"}),e.jsx("p",{className:"text-lg font-semibold text-red-600 dark:text-red-400",children:D.categoryScores.mom.toFixed(1)})]}),e.jsxs("div",{className:"text-center p-2 bg-orange-50 dark:bg-orange-900/20 rounded",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"POP"}),e.jsx("p",{className:"text-lg font-semibold text-orange-600 dark:text-orange-400",children:D.categoryScores.pop.toFixed(1)})]}),e.jsxs("div",{className:"text-center p-2 bg-yellow-50 dark:bg-yellow-900/20 rounded",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"MOSES"}),e.jsx("p",{className:"text-lg font-semibold text-yellow-600 dark:text-yellow-400",children:D.categoryScores.moses.toFixed(1)})]}),e.jsxs("div",{className:"text-center p-2 bg-blue-50 dark:bg-blue-900/20 rounded",children:[e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"EVE"}),e.jsx("p",{className:"text-lg font-semibold text-blue-600 dark:text-blue-400",children:D.categoryScores.eve.toFixed(1)})]})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-500",children:[r("frameworkPages.updated")," ",new Date(C.updated_at).toLocaleDateString()]})]}),e.jsxs(Ur,{children:[e.jsx(qr,{asChild:!0,children:e.jsx(te,{variant:"ghost",size:"icon",children:e.jsx(gn,{className:"h-4 w-4"})})}),e.jsxs(Wr,{align:"end",children:[e.jsx(rt,{onClick:()=>m(`${u}/${C.id}`),children:r("frameworkPages.view")}),e.jsx(rt,{onClick:()=>m(`${u}/${C.id}/edit`),children:r("buttons.edit")}),e.jsx(rt,{onClick:()=>m(`${u}/${C.id}`),children:r("frameworkPages.export")}),e.jsx(rt,{className:"text-red-600",onClick:J=>{J.stopPropagation(),k(C.id.toString())},children:r("buttons.delete")})]})]})]})})},C.id)})}),A.length===0&&e.jsx(ge,{children:e.jsxs(xe,{className:"text-center py-12",children:[e.jsx(ga,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:r("frameworkPages.noAnalysesFound")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:p?r("frameworkPages.tryAdjustingSearch"):`${r("frameworkPages.getStartedFirst")} deception ${r("frameworkPages.analysis")} using CIA SATS methodology`}),!p&&e.jsxs(te,{onClick:()=>m(`${u}/create`),children:[e.jsx(st,{className:"h-4 w-4 mr-2"}),r("frameworkPages.createAnalysis")]})]})})]})},Kk=()=>e.jsx(Or,{frameworkKey:"behavior"}),Xk=()=>e.jsx(Or,{frameworkKey:"comb-analysis"}),Yk=()=>e.jsx(Or,{frameworkKey:"starbursting"}),Jk=()=>e.jsx(Or,{frameworkKey:"causeway"}),Qk=()=>e.jsx(Or,{frameworkKey:"dime"}),Zk=()=>e.jsx(Or,{frameworkKey:"pest"}),eN=()=>e.jsx(Or,{frameworkKey:"stakeholder"}),tN=()=>e.jsx(Or,{frameworkKey:"surveillance"}),rN=()=>e.jsx(Or,{frameworkKey:"fundamental-flow"}),$N=Object.freeze(Object.defineProperty({__proto__:null,BehaviorPage:Kk,COMBAnalysisPage:Xk,CausewayPage:Jk,CogPage:Wk,DeceptionPage:Vk,DimePage:Qk,DotmlpfPage:Gk,FundamentalFlowPage:rN,PestPage:Zk,PmesiiPtPage:Hk,StakeholderPage:eN,StarburstingPage:Yk,SurveillancePage:tN,SwotPage:qk},Symbol.toStringTag,{value:"Module"}));export{or as A,J_ as F,Sr as H,x0 as I,y0 as P,Vt as T,j0 as a,Fe as b,hk as c,_0 as d,$N as e,cn as f,w0 as g,Ht as i};
