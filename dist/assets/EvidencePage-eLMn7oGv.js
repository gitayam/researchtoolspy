import{j as e}from"./ui-vendor-DBphXmDA.js";import{f as K,r as c}from"./react-vendor-CfYLSWvh.js";import{u as Q,B as f,I as ee,S as y,z as N,C,E as b,F as d,e as E,t as se,D as te,g as ae,h as re,k as h,j as F}from"./index-DGGXJgUa.js";import{C as o,d as x}from"./card-BQo7RV_Z.js";import{P as O,E as P,a as ne,b as ie}from"./evidence-CClaHnJf.js";import{E as ce}from"./EvidenceItemForm-DLuun9hp.js";import{e as le}from"./evidence-to-citation-BKNucZlP.js";import{b as de}from"./citation-library-DsFrzEV3.js";import{W as D,d as M,aj as I,Y as k,az as B,a as oe,a0 as he,aM as xe,N as ve,$ as je,ay as me,A as pe,q as ue,x as V,Z as ge,V as we,C as fe}from"./icons-x9tcvtYN.js";import"./state-vendor-BXB5jEEt.js";import"./slider-oUJ8z5Zt.js";function Oe(){const{t}=Q(),U=K(),[n,$]=c.useState([]),[r,u]=c.useState({}),[l,z]=c.useState(""),[A,v]=c.useState(!1),[S,_]=c.useState("create"),[g,j]=c.useState(null),w=async()=>{try{const s=await fetch("/api/evidence-items");if(s.ok){const a=await s.json();$(a.evidence||[])}}catch(s){console.error("Failed to load evidence:",s)}};c.useEffect(()=>{w()},[]);const q=async s=>{try{if(S==="edit"&&g?.id){if(!(await fetch(`/api/evidence-items?id=${g.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Failed to update evidence")}else if(!(await fetch("/api/evidence-items",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Failed to create evidence");await w(),v(!1),j(null)}catch(a){throw console.error("Error saving evidence:",a),a}},J=async s=>{if(confirm(t("evidence.confirmDelete")))try{(await fetch(`/api/evidence-items?id=${s}`,{method:"DELETE"})).ok&&await w()}catch(a){console.error("Failed to delete evidence:",a),alert(t("evidence.deleteError"))}},L=()=>{_("create"),j(null),v(!0)},Z=s=>{_("edit"),j(s),v(!0)},G=s=>{try{const a=le(s,"apa");de(a),alert(t("evidence.citationSuccess"))}catch(a){console.error("Failed to generate citation:",a),alert(t("evidence.citationError"))}},T=n.filter(s=>{const a=s.title.toLowerCase().includes(l.toLowerCase())||s.description?.toLowerCase().includes(l.toLowerCase())||s.who?.toLowerCase().includes(l.toLowerCase())||s.what?.toLowerCase().includes(l.toLowerCase())||s.tags.some(H=>H.toLowerCase().includes(l.toLowerCase())),i=!r.type||s.evidence_type===r.type,p=!r.level||s.evidence_level===r.level,X=!r.status||s.status===r.status,Y=!r.priority||s.priority===r.priority;return a&&i&&p&&X&&Y}),R=s=>{switch(s){case"tactical":return V;case"operational":return we;case"strategic":return ge;default:return V}},W=s=>{switch(s){case"verified":return I;case"pending":return k;case"rejected":return B;case"needs_review":return fe;default:return k}},m={total:n.length,verified:n.filter(s=>s.status==="verified").length,pending:n.filter(s=>s.status==="pending").length,rejected:n.filter(s=>s.status==="rejected").length,by_type:Object.values(ne).reduce((s,a)=>(s[a]=n.filter(i=>i.evidence_type===a).length,s),{}),by_level:Object.values(P).reduce((s,a)=>(s[a]=n.filter(i=>i.evidence_level===a).length,s),{}),by_priority:Object.values(O).reduce((s,a)=>(s[a]=n.filter(i=>i.priority===a).length,s),{})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t("evidence.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t("evidence.subtitle")})]}),e.jsxs(f,{onClick:L,children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),t("evidence.addEvidence")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(o,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("evidence.totalEvidence")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:m.total})]}),e.jsx(M,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(o,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("evidence.verified")}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:m.verified})]}),e.jsx(I,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(o,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("evidence.pending")}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:m.pending})]}),e.jsx(k,{className:"h-8 w-8 text-yellow-500"})]})})}),e.jsx(o,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("evidence.rejected")}),e.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:m.rejected})]}),e.jsx(B,{className:"h-8 w-8 text-red-500"})]})})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(ee,{placeholder:t("evidence.searchPlaceholder"),className:"pl-10",value:l,onChange:s=>z(s.target.value)})]}),e.jsxs(y,{value:r.level||"all",onValueChange:s=>u({...r,level:s==="all"?void 0:s}),children:[e.jsx(N,{className:"w-48",children:e.jsx(C,{placeholder:t("evidence.filterByLevel")})}),e.jsxs(b,{children:[e.jsx(d,{value:"all",children:t("evidence.allLevels")}),Object.values(P).map(s=>e.jsx(d,{value:s,children:s.toUpperCase()},s))]})]}),e.jsxs(y,{value:r.priority||"all",onValueChange:s=>u({...r,priority:s==="all"?void 0:s}),children:[e.jsx(N,{className:"w-48",children:e.jsx(C,{placeholder:t("evidence.filterByPriority")})}),e.jsxs(b,{children:[e.jsx(d,{value:"all",children:t("evidence.allPriorities")}),Object.values(O).map(s=>e.jsx(d,{value:s,children:s.toUpperCase()},s))]})]}),e.jsxs(y,{value:r.status||"all",onValueChange:s=>u({...r,status:s==="all"?void 0:s}),children:[e.jsx(N,{className:"w-48",children:e.jsx(C,{placeholder:t("evidence.filterByStatus")})}),e.jsxs(b,{children:[e.jsx(d,{value:"all",children:t("evidence.allStatuses")}),Object.values(ie).map(s=>e.jsx(d,{value:s,children:s.replace("_"," ").toUpperCase()},s))]})]})]}),e.jsx("div",{className:"space-y-4",children:T.length===0?e.jsxs(o,{className:"p-12 text-center",children:[e.jsx(M,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 dark:text-gray-400 mb-2",children:t("evidence.noEvidenceFound")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500 mb-4",children:n.length===0?t("evidence.emptyStateMessage"):t("evidence.emptyFilterMessage")}),e.jsxs(f,{onClick:L,children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),t("evidence.addFirstEvidence")]})]}):T.map(s=>{const a=R(s.evidence_level),i=W(s.status);return e.jsx(o,{className:"hover:shadow-md transition-shadow",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-800",children:e.jsx(a,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900 dark:text-white",children:s.title}),e.jsx(E,{variant:"outline",className:"text-xs",children:s.evidence_level}),e.jsx(E,{variant:s.priority==="critical"?"destructive":"secondary",className:"text-xs",children:s.priority}),e.jsx(i,{className:se("h-4 w-4",s.status==="verified"&&"text-green-500",s.status==="pending"&&"text-yellow-500",s.status==="rejected"&&"text-red-500",s.status==="needs_review"&&"text-orange-500")})]}),s.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-3",children:s.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-sm mb-3",children:[s.who&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t("evidence.who")})," ",s.who]}),s.what&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t("evidence.what")})," ",s.what]}),s.when_occurred&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t("evidence.when")})," ",s.when_occurred]}),s.where_location&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t("evidence.where")})," ",s.where_location]}),s.why_purpose&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t("evidence.why")})," ",s.why_purpose]}),s.how_method&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t("evidence.how")})," ",s.how_method]})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:s.tags.map(p=>e.jsxs(E,{variant:"secondary",className:"text-xs",children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),p]},p))})]})]}),e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",children:e.jsx(xe,{className:"h-4 w-4"})})}),e.jsxs(re,{align:"end",children:[e.jsxs(h,{onClick:()=>U("/dashboard/network-graph",{state:{highlightEntities:[`evidence_${s.id}`],source:"evidence",title:s.title}}),children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"View in Network"]}),e.jsx(F,{}),e.jsxs(h,{onClick:()=>Z(s),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),t("evidence.edit")]}),e.jsxs(h,{onClick:()=>G(s),children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),t("evidence.generateCitation")]}),e.jsxs(h,{children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),t("evidence.archive")]}),e.jsx(F,{}),e.jsxs(h,{className:"text-red-600",onClick:()=>J(s.id),children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),t("evidence.delete")]})]})]})]})})},s.id)})}),e.jsx(ce,{open:A,onClose:()=>{v(!1),j(null)},onSave:q,initialData:g,mode:S})]})}export{Oe as EvidencePage};
