{
  "version": 3,
  "sources": ["../bundle-eX4cAX/checked-fetch.js", "wrangler-modules-watch:wrangler:modules-watch", "../../../../node_modules/wrangler/templates/modules-watch-stub.js", "../../../../shared/jwt.ts", "../../../../shared/types.ts", "../../../../shared/database.ts", "../../../src/middleware/auth.ts", "../../../src/middleware/errorHandler.ts", "../../../src/routes/auth.ts", "../../../../frameworks/swot/src/ai.ts", "../../../../frameworks/swot/src/export.ts", "../../../../frameworks/swot/src/index.ts", "../../../src/routes/frameworks.ts", "../../../src/routes/tools.ts", "../../../src/routes/users.ts", "../../../src/routes/ai.ts", "../../../src/routes/export.ts", "../../../src/routes/analytics.ts", "../../../src/routes/citations.ts", "../../../src/routes/jobs.ts", "../bundle-eX4cAX/middleware-loader.entry.ts", "../bundle-eX4cAX/middleware-insertion-facade.js", "../../../src/index.ts", "../../../src/middleware/cors.ts", "../../../src/middleware/rateLimit.ts", "../../../src/middleware/logger.ts", "../../../src/router.ts", "../../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../../../../node_modules/wrangler/templates/middleware/common.ts"],
  "sourceRoot": "/Users/sac/Git/researchtoolspy/cloudflare/workers/gateway/.wrangler/tmp/dev-s6H34m",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "", "// `esbuild` doesn't support returning `watch*` options from `onStart()`\n// plugin callbacks. Instead, we define an empty virtual module that is\n// imported by this injected file. Importing the module registers watchers.\nimport \"wrangler:modules-watch\";\n", "/**\n * JWT utilities for Cloudflare Workers\n * Using Web Crypto API for token signing and verification\n */\n\nimport { JWTPayload } from './types';\n\n/**\n * Create a JWT token\n */\nexport async function createJWT(\n  payload: JWTPayload,\n  secret: string,\n  expiresIn: number = 3600 // 1 hour default\n): Promise<string> {\n  const header = {\n    alg: 'HS256',\n    typ: 'JWT',\n  };\n\n  const now = Math.floor(Date.now() / 1000);\n  const fullPayload = {\n    ...payload,\n    iat: now,\n    exp: now + expiresIn,\n    jti: crypto.randomUUID(), // JWT ID for revocation\n  };\n\n  // Encode header and payload\n  const encodedHeader = base64urlEncode(JSON.stringify(header));\n  const encodedPayload = base64urlEncode(JSON.stringify(fullPayload));\n  const message = `${encodedHeader}.${encodedPayload}`;\n\n  // Sign the message\n  const signature = await sign(message, secret);\n\n  return `${message}.${signature}`;\n}\n\n/**\n * Verify and decode a JWT token\n */\nexport async function verifyJWT(\n  token: string,\n  secret: string\n): Promise<JWTPayload | null> {\n  try {\n    const parts = token.split('.');\n    if (parts.length !== 3) {\n      return null;\n    }\n\n    const [encodedHeader, encodedPayload, signature] = parts;\n    const message = `${encodedHeader}.${encodedPayload}`;\n\n    // Verify signature\n    const isValid = await verify(message, signature, secret);\n    if (!isValid) {\n      return null;\n    }\n\n    // Decode payload\n    const payload = JSON.parse(base64urlDecode(encodedPayload));\n\n    // Check expiration\n    const now = Math.floor(Date.now() / 1000);\n    if (payload.exp && payload.exp < now) {\n      return null;\n    }\n\n    return payload as JWTPayload;\n  } catch (error) {\n    console.error('JWT verification error:', error);\n    return null;\n  }\n}\n\n/**\n * Create refresh token\n */\nexport async function createRefreshToken(\n  userId: string,\n  secret: string\n): Promise<string> {\n  const payload: JWTPayload = {\n    sub: userId,\n    type: 'refresh',\n    jti: crypto.randomUUID(),\n  } as JWTPayload;\n\n  // Refresh tokens expire in 7 days\n  return createJWT(payload, secret, 7 * 24 * 3600);\n}\n\n/**\n * Sign a message using HMAC-SHA256\n */\nasync function sign(message: string, secret: string): Promise<string> {\n  const encoder = new TextEncoder();\n  const key = await crypto.subtle.importKey(\n    'raw',\n    encoder.encode(secret),\n    { name: 'HMAC', hash: 'SHA-256' },\n    false,\n    ['sign']\n  );\n\n  const signature = await crypto.subtle.sign(\n    'HMAC',\n    key,\n    encoder.encode(message)\n  );\n\n  return base64urlEncode(signature);\n}\n\n/**\n * Verify a signature using HMAC-SHA256\n */\nasync function verify(\n  message: string,\n  signature: string,\n  secret: string\n): Promise<boolean> {\n  const encoder = new TextEncoder();\n  const key = await crypto.subtle.importKey(\n    'raw',\n    encoder.encode(secret),\n    { name: 'HMAC', hash: 'SHA-256' },\n    false,\n    ['verify']\n  );\n\n  const signatureBuffer = base64urlDecode(signature, true);\n\n  return crypto.subtle.verify(\n    'HMAC',\n    key,\n    signatureBuffer,\n    encoder.encode(message)\n  );\n}\n\n/**\n * Base64url encode\n */\nfunction base64urlEncode(input: string | ArrayBuffer): string {\n  let base64: string;\n\n  if (typeof input === 'string') {\n    base64 = btoa(input);\n  } else {\n    const bytes = new Uint8Array(input);\n    const binary = String.fromCharCode(...bytes);\n    base64 = btoa(binary);\n  }\n\n  return base64\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=/g, '');\n}\n\n/**\n * Base64url decode\n */\nfunction base64urlDecode(input: string, asBuffer: boolean = false): any {\n  // Add padding if needed\n  const padding = '='.repeat((4 - (input.length % 4)) % 4);\n  const base64 = input\n    .replace(/-/g, '+')\n    .replace(/_/g, '/')\n    + padding;\n\n  const binary = atob(base64);\n\n  if (asBuffer) {\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i++) {\n      bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes.buffer;\n  }\n\n  return binary;\n}\n\n/**\n * Extract token from Authorization header\n */\nexport function extractToken(authHeader: string | null): string | null {\n  if (!authHeader) return null;\n\n  const match = authHeader.match(/^Bearer (.+)$/i);\n  return match ? match[1] : null;\n}\n\n/**\n * Generate a secure random token\n */\nexport function generateSecureToken(length: number = 32): string {\n  const array = new Uint8Array(length);\n  crypto.getRandomValues(array);\n  return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');\n}\n\n/**\n * Hash a password using PBKDF2\n */\nexport async function hashPassword(password: string, salt?: string): Promise<{\n  hash: string;\n  salt: string;\n}> {\n  const encoder = new TextEncoder();\n\n  // Generate salt if not provided\n  const saltBytes = salt\n    ? encoder.encode(salt)\n    : crypto.getRandomValues(new Uint8Array(16));\n\n  const saltString = salt || Array.from(new Uint8Array(saltBytes), byte =>\n    byte.toString(16).padStart(2, '0')\n  ).join('');\n\n  // Import password as key\n  const key = await crypto.subtle.importKey(\n    'raw',\n    encoder.encode(password),\n    'PBKDF2',\n    false,\n    ['deriveBits']\n  );\n\n  // Derive bits\n  const hashBuffer = await crypto.subtle.deriveBits(\n    {\n      name: 'PBKDF2',\n      salt: saltBytes,\n      iterations: 100000,\n      hash: 'SHA-256',\n    },\n    key,\n    256\n  );\n\n  // Convert to hex string\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n\n  return {\n    hash: hashHex,\n    salt: saltString,\n  };\n}\n\n/**\n * Verify a password against a hash\n */\nexport async function verifyPassword(\n  password: string,\n  hash: string,\n  salt: string\n): Promise<boolean> {\n  const result = await hashPassword(password, salt);\n  return result.hash === hash;\n}\n\n/**\n * Generate a short-lived token for email verification, password reset, etc.\n */\nexport async function generateVerificationToken(\n  purpose: string,\n  data: any,\n  secret: string,\n  expiresIn: number = 3600 // 1 hour default\n): Promise<string> {\n  const payload = {\n    purpose,\n    data,\n    exp: Math.floor(Date.now() / 1000) + expiresIn,\n  };\n\n  const token = base64urlEncode(JSON.stringify(payload));\n  const signature = await sign(token, secret);\n\n  return `${token}.${signature}`;\n}\n\n/**\n * Verify a verification token\n */\nexport async function verifyVerificationToken(\n  token: string,\n  purpose: string,\n  secret: string\n): Promise<any | null> {\n  try {\n    const parts = token.split('.');\n    if (parts.length !== 2) {\n      return null;\n    }\n\n    const [encodedPayload, signature] = parts;\n\n    // Verify signature\n    const isValid = await verify(encodedPayload, signature, secret);\n    if (!isValid) {\n      return null;\n    }\n\n    // Decode and validate payload\n    const payload = JSON.parse(base64urlDecode(encodedPayload));\n\n    // Check purpose\n    if (payload.purpose !== purpose) {\n      return null;\n    }\n\n    // Check expiration\n    const now = Math.floor(Date.now() / 1000);\n    if (payload.exp && payload.exp < now) {\n      return null;\n    }\n\n    return payload.data;\n  } catch (error) {\n    console.error('Verification token error:', error);\n    return null;\n  }\n}", "// Shared TypeScript types for Cloudflare Workers\n\n// Environment bindings\nexport interface Env {\n  // D1 Database\n  DB: D1Database;\n\n  // KV Namespaces\n  SESSIONS: KVNamespace;\n  RATE_LIMITS: KVNamespace;\n  CACHE: KVNamespace;\n  ANONYMOUS_SESSIONS: KVNamespace;\n\n  // R2 Buckets\n  DOCUMENTS?: R2Bucket;\n  EXPORTS?: R2Bucket;\n  ASSETS?: R2Bucket;\n\n  // Queues\n  DOCUMENT_QUEUE?: Queue;\n  REPORT_QUEUE?: Queue;\n  EMAIL_QUEUE?: Queue;\n\n  // Environment Variables\n  JWT_SECRET: string;\n  OPENAI_API_KEY?: string;\n  ENVIRONMENT?: 'production' | 'staging' | 'development';\n\n  // Service bindings (for worker-to-worker communication)\n  AUTH_SERVICE?: Fetcher;\n  FRAMEWORK_SERVICE?: Fetcher;\n  SWOT_SERVICE?: Fetcher;\n  ACH_SERVICE?: Fetcher;\n  BEHAVIORAL_SERVICE?: Fetcher;\n  DECEPTION_SERVICE?: Fetcher;\n  DOTMLPF_SERVICE?: Fetcher;\n  PMESII_SERVICE?: Fetcher;\n  DIME_SERVICE?: Fetcher;\n  PEST_SERVICE?: Fetcher;\n  VRIO_SERVICE?: Fetcher;\n  STAKEHOLDER_SERVICE?: Fetcher;\n  TREND_SERVICE?: Fetcher;\n  SURVEILLANCE_SERVICE?: Fetcher;\n  CAUSEWAY_SERVICE?: Fetcher;\n  COG_SERVICE?: Fetcher;\n  STARBURSTING_SERVICE?: Fetcher;\n  FLOW_SERVICE?: Fetcher;\n  TOOLS_SERVICE?: Fetcher;\n  AI_SERVICE?: Fetcher;\n  EXPORT_SERVICE?: Fetcher;\n  ANALYTICS_SERVICE?: Fetcher;\n  USERS_SERVICE?: Fetcher;\n}\n\n// User types\nexport interface User {\n  id: number;\n  username: string;\n  email: string;\n  full_name: string;\n  hashed_password?: string;\n  account_hash?: string;\n  is_active: boolean;\n  is_verified: boolean;\n  role: UserRole;\n  organization?: string;\n  department?: string;\n  bio?: string;\n  preferences?: Record<string, any>;\n  created_at: string;\n  updated_at: string;\n}\n\nexport type UserRole = 'admin' | 'analyst' | 'researcher' | 'viewer';\n\n// Authentication types\nexport interface JWTPayload {\n  sub: string; // user ID\n  email: string;\n  username: string;\n  role: UserRole;\n  exp: number;\n  iat: number;\n  jti?: string; // JWT ID for revocation\n  type?: string; // For refresh tokens\n}\n\nexport interface AuthSession {\n  userId: number;\n  username: string;\n  email: string;\n  role: UserRole;\n  token: string;\n  refreshToken?: string;\n  expiresAt: number;\n  createdAt: number;\n}\n\nexport interface AnonymousSession {\n  sessionHash: string;\n  createdAt: number;\n  lastAccessedAt: number;\n  data: Record<string, any>;\n}\n\n// Framework types\nexport type FrameworkType =\n  | 'swot'\n  | 'cog'\n  | 'pmesii_pt'\n  | 'dotmlpf'\n  | 'ach'\n  | 'deception_detection'\n  | 'behavioral_analysis'\n  | 'starbursting'\n  | 'causeway'\n  | 'dime'\n  | 'pest'\n  | 'vrio'\n  | 'stakeholder'\n  | 'trend'\n  | 'surveillance'\n  | 'fundamental_flow';\n\nexport type FrameworkStatus = 'draft' | 'in_progress' | 'completed' | 'archived';\n\nexport interface FrameworkSession {\n  id: number;\n  title: string;\n  description?: string;\n  framework_type: FrameworkType;\n  status: FrameworkStatus;\n  user_id: number;\n  data: string; // JSON string\n  config?: string; // JSON string\n  tags?: string; // JSON string\n  version: number;\n  ai_suggestions?: string; // JSON string\n  ai_analysis_count: number;\n  created_at: string;\n  updated_at: string;\n}\n\n// API Response types\nexport interface APIResponse<T = any> {\n  success: boolean;\n  data?: T;\n  error?: string;\n  message?: string;\n  metadata?: {\n    timestamp: number;\n    requestId: string;\n    processingTime?: number;\n  };\n}\n\nexport interface PaginatedResponse<T> {\n  items: T[];\n  total: number;\n  page: number;\n  pageSize: number;\n  totalPages: number;\n  hasNext: boolean;\n  hasPrevious: boolean;\n}\n\n// Request types\nexport interface AuthRequest extends Request {\n  user?: User;\n  session?: AuthSession;\n}\n\nexport interface PaginationParams {\n  page?: number;\n  pageSize?: number;\n  sortBy?: string;\n  sortOrder?: 'asc' | 'desc';\n}\n\n// Rate limiting\nexport interface RateLimitConfig {\n  windowMs: number;\n  maxRequests: number;\n  keyPrefix: string;\n}\n\nexport interface RateLimitInfo {\n  remaining: number;\n  reset: number;\n  total: number;\n}\n\n// Cache types\nexport interface CacheConfig {\n  ttl: number; // Time to live in seconds\n  key: string;\n  tags?: string[];\n}\n\n// Document processing\nexport interface DocumentExport {\n  format: 'pdf' | 'docx' | 'xlsx' | 'pptx' | 'json';\n  sessionId: number;\n  userId: number;\n  options?: {\n    includeAnalysis?: boolean;\n    includeCharts?: boolean;\n    includeMetadata?: boolean;\n    template?: string;\n  };\n}\n\n// Research job types\nexport type ResearchJobType =\n  | 'url_processing'\n  | 'web_scraping'\n  | 'document_processing'\n  | 'social_media_analysis'\n  | 'osint_collection'\n  | 'data_conversion';\n\nexport type ResearchJobStatus =\n  | 'pending'\n  | 'in_progress'\n  | 'completed'\n  | 'failed'\n  | 'cancelled';\n\nexport interface ResearchJob {\n  id: number;\n  job_type: ResearchJobType;\n  job_name?: string;\n  status: ResearchJobStatus;\n  input_data?: Record<string, any>;\n  result_data?: Record<string, any>;\n  error_message?: string;\n  retry_count: number;\n  max_retries: number;\n  progress_percentage: number;\n  current_step?: string;\n  started_at?: string;\n  completed_at?: string;\n  estimated_completion?: string;\n  user_id: number;\n  related_urls?: number[];\n  related_citations?: number[];\n  created_at: string;\n  updated_at: string;\n}\n\n// Citation types\nexport interface Citation {\n  id: number;\n  title: string;\n  authors?: string[];\n  publication_date?: string;\n  source_type: string;\n  source_name?: string;\n  url?: string;\n  doi?: string;\n  isbn?: string;\n  pmid?: string;\n  apa_citation?: string;\n  mla_citation?: string;\n  chicago_citation?: string;\n  bibtex_citation?: string;\n  citation_data?: Record<string, any>;\n  tags?: string[];\n  notes?: string;\n  reliability_rating?: number;\n  relevance_rating?: number;\n  user_id: number;\n  processed_url_id?: number;\n  created_at: string;\n  updated_at: string;\n}\n\n// URL processing types\nexport interface ProcessedUrl {\n  id: number;\n  url: string;\n  url_hash: string;\n  title?: string;\n  description?: string;\n  author?: string;\n  domain: string;\n  content_type?: string;\n  language?: string;\n  word_count?: number;\n  status_code?: number;\n  response_time?: number;\n  archived_url?: string;\n  wayback_url?: string;\n  additional_metadata?: Record<string, any>;\n  reliability_score?: number;\n  domain_reputation?: 'trusted' | 'neutral' | 'suspicious' | 'malicious';\n  processing_status: string;\n  error_message?: string;\n  user_id: number;\n  created_at: string;\n  updated_at: string;\n}\n\n// Error types\nexport class APIError extends Error {\n  constructor(\n    public status: number,\n    message: string,\n    public code?: string\n  ) {\n    super(message);\n    this.name = 'APIError';\n  }\n}\n\nexport class ValidationError extends APIError {\n  constructor(message: string, public fields?: Record<string, string[]>) {\n    super(400, message, 'VALIDATION_ERROR');\n    this.name = 'ValidationError';\n  }\n}\n\nexport class AuthenticationError extends APIError {\n  constructor(message = 'Authentication required') {\n    super(401, message, 'AUTHENTICATION_ERROR');\n    this.name = 'AuthenticationError';\n  }\n}\n\nexport class AuthorizationError extends APIError {\n  constructor(message = 'Insufficient permissions') {\n    super(403, message, 'AUTHORIZATION_ERROR');\n    this.name = 'AuthorizationError';\n  }\n}\n\nexport class NotFoundError extends APIError {\n  constructor(resource: string) {\n    super(404, `${resource} not found`, 'NOT_FOUND');\n    this.name = 'NotFoundError';\n  }\n}\n\nexport class RateLimitError extends APIError {\n  constructor(retryAfter: number) {\n    super(429, 'Too many requests', 'RATE_LIMIT_EXCEEDED');\n    this.name = 'RateLimitError';\n  }\n}\n\n// Utility types\nexport type Nullable<T> = T | null;\nexport type Optional<T> = T | undefined;\nexport type AsyncFunction<T = void> = () => Promise<T>;\n\n// Database query builder types\nexport interface QueryOptions {\n  where?: Record<string, any>;\n  orderBy?: {\n    column: string;\n    direction: 'asc' | 'desc';\n  };\n  limit?: number;\n  offset?: number;\n  include?: string[];\n}\n\n// Worker context extensions\nexport interface WorkerContext {\n  request: Request;\n  env: Env;\n  ctx: ExecutionContext;\n  requestId: string;\n  startTime: number;\n}", "// D1 Database utility functions for Cloudflare Workers\n\nimport { Env, QueryOptions, APIError } from './types';\n\n/**\n * Database utility class for D1 operations\n */\nexport class Database {\n  private db: D1Database;\n\n  constructor(db: D1Database) {\n    this.db = db;\n  }\n\n  /**\n   * Execute a prepared statement with parameters\n   */\n  async execute<T = any>(\n    sql: string,\n    params: any[] = []\n  ): Promise<D1Result<T>> {\n    try {\n      const stmt = this.db.prepare(sql);\n      if (params.length > 0) {\n        return await stmt.bind(...params).all();\n      }\n      return await stmt.all();\n    } catch (error) {\n      console.error('Database execute error:', error);\n      throw new APIError(500, 'Database operation failed');\n    }\n  }\n\n  /**\n   * Execute a single row query\n   */\n  async findOne<T = any>(\n    sql: string,\n    params: any[] = []\n  ): Promise<T | null> {\n    try {\n      const stmt = this.db.prepare(sql);\n      if (params.length > 0) {\n        return await stmt.bind(...params).first();\n      }\n      return await stmt.first();\n    } catch (error) {\n      console.error('Database findOne error:', error);\n      throw new APIError(500, 'Database operation failed');\n    }\n  }\n\n  /**\n   * Execute multiple queries in a transaction\n   */\n  async transaction<T = any>(\n    queries: Array<{ sql: string; params?: any[] }>\n  ): Promise<D1Result<T>[]> {\n    try {\n      const statements = queries.map(({ sql, params = [] }) => {\n        const stmt = this.db.prepare(sql);\n        return params.length > 0 ? stmt.bind(...params) : stmt;\n      });\n\n      return await this.db.batch(statements);\n    } catch (error) {\n      console.error('Database transaction error:', error);\n      throw new APIError(500, 'Transaction failed');\n    }\n  }\n\n  /**\n   * Insert a record and return the inserted ID\n   */\n  async insert(\n    table: string,\n    data: Record<string, any>\n  ): Promise<number> {\n    const columns = Object.keys(data);\n    const values = Object.values(data);\n    const placeholders = columns.map(() => '?').join(', ');\n\n    const sql = `INSERT INTO ${table} (${columns.join(', ')}) VALUES (${placeholders})`;\n\n    try {\n      const result = await this.db\n        .prepare(sql)\n        .bind(...values)\n        .run();\n\n      return result.meta.last_row_id as number;\n    } catch (error) {\n      console.error('Database insert error:', error);\n      throw new APIError(500, 'Insert operation failed');\n    }\n  }\n\n  /**\n   * Update records in a table\n   */\n  async update(\n    table: string,\n    data: Record<string, any>,\n    where: Record<string, any>\n  ): Promise<number> {\n    const setClause = Object.keys(data)\n      .map(key => `${key} = ?`)\n      .join(', ');\n\n    const whereClause = Object.keys(where)\n      .map(key => `${key} = ?`)\n      .join(' AND ');\n\n    const sql = `UPDATE ${table} SET ${setClause}, updated_at = datetime('now') WHERE ${whereClause}`;\n    const params = [...Object.values(data), ...Object.values(where)];\n\n    try {\n      const result = await this.db\n        .prepare(sql)\n        .bind(...params)\n        .run();\n\n      return result.meta.changes;\n    } catch (error) {\n      console.error('Database update error:', error);\n      throw new APIError(500, 'Update operation failed');\n    }\n  }\n\n  /**\n   * Delete records from a table\n   */\n  async delete(\n    table: string,\n    where: Record<string, any>\n  ): Promise<number> {\n    const whereClause = Object.keys(where)\n      .map(key => `${key} = ?`)\n      .join(' AND ');\n\n    const sql = `DELETE FROM ${table} WHERE ${whereClause}`;\n    const params = Object.values(where);\n\n    try {\n      const result = await this.db\n        .prepare(sql)\n        .bind(...params)\n        .run();\n\n      return result.meta.changes;\n    } catch (error) {\n      console.error('Database delete error:', error);\n      throw new APIError(500, 'Delete operation failed');\n    }\n  }\n\n  /**\n   * Build and execute a SELECT query with options\n   */\n  async find<T = any>(\n    table: string,\n    options: QueryOptions = {}\n  ): Promise<T[]> {\n    let sql = `SELECT * FROM ${table}`;\n    const params: any[] = [];\n\n    // Add WHERE clause\n    if (options.where && Object.keys(options.where).length > 0) {\n      const whereConditions = Object.keys(options.where)\n        .map(key => {\n          params.push(options.where![key]);\n          return `${key} = ?`;\n        })\n        .join(' AND ');\n      sql += ` WHERE ${whereConditions}`;\n    }\n\n    // Add ORDER BY clause\n    if (options.orderBy) {\n      sql += ` ORDER BY ${options.orderBy.column} ${options.orderBy.direction.toUpperCase()}`;\n    }\n\n    // Add LIMIT and OFFSET\n    if (options.limit) {\n      sql += ` LIMIT ${options.limit}`;\n    }\n    if (options.offset) {\n      sql += ` OFFSET ${options.offset}`;\n    }\n\n    try {\n      const result = await this.execute<T>(sql, params);\n      return result.results as T[];\n    } catch (error) {\n      console.error('Database find error:', error);\n      throw new APIError(500, 'Query operation failed');\n    }\n  }\n\n  /**\n   * Count records in a table\n   */\n  async count(\n    table: string,\n    where?: Record<string, any>\n  ): Promise<number> {\n    let sql = `SELECT COUNT(*) as count FROM ${table}`;\n    const params: any[] = [];\n\n    if (where && Object.keys(where).length > 0) {\n      const whereConditions = Object.keys(where)\n        .map(key => {\n          params.push(where[key]);\n          return `${key} = ?`;\n        })\n        .join(' AND ');\n      sql += ` WHERE ${whereConditions}`;\n    }\n\n    const result = await this.findOne<{ count: number }>(sql, params);\n    return result?.count || 0;\n  }\n\n  /**\n   * Check if a record exists\n   */\n  async exists(\n    table: string,\n    where: Record<string, any>\n  ): Promise<boolean> {\n    const count = await this.count(table, where);\n    return count > 0;\n  }\n\n  /**\n   * Paginate query results\n   */\n  async paginate<T = any>(\n    table: string,\n    page: number = 1,\n    pageSize: number = 20,\n    options: QueryOptions = {}\n  ) {\n    const offset = (page - 1) * pageSize;\n    const items = await this.find<T>(table, {\n      ...options,\n      limit: pageSize,\n      offset,\n    });\n\n    const total = await this.count(table, options.where);\n    const totalPages = Math.ceil(total / pageSize);\n\n    return {\n      items,\n      total,\n      page,\n      pageSize,\n      totalPages,\n      hasNext: page < totalPages,\n      hasPrevious: page > 1,\n    };\n  }\n}\n\n/**\n * Create a database instance from environment\n */\nexport function createDatabase(env: Env): Database {\n  return new Database(env.DB);\n}\n\n/**\n * Database migration runner\n */\nexport class Migration {\n  private db: Database;\n\n  constructor(db: Database) {\n    this.db = db;\n  }\n\n  /**\n   * Check if a migration has been applied\n   */\n  async isApplied(version: string): Promise<boolean> {\n    const result = await this.db.findOne(\n      'SELECT * FROM migration_history WHERE version = ?',\n      [version]\n    );\n    return result !== null;\n  }\n\n  /**\n   * Apply a migration\n   */\n  async apply(\n    version: string,\n    description: string,\n    sql: string\n  ): Promise<void> {\n    const startTime = Date.now();\n\n    try {\n      // Execute migration SQL\n      await this.db.execute(sql);\n\n      // Record migration\n      await this.db.insert('migration_history', {\n        version,\n        description,\n        execution_time_ms: Date.now() - startTime,\n      });\n\n      console.log(`Migration ${version} applied successfully`);\n    } catch (error) {\n      console.error(`Migration ${version} failed:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Run all pending migrations\n   */\n  async runPending(migrations: Array<{\n    version: string;\n    description: string;\n    sql: string;\n  }>): Promise<void> {\n    for (const migration of migrations) {\n      const isApplied = await this.isApplied(migration.version);\n      if (!isApplied) {\n        await this.apply(\n          migration.version,\n          migration.description,\n          migration.sql\n        );\n      }\n    }\n  }\n}\n\n/**\n * Database connection health check\n */\nexport async function checkDatabaseHealth(db: Database): Promise<boolean> {\n  try {\n    const result = await db.findOne('SELECT 1 as health');\n    return result !== null;\n  } catch (error) {\n    console.error('Database health check failed:', error);\n    return false;\n  }\n}\n\n/**\n * Utility to safely parse JSON from database\n */\nexport function parseJsonField<T = any>(\n  value: string | null | undefined,\n  defaultValue: T\n): T {\n  if (!value) return defaultValue;\n\n  try {\n    return JSON.parse(value);\n  } catch {\n    return defaultValue;\n  }\n}\n\n/**\n * Utility to stringify JSON for database storage\n */\nexport function stringifyJsonField(value: any): string {\n  if (typeof value === 'string') return value;\n  return JSON.stringify(value);\n}\n\n/**\n * Build a WHERE clause from conditions\n */\nexport function buildWhereClause(\n  conditions: Record<string, any>\n): { clause: string; params: any[] } {\n  const params: any[] = [];\n  const clauses: string[] = [];\n\n  for (const [key, value] of Object.entries(conditions)) {\n    if (value === null) {\n      clauses.push(`${key} IS NULL`);\n    } else if (value === undefined) {\n      // Skip undefined values\n      continue;\n    } else if (Array.isArray(value)) {\n      // Handle IN clause\n      const placeholders = value.map(() => '?').join(', ');\n      clauses.push(`${key} IN (${placeholders})`);\n      params.push(...value);\n    } else if (typeof value === 'object' && value !== null) {\n      // Handle special operators\n      if ('$gt' in value) {\n        clauses.push(`${key} > ?`);\n        params.push(value.$gt);\n      }\n      if ('$gte' in value) {\n        clauses.push(`${key} >= ?`);\n        params.push(value.$gte);\n      }\n      if ('$lt' in value) {\n        clauses.push(`${key} < ?`);\n        params.push(value.$lt);\n      }\n      if ('$lte' in value) {\n        clauses.push(`${key} <= ?`);\n        params.push(value.$lte);\n      }\n      if ('$ne' in value) {\n        clauses.push(`${key} != ?`);\n        params.push(value.$ne);\n      }\n      if ('$like' in value) {\n        clauses.push(`${key} LIKE ?`);\n        params.push(value.$like);\n      }\n    } else {\n      clauses.push(`${key} = ?`);\n      params.push(value);\n    }\n  }\n\n  return {\n    clause: clauses.length > 0 ? `WHERE ${clauses.join(' AND ')}` : '',\n    params,\n  };\n}", "/**\n * Authentication Middleware for Cloudflare Workers\n */\n\nimport { Env, AuthRequest, User, AuthenticationError } from '../../../shared/types';\nimport { verifyJWT } from '../../../shared/jwt';\nimport { createDatabase } from '../../../shared/database';\n\n/**\n * Authentication middleware\n */\nexport async function authMiddleware(\n  request: AuthRequest,\n  env: Env\n): Promise<AuthRequest | Response> {\n  try {\n    // Extract token from Authorization header\n    const authHeader = request.headers.get('Authorization');\n    if (!authHeader) {\n      // Check for anonymous session\n      const anonymousSession = await checkAnonymousSession(request, env);\n      if (anonymousSession) {\n        request.user = anonymousSession;\n        return request;\n      }\n\n      return createAuthErrorResponse('No authorization token provided');\n    }\n\n    // Parse Bearer token\n    const tokenMatch = authHeader.match(/^Bearer (.+)$/i);\n    if (!tokenMatch) {\n      return createAuthErrorResponse('Invalid authorization format');\n    }\n\n    const token = tokenMatch[1];\n\n    // Verify JWT token\n    const payload = await verifyJWT(token, env.JWT_SECRET);\n    if (!payload) {\n      return createAuthErrorResponse('Invalid or expired token');\n    }\n\n    // Check if token is blacklisted (for logout functionality)\n    const isBlacklisted = await isTokenBlacklisted(token, env);\n    if (isBlacklisted) {\n      return createAuthErrorResponse('Token has been revoked');\n    }\n\n    // Get user from database\n    const db = createDatabase(env);\n    const user = await db.findOne<User>(\n      'SELECT * FROM users WHERE id = ? AND is_active = 1',\n      [payload.sub]\n    );\n\n    if (!user) {\n      return createAuthErrorResponse('User not found or inactive');\n    }\n\n    // Attach user to request\n    request.user = user;\n    request.session = {\n      userId: user.id,\n      username: user.username,\n      email: user.email,\n      role: user.role,\n      token,\n      expiresAt: payload.exp * 1000,\n      createdAt: payload.iat * 1000,\n    };\n\n    // Update last activity in KV\n    await updateSessionActivity(token, env);\n\n    return request;\n  } catch (error) {\n    console.error('Auth middleware error:', error);\n    return createAuthErrorResponse('Authentication failed');\n  }\n}\n\n/**\n * Check for anonymous session using hash\n */\nasync function checkAnonymousSession(\n  request: Request,\n  env: Env\n): Promise<User | null> {\n  try {\n    // Check for anonymous session header\n    const sessionHash = request.headers.get('X-Anonymous-Session');\n    if (!sessionHash) return null;\n\n    // Validate session hash format (16 chars)\n    if (!/^[a-zA-Z0-9]{16}$/.test(sessionHash)) return null;\n\n    // Check if session exists in KV\n    const sessionData = await env.ANONYMOUS_SESSIONS.get(sessionHash);\n    if (!sessionData) return null;\n\n    const session = JSON.parse(sessionData);\n\n    // Check if session is expired (24 hours)\n    const expiryTime = 24 * 60 * 60 * 1000; // 24 hours\n    if (Date.now() - session.createdAt > expiryTime) {\n      await env.ANONYMOUS_SESSIONS.delete(sessionHash);\n      return null;\n    }\n\n    // Update last accessed time\n    session.lastAccessedAt = Date.now();\n    await env.ANONYMOUS_SESSIONS.put(\n      sessionHash,\n      JSON.stringify(session),\n      { expirationTtl: 86400 } // 24 hours\n    );\n\n    // Return pseudo-user for anonymous session\n    return {\n      id: 0,\n      username: `anonymous_${sessionHash.substring(0, 8)}`,\n      email: `${sessionHash}@anonymous.local`,\n      full_name: 'Anonymous User',\n      account_hash: sessionHash,\n      is_active: true,\n      is_verified: false,\n      role: 'viewer',\n      created_at: new Date(session.createdAt).toISOString(),\n      updated_at: new Date().toISOString(),\n    };\n  } catch (error) {\n    console.error('Anonymous session check error:', error);\n    return null;\n  }\n}\n\n/**\n * Check if token is blacklisted\n */\nasync function isTokenBlacklisted(\n  token: string,\n  env: Env\n): Promise<boolean> {\n  try {\n    const blacklistKey = `blacklist:${token}`;\n    const isBlacklisted = await env.SESSIONS.get(blacklistKey);\n    return isBlacklisted !== null;\n  } catch (error) {\n    console.error('Token blacklist check error:', error);\n    return false;\n  }\n}\n\n/**\n * Update session activity timestamp\n */\nasync function updateSessionActivity(\n  token: string,\n  env: Env\n): Promise<void> {\n  try {\n    const sessionKey = `session:${token}`;\n    const sessionData = await env.SESSIONS.get(sessionKey);\n\n    if (sessionData) {\n      const session = JSON.parse(sessionData);\n      session.lastActivity = Date.now();\n\n      // Update with TTL of 24 hours\n      await env.SESSIONS.put(\n        sessionKey,\n        JSON.stringify(session),\n        { expirationTtl: 86400 }\n      );\n    }\n  } catch (error) {\n    console.error('Session activity update error:', error);\n  }\n}\n\n/**\n * Create authentication error response\n */\nfunction createAuthErrorResponse(message: string): Response {\n  return new Response(\n    JSON.stringify({\n      error: 'Authentication Error',\n      message,\n      code: 'AUTH_REQUIRED',\n    }),\n    {\n      status: 401,\n      headers: {\n        'Content-Type': 'application/json',\n        'WWW-Authenticate': 'Bearer realm=\"ResearchToolsPy API\"',\n      },\n    }\n  );\n}\n\n/**\n * Check if user has required role\n */\nexport function requireRole(\n  user: User | undefined,\n  requiredRoles: string[]\n): Response | null {\n  if (!user) {\n    return createAuthErrorResponse('Authentication required');\n  }\n\n  if (!requiredRoles.includes(user.role)) {\n    return new Response(\n      JSON.stringify({\n        error: 'Authorization Error',\n        message: 'Insufficient permissions for this operation',\n        code: 'INSUFFICIENT_PERMISSIONS',\n        requiredRoles,\n        userRole: user.role,\n      }),\n      {\n        status: 403,\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      }\n    );\n  }\n\n  return null;\n}\n\n/**\n * Extract and validate API key\n */\nexport async function validateApiKey(\n  request: Request,\n  env: Env\n): Promise<User | null> {\n  try {\n    const apiKey = request.headers.get('X-API-Key');\n    if (!apiKey) return null;\n\n    const db = createDatabase(env);\n\n    // Hash the API key for comparison\n    const encoder = new TextEncoder();\n    const data = encoder.encode(apiKey);\n    const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n    const hashArray = Array.from(new Uint8Array(hashBuffer));\n    const keyHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n\n    // Find API key in database\n    const apiKeyRecord = await db.findOne(\n      `SELECT ak.*, u.*\n       FROM api_keys ak\n       JOIN users u ON ak.user_id = u.id\n       WHERE ak.key_hash = ? AND ak.is_active = 1 AND u.is_active = 1`,\n      [keyHash]\n    );\n\n    if (!apiKeyRecord) return null;\n\n    // Update usage count and last used\n    await db.execute(\n      `UPDATE api_keys\n       SET usage_count = usage_count + 1,\n           last_used_at = datetime('now')\n       WHERE id = ?`,\n      [apiKeyRecord.id]\n    );\n\n    // Return user associated with API key\n    return {\n      id: apiKeyRecord.user_id,\n      username: apiKeyRecord.username,\n      email: apiKeyRecord.email,\n      full_name: apiKeyRecord.full_name,\n      is_active: apiKeyRecord.is_active,\n      is_verified: apiKeyRecord.is_verified,\n      role: apiKeyRecord.role,\n      organization: apiKeyRecord.organization,\n      department: apiKeyRecord.department,\n      created_at: apiKeyRecord.created_at,\n      updated_at: apiKeyRecord.updated_at,\n    };\n  } catch (error) {\n    console.error('API key validation error:', error);\n    return null;\n  }\n}", "/**\n * Error Handler Middleware for Cloudflare Workers\n */\n\nimport { APIError, ValidationError } from '../../../shared/types';\n\ninterface ErrorResponse {\n  error: string;\n  message: string;\n  code?: string;\n  requestId?: string;\n  details?: any;\n  status?: number;\n}\n\n/**\n * Global error handler\n */\nexport function errorHandler(\n  error: Error | APIError,\n  requestId?: string\n): ErrorResponse {\n  console.error('Error:', {\n    name: error.name,\n    message: error.message,\n    stack: error.stack,\n    requestId,\n  });\n\n  // Handle known error types\n  if (error instanceof APIError) {\n    return {\n      error: error.name,\n      message: error.message,\n      code: error.code,\n      requestId,\n      status: error.status,\n    };\n  }\n\n  if (error instanceof ValidationError) {\n    return {\n      error: 'Validation Error',\n      message: error.message,\n      code: 'VALIDATION_FAILED',\n      details: error.fields,\n      requestId,\n      status: 400,\n    };\n  }\n\n  // Handle SyntaxError (usually JSON parsing errors)\n  if (error instanceof SyntaxError) {\n    return {\n      error: 'Invalid Request',\n      message: 'Invalid JSON in request body',\n      code: 'INVALID_JSON',\n      requestId,\n      status: 400,\n    };\n  }\n\n  // Handle TypeError\n  if (error instanceof TypeError) {\n    return {\n      error: 'Type Error',\n      message: 'Invalid data type in request',\n      code: 'TYPE_ERROR',\n      requestId,\n      status: 400,\n    };\n  }\n\n  // Handle D1 Database errors\n  if (error.message?.includes('D1_ERROR')) {\n    return {\n      error: 'Database Error',\n      message: 'A database error occurred',\n      code: 'DATABASE_ERROR',\n      requestId,\n      status: 500,\n    };\n  }\n\n  // Handle KV errors\n  if (error.message?.includes('KV namespace')) {\n    return {\n      error: 'Cache Error',\n      message: 'A caching error occurred',\n      code: 'CACHE_ERROR',\n      requestId,\n      status: 500,\n    };\n  }\n\n  // Handle R2 errors\n  if (error.message?.includes('R2')) {\n    return {\n      error: 'Storage Error',\n      message: 'A storage error occurred',\n      code: 'STORAGE_ERROR',\n      requestId,\n      status: 500,\n    };\n  }\n\n  // Default error response\n  return {\n    error: 'Internal Server Error',\n    message: 'An unexpected error occurred',\n    code: 'INTERNAL_ERROR',\n    requestId,\n    status: 500,\n  };\n}\n\n/**\n * Create error response\n */\nexport function createErrorResponse(\n  status: number,\n  message: string,\n  code?: string,\n  details?: any,\n  requestId?: string\n): Response {\n  const errorBody: ErrorResponse = {\n    error: getErrorName(status),\n    message,\n    code: code || getErrorCode(status),\n    requestId,\n    details,\n  };\n\n  return new Response(JSON.stringify(errorBody), {\n    status,\n    headers: {\n      'Content-Type': 'application/json',\n      ...(requestId ? { 'X-Request-ID': requestId } : {}),\n    },\n  });\n}\n\n/**\n * Get error name from status code\n */\nfunction getErrorName(status: number): string {\n  const errorNames: Record<number, string> = {\n    400: 'Bad Request',\n    401: 'Unauthorized',\n    403: 'Forbidden',\n    404: 'Not Found',\n    405: 'Method Not Allowed',\n    409: 'Conflict',\n    422: 'Unprocessable Entity',\n    429: 'Too Many Requests',\n    500: 'Internal Server Error',\n    502: 'Bad Gateway',\n    503: 'Service Unavailable',\n    504: 'Gateway Timeout',\n  };\n\n  return errorNames[status] || 'Error';\n}\n\n/**\n * Get error code from status code\n */\nfunction getErrorCode(status: number): string {\n  const errorCodes: Record<number, string> = {\n    400: 'BAD_REQUEST',\n    401: 'UNAUTHORIZED',\n    403: 'FORBIDDEN',\n    404: 'NOT_FOUND',\n    405: 'METHOD_NOT_ALLOWED',\n    409: 'CONFLICT',\n    422: 'UNPROCESSABLE_ENTITY',\n    429: 'RATE_LIMIT_EXCEEDED',\n    500: 'INTERNAL_ERROR',\n    502: 'BAD_GATEWAY',\n    503: 'SERVICE_UNAVAILABLE',\n    504: 'GATEWAY_TIMEOUT',\n  };\n\n  return errorCodes[status] || 'UNKNOWN_ERROR';\n}\n\n/**\n * Wrap async handler with error handling\n */\nexport function withErrorHandling<T extends any[], R>(\n  handler: (...args: T) => Promise<R>\n): (...args: T) => Promise<R | Response> {\n  return async (...args: T) => {\n    try {\n      return await handler(...args);\n    } catch (error) {\n      const requestId = (args[0] as any)?.requestId;\n      const errorResponse = errorHandler(error as Error, requestId);\n      return createErrorResponse(\n        errorResponse.status || 500,\n        errorResponse.message,\n        errorResponse.code,\n        errorResponse.details,\n        requestId\n      );\n    }\n  };\n}\n\n/**\n * Validate request body against a schema\n */\nexport function validateRequestBody(\n  body: any,\n  schema: Record<string, any>\n): ValidationError | null {\n  const errors: Record<string, string[]> = {};\n\n  for (const [field, rules] of Object.entries(schema)) {\n    const value = body[field];\n    const fieldErrors: string[] = [];\n\n    // Required check\n    if (rules.required && (value === undefined || value === null || value === '')) {\n      fieldErrors.push(`${field} is required`);\n    }\n\n    // Type check\n    if (value !== undefined && value !== null && rules.type) {\n      const actualType = Array.isArray(value) ? 'array' : typeof value;\n      if (actualType !== rules.type) {\n        fieldErrors.push(`${field} must be of type ${rules.type}`);\n      }\n    }\n\n    // Min length check\n    if (rules.minLength && typeof value === 'string' && value.length < rules.minLength) {\n      fieldErrors.push(`${field} must be at least ${rules.minLength} characters`);\n    }\n\n    // Max length check\n    if (rules.maxLength && typeof value === 'string' && value.length > rules.maxLength) {\n      fieldErrors.push(`${field} must be at most ${rules.maxLength} characters`);\n    }\n\n    // Pattern check\n    if (rules.pattern && typeof value === 'string' && !rules.pattern.test(value)) {\n      fieldErrors.push(`${field} has invalid format`);\n    }\n\n    // Custom validation\n    if (rules.validate && typeof rules.validate === 'function') {\n      const customError = rules.validate(value);\n      if (customError) {\n        fieldErrors.push(customError);\n      }\n    }\n\n    if (fieldErrors.length > 0) {\n      errors[field] = fieldErrors;\n    }\n  }\n\n  if (Object.keys(errors).length > 0) {\n    return new ValidationError('Validation failed', errors);\n  }\n\n  return null;\n}", "/**\n * Authentication routes handler\n * Handles login, registration, token refresh, and anonymous sessions\n */\n\nimport { Env, AuthRequest, User } from '../../../shared/types';\nimport { createDatabase } from '../../../shared/database';\nimport { createJWT, createRefreshToken, verifyJWT, hashPassword, verifyPassword } from '../../../shared/jwt';\nimport { createErrorResponse, validateRequestBody } from '../middleware/errorHandler';\n\n/**\n * Auth router - handles all /api/v1/auth/* routes\n */\nexport async function authRouter(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  const url = new URL(request.url);\n  const path = url.pathname;\n\n  // Route to specific auth handler\n  switch (true) {\n    case path === '/api/v1/auth/login' && request.method === 'POST':\n      return handleLogin(request, env);\n\n    case path === '/api/v1/auth/register' && request.method === 'POST':\n      return handleRegister(request, env);\n\n    case path === '/api/v1/auth/refresh' && request.method === 'POST':\n      return handleRefreshToken(request, env);\n\n    case path === '/api/v1/auth/logout' && request.method === 'POST':\n      return handleLogout(request, env);\n\n    case path === '/api/v1/auth/anonymous' && request.method === 'POST':\n      return handleAnonymousSession(request, env);\n\n    case path === '/api/v1/auth/verify-email' && request.method === 'POST':\n      return handleEmailVerification(request, env);\n\n    case path === '/api/v1/auth/forgot-password' && request.method === 'POST':\n      return handleForgotPassword(request, env);\n\n    case path === '/api/v1/auth/reset-password' && request.method === 'POST':\n      return handleResetPassword(request, env);\n\n    case path === '/api/v1/auth/me' && request.method === 'GET':\n      return handleGetCurrentUser(request, env);\n\n    case path === '/api/v1/auth/me' && request.method === 'PATCH':\n      return handleUpdateCurrentUser(request, env);\n\n    default:\n      return createErrorResponse(404, 'Auth endpoint not found', 'AUTH_ENDPOINT_NOT_FOUND');\n  }\n}\n\n/**\n * Handle user login\n */\nasync function handleLogin(request: Request, env: Env): Promise<Response> {\n  try {\n    // Parse request body\n    let body: any;\n    try {\n      body = await request.json();\n    } catch {\n      return createErrorResponse(400, 'Invalid JSON body', 'INVALID_JSON');\n    }\n\n    // Validate input\n    const validation = validateRequestBody(body, {\n      email: { required: true, type: 'string', pattern: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/ },\n      password: { required: true, type: 'string', minLength: 6 },\n    });\n\n    if (validation) {\n      return createErrorResponse(400, 'Validation failed', 'VALIDATION_ERROR', validation.fields);\n    }\n\n    const { email, password } = body;\n    const db = createDatabase(env);\n\n    // Find user by email\n    const user = await db.findOne<User & { hashed_password: string }>(\n      'SELECT * FROM users WHERE email = ?',\n      [email.toLowerCase()]\n    );\n\n    if (!user) {\n      // Log failed attempt\n      await logAuthAttempt(null, email, false, request, env, 'User not found');\n      return createErrorResponse(401, 'Invalid email or password', 'INVALID_CREDENTIALS');\n    }\n\n    // Verify password\n    const [hash, salt] = user.hashed_password.split(':');\n    const isValidPassword = await verifyPassword(password, hash, salt);\n\n    if (!isValidPassword) {\n      // Log failed attempt\n      await logAuthAttempt(user.id, email, false, request, env, 'Invalid password');\n      return createErrorResponse(401, 'Invalid email or password', 'INVALID_CREDENTIALS');\n    }\n\n    // Check if user is active\n    if (!user.is_active) {\n      await logAuthAttempt(user.id, email, false, request, env, 'User inactive');\n      return createErrorResponse(403, 'Account is inactive', 'ACCOUNT_INACTIVE');\n    }\n\n    // Generate tokens\n    const accessToken = await createJWT(\n      {\n        sub: user.id.toString(),\n        email: user.email,\n        username: user.username,\n        role: user.role,\n      },\n      env.JWT_SECRET,\n      3600 // 1 hour\n    );\n\n    const refreshToken = await createRefreshToken(user.id.toString(), env.JWT_SECRET);\n\n    // Store session in KV\n    const sessionData = {\n      userId: user.id,\n      username: user.username,\n      email: user.email,\n      role: user.role,\n      createdAt: Date.now(),\n      lastActivity: Date.now(),\n    };\n\n    await env.SESSIONS.put(\n      `session:${accessToken}`,\n      JSON.stringify(sessionData),\n      { expirationTtl: 86400 } // 24 hours\n    );\n\n    // Log successful attempt\n    await logAuthAttempt(user.id, email, true, request, env);\n\n    // Return user data and tokens\n    return new Response(\n      JSON.stringify({\n        success: true,\n        user: {\n          id: user.id,\n          username: user.username,\n          email: user.email,\n          full_name: user.full_name,\n          role: user.role,\n          is_verified: user.is_verified,\n          organization: user.organization,\n          department: user.department,\n        },\n        tokens: {\n          access_token: accessToken,\n          refresh_token: refreshToken,\n          expires_in: 3600,\n          token_type: 'Bearer',\n        },\n      }),\n      {\n        status: 200,\n        headers: { 'Content-Type': 'application/json' },\n      }\n    );\n  } catch (error) {\n    console.error('Login error:', error);\n    return createErrorResponse(500, 'Login failed', 'LOGIN_ERROR');\n  }\n}\n\n/**\n * Handle user registration\n */\nasync function handleRegister(request: Request, env: Env): Promise<Response> {\n  try {\n    // Parse request body\n    let body: any;\n    try {\n      body = await request.json();\n    } catch {\n      return createErrorResponse(400, 'Invalid JSON body', 'INVALID_JSON');\n    }\n\n    // Validate input\n    const validation = validateRequestBody(body, {\n      email: { required: true, type: 'string', pattern: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/ },\n      username: { required: true, type: 'string', minLength: 3, maxLength: 50 },\n      password: { required: true, type: 'string', minLength: 8 },\n      full_name: { required: true, type: 'string', minLength: 2 },\n    });\n\n    if (validation) {\n      return createErrorResponse(400, 'Validation failed', 'VALIDATION_ERROR', validation.fields);\n    }\n\n    const { email, username, password, full_name, organization, department } = body;\n    const db = createDatabase(env);\n\n    // Check if email exists\n    const existingEmail = await db.exists('users', { email: email.toLowerCase() });\n    if (existingEmail) {\n      return createErrorResponse(409, 'Email already registered', 'EMAIL_EXISTS');\n    }\n\n    // Check if username exists\n    const existingUsername = await db.exists('users', { username: username.toLowerCase() });\n    if (existingUsername) {\n      return createErrorResponse(409, 'Username already taken', 'USERNAME_EXISTS');\n    }\n\n    // Hash password\n    const { hash, salt } = await hashPassword(password);\n    const hashedPassword = `${hash}:${salt}`;\n\n    // Generate account hash for anonymous migration\n    const accountHash = generateAccountHash();\n\n    // Insert user\n    const userId = await db.insert('users', {\n      email: email.toLowerCase(),\n      username: username.toLowerCase(),\n      full_name,\n      hashed_password: hashedPassword,\n      account_hash: accountHash,\n      is_active: 1,\n      is_verified: 0,\n      role: 'researcher',\n      organization,\n      department,\n    });\n\n    // Generate tokens\n    const accessToken = await createJWT(\n      {\n        sub: userId.toString(),\n        email: email.toLowerCase(),\n        username: username.toLowerCase(),\n        role: 'researcher',\n      },\n      env.JWT_SECRET,\n      3600\n    );\n\n    const refreshToken = await createRefreshToken(userId.toString(), env.JWT_SECRET);\n\n    // Store session\n    const sessionData = {\n      userId,\n      username: username.toLowerCase(),\n      email: email.toLowerCase(),\n      role: 'researcher',\n      createdAt: Date.now(),\n      lastActivity: Date.now(),\n    };\n\n    await env.SESSIONS.put(\n      `session:${accessToken}`,\n      JSON.stringify(sessionData),\n      { expirationTtl: 86400 }\n    );\n\n    // TODO: Send verification email\n\n    return new Response(\n      JSON.stringify({\n        success: true,\n        user: {\n          id: userId,\n          username: username.toLowerCase(),\n          email: email.toLowerCase(),\n          full_name,\n          role: 'researcher',\n          is_verified: false,\n          account_hash: accountHash,\n        },\n        tokens: {\n          access_token: accessToken,\n          refresh_token: refreshToken,\n          expires_in: 3600,\n          token_type: 'Bearer',\n        },\n      }),\n      {\n        status: 201,\n        headers: { 'Content-Type': 'application/json' },\n      }\n    );\n  } catch (error) {\n    console.error('Registration error:', error);\n    return createErrorResponse(500, 'Registration failed', 'REGISTRATION_ERROR');\n  }\n}\n\n/**\n * Handle token refresh\n */\nasync function handleRefreshToken(request: Request, env: Env): Promise<Response> {\n  try {\n    let body: any;\n    try {\n      body = await request.json();\n    } catch {\n      return createErrorResponse(400, 'Invalid JSON body', 'INVALID_JSON');\n    }\n\n    const { refresh_token } = body;\n    if (!refresh_token) {\n      return createErrorResponse(400, 'Refresh token required', 'REFRESH_TOKEN_REQUIRED');\n    }\n\n    // Verify refresh token\n    const payload = await verifyJWT(refresh_token, env.JWT_SECRET);\n    if (!payload || payload.type !== 'refresh') {\n      return createErrorResponse(401, 'Invalid refresh token', 'INVALID_REFRESH_TOKEN');\n    }\n\n    const db = createDatabase(env);\n\n    // Get user\n    const user = await db.findOne<User>(\n      'SELECT * FROM users WHERE id = ? AND is_active = 1',\n      [payload.sub]\n    );\n\n    if (!user) {\n      return createErrorResponse(401, 'User not found or inactive', 'USER_NOT_FOUND');\n    }\n\n    // Generate new access token\n    const accessToken = await createJWT(\n      {\n        sub: user.id.toString(),\n        email: user.email,\n        username: user.username,\n        role: user.role,\n      },\n      env.JWT_SECRET,\n      3600\n    );\n\n    // Update session\n    const sessionData = {\n      userId: user.id,\n      username: user.username,\n      email: user.email,\n      role: user.role,\n      createdAt: Date.now(),\n      lastActivity: Date.now(),\n    };\n\n    await env.SESSIONS.put(\n      `session:${accessToken}`,\n      JSON.stringify(sessionData),\n      { expirationTtl: 86400 }\n    );\n\n    return new Response(\n      JSON.stringify({\n        success: true,\n        tokens: {\n          access_token: accessToken,\n          refresh_token,\n          expires_in: 3600,\n          token_type: 'Bearer',\n        },\n      }),\n      {\n        status: 200,\n        headers: { 'Content-Type': 'application/json' },\n      }\n    );\n  } catch (error) {\n    console.error('Token refresh error:', error);\n    return createErrorResponse(500, 'Token refresh failed', 'TOKEN_REFRESH_ERROR');\n  }\n}\n\n/**\n * Handle logout\n */\nasync function handleLogout(request: AuthRequest, env: Env): Promise<Response> {\n  try {\n    const authHeader = request.headers.get('Authorization');\n    if (!authHeader) {\n      return new Response(JSON.stringify({ success: true }), {\n        status: 200,\n        headers: { 'Content-Type': 'application/json' },\n      });\n    }\n\n    const token = authHeader.replace('Bearer ', '');\n\n    // Blacklist the token\n    await env.SESSIONS.put(\n      `blacklist:${token}`,\n      '1',\n      { expirationTtl: 86400 } // Keep blacklisted for 24 hours\n    );\n\n    // Delete session\n    await env.SESSIONS.delete(`session:${token}`);\n\n    return new Response(\n      JSON.stringify({ success: true, message: 'Logged out successfully' }),\n      {\n        status: 200,\n        headers: { 'Content-Type': 'application/json' },\n      }\n    );\n  } catch (error) {\n    console.error('Logout error:', error);\n    return createErrorResponse(500, 'Logout failed', 'LOGOUT_ERROR');\n  }\n}\n\n/**\n * Handle anonymous session creation\n */\nasync function handleAnonymousSession(request: Request, env: Env): Promise<Response> {\n  try {\n    // Generate anonymous session hash\n    const sessionHash = generateAccountHash();\n\n    // Create session data\n    const sessionData = {\n      sessionHash,\n      createdAt: Date.now(),\n      lastAccessedAt: Date.now(),\n      data: {},\n    };\n\n    // Store in KV\n    await env.ANONYMOUS_SESSIONS.put(\n      sessionHash,\n      JSON.stringify(sessionData),\n      { expirationTtl: 86400 } // 24 hours\n    );\n\n    return new Response(\n      JSON.stringify({\n        success: true,\n        session: {\n          hash: sessionHash,\n          expires_in: 86400,\n        },\n      }),\n      {\n        status: 201,\n        headers: { 'Content-Type': 'application/json' },\n      }\n    );\n  } catch (error) {\n    console.error('Anonymous session error:', error);\n    return createErrorResponse(500, 'Failed to create anonymous session', 'ANONYMOUS_SESSION_ERROR');\n  }\n}\n\n/**\n * Handle email verification\n */\nasync function handleEmailVerification(request: Request, env: Env): Promise<Response> {\n  // TODO: Implement email verification\n  return createErrorResponse(501, 'Email verification not implemented', 'NOT_IMPLEMENTED');\n}\n\n/**\n * Handle forgot password\n */\nasync function handleForgotPassword(request: Request, env: Env): Promise<Response> {\n  // TODO: Implement forgot password\n  return createErrorResponse(501, 'Forgot password not implemented', 'NOT_IMPLEMENTED');\n}\n\n/**\n * Handle reset password\n */\nasync function handleResetPassword(request: Request, env: Env): Promise<Response> {\n  // TODO: Implement reset password\n  return createErrorResponse(501, 'Reset password not implemented', 'NOT_IMPLEMENTED');\n}\n\n/**\n * Get current user\n */\nasync function handleGetCurrentUser(request: AuthRequest, env: Env): Promise<Response> {\n  if (!request.user) {\n    return createErrorResponse(401, 'Authentication required', 'AUTH_REQUIRED');\n  }\n\n  return new Response(\n    JSON.stringify({\n      success: true,\n      user: {\n        id: request.user.id,\n        username: request.user.username,\n        email: request.user.email,\n        full_name: request.user.full_name,\n        role: request.user.role,\n        is_verified: request.user.is_verified,\n        organization: request.user.organization,\n        department: request.user.department,\n        bio: request.user.bio,\n        created_at: request.user.created_at,\n      },\n    }),\n    {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' },\n    }\n  );\n}\n\n/**\n * Update current user\n */\nasync function handleUpdateCurrentUser(request: AuthRequest, env: Env): Promise<Response> {\n  if (!request.user) {\n    return createErrorResponse(401, 'Authentication required', 'AUTH_REQUIRED');\n  }\n\n  try {\n    let body: any;\n    try {\n      body = await request.json();\n    } catch {\n      return createErrorResponse(400, 'Invalid JSON body', 'INVALID_JSON');\n    }\n\n    const db = createDatabase(env);\n    const updates: Record<string, any> = {};\n\n    // Only allow updating certain fields\n    const allowedFields = ['full_name', 'bio', 'organization', 'department', 'preferences'];\n    for (const field of allowedFields) {\n      if (body[field] !== undefined) {\n        updates[field] = field === 'preferences' ? JSON.stringify(body[field]) : body[field];\n      }\n    }\n\n    if (Object.keys(updates).length === 0) {\n      return createErrorResponse(400, 'No valid fields to update', 'NO_UPDATES');\n    }\n\n    await db.update('users', updates, { id: request.user.id });\n\n    // Get updated user\n    const updatedUser = await db.findOne<User>(\n      'SELECT * FROM users WHERE id = ?',\n      [request.user.id]\n    );\n\n    return new Response(\n      JSON.stringify({\n        success: true,\n        user: {\n          id: updatedUser.id,\n          username: updatedUser.username,\n          email: updatedUser.email,\n          full_name: updatedUser.full_name,\n          role: updatedUser.role,\n          is_verified: updatedUser.is_verified,\n          organization: updatedUser.organization,\n          department: updatedUser.department,\n          bio: updatedUser.bio,\n        },\n      }),\n      {\n        status: 200,\n        headers: { 'Content-Type': 'application/json' },\n      }\n    );\n  } catch (error) {\n    console.error('Update user error:', error);\n    return createErrorResponse(500, 'Failed to update user', 'UPDATE_USER_ERROR');\n  }\n}\n\n/**\n * Generate account hash for anonymous users\n */\nfunction generateAccountHash(): string {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let hash = '';\n  const array = new Uint8Array(16);\n  crypto.getRandomValues(array);\n\n  for (let i = 0; i < 16; i++) {\n    hash += chars[array[i] % chars.length];\n  }\n\n  return hash;\n}\n\n/**\n * Log authentication attempt\n */\nasync function logAuthAttempt(\n  userId: number | null,\n  email: string,\n  success: boolean,\n  request: Request,\n  env: Env,\n  errorMessage?: string\n): Promise<void> {\n  try {\n    const db = createDatabase(env);\n    await db.insert('auth_logs', {\n      user_id: userId,\n      account_hash: email,\n      success: success ? 1 : 0,\n      ip_address: request.headers.get('CF-Connecting-IP') ||\n                  request.headers.get('X-Forwarded-For')?.split(',')[0] ||\n                  null,\n      user_agent: request.headers.get('User-Agent'),\n      error_message: errorMessage,\n      login_at: new Date().toISOString(),\n    });\n  } catch (error) {\n    console.error('Failed to log auth attempt:', error);\n  }\n}", "/**\n * AI Integration for SWOT Framework\n * Handles AI-powered suggestions, validation, and analysis\n */\n\nimport { Env } from '../../../shared/types';\nimport { SWOTData, AISuggestions, AIValidation, ValidationIssue } from './types';\n\n/**\n * Generate AI suggestions for SWOT analysis\n */\nexport async function generateAISuggestions(\n  swotData: SWOTData,\n  env: Env\n): Promise<AISuggestions | null> {\n  if (!env.OPENAI_API_KEY) {\n    console.warn('OpenAI API key not configured');\n    return null;\n  }\n\n  try {\n    const prompt = constructSuggestionsPrompt(swotData);\n    const response = await callOpenAI(prompt, env.OPENAI_API_KEY);\n\n    if (!response) {\n      return null;\n    }\n\n    return parseSuggestionsResponse(response);\n  } catch (error) {\n    console.error('AI suggestions error:', error);\n    return null;\n  }\n}\n\n/**\n * Validate SWOT analysis with AI\n */\nexport async function validateWithAI(\n  swotData: SWOTData,\n  env: Env\n): Promise<AIValidation> {\n  if (!env.OPENAI_API_KEY) {\n    return performBasicValidation(swotData);\n  }\n\n  try {\n    const prompt = constructValidationPrompt(swotData);\n    const response = await callOpenAI(prompt, env.OPENAI_API_KEY);\n\n    if (!response) {\n      return performBasicValidation(swotData);\n    }\n\n    return parseValidationResponse(response);\n  } catch (error) {\n    console.error('AI validation error:', error);\n    return performBasicValidation(swotData);\n  }\n}\n\n/**\n * Construct prompt for AI suggestions\n */\nfunction constructSuggestionsPrompt(swotData: SWOTData): string {\n  return `You are a strategic business analyst expert in SWOT analysis. Analyze the following SWOT framework and provide additional suggestions:\n\nObjective: ${swotData.objective}\nContext: ${swotData.context || 'Not specified'}\n\nCurrent Analysis:\nSTRENGTHS:\n${swotData.strengths.map(s => `- ${s}`).join('\\n') || '- None specified'}\n\nWEAKNESSES:\n${swotData.weaknesses.map(w => `- ${w}`).join('\\n') || '- None specified'}\n\nOPPORTUNITIES:\n${swotData.opportunities.map(o => `- ${o}`).join('\\n') || '- None specified'}\n\nTHREATS:\n${swotData.threats.map(t => `- ${t}`).join('\\n') || '- None specified'}\n\nPlease provide:\n1. 3-5 additional strengths that haven't been identified\n2. 3-5 additional weaknesses to consider\n3. 3-5 additional opportunities to explore\n4. 3-5 additional threats to monitor\n5. 2-3 key strategic insights based on the analysis\n6. 2-3 actionable recommendations\n\nRespond in JSON format:\n{\n  \"strengths\": [\"...\"],\n  \"weaknesses\": [\"...\"],\n  \"opportunities\": [\"...\"],\n  \"threats\": [\"...\"],\n  \"insights\": [\"...\"],\n  \"recommendations\": [\"...\"],\n  \"confidence\": 0.0-1.0\n}`;\n}\n\n/**\n * Construct prompt for AI validation\n */\nfunction constructValidationPrompt(swotData: SWOTData): string {\n  return `You are a strategic analysis expert. Validate the following SWOT analysis for completeness, consistency, and quality:\n\nObjective: ${swotData.objective}\nContext: ${swotData.context || 'Not specified'}\n\nSTRENGTHS (${swotData.strengths.length} items):\n${swotData.strengths.map(s => `- ${s}`).join('\\n') || '- None'}\n\nWEAKNESSES (${swotData.weaknesses.length} items):\n${swotData.weaknesses.map(w => `- ${w}`).join('\\n') || '- None'}\n\nOPPORTUNITIES (${swotData.opportunities.length} items):\n${swotData.opportunities.map(o => `- ${o}`).join('\\n') || '- None'}\n\nTHREATS (${swotData.threats.length} items):\n${swotData.threats.map(t => `- ${t}`).join('\\n') || '- None'}\n\nEvaluate and provide:\n1. Completeness score (0-100): Are all key areas covered?\n2. Consistency score (0-100): Are items properly categorized and non-contradictory?\n3. Quality score (0-100): Are items specific, actionable, and relevant?\n4. List any issues found (missing areas, vague items, contradictions, duplicates)\n5. Suggestions for improvement\n\nRespond in JSON format:\n{\n  \"is_valid\": boolean,\n  \"completeness_score\": 0-100,\n  \"consistency_score\": 0-100,\n  \"quality_score\": 0-100,\n  \"issues\": [\n    {\n      \"category\": \"strengths|weaknesses|opportunities|threats\",\n      \"issue_type\": \"missing|vague|contradictory|duplicate\",\n      \"description\": \"...\",\n      \"severity\": \"low|medium|high\"\n    }\n  ],\n  \"suggestions\": [\"...\"]\n}`;\n}\n\n/**\n * Call OpenAI API\n */\nasync function callOpenAI(\n  prompt: string,\n  apiKey: string\n): Promise<string | null> {\n  try {\n    const response = await fetch('https://api.openai.com/v1/chat/completions', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${apiKey}`,\n      },\n      body: JSON.stringify({\n        model: 'gpt-4o-mini',\n        messages: [\n          {\n            role: 'system',\n            content: 'You are a strategic business analyst expert in SWOT analysis. Always respond with valid JSON.',\n          },\n          {\n            role: 'user',\n            content: prompt,\n          },\n        ],\n        temperature: 0.7,\n        max_tokens: 1000,\n        response_format: { type: 'json_object' },\n      }),\n    });\n\n    if (!response.ok) {\n      console.error('OpenAI API error:', response.status, response.statusText);\n      return null;\n    }\n\n    const data = await response.json();\n    return data.choices[0]?.message?.content || null;\n  } catch (error) {\n    console.error('OpenAI API call error:', error);\n    return null;\n  }\n}\n\n/**\n * Parse AI suggestions response\n */\nfunction parseSuggestionsResponse(response: string): AISuggestions {\n  try {\n    const parsed = JSON.parse(response);\n    return {\n      strengths: parsed.strengths || [],\n      weaknesses: parsed.weaknesses || [],\n      opportunities: parsed.opportunities || [],\n      threats: parsed.threats || [],\n      insights: parsed.insights || [],\n      recommendations: parsed.recommendations || [],\n      confidence: parsed.confidence || 0.8,\n      generated_at: new Date().toISOString(),\n    };\n  } catch (error) {\n    console.error('Failed to parse AI suggestions:', error);\n    return {\n      strengths: [],\n      weaknesses: [],\n      opportunities: [],\n      threats: [],\n      insights: [],\n      recommendations: [],\n      confidence: 0,\n      generated_at: new Date().toISOString(),\n    };\n  }\n}\n\n/**\n * Parse AI validation response\n */\nfunction parseValidationResponse(response: string): AIValidation {\n  try {\n    const parsed = JSON.parse(response);\n    return {\n      is_valid: parsed.is_valid ?? true,\n      completeness_score: parsed.completeness_score || 0,\n      consistency_score: parsed.consistency_score || 0,\n      quality_score: parsed.quality_score || 0,\n      issues: parsed.issues || [],\n      suggestions: parsed.suggestions || [],\n    };\n  } catch (error) {\n    console.error('Failed to parse AI validation:', error);\n    return performBasicValidation({ strengths: [], weaknesses: [], opportunities: [], threats: [] } as SWOTData);\n  }\n}\n\n/**\n * Perform basic validation without AI\n */\nfunction performBasicValidation(swotData: SWOTData): AIValidation {\n  const issues: ValidationIssue[] = [];\n  const suggestions: string[] = [];\n\n  // Check completeness\n  const totalItems =\n    swotData.strengths.length +\n    swotData.weaknesses.length +\n    swotData.opportunities.length +\n    swotData.threats.length;\n\n  if (swotData.strengths.length === 0) {\n    issues.push({\n      category: 'strengths',\n      issue_type: 'missing',\n      description: 'No strengths identified',\n      severity: 'high',\n    });\n    suggestions.push('Add at least 3-5 organizational or project strengths');\n  }\n\n  if (swotData.weaknesses.length === 0) {\n    issues.push({\n      category: 'weaknesses',\n      issue_type: 'missing',\n      description: 'No weaknesses identified',\n      severity: 'high',\n    });\n    suggestions.push('Identify 3-5 areas for improvement or limitations');\n  }\n\n  if (swotData.opportunities.length === 0) {\n    issues.push({\n      category: 'opportunities',\n      issue_type: 'missing',\n      description: 'No opportunities identified',\n      severity: 'high',\n    });\n    suggestions.push('Explore 3-5 external opportunities or market trends');\n  }\n\n  if (swotData.threats.length === 0) {\n    issues.push({\n      category: 'threats',\n      issue_type: 'missing',\n      description: 'No threats identified',\n      severity: 'high',\n    });\n    suggestions.push('Consider 3-5 external risks or challenges');\n  }\n\n  // Check for vague items\n  const checkVague = (items: string[], category: 'strengths' | 'weaknesses' | 'opportunities' | 'threats') => {\n    items.forEach(item => {\n      if (item.length < 10) {\n        issues.push({\n          category,\n          issue_type: 'vague',\n          description: `Item too brief: \"${item}\"`,\n          severity: 'low',\n        });\n      }\n    });\n  };\n\n  checkVague(swotData.strengths, 'strengths');\n  checkVague(swotData.weaknesses, 'weaknesses');\n  checkVague(swotData.opportunities, 'opportunities');\n  checkVague(swotData.threats, 'threats');\n\n  // Calculate scores\n  const completenessScore = Math.min(100, (totalItems / 16) * 100); // Expecting ~4 items per category\n  const hasIssues = issues.filter(i => i.severity === 'high').length > 0;\n  const consistencyScore = hasIssues ? 60 : 85;\n  const qualityScore = Math.max(0, 100 - (issues.length * 10));\n\n  return {\n    is_valid: !hasIssues,\n    completeness_score: Math.round(completenessScore),\n    consistency_score: consistencyScore,\n    quality_score: Math.round(qualityScore),\n    issues,\n    suggestions,\n  };\n}\n\n/**\n * Generate industry-specific SWOT suggestions\n */\nexport async function generateIndustrySpecificSuggestions(\n  swotData: SWOTData,\n  industry: string,\n  env: Env\n): Promise<AISuggestions | null> {\n  if (!env.OPENAI_API_KEY) {\n    return null;\n  }\n\n  const prompt = `Generate SWOT suggestions specific to the ${industry} industry.\nContext: ${swotData.context}\nObjective: ${swotData.objective}\n\nProvide industry-specific:\n1. Key strengths typical in ${industry}\n2. Common weaknesses in ${industry}\n3. Emerging opportunities in ${industry}\n4. Industry-specific threats\n\nRespond in JSON format with strengths, weaknesses, opportunities, threats arrays.`;\n\n  try {\n    const response = await callOpenAI(prompt, env.OPENAI_API_KEY);\n    return response ? parseSuggestionsResponse(response) : null;\n  } catch (error) {\n    console.error('Industry-specific suggestions error:', error);\n    return null;\n  }\n}\n\n/**\n * Generate strategic options from SWOT matrix\n */\nexport async function generateStrategicOptions(\n  swotData: SWOTData,\n  env: Env\n): Promise<any> {\n  if (!env.OPENAI_API_KEY) {\n    return null;\n  }\n\n  const prompt = `Based on this SWOT analysis, generate strategic options using TOWS matrix:\n\nStrengths: ${swotData.strengths.join(', ')}\nWeaknesses: ${swotData.weaknesses.join(', ')}\nOpportunities: ${swotData.opportunities.join(', ')}\nThreats: ${swotData.threats.join(', ')}\n\nGenerate:\n1. SO Strategies (use strengths to capitalize on opportunities)\n2. WO Strategies (overcome weaknesses by pursuing opportunities)\n3. ST Strategies (use strengths to avoid threats)\n4. WT Strategies (minimize weaknesses and avoid threats)\n\nProvide 2-3 strategies for each category with priority and complexity ratings.`;\n\n  try {\n    const response = await callOpenAI(prompt, env.OPENAI_API_KEY);\n    return response ? JSON.parse(response) : null;\n  } catch (error) {\n    console.error('Strategic options generation error:', error);\n    return null;\n  }\n}", "/**\n * Export functionality for SWOT Framework\n * Handles PDF, DOCX, and JSON exports\n */\n\nimport { Env, FrameworkSession } from '../../../shared/types';\nimport { createDatabase } from '../../../shared/database';\nimport { SWOTData, SWOTExportFormat, SWOTExportResult } from './types';\n\n/**\n * Export SWOT analysis in various formats\n */\nexport async function exportSWOT(\n  session: FrameworkSession,\n  swotData: SWOTData,\n  format: SWOTExportFormat,\n  env: Env,\n  userId: number\n): Promise<SWOTExportResult> {\n  switch (format) {\n    case 'json':\n      return exportToJSON(session, swotData, env, userId);\n    case 'pdf':\n      return exportToPDF(session, swotData, env, userId);\n    case 'docx':\n      return exportToDocx(session, swotData, env, userId);\n    default:\n      throw new Error(`Unsupported export format: ${format}`);\n  }\n}\n\n/**\n * Export to JSON format\n */\nasync function exportToJSON(\n  session: FrameworkSession,\n  swotData: SWOTData,\n  env: Env,\n  userId: number\n): Promise<SWOTExportResult> {\n  const exportData = {\n    metadata: {\n      title: session.title,\n      description: session.description,\n      created_at: session.created_at,\n      updated_at: session.updated_at,\n      version: session.version,\n      exported_at: new Date().toISOString(),\n    },\n    analysis: {\n      objective: swotData.objective,\n      context: swotData.context,\n      strengths: swotData.strengths,\n      weaknesses: swotData.weaknesses,\n      opportunities: swotData.opportunities,\n      threats: swotData.threats,\n    },\n    ai_insights: session.ai_suggestions ? JSON.parse(session.ai_suggestions) : null,\n  };\n\n  const jsonString = JSON.stringify(exportData, null, 2);\n  const blob = new Blob([jsonString], { type: 'application/json' });\n\n  // Generate unique filename\n  const filename = `swot_${session.id}_${Date.now()}.json`;\n\n  // Store in R2 if available\n  if (env.EXPORTS) {\n    await env.EXPORTS.put(filename, blob);\n\n    // Record export in database\n    const db = createDatabase(env);\n    await db.insert('framework_exports', {\n      session_id: session.id,\n      export_type: 'json',\n      file_path: filename,\n      file_size: blob.size,\n      exported_by_id: userId,\n    });\n\n    // Generate signed URL (valid for 1 hour)\n    const expiresAt = new Date(Date.now() + 3600 * 1000);\n\n    return {\n      download_url: `/api/v1/exports/${filename}`,\n      format: 'json',\n      file_size: blob.size,\n      expires_at: expiresAt.toISOString(),\n    };\n  }\n\n  // Fallback: Return data URL\n  const dataUrl = `data:application/json;base64,${btoa(jsonString)}`;\n\n  return {\n    download_url: dataUrl,\n    format: 'json',\n    file_size: jsonString.length,\n    expires_at: new Date(Date.now() + 3600 * 1000).toISOString(),\n  };\n}\n\n/**\n * Export to PDF format\n */\nasync function exportToPDF(\n  session: FrameworkSession,\n  swotData: SWOTData,\n  env: Env,\n  userId: number\n): Promise<SWOTExportResult> {\n  // Generate HTML content\n  const html = generateHTMLReport(session, swotData);\n\n  // For now, return HTML that can be converted client-side\n  // In production, use a PDF generation service or Worker\n  const filename = `swot_${session.id}_${Date.now()}.html`;\n\n  if (env.EXPORTS) {\n    const blob = new Blob([html], { type: 'text/html' });\n    await env.EXPORTS.put(filename, blob);\n\n    const db = createDatabase(env);\n    await db.insert('framework_exports', {\n      session_id: session.id,\n      export_type: 'pdf',\n      file_path: filename,\n      file_size: blob.size,\n      exported_by_id: userId,\n    });\n\n    return {\n      download_url: `/api/v1/exports/${filename}`,\n      format: 'pdf',\n      file_size: blob.size,\n      expires_at: new Date(Date.now() + 3600 * 1000).toISOString(),\n    };\n  }\n\n  // Fallback\n  const dataUrl = `data:text/html;base64,${btoa(html)}`;\n\n  return {\n    download_url: dataUrl,\n    format: 'pdf',\n    file_size: html.length,\n    expires_at: new Date(Date.now() + 3600 * 1000).toISOString(),\n  };\n}\n\n/**\n * Export to DOCX format\n */\nasync function exportToDocx(\n  session: FrameworkSession,\n  swotData: SWOTData,\n  env: Env,\n  userId: number\n): Promise<SWOTExportResult> {\n  // For DOCX, we'll create a structured JSON that can be processed client-side\n  // or by a dedicated document generation service\n  const docData = {\n    title: session.title,\n    sections: [\n      {\n        heading: 'Executive Summary',\n        content: session.description,\n      },\n      {\n        heading: 'Objective',\n        content: swotData.objective,\n      },\n      {\n        heading: 'Context',\n        content: swotData.context || 'No additional context provided.',\n      },\n      {\n        heading: 'Strengths',\n        type: 'list',\n        items: swotData.strengths,\n      },\n      {\n        heading: 'Weaknesses',\n        type: 'list',\n        items: swotData.weaknesses,\n      },\n      {\n        heading: 'Opportunities',\n        type: 'list',\n        items: swotData.opportunities,\n      },\n      {\n        heading: 'Threats',\n        type: 'list',\n        items: swotData.threats,\n      },\n    ],\n    metadata: {\n      created: session.created_at,\n      updated: session.updated_at,\n      version: session.version,\n    },\n  };\n\n  const jsonString = JSON.stringify(docData, null, 2);\n  const filename = `swot_${session.id}_${Date.now()}.docx.json`;\n\n  if (env.EXPORTS) {\n    const blob = new Blob([jsonString], { type: 'application/json' });\n    await env.EXPORTS.put(filename, blob);\n\n    const db = createDatabase(env);\n    await db.insert('framework_exports', {\n      session_id: session.id,\n      export_type: 'docx',\n      file_path: filename,\n      file_size: blob.size,\n      exported_by_id: userId,\n    });\n\n    return {\n      download_url: `/api/v1/exports/${filename}`,\n      format: 'docx',\n      file_size: blob.size,\n      expires_at: new Date(Date.now() + 3600 * 1000).toISOString(),\n    };\n  }\n\n  const dataUrl = `data:application/json;base64,${btoa(jsonString)}`;\n\n  return {\n    download_url: dataUrl,\n    format: 'docx',\n    file_size: jsonString.length,\n    expires_at: new Date(Date.now() + 3600 * 1000).toISOString(),\n  };\n}\n\n/**\n * Generate HTML report for PDF export\n */\nfunction generateHTMLReport(session: FrameworkSession, swotData: SWOTData): string {\n  const aiSuggestions = session.ai_suggestions ? JSON.parse(session.ai_suggestions) : null;\n\n  return `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>${escapeHtml(session.title)} - SWOT Analysis</title>\n    <style>\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            line-height: 1.6;\n            color: #333;\n            max-width: 1200px;\n            margin: 0 auto;\n            padding: 20px;\n            background: #f5f5f5;\n        }\n        .header {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            padding: 30px;\n            border-radius: 10px;\n            margin-bottom: 30px;\n        }\n        h1 {\n            margin: 0;\n            font-size: 2.5em;\n        }\n        .meta {\n            opacity: 0.9;\n            margin-top: 10px;\n        }\n        .section {\n            background: white;\n            padding: 25px;\n            margin-bottom: 20px;\n            border-radius: 10px;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        }\n        h2 {\n            color: #667eea;\n            border-bottom: 2px solid #667eea;\n            padding-bottom: 10px;\n            margin-bottom: 20px;\n        }\n        .swot-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 20px;\n            margin-top: 20px;\n        }\n        .swot-quadrant {\n            background: white;\n            padding: 20px;\n            border-radius: 8px;\n            border: 2px solid;\n        }\n        .strengths { border-color: #48bb78; background: #f0fff4; }\n        .weaknesses { border-color: #f56565; background: #fff5f5; }\n        .opportunities { border-color: #4299e1; background: #ebf8ff; }\n        .threats { border-color: #ed8936; background: #fffdf7; }\n        .swot-quadrant h3 {\n            margin-top: 0;\n            margin-bottom: 15px;\n        }\n        .strengths h3 { color: #48bb78; }\n        .weaknesses h3 { color: #f56565; }\n        .opportunities h3 { color: #4299e1; }\n        .threats h3 { color: #ed8936; }\n        ul {\n            margin: 0;\n            padding-left: 20px;\n        }\n        li {\n            margin-bottom: 8px;\n        }\n        .ai-insights {\n            background: #f7fafc;\n            border-left: 4px solid #667eea;\n            padding: 15px;\n            margin-top: 20px;\n        }\n        .footer {\n            text-align: center;\n            color: #666;\n            margin-top: 40px;\n            padding-top: 20px;\n            border-top: 1px solid #ddd;\n        }\n        @media print {\n            body { background: white; }\n            .section { box-shadow: none; }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"header\">\n        <h1>${escapeHtml(session.title)}</h1>\n        <div class=\"meta\">\n            <div>Created: ${new Date(session.created_at).toLocaleDateString()}</div>\n            <div>Last Updated: ${new Date(session.updated_at).toLocaleDateString()}</div>\n            <div>Version: ${session.version}</div>\n        </div>\n    </div>\n\n    <div class=\"section\">\n        <h2>Objective</h2>\n        <p>${escapeHtml(swotData.objective)}</p>\n\n        ${swotData.context ? `\n        <h2>Context</h2>\n        <p>${escapeHtml(swotData.context)}</p>\n        ` : ''}\n    </div>\n\n    <div class=\"section\">\n        <h2>SWOT Analysis Matrix</h2>\n        <div class=\"swot-grid\">\n            <div class=\"swot-quadrant strengths\">\n                <h3>Strengths</h3>\n                <ul>\n                    ${swotData.strengths.map(s => `<li>${escapeHtml(s)}</li>`).join('')}\n                </ul>\n            </div>\n\n            <div class=\"swot-quadrant weaknesses\">\n                <h3>Weaknesses</h3>\n                <ul>\n                    ${swotData.weaknesses.map(w => `<li>${escapeHtml(w)}</li>`).join('')}\n                </ul>\n            </div>\n\n            <div class=\"swot-quadrant opportunities\">\n                <h3>Opportunities</h3>\n                <ul>\n                    ${swotData.opportunities.map(o => `<li>${escapeHtml(o)}</li>`).join('')}\n                </ul>\n            </div>\n\n            <div class=\"swot-quadrant threats\">\n                <h3>Threats</h3>\n                <ul>\n                    ${swotData.threats.map(t => `<li>${escapeHtml(t)}</li>`).join('')}\n                </ul>\n            </div>\n        </div>\n    </div>\n\n    ${aiSuggestions && aiSuggestions.insights ? `\n    <div class=\"section\">\n        <h2>AI-Generated Insights</h2>\n        <div class=\"ai-insights\">\n            <h3>Key Insights</h3>\n            <ul>\n                ${aiSuggestions.insights.map((i: string) => `<li>${escapeHtml(i)}</li>`).join('')}\n            </ul>\n\n            ${aiSuggestions.recommendations ? `\n            <h3>Recommendations</h3>\n            <ul>\n                ${aiSuggestions.recommendations.map((r: string) => `<li>${escapeHtml(r)}</li>`).join('')}\n            </ul>\n            ` : ''}\n        </div>\n    </div>\n    ` : ''}\n\n    <div class=\"footer\">\n        <p>Generated by ResearchToolsPy - SWOT Analysis Framework</p>\n        <p>${new Date().toLocaleString()}</p>\n    </div>\n</body>\n</html>`;\n}\n\n/**\n * Escape HTML to prevent XSS\n */\nfunction escapeHtml(text: string): string {\n  const map: Record<string, string> = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#039;',\n  };\n  return text.replace(/[&<>\"']/g, m => map[m]);\n}", "/**\n * SWOT Framework Worker\n * Handles SWOT (Strengths, Weaknesses, Opportunities, Threats) analysis\n */\n\nimport { Env, AuthRequest, FrameworkSession } from '../../../shared/types';\nimport { createDatabase } from '../../../shared/database';\nimport { createErrorResponse, validateRequestBody } from '../../../gateway/src/middleware/errorHandler';\nimport { generateAISuggestions, validateWithAI } from './ai';\nimport { exportSWOT } from './export';\nimport {\n  SWOTCreateRequest,\n  SWOTAnalysisResponse,\n  SWOTUpdateRequest,\n  SWOTData,\n  SWOTExportFormat,\n} from './types';\n\nexport default {\n  async fetch(\n    request: Request,\n    env: Env,\n    ctx: ExecutionContext\n  ): Promise<Response> {\n    return handleSWOTRequest(request as AuthRequest, env, ctx);\n  },\n};\n\n/**\n * Main SWOT request handler\n */\nexport async function handleSWOTRequest(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  const url = new URL(request.url);\n  const path = url.pathname;\n  const method = request.method;\n\n  // Remove base path if present\n  const swotPath = path.replace('/api/v1/frameworks/swot', '');\n\n  // Route to appropriate handler\n  switch (true) {\n    case (swotPath === '' || swotPath === '/' || swotPath === '/create') && method === 'POST':\n      return handleCreateSWOT(request, env);\n\n    case swotPath.match(/^\\/(\\d+)$/) && method === 'GET':\n      return handleGetSWOT(request, env, parseInt(swotPath.match(/^\\/(\\d+)$/)[1]));\n\n    case swotPath.match(/^\\/(\\d+)$/) && method === 'PUT':\n      return handleUpdateSWOT(request, env, parseInt(swotPath.match(/^\\/(\\d+)$/)[1]));\n\n    case swotPath.match(/^\\/(\\d+)$/) && method === 'DELETE':\n      return handleDeleteSWOT(request, env, parseInt(swotPath.match(/^\\/(\\d+)$/)[1]));\n\n    case swotPath.match(/^\\/(\\d+)\\/ai-suggestions$/) && method === 'POST':\n      return handleAISuggestions(request, env, parseInt(swotPath.match(/^\\/(\\d+)/)[1]));\n\n    case swotPath.match(/^\\/(\\d+)\\/validate$/) && method === 'POST':\n      return handleAIValidation(request, env, parseInt(swotPath.match(/^\\/(\\d+)/)[1]));\n\n    case swotPath.match(/^\\/(\\d+)\\/export$/) && method === 'POST':\n      return handleExport(request, env, parseInt(swotPath.match(/^\\/(\\d+)/)[1]));\n\n    case swotPath === '/templates/list' && method === 'GET':\n      return handleListTemplates(request, env);\n\n    case swotPath === '/ai/industry-analysis' && method === 'POST':\n      return handleIndustryAnalysis(request, env);\n\n    case swotPath === '/ai/competitive-intelligence' && method === 'POST':\n      return handleCompetitiveIntelligence(request, env);\n\n    case swotPath === '/ai/predictive-modeling' && method === 'POST':\n      return handlePredictiveModeling(request, env);\n\n    case swotPath === '/list' && method === 'GET':\n      return handleListSWOT(request, env);\n\n    default:\n      return createErrorResponse(404, 'SWOT endpoint not found', 'ENDPOINT_NOT_FOUND');\n  }\n}\n\n/**\n * Create new SWOT analysis\n */\nasync function handleCreateSWOT(\n  request: AuthRequest,\n  env: Env\n): Promise<Response> {\n  if (!request.user) {\n    return createErrorResponse(401, 'Authentication required', 'AUTH_REQUIRED');\n  }\n\n  try {\n    const body: SWOTCreateRequest = await request.json();\n\n    // Validate input\n    const validation = validateRequestBody(body, {\n      title: { required: true, type: 'string', minLength: 1 },\n      objective: { required: true, type: 'string', minLength: 1 },\n      context: { required: false, type: 'string' },\n      initial_strengths: { required: false, type: 'array' },\n      initial_weaknesses: { required: false, type: 'array' },\n      initial_opportunities: { required: false, type: 'array' },\n      initial_threats: { required: false, type: 'array' },\n    });\n\n    if (validation) {\n      return createErrorResponse(400, 'Validation failed', 'VALIDATION_ERROR', validation.fields);\n    }\n\n    const db = createDatabase(env);\n\n    // Initialize SWOT data\n    const swotData: SWOTData = {\n      objective: body.objective,\n      context: body.context || '',\n      strengths: body.initial_strengths || [],\n      weaknesses: body.initial_weaknesses || [],\n      opportunities: body.initial_opportunities || [],\n      threats: body.initial_threats || [],\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString(),\n    };\n\n    // Get AI suggestions if requested\n    let aiSuggestions = null;\n    if (body.request_ai_suggestions && env.OPENAI_API_KEY) {\n      try {\n        aiSuggestions = await generateAISuggestions(swotData, env);\n\n        // Merge AI suggestions with initial data\n        if (aiSuggestions) {\n          swotData.strengths = mergUnique(swotData.strengths, aiSuggestions.strengths || []);\n          swotData.weaknesses = mergeUnique(swotData.weaknesses, aiSuggestions.weaknesses || []);\n          swotData.opportunities = mergeUnique(swotData.opportunities, aiSuggestions.opportunities || []);\n          swotData.threats = mergeUnique(swotData.threats, aiSuggestions.threats || []);\n          swotData.ai_suggestions = aiSuggestions;\n        }\n      } catch (error) {\n        console.error('AI suggestions error:', error);\n        // Continue without AI suggestions\n      }\n    }\n\n    // Create framework session\n    const sessionId = await db.insert('framework_sessions', {\n      title: body.title,\n      description: body.objective,\n      framework_type: 'swot',\n      status: 'draft',\n      user_id: request.user.id,\n      data: JSON.stringify(swotData),\n      config: JSON.stringify({ includeAI: body.request_ai_suggestions }),\n      tags: body.tags ? JSON.stringify(body.tags) : null,\n      version: 1,\n      ai_suggestions: aiSuggestions ? JSON.stringify(aiSuggestions) : null,\n      ai_analysis_count: aiSuggestions ? 1 : 0,\n    });\n\n    const response: SWOTAnalysisResponse = {\n      session_id: sessionId,\n      title: body.title,\n      objective: swotData.objective,\n      context: swotData.context,\n      strengths: swotData.strengths,\n      weaknesses: swotData.weaknesses,\n      opportunities: swotData.opportunities,\n      threats: swotData.threats,\n      ai_suggestions: aiSuggestions,\n      status: 'draft',\n      version: 1,\n    };\n\n    return new Response(JSON.stringify(response), {\n      status: 201,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  } catch (error) {\n    console.error('Create SWOT error:', error);\n    return createErrorResponse(500, 'Failed to create SWOT analysis', 'CREATE_ERROR');\n  }\n}\n\n/**\n * Get SWOT analysis by session ID\n */\nasync function handleGetSWOT(\n  request: AuthRequest,\n  env: Env,\n  sessionId: number\n): Promise<Response> {\n  if (!request.user) {\n    return createErrorResponse(401, 'Authentication required', 'AUTH_REQUIRED');\n  }\n\n  try {\n    const db = createDatabase(env);\n\n    // Get session\n    const session = await db.findOne<FrameworkSession>(\n      `SELECT * FROM framework_sessions\n       WHERE id = ? AND user_id = ? AND framework_type = 'swot'`,\n      [sessionId, request.user.id]\n    );\n\n    if (!session) {\n      return createErrorResponse(404, 'SWOT analysis not found', 'NOT_FOUND');\n    }\n\n    const swotData: SWOTData = JSON.parse(session.data);\n    const aiSuggestions = session.ai_suggestions ? JSON.parse(session.ai_suggestions) : null;\n\n    const response: SWOTAnalysisResponse = {\n      session_id: session.id,\n      title: session.title,\n      objective: swotData.objective,\n      context: swotData.context,\n      strengths: swotData.strengths,\n      weaknesses: swotData.weaknesses,\n      opportunities: swotData.opportunities,\n      threats: swotData.threats,\n      ai_suggestions: aiSuggestions,\n      status: session.status,\n      version: session.version,\n    };\n\n    return new Response(JSON.stringify(response), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  } catch (error) {\n    console.error('Get SWOT error:', error);\n    return createErrorResponse(500, 'Failed to retrieve SWOT analysis', 'GET_ERROR');\n  }\n}\n\n/**\n * Update SWOT analysis\n */\nasync function handleUpdateSWOT(\n  request: AuthRequest,\n  env: Env,\n  sessionId: number\n): Promise<Response> {\n  if (!request.user) {\n    return createErrorResponse(401, 'Authentication required', 'AUTH_REQUIRED');\n  }\n\n  try {\n    const body: SWOTUpdateRequest = await request.json();\n    const db = createDatabase(env);\n\n    // Get existing session\n    const session = await db.findOne<FrameworkSession>(\n      `SELECT * FROM framework_sessions\n       WHERE id = ? AND user_id = ? AND framework_type = 'swot'`,\n      [sessionId, request.user.id]\n    );\n\n    if (!session) {\n      return createErrorResponse(404, 'SWOT analysis not found', 'NOT_FOUND');\n    }\n\n    const swotData: SWOTData = JSON.parse(session.data);\n\n    // Update fields\n    if (body.objective !== undefined) swotData.objective = body.objective;\n    if (body.context !== undefined) swotData.context = body.context;\n    if (body.strengths !== undefined) swotData.strengths = body.strengths;\n    if (body.weaknesses !== undefined) swotData.weaknesses = body.weaknesses;\n    if (body.opportunities !== undefined) swotData.opportunities = body.opportunities;\n    if (body.threats !== undefined) swotData.threats = body.threats;\n\n    swotData.updated_at = new Date().toISOString();\n\n    // Update session\n    await db.update(\n      'framework_sessions',\n      {\n        title: body.title || session.title,\n        data: JSON.stringify(swotData),\n        version: session.version + 1,\n        status: body.status || session.status,\n      },\n      { id: sessionId }\n    );\n\n    const response: SWOTAnalysisResponse = {\n      session_id: sessionId,\n      title: body.title || session.title,\n      objective: swotData.objective,\n      context: swotData.context,\n      strengths: swotData.strengths,\n      weaknesses: swotData.weaknesses,\n      opportunities: swotData.opportunities,\n      threats: swotData.threats,\n      ai_suggestions: session.ai_suggestions ? JSON.parse(session.ai_suggestions) : null,\n      status: body.status || session.status,\n      version: session.version + 1,\n    };\n\n    return new Response(JSON.stringify(response), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  } catch (error) {\n    console.error('Update SWOT error:', error);\n    return createErrorResponse(500, 'Failed to update SWOT analysis', 'UPDATE_ERROR');\n  }\n}\n\n/**\n * Delete SWOT analysis\n */\nasync function handleDeleteSWOT(\n  request: AuthRequest,\n  env: Env,\n  sessionId: number\n): Promise<Response> {\n  if (!request.user) {\n    return createErrorResponse(401, 'Authentication required', 'AUTH_REQUIRED');\n  }\n\n  try {\n    const db = createDatabase(env);\n\n    // Check ownership and delete\n    const deleted = await db.delete('framework_sessions', {\n      id: sessionId,\n      user_id: request.user.id,\n      framework_type: 'swot',\n    });\n\n    if (deleted === 0) {\n      return createErrorResponse(404, 'SWOT analysis not found', 'NOT_FOUND');\n    }\n\n    return new Response(JSON.stringify({ success: true }), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  } catch (error) {\n    console.error('Delete SWOT error:', error);\n    return createErrorResponse(500, 'Failed to delete SWOT analysis', 'DELETE_ERROR');\n  }\n}\n\n/**\n * Generate AI suggestions for SWOT\n */\nasync function handleAISuggestions(\n  request: AuthRequest,\n  env: Env,\n  sessionId: number\n): Promise<Response> {\n  if (!request.user) {\n    return createErrorResponse(401, 'Authentication required', 'AUTH_REQUIRED');\n  }\n\n  if (!env.OPENAI_API_KEY) {\n    return createErrorResponse(503, 'AI service not available', 'AI_UNAVAILABLE');\n  }\n\n  try {\n    const db = createDatabase(env);\n\n    // Get session\n    const session = await db.findOne<FrameworkSession>(\n      `SELECT * FROM framework_sessions\n       WHERE id = ? AND user_id = ? AND framework_type = 'swot'`,\n      [sessionId, request.user.id]\n    );\n\n    if (!session) {\n      return createErrorResponse(404, 'SWOT analysis not found', 'NOT_FOUND');\n    }\n\n    const swotData: SWOTData = JSON.parse(session.data);\n\n    // Generate AI suggestions\n    const suggestions = await generateAISuggestions(swotData, env);\n\n    // Update session with new suggestions\n    await db.update(\n      'framework_sessions',\n      {\n        ai_suggestions: JSON.stringify(suggestions),\n        ai_analysis_count: session.ai_analysis_count + 1,\n      },\n      { id: sessionId }\n    );\n\n    return new Response(JSON.stringify(suggestions), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  } catch (error) {\n    console.error('AI suggestions error:', error);\n    return createErrorResponse(500, 'Failed to generate AI suggestions', 'AI_ERROR');\n  }\n}\n\n/**\n * Validate SWOT with AI\n */\nasync function handleAIValidation(\n  request: AuthRequest,\n  env: Env,\n  sessionId: number\n): Promise<Response> {\n  if (!request.user) {\n    return createErrorResponse(401, 'Authentication required', 'AUTH_REQUIRED');\n  }\n\n  if (!env.OPENAI_API_KEY) {\n    return createErrorResponse(503, 'AI service not available', 'AI_UNAVAILABLE');\n  }\n\n  try {\n    const db = createDatabase(env);\n\n    // Get session\n    const session = await db.findOne<FrameworkSession>(\n      `SELECT * FROM framework_sessions\n       WHERE id = ? AND user_id = ? AND framework_type = 'swot'`,\n      [sessionId, request.user.id]\n    );\n\n    if (!session) {\n      return createErrorResponse(404, 'SWOT analysis not found', 'NOT_FOUND');\n    }\n\n    const swotData: SWOTData = JSON.parse(session.data);\n\n    // Validate with AI\n    const validation = await validateWithAI(swotData, env);\n\n    return new Response(JSON.stringify(validation), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  } catch (error) {\n    console.error('AI validation error:', error);\n    return createErrorResponse(500, 'Failed to validate SWOT analysis', 'VALIDATION_ERROR');\n  }\n}\n\n/**\n * Export SWOT analysis\n */\nasync function handleExport(\n  request: AuthRequest,\n  env: Env,\n  sessionId: number\n): Promise<Response> {\n  if (!request.user) {\n    return createErrorResponse(401, 'Authentication required', 'AUTH_REQUIRED');\n  }\n\n  try {\n    const body: { format: SWOTExportFormat } = await request.json();\n\n    if (!['pdf', 'docx', 'json'].includes(body.format)) {\n      return createErrorResponse(400, 'Invalid export format', 'INVALID_FORMAT');\n    }\n\n    const db = createDatabase(env);\n\n    // Get session\n    const session = await db.findOne<FrameworkSession>(\n      `SELECT * FROM framework_sessions\n       WHERE id = ? AND user_id = ? AND framework_type = 'swot'`,\n      [sessionId, request.user.id]\n    );\n\n    if (!session) {\n      return createErrorResponse(404, 'SWOT analysis not found', 'NOT_FOUND');\n    }\n\n    const swotData: SWOTData = JSON.parse(session.data);\n\n    // Generate export\n    const exportResult = await exportSWOT(\n      session,\n      swotData,\n      body.format,\n      env,\n      request.user.id\n    );\n\n    return new Response(JSON.stringify(exportResult), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  } catch (error) {\n    console.error('Export error:', error);\n    return createErrorResponse(500, 'Failed to export SWOT analysis', 'EXPORT_ERROR');\n  }\n}\n\n/**\n * List SWOT templates\n */\nasync function handleListTemplates(\n  request: AuthRequest,\n  env: Env\n): Promise<Response> {\n  try {\n    const db = createDatabase(env);\n\n    const templates = await db.find('framework_templates', {\n      where: {\n        framework_type: 'swot',\n        is_public: 1,\n      },\n      orderBy: {\n        column: 'usage_count',\n        direction: 'desc',\n      },\n      limit: 20,\n    });\n\n    return new Response(JSON.stringify(templates), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  } catch (error) {\n    console.error('List templates error:', error);\n    return createErrorResponse(500, 'Failed to list templates', 'LIST_ERROR');\n  }\n}\n\n/**\n * List user's SWOT analyses\n */\nasync function handleListSWOT(\n  request: AuthRequest,\n  env: Env\n): Promise<Response> {\n  if (!request.user) {\n    return createErrorResponse(401, 'Authentication required', 'AUTH_REQUIRED');\n  }\n\n  try {\n    const db = createDatabase(env);\n    const url = new URL(request.url);\n    const page = parseInt(url.searchParams.get('page') || '1');\n    const pageSize = parseInt(url.searchParams.get('pageSize') || '20');\n\n    const result = await db.paginate('framework_sessions', page, pageSize, {\n      where: {\n        user_id: request.user.id,\n        framework_type: 'swot',\n      },\n      orderBy: {\n        column: 'updated_at',\n        direction: 'desc',\n      },\n    });\n\n    return new Response(JSON.stringify(result), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' },\n    });\n  } catch (error) {\n    console.error('List SWOT error:', error);\n    return createErrorResponse(500, 'Failed to list SWOT analyses', 'LIST_ERROR');\n  }\n}\n\n/**\n * Handle industry analysis\n */\nasync function handleIndustryAnalysis(\n  request: AuthRequest,\n  env: Env\n): Promise<Response> {\n  // TODO: Implement industry-specific SWOT analysis\n  return createErrorResponse(501, 'Industry analysis not yet implemented', 'NOT_IMPLEMENTED');\n}\n\n/**\n * Handle competitive intelligence\n */\nasync function handleCompetitiveIntelligence(\n  request: AuthRequest,\n  env: Env\n): Promise<Response> {\n  // TODO: Implement competitive intelligence analysis\n  return createErrorResponse(501, 'Competitive intelligence not yet implemented', 'NOT_IMPLEMENTED');\n}\n\n/**\n * Handle predictive modeling\n */\nasync function handlePredictiveModeling(\n  request: AuthRequest,\n  env: Env\n): Promise<Response> {\n  // TODO: Implement predictive SWOT modeling\n  return createErrorResponse(501, 'Predictive modeling not yet implemented', 'NOT_IMPLEMENTED');\n}\n\n/**\n * Merge arrays removing duplicates while preserving order\n */\nfunction mergeUnique(arr1: string[], arr2: string[]): string[] {\n  const seen = new Set(arr1);\n  const result = [...arr1];\n\n  for (const item of arr2) {\n    if (!seen.has(item)) {\n      seen.add(item);\n      result.push(item);\n    }\n  }\n\n  return result;\n}", "/**\n * Framework routes handler\n * Routes requests to appropriate framework Workers\n */\n\nimport { Env, AuthRequest } from '../../../shared/types';\nimport { createDatabase } from '../../../shared/database';\nimport { createErrorResponse } from '../middleware/errorHandler';\n\n/**\n * Framework router - handles all /api/v1/frameworks/* routes\n */\nexport async function frameworkRouter(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  const url = new URL(request.url);\n  const path = url.pathname;\n\n  // Extract framework type from path\n  const frameworkMatch = path.match(/^\\/api\\/v1\\/frameworks\\/([^\\/]+)/);\n  if (!frameworkMatch) {\n    return handleListFrameworks(request, env);\n  }\n\n  const frameworkType = frameworkMatch[1];\n\n  // Map framework types to their handlers\n  switch (frameworkType) {\n    case 'swot':\n      return handleSWOTFramework(request, env, ctx);\n\n    case 'ach':\n      return handleACHFramework(request, env, ctx);\n\n    case 'behavioral':\n    case 'behavioral-analysis':\n      return handleBehavioralFramework(request, env, ctx);\n\n    case 'deception':\n    case 'deception-detection':\n      return handleDeceptionFramework(request, env, ctx);\n\n    case 'dotmlpf':\n      return handleDOTMLPFFramework(request, env, ctx);\n\n    case 'pmesii-pt':\n      return handlePMESIIPTFramework(request, env, ctx);\n\n    case 'dime':\n      return handleDIMEFramework(request, env, ctx);\n\n    case 'pest':\n      return handlePESTFramework(request, env, ctx);\n\n    case 'vrio':\n      return handleVRIOFramework(request, env, ctx);\n\n    case 'stakeholder':\n      return handleStakeholderFramework(request, env, ctx);\n\n    case 'trend':\n      return handleTrendFramework(request, env, ctx);\n\n    case 'surveillance':\n      return handleSurveillanceFramework(request, env, ctx);\n\n    case 'causeway':\n      return handleCausewayFramework(request, env, ctx);\n\n    case 'cog':\n      return handleCOGFramework(request, env, ctx);\n\n    case 'starbursting':\n      return handleStarburstingFramework(request, env, ctx);\n\n    case 'fundamental-flow':\n      return handleFundamentalFlowFramework(request, env, ctx);\n\n    default:\n      return createErrorResponse(404, `Framework '${frameworkType}' not found`, 'FRAMEWORK_NOT_FOUND');\n  }\n}\n\n/**\n * List all available frameworks\n */\nasync function handleListFrameworks(\n  request: AuthRequest,\n  env: Env\n): Promise<Response> {\n  const frameworks = [\n    {\n      id: 'swot',\n      name: 'SWOT Analysis',\n      description: 'Analyze Strengths, Weaknesses, Opportunities, and Threats',\n      category: 'strategic',\n      ai_enabled: true,\n    },\n    {\n      id: 'ach',\n      name: 'Analysis of Competing Hypotheses',\n      description: 'Systematic method for evaluating multiple hypotheses',\n      category: 'intelligence',\n      ai_enabled: true,\n    },\n    {\n      id: 'behavioral',\n      name: 'Behavioral Analysis (COM-B)',\n      description: 'Analyze behavior using Capability, Opportunity, Motivation model',\n      category: 'behavioral',\n      ai_enabled: true,\n    },\n    {\n      id: 'deception',\n      name: 'Deception Detection',\n      description: 'Identify and analyze potential deception in information',\n      category: 'intelligence',\n      ai_enabled: true,\n    },\n    {\n      id: 'dotmlpf',\n      name: 'DOTMLPF-P Assessment',\n      description: 'Military capability assessment framework',\n      category: 'military',\n      ai_enabled: true,\n    },\n    {\n      id: 'pmesii-pt',\n      name: 'PMESII-PT Analysis',\n      description: 'Environmental factor analysis for operations',\n      category: 'military',\n      ai_enabled: true,\n    },\n    {\n      id: 'dime',\n      name: 'DIME Analysis',\n      description: 'Diplomatic, Information, Military, Economic power analysis',\n      category: 'strategic',\n      ai_enabled: true,\n    },\n    {\n      id: 'pest',\n      name: 'PEST Analysis',\n      description: 'Political, Economic, Social, Technological factors',\n      category: 'business',\n      ai_enabled: true,\n    },\n    {\n      id: 'vrio',\n      name: 'VRIO Framework',\n      description: 'Valuable, Rare, Inimitable, Organized resource analysis',\n      category: 'business',\n      ai_enabled: true,\n    },\n    {\n      id: 'stakeholder',\n      name: 'Stakeholder Analysis',\n      description: 'Map and analyze stakeholder influence and interest',\n      category: 'strategic',\n      ai_enabled: true,\n    },\n    {\n      id: 'trend',\n      name: 'Trend Analysis',\n      description: 'Identify and analyze patterns over time',\n      category: 'analytical',\n      ai_enabled: true,\n    },\n    {\n      id: 'surveillance',\n      name: 'Surveillance Analysis',\n      description: 'Systematic monitoring and analysis framework',\n      category: 'intelligence',\n      ai_enabled: true,\n    },\n    {\n      id: 'causeway',\n      name: 'Causeway Analysis',\n      description: 'Analyze causal relationships and pathways',\n      category: 'analytical',\n      ai_enabled: true,\n    },\n    {\n      id: 'cog',\n      name: 'Center of Gravity',\n      description: 'Identify critical capabilities and vulnerabilities',\n      category: 'military',\n      ai_enabled: true,\n    },\n    {\n      id: 'starbursting',\n      name: 'Starbursting',\n      description: 'Systematic questioning technique using 5W1H',\n      category: 'analytical',\n      ai_enabled: true,\n    },\n    {\n      id: 'fundamental-flow',\n      name: 'Fundamental Flow',\n      description: 'Analyze fundamental processes and workflows',\n      category: 'analytical',\n      ai_enabled: false,\n    },\n  ];\n\n  // If user is authenticated, include their usage stats\n  if (request.user) {\n    const db = createDatabase(env);\n    const userSessions = await db.execute(\n      `SELECT framework_type, COUNT(*) as count\n       FROM framework_sessions\n       WHERE user_id = ?\n       GROUP BY framework_type`,\n      [request.user.id]\n    );\n\n    const usageMap = new Map(\n      userSessions.results.map((row: any) => [row.framework_type, row.count])\n    );\n\n    frameworks.forEach(framework => {\n      (framework as any).user_sessions_count = usageMap.get(framework.id) || 0;\n    });\n  }\n\n  return new Response(JSON.stringify(frameworks), {\n    status: 200,\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\n/**\n * Handle SWOT framework requests\n */\nasync function handleSWOTFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  // Import and use the SWOT worker\n  const { handleSWOTRequest } = await import('../../../frameworks/swot/src/index');\n  return handleSWOTRequest(request, env, ctx);\n}\n\n/**\n * Placeholder handlers for other frameworks\n * These will be implemented as we migrate each framework\n */\n\nasync function handleACHFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'ACH framework not yet implemented', 'NOT_IMPLEMENTED');\n}\n\nasync function handleBehavioralFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'Behavioral Analysis framework not yet implemented', 'NOT_IMPLEMENTED');\n}\n\nasync function handleDeceptionFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'Deception Detection framework not yet implemented', 'NOT_IMPLEMENTED');\n}\n\nasync function handleDOTMLPFFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'DOTMLPF framework not yet implemented', 'NOT_IMPLEMENTED');\n}\n\nasync function handlePMESIIPTFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'PMESII-PT framework not yet implemented', 'NOT_IMPLEMENTED');\n}\n\nasync function handleDIMEFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'DIME framework not yet implemented', 'NOT_IMPLEMENTED');\n}\n\nasync function handlePESTFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'PEST framework not yet implemented', 'NOT_IMPLEMENTED');\n}\n\nasync function handleVRIOFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'VRIO framework not yet implemented', 'NOT_IMPLEMENTED');\n}\n\nasync function handleStakeholderFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'Stakeholder Analysis framework not yet implemented', 'NOT_IMPLEMENTED');\n}\n\nasync function handleTrendFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'Trend Analysis framework not yet implemented', 'NOT_IMPLEMENTED');\n}\n\nasync function handleSurveillanceFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'Surveillance Analysis framework not yet implemented', 'NOT_IMPLEMENTED');\n}\n\nasync function handleCausewayFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'Causeway Analysis framework not yet implemented', 'NOT_IMPLEMENTED');\n}\n\nasync function handleCOGFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'Center of Gravity framework not yet implemented', 'NOT_IMPLEMENTED');\n}\n\nasync function handleStarburstingFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'Starbursting framework not yet implemented', 'NOT_IMPLEMENTED');\n}\n\nasync function handleFundamentalFlowFramework(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'Fundamental Flow framework not yet implemented', 'NOT_IMPLEMENTED');\n}\n\n/**\n * Get user's framework sessions\n */\nexport async function getUserFrameworkSessions(\n  userId: number,\n  env: Env,\n  options?: {\n    framework_type?: string;\n    status?: string;\n    page?: number;\n    pageSize?: number;\n  }\n): Promise<any> {\n  const db = createDatabase(env);\n\n  const where: Record<string, any> = { user_id: userId };\n  if (options?.framework_type) {\n    where.framework_type = options.framework_type;\n  }\n  if (options?.status) {\n    where.status = options.status;\n  }\n\n  return db.paginate(\n    'framework_sessions',\n    options?.page || 1,\n    options?.pageSize || 20,\n    {\n      where,\n      orderBy: {\n        column: 'updated_at',\n        direction: 'desc',\n      },\n    }\n  );\n}", "/**\n * Research tools routes handler\n */\n\nimport { Env, AuthRequest } from '../../../shared/types';\nimport { createErrorResponse } from '../middleware/errorHandler';\n\nexport async function toolsRouter(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'Research tools not yet implemented', 'NOT_IMPLEMENTED');\n}", "/**\n * User management routes handler\n */\n\nimport { Env, AuthRequest } from '../../../shared/types';\nimport { createDatabase } from '../../../shared/database';\nimport { createErrorResponse } from '../middleware/errorHandler';\nimport { requireRole } from '../middleware/auth';\n\n/**\n * Users router - handles all /api/v1/users/* routes\n */\nexport async function usersRouter(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  const url = new URL(request.url);\n  const path = url.pathname;\n  const method = request.method;\n\n  // Require authentication for all user routes\n  if (!request.user) {\n    return createErrorResponse(401, 'Authentication required', 'AUTH_REQUIRED');\n  }\n\n  // Route to specific handler\n  switch (true) {\n    case path === '/api/v1/users' && method === 'GET':\n      // Admin only - list all users\n      const roleCheck = requireRole(request.user, ['admin']);\n      if (roleCheck) return roleCheck;\n      return handleListUsers(request, env);\n\n    case path.match(/^\\/api\\/v1\\/users\\/(\\d+)$/) && method === 'GET':\n      return handleGetUser(request, env, parseInt(path.match(/^\\/api\\/v1\\/users\\/(\\d+)$/)[1]));\n\n    case path.match(/^\\/api\\/v1\\/users\\/(\\d+)$/) && method === 'PATCH':\n      return handleUpdateUser(request, env, parseInt(path.match(/^\\/api\\/v1\\/users\\/(\\d+)$/)[1]));\n\n    case path.match(/^\\/api\\/v1\\/users\\/(\\d+)$/) && method === 'DELETE':\n      return handleDeleteUser(request, env, parseInt(path.match(/^\\/api\\/v1\\/users\\/(\\d+)$/)[1]));\n\n    case path === '/api/v1/users/search' && method === 'GET':\n      return handleSearchUsers(request, env);\n\n    case path === '/api/v1/users/stats' && method === 'GET':\n      return handleUserStats(request, env);\n\n    default:\n      return createErrorResponse(404, 'User endpoint not found', 'ENDPOINT_NOT_FOUND');\n  }\n}\n\nasync function handleListUsers(request: AuthRequest, env: Env): Promise<Response> {\n  const db = createDatabase(env);\n  const url = new URL(request.url);\n  const page = parseInt(url.searchParams.get('page') || '1');\n  const pageSize = parseInt(url.searchParams.get('pageSize') || '20');\n\n  const result = await db.paginate('users', page, pageSize, {\n    orderBy: { column: 'created_at', direction: 'desc' },\n  });\n\n  // Remove sensitive data\n  result.items = result.items.map((user: any) => ({\n    id: user.id,\n    username: user.username,\n    email: user.email,\n    full_name: user.full_name,\n    role: user.role,\n    is_active: user.is_active,\n    is_verified: user.is_verified,\n    organization: user.organization,\n    department: user.department,\n    created_at: user.created_at,\n  }));\n\n  return new Response(JSON.stringify(result), {\n    status: 200,\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\nasync function handleGetUser(\n  request: AuthRequest,\n  env: Env,\n  userId: number\n): Promise<Response> {\n  // Users can only view their own profile unless they're admin\n  if (request.user.id !== userId && request.user.role !== 'admin') {\n    return createErrorResponse(403, 'Forbidden', 'FORBIDDEN');\n  }\n\n  const db = createDatabase(env);\n  const user = await db.findOne(\n    'SELECT id, username, email, full_name, role, is_active, is_verified, organization, department, bio, created_at, updated_at FROM users WHERE id = ?',\n    [userId]\n  );\n\n  if (!user) {\n    return createErrorResponse(404, 'User not found', 'NOT_FOUND');\n  }\n\n  return new Response(JSON.stringify(user), {\n    status: 200,\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\nasync function handleUpdateUser(\n  request: AuthRequest,\n  env: Env,\n  userId: number\n): Promise<Response> {\n  // Users can only update their own profile unless they're admin\n  if (request.user.id !== userId && request.user.role !== 'admin') {\n    return createErrorResponse(403, 'Forbidden', 'FORBIDDEN');\n  }\n\n  const body = await request.json();\n  const db = createDatabase(env);\n\n  // Allowed fields for self-update\n  const allowedSelfUpdate = ['full_name', 'bio', 'organization', 'department'];\n  // Additional fields for admin update\n  const allowedAdminUpdate = [...allowedSelfUpdate, 'role', 'is_active', 'is_verified'];\n\n  const updates: Record<string, any> = {};\n  const allowedFields = request.user.role === 'admin' ? allowedAdminUpdate : allowedSelfUpdate;\n\n  for (const field of allowedFields) {\n    if (body[field] !== undefined) {\n      updates[field] = body[field];\n    }\n  }\n\n  if (Object.keys(updates).length === 0) {\n    return createErrorResponse(400, 'No valid fields to update', 'NO_UPDATES');\n  }\n\n  await db.update('users', updates, { id: userId });\n\n  const updatedUser = await db.findOne(\n    'SELECT id, username, email, full_name, role, is_active, is_verified, organization, department, bio, created_at, updated_at FROM users WHERE id = ?',\n    [userId]\n  );\n\n  return new Response(JSON.stringify(updatedUser), {\n    status: 200,\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\nasync function handleDeleteUser(\n  request: AuthRequest,\n  env: Env,\n  userId: number\n): Promise<Response> {\n  // Only admins can delete users\n  const roleCheck = requireRole(request.user, ['admin']);\n  if (roleCheck) return roleCheck;\n\n  // Prevent self-deletion\n  if (request.user.id === userId) {\n    return createErrorResponse(400, 'Cannot delete your own account', 'SELF_DELETE');\n  }\n\n  const db = createDatabase(env);\n  const deleted = await db.delete('users', { id: userId });\n\n  if (deleted === 0) {\n    return createErrorResponse(404, 'User not found', 'NOT_FOUND');\n  }\n\n  return new Response(JSON.stringify({ success: true }), {\n    status: 200,\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\nasync function handleSearchUsers(request: AuthRequest, env: Env): Promise<Response> {\n  const url = new URL(request.url);\n  const query = url.searchParams.get('q');\n\n  if (!query || query.length < 2) {\n    return createErrorResponse(400, 'Search query must be at least 2 characters', 'INVALID_QUERY');\n  }\n\n  const db = createDatabase(env);\n  const results = await db.execute(\n    `SELECT id, username, email, full_name, role, organization, department\n     FROM users\n     WHERE (username LIKE ? OR email LIKE ? OR full_name LIKE ?)\n     AND is_active = 1\n     LIMIT 20`,\n    [`%${query}%`, `%${query}%`, `%${query}%`]\n  );\n\n  return new Response(JSON.stringify(results.results), {\n    status: 200,\n    headers: { 'Content-Type': 'application/json' },\n  });\n}\n\nasync function handleUserStats(request: AuthRequest, env: Env): Promise<Response> {\n  // Only show stats for current user unless admin\n  const userId = request.user.role === 'admin'\n    ? parseInt(new URL(request.url).searchParams.get('userId') || request.user.id.toString())\n    : request.user.id;\n\n  const db = createDatabase(env);\n\n  const stats = await db.execute(\n    `SELECT\n      COUNT(DISTINCT fs.id) as total_sessions,\n      COUNT(DISTINCT CASE WHEN fs.status = 'completed' THEN fs.id END) as completed_sessions,\n      COUNT(DISTINCT fs.framework_type) as frameworks_used,\n      SUM(fs.ai_analysis_count) as total_ai_analyses,\n      COUNT(DISTINCT fe.id) as total_exports\n     FROM users u\n     LEFT JOIN framework_sessions fs ON u.id = fs.user_id\n     LEFT JOIN framework_exports fe ON fs.id = fe.session_id\n     WHERE u.id = ?`,\n    [userId]\n  );\n\n  return new Response(JSON.stringify(stats.results[0]), {\n    status: 200,\n    headers: { 'Content-Type': 'application/json' },\n  });\n}", "/**\n * AI service routes handler\n */\n\nimport { Env, AuthRequest } from '../../../shared/types';\nimport { createErrorResponse } from '../middleware/errorHandler';\n\nexport async function aiRouter(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'AI service not yet implemented', 'NOT_IMPLEMENTED');\n}", "/**\n * Export service routes handler\n */\n\nimport { Env, AuthRequest } from '../../../shared/types';\nimport { createErrorResponse } from '../middleware/errorHandler';\n\nexport async function exportRouter(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'Export service not yet implemented', 'NOT_IMPLEMENTED');\n}", "/**\n * Analytics routes handler\n */\n\nimport { Env, AuthRequest } from '../../../shared/types';\nimport { createErrorResponse } from '../middleware/errorHandler';\n\nexport async function analyticsRouter(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'Analytics service not yet implemented', 'NOT_IMPLEMENTED');\n}", "/**\n * Citations routes handler\n */\n\nimport { Env, AuthRequest } from '../../../shared/types';\nimport { createErrorResponse } from '../middleware/errorHandler';\n\nexport async function citationsRouter(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'Citations service not yet implemented', 'NOT_IMPLEMENTED');\n}", "/**\n * Jobs/Queue routes handler\n */\n\nimport { Env, AuthRequest } from '../../../shared/types';\nimport { createErrorResponse } from '../middleware/errorHandler';\n\nexport async function jobsRouter(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  return createErrorResponse(501, 'Jobs service not yet implemented', 'NOT_IMPLEMENTED');\n}", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/Users/sac/Git/researchtoolspy/cloudflare/workers/gateway/.wrangler/tmp/bundle-eX4cAX/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/Users/sac/Git/researchtoolspy/cloudflare/workers/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/Users/sac/Git/researchtoolspy/cloudflare/workers/gateway/.wrangler/tmp/bundle-eX4cAX/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/Users/sac/Git/researchtoolspy/cloudflare/workers/gateway/.wrangler/tmp/bundle-eX4cAX/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/Users/sac/Git/researchtoolspy/cloudflare/workers/gateway/src/index.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/Users/sac/Git/researchtoolspy/cloudflare/workers/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/Users/sac/Git/researchtoolspy/cloudflare/workers/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/Users/sac/Git/researchtoolspy/cloudflare/workers/gateway/src/index.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "/**\n * API Gateway Worker - Main entry point for ResearchToolsPy API\n * Routes requests to appropriate service workers and handles cross-cutting concerns\n */\n\nimport { Env, APIResponse, AuthRequest } from '../../shared/types';\nimport { corsMiddleware } from './middleware/cors';\nimport { rateLimitMiddleware } from './middleware/rateLimit';\nimport { authMiddleware } from './middleware/auth';\nimport { errorHandler } from './middleware/errorHandler';\nimport { requestLogger } from './middleware/logger';\nimport { router } from './router';\n\nexport default {\n  async fetch(\n    request: Request,\n    env: Env,\n    ctx: ExecutionContext\n  ): Promise<Response> {\n    const requestId = crypto.randomUUID();\n    const startTime = Date.now();\n\n    // Add request ID to headers\n    const headers = new Headers(request.headers);\n    headers.set('X-Request-ID', requestId);\n\n    // Clone request with new headers\n    const enrichedRequest = new Request(request.url, {\n      method: request.method,\n      headers,\n      body: request.body,\n    }) as AuthRequest;\n\n    // Store environment and context on request for middleware\n    (enrichedRequest as any).env = env;\n    (enrichedRequest as any).ctx = ctx;\n    (enrichedRequest as any).requestId = requestId;\n    (enrichedRequest as any).startTime = startTime;\n\n    try {\n      // Handle preflight requests\n      if (request.method === 'OPTIONS') {\n        return corsMiddleware(request, env);\n      }\n\n      // Apply middleware chain\n      let response: Response;\n\n      // 1. CORS headers\n      const corsHeaders = getCorsHeaders(env);\n\n      // 2. Rate limiting (skip for health checks)\n      if (!request.url.includes('/health')) {\n        const rateLimitResponse = await rateLimitMiddleware(enrichedRequest, env);\n        if (rateLimitResponse) {\n          return new Response(rateLimitResponse.body, {\n            status: rateLimitResponse.status,\n            headers: {\n              ...Object.fromEntries(rateLimitResponse.headers),\n              ...corsHeaders,\n            },\n          });\n        }\n      }\n\n      // 3. Authentication (for protected routes)\n      const isPublicRoute = isPublicEndpoint(request.url);\n      if (!isPublicRoute) {\n        const authResponse = await authMiddleware(enrichedRequest, env);\n        if (authResponse instanceof Response) {\n          return new Response(authResponse.body, {\n            status: authResponse.status,\n            headers: {\n              ...Object.fromEntries(authResponse.headers),\n              ...corsHeaders,\n            },\n          });\n        }\n      }\n\n      // 4. Route request to appropriate handler\n      response = await router(enrichedRequest, env, ctx);\n\n      // 5. Add CORS headers to response\n      const finalHeaders = new Headers(response.headers);\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        finalHeaders.set(key, value);\n      });\n\n      // 6. Add performance metrics\n      finalHeaders.set('X-Request-ID', requestId);\n      finalHeaders.set('X-Processing-Time', `${Date.now() - startTime}ms`);\n\n      // 7. Log request (async, don't await)\n      ctx.waitUntil(\n        requestLogger(enrichedRequest, response, env, {\n          requestId,\n          processingTime: Date.now() - startTime,\n        })\n      );\n\n      return new Response(response.body, {\n        status: response.status,\n        statusText: response.statusText,\n        headers: finalHeaders,\n      });\n\n    } catch (error) {\n      // Error handling\n      console.error('Gateway error:', error);\n      const errorResponse = errorHandler(error as Error, requestId);\n\n      return new Response(JSON.stringify(errorResponse), {\n        status: errorResponse.status || 500,\n        headers: {\n          'Content-Type': 'application/json',\n          ...getCorsHeaders(env),\n          'X-Request-ID': requestId,\n        },\n      });\n    }\n  },\n};\n\n/**\n * Get CORS headers based on environment\n */\nfunction getCorsHeaders(env: Env): Record<string, string> {\n  const allowedOrigins = env.ENVIRONMENT === 'production'\n    ? [\n        'https://researchtoolspy.com',\n        'https://www.researchtoolspy.com',\n        'https://app.researchtoolspy.com',\n      ]\n    : ['http://localhost:3000', 'http://localhost:3001'];\n\n  return {\n    'Access-Control-Allow-Origin': allowedOrigins[0], // TODO: Check origin header\n    'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, PATCH, OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Request-ID',\n    'Access-Control-Allow-Credentials': 'true',\n    'Access-Control-Max-Age': '86400',\n  };\n}\n\n/**\n * Check if the endpoint is public (no auth required)\n */\nfunction isPublicEndpoint(url: string): boolean {\n  const publicPaths = [\n    '/api/v1/health',\n    '/api/v1/auth/login',\n    '/api/v1/auth/register',\n    '/api/v1/auth/refresh',\n    '/api/v1/auth/anonymous',\n    '/api/v1/public',\n  ];\n\n  const urlPath = new URL(url).pathname;\n  return publicPaths.some(path => urlPath.startsWith(path));\n}\n\n/**\n * Health check endpoint (built into gateway)\n */\nexport async function handleHealthCheck(env: Env): Promise<Response> {\n  const health = {\n    status: 'healthy',\n    timestamp: new Date().toISOString(),\n    environment: env.ENVIRONMENT || 'development',\n    services: {\n      database: 'checking',\n      cache: 'checking',\n      storage: 'checking',\n    },\n  };\n\n  // Check D1 database\n  try {\n    const result = await env.DB.prepare('SELECT 1 as health').first();\n    health.services.database = result ? 'healthy' : 'unhealthy';\n  } catch (error) {\n    health.services.database = 'unhealthy';\n    health.status = 'degraded';\n  }\n\n  // Check KV namespace\n  try {\n    await env.SESSIONS.put('health-check', Date.now().toString(), {\n      expirationTtl: 10,\n    });\n    health.services.cache = 'healthy';\n  } catch (error) {\n    health.services.cache = 'unhealthy';\n    health.status = 'degraded';\n  }\n\n  // Check R2 bucket if available\n  if (env.DOCUMENTS) {\n    try {\n      await env.DOCUMENTS.head('health-check');\n      health.services.storage = 'healthy';\n    } catch (error) {\n      // File doesn't exist is ok, connection error is not\n      health.services.storage = error.message.includes('NoSuchKey') ? 'healthy' : 'unhealthy';\n    }\n  } else {\n    health.services.storage = 'not configured';\n  }\n\n  const statusCode = health.status === 'healthy' ? 200 : 503;\n\n  return new Response(JSON.stringify(health), {\n    status: statusCode,\n    headers: {\n      'Content-Type': 'application/json',\n      'Cache-Control': 'no-cache',\n    },\n  });\n}", "/**\n * CORS Middleware for Cloudflare Workers\n */\n\nimport { Env } from '../../../shared/types';\n\n/**\n * Handle CORS preflight requests and add CORS headers\n */\nexport function corsMiddleware(request: Request, env: Env): Response {\n  const origin = request.headers.get('Origin') || '';\n  const allowedOrigins = getAllowedOrigins(env);\n\n  // Check if origin is allowed\n  const isAllowed = allowedOrigins.includes('*') ||\n    allowedOrigins.some(allowed => {\n      if (allowed.includes('*')) {\n        // Handle wildcard subdomains\n        const pattern = allowed.replace('*', '.*');\n        const regex = new RegExp(`^${pattern}$`);\n        return regex.test(origin);\n      }\n      return allowed === origin;\n    });\n\n  const corsHeaders: Record<string, string> = {\n    'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, PATCH, OPTIONS',\n    'Access-Control-Allow-Headers': request.headers.get('Access-Control-Request-Headers') || 'Content-Type, Authorization, X-Request-ID',\n    'Access-Control-Max-Age': '86400', // 24 hours\n  };\n\n  if (isAllowed) {\n    corsHeaders['Access-Control-Allow-Origin'] = origin;\n    corsHeaders['Access-Control-Allow-Credentials'] = 'true';\n  } else if (env.ENVIRONMENT !== 'production') {\n    // In development, allow any origin\n    corsHeaders['Access-Control-Allow-Origin'] = origin || '*';\n    corsHeaders['Access-Control-Allow-Credentials'] = 'true';\n  }\n\n  // Return response for OPTIONS request\n  if (request.method === 'OPTIONS') {\n    return new Response(null, {\n      status: 204,\n      headers: corsHeaders,\n    });\n  }\n\n  // For non-OPTIONS requests, return headers to be added to response\n  return new Response(null, {\n    headers: corsHeaders,\n  });\n}\n\n/**\n * Get allowed origins based on environment\n */\nfunction getAllowedOrigins(env: Env): string[] {\n  if (env.ENVIRONMENT === 'production') {\n    return [\n      'https://researchtoolspy.com',\n      'https://www.researchtoolspy.com',\n      'https://app.researchtoolspy.com',\n      'https://*.researchtoolspy.com',\n    ];\n  } else if (env.ENVIRONMENT === 'staging') {\n    return [\n      'https://staging.researchtoolspy.com',\n      'https://*.staging.researchtoolspy.com',\n      'http://localhost:3000',\n      'http://localhost:3001',\n    ];\n  } else {\n    // Development - allow localhost\n    return [\n      'http://localhost:3000',\n      'http://localhost:3001',\n      'http://127.0.0.1:3000',\n      'http://127.0.0.1:3001',\n      'http://localhost:5173', // Vite default\n      'http://127.0.0.1:5173',\n    ];\n  }\n}\n\n/**\n * Add CORS headers to a response\n */\nexport function addCorsHeaders(\n  response: Response,\n  request: Request,\n  env: Env\n): Response {\n  const corsResponse = corsMiddleware(request, env);\n  const corsHeaders = Object.fromEntries(corsResponse.headers);\n\n  const newHeaders = new Headers(response.headers);\n  Object.entries(corsHeaders).forEach(([key, value]) => {\n    if (value) newHeaders.set(key, value);\n  });\n\n  return new Response(response.body, {\n    status: response.status,\n    statusText: response.statusText,\n    headers: newHeaders,\n  });\n}", "/**\n * Rate Limiting Middleware using Cloudflare KV\n */\n\nimport { Env, RateLimitError } from '../../../shared/types';\n\ninterface RateLimitConfig {\n  windowMs: number;\n  maxRequests: number;\n}\n\n/**\n * Rate limit middleware\n */\nexport async function rateLimitMiddleware(\n  request: Request,\n  env: Env\n): Promise<Response | null> {\n  const config = getRateLimitConfig(request, env);\n  const key = getRateLimitKey(request);\n\n  try {\n    // Get current count from KV\n    const currentCount = await env.RATE_LIMITS.get(key);\n    const count = currentCount ? parseInt(currentCount, 10) : 0;\n\n    // Check if limit exceeded\n    if (count >= config.maxRequests) {\n      const retryAfter = Math.ceil(config.windowMs / 1000);\n      return createRateLimitResponse(retryAfter, config);\n    }\n\n    // Increment counter\n    const newCount = count + 1;\n    const ttl = Math.ceil(config.windowMs / 1000); // Convert to seconds\n\n    await env.RATE_LIMITS.put(key, newCount.toString(), {\n      expirationTtl: ttl,\n    });\n\n    // Add rate limit headers to request for later use\n    (request as any).rateLimitInfo = {\n      limit: config.maxRequests,\n      remaining: config.maxRequests - newCount,\n      reset: Date.now() + config.windowMs,\n    };\n\n    return null; // Continue processing\n  } catch (error) {\n    console.error('Rate limit error:', error);\n    // On error, allow the request to proceed\n    return null;\n  }\n}\n\n/**\n * Get rate limit configuration based on request and environment\n */\nfunction getRateLimitConfig(request: Request, env: Env): RateLimitConfig {\n  const url = new URL(request.url);\n  const path = url.pathname;\n\n  // Different limits for different endpoints\n  if (path.startsWith('/api/v1/auth/login')) {\n    // Stricter limit for login attempts\n    return {\n      windowMs: 15 * 60 * 1000, // 15 minutes\n      maxRequests: 5,\n    };\n  }\n\n  if (path.startsWith('/api/v1/auth/register')) {\n    // Limit registration attempts\n    return {\n      windowMs: 60 * 60 * 1000, // 1 hour\n      maxRequests: 3,\n    };\n  }\n\n  if (path.startsWith('/api/v1/ai/')) {\n    // Limit AI API calls\n    return {\n      windowMs: 60 * 1000, // 1 minute\n      maxRequests: 10,\n    };\n  }\n\n  if (path.startsWith('/api/v1/export/')) {\n    // Limit export operations\n    return {\n      windowMs: 60 * 1000, // 1 minute\n      maxRequests: 5,\n    };\n  }\n\n  // Default rate limit\n  const defaultLimit = env.ENVIRONMENT === 'production' ? 100 : 1000;\n  return {\n    windowMs: 60 * 1000, // 1 minute\n    maxRequests: defaultLimit,\n  };\n}\n\n/**\n * Generate rate limit key based on IP and optionally user ID\n */\nfunction getRateLimitKey(request: Request): string {\n  const url = new URL(request.url);\n  const path = url.pathname;\n\n  // Get client IP\n  const ip = request.headers.get('CF-Connecting-IP') ||\n    request.headers.get('X-Forwarded-For')?.split(',')[0] ||\n    request.headers.get('X-Real-IP') ||\n    'unknown';\n\n  // For authenticated routes, also include user ID if available\n  const userId = (request as any).user?.id || '';\n\n  // Create key based on path, IP, and optionally user ID\n  const baseKey = `rate_limit:${path}:${ip}`;\n  return userId ? `${baseKey}:${userId}` : baseKey;\n}\n\n/**\n * Create rate limit exceeded response\n */\nfunction createRateLimitResponse(\n  retryAfter: number,\n  config: RateLimitConfig\n): Response {\n  return new Response(\n    JSON.stringify({\n      error: 'Too Many Requests',\n      message: `Rate limit exceeded. Please try again in ${retryAfter} seconds.`,\n      retryAfter,\n      limit: config.maxRequests,\n      window: config.windowMs / 1000,\n    }),\n    {\n      status: 429,\n      headers: {\n        'Content-Type': 'application/json',\n        'Retry-After': retryAfter.toString(),\n        'X-RateLimit-Limit': config.maxRequests.toString(),\n        'X-RateLimit-Remaining': '0',\n        'X-RateLimit-Reset': (Date.now() + config.windowMs).toString(),\n      },\n    }\n  );\n}\n\n/**\n * Add rate limit headers to response\n */\nexport function addRateLimitHeaders(\n  response: Response,\n  request: Request\n): Response {\n  const rateLimitInfo = (request as any).rateLimitInfo;\n  if (!rateLimitInfo) return response;\n\n  const headers = new Headers(response.headers);\n  headers.set('X-RateLimit-Limit', rateLimitInfo.limit.toString());\n  headers.set('X-RateLimit-Remaining', rateLimitInfo.remaining.toString());\n  headers.set('X-RateLimit-Reset', rateLimitInfo.reset.toString());\n\n  return new Response(response.body, {\n    status: response.status,\n    statusText: response.statusText,\n    headers,\n  });\n}\n\n/**\n * Clear rate limit for a specific key (useful for testing or admin actions)\n */\nexport async function clearRateLimit(\n  key: string,\n  env: Env\n): Promise<void> {\n  try {\n    await env.RATE_LIMITS.delete(key);\n  } catch (error) {\n    console.error('Error clearing rate limit:', error);\n  }\n}\n\n/**\n * Get current rate limit status for a key\n */\nexport async function getRateLimitStatus(\n  key: string,\n  env: Env,\n  config: RateLimitConfig\n): Promise<{\n  count: number;\n  remaining: number;\n  resetAt: number;\n}> {\n  try {\n    const currentCount = await env.RATE_LIMITS.get(key);\n    const count = currentCount ? parseInt(currentCount, 10) : 0;\n\n    return {\n      count,\n      remaining: Math.max(0, config.maxRequests - count),\n      resetAt: Date.now() + config.windowMs,\n    };\n  } catch (error) {\n    console.error('Error getting rate limit status:', error);\n    return {\n      count: 0,\n      remaining: config.maxRequests,\n      resetAt: Date.now() + config.windowMs,\n    };\n  }\n}", "/**\n * Request Logger Middleware for Cloudflare Workers\n */\n\nimport { Env } from '../../../shared/types';\nimport { createDatabase } from '../../../shared/database';\n\ninterface LogEntry {\n  requestId: string;\n  method: string;\n  url: string;\n  path: string;\n  statusCode: number;\n  processingTime: number;\n  userAgent?: string;\n  ip?: string;\n  userId?: number;\n  error?: string;\n  timestamp: string;\n}\n\n/**\n * Log request to D1 database\n */\nexport async function requestLogger(\n  request: Request,\n  response: Response,\n  env: Env,\n  metadata: {\n    requestId: string;\n    processingTime: number;\n  }\n): Promise<void> {\n  try {\n    const url = new URL(request.url);\n    const logEntry: LogEntry = {\n      requestId: metadata.requestId,\n      method: request.method,\n      url: url.href,\n      path: url.pathname,\n      statusCode: response.status,\n      processingTime: metadata.processingTime,\n      userAgent: request.headers.get('User-Agent') || undefined,\n      ip: request.headers.get('CF-Connecting-IP') ||\n        request.headers.get('X-Forwarded-For')?.split(',')[0] ||\n        request.headers.get('X-Real-IP') ||\n        undefined,\n      userId: (request as any).user?.id,\n      timestamp: new Date().toISOString(),\n    };\n\n    // Log errors for 4xx and 5xx responses\n    if (response.status >= 400) {\n      try {\n        const responseBody = await response.clone().text();\n        const errorData = JSON.parse(responseBody);\n        logEntry.error = errorData.message || errorData.error;\n      } catch {\n        // Ignore parsing errors\n      }\n    }\n\n    // Store in KV for quick access (with TTL)\n    const logKey = `log:${metadata.requestId}`;\n    await env.CACHE.put(logKey, JSON.stringify(logEntry), {\n      expirationTtl: 86400, // 24 hours\n    });\n\n    // Store aggregated metrics\n    await storeMetrics(logEntry, env);\n\n    // For production, also send to analytics\n    if (env.ENVIRONMENT === 'production') {\n      await sendToAnalytics(logEntry, env);\n    }\n\n    // Log to console in development\n    if (env.ENVIRONMENT !== 'production') {\n      console.log('Request Log:', logEntry);\n    }\n  } catch (error) {\n    // Don't let logging errors affect the response\n    console.error('Logging error:', error);\n  }\n}\n\n/**\n * Store aggregated metrics in KV\n */\nasync function storeMetrics(\n  logEntry: LogEntry,\n  env: Env\n): Promise<void> {\n  try {\n    const metricsKey = `metrics:${new Date().toISOString().split('T')[0]}`;\n    const existingMetrics = await env.CACHE.get(metricsKey);\n\n    const metrics = existingMetrics ? JSON.parse(existingMetrics) : {\n      totalRequests: 0,\n      successfulRequests: 0,\n      failedRequests: 0,\n      avgResponseTime: 0,\n      endpoints: {},\n      statusCodes: {},\n      userAgents: {},\n    };\n\n    // Update metrics\n    metrics.totalRequests++;\n    if (logEntry.statusCode < 400) {\n      metrics.successfulRequests++;\n    } else {\n      metrics.failedRequests++;\n    }\n\n    // Update average response time\n    metrics.avgResponseTime =\n      (metrics.avgResponseTime * (metrics.totalRequests - 1) + logEntry.processingTime) /\n      metrics.totalRequests;\n\n    // Track per-endpoint metrics\n    if (!metrics.endpoints[logEntry.path]) {\n      metrics.endpoints[logEntry.path] = {\n        count: 0,\n        avgTime: 0,\n        errors: 0,\n      };\n    }\n    const endpointMetrics = metrics.endpoints[logEntry.path];\n    endpointMetrics.count++;\n    endpointMetrics.avgTime =\n      (endpointMetrics.avgTime * (endpointMetrics.count - 1) + logEntry.processingTime) /\n      endpointMetrics.count;\n    if (logEntry.statusCode >= 400) {\n      endpointMetrics.errors++;\n    }\n\n    // Track status codes\n    metrics.statusCodes[logEntry.statusCode] =\n      (metrics.statusCodes[logEntry.statusCode] || 0) + 1;\n\n    // Track user agents\n    if (logEntry.userAgent) {\n      const browser = getBrowserFromUserAgent(logEntry.userAgent);\n      metrics.userAgents[browser] = (metrics.userAgents[browser] || 0) + 1;\n    }\n\n    // Store updated metrics\n    await env.CACHE.put(metricsKey, JSON.stringify(metrics), {\n      expirationTtl: 604800, // 7 days\n    });\n  } catch (error) {\n    console.error('Metrics storage error:', error);\n  }\n}\n\n/**\n * Send log entry to analytics service\n */\nasync function sendToAnalytics(\n  logEntry: LogEntry,\n  env: Env\n): Promise<void> {\n  try {\n    // Store in database for long-term analytics\n    const db = createDatabase(env);\n    await db.insert('usage_metrics', {\n      user_id: logEntry.userId || null,\n      metric_type: 'api_request',\n      metric_value: JSON.stringify({\n        method: logEntry.method,\n        path: logEntry.path,\n        statusCode: logEntry.statusCode,\n        processingTime: logEntry.processingTime,\n      }),\n      session_id: logEntry.requestId,\n      ip_address: logEntry.ip,\n      user_agent: logEntry.userAgent,\n    });\n  } catch (error) {\n    console.error('Analytics error:', error);\n  }\n}\n\n/**\n * Extract browser from user agent string\n */\nfunction getBrowserFromUserAgent(userAgent: string): string {\n  if (userAgent.includes('Chrome')) return 'Chrome';\n  if (userAgent.includes('Firefox')) return 'Firefox';\n  if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) return 'Safari';\n  if (userAgent.includes('Edge')) return 'Edge';\n  if (userAgent.includes('Opera')) return 'Opera';\n  if (userAgent.includes('curl')) return 'curl';\n  if (userAgent.includes('Postman')) return 'Postman';\n  if (userAgent.includes('axios')) return 'axios';\n  return 'Other';\n}\n\n/**\n * Get request metrics for a specific date\n */\nexport async function getMetrics(\n  date: string,\n  env: Env\n): Promise<any> {\n  try {\n    const metricsKey = `metrics:${date}`;\n    const metrics = await env.CACHE.get(metricsKey);\n    return metrics ? JSON.parse(metrics) : null;\n  } catch (error) {\n    console.error('Get metrics error:', error);\n    return null;\n  }\n}\n\n/**\n * Get request log by ID\n */\nexport async function getRequestLog(\n  requestId: string,\n  env: Env\n): Promise<LogEntry | null> {\n  try {\n    const logKey = `log:${requestId}`;\n    const log = await env.CACHE.get(logKey);\n    return log ? JSON.parse(log) : null;\n  } catch (error) {\n    console.error('Get request log error:', error);\n    return null;\n  }\n}\n\n/**\n * Performance monitoring\n */\nexport class PerformanceMonitor {\n  private marks: Map<string, number> = new Map();\n\n  mark(name: string): void {\n    this.marks.set(name, Date.now());\n  }\n\n  measure(name: string, startMark: string, endMark?: string): number {\n    const start = this.marks.get(startMark);\n    if (!start) return 0;\n\n    const end = endMark ? this.marks.get(endMark) : Date.now();\n    if (!end) return 0;\n\n    return end - start;\n  }\n\n  getAllMeasurements(): Record<string, number> {\n    const measurements: Record<string, number> = {};\n    const now = Date.now();\n\n    for (const [name, time] of this.marks.entries()) {\n      measurements[name] = now - time;\n    }\n\n    return measurements;\n  }\n}", "/**\n * Main router for API Gateway\n * Routes requests to appropriate service workers or handlers\n */\n\nimport { Env, AuthRequest } from '../../shared/types';\nimport { handleHealthCheck } from './index';\nimport { createErrorResponse } from './middleware/errorHandler';\nimport { addRateLimitHeaders } from './middleware/rateLimit';\n\n/**\n * Main router function\n */\nexport async function router(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  const url = new URL(request.url);\n  const path = url.pathname;\n  const method = request.method;\n\n  // Health check\n  if (path === '/api/v1/health' || path === '/health') {\n    return handleHealthCheck(env);\n  }\n\n  // API version check\n  if (!path.startsWith('/api/v1/')) {\n    return createErrorResponse(404, 'API version not found. Use /api/v1/', 'VERSION_NOT_FOUND');\n  }\n\n  // Route to appropriate service\n  try {\n    // Auth service routes\n    if (path.startsWith('/api/v1/auth/')) {\n      return routeToAuthService(request, env, ctx);\n    }\n\n    // Framework service routes\n    if (path.startsWith('/api/v1/frameworks/')) {\n      return routeToFrameworkService(request, env, ctx);\n    }\n\n    // Research tools routes\n    if (path.startsWith('/api/v1/tools/')) {\n      return routeToToolsService(request, env, ctx);\n    }\n\n    // User management routes\n    if (path.startsWith('/api/v1/users/')) {\n      return routeToUsersService(request, env, ctx);\n    }\n\n    // AI service routes\n    if (path.startsWith('/api/v1/ai/')) {\n      return routeToAIService(request, env, ctx);\n    }\n\n    // Export service routes\n    if (path.startsWith('/api/v1/export/')) {\n      return routeToExportService(request, env, ctx);\n    }\n\n    // Analytics routes\n    if (path.startsWith('/api/v1/analytics/')) {\n      return routeToAnalyticsService(request, env, ctx);\n    }\n\n    // Citations routes\n    if (path.startsWith('/api/v1/citations/')) {\n      return routeToCitationsService(request, env, ctx);\n    }\n\n    // Jobs routes\n    if (path.startsWith('/api/v1/jobs/')) {\n      return routeToJobsService(request, env, ctx);\n    }\n\n    // No matching route\n    return createErrorResponse(404, 'Endpoint not found', 'ENDPOINT_NOT_FOUND');\n\n  } catch (error) {\n    console.error('Routing error:', error);\n    return createErrorResponse(500, 'Internal routing error', 'ROUTING_ERROR');\n  }\n}\n\n/**\n * Route to Auth Service Worker\n */\nasync function routeToAuthService(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  // If AUTH_SERVICE binding exists, use it\n  if (env.AUTH_SERVICE) {\n    return env.AUTH_SERVICE.fetch(request);\n  }\n\n  // Otherwise, handle locally\n  const { authRouter } = await import('./routes/auth');\n  return authRouter(request, env, ctx);\n}\n\n/**\n * Route to Framework Service Workers\n */\nasync function routeToFrameworkService(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  const url = new URL(request.url);\n  const pathParts = url.pathname.split('/');\n  const frameworkType = pathParts[4]; // /api/v1/frameworks/{type}\n\n  // Map to specific framework service if bound\n  const serviceBindings: Record<string, Fetcher | undefined> = {\n    'swot': env.SWOT_SERVICE,\n    'ach': env.ACH_SERVICE,\n    'behavioral': env.BEHAVIORAL_SERVICE,\n    'deception': env.DECEPTION_SERVICE,\n    'dotmlpf': env.DOTMLPF_SERVICE,\n    'pmesii-pt': env.PMESII_SERVICE,\n    'dime': env.DIME_SERVICE,\n    'pest': env.PEST_SERVICE,\n    'vrio': env.VRIO_SERVICE,\n    'stakeholder': env.STAKEHOLDER_SERVICE,\n    'trend': env.TREND_SERVICE,\n    'surveillance': env.SURVEILLANCE_SERVICE,\n    'causeway': env.CAUSEWAY_SERVICE,\n    'cog': env.COG_SERVICE,\n    'starbursting': env.STARBURSTING_SERVICE,\n    'fundamental-flow': env.FLOW_SERVICE,\n  };\n\n  const service = serviceBindings[frameworkType];\n  if (service) {\n    return service.fetch(request);\n  }\n\n  // Handle locally if service not bound\n  const { frameworkRouter } = await import('./routes/frameworks');\n  return frameworkRouter(request, env, ctx);\n}\n\n/**\n * Route to Research Tools Service\n */\nasync function routeToToolsService(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  if (env.TOOLS_SERVICE) {\n    return env.TOOLS_SERVICE.fetch(request);\n  }\n\n  const { toolsRouter } = await import('./routes/tools');\n  return toolsRouter(request, env, ctx);\n}\n\n/**\n * Route to Users Service\n */\nasync function routeToUsersService(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  if (env.USERS_SERVICE) {\n    return env.USERS_SERVICE.fetch(request);\n  }\n\n  const { usersRouter } = await import('./routes/users');\n  return usersRouter(request, env, ctx);\n}\n\n/**\n * Route to AI Service\n */\nasync function routeToAIService(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  if (env.AI_SERVICE) {\n    return env.AI_SERVICE.fetch(request);\n  }\n\n  const { aiRouter } = await import('./routes/ai');\n  return aiRouter(request, env, ctx);\n}\n\n/**\n * Route to Export Service\n */\nasync function routeToExportService(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  if (env.EXPORT_SERVICE) {\n    return env.EXPORT_SERVICE.fetch(request);\n  }\n\n  const { exportRouter } = await import('./routes/export');\n  return exportRouter(request, env, ctx);\n}\n\n/**\n * Route to Analytics Service\n */\nasync function routeToAnalyticsService(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  if (env.ANALYTICS_SERVICE) {\n    return env.ANALYTICS_SERVICE.fetch(request);\n  }\n\n  const { analyticsRouter } = await import('./routes/analytics');\n  return analyticsRouter(request, env, ctx);\n}\n\n/**\n * Route to Citations Service\n */\nasync function routeToCitationsService(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  const { citationsRouter } = await import('./routes/citations');\n  return citationsRouter(request, env, ctx);\n}\n\n/**\n * Route to Jobs Service\n */\nasync function routeToJobsService(\n  request: AuthRequest,\n  env: Env,\n  ctx: ExecutionContext\n): Promise<Response> {\n  const { jobsRouter } = await import('./routes/jobs');\n  return jobsRouter(request, env, ctx);\n}\n\n/**\n * Service health check\n */\nexport async function checkServiceHealth(\n  serviceName: string,\n  service: Fetcher\n): Promise<boolean> {\n  try {\n    const response = await service.fetch(\n      new Request('https://internal/health', {\n        method: 'GET',\n      })\n    );\n    return response.status === 200;\n  } catch (error) {\n    console.error(`Health check failed for ${serviceName}:`, error);\n    return false;\n  }\n}\n\n/**\n * Get all available services\n */\nexport function getAvailableServices(env: Env): string[] {\n  const services: string[] = ['gateway'];\n\n  if (env.AUTH_SERVICE) services.push('auth');\n  if (env.SWOT_SERVICE) services.push('swot');\n  if (env.ACH_SERVICE) services.push('ach');\n  if (env.BEHAVIORAL_SERVICE) services.push('behavioral');\n  if (env.DECEPTION_SERVICE) services.push('deception');\n  if (env.DOTMLPF_SERVICE) services.push('dotmlpf');\n  if (env.TOOLS_SERVICE) services.push('tools');\n  if (env.AI_SERVICE) services.push('ai');\n  if (env.EXPORT_SERVICE) services.push('export');\n  if (env.ANALYTICS_SERVICE) services.push('analytics');\n  if (env.USERS_SERVICE) services.push('users');\n\n  return services;\n}", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n"],
  "mappings": "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",
  "names": ["init_auth", "handleSWOTRequest", "init_ai", "init_export", "authRouter", "frameworkRouter", "toolsRouter", "usersRouter", "aiRouter", "exportRouter", "analyticsRouter", "citationsRouter", "jobsRouter", "src_default", "src_default"]
}
