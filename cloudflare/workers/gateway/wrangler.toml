name = "researchtoolspy-gateway"
main = "src/index.ts"
compatibility_date = "2024-01-24"
compatibility_flags = ["nodejs_compat"]

# Development configuration
[env.development]
name = "researchtoolspy-gateway-dev"
workers_dev = true

# Local development bindings
[[env.development.d1_databases]]
binding = "DB"
database_name = "researchtoolspy-dev"
database_id = "aa7d1fbd-23b2-4fc4-8271-4b0070bb24b3"

[[env.development.kv_namespaces]]
binding = "SESSIONS"
id = "17796fa8100b419f8df5ad08b2a09d7a"
preview_id = "dc4828c48f2d4b888d031cf887def847"

[[env.development.kv_namespaces]]
binding = "RATE_LIMITS"
id = "0ec6504c65e04d33b33e6e4bddc8905d"
preview_id = "0ec6504c65e04d33b33e6e4bddc8905d"

[[env.development.kv_namespaces]]
binding = "CACHE"
id = "48afc9fe53a3425b8757e9dc526c359e"
preview_id = "48afc9fe53a3425b8757e9dc526c359e"

[[env.development.kv_namespaces]]
binding = "ANONYMOUS_SESSIONS"
id = "3324d2faaded4663860eb094dea09be5"
preview_id = "3324d2faaded4663860eb094dea09be5"

[env.development.vars]
ENVIRONMENT = "development"
JWT_SECRET = "dev-secret-change-in-production"

# Staging configuration
[env.staging]
name = "researchtoolspy-gateway-staging"
workers_dev = true

[[env.staging.d1_databases]]
binding = "DB"
database_name = "researchtoolspy-staging"
database_id = "staging-db-id"

[[env.staging.kv_namespaces]]
binding = "SESSIONS"
id = "sessions-staging"

[[env.staging.kv_namespaces]]
binding = "RATE_LIMITS"
id = "rate-limits-staging"

[[env.staging.kv_namespaces]]
binding = "CACHE"
id = "cache-staging"

[[env.staging.kv_namespaces]]
binding = "ANONYMOUS_SESSIONS"
id = "anonymous-sessions-staging"

[env.staging.vars]
ENVIRONMENT = "staging"

# Production configuration
[env.production]
name = "researchtoolspy-gateway"
workers_dev = false
routes = [
  { pattern = "api.researchtoolspy.com/*", zone_name = "researchtoolspy.com" }
]

[[env.production.d1_databases]]
binding = "DB"
database_name = "researchtoolspy-prod"
database_id = "a455c866-9d7e-471f-8c28-e3816f87e7e3"

[[env.production.kv_namespaces]]
binding = "SESSIONS"
id = "17796fa8100b419f8df5ad08b2a09d7a"

[[env.production.kv_namespaces]]
binding = "RATE_LIMITS"
id = "0ec6504c65e04d33b33e6e4bddc8905d"

[[env.production.kv_namespaces]]
binding = "CACHE"
id = "48afc9fe53a3425b8757e9dc526c359e"

[[env.production.kv_namespaces]]
binding = "ANONYMOUS_SESSIONS"
id = "3324d2faaded4663860eb094dea09be5"

[[env.production.r2_buckets]]
binding = "DOCUMENTS"
bucket_name = "researchtoolspy-documents"

[[env.production.r2_buckets]]
binding = "EXPORTS"
bucket_name = "researchtoolspy-exports"

[env.production.vars]
ENVIRONMENT = "production"